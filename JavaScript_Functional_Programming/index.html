<!DOCTYPE  html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>index</title><style type="text/css"> * {margin:0; padding:0; text-indent:0; }
 .s1 { color: #F77041; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 25pt; }
 h1 { color: #FFF; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 31pt; }
 .s2 { color: #FFF; font-family:"Trebuchet MS", sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 15pt; }
 .s3 { color: #FFF; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 18pt; }
 h2 { color: black; font-family:Calibri, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 27pt; }
 .s4 { color: black; font-family:Calibri, sans-serif; font-style: italic; font-weight: normal; text-decoration: none; font-size: 26pt; }
 .s5 { color: black; font-family:"Segoe UI", sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 14pt; }
 .s6 { color: black; font-family:"Segoe UI", sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 13pt; }
 .s7 { color: #F77041; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 31pt; }
 .p, p { color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; margin:0pt; }
 .s8 { color: black; font-family:"Segoe UI", sans-serif; font-style: italic; font-weight: bold; text-decoration: none; font-size: 13pt; }
 .s9 { color: black; font-family:"Times New Roman", serif; font-style: italic; font-weight: normal; text-decoration: none; font-size: 9pt; }
 .s10 { color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 9pt; }
 .s11 { color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 h3 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 25pt; }
 .s12 { color: black; font-family:"Segoe UI", sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 12pt; }
 .s13 { color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 12pt; }
 .s14 { color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 11pt; }
 .a, a { color: black; font-family:Sylfaen, serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 8.5pt; }
 .s15 { color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 8.5pt; }
 .s16 { color: #F77041; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 18pt; }
 .s17 { color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 11pt; }
 .s18 { color: black; font-family:"Segoe UI", sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 12pt; }
 .s19 { color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 11pt; }
 .s20 { color: black; font-family:Sylfaen, serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 8.5pt; }
 .s21 { color: #F77041; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 18pt; }
 .s22 { color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 7pt; vertical-align: 3pt; }
 .s23 { color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 11pt; }
 .s24 { color: black; font-family:Sylfaen, serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 8.5pt; }
 .s25 { color: black; font-family:"Segoe UI", sans-serif; font-style: normal; font-weight: bold; text-decoration: underline; font-size: 12pt; }
 .s26 { color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 8.5pt; }
 .s27 { color: black; font-family:Sylfaen, serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 8.5pt; vertical-align: 1pt; }
 .s28 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 6pt; }
 .s29 { color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 .s30 { color: black; font-family:"Segoe UI", sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 13pt; }
 .s32 { color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 11pt; vertical-align: -1pt; }
 .s33 { color: black; font-style: normal; font-weight: normal; text-decoration: none; }
 .s34 { color: black; font-family:Arial, sans-serif; font-style: italic; font-weight: bold; text-decoration: none; font-size: 10pt; }
 .s35 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 4pt; }
 .s36 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 5pt; }
 .s37 { color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 5pt; }
 .s38 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 5pt; }
 .s39 { color: #FFF; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 5pt; }
 .s40 { color: #8F929C; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 5pt; }
 .s41 { color: #545585; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 5pt; }
 .s42 { color: #866B45; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 5pt; }
 .s44 { color: #545585; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: underline; font-size: 5pt; }
 .s45 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: underline; font-size: 5pt; }
 .s46 { color: black; font-family:Arial, sans-serif; font-style: italic; font-weight: normal; text-decoration: underline; font-size: 5pt; }
 .s47 { color: black; font-family:Arial, sans-serif; font-style: italic; font-weight: normal; text-decoration: none; font-size: 5pt; }
 .s48 { color: #8F929C; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 5pt; }
 .s50 { color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 4.5pt; }
 .s52 { color: #2C1A12; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 4pt; }
 .s54 { color: #527945; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 4pt; }
 .s57 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 4.5pt; }
 .s58 { color: #6861D5; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: underline; font-size: 4.5pt; }
 .s59 { color: #6861D5; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 4.5pt; }
 .s60 { color: #277EB3; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 4.5pt; }
 .s61 { color: #200FC8; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 4pt; vertical-align: 3pt; }
 .s62 { color: #200FC8; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 4pt; }
 .s63 { color: #200FC8; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 4pt; }
 .s64 { color: #200FC8; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 2.5pt; vertical-align: 1pt; }
 .s67 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: underline; font-size: 4.5pt; }
 .s68 { color: #9FE68F; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 4pt; }
 .s69 { color: #9FE68F; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 4pt; }
 .s70 { color: #277EB3; font-family:"Times New Roman", serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 5pt; }
 .s71 { color: #6861D5; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 4pt; vertical-align: 1pt; }
 .s73 { color: #6861D5; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 3pt; vertical-align: 1pt; }
 .s74 { color: #277EB3; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 11pt; }
 .s75 { color: #6861D5; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 4pt; vertical-align: 2pt; }
 .s76 { color: #3D27DC; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 4pt; }
 .s77 { color: #6861D5; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 4.5pt; vertical-align: 1pt; }
 .s78 { color: #3D27DC; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 4.5pt; }
 .s80 { color: #523122; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 5pt; }
 .s81 { color: #9E6BCD; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: underline; font-size: 4.5pt; }
 .s82 { color: #355009; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 4pt; }
 .s83 { color: #BBB050; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 5pt; }
 .s84 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 10pt; }
 .s85 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 5pt; }
 .s86 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 5pt; }
 .s87 { color: #FFF; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 5.5pt; }
 .s88 { color: #FFF; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 5.5pt; }
 .s89 { color: #BBB050; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 5.5pt; }
 .s90 { color: #E7CA57; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 5.5pt; }
 .s91 { color: #FFF; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 5pt; }
 .s92 { color: #FFF; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 5pt; }
 .s93 { color: #A9353E; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 5pt; }
 .s94 { color: #792E80; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 5pt; }
 .s95 { color: #3D27DC; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 5pt; }
 .s98 { color: #8F929C; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 4pt; }
 .s99 { color: #8F929C; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 4pt; }
 .s100 { color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 5pt; }
 .s101 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 5.5pt; }
 .s102 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 5.5pt; }
 .s103 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 7.5pt; }
 .s104 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 6.5pt; }
 .s105 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 5.5pt; }
 .s106 { color: #A9353E; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 7.5pt; }
 .s107 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 6pt; }
 .s108 { color: #393953; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 6pt; }
 .s109 { color: #2C1A12; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 6pt; }
 .s110 { color: #3A2888; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 6pt; }
 .s114 { color: #8F929C; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 6pt; }
 .s115 { color: #A9353E; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 6pt; }
 .s117 { color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 6pt; }
 .s118 { color: #545585; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 3pt; }
 .s120 { color: #164DA9; font-family:"Times New Roman", serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 5pt; }
 .s121 { color: #FFF; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 8.5pt; }
 .s122 { color: #DFE6D0; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 8.5pt; }
 .s123 { color: #DFE6D0; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 5.5pt; }
 .s124 { color: #DFE6D0; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 5.5pt; }
 .s125 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: underline; font-size: 5pt; }
 .s126 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 5pt; }
 .s127 { color: #6861D5; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 5pt; }
 .s128 { color: #527945; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 5pt; }
 .s129 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 3pt; }
 .s130 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 3pt; vertical-align: -1pt; }
 .s131 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 5pt; }
 .s132 { color: #3A2888; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 5pt; }
 .s134 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 5pt; }
 .s135 { color: #393953; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 8pt; }
 .s137 { color: #FFF; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 7.5pt; }
 .s138 { color: #FFF; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 8.5pt; }
 .s139 { color: #DFE6D0; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 7.5pt; }
 .s140 { color: #DFE6D0; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 5pt; vertical-align: 2pt; }
 .s141 { color: #527945; font-family:Arial, sans-serif; font-style: italic; font-weight: normal; text-decoration: none; font-size: 7.5pt; }
 .s142 { color: #DFE6D0; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 7.5pt; }
 .s143 { color: #FFF; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 7.5pt; }
 .s144 { color: #DFE6D0; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: underline; font-size: 7.5pt; }
 .s145 { color: #DFE6D0; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 7.5pt; vertical-align: -2pt; }
 .s147 { color: #DFE6D0; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 7.5pt; }
 .s148 { color: #6DE176; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 8.5pt; }
 .s149 { color: #DFE6D0; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 8.5pt; }
 .s150 { color: #FFF; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: underline; font-size: 7.5pt; }
 .s151 { color: #FFF; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 7.5pt; }
 .s152 { color: #DFE6D0; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 .s153 { color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 8pt; }
 .s154 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 4pt; }
 .s155 { color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 4pt; }
 .s156 { color: black; font-family:"Segoe UI", sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 10pt; }
 .s157 { color: black; font-family:"Segoe UI", sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 8.5pt; }
 .s158 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 11pt; }
 .s159 { color: black; font-family:"Segoe UI", sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 8pt; }
 .s160 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 8.5pt; }
 .s161 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 10pt; }
 .s162 { color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 6pt; vertical-align: 2pt; }
 .s163 { color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 7pt; }
 .s164 { color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 8pt; }
 .s166 { color: #FFF; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9.5pt; }
 .s167 { color: #FFF; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9.5pt; }
 .s168 { color: #FFF; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 8pt; }
 .s169 { color: #FFF; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 8pt; }
 .s170 { color: #FFF; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 .s171 { color: #FFF; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 .s172 { color: #6DE176; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 8pt; }
 .s174 { color: #35C736; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 8pt; }
 .s175 { color: #8F929C; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 8pt; }
 .s176 { color: #6DE176; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 8pt; }
 .s177 { color: #6DE176; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 8pt; }
 .s178 { color: #6DE176; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 8pt; }
 .s179 { color: #6DE176; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 .s180 { color: #FFF; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 9.5pt; }
 .s181 { color: #FFF; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 8pt; }
 .s182 { color: #FFF; font-family:Arial, sans-serif; font-style: italic; font-weight: normal; text-decoration: none; font-size: 5pt; }
 .s183 { color: #FFF; font-family:Arial, sans-serif; font-style: italic; font-weight: normal; text-decoration: none; font-size: 5pt; }
 .s184 { color: #FFF; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 8pt; }
 .s185 { color: black; font-family:Arial, sans-serif; font-style: italic; font-weight: normal; text-decoration: none; font-size: 8.5pt; }
 .s186 { color: black; font-family:Arial, sans-serif; font-style: italic; font-weight: normal; text-decoration: none; font-size: 8pt; }
 .s187 { color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 7pt; }
 .s188 { color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 9pt; }
 .s189 { color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 .s190 { color: black; font-family:Arial, sans-serif; font-style: italic; font-weight: normal; text-decoration: none; font-size: 9.5pt; }
 .s191 { color: #3D27DC; font-family:Consolas, monospace; font-style: normal; font-weight: normal; text-decoration: none; font-size: 7.5pt; }
 .s192 { color: black; font-family:Consolas, monospace; font-style: normal; font-weight: normal; text-decoration: none; font-size: 7.5pt; }
 .s194 { color: #164DA9; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 6.5pt; }
 .s197 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 9.5pt; }
 .s198 { color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 6.5pt; }
 .s199 { color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 8.5pt; }
 .s200 { color: #E20D1B; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 6.5pt; }
 .s201 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 7pt; }
 .s203 { color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: underline; font-size: 5.5pt; }
 .s204 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: underline; font-size: 5.5pt; }
 .s206 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: underline; font-size: 11pt; }
 .s207 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 5pt; vertical-align: 2pt; }
 .s208 { color: #545585; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 8.5pt; }
 .s211 { color: black; font-family:Arial, sans-serif; font-style: italic; font-weight: normal; text-decoration: none; font-size: 10pt; }
 .s212 { color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 6pt; vertical-align: -2pt; }
 .s213 { color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 10pt; vertical-align: -5pt; }
 .s214 { color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 10pt; }
 .s215 { color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 6pt; }
 .s216 { color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; vertical-align: -2pt; }
 .s217 { color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 6pt; vertical-align: 2pt; }
 .s218 { color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 .s219 { color: #35C736; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: underline; font-size: 7pt; }
 .s221 { color: #DFE6D0; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 7pt; }
 .s222 { color: #DFE6D0; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 7pt; }
 .s223 { color: #BAC2AE; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 7pt; }
 .s224 { color: #227335; font-family:Arial, sans-serif; font-style: italic; font-weight: normal; text-decoration: none; font-size: 7pt; }
 .s226 { color: #DFE6D0; font-family:Arial, sans-serif; font-style: italic; font-weight: normal; text-decoration: none; font-size: 7pt; }
 .s227 { color: black; font-family:"Courier New", monospace; font-style: normal; font-weight: normal; text-decoration: none; font-size: 16pt; }
 .s228 { color: black; font-family:"Courier New", monospace; font-style: normal; font-weight: normal; text-decoration: none; font-size: 16pt; }
 .s229 { color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 6pt; vertical-align: 2pt; }
 .s230 { color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 6pt; vertical-align: 2pt; }
 .s231 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 14pt; }
 .s232 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 15pt; }
 .s233 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9.5pt; }
 .s234 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 10pt; }
 .s235 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 14pt; }
 .s236 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; vertical-align: 4pt; }
 .s237 { color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; vertical-align: -2pt; }
 .s238 { color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 6pt; }
 .s239 { color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 4.5pt; vertical-align: 2pt; }
 .s240 { color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: underline; font-size: 9pt; }
 .s241 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 9pt; }
 .s242 { color: black; font-family:"Book Antiqua", serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 10pt; }
 .s243 { color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 .s244 { color: black; font-style: normal; font-weight: normal; text-decoration: none; }
 .s245 { color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 11pt; }
 .s246 { color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 .s248 { color: black; font-family:"MS Reference Sans Serif", sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 6pt; }
 .s250 { color: #120C39; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 8pt; }
 .s251 { color: #FFF; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 12pt; }
 .s253 { color: #DFE6D0; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 6pt; }
 .s254 { color: #393953; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 16pt; }
 .s255 { color: #120C39; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 5.5pt; }
 .s257 { color: #FFF; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 8.5pt; }
 .s258 { color: #120C39; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 6pt; }
 .s260 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 6pt; }
 .s261 { color: black; font-family:Arial, sans-serif; font-style: italic; font-weight: normal; text-decoration: none; font-size: 7pt; }
 .s263 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 5.5pt; }
 .s264 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 7pt; }
 .s265 { color: #FFF; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 11pt; }
 .s266 { color: #E7CA57; font-family:Arial, sans-serif; font-style: italic; font-weight: normal; text-decoration: none; font-size: 5pt; }
 .s267 { color: #FFF; font-family:Arial, sans-serif; font-style: italic; font-weight: normal; text-decoration: none; font-size: 5pt; }
 .s268 { color: #99C7DA; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 12pt; }
 .s269 { color: #99C7DA; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: underline; font-size: 12pt; }
 .s270 { color: #FFF; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 12pt; }
 .s271 { color: #FFF; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 10pt; }
 .s272 { color: #FFF; font-family:"Segoe UI", sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 10pt; }
 .s273 { color: #545585; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 6pt; }
 .s276 { color: #DFE6D0; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 6pt; }
 .s279 { color: #FFF; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 6pt; }
 .s280 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 6pt; }
 .s283 { color: #545585; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 17pt; }
 .s284 { color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 11pt; }
 .s285 { color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 8pt; }
 .s286 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 11pt; vertical-align: -1pt; }
 .s288 { color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: underline; font-size: 9pt; }
 .s289 { color: black; font-family:"Courier New", monospace; font-style: normal; font-weight: normal; text-decoration: none; font-size: 12pt; }
 .s290 { color: black; font-family:"Courier New", monospace; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9.5pt; }
 .s291 { color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 9pt; }
 .s292 { color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 8.5pt; }
 .s293 { color: black; font-family:"Times New Roman", serif; font-style: italic; font-weight: normal; text-decoration: none; font-size: 11pt; }
 .s296 { color: #545585; font-family:Consolas, monospace; font-style: normal; font-weight: normal; text-decoration: none; font-size: 7.5pt; }
 .s297 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 .s298 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 7pt; }
 .s300 { color: #6861D5; font-family:Consolas, monospace; font-style: normal; font-weight: normal; text-decoration: none; font-size: 7.5pt; }
 .s302 { color: #277EB3; font-family:Consolas, monospace; font-style: normal; font-weight: normal; text-decoration: none; font-size: 7.5pt; vertical-align: 1pt; }
 .s303 { color: #523122; font-family:Consolas, monospace; font-style: normal; font-weight: normal; text-decoration: none; font-size: 7.5pt; }
 .s304 { color: #545585; font-family:Consolas, monospace; font-style: normal; font-weight: normal; text-decoration: none; font-size: 7.5pt; vertical-align: 1pt; }
 .s306 { color: #BAC2AE; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 6.5pt; }
 .s307 { color: #99C7DA; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 6.5pt; }
 .s308 { color: #99C7DA; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 6.5pt; }
 .s309 { color: #DFE6D0; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 6.5pt; }
 .s310 { color: #DFE6D0; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 6.5pt; }
 .s311 { color: #DFE6D0; font-family:Arial, sans-serif; font-style: italic; font-weight: normal; text-decoration: none; font-size: 8pt; }
 .s312 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 7.5pt; }
 .s313 { color: #120C39; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 8pt; }
 .s314 { color: #120C39; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: line-through; font-size: 7.5pt; }
 .s316 { color: #120C39; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 7.5pt; }
 .s317 { color: #120C39; font-family:Arial, sans-serif; font-style: italic; font-weight: normal; text-decoration: none; font-size: 5pt; }
 .s318 { color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 8pt; }
 .s319 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: line-through; font-size: 7.5pt; }
 .s320 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 7.5pt; }
 .s322 { color: #1F0D64; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 8pt; }
 .s323 { color: #1F0D64; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: line-through; font-size: 7.5pt; }
 .s324 { color: #1F0D64; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 7.5pt; }
 .s325 { color: black; font-family:Arial, sans-serif; font-style: italic; font-weight: bold; text-decoration: none; font-size: 7.5pt; }
 .s326 { color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 7.5pt; }
 .s327 { color: black; font-family:Arial, sans-serif; font-style: italic; font-weight: bold; text-decoration: line-through; font-size: 7.5pt; }
 .s328 { color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 1pt; }
 .s329 { color: #120C39; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 7.5pt; }
 .s330 { color: #120C39; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 6.5pt; }
 .s331 { color: #120C39; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: line-through; font-size: 6.5pt; }
 .s332 { color: #120C39; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: line-through; font-size: 6.5pt; }
 .s333 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: line-through; font-size: 6.5pt; }
 .s334 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 6.5pt; }
 .s335 { color: #120C39; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: line-through; font-size: 7.5pt; }
 .s336 { color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: line-through; font-size: 6.5pt; }
 .s337 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: line-through; font-size: 7.5pt; }
 .s338 { color: #1F0D64; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 7.5pt; }
 .s339 { color: #1F0D64; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 6.5pt; }
 .s340 { color: #1F0D64; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: line-through; font-size: 6.5pt; }
 .s341 { color: #3A2888; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 6.5pt; }
 .s342 { color: #3A2888; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 7.5pt; }
 .s344 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 11pt; }
 .s345 { color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 7pt; vertical-align: -3pt; }
 .s346 { color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 7pt; vertical-align: 3pt; }
 .s347 { color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 11pt; }
 .s348 { color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 7pt; vertical-align: 3pt; }
 .s349 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 31pt; }
 .s350 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 17pt; }
 .s351 { color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 17pt; }
 h4 { color: #FFF; font-family:Tahoma, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 20pt; }
 .s352 { color: #F77041; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 7pt; }
 .s353 { color: #FFF; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 18pt; }
 .s354 { color: #FFF; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 10pt; }
 .s355 { color: #FFF; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 10pt; }
 .s356 { color: #FFF; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 4pt; }
 .s357 { color: #FFF; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 4.5pt; }
 .s358 { color: #FFF; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 4.5pt; }
 li {display: block; }
 #l1 {padding-left: 0pt;counter-reset: c1 1; }
 #l1> li>*:first-child:before {counter-increment: c1; content: counter(c1, decimal)". "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l1> li:first-child>*:first-child:before {counter-increment: c1 0;  }
 li {display: block; }
 #l2 {padding-left: 0pt; }
 #l2> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l3 {padding-left: 0pt; }
 #l3> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: italic; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l4 {padding-left: 0pt; }
 #l4> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; }
 li {display: block; }
 #l5 {padding-left: 0pt; }
 #l5> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; }
 li {display: block; }
 #l6 {padding-left: 0pt; }
 #l6> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l7 {padding-left: 0pt; }
 #l7> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l8 {padding-left: 0pt; }
 #l8> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l9 {padding-left: 0pt; }
 #l9> li>*:first-child:before {content: "■ "; color: #FFF; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 5pt; }
 li {display: block; }
 #l10 {padding-left: 0pt; }
 #l10> li>*:first-child:before {content: "✓ "; color: #DFE6D0; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 5pt; }
 li {display: block; }
 #l11 {padding-left: 0pt; }
 #l11> li>*:first-child:before {content: "■ "; color: #FFF; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 5pt; }
 li {display: block; }
 #l12 {padding-left: 0pt;counter-reset: n1 1; }
 #l12> li>*:first-child:before {counter-increment: n1; content: counter(n1, decimal)" "; color: black; font-style: normal; font-weight: normal; text-decoration: none; }
 #l12> li:first-child>*:first-child:before {counter-increment: n1 0;  }
 li {display: block; }
 #l13 {padding-left: 0pt;counter-reset: o1 13; }
 #l13> li>*:first-child:before {counter-increment: o1; content: counter(o1, decimal)" "; color: black; font-style: normal; font-weight: normal; text-decoration: none; }
 #l13> li:first-child>*:first-child:before {counter-increment: o1 0;  }
 li {display: block; }
 #l14 {padding-left: 0pt;counter-reset: p1 1; }
 #l14> li>*:first-child:before {counter-increment: p1; content: counter(p1, decimal)" "; color: black; font-style: normal; font-weight: normal; text-decoration: none; }
 #l14> li:first-child>*:first-child:before {counter-increment: p1 0;  }
 #l15 {padding-left: 0pt;counter-reset: p2 1; }
 #l15> li>*:first-child:before {counter-increment: p2; content: counter(p1, decimal)"."counter(p2, decimal)" "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l15> li:first-child>*:first-child:before {counter-increment: p2 0;  }
 li {display: block; }
 #l16 {padding-left: 0pt; }
 #l16> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l17 {padding-left: 0pt; }
 #l17> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l18 {padding-left: 0pt; }
 #l18> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l19 {padding-left: 0pt; }
 #l19> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l20 {padding-left: 0pt; }
 #l20> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l21 {padding-left: 0pt; }
 #l21> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l22 {padding-left: 0pt; }
 #l22> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l23 {padding-left: 0pt;counter-reset: x1 2; }
 #l23> li>*:first-child:before {counter-increment: x1; content: counter(x1, decimal)" "; color: black; font-style: normal; font-weight: normal; text-decoration: none; }
 #l23> li:first-child>*:first-child:before {counter-increment: x1 0;  }
 #l24 {padding-left: 0pt;counter-reset: x2 1; }
 #l24> li>*:first-child:before {counter-increment: x2; content: counter(x1, decimal)"."counter(x2, decimal)" "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l24> li:first-child>*:first-child:before {counter-increment: x2 0;  }
 li {display: block; }
 #l25 {padding-left: 0pt; }
 #l25> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l26 {padding-left: 0pt; }
 #l26> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l27 {padding-left: 0pt; }
 #l27> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l28 {padding-left: 0pt; }
 #l28> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l29 {padding-left: 0pt; }
 #l29> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l30 {padding-left: 0pt; }
 #l30> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l31 {padding-left: 0pt; }
 #l31> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l32 {padding-left: 0pt; }
 #l32> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l33 {padding-left: 0pt; }
 #l33> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l34 {padding-left: 0pt;counter-reset: j1 3; }
 #l34> li>*:first-child:before {counter-increment: j1; content: counter(j1, decimal)" "; color: black; font-style: normal; font-weight: normal; text-decoration: none; }
 #l34> li:first-child>*:first-child:before {counter-increment: j1 0;  }
 #l35 {padding-left: 0pt;counter-reset: j2 1; }
 #l35> li>*:first-child:before {counter-increment: j2; content: counter(j1, decimal)"."counter(j2, decimal)" "; color: black; font-style: normal; font-weight: normal; text-decoration: none; }
 #l35> li:first-child>*:first-child:before {counter-increment: j2 0;  }
 li {display: block; }
 #l36 {padding-left: 0pt; }
 #l36> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; }
 li {display: block; }
 #l37 {padding-left: 0pt; }
 #l37> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l38 {padding-left: 0pt; }
 #l38> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l39 {padding-left: 0pt; }
 #l39> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l40 {padding-left: 0pt; }
 #l40> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l41 {padding-left: 0pt; }
 #l41> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l42 {padding-left: 0pt; }
 #l42> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l43 {padding-left: 0pt; }
 #l43> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l44 {padding-left: 0pt; }
 #l44> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l45 {padding-left: 0pt; }
 #l45> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l46 {padding-left: 0pt; }
 #l46> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l47 {padding-left: 0pt; }
 #l47> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l48 {padding-left: 0pt;counter-reset: w1 4; }
 #l48> li>*:first-child:before {counter-increment: w1; content: counter(w1, decimal)" "; color: black; font-style: normal; font-weight: normal; text-decoration: none; }
 #l48> li:first-child>*:first-child:before {counter-increment: w1 0;  }
 #l49 {padding-left: 0pt;counter-reset: w2 1; }
 #l49> li>*:first-child:before {counter-increment: w2; content: counter(w1, decimal)"."counter(w2, decimal)" "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l49> li:first-child>*:first-child:before {counter-increment: w2 0;  }
 #l50 {padding-left: 0pt; }
 #l50> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l51 {padding-left: 0pt; }
 #l51> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l52 {padding-left: 0pt; }
 #l52> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l53 {padding-left: 0pt; }
 #l53> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l54 {padding-left: 0pt; }
 #l54> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l55 {padding-left: 0pt; }
 #l55> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l56 {padding-left: 0pt; }
 #l56> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l57 {padding-left: 0pt; }
 #l57> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l58 {padding-left: 0pt; }
 #l58> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l59 {padding-left: 0pt; }
 #l59> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l60 {padding-left: 0pt;counter-reset: h1 5; }
 #l60> li>*:first-child:before {counter-increment: h1; content: counter(h1, decimal)" "; color: black; font-style: normal; font-weight: normal; text-decoration: none; }
 #l60> li:first-child>*:first-child:before {counter-increment: h1 0;  }
 #l61 {padding-left: 0pt;counter-reset: h2 1; }
 #l61> li>*:first-child:before {counter-increment: h2; content: counter(h1, decimal)"."counter(h2, decimal)" "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l61> li:first-child>*:first-child:before {counter-increment: h2 0;  }
 li {display: block; }
 #l62 {padding-left: 0pt; }
 #l62> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l63 {padding-left: 0pt; }
 #l63> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l64 {padding-left: 0pt;counter-reset: k1 1; }
 #l64> li>*:first-child:before {counter-increment: k1; content: counter(k1, decimal)". "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l64> li:first-child>*:first-child:before {counter-increment: k1 0;  }
 li {display: block; }
 #l65 {padding-left: 0pt; }
 #l65> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l66 {padding-left: 0pt; }
 #l66> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l67 {padding-left: 0pt; }
 #l67> li>*:first-child:before {content: "- "; color: black; font-family:"Times New Roman", serif; font-style: italic; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l68 {padding-left: 0pt; }
 #l68> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l69 {padding-left: 0pt; }
 #l69> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l70 {padding-left: 0pt; }
 #l70> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: italic; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l71 {padding-left: 0pt; }
 #l71> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l72 {padding-left: 0pt; }
 #l72> li>*:first-child:before {content: "> "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l73 {padding-left: 0pt; }
 #l73> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l74 {padding-left: 0pt;counter-reset: t1 1; }
 #l74> li>*:first-child:before {counter-increment: t1; content: counter(t1, decimal)". "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l74> li:first-child>*:first-child:before {counter-increment: t1 0;  }
 li {display: block; }
 #l75 {padding-left: 0pt;counter-reset: u1 6; }
 #l75> li>*:first-child:before {counter-increment: u1; content: counter(u1, decimal)" "; color: black; font-style: normal; font-weight: normal; text-decoration: none; }
 #l75> li:first-child>*:first-child:before {counter-increment: u1 0;  }
 #l76 {padding-left: 0pt;counter-reset: u2 1; }
 #l76> li>*:first-child:before {counter-increment: u2; content: counter(u1, decimal)"."counter(u2, decimal)" "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l76> li:first-child>*:first-child:before {counter-increment: u2 0;  }
 #l77 {padding-left: 0pt;counter-reset: v1 6; }
 #l77> li>*:first-child:before {counter-increment: v1; content: counter(v1, decimal)" "; color: black; font-style: normal; font-weight: normal; text-decoration: none; }
 #l77> li:first-child>*:first-child:before {counter-increment: v1 0;  }
 #l78 {padding-left: 0pt;counter-reset: v2 15; }
 #l78> li>*:first-child:before {counter-increment: v2; content: counter(v1, decimal)"."counter(v2, decimal)" "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l78> li:first-child>*:first-child:before {counter-increment: v2 0;  }
 #l79 {padding-left: 0pt; }
 #l79> li>*:first-child:before {content: "- "; color: black; font-family:Calibri, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 27pt; }
 #l80 {padding-left: 0pt; }
 #l80> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l81 {padding-left: 0pt; }
 #l81> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: italic; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l82 {padding-left: 0pt; }
 #l82> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l83 {padding-left: 0pt; }
 #l83> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l84 {padding-left: 0pt; }
 #l84> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l85 {padding-left: 0pt; }
 #l85> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l86 {padding-left: 0pt; }
 #l86> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l87 {padding-left: 0pt; }
 #l87> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l88 {padding-left: 0pt; }
 #l88> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l89 {padding-left: 0pt; }
 #l89> li>*:first-child:before {content: "> "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l90 {padding-left: 0pt; }
 #l90> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l91 {padding-left: 0pt; }
 #l91> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l92 {padding-left: 0pt; }
 #l92> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l93 {padding-left: 0pt; }
 #l93> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l94 {padding-left: 0pt;counter-reset: l1 7; }
 #l94> li>*:first-child:before {counter-increment: l1; content: counter(l1, decimal)" "; color: black; font-style: normal; font-weight: normal; text-decoration: none; }
 #l94> li:first-child>*:first-child:before {counter-increment: l1 0;  }
 #l95 {padding-left: 0pt;counter-reset: l2 1; }
 #l95> li>*:first-child:before {counter-increment: l2; content: counter(l1, decimal)"."counter(l2, decimal)" "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l95> li:first-child>*:first-child:before {counter-increment: l2 0;  }
 #l96 {padding-left: 0pt; }
 #l96> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l97 {padding-left: 0pt; }
 #l97> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l98 {padding-left: 0pt; }
 #l98> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l99 {padding-left: 0pt;counter-reset: o1 1; }
 #l99> li>*:first-child:before {counter-increment: o1; content: counter(o1, decimal)". "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l99> li:first-child>*:first-child:before {counter-increment: o1 0;  }
 li {display: block; }
 #l100 {padding-left: 0pt; }
 #l100> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l101 {padding-left: 0pt;counter-reset: q1 8; }
 #l101> li>*:first-child:before {counter-increment: q1; content: counter(q1, decimal)" "; color: black; font-style: normal; font-weight: normal; text-decoration: none; }
 #l101> li:first-child>*:first-child:before {counter-increment: q1 0;  }
 #l102 {padding-left: 0pt;counter-reset: q2 1; }
 #l102> li>*:first-child:before {counter-increment: q2; content: counter(q1, decimal)"."counter(q2, decimal)" "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l102> li:first-child>*:first-child:before {counter-increment: q2 0;  }
 li {display: block; }
 #l103 {padding-left: 0pt; }
 #l103> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l104 {padding-left: 0pt; }
 #l104> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l105 {padding-left: 0pt;counter-reset: t1 1; }
 #l105> li>*:first-child:before {counter-increment: t1; content: counter(t1, decimal)". "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l105> li:first-child>*:first-child:before {counter-increment: t1 0;  }
 #l106 {padding-left: 0pt; }
 #l106> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l107 {padding-left: 0pt;counter-reset: u1 1; }
 #l107> li>*:first-child:before {counter-increment: u1; content: counter(u1, decimal)". "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l107> li:first-child>*:first-child:before {counter-increment: u1 0;  }
 li {display: block; }
 #l108 {padding-left: 0pt;counter-reset: v1 1; }
 #l108> li>*:first-child:before {counter-increment: v1; content: counter(v1, decimal)". "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l108> li:first-child>*:first-child:before {counter-increment: v1 0;  }
 li {display: block; }
 #l109 {padding-left: 0pt; }
 #l109> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l110 {padding-left: 0pt; }
 #l110> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l111 {padding-left: 0pt; }
 #l111> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l112 {padding-left: 0pt; }
 #l112> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; }
 li {display: block; }
 #l113 {padding-left: 0pt; }
 #l113> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l114 {padding-left: 0pt; }
 #l114> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l115 {padding-left: 0pt; }
 #l115> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; }
 li {display: block; }
 #l116 {padding-left: 0pt;counter-reset: f1 1; }
 #l116> li>*:first-child:before {counter-increment: f1; content: counter(f1, decimal)". "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l116> li:first-child>*:first-child:before {counter-increment: f1 0;  }
 li {display: block; }
 #l117 {padding-left: 0pt;counter-reset: g1 9; }
 #l117> li>*:first-child:before {counter-increment: g1; content: counter(g1, decimal)" "; color: black; font-style: normal; font-weight: normal; text-decoration: none; }
 #l117> li:first-child>*:first-child:before {counter-increment: g1 0;  }
 #l118 {padding-left: 0pt;counter-reset: g2 1; }
 #l118> li>*:first-child:before {counter-increment: g2; content: counter(g1, decimal)"."counter(g2, decimal)" "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l118> li:first-child>*:first-child:before {counter-increment: g2 0;  }
 #l119 {padding-left: 0pt; }
 #l119> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; }
 #l120 {padding-left: 0pt; }
 #l120> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; }
 #l121 {padding-left: 0pt; }
 #l121> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 9pt; }
 #l122 {padding-left: 0pt; }
 #l122> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; }
 li {display: block; }
 #l123 {padding-left: 0pt; }
 #l123> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l124 {padding-left: 0pt;counter-reset: j1 1; }
 #l124> li>*:first-child:before {counter-increment: j1; content: counter(j1, decimal)". "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l124> li:first-child>*:first-child:before {counter-increment: j1 0;  }
 #l125 {padding-left: 0pt; }
 #l125> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: italic; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l126 {padding-left: 0pt; }
 #l126> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l127 {padding-left: 0pt; }
 #l127> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l128 {padding-left: 0pt; }
 #l128> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l129 {padding-left: 0pt;counter-reset: n1 1; }
 #l129> li>*:first-child:before {counter-increment: n1; content: counter(n1, decimal)". "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l129> li:first-child>*:first-child:before {counter-increment: n1 0;  }
 li {display: block; }
 #l130 {padding-left: 0pt; }
 #l130> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l131 {padding-left: 0pt;counter-reset: p1 10; }
 #l131> li>*:first-child:before {counter-increment: p1; content: counter(p1, decimal)" "; color: black; font-style: normal; font-weight: normal; text-decoration: none; }
 #l131> li:first-child>*:first-child:before {counter-increment: p1 0;  }
 #l132 {padding-left: 0pt;counter-reset: p2 1; }
 #l132> li>*:first-child:before {counter-increment: p2; content: counter(p1, decimal)"."counter(p2, decimal)" "; color: black; font-style: normal; font-weight: normal; text-decoration: none; }
 #l132> li:first-child>*:first-child:before {counter-increment: p2 0;  }
 #l133 {padding-left: 0pt; }
 #l133> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l134 {padding-left: 0pt; }
 #l134> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; }
 li {display: block; }
 #l135 {padding-left: 0pt; }
 #l135> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l136 {padding-left: 0pt; }
 #l136> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l137 {padding-left: 0pt; }
 #l137> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; }
 li {display: block; }
 #l138 {padding-left: 0pt; }
 #l138> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; }
 li {display: block; }
 #l139 {padding-left: 0pt; }
 #l139> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; }
 li {display: block; }
 #l140 {padding-left: 0pt; }
 #l140> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; }
 li {display: block; }
 #l141 {padding-left: 0pt; }
 #l141> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 11pt; }
 li {display: block; }
 #l142 {padding-left: 0pt; }
 #l142> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 11pt; }
 li {display: block; }
 #l143 {padding-left: 0pt; }
 #l143> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l144 {padding-left: 0pt; }
 #l144> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l145 {padding-left: 0pt; }
 #l145> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l146 {padding-left: 0pt; }
 #l146> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l147 {padding-left: 0pt; }
 #l147> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l148 {padding-left: 0pt;counter-reset: g1 1; }
 #l148> li>*:first-child:before {counter-increment: g1; content: counter(g1, decimal)". "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l148> li:first-child>*:first-child:before {counter-increment: g1 0;  }
 li {display: block; }
 #l149 {padding-left: 0pt;counter-reset: h1 1; }
 #l149> li>*:first-child:before {counter-increment: h1; content: counter(h1, decimal)". "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l149> li:first-child>*:first-child:before {counter-increment: h1 0;  }
 li {display: block; }
 #l150 {padding-left: 0pt; }
 #l150> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; }
 li {display: block; }
 #l151 {padding-left: 0pt; }
 #l151> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l152 {padding-left: 0pt; }
 #l152> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l153 {padding-left: 0pt;counter-reset: l1 11; }
 #l153> li>*:first-child:before {counter-increment: l1; content: counter(l1, decimal)" "; color: black; font-style: normal; font-weight: normal; text-decoration: none; }
 #l153> li:first-child>*:first-child:before {counter-increment: l1 0;  }
 #l154 {padding-left: 0pt;counter-reset: l2 1; }
 #l154> li>*:first-child:before {counter-increment: l2; content: counter(l1, decimal)"."counter(l2, decimal)" "; color: black; font-style: normal; font-weight: normal; text-decoration: none; }
 #l154> li:first-child>*:first-child:before {counter-increment: l2 0;  }
 #l155 {padding-left: 0pt; }
 #l155> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l156 {padding-left: 0pt; }
 #l156> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l157 {padding-left: 0pt; }
 #l157> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l158 {padding-left: 0pt; }
 #l158> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l159 {padding-left: 0pt; }
 #l159> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l160 {padding-left: 0pt; }
 #l160> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l161 {padding-left: 0pt; }
 #l161> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l162 {padding-left: 0pt; }
 #l162> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l163 {padding-left: 0pt; }
 #l163> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l164 {padding-left: 0pt; }
 #l164> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l165 {padding-left: 0pt; }
 #l165> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l166 {padding-left: 0pt;counter-reset: x1 1; }
 #l166> li>*:first-child:before {counter-increment: x1; content: counter(x1, decimal)". "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l166> li:first-child>*:first-child:before {counter-increment: x1 0;  }
 li {display: block; }
 #l167 {padding-left: 0pt; }
 #l167> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l168 {padding-left: 0pt;counter-reset: z1 12; }
 #l168> li>*:first-child:before {counter-increment: z1; content: counter(z1, decimal)" "; color: black; font-style: normal; font-weight: normal; text-decoration: none; }
 #l168> li:first-child>*:first-child:before {counter-increment: z1 0;  }
 #l169 {padding-left: 0pt;counter-reset: z2 1; }
 #l169> li>*:first-child:before {counter-increment: z2; content: counter(z1, decimal)"."counter(z2, decimal)" "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l169> li:first-child>*:first-child:before {counter-increment: z2 0;  }
 #l170 {padding-left: 0pt; }
 #l170> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l171 {padding-left: 0pt; }
 #l171> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l172 {padding-left: 0pt;counter-reset: d1 1; }
 #l172> li>*:first-child:before {counter-increment: d1; content: counter(d1, decimal)" "; color: black; font-style: normal; font-weight: normal; text-decoration: none; }
 #l172> li:first-child>*:first-child:before {counter-increment: d1 0;  }
 #l173 {padding-left: 0pt;counter-reset: d2 1; }
 #l173> li>*:first-child:before {counter-increment: d2; content: counter(d1, decimal)"."counter(d2, decimal)" "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l173> li:first-child>*:first-child:before {counter-increment: d2 0;  }
 #l174 {padding-left: 0pt;counter-reset: d3 22; }
 #l174> li>*:first-child:before {counter-increment: d3; content: counter(d3, decimal)" "; color: #277EB3; font-family:Consolas, monospace; font-style: normal; font-weight: normal; text-decoration: none; font-size: 7.5pt; }
 #l174> li:first-child>*:first-child:before {counter-increment: d3 0;  }
 li {display: block; }
 #l175 {padding-left: 0pt;counter-reset: e1 25; }
 #l175> li>*:first-child:before {counter-increment: e1; content: counter(e1, decimal)" "; color: black; font-style: normal; font-weight: normal; text-decoration: none; }
 #l175> li:first-child>*:first-child:before {counter-increment: e1 0;  }
 li {display: block; }
 #l176 {padding-left: 0pt;counter-reset: f1 2; }
 #l176> li>*:first-child:before {counter-increment: f1; content: counter(f1, decimal)" "; color: black; font-style: normal; font-weight: normal; text-decoration: none; }
 #l176> li:first-child>*:first-child:before {counter-increment: f1 0;  }
 #l177 {padding-left: 0pt;counter-reset: f2 1; }
 #l177> li>*:first-child:before {counter-increment: f2; content: counter(f1, decimal)"."counter(f2, decimal)" "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l177> li:first-child>*:first-child:before {counter-increment: f2 0;  }
 li {display: block; }
 #l178 {padding-left: 0pt;counter-reset: g1 3; }
 #l178> li>*:first-child:before {counter-increment: g1; content: counter(g1, decimal)" "; color: black; font-style: normal; font-weight: normal; text-decoration: none; }
 #l178> li:first-child>*:first-child:before {counter-increment: g1 0;  }
 #l179 {padding-left: 0pt;counter-reset: g2 1; }
 #l179> li>*:first-child:before {counter-increment: g2; content: counter(g1, decimal)"."counter(g2, decimal)" "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l179> li:first-child>*:first-child:before {counter-increment: g2 0;  }
 #l180 {padding-left: 0pt; }
 #l180> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 11pt; }
 #l181 {padding-left: 0pt;counter-reset: h1 1; }
 #l181> li>*:first-child:before {counter-increment: h1; content: counter(h1, decimal)". "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l181> li:first-child>*:first-child:before {counter-increment: h1 0;  }
 li {display: block; }
 #l182 {padding-left: 0pt;counter-reset: i1 4; }
 #l182> li>*:first-child:before {counter-increment: i1; content: counter(i1, decimal)" "; color: black; font-style: normal; font-weight: normal; text-decoration: none; }
 #l182> li:first-child>*:first-child:before {counter-increment: i1 0;  }
 #l183 {padding-left: 0pt;counter-reset: i2 1; }
 #l183> li>*:first-child:before {counter-increment: i2; content: counter(i1, decimal)"."counter(i2, decimal)" "; color: black; font-style: normal; font-weight: normal; text-decoration: none; }
 #l183> li:first-child>*:first-child:before {counter-increment: i2 0;  }
 #l184 {padding-left: 0pt; }
 #l184> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l185 {padding-left: 0pt;counter-reset: j1 5; }
 #l185> li>*:first-child:before {counter-increment: j1; content: counter(j1, decimal)" "; color: black; font-style: normal; font-weight: normal; text-decoration: none; }
 #l185> li:first-child>*:first-child:before {counter-increment: j1 0;  }
 #l186 {padding-left: 0pt;counter-reset: j2 1; }
 #l186> li>*:first-child:before {counter-increment: j2; content: counter(j1, decimal)"."counter(j2, decimal)" "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l186> li:first-child>*:first-child:before {counter-increment: j2 0;  }
 li {display: block; }
 #l187 {padding-left: 0pt;counter-reset: k1 6; }
 #l187> li>*:first-child:before {counter-increment: k1; content: counter(k1, decimal)" "; color: black; font-style: normal; font-weight: normal; text-decoration: none; }
 #l187> li:first-child>*:first-child:before {counter-increment: k1 0;  }
 #l188 {padding-left: 0pt;counter-reset: k2 1; }
 #l188> li>*:first-child:before {counter-increment: k2; content: counter(k1, decimal)"."counter(k2, decimal)" "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l188> li:first-child>*:first-child:before {counter-increment: k2 0;  }
 #l189 {padding-left: 0pt; }
 #l189> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l190 {padding-left: 0pt;counter-reset: l1 7; }
 #l190> li>*:first-child:before {counter-increment: l1; content: counter(l1, decimal)" "; color: black; font-style: normal; font-weight: normal; text-decoration: none; }
 #l190> li:first-child>*:first-child:before {counter-increment: l1 0;  }
 #l191 {padding-left: 0pt;counter-reset: l2 1; }
 #l191> li>*:first-child:before {counter-increment: l2; content: counter(l1, decimal)"."counter(l2, decimal)" "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l191> li:first-child>*:first-child:before {counter-increment: l2 0;  }
 #l192 {padding-left: 0pt;counter-reset: m1 1; }
 #l192> li>*:first-child:before {counter-increment: m1; content: counter(m1, decimal)". "; color: black; font-style: normal; font-weight: normal; text-decoration: none; }
 #l192> li:first-child>*:first-child:before {counter-increment: m1 0;  }
 li {display: block; }
 #l193 {padding-left: 0pt;counter-reset: n1 8; }
 #l193> li>*:first-child:before {counter-increment: n1; content: counter(n1, decimal)" "; color: black; font-style: normal; font-weight: normal; text-decoration: none; }
 #l193> li:first-child>*:first-child:before {counter-increment: n1 0;  }
 #l194 {padding-left: 0pt;counter-reset: n2 1; }
 #l194> li>*:first-child:before {counter-increment: n2; content: counter(n1, decimal)"."counter(n2, decimal)" "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l194> li:first-child>*:first-child:before {counter-increment: n2 0;  }
 li {display: block; }
 #l195 {padding-left: 0pt;counter-reset: o1 9; }
 #l195> li>*:first-child:before {counter-increment: o1; content: counter(o1, decimal)" "; color: black; font-style: normal; font-weight: normal; text-decoration: none; }
 #l195> li:first-child>*:first-child:before {counter-increment: o1 0;  }
 #l196 {padding-left: 0pt;counter-reset: o2 1; }
 #l196> li>*:first-child:before {counter-increment: o2; content: counter(o1, decimal)"."counter(o2, decimal)" "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l196> li:first-child>*:first-child:before {counter-increment: o2 0;  }
 #l197 {padding-left: 0pt; }
 #l197> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l198 {padding-left: 0pt; }
 #l198> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l199 {padding-left: 0pt; }
 #l199> li>*:first-child:before {content: "■ "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l200 {padding-left: 0pt; }
 #l200> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l201 {padding-left: 0pt;counter-reset: p1 10; }
 #l201> li>*:first-child:before {counter-increment: p1; content: counter(p1, decimal)" "; color: black; font-style: normal; font-weight: normal; text-decoration: none; }
 #l201> li:first-child>*:first-child:before {counter-increment: p1 0;  }
 #l202 {padding-left: 0pt;counter-reset: p2 1; }
 #l202> li>*:first-child:before {counter-increment: p2; content: counter(p1, decimal)"."counter(p2, decimal)" "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l202> li:first-child>*:first-child:before {counter-increment: p2 0;  }
 #l203 {padding-left: 0pt; }
 #l203> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l204 {padding-left: 0pt;counter-reset: q1 11; }
 #l204> li>*:first-child:before {counter-increment: q1; content: counter(q1, decimal)" "; color: black; font-style: normal; font-weight: normal; text-decoration: none; }
 #l204> li:first-child>*:first-child:before {counter-increment: q1 0;  }
 #l205 {padding-left: 0pt;counter-reset: q2 1; }
 #l205> li>*:first-child:before {counter-increment: q2; content: counter(q1, decimal)"."counter(q2, decimal)" "; color: black; font-style: normal; font-weight: normal; text-decoration: none; }
 #l205> li:first-child>*:first-child:before {counter-increment: q2 0;  }
 li {display: block; }
 #l206 {padding-left: 0pt;counter-reset: r1 12; }
 #l206> li>*:first-child:before {counter-increment: r1; content: counter(r1, decimal)" "; color: black; font-style: normal; font-weight: normal; text-decoration: none; }
 #l206> li:first-child>*:first-child:before {counter-increment: r1 0;  }
 #l207 {padding-left: 0pt;counter-reset: r2 1; }
 #l207> li>*:first-child:before {counter-increment: r2; content: counter(r1, decimal)"."counter(r2, decimal)" "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l207> li:first-child>*:first-child:before {counter-increment: r2 0;  }
 #l208 {padding-left: 0pt; }
 #l208> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l209 {padding-left: 0pt; }
 #l209> li>*:first-child:before {content: "■ "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l210 {padding-left: 0pt; }
 #l210> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l211 {padding-left: 0pt; }
 #l211> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: italic; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l212 {padding-left: 0pt; }
 #l212> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: italic; font-weight: normal; text-decoration: none; font-size: 9pt; }
 li {display: block; }
 #l213 {padding-left: 0pt;counter-reset: w1 5; }
 #l213> li>*:first-child:before {counter-increment: w1; content: counter(w1, lower-roman)"- "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 8pt; }
 #l213> li:first-child>*:first-child:before {counter-increment: w1 0;  }
 #l214 {padding-left: 0pt; }
 #l214> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l215 {padding-left: 0pt; }
 #l215> li>*:first-child:before {content: "• "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l216 {padding-left: 0pt;counter-reset: w2 1; }
 #l216> li>*:first-child:before {counter-increment: w2; content: counter(w2, decimal)". "; color: black; font-family:"Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; }
 #l216> li:first-child>*:first-child:before {counter-increment: w2 0;  }
 table, tbody {vertical-align: top; overflow: visible; }
</style></head><body><p style="padding-top: 3pt;text-indent: 0pt;text-align: right;"><a name="bookmark0"><span class="s1" style=" background-color: #000;">&lt;packt&gt; </span></a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 5pt;text-indent: 0pt;text-align: left;"><span><img width="642" height="296" alt="image" src="Image_001.jpg"/></span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><h1 style="text-indent: 0pt;line-height: 35pt;text-align: right;">Mastering JavaScript</h1><h1 style="padding-top: 9pt;text-indent: 0pt;text-align: right;">Functional Programming</h1><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s2" style="padding-left: 82pt;text-indent: -41pt;line-height: 20pt;text-align: left;"><span>Write clean, robust, and maintainable web and server<br/>code using functional JavaScript and TypeScript</span></p><p style="padding-left: 80pt;text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s3" style="padding-left: 14pt;text-indent: 0pt;line-height: 20pt;text-align: left;">FEDERICO KEREKI</p><p style="padding-left: 304pt;text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-top: 13pt;padding-left: 44pt;text-indent: 0pt;line-height: 109%;text-align: left;"><a name="bookmark1"><span>Mastering JavaScript<br/>Functional Programming</span></a></h2><p class="s4" style="padding-top: 7pt;padding-left: 44pt;text-indent: 0pt;text-align: left;">Third Edition</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s5" style="padding-left: 44pt;text-indent: 0pt;line-height: 115%;text-align: left;"><span>Write clean, robust, and maintainable web and server code<br/>using functional JavaScript and TypeScript</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-left: 44pt;text-indent: 0pt;text-align: left;">Federico Kereki</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s7" style="padding-left: 43pt;text-indent: 0pt;text-align: left;">&lt;packt&gt;</p><p style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;text-align: left;">BIRMINGHAM—MUMBAI</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-top: 5pt;padding-left: 53pt;text-indent: 0pt;text-align: left;"><a name="bookmark2">Mastering JavaScript Functional Programming</a></p><p class="s8" style="padding-top: 3pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">Third Edition</p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">Copyright © 2023 Packt Publishing</p><p class="s9" style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;text-align: justify;">All rights reserved. <span class="p">No part of this book may be reproduced, stored in a retrieval system, or transmitted in<br/>any form or by any means, without the prior written permission of the publisher, except in the case of brief<br/>quotations embedded in critical articles or reviews.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;text-align: justify;"><span>Every effort has been made in the preparation of this book to ensure the accuracy of the information<br/>presented. However, the information contained in this book is sold without warranty, either express or<br/>implied. Neither the author, nor Packt Publishing or its dealers and distributors, will be held liable for any<br/>damages caused or alleged to have been caused directly or indirectly by this book.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;text-align: justify;"><span>Packt Publishing has endeavored to provide trademark information about all of the companies and products<br/>mentioned in this book by the appropriate use of capitals. However, Packt Publishing cannot guarantee<br/>the accuracy of this information.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 52pt;text-indent: 0pt;line-height: 137%;text-align: left;">Group Product Manager: <span class="p">Pavan Ramchandani<br/></span>Publishing Product Manager: <span class="p">Bhavya Rao<br/></span>Senior Editor: <span class="p">Mark D’Souza</span></p><p class="s10" style="padding-left: 52pt;text-indent: 0pt;line-height: 10pt;text-align: left;">Technical Editor: <span class="p">Joseph Aloocaran</span></p><p class="s10" style="padding-top: 3pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">Copy Editor: <span class="p">Safis Editing</span></p><p class="s10" style="padding-top: 3pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">Project Coordinator: <span class="p">Sonam Pandey</span></p><p class="s10" style="padding-top: 3pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">Proofreader: <span class="p">Safis Editing</span></p><p class="s10" style="padding-top: 3pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">Indexer: <span class="p">Rekha Nair</span></p><p class="s10" style="padding-top: 3pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">Production Designer: <span class="p">Shyam Sundar Korumilli</span></p><p class="s10" style="padding-top: 3pt;padding-left: 52pt;text-indent: 0pt;line-height: 223%;text-align: left;">Marketing Coordinators: <span class="p">Namita Velgekar, Nivedita Pandey, and Anamika Singh<br/>First published: November 2017</span></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 224%;text-align: left;"><span>Second edition: January 2020<br/>Third edition: May 2023<br/>Production reference: 1040423</span></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 135%;text-align: left;"><span>Published by Packt Publishing Ltd.<br/>Livery Place</span></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 137%;text-align: left;"><span>35 Livery Street<br/>Birmingham</span></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 10pt;text-align: justify;">B3 2PB, UK.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">ISBN 978-1-80461-013-8</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;"><a href="http://www.packtpub.com/" class="s11">www.packtpub.com</a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s9" style="padding-left: 44pt;text-indent: 0pt;line-height: 115%;text-align: center;"><span>Writing a book involves many people, and even if I cannot mention and name all of them, there are some<br/>who really deserve to be highlighted.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s9" style="padding-top: 8pt;padding-left: 43pt;text-indent: 0pt;line-height: 115%;text-align: justify;"><span>At Packt Publishing, I want to thank Larissa Pinto, senior acquisition editor, for proposing the theme for<br/>this book and helping me get started with it. Thanks must also go to Mohammed Yusuf Imaratwale, content<br/>development editor, and Ralph Rosario, technical editor, for their help in giving shape to the book and<br/>making  it clearer and better structured. I also want to send my appreciation to the reviewers, Geronimo<br/>Garcia Sgritta and Steve Perkins, who went through the initial draft, enhancing it with their comments.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s9" style="padding-top: 8pt;padding-left: 41pt;text-indent: 2pt;line-height: 115%;text-align: justify;"><span>There are some other people who deserve extra consideration. This book was written under unusual<br/>circumstances, around 10,000 miles away from home! I had gone from Uruguay, where I live, to work<br/>on     a project in India, and that’s where I wrote every single page of the text. This would not have been<br/>possible if I hadn’t had complete support from my family, who stayed in Montevideo, but who were<br/>constantly nearby, thanks to the internet and modern communication. In particular, I must single out<br/>my  wife, Sylvia Tosar, not only for supporting and aiding me both with the project and the book but also<br/>for dealing with everything and the rest of the family on her own in Uruguay—this book wouldn’t have</span></p><p class="s9" style="padding-left: 86pt;text-indent: 0pt;line-height: 10pt;text-align: justify;">been possible otherwise, and she is the greatest reason the book could be written!</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s9" style="padding-top: 8pt;padding-left: 57pt;text-indent: 0pt;text-align: left;">For the second edition: Revisiting and expanding a book for a second edition was an interesting task.</p><p class="s9" style="padding-top: 1pt;padding-left: 49pt;text-indent: 0pt;line-height: 115%;text-align: center;"><span>I had great support and must thank Aamir Ahmed, content development editor; Jane D’Souza, technical<br/>editor; and Crystian Bietti and Steve Perkins (again, for double merit!), the reviewers who helped produce<br/>a much better text.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s9" style="padding-top: 5pt;padding-left: 51pt;text-indent: 0pt;line-height: 115%;text-align: center;"><span>For the third edition: Expanding the book for a third edition was, once more, a challenging task. In this<br/>case, I had support from Bhavya Rao, publishing product manager; Mark D’Souza, senior editor; Joseph<br/>Aloocaran, technical editor; and Anu Nagan and Markandey Pathak, reviewers, all of whom greatly<br/>aided   my work, aiming for an even higher quality final text.</span></p><p class="s9" style="padding-top: 8pt;padding-left: 44pt;text-indent: 0pt;text-align: center;">- Federico Kereki</p><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-top: 5pt;padding-left: 305pt;text-indent: 0pt;text-align: left;"><a name="bookmark3">Contributors</a></h2><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-top: 5pt;padding-left: 52pt;text-indent: 0pt;text-align: justify;"><a name="bookmark4">About the author</a></p><p class="s10" style="padding-top: 9pt;padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: justify;">Federico Kereki <span class="p">is a Uruguayan systems engineer, with a masters degree in education, and over<br/>30 years of experience as a consultant, system developer, and writer.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>He is currently a subject matter expert at Globant, where he gets to use a good mixture of development<br/>frameworks, programming tools, and operating systems. He is familiar with languages such as JavaScript<br/>and TypeScript; modern backend runtime environments such as Node.js and Deno; frontend frameworks<br/>such as React, Vue, and Angular; and services, microservices, and cloud components for systems<br/>architecture.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: justify;"><span>He has taught several computer science courses at Universidad de la Republica, Universidad ORT<br/>Uruguay, and Universidad de la Empresa. He has also written texts for these courses.</span></p><p style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>He has written articles and booklets on programming, web development, security, and open source<br/>topics for blogs, magazines, and websites. He has also written several books, including </span><i>Modern JavaScript</i>and the upcoming <i>Data Structures and Algorithms in JavaScript.</i></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Kereki has given talks on functional programming at public conferences (such as JSCONF 2016 and<br/>Development Week Santiago 2019) and has used functional programming techniques to develop<br/>internet systems for businesses in Uruguay and abroad.</span></p><p style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>His current interests tend toward software quality and software engineering - with Agile methodologies<br/>topmost - while on the practical side, he works with diverse languages, tools, and frameworks, and<br/></span><b>Free/Libre Open Source Software (FLOSS) </b>wherever possible!</p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>He resides, works, and teaches in Uruguay, but he wrote the first edition of this book while working<br/>in India, and the second edition during a sojourn in Mexico; the third edition was the first actually<br/>completed in his homeland!</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-top: 5pt;padding-left: 43pt;text-indent: 0pt;text-align: justify;"><a name="bookmark5">About the reviewers</a></p><p class="s10" style="padding-top: 9pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;">Markandey Pathak <span class="p">is an accomplished full-stack developer and software architect with over 11 years<br/>of experience. Currently, he works as an expert engineer and vice president with one of the biggest<br/>financial firms. He has also worked with top firms such as Deloitte, PwC, and Sapient in the past.<br/>In addition to his technical work, Markandey is also passionate about teaching coding to kids and<br/>playing with robots in his spare time. He is an avid traveler and enjoys spending time in nature and<br/>exploring new destinations with his wife and son whenever possible. Markandey s diverse interests<br/>and impressive professional experience make him a well-rounded and highly respected member of<br/>the software engineering community.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><b>Anu Nagan G </b>has worked in various corporate organizations, from a SaaS start-up <i>(Gendeep) </i><span>to<br/>a mid-size organization (GAVS) and a Fortune 500 company </span><i>(DXC). </i><span>He has held various positions such<br/>as technical product manager, full-stack product lead (Angular, Java, Python, and AWS), and delivery<br/>lead in his 9+ years of tenure. He has experience in leading advanced AI and analytics product Cortex<br/>AI (API automation), Salesforce CRM B2B automation, and mobile app development, and contributed<br/>to various AIOps products such as ZIF, Gcare, and Gavel in the past. Currently, he is leading parallel<br/>projects with Bounteous, which include data integration with the Braze marketing platform with<br/>a custom middleware and digital experience transformation for Fintech customers using AEM. He<br/>is an avid reader and cinephile who loves to play the guitar and make short films with his friends.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s9" style="padding-left: 204pt;text-indent: -160pt;line-height: 118%;text-align: left;"><span>I would like to thank my wife, Hema, and my daughter, Chekhov, for always giving me the freedom to<br/>pursue my interests.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><h3 style="padding-top: 4pt;padding-left: 111pt;text-indent: 0pt;text-align: left;"><a name="bookmark6">Table of Contents</a></h3><p class="s12" style="padding-top: 22pt;padding-left: 44pt;text-indent: 0pt;text-align: left;">Preface<span class="s13">                                       </span>xiii</p><p style="text-indent: 0pt;text-align: left;"/><p class="s12" style="padding-top: 49pt;padding-left: 44pt;text-indent: 0pt;text-align: left;">Becoming Functional - Several Questions<span class="s13">                  </span>1</p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;text-align: left;"><a href="#bookmark54" class="s14">What is functional programming?   1</a></p><p style="padding-top: 3pt;padding-left: 43pt;text-indent: 0pt;text-align: left;"><a href="#bookmark55" class="a">Theory versus practice</a><a href="#bookmark55" class="s15">             </a><a href="#bookmark55">2</a></p><p style="padding-top: 2pt;padding-left: 43pt;text-indent: 0pt;text-align: left;"><a href="#bookmark56" class="a">A different way of thinking</a><a href="#bookmark56" class="s15">           </a><a href="#bookmark56">2</a></p><p style="padding-top: 2pt;padding-left: 43pt;text-indent: 0pt;text-align: left;"><a href="#bookmark57" class="a">FP and other programming paradigms</a><a href="#bookmark57" class="s15">     </a><a href="#bookmark57">3</a></p><p style="padding-top: 2pt;padding-left: 43pt;text-indent: 0pt;text-align: left;"><a href="#bookmark58" class="a">What FP is not</a><a href="#bookmark58" class="s15">                 </a><a href="#bookmark58">4</a></p><p style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;text-align: left;"><a href="#bookmark59" class="s14">Why use FP?              5</a></p><p style="padding-top: 3pt;padding-left: 43pt;text-indent: 0pt;text-align: left;"><a href="#bookmark60" class="a">What we need</a><a href="#bookmark60" class="s15">                 </a><a href="#bookmark60">5</a></p><p style="padding-top: 2pt;padding-left: 43pt;text-indent: 0pt;text-align: left;"><a href="#bookmark61" class="a">What we get</a><a href="#bookmark61" class="s15">                  </a><a href="#bookmark61">6</a></p><p style="padding-top: 2pt;padding-left: 43pt;text-indent: 0pt;text-align: left;"><a href="#bookmark62" class="a">Not all is gold</a><a href="#bookmark62" class="s15">                 </a><a href="#bookmark62">6</a></p><p style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;text-align: left;"><a href="#bookmark63" class="s14">Is JavaScript functional?        7</a></p><p style="padding-top: 3pt;padding-left: 43pt;text-indent: 0pt;text-align: left;"><a href="#bookmark64" class="a">JavaScript as a tool</a><a href="#bookmark64" class="s15">               </a><a href="#bookmark64">7</a></p><p class="s16" style="padding-top: 10pt;padding-left: 44pt;text-indent: 0pt;text-align: left;">2</p><p style="padding-top: 8pt;padding-left: 20pt;text-indent: 0pt;text-align: left;"><a href="#bookmark65" class="a">Going functional with JavaScript</a><a href="#bookmark65" class="s15">        </a><a href="#bookmark65">8</a></p><p style="padding-top: 2pt;padding-left: 20pt;text-indent: 0pt;text-align: left;"><a href="#bookmark66" class="a">Key features of JavaScript</a><a href="#bookmark66" class="s15">            </a><a href="#bookmark66">9</a></p><p style="padding-top: 6pt;padding-left: 20pt;text-indent: 0pt;text-align: left;"><a href="#bookmark67" class="s14">How do we work with JavaScript?  15</a></p><p style="padding-top: 3pt;padding-left: 20pt;text-indent: 0pt;text-align: left;"><a href="#bookmark68" class="a">Using transpilers</a><a href="#bookmark68" class="s15">               </a><a href="#bookmark68">17</a></p><p style="padding-top: 2pt;padding-left: 20pt;text-indent: 0pt;text-align: left;"><a href="#bookmark69" class="a">Working online</a><a href="#bookmark69" class="s15">                </a><a href="#bookmark69">19</a></p><p style="padding-top: 2pt;padding-left: 20pt;text-indent: 0pt;text-align: left;"><a href="#bookmark70" class="a">A step further - TypeScript</a><a href="#bookmark70" class="s15">          </a><a href="#bookmark70">19</a></p><p style="padding-top: 2pt;padding-left: 20pt;text-indent: 0pt;text-align: left;"><a href="#bookmark71" class="a">Testing</a><a href="#bookmark71" class="s15">                    </a><a href="#bookmark71">22</a></p><p style="padding-top: 6pt;padding-left: 20pt;text-indent: 0pt;text-align: left;"><a href="#bookmark72" class="s14">Summary               22</a></p><p style="padding-top: 3pt;padding-left: 20pt;text-indent: 0pt;text-align: left;"><a href="#bookmark73" class="s14">Questions               22</a></p><p class="s12" style="padding-top: 13pt;padding-left: 43pt;text-indent: 0pt;text-align: left;">Thinking Functionally - A First Example<span class="s13">                  </span>25</p><p class="s17" style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;text-align: left;">Our problem - doing something        A functional solution to our problem 31</p><p class="s17" style="padding-left: 43pt;text-indent: 0pt;text-align: left;">only once                25</p><p style="padding-top: 3pt;padding-left: 43pt;text-indent: 0pt;text-align: left;"><a href="#bookmark96" class="a">Solution 1 - hoping for the best!</a><a href="#bookmark96" class="s15">        </a><a href="#bookmark96">26</a></p><p style="padding-top: 2pt;padding-left: 43pt;text-indent: 0pt;text-align: left;"><a href="#bookmark97" class="a">Solution 2 - using a global flag</a><a href="#bookmark97" class="s15">         </a><a href="#bookmark97">27</a></p><p style="padding-top: 2pt;padding-left: 43pt;text-indent: 0pt;text-align: left;"><a href="#bookmark98" class="a">Solution 3 - removing the handler</a><a href="#bookmark98" class="s15">       </a><a href="#bookmark98">28</a></p><p style="padding-top: 2pt;padding-left: 43pt;text-indent: 0pt;text-align: left;"><a href="#bookmark99" class="a">Solution 4 - changing the handler</a><a href="#bookmark99" class="s15">        </a><a href="#bookmark99">29</a></p><p style="padding-top: 2pt;padding-left: 43pt;text-indent: 0pt;text-align: left;"><a href="#bookmark100" class="a">Solution 5 - disabling the button</a><a href="#bookmark100" class="s15">        </a><a href="#bookmark100">29</a></p><p style="padding-top: 2pt;padding-left: 43pt;text-indent: 0pt;text-align: left;"><a href="#bookmark101" class="a">Solution 6 - redefining the handler</a><a href="#bookmark101" class="s15">       </a><a href="#bookmark101">30</a></p><p style="padding-top: 2pt;padding-left: 43pt;text-indent: 0pt;text-align: left;"><a href="#bookmark102" class="a">Solution 7 - using a local flag</a><a href="#bookmark102" class="s15">          </a><a href="#bookmark102">30</a></p><p style="padding-top: 3pt;padding-left: 15pt;text-indent: 0pt;text-align: left;"><a href="#bookmark103" class="a">A higher-order solution</a><a href="#bookmark103" class="s15">            </a><a href="#bookmark103">32</a></p><p style="padding-top: 2pt;padding-left: 15pt;text-indent: 0pt;text-align: left;"><a href="#bookmark104" class="a">Testing the solution manually</a><a href="#bookmark104" class="s15">         </a><a href="#bookmark104">35</a></p><p style="padding-top: 2pt;padding-left: 15pt;text-indent: 0pt;text-align: left;"><a href="#bookmark105" class="a">Testing the solution automatically</a><a href="#bookmark105" class="s15">       </a><a href="#bookmark105">35</a></p><p style="padding-top: 2pt;padding-left: 15pt;text-indent: 0pt;text-align: left;"><a href="#bookmark106" class="a">Producing an even better solution</a><a href="#bookmark106" class="s15">       </a><a href="#bookmark106">37</a></p><p style="padding-top: 6pt;padding-left: 15pt;text-indent: 0pt;text-align: left;"><a href="#bookmark107" class="s14">Summary               39</a></p><p style="padding-top: 3pt;padding-left: 15pt;text-indent: 0pt;text-align: left;"><a href="#bookmark108" class="s14">Questions               40</a></p><p style="padding-top: 24pt;padding-left: 23pt;text-indent: 0pt;text-align: left;">viii  Table of Contents</p><p class="s16" style="padding-top: 22pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">3</p><p style="text-indent: 0pt;text-align: left;"><br/></p><table style="border-collapse:collapse;margin-left:50.38pt" cellspacing="0"><tr style="height:18pt"><td style="width:167pt;border-bottom-style:solid;border-bottom-width:1pt"><p class="s18" style="padding-left: 2pt;text-indent: 0pt;text-align: left;">Starting Out with Functions -</p></td><td style="width:195pt;border-bottom-style:solid;border-bottom-width:1pt" colspan="2"><p class="s18" style="padding-left: 2pt;text-indent: 0pt;text-align: left;">A Core Concept</p></td><td style="width:38pt;border-bottom-style:solid;border-bottom-width:1pt"><p class="s18" style="padding-right: 4pt;text-indent: 0pt;text-align: right;">41</p></td></tr><tr style="height:20pt"><td style="width:167pt;border-top-style:solid;border-top-width:1pt"><p class="s19" style="padding-top: 5pt;padding-left: 2pt;text-indent: 0pt;line-height: 12pt;text-align: left;">All about functions</p></td><td style="width:38pt;border-top-style:solid;border-top-width:1pt"><p class="s19" style="padding-top: 5pt;padding-right: 14pt;text-indent: 0pt;line-height: 12pt;text-align: right;">41</p></td><td style="width:157pt;border-top-style:solid;border-top-width:1pt"><p class="s20" style="padding-top: 6pt;padding-left: 3pt;text-indent: 0pt;text-align: left;">Callbacks and promises</p></td><td style="width:38pt;border-top-style:solid;border-top-width:1pt"><p class="s20" style="padding-top: 6pt;padding-right: 2pt;text-indent: 0pt;text-align: right;">60</p></td></tr><tr style="height:15pt"><td style="width:167pt"><p class="s20" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;line-height: 10pt;text-align: left;">Of lambdas and functions</p></td><td style="width:38pt"><p class="s20" style="padding-top: 3pt;padding-right: 13pt;text-indent: 0pt;line-height: 10pt;text-align: right;">42</p></td><td style="width:157pt"><p class="s20" style="padding-left: 3pt;text-indent: 0pt;text-align: left;">Continuation-passing style</p></td><td style="width:38pt"><p class="s20" style="padding-right: 2pt;text-indent: 0pt;text-align: right;">61</p></td></tr><tr style="height:14pt"><td style="width:167pt"><p class="s20" style="padding-top: 2pt;padding-left: 1pt;text-indent: 0pt;line-height: 10pt;text-align: left;">Arrow functions - the modern way</p></td><td style="width:38pt"><p class="s20" style="padding-top: 2pt;padding-right: 14pt;text-indent: 0pt;line-height: 10pt;text-align: right;">45</p></td><td style="width:157pt"><p class="s20" style="padding-left: 3pt;text-indent: 0pt;line-height: 11pt;text-align: left;">Polyfills</p></td><td style="width:38pt"><p class="s20" style="padding-right: 2pt;text-indent: 0pt;line-height: 11pt;text-align: right;">62</p></td></tr><tr style="height:14pt"><td style="width:167pt"><p class="s20" style="padding-top: 2pt;padding-left: 2pt;text-indent: 0pt;line-height: 10pt;text-align: left;">Functions as objects</p></td><td style="width:38pt"><p class="s20" style="padding-top: 2pt;padding-right: 13pt;text-indent: 0pt;line-height: 10pt;text-align: right;">50</p></td><td style="width:157pt"><p class="s20" style="padding-left: 3pt;text-indent: 0pt;line-height: 11pt;text-align: left;">Stubbing</p></td><td style="width:38pt"><p class="s20" style="padding-right: 2pt;text-indent: 0pt;line-height: 11pt;text-align: right;">66</p></td></tr><tr style="height:19pt"><td style="width:167pt"><p class="s19" style="padding-top: 6pt;padding-left: 2pt;text-indent: 0pt;line-height: 11pt;text-align: left;">Using functions in FP ways</p></td><td style="width:38pt"><p class="s19" style="padding-top: 6pt;padding-right: 13pt;text-indent: 0pt;line-height: 11pt;text-align: right;">56</p></td><td style="width:157pt"><p class="s20" style="padding-left: 3pt;text-indent: 0pt;line-height: 11pt;text-align: left;">Immediate invocation (IIFE)</p></td><td style="width:38pt"><p class="s20" style="padding-right: 1pt;text-indent: 0pt;text-align: right;">67</p></td></tr><tr style="height:16pt"><td style="width:167pt"><p class="s20" style="padding-top: 4pt;padding-left: 2pt;text-indent: 0pt;line-height: 10pt;text-align: left;">Injection - sorting it out</p></td><td style="width:38pt"><p class="s20" style="padding-top: 5pt;padding-right: 13pt;text-indent: 0pt;line-height: 10pt;text-align: right;">56</p></td><td style="width:157pt"><p class="s19" style="padding-left: 3pt;text-indent: 0pt;line-height: 12pt;text-align: left;">Summary</p></td><td style="width:38pt"><p class="s19" style="text-indent: 0pt;line-height: 12pt;text-align: right;">70</p></td></tr><tr style="height:21pt"><td style="width:167pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:38pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:157pt"><p class="s19" style="padding-left: 3pt;text-indent: 0pt;line-height: 12pt;text-align: left;">Questions</p></td><td style="width:38pt"><p class="s19" style="padding-right: 1pt;text-indent: 0pt;line-height: 12pt;text-align: right;">71</p></td></tr><tr style="height:36pt"><td style="width:167pt"><p class="s21" style="padding-top: 8pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">4</p></td><td style="width:38pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:157pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:38pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:25pt"><td style="width:205pt;border-bottom-style:solid;border-bottom-width:1pt" colspan="2"><p class="s18" style="padding-top: 6pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Behaving Properly - Pure Functions</p></td><td style="width:157pt;border-bottom-style:solid;border-bottom-width:1pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:38pt;border-bottom-style:solid;border-bottom-width:1pt"><p class="s18" style="padding-top: 6pt;padding-right: 2pt;text-indent: 0pt;text-align: right;">73</p></td></tr><tr style="height:21pt"><td style="width:167pt;border-top-style:solid;border-top-width:1pt"><p class="s19" style="padding-top: 5pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Pure functions</p></td><td style="width:38pt;border-top-style:solid;border-top-width:1pt"><p class="s19" style="padding-top: 6pt;padding-right: 13pt;text-indent: 0pt;text-align: right;">73</p></td><td style="width:157pt;border-top-style:solid;border-top-width:1pt"><p class="s19" style="padding-top: 5pt;padding-left: 3pt;text-indent: 0pt;text-align: left;">Testing - pure versus impure</p></td><td style="width:38pt;border-top-style:solid;border-top-width:1pt"><p class="s19" style="padding-top: 5pt;padding-right: 1pt;text-indent: 0pt;text-align: right;">97</p></td></tr><tr style="height:15pt"><td style="width:167pt"><p class="s20" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Referential transparency</p></td><td style="width:38pt"><p class="s20" style="padding-top: 1pt;padding-right: 13pt;text-indent: 0pt;text-align: right;">74</p></td><td style="width:157pt"><p class="s20" style="padding-top: 1pt;padding-left: 3pt;text-indent: 0pt;text-align: left;">Testing pure functions</p></td><td style="width:38pt"><p class="s20" style="padding-top: 1pt;padding-right: 1pt;text-indent: 0pt;text-align: right;">97</p></td></tr><tr style="height:14pt"><td style="width:167pt"><p class="s20" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Side effects</p></td><td style="width:38pt"><p class="s20" style="padding-top: 1pt;padding-right: 13pt;text-indent: 0pt;text-align: right;">76</p></td><td style="width:157pt"><p class="s20" style="padding-top: 1pt;padding-left: 3pt;text-indent: 0pt;text-align: left;">Testing purified functions</p></td><td style="width:38pt"><p class="s20" style="padding-top: 1pt;padding-right: 2pt;text-indent: 0pt;text-align: right;">99</p></td></tr><tr style="height:16pt"><td style="width:167pt"><p class="s20" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Advantages of pure functions</p></td><td style="width:38pt"><p class="s20" style="padding-top: 1pt;padding-right: 13pt;text-indent: 0pt;text-align: right;">83</p></td><td style="width:157pt"><p class="s20" style="padding-top: 1pt;padding-left: 3pt;text-indent: 0pt;text-align: left;">Testing impure functions</p></td><td style="width:38pt"><p class="s20" style="padding-top: 1pt;padding-right: 2pt;text-indent: 0pt;text-align: right;">103</p></td></tr><tr style="height:18pt"><td style="width:167pt"><p class="s19" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Impure functions</p></td><td style="width:38pt"><p class="s19" style="padding-top: 3pt;padding-right: 13pt;text-indent: 0pt;text-align: right;">88</p></td><td style="width:157pt"><p class="s19" style="padding-top: 2pt;padding-left: 3pt;text-indent: 0pt;text-align: left;">Summary</p></td><td style="width:38pt"><p class="s19" style="padding-top: 3pt;padding-right: 2pt;text-indent: 0pt;text-align: right;">107</p></td></tr><tr style="height:15pt"><td style="width:167pt"><p class="s20" style="padding-top: 2pt;padding-left: 1pt;text-indent: 0pt;text-align: left;">Avoiding impure functions</p></td><td style="width:38pt"><p class="s20" style="padding-top: 2pt;padding-right: 13pt;text-indent: 0pt;text-align: right;">89</p></td><td style="width:157pt"><p class="s19" style="padding-top: 1pt;padding-left: 3pt;text-indent: 0pt;line-height: 12pt;text-align: left;">Questions</p></td><td style="width:38pt"><p class="s19" style="padding-top: 1pt;padding-right: 1pt;text-indent: 0pt;line-height: 12pt;text-align: right;">107</p></td></tr><tr style="height:37pt"><td style="width:167pt"><p class="s20" style="padding-left: 2pt;text-indent: 0pt;text-align: left;">Is your function pure?</p></td><td style="width:38pt"><p class="s20" style="padding-right: 14pt;text-indent: 0pt;text-align: right;">95</p></td><td style="width:157pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:38pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:43pt"><td style="width:167pt;border-bottom-style:solid;border-bottom-width:1pt"><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s18" style="padding-left: 2pt;text-indent: 0pt;text-align: left;">Programming Declaratively -</p></td><td style="width:195pt;border-bottom-style:solid;border-bottom-width:1pt" colspan="2"><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s18" style="text-indent: 0pt;text-align: left;">A Better Style</p></td><td style="width:38pt;border-bottom-style:solid;border-bottom-width:1pt"><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s18" style="padding-right: 4pt;text-indent: 0pt;text-align: right;">111</p></td></tr><tr style="height:21pt"><td style="width:167pt;border-top-style:solid;border-top-width:1pt"><p class="s19" style="padding-top: 6pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Transformations</p></td><td style="width:38pt;border-top-style:solid;border-top-width:1pt"><p class="s19" style="padding-top: 5pt;padding-right: 13pt;text-indent: 0pt;text-align: right;">112</p></td><td style="width:157pt;border-top-style:solid;border-top-width:1pt"><p class="s20" style="padding-top: 6pt;padding-left: 3pt;text-indent: 0pt;text-align: left;">Checking negatives - none()</p></td><td style="width:38pt;border-top-style:solid;border-top-width:1pt"><p class="s20" style="padding-top: 6pt;padding-right: 1pt;text-indent: 0pt;text-align: right;">144</p></td></tr><tr style="height:16pt"><td style="width:167pt"><p class="s20" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Reducing an array to a value</p></td><td style="width:38pt"><p class="s20" style="padding-top: 1pt;padding-right: 13pt;text-indent: 0pt;text-align: right;">112</p></td><td style="width:157pt"><p class="s19" style="padding-top: 3pt;padding-left: 3pt;text-indent: 0pt;line-height: 11pt;text-align: left;">Working with async functions</p></td><td style="width:38pt"><p class="s19" style="padding-top: 3pt;padding-right: 2pt;text-indent: 0pt;line-height: 11pt;text-align: right;">145</p></td></tr><tr style="height:12pt"><td style="width:167pt"><p class="s20" style="padding-left: 1pt;text-indent: 0pt;line-height: 11pt;text-align: left;">Applying an operation - map()</p></td><td style="width:38pt"><p class="s20" style="padding-right: 13pt;text-indent: 0pt;line-height: 11pt;text-align: right;">120</p></td><td style="width:157pt" rowspan="2"><p class="s20" style="padding-top: 4pt;padding-left: 3pt;text-indent: 0pt;text-align: left;">Some strange behaviors</p></td><td style="width:38pt" rowspan="2"><p class="s20" style="padding-top: 4pt;padding-left: 22pt;text-indent: 0pt;text-align: left;">146</p></td></tr><tr style="height:5pt"><td style="width:167pt" rowspan="2"><p class="s20" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Dealing with arrays of arrays</p></td><td style="width:38pt" rowspan="2"><p class="s20" style="padding-top: 1pt;padding-left: 11pt;text-indent: 0pt;text-align: left;">127</p></td></tr><tr style="height:9pt"><td style="width:157pt" rowspan="2"><p class="s20" style="padding-top: 1pt;padding-left: 3pt;text-indent: 0pt;text-align: left;">Async-ready looping</p></td><td style="width:38pt" rowspan="2"><p class="s20" style="padding-top: 1pt;padding-left: 22pt;text-indent: 0pt;text-align: left;">148</p></td></tr><tr style="height:12pt"><td style="width:167pt"><p class="s20" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;line-height: 9pt;text-align: left;">More general looping</p></td><td style="width:38pt"><p class="s20" style="padding-top: 1pt;padding-right: 13pt;text-indent: 0pt;line-height: 9pt;text-align: right;">135</p></td></tr><tr style="height:14pt"><td style="width:167pt" rowspan="2"><p class="s19" style="padding-top: 7pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Logical HOFs</p></td><td style="width:38pt" rowspan="2"><p class="s19" style="padding-top: 7pt;padding-left: 8pt;text-indent: 0pt;text-align: left;">137</p></td><td style="width:157pt"><p class="s19" style="padding-left: 3pt;text-indent: 0pt;line-height: 12pt;text-align: left;">Working with parallel functions</p></td><td style="width:38pt"><p class="s19" style="padding-right: 2pt;text-indent: 0pt;line-height: 12pt;text-align: right;">153</p></td></tr><tr style="height:9pt"><td style="width:157pt" rowspan="2"><p class="s20" style="padding-top: 1pt;padding-left: 3pt;text-indent: 0pt;text-align: left;">Unresponsive pages</p></td><td style="width:38pt" rowspan="2"><p class="s20" style="padding-top: 1pt;padding-left: 22pt;text-indent: 0pt;text-align: left;">153</p></td></tr><tr style="height:6pt"><td style="width:167pt" rowspan="2"><p class="s20" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Filtering an array</p></td><td style="width:38pt" rowspan="2"><p class="s20" style="padding-top: 1pt;padding-left: 11pt;text-indent: 0pt;text-align: left;">137</p></td></tr><tr style="height:9pt"><td style="width:157pt" rowspan="2"><p class="s20" style="padding-top: 1pt;padding-left: 3pt;text-indent: 0pt;text-align: left;">A frontend worker</p></td><td style="width:38pt" rowspan="2"><p class="s20" style="padding-top: 1pt;padding-left: 22pt;text-indent: 0pt;text-align: left;">156</p></td></tr><tr style="height:5pt"><td style="width:167pt" rowspan="2"><p class="s20" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Searching an array</p></td><td style="width:38pt" rowspan="2"><p class="s20" style="padding-top: 1pt;padding-left: 11pt;text-indent: 0pt;text-align: left;">140</p></td></tr><tr style="height:9pt"><td style="width:157pt" rowspan="2"><p class="s20" style="padding-top: 1pt;padding-left: 3pt;text-indent: 0pt;text-align: left;">A backend worker</p></td><td style="width:38pt" rowspan="2"><p class="s20" style="padding-top: 1pt;padding-left: 22pt;text-indent: 0pt;text-align: left;">159</p></td></tr><tr style="height:13pt"><td style="width:167pt"><p class="s20" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;line-height: 10pt;text-align: left;">Higher-level predicates - every() and some()</p></td><td style="width:38pt"><p class="s20" style="padding-top: 1pt;padding-right: 13pt;text-indent: 0pt;line-height: 10pt;text-align: right;">143</p></td></tr></table><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: right;">Table of Contents ix</p><p style="text-indent: 0pt;text-align: left;"><br/></p><table style="border-collapse:collapse;margin-left:40.93pt" cellspacing="0"><tr style="height:14pt"><td style="width:144pt"><p class="s20" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Workers, FP style</p></td><td style="width:170pt"><p class="s20" style="padding-left: 43pt;text-indent: 0pt;line-height: 12pt;text-align: left;">160 <span class="s19">Summary</span></p></td><td style="width:88pt"><p class="s19" style="padding-right: 2pt;text-indent: 0pt;line-height: 12pt;text-align: right;">165</p></td></tr><tr style="height:15pt"><td style="width:144pt"><p class="s20" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Long-living pooled workers</p></td><td style="width:170pt"><p class="s22" style="padding-top: 1pt;padding-left: 43pt;text-indent: 0pt;line-height: 12pt;text-align: left;">162 <span class="s23">Questions</span></p></td><td style="width:88pt"><p class="s19" style="padding-top: 1pt;padding-right: 2pt;text-indent: 0pt;line-height: 12pt;text-align: right;">166</p></td></tr></table><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"/><p class="s12" style="padding-top: 5pt;padding-left: 43pt;text-indent: 0pt;text-align: left;">Producing Functions - Higher-Order Functions<span class="s13">             </span>169</p><p class="s17" style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;text-align: left;">Wrapping functions - keeping</p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;text-align: left;"><a href="#bookmark285" class="s14">Changing functions in other ways  204</a></p><table style="border-collapse:collapse" cellspacing="0"><tr style="height:15pt"><td style="width:155pt"><p class="s19" style="padding-left: 2pt;text-indent: 0pt;line-height: 12pt;text-align: left;">behavior</p></td><td style="width:39pt"><p class="s19" style="padding-right: 2pt;text-indent: 0pt;line-height: 12pt;text-align: right;">169</p></td></tr><tr style="height:15pt"><td style="width:155pt"><p class="s20" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Logging</p></td><td style="width:39pt"><p class="s20" style="padding-top: 1pt;padding-right: 2pt;text-indent: 0pt;text-align: right;">170</p></td></tr><tr style="height:14pt"><td style="width:155pt"><p class="s20" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Timing functions</p></td><td style="width:39pt"><p class="s20" style="padding-top: 1pt;padding-right: 2pt;text-indent: 0pt;text-align: right;">180</p></td></tr><tr style="height:16pt"><td style="width:155pt"><p class="s20" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Memoizing functions</p></td><td style="width:39pt"><p class="s20" style="padding-top: 1pt;padding-right: 2pt;text-indent: 0pt;text-align: right;">182</p></td></tr><tr style="height:18pt"><td style="width:155pt"><p class="s19" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Altering a function’s behavior</p></td><td style="width:39pt"><p class="s19" style="padding-top: 3pt;padding-right: 2pt;text-indent: 0pt;text-align: right;">193</p></td></tr><tr style="height:15pt"><td style="width:155pt"><p class="s20" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Doing things once, revisited</p></td><td style="width:39pt"><p class="s20" style="padding-top: 1pt;padding-right: 2pt;text-indent: 0pt;text-align: right;">193</p></td></tr><tr style="height:14pt"><td style="width:155pt"><p class="s20" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Logically negating a function</p></td><td style="width:39pt"><p class="s20" style="padding-top: 1pt;padding-right: 2pt;text-indent: 0pt;text-align: right;">196</p></td></tr><tr style="height:14pt"><td style="width:155pt"><p class="s20" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Inverting the results</p></td><td style="width:39pt"><p class="s20" style="padding-top: 1pt;padding-right: 2pt;text-indent: 0pt;text-align: right;">198</p></td></tr><tr style="height:14pt"><td style="width:155pt"><p class="s20" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Arity changing</p></td><td style="width:39pt"><p class="s20" style="padding-top: 1pt;padding-right: 2pt;text-indent: 0pt;text-align: right;">200</p></td></tr><tr style="height:13pt"><td style="width:155pt"><p class="s20" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;line-height: 10pt;text-align: left;">Throttling and debouncing</p></td><td style="width:39pt"><p class="s20" style="padding-top: 1pt;padding-right: 2pt;text-indent: 0pt;line-height: 10pt;text-align: right;">202</p></td></tr></table><p style="text-indent: 0pt;text-align: left;"/><p style="padding-top: 3pt;padding-left: 43pt;text-indent: 0pt;text-align: left;"><a href="#bookmark286" class="a">Turning operations into functions</a><a href="#bookmark286" class="s15">      </a><a href="#bookmark286">205</a></p><p style="padding-top: 2pt;padding-left: 43pt;text-indent: 0pt;text-align: left;"><a href="#bookmark287" class="a">Turning functions into promises</a><a href="#bookmark287" class="s15">       </a><a href="#bookmark287">208</a></p><p style="padding-top: 2pt;padding-left: 43pt;text-indent: 0pt;text-align: left;"><a href="#bookmark288" class="a">Getting a property from an object</a><a href="#bookmark288" class="s15">       </a><a href="#bookmark288">210</a></p><p style="padding-top: 2pt;padding-left: 43pt;text-indent: 0pt;text-align: left;"><a href="#bookmark289">Demethodizing - turning methods into</a></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: left;"><a href="#bookmark289" class="a">functions</a><a href="#bookmark289" class="s15">                  </a><a href="#bookmark289">212</a></p><p style="padding-top: 2pt;padding-left: 43pt;text-indent: 0pt;line-height: 118%;text-align: left;"><a href="#bookmark290" class="a">Methodizing - turning functions into methods 215<br/>Finding the optimum</a><a href="#bookmark290" class="s15">             </a><a href="#bookmark290">219</a></p><p style="padding-top: 4pt;padding-left: 43pt;text-indent: 0pt;text-align: left;"><a href="#bookmark291" class="s14">Summary               222</a></p><p style="padding-top: 3pt;padding-left: 43pt;text-indent: 0pt;text-align: left;"><a href="#bookmark292" class="s14">Questions              222</a></p><p class="s16" style="padding-top: 24pt;padding-left: 44pt;text-indent: 0pt;text-align: left;">7</p><p class="s25" style="padding-top: 12pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">Transforming Functions - Currying and Partial Application 225</p><p style="text-indent: 0pt;text-align: left;"><br/></p><table style="border-collapse:collapse;margin-left:40.93pt" cellspacing="0"><tr style="height:14pt"><td style="width:160pt"><p class="s19" style="padding-left: 2pt;text-indent: 0pt;line-height: 12pt;text-align: left;">A bit of theory</p></td><td style="width:41pt"><p class="s19" style="padding-left: 14pt;padding-right: 7pt;text-indent: 0pt;line-height: 12pt;text-align: center;">225</p></td><td style="width:150pt"><p class="s20" style="padding-left: 8pt;text-indent: 0pt;text-align: left;">Partial currying with bind()</p></td><td style="width:50pt"><p class="s20" style="padding-right: 3pt;text-indent: 0pt;text-align: right;">249</p></td></tr><tr style="height:17pt"><td style="width:160pt"><p class="s19" style="padding-top: 2pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Currying</p></td><td style="width:41pt"><p class="s19" style="padding-top: 2pt;padding-left: 14pt;padding-right: 7pt;text-indent: 0pt;text-align: center;">226</p></td><td style="width:150pt"><p class="s20" style="padding-left: 8pt;text-indent: 0pt;text-align: left;">Partial currying with closures</p></td><td style="width:50pt"><p class="s20" style="padding-right: 3pt;text-indent: 0pt;text-align: right;">252</p></td></tr><tr style="height:15pt"><td style="width:160pt"><p class="s20" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Dealing with many parameters</p></td><td style="width:41pt"><p class="s20" style="padding-top: 1pt;padding-left: 14pt;padding-right: 5pt;text-indent: 0pt;text-align: center;">227</p></td><td style="width:150pt"><p class="s19" style="padding-top: 1pt;padding-left: 8pt;text-indent: 0pt;line-height: 12pt;text-align: left;">Final thoughts</p></td><td style="width:50pt"><p class="s19" style="padding-top: 1pt;padding-right: 2pt;text-indent: 0pt;line-height: 12pt;text-align: right;">253</p></td></tr><tr style="height:15pt"><td style="width:160pt"><p class="s20" style="padding-left: 2pt;text-indent: 0pt;text-align: left;">Currying by hand</p></td><td style="width:41pt"><p class="s20" style="padding-left: 14pt;padding-right: 5pt;text-indent: 0pt;text-align: center;">230</p></td><td style="width:150pt"><p class="s20" style="padding-top: 3pt;padding-left: 8pt;text-indent: 0pt;line-height: 10pt;text-align: left;">Variable number of parameters</p></td><td style="width:50pt"><p class="s20" style="padding-top: 3pt;padding-right: 3pt;text-indent: 0pt;line-height: 10pt;text-align: right;">254</p></td></tr><tr style="height:15pt"><td style="width:160pt"><p class="s20" style="padding-left: 2pt;text-indent: 0pt;line-height: 11pt;text-align: left;">Currying with bind()</p></td><td style="width:41pt"><p class="s20" style="padding-left: 14pt;padding-right: 5pt;text-indent: 0pt;line-height: 11pt;text-align: center;">232</p></td><td style="width:150pt"><p class="s20" style="padding-top: 2pt;padding-left: 8pt;text-indent: 0pt;text-align: left;">Parameter order</p></td><td style="width:50pt"><p class="s20" style="padding-top: 2pt;padding-right: 3pt;text-indent: 0pt;text-align: right;">254</p></td></tr><tr style="height:18pt"><td style="width:160pt"><p class="s19" style="padding-top: 2pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Partial application</p></td><td style="width:41pt"><p class="s19" style="padding-top: 2pt;padding-left: 14pt;padding-right: 7pt;text-indent: 0pt;text-align: center;">236</p></td><td style="width:150pt"><p class="s20" style="padding-top: 1pt;padding-left: 8pt;text-indent: 0pt;text-align: left;">Being functional</p></td><td style="width:50pt"><p class="s20" style="padding-top: 1pt;padding-right: 3pt;text-indent: 0pt;text-align: right;">256</p></td></tr><tr style="height:15pt"><td style="width:160pt"><p class="s20" style="padding-top: 2pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Partial application with arrow functions</p></td><td style="width:41pt"><p class="s20" style="padding-top: 2pt;padding-left: 14pt;padding-right: 5pt;text-indent: 0pt;text-align: center;">237</p></td><td style="width:150pt"><p class="s19" style="padding-top: 1pt;padding-left: 8pt;text-indent: 0pt;line-height: 13pt;text-align: left;">Summary</p></td><td style="width:50pt"><p class="s19" style="padding-top: 1pt;padding-right: 2pt;text-indent: 0pt;line-height: 12pt;text-align: right;">257</p></td></tr><tr style="height:17pt"><td style="width:160pt"><p class="s20" style="padding-left: 2pt;text-indent: 0pt;text-align: left;">Partial application with closures</p></td><td style="width:41pt"><p class="s20" style="padding-left: 14pt;padding-right: 5pt;text-indent: 0pt;text-align: center;">238</p></td><td style="width:150pt"><p class="s19" style="padding-top: 2pt;padding-left: 8pt;text-indent: 0pt;text-align: left;">Questions</p></td><td style="width:50pt"><p class="s19" style="padding-top: 2pt;padding-right: 2pt;text-indent: 0pt;text-align: right;">258</p></td></tr><tr style="height:14pt"><td style="width:160pt"><p class="s19" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;line-height: 12pt;text-align: left;">Partial currying</p></td><td style="width:41pt"><p class="s19" style="padding-top: 1pt;padding-left: 14pt;padding-right: 7pt;text-indent: 0pt;line-height: 12pt;text-align: center;">247</p></td><td style="width:150pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:50pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr></table><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s25" style="padding-left: 42pt;text-indent: 0pt;text-align: center;">Connecting Functions - Pipelining, Composition, and More 261</p><p class="s17" style="padding-top: 7pt;padding-left: 19pt;text-indent: 0pt;text-align: center;">Pipelining                261 <span class="s24">Piping in Unix/Linux</span><span class="s26">                </span><span class="s27">262</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s28" style="padding-top: 4pt;padding-left: 30pt;text-indent: 0pt;text-align: left;">X  <span class="p">Table of Contents</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><table style="border-collapse:collapse;margin-left:50.03pt" cellspacing="0"><tr style="height:14pt"><td style="width:160pt"><p class="s20" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Revisiting an example</p></td><td style="width:41pt"><p class="s20" style="padding-top: 1pt;padding-right: 9pt;text-indent: 0pt;text-align: right;">263</p></td><td style="width:156pt"><p class="s19" style="padding-left: 8pt;text-indent: 0pt;line-height: 12pt;text-align: left;">Transducing</p></td><td style="width:45pt"><p class="s19" style="padding-right: 2pt;text-indent: 0pt;line-height: 12pt;text-align: right;">295</p></td></tr><tr style="height:14pt"><td style="width:160pt"><p class="s20" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Creating pipelines</p></td><td style="width:41pt"><p class="s20" style="padding-top: 1pt;padding-right: 9pt;text-indent: 0pt;text-align: right;">265</p></td><td style="width:156pt"><p class="s20" style="padding-top: 2pt;padding-left: 8pt;text-indent: 0pt;line-height: 11pt;text-align: left;">Composing reducers</p></td><td style="width:45pt"><p class="s20" style="padding-top: 2pt;padding-right: 3pt;text-indent: 0pt;line-height: 10pt;text-align: right;">298</p></td></tr><tr style="height:17pt"><td style="width:160pt" rowspan="2"><p class="s20" style="padding-left: 2pt;padding-right: 71pt;text-indent: 0pt;line-height: 122%;text-align: left;"><span>Debugging pipelines<br/>Pointfree style</span></p></td><td style="width:41pt" rowspan="2"><p class="s20" style="padding-left: 18pt;text-indent: 0pt;text-align: left;">273</p><p class="s20" style="padding-top: 2pt;padding-left: 18pt;text-indent: 0pt;text-align: left;">276</p></td><td style="width:156pt"><p class="s20" style="padding-top: 1pt;padding-left: 8pt;text-indent: 0pt;text-align: left;">Generalizing for all reducers</p></td><td style="width:45pt"><p class="s20" style="padding-top: 1pt;padding-right: 3pt;text-indent: 0pt;text-align: right;">300</p></td></tr><tr style="height:16pt"><td style="width:156pt"><p class="s19" style="padding-top: 3pt;padding-left: 8pt;text-indent: 0pt;line-height: 12pt;text-align: left;">Testing connected functions</p></td><td style="width:45pt"><p class="s19" style="padding-top: 3pt;padding-right: 4pt;text-indent: 0pt;line-height: 12pt;text-align: right;">301</p></td></tr><tr style="height:16pt"><td style="width:160pt"><p class="s19" style="padding-left: 2pt;text-indent: 0pt;line-height: 12pt;text-align: left;">Chaining and fluent interfaces</p></td><td style="width:41pt"><p class="s19" style="padding-right: 8pt;text-indent: 0pt;line-height: 12pt;text-align: right;">279</p></td><td style="width:156pt"><p class="s20" style="padding-top: 4pt;padding-left: 8pt;text-indent: 0pt;line-height: 11pt;text-align: left;">Testing pipelined functions</p></td><td style="width:45pt"><p class="s20" style="padding-top: 4pt;padding-right: 4pt;text-indent: 0pt;line-height: 11pt;text-align: right;">301</p></td></tr><tr style="height:14pt"><td style="width:160pt"><p class="s20" style="padding-left: 2pt;text-indent: 0pt;text-align: left;">An example of fluent APIs</p></td><td style="width:41pt"><p class="s20" style="padding-right: 9pt;text-indent: 0pt;text-align: right;">279</p></td><td style="width:156pt"><p class="s20" style="padding-top: 1pt;padding-left: 8pt;text-indent: 0pt;line-height: 11pt;text-align: left;">Testing composed functions</p></td><td style="width:45pt"><p class="s20" style="padding-top: 1pt;padding-right: 3pt;text-indent: 0pt;line-height: 11pt;text-align: right;">304</p></td></tr><tr style="height:15pt"><td style="width:160pt"><p class="s20" style="padding-left: 2pt;text-indent: 0pt;text-align: left;">Chaining method calls</p></td><td style="width:41pt"><p class="s20" style="padding-right: 9pt;text-indent: 0pt;text-align: right;">281</p></td><td style="width:156pt"><p class="s20" style="padding-top: 1pt;padding-left: 8pt;text-indent: 0pt;text-align: left;">Testing chained functions</p></td><td style="width:45pt"><p class="s20" style="padding-top: 1pt;padding-right: 3pt;text-indent: 0pt;text-align: right;">305</p></td></tr><tr style="height:18pt"><td style="width:160pt"><p class="s19" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Composing</p></td><td style="width:41pt"><p class="s19" style="padding-top: 3pt;padding-right: 8pt;text-indent: 0pt;text-align: right;">284</p></td><td style="width:156pt"><p class="s20" style="padding-top: 1pt;padding-left: 8pt;text-indent: 0pt;text-align: left;">Testing transduced functions</p></td><td style="width:45pt"><p class="s20" style="padding-top: 1pt;padding-right: 3pt;text-indent: 0pt;text-align: right;">307</p></td></tr><tr style="height:15pt"><td style="width:160pt"><p class="s20" style="padding-top: 2pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Some examples of composition</p></td><td style="width:41pt"><p class="s20" style="padding-top: 2pt;padding-right: 9pt;text-indent: 0pt;text-align: right;">285</p></td><td style="width:156pt"><p class="s19" style="padding-left: 8pt;text-indent: 0pt;text-align: left;">Summary</p></td><td style="width:45pt"><p class="s19" style="padding-top: 1pt;padding-right: 2pt;text-indent: 0pt;text-align: right;">309</p></td></tr><tr style="height:15pt"><td style="width:160pt"><p class="s20" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Composing with higher-order functions</p></td><td style="width:41pt"><p class="s20" style="padding-top: 1pt;padding-right: 9pt;text-indent: 0pt;text-align: right;">289</p></td><td style="width:156pt"><p class="s19" style="padding-top: 1pt;padding-left: 8pt;text-indent: 0pt;line-height: 12pt;text-align: left;">Questions</p></td><td style="width:45pt"><p class="s19" style="padding-top: 1pt;padding-right: 2pt;text-indent: 0pt;line-height: 12pt;text-align: right;">309</p></td></tr></table><p style="text-indent: 0pt;text-align: left;"><br/></p><table style="border-collapse:collapse;margin-left:50.38pt" cellspacing="0"><tr style="height:18pt"><td style="width:128pt;border-bottom-style:solid;border-bottom-width:1pt"><p class="s18" style="padding-left: 2pt;text-indent: 0pt;text-align: left;">Designing Functions -</p></td><td style="width:212pt;border-bottom-style:solid;border-bottom-width:1pt" colspan="2"><p class="s18" style="padding-left: 2pt;text-indent: 0pt;text-align: left;">Recursion</p></td><td style="width:60pt;border-bottom-style:solid;border-bottom-width:1pt"><p class="s18" style="padding-right: 2pt;text-indent: 0pt;text-align: right;">313</p></td></tr><tr style="height:21pt"><td style="width:128pt;border-top-style:solid;border-top-width:1pt"><p class="s19" style="padding-top: 5pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Using recursion</p></td><td style="width:72pt;border-top-style:solid;border-top-width:1pt"><p class="s19" style="padding-top: 5pt;padding-right: 8pt;text-indent: 0pt;text-align: right;">313</p></td><td style="width:140pt;border-top-style:solid;border-top-width:1pt"><p class="s19" style="padding-top: 5pt;padding-left: 8pt;text-indent: 0pt;text-align: left;">Recursion techniques</p></td><td style="width:60pt;border-top-style:solid;border-top-width:1pt"><p class="s19" style="padding-top: 5pt;padding-right: 2pt;text-indent: 0pt;text-align: right;">348</p></td></tr><tr style="height:15pt"><td style="width:128pt"><p class="s20" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Thinking recursively</p></td><td style="width:72pt"><p class="s20" style="padding-top: 1pt;padding-right: 9pt;text-indent: 0pt;text-align: right;">315</p></td><td style="width:140pt"><p class="s20" style="padding-top: 1pt;padding-left: 8pt;text-indent: 0pt;text-align: left;">Tail call optimization</p></td><td style="width:60pt"><p class="s20" style="padding-top: 1pt;padding-right: 2pt;text-indent: 0pt;text-align: right;">348</p></td></tr><tr style="height:14pt"><td style="width:128pt"><p class="s20" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Higher-order functions revisited</p></td><td style="width:72pt"><p class="s20" style="padding-top: 1pt;padding-right: 9pt;text-indent: 0pt;text-align: right;">325</p></td><td style="width:140pt"><p class="s20" style="padding-top: 1pt;padding-left: 8pt;text-indent: 0pt;text-align: left;">Continuation-passing style</p></td><td style="width:60pt"><p class="s20" style="padding-top: 1pt;padding-right: 2pt;text-indent: 0pt;text-align: right;">351</p></td></tr><tr style="height:14pt"><td style="width:128pt"><p class="s20" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Searching and backtracking</p></td><td style="width:72pt"><p class="s20" style="padding-top: 1pt;padding-right: 9pt;text-indent: 0pt;text-align: right;">333</p></td><td style="width:140pt"><p class="s20" style="padding-top: 1pt;padding-left: 8pt;text-indent: 0pt;text-align: left;">Trampolines and thunks</p></td><td style="width:60pt"><p class="s20" style="padding-top: 1pt;padding-right: 1pt;text-indent: 0pt;text-align: right;">356</p></td></tr><tr style="height:19pt"><td style="width:128pt"><p class="s19" style="padding-top: 5pt;padding-left: 2pt;text-indent: 0pt;line-height: 12pt;text-align: left;">Mutual recursion</p></td><td style="width:72pt"><p class="s19" style="padding-top: 5pt;padding-right: 9pt;text-indent: 0pt;line-height: 12pt;text-align: right;">341</p></td><td style="width:140pt"><p class="s20" style="padding-top: 1pt;padding-left: 8pt;text-indent: 0pt;text-align: left;">Recursion elimination</p></td><td style="width:60pt"><p class="s20" style="padding-top: 1pt;padding-right: 2pt;text-indent: 0pt;text-align: right;">359</p></td></tr><tr style="height:16pt"><td style="width:128pt"><p class="s20" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Odds and evens</p></td><td style="width:72pt"><p class="s20" style="padding-top: 3pt;padding-right: 9pt;text-indent: 0pt;text-align: right;">341</p></td><td style="width:140pt"><p class="s19" style="padding-left: 8pt;text-indent: 0pt;text-align: left;">Summary</p></td><td style="width:60pt"><p class="s19" style="text-indent: 0pt;text-align: right;">360</p></td></tr><tr style="height:14pt"><td style="width:128pt"><p class="s20" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;line-height: 11pt;text-align: left;">Doing arithmetic</p></td><td style="width:72pt"><p class="s20" style="padding-top: 1pt;padding-right: 9pt;text-indent: 0pt;line-height: 11pt;text-align: right;">343</p></td><td style="width:140pt"><p class="s19" style="padding-left: 8pt;text-indent: 0pt;line-height: 12pt;text-align: left;">Questions</p></td><td style="width:60pt"><p class="s19" style="text-indent: 0pt;line-height: 12pt;text-align: right;">360</p></td></tr></table><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s16" style="padding-top: 4pt;padding-left: 54pt;text-indent: 0pt;text-align: left;">10</p><table style="border-collapse:collapse" cellspacing="0"><tr style="height:23pt"><td style="width:144pt;border-top-style:solid;border-top-width:1pt"><p class="s19" style="padding-top: 8pt;text-indent: 0pt;line-height: 12pt;text-align: left;">Going the straightforward</p></td><td style="width:54pt;border-top-style:solid;border-top-width:1pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:170pt;border-top-style:solid;border-top-width:1pt"><p class="s19" style="padding-top: 8pt;padding-left: 8pt;text-indent: 0pt;line-height: 12pt;text-align: left;">Creating persistent data structures</p></td><td style="width:28pt;border-top-style:solid;border-top-width:1pt"><p class="s19" style="padding-top: 8pt;text-indent: 0pt;line-height: 12pt;text-align: right;">396</p></td></tr><tr style="height:16pt"><td style="width:144pt"><p class="s19" style="text-indent: 0pt;line-height: 13pt;text-align: left;">JavaScript way</p></td><td style="width:54pt"><p class="s19" style="padding-right: 8pt;text-indent: 0pt;line-height: 13pt;text-align: right;">366</p></td><td style="width:170pt"><p class="s20" style="padding-top: 3pt;padding-left: 8pt;text-indent: 0pt;line-height: 11pt;text-align: left;">Working with lists</p></td><td style="width:28pt"><p class="s20" style="padding-top: 3pt;text-indent: 0pt;line-height: 11pt;text-align: right;">396</p></td></tr><tr style="height:14pt"><td style="width:144pt"><p class="s20" style="text-indent: 0pt;text-align: left;">Mutator functions</p></td><td style="width:54pt"><p class="s20" style="padding-right: 9pt;text-indent: 0pt;text-align: right;">366</p></td><td style="width:170pt"><p class="s20" style="padding-top: 1pt;padding-left: 8pt;text-indent: 0pt;text-align: left;">Updating objects</p></td><td style="width:28pt"><p class="s20" style="padding-top: 1pt;text-indent: 0pt;line-height: 11pt;text-align: right;">398</p></td></tr><tr style="height:14pt"><td style="width:144pt"><p class="s20" style="text-indent: 0pt;text-align: left;">Constants</p></td><td style="width:54pt"><p class="s20" style="padding-right: 9pt;text-indent: 0pt;text-align: right;">367</p></td><td style="width:170pt"><p class="s20" style="padding-top: 1pt;padding-left: 8pt;text-indent: 0pt;line-height: 11pt;text-align: left;">A final caveat</p></td><td style="width:28pt"><p class="s20" style="padding-top: 1pt;padding-right: 1pt;text-indent: 0pt;text-align: right;">404</p></td></tr><tr style="height:14pt"><td style="width:144pt"><p class="s20" style="text-indent: 0pt;text-align: left;">Freezing</p></td><td style="width:54pt"><p class="s20" style="padding-right: 9pt;text-indent: 0pt;text-align: right;">368</p></td><td style="width:170pt" rowspan="2"><p class="s19" style="padding-top: 5pt;padding-left: 8pt;text-indent: 0pt;text-align: left;">Summary</p></td><td style="width:28pt" rowspan="2"><p class="s19" style="padding-top: 5pt;padding-left: 11pt;text-indent: 0pt;text-align: left;">404</p></td></tr><tr style="height:7pt"><td style="width:144pt" rowspan="2"><p class="s20" style="padding-top: 1pt;text-indent: 0pt;text-align: left;">Cloning and mutating</p></td><td style="width:54pt" rowspan="2"><p class="s20" style="padding-top: 1pt;padding-left: 32pt;text-indent: 0pt;text-align: left;">371</p></td></tr><tr style="height:7pt"><td style="width:170pt" rowspan="2"><p class="s19" style="padding-top: 1pt;padding-left: 8pt;text-indent: 0pt;text-align: left;">Questions</p></td><td style="width:28pt" rowspan="2"><p class="s19" style="padding-top: 1pt;padding-left: 11pt;text-indent: 0pt;text-align: left;">405</p></td></tr><tr style="height:14pt"><td style="width:144pt"><p class="s20" style="padding-top: 1pt;text-indent: 0pt;text-align: left;">Getters and setters</p></td><td style="width:54pt"><p class="s20" style="padding-top: 1pt;padding-right: 9pt;text-indent: 0pt;text-align: right;">375</p></td></tr><tr style="height:14pt"><td style="width:144pt"><p class="s20" style="padding-top: 1pt;text-indent: 0pt;text-align: left;">Lenses</p></td><td style="width:54pt"><p class="s20" style="padding-top: 1pt;padding-right: 9pt;text-indent: 0pt;text-align: right;">380</p></td><td style="width:170pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:28pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:13pt"><td style="width:144pt"><p class="s20" style="padding-top: 1pt;text-indent: 0pt;line-height: 10pt;text-align: left;">Prisms</p></td><td style="width:54pt"><p class="s20" style="padding-top: 1pt;padding-right: 9pt;text-indent: 0pt;line-height: 10pt;text-align: right;">392</p></td><td style="width:170pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:28pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr></table><p style="text-indent: 0pt;text-align: left;"/><p class="s12" style="padding-top: 13pt;padding-left: 53pt;text-indent: 0pt;text-align: left;"><a name="bookmark7">Ensuring Purity - Immutability</a><span class="s13">                       </span>365</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;text-indent: 0pt;text-align: right;">Table of Contents xi</p><p style="text-indent: 0pt;text-align: left;"><br/></p><table style="border-collapse:collapse;margin-left:41.48pt" cellspacing="0"><tr style="height:18pt"><td style="width:175pt;border-bottom-style:solid;border-bottom-width:1pt"><p class="s18" style="padding-left: 2pt;text-indent: 0pt;text-align: left;">Implementing Design Patterns</p></td><td style="width:183pt;border-bottom-style:solid;border-bottom-width:1pt" colspan="2"><p class="s18" style="padding-left: 1pt;text-indent: 0pt;text-align: left;">-The Functional Way</p></td><td style="width:42pt;border-bottom-style:solid;border-bottom-width:1pt"><p class="s18" style="padding-right: 2pt;text-indent: 0pt;text-align: right;">409</p></td></tr><tr style="height:20pt"><td style="width:175pt;border-top-style:solid;border-top-width:1pt"><p class="s19" style="padding-top: 5pt;padding-left: 2pt;text-indent: 0pt;line-height: 12pt;text-align: left;">Understanding design patterns</p></td><td style="width:25pt;border-top-style:solid;border-top-width:1pt"><p class="s19" style="padding-top: 5pt;padding-right: 8pt;text-indent: 0pt;line-height: 12pt;text-align: right;">409</p></td><td style="width:158pt;border-top-style:solid;border-top-width:1pt"><p class="s20" style="padding-top: 6pt;padding-left: 8pt;text-indent: 0pt;text-align: left;">Dependency Injection</p></td><td style="width:42pt;border-top-style:solid;border-top-width:1pt"><p class="s20" style="padding-top: 6pt;padding-right: 2pt;text-indent: 0pt;text-align: right;">422</p></td></tr><tr style="height:15pt"><td style="width:175pt"><p class="s20" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;line-height: 10pt;text-align: left;">Design pattern categories</p></td><td style="width:25pt"><p class="s20" style="padding-top: 3pt;padding-right: 9pt;text-indent: 0pt;line-height: 10pt;text-align: right;">410</p></td><td style="width:158pt"><p class="s20" style="padding-left: 8pt;text-indent: 0pt;text-align: left;">Observers and reactive programming</p></td><td style="width:42pt"><p class="s20" style="padding-right: 2pt;text-indent: 0pt;text-align: right;">425</p></td></tr><tr style="height:16pt"><td style="width:175pt"><p class="s20" style="padding-top: 2pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Do we need design patterns?</p></td><td style="width:25pt"><p class="s20" style="padding-top: 2pt;padding-right: 9pt;text-indent: 0pt;text-align: right;">412</p></td><td style="width:158pt"><p class="s20" style="padding-left: 8pt;text-indent: 0pt;line-height: 11pt;text-align: left;">Other patterns</p></td><td style="width:42pt"><p class="s20" style="padding-right: 2pt;text-indent: 0pt;line-height: 11pt;text-align: right;">437</p></td></tr><tr style="height:18pt"><td style="width:175pt"><p class="s19" style="padding-top: 4pt;padding-left: 2pt;text-indent: 0pt;line-height: 12pt;text-align: left;">Object-oriented design patterns</p></td><td style="width:25pt"><p class="s19" style="padding-top: 3pt;padding-right: 8pt;text-indent: 0pt;line-height: 12pt;text-align: right;">412</p></td><td style="width:158pt"><p class="s19" style="padding-top: 1pt;padding-left: 8pt;text-indent: 0pt;text-align: left;">Functional design patterns</p></td><td style="width:42pt"><p class="s19" style="padding-top: 1pt;padding-right: 1pt;text-indent: 0pt;text-align: right;">437</p></td></tr><tr style="height:16pt"><td style="width:175pt"><p class="s20" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;line-height: 11pt;text-align: left;">Facade and Adapter</p></td><td style="width:25pt"><p class="s20" style="padding-top: 3pt;padding-right: 9pt;text-indent: 0pt;line-height: 11pt;text-align: right;">413</p></td><td style="width:158pt"><p class="s19" style="padding-left: 8pt;text-indent: 0pt;text-align: left;">Summary</p></td><td style="width:42pt"><p class="s19" style="padding-right: 1pt;text-indent: 0pt;text-align: right;">439</p></td></tr><tr style="height:14pt"><td style="width:175pt"><p class="s20" style="padding-top: 1pt;padding-left: 1pt;text-indent: 0pt;text-align: left;">Decorator or Wrapper</p></td><td style="width:25pt"><p class="s20" style="padding-top: 1pt;padding-right: 9pt;text-indent: 0pt;text-align: right;">416</p></td><td style="width:158pt"><p class="s19" style="padding-left: 8pt;text-indent: 0pt;line-height: 12pt;text-align: left;">Questions</p></td><td style="width:42pt"><p class="s19" style="padding-right: 1pt;text-indent: 0pt;line-height: 12pt;text-align: right;">439</p></td></tr><tr style="height:12pt"><td style="width:175pt"><p class="s20" style="padding-left: 2pt;text-indent: 0pt;line-height: 10pt;text-align: left;">Strategy, Template, and Command</p></td><td style="width:25pt"><p class="s20" style="padding-right: 9pt;text-indent: 0pt;line-height: 10pt;text-align: right;">420</p></td><td style="width:158pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:42pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr></table><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s16" style="padding-top: 4pt;padding-left: 45pt;text-indent: 0pt;text-align: left;">12</p><p style="text-indent: 0pt;text-align: left;"><br/></p><table style="border-collapse:collapse;margin-left:41.48pt" cellspacing="0"><tr style="height:18pt"><td style="width:161pt;border-bottom-style:solid;border-bottom-width:1pt"><p class="s18" style="padding-left: 2pt;text-indent: 0pt;text-align: left;">Building Better Containers -</p></td><td style="width:212pt;border-bottom-style:solid;border-bottom-width:1pt" colspan="2"><p class="s18" style="padding-left: 1pt;text-indent: 0pt;text-align: left;">Functional Data Types</p></td><td style="width:27pt;border-bottom-style:solid;border-bottom-width:1pt"><p class="s18" style="padding-left: 3pt;text-indent: 0pt;text-align: left;">443</p></td></tr><tr style="height:21pt"><td style="width:161pt;border-top-style:solid;border-top-width:1pt"><p class="s19" style="padding-top: 5pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Specifying data types</p></td><td style="width:39pt;border-top-style:solid;border-top-width:1pt"><p class="s19" style="padding-top: 5pt;padding-right: 8pt;text-indent: 0pt;text-align: right;">443</p></td><td style="width:173pt;border-top-style:solid;border-top-width:1pt"><p class="s20" style="padding-top: 6pt;padding-left: 8pt;text-indent: 0pt;text-align: left;">Monads</p></td><td style="width:27pt;border-top-style:solid;border-top-width:1pt"><p class="s20" style="padding-top: 6pt;padding-right: 2pt;text-indent: 0pt;text-align: right;">467</p></td></tr><tr style="height:33pt"><td style="width:161pt"><p class="s20" style="padding-top: 1pt;padding-left: 2pt;padding-right: 62pt;text-indent: 0pt;line-height: 120%;text-align: left;"><span>Signatures for functions<br/>Other data type options</span></p></td><td style="width:39pt"><p class="s20" style="padding-top: 1pt;padding-left: 16pt;text-indent: 0pt;text-align: left;">444</p><p class="s20" style="padding-top: 2pt;padding-left: 16pt;text-indent: 0pt;text-align: left;">447</p></td><td style="width:173pt"><p class="s19" style="padding-top: 3pt;padding-left: 8pt;text-indent: 0pt;text-align: left;">Functions as data structures</p><p class="s20" style="padding-top: 3pt;padding-left: 8pt;text-indent: 0pt;line-height: 11pt;text-align: left;">Binary trees in Haskell</p></td><td style="width:27pt"><p class="s19" style="padding-top: 3pt;padding-left: 9pt;text-indent: 0pt;text-align: left;">476</p><p class="s20" style="padding-top: 3pt;padding-left: 11pt;text-indent: 0pt;line-height: 11pt;text-align: left;">477</p></td></tr><tr style="height:16pt"><td style="width:161pt"><p class="s19" style="padding-left: 2pt;text-indent: 0pt;text-align: left;">Building containers</p></td><td style="width:39pt"><p class="s19" style="padding-right: 8pt;text-indent: 0pt;text-align: right;">449</p></td><td style="width:173pt"><p class="s20" style="padding-top: 1pt;padding-left: 8pt;text-indent: 0pt;text-align: left;">Functions as binary trees</p></td><td style="width:27pt"><p class="s20" style="padding-top: 1pt;padding-right: 2pt;text-indent: 0pt;text-align: right;">478</p></td></tr><tr style="height:39pt"><td style="width:161pt"><p class="s20" style="padding-top: 1pt;padding-left: 2pt;padding-right: 46pt;text-indent: 0pt;line-height: 120%;text-align: left;"><span>Extending current data types<br/>Containers and functors</span></p></td><td style="width:39pt"><p class="s20" style="padding-top: 1pt;padding-left: 16pt;text-indent: 0pt;text-align: left;">450</p><p class="s20" style="padding-top: 2pt;padding-left: 16pt;text-indent: 0pt;text-align: left;">452</p></td><td style="width:173pt"><p class="s19" style="padding-top: 3pt;padding-left: 8pt;padding-right: 119pt;text-indent: 0pt;line-height: 127%;text-align: left;"><span>Summary<br/>Questions</span></p></td><td style="width:27pt"><p class="s19" style="padding-top: 3pt;padding-left: 9pt;text-indent: 0pt;text-align: left;">486</p><p class="s19" style="padding-top: 3pt;padding-left: 9pt;text-indent: 0pt;text-align: left;">487</p></td></tr><tr style="height:24pt"><td style="width:161pt;border-bottom-style:solid;border-bottom-width:1pt"><p class="s18" style="padding-top: 5pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Answers to Questions</p></td><td style="width:39pt;border-bottom-style:solid;border-bottom-width:1pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:173pt;border-bottom-style:solid;border-bottom-width:1pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:27pt;border-bottom-style:solid;border-bottom-width:1pt"><p class="s18" style="padding-top: 5pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">491</p></td></tr><tr style="height:34pt"><td style="width:161pt;border-top-style:solid;border-top-width:1pt"><p class="s19" style="padding-top: 5pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Chapter 1, Becoming Functional</p><p class="s19" style="padding-left: 2pt;text-indent: 0pt;text-align: left;">- Several Questions</p></td><td style="width:39pt;border-top-style:solid;border-top-width:1pt"><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s19" style="padding-right: 8pt;text-indent: 0pt;text-align: right;">491</p></td><td style="width:173pt;border-top-style:solid;border-top-width:1pt"><p class="s19" style="padding-top: 5pt;padding-left: 8pt;text-indent: 0pt;text-align: left;">Chapter 7, Transforming Functions</p><p class="s19" style="padding-left: 8pt;text-indent: 0pt;text-align: left;">- Currying and Partial Application</p></td><td style="width:27pt;border-top-style:solid;border-top-width:1pt"><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s19" style="padding-right: 1pt;text-indent: 0pt;text-align: right;">536</p></td></tr><tr style="height:29pt"><td style="width:161pt"><p class="s19" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Chapter 2, Thinking Functionally</p><p class="s19" style="padding-left: 2pt;text-indent: 0pt;text-align: left;">- A First Example</p></td><td style="width:39pt"><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s19" style="padding-right: 8pt;text-indent: 0pt;text-align: right;">497</p></td><td style="width:173pt"><p class="s19" style="padding-top: 1pt;padding-left: 8pt;text-indent: 0pt;text-align: left;">Chapter 8, Connecting Functions</p><p class="s19" style="padding-left: 8pt;text-indent: 0pt;text-align: left;">- Pipelining, Composition, and More</p></td><td style="width:27pt"><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s19" style="padding-left: 1pt;text-indent: 0pt;text-align: left;">: 541</p></td></tr><tr style="height:29pt"><td style="width:161pt"><p class="s19" style="padding-top: 1pt;padding-left: 2pt;padding-right: 46pt;text-indent: 0pt;text-align: left;"><span>Chapter 3, Starting Out with<br/>Functions - A Core Concept</span></p></td><td style="width:39pt"><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s19" style="padding-right: 8pt;text-indent: 0pt;text-align: right;">503</p></td><td style="width:173pt"><p class="s19" style="padding-top: 1pt;padding-left: 8pt;text-indent: 0pt;text-align: left;">Chapter 9, Designing Functions</p><p class="s19" style="padding-left: 8pt;text-indent: 0pt;text-align: left;">- Recursion</p></td><td style="width:27pt"><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s19" style="padding-right: 1pt;text-indent: 0pt;text-align: right;">544</p></td></tr><tr style="height:29pt"><td style="width:161pt"><p class="s19" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Chapter 4, Behaving Properly</p><p class="s19" style="padding-left: 2pt;text-indent: 0pt;text-align: left;">- Pure Functions</p></td><td style="width:39pt"><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s19" style="padding-right: 8pt;text-indent: 0pt;text-align: right;">507</p></td><td style="width:173pt"><p class="s19" style="padding-top: 1pt;padding-left: 8pt;text-indent: 0pt;text-align: left;">Chapter 10, Ensuring Purity</p><p class="s19" style="padding-left: 8pt;text-indent: 0pt;text-align: left;">- Immutability</p></td><td style="width:27pt"><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s19" style="padding-right: 1pt;text-indent: 0pt;text-align: right;">554</p></td></tr><tr style="height:29pt"><td style="width:161pt"><p class="s19" style="padding-top: 1pt;padding-left: 2pt;padding-right: 27pt;text-indent: 0pt;text-align: left;"><span>Chapter 5, Programming<br/>Declaratively - A Better Style</span></p></td><td style="width:39pt"><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s19" style="padding-right: 8pt;text-indent: 0pt;text-align: right;">514</p></td><td style="width:173pt"><p class="s19" style="padding-top: 1pt;padding-left: 8pt;padding-right: 14pt;text-indent: 0pt;text-align: left;"><span>Chapter 11, Implementing Design<br/>Patterns - The Functional Way</span></p></td><td style="width:27pt"><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s19" style="padding-right: 1pt;text-indent: 0pt;text-align: right;">562</p></td></tr><tr style="height:27pt"><td style="width:161pt"><p class="s19" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Chapter 6, Producing Functions</p><p class="s19" style="padding-left: 2pt;text-indent: 0pt;line-height: 12pt;text-align: left;">- Higher-Order Functions</p></td><td style="width:39pt"><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s19" style="padding-right: 8pt;text-indent: 0pt;line-height: 12pt;text-align: right;">527</p></td><td style="width:173pt"><p class="s19" style="padding-left: 8pt;padding-right: 6pt;text-indent: 0pt;line-height: 13pt;text-align: left;"><span>Chapter 12, Building Better<br/>Containers - Functional Data Types</span></p></td><td style="width:27pt"><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s19" style="padding-right: 1pt;text-indent: 0pt;line-height: 12pt;text-align: right;">565</p></td></tr></table><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><table style="border-collapse:collapse;margin-left:50.38pt" cellspacing="0"><tr style="height:18pt"><td style="width:268pt;border-bottom-style:solid;border-bottom-width:1pt"><p class="s18" style="padding-left: 2pt;text-indent: 0pt;text-align: left;">Bibliography</p></td><td style="width:132pt;border-bottom-style:solid;border-bottom-width:1pt"><p class="s18" style="padding-right: 1pt;text-indent: 0pt;text-align: right;">577</p></td></tr><tr style="height:31pt"><td style="width:268pt;border-top-style:solid;border-top-width:1pt;border-bottom-style:solid;border-bottom-width:1pt"><p class="s18" style="padding-top: 13pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Index</p></td><td style="width:132pt;border-top-style:solid;border-top-width:1pt;border-bottom-style:solid;border-bottom-width:1pt"><p class="s18" style="padding-top: 13pt;padding-right: 1pt;text-indent: 0pt;text-align: right;">579</p></td></tr><tr style="height:31pt"><td style="width:268pt;border-top-style:solid;border-top-width:1pt;border-bottom-style:solid;border-bottom-width:1pt"><p class="s18" style="padding-top: 13pt;padding-left: 2pt;text-indent: 0pt;line-height: 16pt;text-align: left;">Other Books You May Enjoy</p></td><td style="width:132pt;border-top-style:solid;border-top-width:1pt;border-bottom-style:solid;border-bottom-width:1pt"><p class="s18" style="padding-top: 13pt;padding-right: 1pt;text-indent: 0pt;line-height: 16pt;text-align: right;">590</p></td></tr></table><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-top: 13pt;padding-left: 354pt;text-indent: 0pt;text-align: left;"><a name="bookmark8">Preface</a></h2><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>In computer programming, paradigms abound. Some examples include imperative programming,<br/>structured  (goto-less)  programming,  </span><b>object-oriented  programming  (OOP),  </b><span>aspect-oriented<br/>programming, and declarative programming. Lately, there has been renewed interest in a particular<br/>paradigm that can arguably be considered to be older than most (if not all) of the cited ones—</span><b>functional</b><span>FP emphasizes writing functions and connecting them in simple ways to produce<br/>more understandable and more easily tested code. Thus, given the increased complexity of today’s web<br/>applications, its logical that a safer, cleaner way of programming would be of interest.</span></p><p style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>This interest in FP comes hand in hand with the evolution of JavaScript. Despite its somewhat hasty<br/>creation (reportedly achieved in only 10 days, in 1995, by Brendan Eich at Netscape), today, JavaScript<br/>is  a standardized and quickly growing language, with features more advanced than most other similarly<br/>popular languages. The ubiquity of the language, which can now be found in browsers, servers, mobile<br/>phones, and whatnot, has also impelled interest in better development strategies. Also, even if JavaScript<br/>wasn’t conceived as a functional language, the fact is that it provides all the features you’d require to<br/>work in that fashion, which is another plus.</span></p><p style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>That said, we must also comment on advances in the language and related tools. The benefits of data<br/>typing are generally acknowledged, and in recent years, TypeScript has gained wide adoption and has<br/>been used for both frontend and backend coding. It makes sense, then, to also include its usage in this<br/>book. This, we feel, will make the examples clearer, and also simplify the adoption of the presented<br/>code for “real-life” jobs.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>It must also be said that FP hasn’t been generally applied in industry, possibly because it has a certain<br/>aura of difficulty, and it is thought to be theoretical rather than practical, even mathematical, and<br/>possibly uses vocabulary and concepts that are foreign to developers—for example, functors, monads,<br/>folding, and category theory. While learning all this theory will certainly be of help, it can also be<br/>argued that even with zero knowledge of the previous terms, you can understand the tenets of FP, and<br/>see how to apply it to your own programming.</span></p><p style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>FP is not something that you have to do on your own, without any help. There are many libraries and<br/>frameworks that incorporate, to greater or lesser degrees, the concepts of FP. Starting with jQuery<br/>(which does include some FP concepts), passing through Underscore and its close relative, Lodash,<br/>and other libraries such as Ramda, and getting to more complete web development tools such as React<br/>and Redux, Angular, and Elm (a 100% functional language, which compiles into JavaScript), the list<br/>of functional aids for your coding is ever growing.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Learning how to use FP can be a worthwhile investment, and even though you may not get to use all<br/>of its methods and techniques, just starting to apply some of them will pay dividends in better code.<br/>You need not try to apply all the concepts of FP from the start, and you need not try to abandon every<br/>non-functional feature in JavaScript either. JavaScript assuredly has some bad features, but it also has</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 23pt;text-indent: 0pt;text-align: left;">xiv  Preface</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>several very good and powerful ones. The idea is not to throw away everything you’ve learned and use<br/>and adopt a 100% functional way; rather, the guiding idea is evolution, not revolution. In that sense,<br/>it can be said that what we’ll be doing is not FP, but rather </span><b>Sorta Functional Programming (SFP),</b>aiming for a fusion of paradigms.</p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>A final comment about the style of the code in this book—it is quite true that there are several very<br/>good libraries that provide you with FP tools: Underscore, Lodash, and Ramda are counted among<br/>them. However, I preferred to eschew their usage because I wanted to show how things really work.<br/>It’s easy to apply a given function from some package or the other, but by coding everything out<br/>(vanilla FP, if you wish), it’s my belief that you get to understand things more deeply. Also, as I will<br/>comment in some places, because of the power and clarity of arrow functions and other features, the<br/>pure JavaScript versions can be even simpler to understand!</span></p><p class="s6" style="padding-top: 8pt;padding-left: 52pt;text-indent: 0pt;text-align: justify;"><a name="bookmark9">Who this book is for</a></p><p style="padding-top: 9pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>This book is geared toward programmers with a good working knowledge of JavaScript (or, better yet,<br/>TypeScript) working either on the client side (browsers) or the server side (Node.js), who are interested<br/>in applying techniques to be able to write better, testable, understandable, and maintainable code. Some<br/>background in computer science (including, for example, data structures) and good programming<br/>practices will also come in handy. In this book, we’ll cover FP in a practical way, though, at times, we<br/>will mention some theoretical points.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-left: 52pt;text-indent: 0pt;text-align: justify;"><a name="bookmark10">What this book covers</a></p><p class="s9" style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: justify;">Chapter 1, Becoming Functional - Several Questions, <span class="p">discusses FP, gives reasons for its usage, and lists<br/>the tools that you’ll need to take advantage of the rest of the book.</span></p><p class="s9" style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;line-height: 126%;text-align: justify;">Chapter 2, Thinking Functionally - A First Example, <span class="p">will provide the first example of FP by considering a<br/>common web-related problem and going over several solutions, to finally focus on a functional solution.</span></p><p class="s9" style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;">Chapter 3, Starting Out with Functions - A Core Concept, <span class="p">will go over the central concept of FP, that<br/>is, functions, and the different options available in JavaScript.</span></p><p class="s9" style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;">Chapter 4, Behaving Properly - Pure Functions, <span class="p">will consider the concept of purity and pure functions,<br/>and demonstrate how it leads to simpler coding and easier testing.</span></p><p class="s9" style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;">Chapter <span class="p">5,  </span>Programming Declaratively - A Better Style, <span class="p">will use simple data structures to show how to<br/>produce results that work not in an imperative way, but in a declarative fashion.</span></p><p class="s9" style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 126%;text-align: justify;">Chapter 6, Producing Functions - Higher-Order Functions, <span class="p">will deal with higher-order functions, which<br/>receive other functions as parameters and produce new functions as results.</span></p><p class="s9" style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: justify;">Chapter 7,  Transforming Functions - Currying and Partial Application, <span class="p">will explore some methods for<br/>producing new and specialized functions from earlier ones.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: right;">Preface  xv</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s9" style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;">Chapter 8,  Connecting Functions - Pipelining, Composition, and More, <span class="p">will show the key concepts<br/>regarding how to build new functions by joining previously defined ones.</span></p><p class="s9" style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;">Chapter 9,  Designing Functions - Recursion, <span class="p">will look at how a key concept in FP, recursion, can be<br/>applied to designing algorithms and functions.</span></p><p class="s9" style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: justify;">Chapter 10,  Ensuring Purity - Immutability, <span class="p">will present some tools that can help you to work in a<br/>pure fashion by providing immutable objects and data structures.</span></p><p class="s9" style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: justify;">Chapter 11,  Implementing Design Patterns - The Functional Way, <span class="p">will show how several popular OOP<br/>design patterns are implemented (or not needed!) when you program in FP ways.</span></p><p class="s9" style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;">Chapter 12, Building Better Containers - Functional Data Types, <span class="p">will explore some more high-level<br/>functional patterns, introducing types, containers, functors, monads, and several other more advanced<br/>FP concepts.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>I have tried to keep the examples in this book simple and down to earth because I want to focus on<br/>the functional aspects and not on the intricacies of this or that problem. Some programming texts<br/>are geared toward learning, say, a given framework, and then working on a given problem, showing<br/>how to fully work it out with the chosen tools.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>In fact, in the very early stages of planning for this book, I entertained the idea of developing an<br/>application that would use all the FP things I had in mind, but there was no way to fit all of that within<br/>a single project. Exaggerating a bit, I felt like an MD trying to find a patient on whom to apply all of his<br/>medical knowledge and treatments! So, I opted to show plenty of individual techniques, which can be<br/>used in multiple situations. Rather than building a house, I want to show you how to put bricks together,<br/>how to wire things up, and so on, so that you will be able to apply whatever you need as you see fit.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-left: 43pt;text-indent: 0pt;text-align: justify;"><a name="bookmark11">To get the most out of this book</a></p><p style="padding-top: 9pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>To understand the concepts and code in this book, you don’t need much more than a JavaScript<br/>environment and a text editor. To be honest, I even developed some of the examples working fully<br/>online, with tools such as JSFiddle (at j sf iddle . net) and the like, and absolutely nothing else.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>In this book, we’ll be using ES2022 and Node 19, and the code will run on any OS, such as Linux,<br/>macOS, or Windows.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>You will need some experience with the latest version of JavaScript because it includes several features<br/>that can help you write more concise and compact code. We will frequently include pointers to online<br/>documentation, such as the documentation available on the </span><b>Mozilla Development Network (MDN)</b>at  developer . mozilla . org, to help you get more in-depth knowledge.</p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><a href="http://www/" class="s11" target="_blank">We’ll also be using the latest version of TypeScript, to add data typing to our JavaScript code. For<br/>more on the language, the must-read reference is </a><span>www. typescriptlang. org, where you’ll find<br/>documentation, tutorials, and even an online playground to directly test code there.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 23pt;text-indent: 0pt;text-align: left;">xvi Preface</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-top: 7pt;padding-left: 53pt;text-indent: 0pt;text-align: left;"><a name="bookmark12">Download the example code files</a></p><p style="padding-top: 9pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>You  can  download  the  example  code  files  for  this  book  from  GitHub  at  github  .  com/<br/>PacktPublishing/Mastering-JavaScript-Functional-          Programming-3E.          If<br/>there’s an update to the code, it will be updated in the GitHub repository.</span></p><p style="padding-top: 7pt;padding-left: 53pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>We also have other code bundles from our rich catalog of books and videos available at github .<br/>com/PacktPublishing/. Check them out!</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-left: 53pt;text-indent: 0pt;text-align: left;"><a name="bookmark13">Download the color images</a></p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: justify;"><a name="bookmark14"><span>We also provide a PDF file that has color images of the screenshots and diagrams used in this book.<br/>You can download it here: https : //packt. link/UsFuE.</span></a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-left: 52pt;text-indent: 0pt;text-align: left;">Conventions used</p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;text-align: justify;">There are a number of text conventions used throughout this book.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Code in text: Indicates code words in text, database table names, folder names, filenames, file<br/>extensions, pathnames, dummy URLs, user input, and Twitter handles. Here is an example: “There<br/>are several possible results: a single value with the reduce () operation, a new array with map (),<br/>or just about any kind of result with f orEach ().”</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;text-align: justify;">A block of code is set as follows:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// reverse.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 73pt;text-indent: -12pt;line-height: 144%;text-align: left;"><span>const   reversestring   =   (str:   string):   string   =&gt;   {<br/>const arr = str.split(&quot;&quot;);</span></p><p style="padding-left: 73pt;text-indent: 0pt;line-height: 142%;text-align: left;"><span>arr.reverse();<br/>return arr.join(&quot;&quot;);</span></p><p style="padding-top: 2pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">};</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 5pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">console.log(reversestring(&quot;MONTEVIDEO&quot;));              // OEDIVETNOM</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>When we wish to draw your attention to a particular part of a code block, the relevant lines or items<br/>are set in bold:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">const reverseString2 = (str: string): string =&gt;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: right;">Preface xvii</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 65pt;text-indent: 0pt;text-align: left;"><a name="bookmark15">str.splitreduceRight((x, y) =&gt; x + y,</a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 9pt;line-height: 223%;text-align: left;"><span>console.log(reverseString2(&quot;OEDIVETNOM&quot;)); // MONTEVIDEO<br/>Any command-line input or output is written as follows:</span></p><p class="s10" style="padding-left: 53pt;text-indent: 0pt;line-height: 10pt;text-align: left;">START MAP</p><p class="s10" style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;line-height: 142%;text-align: left;"><a name="bookmark16"><span>2022-10-29T01:47:06.726Z [ 10, 20, 30, 40 ]<br/>END MAP</span></a></p><p class="s10" style="padding-top: 8pt;padding-left: 43pt;text-indent: 0pt;text-align: left;">Bold: <span class="p">Indicates a new term, an important word, or words that you see onscreen.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-top: 7pt;padding-left: 57pt;text-indent: 0pt;text-align: left;">Tips or important notes</p><p style="padding-top: 4pt;padding-left: 56pt;text-indent: 0pt;text-align: left;">Appear like this.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-left: 43pt;text-indent: 0pt;text-align: left;"><a name="bookmark17">Get in touch</a></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;text-align: left;">Feedback from our readers is always welcome.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 43pt;text-indent: 0pt;line-height: 126%;text-align: left;">General feedback: <span class="p">If you have questions about any aspect of this book, email us at customercare©<br/>packtpub . com and mention the book title in the subject of your message.</span></p><p class="s10" style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;">Errata: <a href="http://www/" class="s11" target="_blank">Although we have taken every care to ensure the accuracy of our content, mistakes do happen.<br/>If                                                                                               you have found a mistake in this book, we would be grateful if you would report this to us. Please<br/>visit </a><span class="p">www. packtpub. com/support/errata and fill in the form.</span></p><p class="s10" style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: left;">Piracy: <span class="p">If you come across any illegal copies of our works in any form on the internet, we would<br/>be grateful if you would provide us with the location address or website name. Please contact us at<br/>copyright@packt. com with a link to the material.</span></p><p class="s10" style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;">If you are interested in becoming an author: <span class="p">If there is a topic that you have expertise in and you<br/>are interested in either writing or contributing to a book, please visit authors . packtpub. com.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><table style="border-collapse:collapse;margin-left:16.93pt" cellspacing="0"><tr style="height:18pt"><td style="width:26pt"><p class="s29" style="padding-left: 2pt;text-indent: 0pt;line-height: 10pt;text-align: left;">xviii</p></td><td style="width:407pt;border-bottom-style:solid;border-bottom-width:1pt"><p class="s29" style="padding-left: 10pt;text-indent: 0pt;line-height: 10pt;text-align: left;">Preface</p></td></tr><tr style="height:107pt"><td style="width:26pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:407pt;border-top-style:solid;border-top-width:1pt"><p class="s30" style="padding-top: 10pt;padding-left: 10pt;text-indent: 0pt;text-align: justify;">Share Your Thoughts</p><p class="s29" style="padding-top: 10pt;padding-left: 9pt;padding-right: 1pt;text-indent: 0pt;line-height: 123%;text-align: justify;">Once you’ve read <i>Mastering JavaScript Functional Programming - Third Edition, </i><span>we’d love to hear<br/>your thoughts! Please click here to go straight to the Amazon review page for this book and share<br/>your feedback.</span></p><p class="s29" style="padding-top: 4pt;padding-left: 10pt;padding-right: 38pt;text-indent: 0pt;line-height: 13pt;text-align: justify;"><span>Your review is important to us and the tech community and will help us make sure we’re delivering<br/>excellent quality content.</span></p></td></tr></table><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: right;">Preface xix</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-top: 5pt;padding-left: 44pt;text-indent: 0pt;text-align: left;"><a name="bookmark18">Download a free PDF copy of this book</a></p><p style="padding-top: 9pt;padding-left: 43pt;text-indent: 0pt;text-align: left;">Thanks for purchasing this book!</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 126%;text-align: left;"><span>Do you like to read on the go but are unable to carry your print books everywhere? Is your eBook<br/>purchase not compatible with the device of your choice?</span></p><p style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;text-align: left;">Don’t worry, now with every Packt book you get a DRM-free PDF version of that book at no cost.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>Read anywhere, any place, on any device. Search, copy, and paste code from your favorite technical<br/>books directly into your application.</span></p><p style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>The perks don’t stop there, you can get exclusive access to discounts, newsletters, and great free content<br/>in your inbox daily</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;text-align: left;">Follow these simple steps to get the benefits:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><ol id="l1"><li data-list-text="1."><p style="padding-left: 70pt;text-indent: -17pt;text-align: left;">Scan the QR code or visit the link below</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 186pt;text-indent: 0pt;text-align: left;"><span><img width="147" height="148" alt="image" src="Image_002.jpg"/></span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 159pt;text-indent: 0pt;text-align: left;"><a href="https://packt.link/free-ebook/9781804610138" class="s11">https://packt.link/free-ebook/9781804610138</a></p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="2."><p style="padding-left: 69pt;text-indent: -17pt;text-align: left;">Submit your proof of purchase</p></li><li data-list-text="3."><p style="padding-top: 6pt;padding-left: 70pt;text-indent: -17pt;text-align: left;">That’s it! We’ll send your free PDF and other benefits to your email directly</p></li></ol><p style="text-indent: 0pt;text-align: left;"><br/></p><h3 style="padding-top: 10pt;text-indent: 0pt;text-align: right;"><a name="bookmark19">1</a><a name="bookmark20">&zwnj;</a></h3><h2 style="padding-top: 4pt;text-indent: 0pt;text-align: right;">Becoming Functional</h2><h2 style="padding-top: 2pt;text-indent: 0pt;text-align: right;">- Several Questions</h2><p class="s10" style="padding-top: 29pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;">Functional programming <span class="p">(or </span>FP) <span class="p">has been around since the earliest days of computing and is going<br/>through a sort of revival because of its increased use with several frameworks and libraries, most<br/>particularly in </span>JavaScript.</p><p style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;text-align: justify;">In this chapter, we shall do the following:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l2"><li data-list-text="•"><p style="padding-left: 70pt;text-indent: -13pt;text-align: left;">Introduce some concepts of FP to give a small taste of what it means</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">Show the benefits (and problems) implied by the usage of FP and why we should use it</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">Start thinking about why JavaScript can be considered an appropriate language for FP</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;line-height: 123%;text-align: left;"><span>Go over the language features and tools that you should be aware of to fully take advantage of<br/>everything in this book</span></p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>By the end of this chapter, you’ll have the basic tools that we’ll be using throughout this book, so let’s<br/>get started by learning about FP.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-left: 43pt;text-indent: 0pt;text-align: justify;"><a name="bookmark21">What is functional programming?</a><a name="bookmark54">&zwnj;</a></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>If you go back in computer history, you’ll find that the second oldest programming language still in<br/>use, Lisp, is based on FP. Since then, there have been many more functional languages, and FP has<br/>been applied more widely. But even so, if you ask people what FP is, you’ll probably get two widely<br/>dissimilar answers.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-top: 5pt;padding-left: 56pt;text-indent: 0pt;text-align: justify;"><a name="bookmark22">A bit of trivia</a></p><p style="padding-top: 4pt;padding-left: 57pt;text-indent: 0pt;line-height: 115%;text-align: justify;"><span>For trivia or history buffs, the oldest programming language still in use is Fortran, which<br/>appeared in 1957, a year before Lisp. Quite shortly after Lisp came another long-lived language,<br/>COBOL, for business-oriented programming.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 29pt;text-indent: 0pt;text-align: left;">2  Becoming Functional - Several Questions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Depending on whom you ask, you’ll either learn that it’s a modern, advanced, enlightened approach<br/>to programming that leaves every other paradigm behind or that it’s mainly a theoretical thing, with<br/>more complications than benefits, that’s practically impossible to implement in the real world. And,<br/>as usual, the real answer is not in the extremes, but somewhere in between. Let’s start by looking at<br/>the theory versus practice and see how we plan to use FP.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 52pt;text-indent: 0pt;text-align: justify;"><a name="bookmark23">Theory versus practice</a><a name="bookmark55">&zwnj;</a></p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>In this book, we won’t be going about FP in a theoretical way. Instead, our point is to show you<br/>how some of its techniques and tenets can be successfully applied to common, everyday JavaScript<br/>programming. But - and this is important - we won’t be going about this dogmatically, but in a very<br/>practical way. We won’t dismiss useful JavaScript constructs simply because they don’t happen to<br/>fulfill the academic expectations of FP. Similarly, we won’t avoid practical JavaScript features just to<br/>fit the FP paradigm. We could almost say that we’ll be doing </span><b>Sorta Functional Programming (SFP)</b>because our code will be a mixture of FP features, more classical imperative ones, and <b>object-oriented</b></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Be careful, though: what we just said doesn’t mean that we’ll be leaving all the theory by the side. We’ll<br/>be picky, and just touch the main theoretical points, learn some vocabulary and definitions, and explain<br/>core FP concepts, but we’ll always be keeping in sight the idea of producing actual, useful JavaScript<br/>code, rather than trying to meet some mystical, dogmatic FP criteria.</span></p><p style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>OOP has been a way to solve the inherent complexity of writing large programs and systems, and<br/>developing clean, extensible, scalable application architectures; however, because of the scale of today’s<br/>web applications, the complexity of all code bases is continuously growing. Also, the newer features<br/>of JavaScript make it possible to develop applications that wouldn’t even have been possible just a few<br/>years ago; think of mobile (hybrid) apps that are made with Ionic, Apache Cordova, or React Native or<br/>desktop apps that are made with Electron, Tauri, or NW.js, for example. JavaScript has also migrated<br/>to the backend with Node.js or Deno, so today, the scope of usage for the language has grown in<br/>a serious way that deals with all the added complexity of modern designs.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 52pt;text-indent: 0pt;text-align: justify;"><a name="bookmark24">A different way of thinking</a><a name="bookmark56">&zwnj;</a></p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>FP is a different way of writing programs and can sometimes be difficult to learn. In most languages,<br/>programming is done imperatively: a program is a sequence of statements, executed in a prescribed<br/>fashion, and the desired result is achieved by creating objects and manipulating them, which usually<br/>means modifying the objects themselves. FP is based on producing the desired result by evaluating<br/>expressions built out of functions that are composed together. In FP, it’s common to pass functions<br/>around (such as passing parameters to other functions or returning functions as the result of<br/>a calculation), not use loops (opting for recursion instead), and skip side effects (such as modifying<br/>objects or global variables).</span></p><p style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;">In other words, FP focuses on <i>what </i>should be done, rather than on <i>how </i><span>it should be done. Instead of<br/>worrying about loops or arrays, you work at a higher level, considering what needs to be done. After</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 314pt;text-indent: 0pt;text-align: left;">What is functional programming?  3</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 42pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>becoming accustomed to this style, you’ll find that your code becomes simpler, shorter, and more<br/>elegant, and can be easily tested and debugged. However, don’t fall into the trap of considering FP as<br/>the goal! Think of FP only as a means to an end, as with all software tools. Functional code isn’t good<br/>just for being functional, and writing bad code is just as possible with FP as with any other technique!</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 44pt;text-indent: 0pt;text-align: justify;"><a name="bookmark25">FP and other programming paradigms</a><a name="bookmark57">&zwnj;</a></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: justify;"><span>Programming paradigms classify programming languages according to their features. However, some<br/>languages may be classified into multiple paradigms - as is the case of JavaScript itself!</span></p><p style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;">A primary division is <i>imperative </i>versus <i>declarative </i><span>languages. In the former, developers must instruct<br/>the machine on how to do its work, step by step. Programming may be </span><i>procedural </i><span>(if instructions are<br/>grouped into procedures) or </span><i>object-oriented </i>(if instructions are grouped with a related state).</p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>In declarative languages, in opposition, developers just declare properties that the sought result must<br/>satisfy, but not how to calculate it. Declarative languages may be </span><i>logic-based </i><span>(based on logic rules and<br/>constraints), </span><i>reactive </i>(based on data and event streams), or <i>functional </i><span>(based on the application and<br/>combination of functions). In a sense, we could say that imperative languages focus on </span><i>how, </i><span>while<br/>declarative languages focus on </span><i>what.</i></p><p style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>JavaScript is multi-paradigm: it’s imperative (both procedural and object-oriented) but also allows<br/>declarative programming, both functional (like almost everything in this book! In particular, we<br/>will devote </span><i>Chapter 5, Programming Declaratively, </i><span>to this topic) and reactive (we’ll see reactive FP in<br/></span><i>Chapter 11, Implementing Design Patterns).</i></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: justify;"><span>Just to give you a basic example of the difference between imperative and declarative ways of solving a<br/>problem, let’s solve a simple problem: assume you have an array of personal data of people, as follows:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// imperative.js</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">const data = [</p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">{ name: &quot;John&quot;, age: 23, other: &quot;xxx&quot; },</p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">{ name: &quot;Paul&quot;, age: 18, other: &quot;yyy&quot; },</p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">{ name: &quot;George&quot;, age: 16, other: &quot;zzz&quot;</p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">{ name: &quot;Ringo&quot;, age: 25, other: &quot;ttt&quot; }</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Imagine you want to extract the data for adults (at least 21 years old). Imperatively, you would do<br/>something like the following:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 6pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">const resultl     <span class="s32">= 11 ;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 29pt;text-indent: 0pt;text-align: left;">4  Becoming Functional - Several Questions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 74pt;text-indent: -12pt;line-height: 144%;text-align: left;"><span>for (let i = 0; i &lt; data.length; i++) {<br/>if (data[i].age &gt;= 21) {</span></p><p style="padding-left: 85pt;text-indent: 0pt;text-align: left;">resultl.push(data[i] ) ;</p><p style="padding-top: 6pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">}</p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>You have to initialize the output array (resultl) for the selected people. Then, you must specify a<br/>loop, saying how the index variable (i) is to be initialized, tested, and updated. On each pass of the<br/>loop, you check the corresponding persons age, and if the person is an adult, you push the data to<br/>the output array. In other terms, you specify, step by step, everything that the code will have to do.</span></p><p style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;text-align: justify;">Working declaratively, you’d rather write something like this:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// declarative.js</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;line-height: 144%;text-align: left;">const <b>isAdult = </b><span>(person) =&gt; person.age &gt;= 21;<br/>const result2 = </span><b>data.filter(isAdult);</b></p><p style="padding-top: 8pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>The first line declares how to test if a person is an adult; the second line says that the result is the result<br/>of filtering the data array, picking those elements that satisfy the given predicate. (For isAdult (),<br/>we’re using an arrow function; we’ll see more on that in the </span><i>Arrow functions </i><span>section, later in this<br/>chapter.) You don’t have to initialize the output array, specify how to loop, or ensure that your array<br/>index doesn’t go beyond the array’s length, and so on - all those details are taken care of by the<br/>language, so you don’t need to.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><a name="bookmark26"><span>Reading and understanding the imperative version requires knowledge of both the programming<br/>language and algorithms or techniques for looping; the declarative version is shorter to write, easier<br/>to maintain, and much more readable.</span></a><a name="bookmark58">&zwnj;</a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 52pt;text-indent: 0pt;text-align: justify;">What FP is not</p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: justify;"><span>Since we’ve been talking quite a bit about what FP is, let’s also clear up some common misconceptions,<br/>and look at what FP is not:</span></p><ul id="l3"><li data-list-text="•"><p class="s9" style="padding-top: 8pt;padding-left: 79pt;text-indent: -13pt;line-height: 124%;text-align: justify;">FP isn’t just an academic ivory tower thing: <span class="p">The lambda calculus upon which it is based was<br/>developed by Alonzo Church in 1936 as a tool to prove an important result in theoretical<br/>computer science (which preceded modern computer languages by more than 20 years!);<br/>however, FP languages are being used today for all kinds of systems.</span></p></li><li data-list-text="•"><p class="s33" style="padding-top: 5pt;padding-left: 79pt;text-indent: -12pt;line-height: 123%;text-align: justify;">	<span class="s9">FP isn’t the opposite of OOP: </span><span class="p">It isn’t a case of choosing declarative or imperative ways of<br/>programming. You can mix and match as best suits you, and we’ll be doing this throughout<br/>this book, bringing together the best of all worlds.</span></p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: right;">Why use FP?  5</p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l4"><li data-list-text="•"><p class="s9" style="padding-left: 70pt;text-indent: -12pt;line-height: 124%;text-align: justify;">FP isn’t overly complex to learn: <span class="p">Some of the FP languages are rather different from JavaScript,<br/>but the differences are mostly syntactic. Once you learn the basic concepts, you’ll see that you<br/>can get the same results in JavaScript as with FP languages.</span></p><p style="padding-top: 8pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>It may also be relevant to mention that several modern frameworks, such as the React and Redux<br/>combination, include FP ideas.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>For example, in React, it’s said that the view (whatever the user gets to see at a given moment) is a<br/>function of the current state. You use a function to compute what HTML and CSS must be produced<br/>at each moment, thinking in a black-box fashion.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Similarly, in Redux, you have the concept of actions that are processed by reducers. An action provides<br/>some data, and a reducer is a function that produces the new state for the application in a functional<br/>way out of the current state and the provided data.</span></p><p style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>So, both because of the theoretical advantages (we’ll be getting to those in the following section)<br/>and the practical ones (such as getting to use the latest frameworks and libraries), it makes sense to<br/>consider FP coding. Let’s get on with it.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-left: 43pt;text-indent: 0pt;text-align: justify;"><a name="bookmark27">Why use FP?</a><a name="bookmark59">&zwnj;</a></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Throughout the years, there have been many programming styles and fads. However, FP has proven<br/>quite resilient and is of great interest today. Why would you want to use FP? Rather, the first question<br/>to ask should be, what do you need? And only then, does FP get you that? We’ll answer these important<br/>questions in the following sections.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 43pt;text-indent: 0pt;text-align: justify;"><a name="bookmark28">What we need</a><a name="bookmark60">&zwnj;</a></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>We can certainly agree that the following list of concerns is universal. Our code should have the<br/>following qualities:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="•"><p class="s33" style="padding-left: 70pt;text-indent: -13pt;line-height: 123%;text-align: justify;">	<span class="s10">Modular: </span><span class="p">The functionality of your program should be divided into independent modules,<br/>each of which contains a part of the solution. Changes in a module or function shouldn’t affect<br/>the rest of the code.</span></p></li><li data-list-text="•"><p class="s10" style="padding-top: 5pt;padding-left: 70pt;text-indent: -13pt;line-height: 124%;text-align: justify;">Understandable: <span class="p">A reader of your program should be able to discern its components, functions,<br/>and relationships without undue effort. This is closely linked with the </span>maintainability <span class="p">of the<br/>code; your code will have to be maintained in the future, whether to be changed or to have<br/>new functionality added.</span></p></li><li data-list-text="•"><p class="s10" style="padding-top: 5pt;padding-left: 70pt;text-indent: -12pt;line-height: 124%;text-align: justify;">Testable: Unit tests <span class="p">try out small parts of your program, verifying their behavior independently<br/>of the rest of the code. Your programming style should favor writing code that simplifies the<br/>job of writing unit tests. Unit tests are also like documentation in that they can help readers<br/>understand what the code is supposed to do.</span></p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 29pt;text-indent: 0pt;text-align: left;">6  Becoming Functional - Several Questions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l5"><li data-list-text="•"><p class="s10" style="padding-left: 79pt;text-indent: -13pt;line-height: 123%;text-align: justify;">Extensible: <span class="p">It’s a fact that your program will someday require maintenance, possibly to add new<br/>functionality. Those changes should impact the structure and data flow of the original code<br/>only minimally (if at all). Small changes shouldn’t imply large, serious refactoring of your code.</span></p></li><li data-list-text="•"><p class="s10" style="padding-top: 6pt;padding-left: 79pt;text-indent: -12pt;line-height: 123%;text-align: justify;">Reusable: <span class="p">Code reuse has the goal of saving resources, time, and money, and reducing redundancy<br/>by taking advantage of previously written code. Some characteristics help with this goal, such as<br/></span>modularity <span class="p">(which we already mentioned), </span>high cohesion <span class="p">(all the pieces in a module belong<br/>together), </span>low coupling <span class="p">(modules are independent of each other), </span><span>separation of concerns<br/></span><span class="p">(the parts of a program should overlap in functionality as little as possible), and </span><span>information<br/>hiding </span><span class="p">(internal changes in a module shouldn’t affect the rest of the system).</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 52pt;text-indent: 0pt;text-align: justify;"><a name="bookmark29">What we get</a><a name="bookmark61">&zwnj;</a></p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;text-align: justify;">So, does FP give you the five characteristics we just listed in the previous section?</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="•"><p class="s33" style="padding-left: 79pt;text-indent: -13pt;line-height: 123%;text-align: left;">	<span class="p">In FP, the goal is to write separate independent functions that are joined together to produce<br/>the final results.</span></p></li><li data-list-text="•"><p class="s33" style="padding-top: 5pt;padding-left: 79pt;text-indent: -12pt;line-height: 123%;text-align: left;">	<span class="p">Programs that are written in a functional style usually tend to be cleaner, shorter, and easier<br/>to understand.</span></p></li><li data-list-text="•"><p style="padding-top: 5pt;padding-left: 80pt;text-indent: -14pt;text-align: left;">Functions can be tested on their own, and FP code has advantages in achieving this.</p></li><li data-list-text="•"><p class="s33" style="padding-top: 8pt;padding-left: 79pt;text-indent: -12pt;line-height: 123%;text-align: justify;">	<span class="p">You can reuse functions in other programs because they stand on their own, not depending on<br/>the rest of the system. Most functional programs share common functions, several of which<br/>we’ll be considering in this book.</span></p></li><li data-list-text="•"><p class="s33" style="padding-top: 6pt;padding-left: 79pt;text-indent: -12pt;line-height: 123%;text-align: justify;">	<span class="p">Functional code is free from side effects, which means you can understand the objective of a<br/>function by studying it without having to consider the rest of the program.</span></p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Finally, once you get used to the FP style of programming, code becomes more understandable and<br/>easier to extend. So, it seems that all five characteristics can be achieved with FP!</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 65pt;text-indent: 0pt;text-align: justify;"><a name="bookmark30">Why use FP?</a></p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;line-height: 115%;text-align: justify;">For a well-balanced look at the reasons to use FP, I’d suggest reading <i>Why Functional Programming</i><span>Matters, by John Hughes; it’s available online at www.es .kent. ac . uk/people/staf f /<br/>dat/miranda/whyfp90 . pdf. It’s not geared toward JavaScript, but the arguments are<br/>easily understandable.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 53pt;text-indent: 0pt;text-align: justify;"><a name="bookmark31">Not all is gold</a><a name="bookmark62">&zwnj;</a></p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>However, let’s strive for a bit of balance. Using FP isn’t a silver bullet that will automagically make<br/>your code better. Some FP solutions are tricky, and some developers greatly enjoy writing code and<br/>then asking, what does this do? If you aren’t careful, your code may become write-only and practically<br/>impossible to maintain; there goes understandable, extensible, and reusable out the door!</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 12pt;padding-left: 350pt;text-indent: 0pt;text-align: left;">Is JavaScript functional?  7</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Another disadvantage is that you may find it harder to find FP-sawy developers. (Quick question:<br/>how many </span><i>FP-sought </i><span>job ads have you ever seen?) The vast majority of today’s web code is written in<br/>imperative, non-functional ways, and most coders are used to that way of working. For some, having<br/>to switch gears and start writing programs differently may prove an unpassable barrier.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Finally, if you try to go fully functional, you may find yourself at odds with JavaScript, and simple<br/>tasks may become hard to do. As we said at the beginning, we’ll opt for SFP, so we won’t be drastically<br/>rejecting any language features that aren’t 100% functional. After all, we want to use FP to simplify<br/>our coding, not to make it more complex!</span></p><p style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>So, while I’ll strive to show you the advantages of going functional in your code, as with any change,<br/>there will always be some difficulties. However, I’m fully convinced that you’ll be able to surmount<br/>them and that your organization will develop better code by applying FP. Dare to change! So, given<br/>that you accept that FP may apply to your problems, let’s consider the other question: can we use<br/>JavaScript in a functional way and is it appropriate?</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-left: 44pt;text-indent: 0pt;text-align: justify;"><a name="bookmark32">Is JavaScript functional?</a><a name="bookmark63">&zwnj;</a></p><p style="padding-top: 10pt;padding-left: 41pt;text-indent: 1pt;line-height: 124%;text-align: justify;">At about this time, there is another important question that you should be asking: <i>is JavaScript a</i><span>Usually, when thinking about FP, the list of languages that are mentioned does<br/>not include JavaScript, but does include less common options, such as Clojure, Erlang, Haskell, and<br/>Scala; however, there is no precise definition for FP languages or a precise set of features that such<br/>languages should include. The main point is that you can consider a language to be functional if it<br/>supports the common programming style associated with FP. Let’s start by learning about why we<br/>would want to use JavaScript at all and how the language has evolved to its current version, and then<br/>see some of the key features that we’ll be using to work in a functional way.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 43pt;text-indent: 0pt;text-align: justify;"><a name="bookmark33">JavaScript as a tool</a><a name="bookmark64">&zwnj;</a></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><a href="http://www/" class="s11" target="_blank">What is JavaScript? If you consider popularity indices, such as the ones at </a><span>www. tiobe . com/<br/>tiobe-index/  or  pypl.  github  .  io/PYPL  .  html,  you’ll  find  that  JavaScript  is  consistently<br/>in the top 10 most popular languages. From a more academic point of view, the language is sort of<br/>a mixture, borrowing features from several different languages. Several libraries helped the growth<br/>of the language by providing features that weren’t so easily available, such as classes and inheritance<br/>(today’s version of the language does support classes, but that was not the case not too long ago), that<br/>otherwise had to be achieved by doing some prototype tricks.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 56pt;text-indent: 0pt;text-align: left;"><a name="bookmark34">What’s in a name?</a></p><p style="padding-top: 4pt;padding-left: 56pt;text-indent: 0pt;line-height: 113%;text-align: left;">The name <i>JavaScript </i><span>was chosen to take advantage of the popularity of Java - just as a marketing<br/>ploy! Its first name was </span><i>Mocha, </i>then, <i>LiveScript, </i>and only then <i>JavaScript.</i></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 29pt;text-indent: 0pt;text-align: left;">8  Becoming Functional - Several Questions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>JavaScript has grown to be incredibly powerful. But, as with all power tools, it gives you a way to not<br/>only produce great solutions but also to do great harm. FP could be considered as a way to reduce<br/>or leave aside some of the worst parts of the language and focus on working in a safer, better way;<br/>however, due to the immense amount of existing JavaScript code, you cannot expect it to facilitate<br/>large reworkings of the language that would cause most sites to fail. You must learn to live with the<br/>good and the bad, and simply avoid the latter part.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>In addition, the language has a broad variety of available libraries that complete or extend the language<br/>in many ways. In this book, we’ll be focusing on using JavaScript on its own, but we will make references<br/>to existing, available code.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>If we ask whether JavaScript is functional, the answer will be, once again, “sorta”. It can be seen as<br/>functional because of several features, such as first-class functions, anonymous functions, recursion,<br/>and closures - we’ll get back to this later. On the other hand, it also has plenty of non-FP aspects, such<br/>as side effects (impurity), mutable objects, and practical limits to recursion. So, when programming in<br/>a functional way, we’ll be taking advantage of all the relevant, appropriate language features, and we’ll<br/>try to minimize the problems caused by the more conventional parts of the language. In this sense,<br/>JavaScript will or won’t be functional, depending on your programming style!</span></p><p style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>If you want to use FP, you should decide which language to use; however, opting for fully functional<br/>languages may not be so wise. Today, developing code isn’t as simple as just using a language; you<br/>will surely require frameworks, libraries, and other sundry tools. If we can take advantage of all the<br/>provided tools but at the same time introduce FP ways of working in our code, we’ll be getting the<br/>best                                                                                                   of both worlds, regardless of whether JavaScript is functional!</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 52pt;text-indent: 0pt;text-align: justify;"><a name="bookmark35">Going functional with JavaScript</a><a name="bookmark65">&zwnj;</a></p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>JavaScript has evolved through the years, and the version we’ll be using is (informally) called JS13,<br/>and (formally) ECMAScript 2022, usually shortened to ES2022 or ESI3; this version was finalized in<br/>June 2022. The previous versions were as follows:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l6"><li data-list-text="•"><p style="padding-left: 79pt;text-indent: -13pt;text-align: left;">ECMAScript 1, June 1997</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 80pt;text-indent: -13pt;line-height: 123%;text-align: left;"><span>ECMAScript 2, June 1998, which was the same as the previous version, ECMAScript 3, December<br/>1999, with several new functionalities</span></p></li><li data-list-text="•"><p class="s33" style="padding-top: 5pt;padding-left: 79pt;text-indent: -12pt;line-height: 125%;text-align: left;">	<span class="p">ECMAScript 5, December 2009 (and no, there never was an ECMAScript 4, because it<br/>was abandoned)</span></p></li><li data-list-text="•"><p style="padding-top: 5pt;padding-left: 79pt;text-indent: -13pt;text-align: left;">ECMAScript 5.1, June 2011</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 79pt;text-indent: -13pt;line-height: 123%;text-align: left;"><span>ECMAScript 6 (or ES6; later renamed ES2015), June 2015 ECMAScript 7 (also ES7, or ES2016),<br/>June 2016 ECMAScript 8 (ES8 or ES2017), June 2017</span></p></li><li data-list-text="•"><p style="padding-top: 5pt;padding-left: 79pt;text-indent: -13pt;text-align: left;">ECMAScript 9 (ES9 or ES2018), June 2018</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 79pt;text-indent: -13pt;text-align: left;">ECMAScript 10 (ES10 or ES2019), June 2019</p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 350pt;text-indent: 0pt;text-align: left;">Is JavaScript functional?  9</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l7"><li data-list-text="•"><p style="padding-left: 70pt;text-indent: -13pt;text-align: left;">ECMAScript 11 (ES11 or ES2020), June 2020</p></li><li data-list-text="•"><p style="padding-top: 7pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">ECMAScript 12 (ES12 or ES2021), June 2021</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-top: 8pt;padding-left: 56pt;text-indent: 0pt;text-align: justify;"><a name="bookmark36">What’s ECMA?</a></p><p style="padding-top: 4pt;padding-left: 56pt;text-indent: 0pt;line-height: 115%;text-align: justify;"><a href="http://www/" class="s11" target="_blank">ECMA originally stood for European Computer Manufacturers Association, but nowadays,<br/>the name isn’t considered an acronym anymore. The organization is responsible for standards<br/>other than JavaScript as well, including JSON, C#, Dart, and others. For more details, go to its<br/>site at </a>www. ecma- international. org/.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>You  can  read  the  standard  language  specification  at  www  .  ecma-  international.  org/<br/>publications-and-standards/  standards/  ecma-2  62/.  Whenever  we  refer  to  JavaScript<br/>in the text without further specification, ESI3 (ES2022) is what is being referred to; however, in terms<br/>of the language features that are used in this book, if you were just to use ES2015, then you’d mostly<br/>have no problems with this book.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>No browsers fully implement ES13; most provide an older version, JavaScript 5 (from 2009), with an<br/>(always growing) smattering of features from ES6 up to ES13. This will prove to be a problem, but<br/>fortunately, a solvable one; we’ll get to this shortly. We’ll be using ESI3 throughout this book.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-top: 5pt;padding-left: 57pt;text-indent: 0pt;text-align: justify;"><a name="bookmark37">Differences, differences...</a></p><p style="padding-top: 4pt;padding-left: 56pt;text-indent: 0pt;line-height: 115%;text-align: justify;"><span>There are only a few differences between ES2016 and ES2015, such as the Array. prototype.<br/>includes method and the exponentiation operator, **. There are more differences between<br/>ES2017 and ES20f6 - such as async and await, some string padding functions, and more -<br/>but they won’t impact our code. We will also be looking at alternatives for even more modern<br/>additions, such as f latMap (), in later chapters.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>As we are going to work with JavaScript, let’s start by considering its most important features that<br/>pertain to our FP goals.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 44pt;text-indent: 0pt;text-align: justify;"><a name="bookmark38">Key features of JavaScript</a><a name="bookmark66">&zwnj;</a></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>JavaScript isn’t a purely functional language, but it has all the features that we need for it to work as<br/>if it were. The main features of the language that we will be using are as follows:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="•"><p style="padding-left: 70pt;text-indent: -13pt;text-align: left;">Functions as first-class objects</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">Recursion</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">Closures</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">Arrow functions</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">Spread</p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 26pt;text-indent: 0pt;text-align: left;">10  Becoming Functional - Several Questions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Lets see some examples of each one and find out why they will be useful to us. Keep in mind, though,<br/>that there are more features of JavaScript that we will be using; the upcoming sections just highlight<br/>the most important features in terms of what we will be using for FP.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s34" style="padding-left: 52pt;text-indent: 0pt;text-align: justify;">Functions as first-class objects</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;">Saying that functions are <b>first-class objects </b>(also called <b>first-class entities </b>or <b>first-class citizens)</b><span>means that you can do everything with functions that you can do with other objects. For example, you<br/>can store a function in a variable, you can pass it to a function, you can print it out, and so on. This<br/>is really the key to doing FP; we will often be passing functions as parameters (to other functions) or<br/>returning a function as the result of a function call.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;">If you have been doing async Ajax calls, then you have already been using this feature: a <b>callback </b><span>is<br/>a function that will be called after the Ajax call finishes and is passed as a parameter. Using jQuery,<br/>you could write something like the following:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">$.get(&quot;some/url&quot;, someData, function(result, status) {</p><p style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">// check status, and do something</p><p style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">// with the result</p><p style="padding-top: 6pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">});</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">The $ . get () function receives a callback function as a parameter and calls it after the result is obtained.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-top: 7pt;padding-left: 65pt;text-indent: 0pt;text-align: justify;"><a name="bookmark39">The way to go</a></p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;text-align: justify;">This is better solved, in a more modern way, by using promises or async/await, but for</p><p style="padding-top: 1pt;padding-left: 65pt;text-indent: 0pt;line-height: 115%;text-align: justify;"><span>the sake of our example, the old way is enough. We’ll be getting back to promises, though,<br/>in </span><i>Chapter 12, Building Better Containers, </i><span>when we discuss monads; in particular, see the<br/></span><i>Unexpected monads - promises </i>section.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>Since functions can be stored in variables, you could also write something like the following. Pay<br/>attention to how we use the doSomething variable in the $ . get (...) call:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;text-align: left;">var doSomething = function(result, status) {</p><p style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">// check status, and do something</p><p style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">// with the result</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: justify;">$.get(&quot;some/url&quot;, someData, <b>doSomething);</b></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">Well be seeing more examples of this in <i>Chapter 6, Producing Functions.</i></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 12pt;padding-left: 350pt;text-indent: 0pt;text-align: left;">Is JavaScript functional?  11</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s34" style="padding-top: 8pt;padding-left: 43pt;text-indent: 0pt;text-align: left;">Recursion</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><b>Recursion </b><span>is the most potent tool for developing algorithms and a great aid for solving large classes<br/>of problems. The idea is that a function can, at a certain point, call itself and, when </span><i>that </i><span>call is done,<br/>continue working with whatever result it has received. This is usually quite helpful for certain classes<br/>of problems or definitions. The most often quoted example is the factorial function (the factorial of<br/></span><i>n </i>is written as n/), as defined for nonnegative integer values:</p><ul id="l8"><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">If <i>n </i>is 0, then <i>n\ = </i>1</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">If <i>n </i>is greater than 0, then <i>nl = n </i>* (n-1)!</p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-top: 7pt;padding-left: 57pt;text-indent: 0pt;text-align: justify;"><a name="bookmark40">Arranging things</a></p><p style="padding-top: 4pt;padding-left: 56pt;text-indent: 0pt;line-height: 115%;text-align: justify;">The value of <i>n! </i>is the number of ways that you can arrange <i>n </i><span>different elements in a row. For<br/>example, if you want to place five books in line, you can pick any of the five for the first place,<br/>and then order the other four in every possible way, so 5! = 5*4!. To order those four, you can<br/>pick any of them for the first place, and then order the other three in every way, so 4! = 4*3!. If<br/>you continue to work on this example, you’ll end up with 5! = 5*4*3*2*1=120, and in general,<br/>n! is the product of all numbers up to </span><i>n.</i></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;text-align: justify;">This can be immediately turned into code:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: justify;">// factorial.js</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 65pt;text-indent: -12pt;line-height: 139%;text-align: left;"><span>function fact(n) {<br/>if (n === 0) {</span></p><p style="text-indent: 0pt;text-align: right;">return 1;</p><p style="padding-top: 4pt;text-indent: 0pt;text-align: right;">} else {</p><p style="padding-top: 4pt;text-indent: 0pt;text-align: right;">return n * fact(n - 1);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: right;">console.log(fact(5)); // 120</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Recursion will be a great aid for designing algorithms. By using recursion, you could do without any<br/>whi 1 e or f or loops - not that we want to do that, but it’s interesting that we can! We’ll be devoting the<br/>entirety of </span><i>Chapter </i>9, <i>Designing Functions, </i>to designing algorithms and writing functions recursively.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 26pt;text-indent: 0pt;text-align: left;">12  Becoming Functional - Several Questions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s34" style="padding-left: 52pt;text-indent: 0pt;text-align: left;">Closures</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Closures are a way to implement data hiding (with private variables), which leads to modules and<br/>other nice features. The key concept of closures is that when you define a function, it can refer to not<br/>only its local variables but also to everything outside of the context of the function. We can write a<br/>counting function that will keep its count using a closure:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// closure.js</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 74pt;text-indent: -12pt;line-height: 144%;text-align: left;"><span>function newCounterO {<br/>let count = 0;</span></p><p style="padding-left: 85pt;text-indent: -12pt;line-height: 146%;text-align: left;"><span>return function () {<br/>count++;</span></p><p style="padding-left: 85pt;text-indent: 0pt;line-height: 10pt;text-align: left;">return count;</p><p style="padding-top: 6pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">};</p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">const   nc   =   newCounterO;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><table style="border-collapse:collapse;margin-left:59.38pt" cellspacing="0"><tr style="height:13pt"><td style="width:89pt"><p class="s29" style="padding-left: 2pt;text-indent: 0pt;line-height: 10pt;text-align: left;">console.log(nc());</p></td><td style="width:30pt"><p class="s29" style="padding-left: 8pt;text-indent: 0pt;line-height: 10pt;text-align: left;">//</p></td><td style="width:22pt"><p class="s29" style="padding-right: 2pt;text-indent: 0pt;line-height: 10pt;text-align: right;">1</p></td></tr><tr style="height:15pt"><td style="width:89pt"><p class="s29" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">console.log(nc());</p></td><td style="width:30pt"><p class="s29" style="padding-top: 1pt;padding-left: 8pt;text-indent: 0pt;text-align: left;">//</p></td><td style="width:22pt"><p class="s29" style="padding-top: 1pt;padding-right: 2pt;text-indent: 0pt;text-align: right;">2</p></td></tr><tr style="height:13pt"><td style="width:89pt"><p class="s29" style="padding-top: 2pt;padding-left: 2pt;text-indent: 0pt;line-height: 9pt;text-align: left;">console.log(nc()); // 3</p></td><td style="width:30pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:22pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr></table><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Even after newCounter () exits, the inner function still has access to count, but that variable is<br/>not accessible to any other parts of your code.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>This isn’t a very good example of FP - a function (nc (), in this case) isn’t expected to return different<br/>results when called with the same parameters!</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;">Well find several uses for closures, such as <b>memoization </b>(see <i>Chapter 4, Behaving Properly, </i><span>and<br/></span><i>Chapter 6, Producing Functions&#39;) </i>and the <b>module pattern </b>(see <i>Chapter 3, Starting Out with Functions,</i>and <i>Chapter 11, Implementing Design Patterns), </i>among others.</p><p class="s34" style="padding-top: 8pt;padding-left: 52pt;text-indent: 0pt;text-align: justify;">Arrow functions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;">Arrow functions <span class="p">are just a shorter, more succinct way of creating an (unnamed) function. Arrow<br/>functions can be used almost everywhere a classical function can be used, except that they cannot be<br/>used  as  constructors.  The  syntax  is  either  (parameter,  anotherparameter,  ...etc)  =&gt;</span></p><p style="padding-left: 52pt;text-indent: 1pt;line-height: 124%;text-align: justify;"><span>{   statements   }or   (parameter,   anotherparameter,   ...etc)   =&gt;   expression.<br/>The first allows you to write as much code as you want, while the second is short for { return<br/>expression }.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 350pt;text-indent: 0pt;text-align: left;">Is JavaScript functional?  13</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: left;">We could rewrite our earlier Ajax example as follows:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">$.get(&quot;some/url&quot;, data, (result, status) =&gt; {</p><p style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// check status, and do something</p><p style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// with the result</p><p style="padding-top: 6pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">});</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>A new version of the factorial code could be like the following code - the only difference is the usage<br/>of an arrow function:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// factorial.js, continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 54pt;text-indent: 0pt;line-height: 141%;text-align: center;"><span>const fact2 = (n) =&gt; {<br/>if (n === 0) {</span></p><p style="padding-left: 51pt;text-indent: 0pt;text-align: center;">return 1;</p><p style="padding-top: 4pt;padding-left: 29pt;text-indent: 0pt;text-align: center;">} else {</p><p style="padding-top: 4pt;padding-left: 23pt;text-indent: 0pt;text-align: center;">return n * fact2(n - 1);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 57pt;text-indent: 0pt;text-align: justify;"><a name="bookmark41">Functions, anonymous</a></p><p style="padding-top: 4pt;padding-left: 55pt;text-indent: 1pt;line-height: 115%;text-align: justify;"><span>Arrow functions are usually called anonymous functions because of their lack of a name. If<br/>you need to refer to an arrow function, you’ll have to assign it to a variable or object attribute,<br/>as we did here; otherwise, you won’t be able to use it. We’ll learn more about this in the </span><i>Arrow</i>section of <i>Chapter 3, Starting Out with Functions.</i></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>You would probably write f act2 () as a one-liner - can you see the equivalence to our earlier code?<br/>Using a ternary operator instead of i f is quite common:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s9" style="padding-left: 53pt;text-indent: 0pt;text-align: justify;">11 <span class="p">continued...</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">const fact3 = (n) =&gt; (n === 0 ? 1 : n * fact3(n - 1));</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: left;">With this shorter form, you don’t have to write return - it’s implied.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 26pt;text-indent: 0pt;text-align: left;">14  Becoming Functional - Several Questions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 65pt;text-indent: 0pt;text-align: justify;"><a name="bookmark42">Functions - the lambda way</a></p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;line-height: 115%;text-align: justify;">In lambda calculus, a function such as <i>x =&gt; 2*x </i>would be represented as <i>Xx.2*x. </i><span>Although there<br/>are syntactical differences, the definitions are analogous. Functions with more parameters are<br/>a bit more complicated; </span><i>(x,y)=&gt;x+y </i>would be expressed as <i>Xx.Xy.x+y. </i><span>We’ll learn more about<br/>this in the </span><i>Of lambdas and functions </i>section of <i>Chapter 3, Starting Out with Functions, </i><span>and in<br/>the </span><i>Currying </i>section of <i>Chapter </i>7, <i>Transforming Functions.</i></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>There’s one other small thing to bear in mind: when the arrow function has a single parameter, you can<br/>omit the parentheses around it. I usually prefer leaving them, but I’ve applied a JavaScript beautifier,<br/></span><i>Prettier, </i><span>to the code, which removes them. It’s really up to you whether to include them or not! (For<br/>more on this tool, check out github . com/pret tier/prettier.) By the way, my options for<br/>formatting were --print-width 75 -- tab-width 2 --no-bracket-spacing.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s34" style="padding-left: 52pt;text-indent: 0pt;text-align: left;">Spread</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>The  spread  .  .  .  operator  (see  developer.  mozilla  .  org/en/docs/Web/JavaScript/<br/>Ref  erence/Operators/Spread_operator)  lets  you  expand  an  expression  in  places  where<br/>you would otherwise require multiple arguments, elements, or variables. For example, you can replace<br/>arguments in a function call, as shown in the following code:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: justify;">// sum3.js</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 73pt;text-indent: -11pt;line-height: 130%;text-align: left;"><span>function sum3(a, b, c)<br/>return a + b + c;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;text-align: justify;">const x = [1, 2, 3] ;</p><p style="padding-top: 3pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">const y = sum3(...x); // equivalent to sum3(1,2,3)</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: justify;">You can also create or join arrays, as shown in the following code:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">const f = [1, 2, 3] ;</p><p style="padding-top: 4pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">const g = [4, ...f, 5]; // [4,1,2,3,5]</p><p style="padding-top: 4pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">const h = [...f, ...g]; // [1,2,3,4,1,2,3,5]</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: justify;">It works with objects too:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;text-align: left;">const p = { some: 3, data: 5 };</p><p style="padding-top: 2pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">const q = { more: 8, ...p }; // { more:8, some:3, data:5 }</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 314pt;text-indent: 0pt;text-align: left;">How do we work with JavaScript?  15</p><p style="padding-top: 22pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>You can also use it to work with functions that expect separate parameters instead of an array. Common<br/>examples of this would be Math. min () and Math. max ():</span></p><p style="padding-top: 10pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="padding-top: 19pt;padding-left: 53pt;text-indent: 0pt;line-height: 285%;text-align: left;"><span>const numbers = [2, 2, 9, 6, 0, 1, 2, 4, 5, 6] ;<br/>const minA = Math.min(. </span><b>numbers); </b>// 0</p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">const maxArray = (arr) =&gt; Math.max(. <b>arr);</b></p><p style="padding-top: 19pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">const maxA = maxArray(numbers); // 9</p><p style="padding-top: 12pt;padding-left: 43pt;text-indent: 0pt;text-align: justify;">We are specifying that maxArray () shall receive an array of numbers as an argument.</p><p style="padding-top: 9pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>You can also write the following equality since the . apply () method requires an array of arguments,<br/>but .call () expects individual arguments, which you can get by spreading:</span></p><p style="padding-top: 10pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">someFn.apply(thisArg, arr) === someFn.call(thisArg, arr)</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 56pt;text-indent: 0pt;text-align: justify;"><a name="bookmark43">A mnemonic for arguments</a></p><p style="padding-top: 4pt;padding-left: 56pt;text-indent: 0pt;line-height: 115%;text-align: justify;"><span>If you have problems remembering what arguments are required by . apply () and .call (),<br/>this mnemonic may help: </span><i>A is for Array, and C is for Comma. </i><span>See developer. mozilla. org/<br/>en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/apply</span></p><p style="padding-left: 57pt;text-indent: 0pt;line-height: 115%;text-align: justify;"><span>and            developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/<br/>Global_Obj ects/Function/call for more information.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Using the spread operator helps with writing shorter, more concise code, and we will be taking<br/>advantage of it. We have seen all of the most important JavaScript features that we will be using. Let’s<br/>round off this chapter by looking at some tools that we’ll be working with.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-left: 44pt;text-indent: 0pt;text-align: justify;"><a name="bookmark44">How do we work with JavaScript?</a><a name="bookmark67">&zwnj;</a></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>This is all well and good, but as we mentioned before, it so happens that the JavaScript version available<br/>almost everywhere isn’t ES13, but rather the earlier JS5. An exception to this is Node.js. It is based on<br/>Chrome’s V8 high-performance JavaScript engine, which already has several ES13 features available.<br/>Nonetheless, at the time of writing, ES13 coverage isn’t 100% complete, and there are features that<br/>you  will miss. (Check out node j s . org/en/docs/es6/ for more on Node.js and v8.) This is<br/>surely changing since Internet Explorer is fading away (support for it ended in June 2022), having<br/>been replaced with Microsoft’s Edge browser, which shares Chrome’s engine. In any case, we must<br/>still deal with older, less powerful engines.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 26pt;text-indent: 0pt;text-align: left;">16  Becoming Functional - Several Questions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>If you want to be sure of your choices before using any given new feature, check out the compatibility<br/>table at kangax. github .io/compat - table/ es6/ (see </span><i>Figure 1.1):</i></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s35" style="padding-left: 54pt;text-indent: 0pt;text-align: left;">“ ECMAScript2016+compatit: x +</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s36" style="padding-left: 56pt;text-indent: 0pt;text-align: left;">0 C □ <span class="s37">A </span><a href="http://kangax.githLb.io/coiTipat-table/es2Cll6plus/" class="s38" target="_blank">Not secure | http://kangax.githLb.io/coiTipat-table/es2Cll6plus/</a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="64" height="19" alt="image" src="Image_003.jpg"/></span></p><p style="padding-left: 167pt;text-indent: 0pt;text-align: left;"><span class="s39" style=" background-color: #000;">inti non-standard </span><span class="s40" style=" background-color: #000;">compatibility </span><span class="s39" style=" background-color: #000;">table   </span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 51pt;text-indent: 0pt;text-align: left;">0 * Q =</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;line-height: 4pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s42" style="padding-left: 57pt;text-indent: 0pt;line-height: 217%;text-align: left;"><span style=" color: #545585;">Sort </span>by <u>|</u> <span class="s44">Engine</span> <span class="s45">types </span><span class="s46">v</span><span class="s47"> </span><span style=" color: #000;">Show obsolete platforms </span><span style=" color: #8F929C;">□<br/></span><span style=" color: #393953;">Show unstable platforms </span><span style=" color: #000;">□</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s35" style="padding-top: 3pt;padding-left: 94pt;text-indent: 0pt;text-align: left;">V8 <span class="s50">La </span>Spider Monkey  ■javaScriptCore <span style=" color: #164DA9;">H </span>Chakra Other</p><p class="s35" style="padding-top: 1pt;padding-left: 95pt;text-indent: -4pt;line-height: 162%;text-align: left;"><span>Minor difference (1 point) . Small feature [2 points) Medium feature (4- points)<br/>Large feature (8 points)</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s52" style="padding-left: 47pt;text-indent: 0pt;text-align: left;">Compilers/polyfills                Desktop browsers</p><p class="s54" style="padding-left: 42pt;text-indent: 0pt;text-align: left;"><span style=" color: #523122;">74*   50%   5 19b  5*  1*  </span>98%  100%  100%  99%  99%  <span style=" color: #866B45;">89%  </span><span style=" color: #355009;">92%  96%  </span>9691]</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s57" style="padding-left: 132pt;text-indent: 0pt;text-align: center;">Feature name</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="371" height="35" alt="image" src="Image_004.jpg"/></span><span><img width="222" height="103" alt="image" src="Image_005.jpg"/></span><span><img width="428" height="121" alt="image" src="Image_006.png"/></span></p><p class="s36" style="padding-left: 58pt;text-indent: 0pt;text-align: left;">2015 features</p><p class="s58" style="padding-top: 3pt;padding-left: 66pt;text-indent: 0pt;line-height: 167%;text-align: left;">exponentiation (*<span class="s59">*) o</span>perato<span class="s59">r </span><span class="s60">£3<br/></span>Array<span class="s59">, </span>prototype.includ es<span class="s59"> </span><span class="s60">£2</span></p><p class="s36" style="padding-left: 58pt;text-indent: 0pt;line-height: 5pt;text-align: left;">2016 misc</p><p class="s59" style="padding-top: 3pt;padding-left: 132pt;text-indent: 0pt;text-align: center;">g<u>enerator functions can&#39;t be used with &quot;new</u>&quot; <span style=" color: #277EB3;">£2</span></p><p class="s57" style="padding-top: 6pt;padding-left: 14pt;text-indent: 0pt;text-align: left;">Current  <span class="s61">Babel 7</span></p><p class="s35" style="padding-top: 1pt;padding-left: 14pt;text-indent: 0pt;line-height: 4pt;text-align: left;">browser</p><p class="s62" style="padding-left: 38pt;text-indent: 0pt;line-height: 4pt;text-align: left;">,GS.r&amp;-jS..3</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 18pt;text-indent: 0pt;line-height: 4pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s63" style="text-indent: 0pt;text-align: left;">Closure <span class="s64">y,,&lt; </span>es7</p><p class="s63" style="padding-top: 1pt;padding-left: 1pt;text-indent: 0pt;line-height: 4pt;text-align: left;">2022.07   * shim</p><p class="s63" style="padding-left: 19pt;text-indent: 0pt;line-height: 4pt;text-align: left;">rc»e |S 1</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s63" style="padding-top: 3pt;padding-left: 22pt;text-indent: 0pt;text-align: left;">102</p><p style="text-indent: 0pt;text-align: left;"><span><img width="19" height="18" alt="image" src="Image_007.jpg"/></span></p><p class="s63" style="padding-top: 1pt;padding-left: 22pt;text-indent: 0pt;text-align: left;">ESR</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s63" style="padding-left: 55pt;text-indent: 0pt;line-height: 136%;text-align: left;"><span>Edge<br/>1.95</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s62" style="padding-top: 3pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">SF15 <u>SF15.2</u> SF15.4 SF16</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s59" style="padding-left: 67pt;text-indent: 0pt;line-height: 270%;text-align: left;"><u>generator throwp caught by inner generato</u>r <span style=" color: #277EB3;">□<br/></span><span style=" color: #9E6BCD;">strict fn     non     </span>is <span class="s67">erro</span><span style=" color: #000;">r</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 13pt;text-indent: 0pt;text-align: left;"><span class="s68" style=" background-color: #45A946;"> </span><span class="s69" style=" background-color: #45A946;">Vee </span></p><p class="s59" style="padding-left: 67pt;text-indent: 0pt;line-height: 5pt;text-align: left;">nested rest.destructuring, declarations! <span class="s70">Q </span><span class="s71">[12]</span></p><p class="s59" style="padding-top: 4pt;padding-left: 67pt;text-indent: 0pt;line-height: 79%;text-align: left;">nested <span style=" color: #628FEF;">rest ।</span><u>destructurin</u>g, <u>parameters</u>^<span class="s73">1<br/></span>Proxy, &quot;enumerate&quot; <span style=" color: #628FEF;">handler </span>removed <span class="s74">□ </span><span class="s75">14]</span></p><p class="s59" style="padding-top: 1pt;padding-left: 67pt;text-indent: 0pt;text-align: left;">Proxy irnal <span class="s76">XallS..</span><span class="s77">Array.</span>.prototype. includes</p><p class="s36" style="padding-top: 2pt;padding-left: 58pt;text-indent: 0pt;text-align: left;">2017 features</p><p class="s58" style="padding-top: 2pt;padding-left: 67pt;text-indent: 0pt;text-align: left;">Object static methods</p><p class="s59" style="padding-top: 3pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">- <u>String padding</u></p><p class="s78" style="padding-top: 3pt;padding-left: 67pt;text-indent: 0pt;line-height: 158%;text-align: left;"><span class="s58">trailing commas in function syntax</span> <span style=" color: #277EB3;">£3<br/></span>as<u>ync</u> <span class="s58">functions</span> <span style=" color: #277EB3;">D</span></p><p class="s36" style="padding-left: 58pt;text-indent: 8pt;line-height: 142%;text-align: left;">shared memory <span style=" color: #523122;">and </span><span>atomics<br/>2017 misc</span></p><p class="s59" style="padding-left: 67pt;text-indent: 0pt;line-height: 167%;text-align: left;">RegEx<u>p</u> <span class="s81">&quot;u” flag, case</span> <u>foldin</u><span>g<br/>a</span><u>rguments-caller removed</u> <span style=" color: #277EB3;">£3</span></p><p class="s35" style="padding-left: 58pt;text-indent: 0pt;line-height: 5pt;text-align: left;">2017 annex b</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 155pt;text-indent: -32pt;line-height: 137%;text-align: left;"><span>Figure 1.1 - The latest JavaScript features may not be widely and fully<br/>supported, so you&#39;ll have to check before using them</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">For Node.js specifically, check out node . green/, which takes its data from the Kangax table; see</p><p class="s9" style="padding-top: 2pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">Figure 1.2:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 12pt;padding-left: 314pt;text-indent: 0pt;text-align: left;">How do we work with JavaScript?  17</p><p class="s82" style="padding-top: 24pt;padding-left: 47pt;text-indent: 0pt;text-align: left;">Z <span style=" color: #000;">Node.js ES2OI5/ES6, ES20I6</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 42pt;text-indent: 0pt;text-align: left;"><span><img width="528" height="353" alt="image" src="Image_008.jpg"/></span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 141pt;text-indent: 0pt;text-align: left;">Figure 1.2 - Compatibility table specifically for Node.js</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>So, what can you do if you want to code using the latest version, but the available one is an earlier,<br/>poorer one? Or what happens if most of your users are using older browsers, which don’t support the<br/>fancy features you’re keen on using? Let’s see some solutions for this.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 44pt;text-indent: 0pt;text-align: justify;"><a name="bookmark45">Using transpilers</a><a name="bookmark68">&zwnj;</a></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>To get out of this availability and compatibility problem, there are a couple of transpilers that you can<br/>use. Transpilers take your original ESI3 code, which might use the most modern JavaScript features,<br/>and transforms it into equivalent JS5 code. It’s a source-to-source transformation, instead of source-<br/>to-object code that would be used in compilation. You can code using advanced ES13 features, but the<br/>user’s browsers will receive JS5 code. A transpiler will also let you keep up with upcoming versions<br/>of the language, despite the time needed by browsers to adopt new standards across desktop and<br/>mobile devices.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 26pt;text-indent: 0pt;text-align: left;">18  Becoming Functional - Several Questions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 66pt;text-indent: 0pt;text-align: justify;"><a name="bookmark46">On word origins</a></p><p style="padding-top: 4pt;padding-left: 66pt;text-indent: 0pt;line-height: 115%;text-align: justify;">If you wonder where the word <i>transpiler </i>came from, it is a portmanteau of <i>translate </i><span>and<br/></span><i>compiler. </i>There are many such combinations in technological speak: <i>email (electronic </i>and <i>mail),</i>and <i>icon), malware (malicious </i>and <i>software), alphanumeric (alphabetic </i><span>and<br/></span><i>numeric), </i>and many more.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;">Currently, the most common transpiler for JavaScript is <b>Babel </b><span>(babel j s . io/); years ago, we also<br/>had  </span><b>Traceur  </b><span>(github  .  com/google/traceur-compiler),  but  that’s  not  maintained  any<br/>longer. Two other possibilities are </span><b>SWC </b>(swc . rs/) and <b>Sucrase </b><span>(sucrase . io/); in particular,<br/>the latter boasts a much faster transpilation speed.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;">With tools such as <b>npm </b>or <b>webpack, </b><span>it’s fairly easy to configure things so that your code will get<br/>automatically transpiled and provided to end users. You can also carry out transpilation online; see<br/></span><i>Figure 1.3 </i>for an example of Babel’s online environment:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s83" style="padding-left: 57pt;text-indent: 0pt;text-align: justify;">&gt;■ <span style=" color: #000;">Babel ■ The compiler for next</span></p><p class="s84" style="padding-top: 2pt;padding-left: 58pt;text-indent: 0pt;text-align: left;">&lt;  <a href="https://babeljsuo/repl%2523?browsers=defaults%252C%2520not%2520ie%252011%252C%2520not%2520ie_mob%252011&amp;build&amp;buil" class="s86" target="_blank">OH A </a><span class="s85">https://babeljsuo/repl#?browsers=defaults%2C%20not%20ie%2011%2C%20not%20ie_mob%2011&amp;build=&amp;buil... Q A* Q</span></p><p style="text-indent: 0pt;text-align: left;"/><p style="padding-top: 8pt;padding-left: 182pt;text-indent: 0pt;text-align: left;"><span class="s87" style=" background-color: #000;">    </span><span class="s88" style=" background-color: #000;">Docs Setup </span><span class="s89" style=" background-color: #000;">Try </span><span class="s90" style=" background-color: #000;">it </span><span class="s89" style=" background-color: #000;">out </span><span class="s88" style=" background-color: #000;">Videos Blog Q, </span><span class="s91" style=" background-color: #000;">Search </span><span class="s92">  </span><span class="s88" style=" background-color: #000;">Donate Team GitHub  </span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l9"><li data-list-text="■"><p class="s48" style="padding-left: 4pt;text-indent: -4pt;line-height: 6pt;text-align: left;">Evaluate</p></li></ul><ul id="l10"><li data-list-text="✓"><p class="s48" style="padding-top: 3pt;text-indent: 0pt;line-height: 163%;text-align: left;"><span>Line Wrap<br/></span><span style=" color: #DFE6D0; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 5pt;">B </span>Prettify</p></li></ul><ul id="l11"><li data-list-text="■"><p class="s48" style="padding-left: 4pt;text-indent: -4pt;line-height: 5pt;text-align: left;">File Size</p></li><li data-list-text="■"><p class="s48" style="padding-top: 3pt;padding-left: 4pt;text-indent: -4pt;text-align: left;">Time Travel</p></li></ul><p class="s36" style="padding-left: 6pt;text-indent: -6pt;line-height: 109%;text-align: left;"><span style=" color: #792E80;">const </span><span style=" color: #3D27DC;">fact2 </span>- <span style=" color: #3D27DC;">(n) </span><span>=&gt; ■[<br/></span><span style=" color: #792E80;">if </span>(<span style=" color: black; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 3pt; vertical-align: -1pt;">n </span>= e) <span style=" color: #1F0D64; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 5pt;">{</span></p><p class="s94" style="padding-left: 12pt;text-indent: 0pt;text-align: left;">return <span style=" color: #000;">1;</span></p><p class="s36" style="padding-top: 1pt;padding-left: 6pt;text-indent: 0pt;text-align: left;">} <span style=" color: #792E80;">else </span>{</p><p class="s94" style="padding-top: 1pt;padding-left: 12pt;text-indent: 0pt;text-align: left;">return <span style=" color: #277EB3; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 5pt;">n </span><span style=" color: #000;">* fact2(n - 1);</span></p><p style="text-indent: 0pt;line-height: 6pt;text-align: left;"><span style=" color: #FFF; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 5pt;">Source Type</span></p><p class="s94" style="text-indent: 0pt;line-height: 6pt;text-align: left;">const <span style=" color: #3D27DC;">facta</span></p><p style="padding-left: 4pt;text-indent: 0pt;line-height: 6pt;text-align: left;"><span class="s40" style=" background-color: #000;">Module </span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span style=" background-color: #000;"> </span><span style=" background-color: #000;">TARGETS </span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s36" style="padding-left: 2pt;text-indent: 0pt;text-align: left;"><span>defaults,<br/>ie_mob 11</span></p><p style="text-indent: 0pt;text-align: left;"><span><img width="197" height="141" alt="image" src="Image_009.png"/></span></p><p class="s93" style="padding-left: 132pt;text-indent: 0pt;text-align: center;">use strict&quot;;</p><p class="s36" style="padding-top: 1pt;padding-left: 311pt;text-indent: 0pt;text-align: left;">2</p><p class="s36" style="padding-top: 1pt;padding-left: 311pt;text-indent: 0pt;text-align: left;">3 <span style=" color: #792E80;">var </span><span style=" color: #3D27DC;">fact2 </span>= <span style=" color: #792E80;">function </span><span style=" color: #3D27DC;">fact2{n) </span>{</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s36" style="text-indent: 0pt;text-align: right;">fact3(n - 1));</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s36" style="padding-top: 3pt;padding-left: 62pt;text-indent: -18pt;line-height: 129%;text-align: left;">5  <span style=" color: #792E80;">return </span><span>1;<br/></span><span style=" color: #792E80;">else </span>{</p><p class="s94" style="padding-left: 62pt;text-indent: 0pt;text-align: left;">return <span style=" color: #164DA9;">n </span><span style=" color: #000;">* fact2(n -</span></p><p class="s48" style="padding-top: 1pt;padding-left: 43pt;text-indent: 0pt;text-align: left;">8</p><p class="s48" style="padding-top: 1pt;padding-left: 43pt;text-indent: 0pt;text-align: left;">9</p><p class="s48" style="padding-top: 1pt;padding-left: 40pt;text-indent: 0pt;text-align: left;">10</p><p class="s95" style="padding-top: 1pt;padding-left: 49pt;text-indent: 0pt;text-align: left;"><span style=" color: #3A2888;">var </span>fact3 <span style=" color: #000;">= </span><span style=" color: #792E80;">function </span>fact3(n) <span style=" color: #000;">{</span></p><p class="s48" style="padding-top: 1pt;padding-left: 40pt;text-indent: 0pt;text-align: left;">12  <span style=" color: #792E80;">return </span><span style=" color: #545585;">n          </span><span style=" color: #393953;">fact3(n -</span></p><p class="s48" style="padding-top: 1pt;padding-left: 40pt;text-indent: 0pt;text-align: left;">13</p><p class="s48" style="padding-top: 1pt;padding-left: 40pt;text-indent: 0pt;text-align: left;">14</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 58pt;text-indent: 0pt;text-align: left;"><span class="s98" style=" background-color: #000;"> </span><span class="s99" style=" background-color: #000;">&gt; PRESETS </span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 58pt;text-indent: 0pt;text-align: left;"><span class="s98" style=" background-color: #000;"> </span><span class="s99" style=" background-color: #000;">&gt; ENV PRESET  </span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 58pt;text-indent: 0pt;text-align: left;"><span class="s98" style=" background-color: #000;"> </span><span class="s99" style=" background-color: #000;">&gt; ASSUMPTIONS  </span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 58pt;text-indent: 0pt;text-align: left;"><span class="s98" style=" background-color: #000;"> </span><span class="s99" style=" background-color: #000;">&gt; PLUGiNS </span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 107pt;text-indent: 0pt;text-align: left;">Figure 1.3 - The Babel transpiler converts ES13 code into compatible JS5 code</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><a href="http://www/" class="s11" target="_blank">There are specific ways of installing these tools for your programming environment, and usually, you won’t<br/>have to do it by hand; check out </a>www. typescript lang. org/download for more information.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 314pt;text-indent: 0pt;text-align: left;">How do we work with JavaScript?  19</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 43pt;text-indent: 0pt;text-align: justify;"><a name="bookmark47">Working online</a><a name="bookmark69">&zwnj;</a></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;">There are some more online tools that you can use to test out your JavaScript code. Check out <b>JSFiddle</b>(j s fiddle .net/), <b>CodePen </b>(codepen .io/), and <b>JSBin (</b><span>j sbin. com/), among others. You<br/>can see an example of CodePen in </span><i>Figure 1.4:</i></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s36" style="padding-left: 48pt;text-indent: 0pt;text-align: left;">New Tab            ® <span style=" color: #866B45;">Fibonacci numbers      </span>x +<span class="s100">                                 </span>v</p><p style="text-indent: 0pt;text-align: left;"><span><img width="25" height="25" alt="image" src="Image_010.jpg"/></span></p><p class="s101" style="padding-top: 3pt;padding-left: 50pt;text-indent: 0pt;text-align: left;"><a href="https://codepen.io/fkereki/pen/oNdayOE?editors=1112" class="s102" target="_blank">&lt;] 0 C Cl ft </a>https://codepen.io/fkereki/pen/oNdayOE?editors=1112                           <span class="s10">Q * </span>0 z</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s103" style="padding-left: 46pt;text-indent: 0pt;text-align: left;">zgs Fibonacci numbers &gt;</p><p class="s80" style="padding-top: 1pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">Federico <span style=" color: #393953;">Kereki</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s104" style="padding-top: 4pt;padding-left: 46pt;text-indent: 0pt;text-align: left;">A <span class="s105">Save    </span>Q <span class="s105">Settings</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s107" style="padding-left: 54pt;text-indent: 0pt;text-align: left;"><span class="s106">0 </span>HTML      <span class="s103">o </span>S</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s108" style="padding-top: 3pt;padding-left: 24pt;text-indent: 0pt;text-align: left;">*ICSS      <span style=" color: #000;">* ta</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s109" style="padding-top: 3pt;padding-left: 24pt;text-indent: 0pt;text-align: left;">O <span style=" color: #000;">JS                      « ~</span></p><p class="s28" style="padding-top: 4pt;padding-left: 38pt;text-indent: 8pt;line-height: 132%;text-align: left;"><span style=" color: #3A2888;">const </span><span style=" color: #792E80;">fib </span>= <span style=" color: #792E80;">(n) </span><span>=&gt; {<br/>2v </span><span style=" color: #1F0D64;">if </span>(n &lt; 2) {</p><p class="s110" style="padding-left: 54pt;text-indent: 0pt;line-height: 6pt;text-align: left;">return <span style=" color: #866B45;">n;</span></p><p class="s28" style="padding-top: 2pt;padding-left: 51pt;text-indent: 0pt;text-align: center;"><span class="s50">It </span>} <span style=" color: #3A2888;">else </span>{</p><p class="s110" style="padding-top: 1pt;padding-left: 132pt;text-indent: 0pt;text-align: center;">return fib(n <span style=" color: #000;">- 2) + fib(n - </span><span style=" color: #866B45;">1);</span></p><p class="s114" style="padding-top: 2pt;padding-left: 255pt;text-indent: 0pt;text-align: left;">6  }</p><p class="s28" style="padding-top: 2pt;padding-left: 255pt;text-indent: 0pt;text-align: left;">7  };</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s110" style="text-indent: 0pt;text-align: right;">console.log(<span style=" color: #A9353E;">&quot;FIB(4)=&quot;</span><span style=" color: #000;">, </span>fib<span style=" color: #527945;">(4)</span><span style=" color: #000;">);</span></p><p class="s110" style="padding-top: 2pt;text-indent: 0pt;text-align: right;"><span style=" color: #000;">ie </span>console. log(<span style=" color: #A9353E;">&quot;FIB(7)=&quot;|, </span>fib(7));</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s107" style="padding-left: 48pt;text-indent: 0pt;text-align: left;">Console<span class="s117">                                                        </span><span class="s28">X</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s115" style="padding-left: 47pt;text-indent: 0pt;text-align: left;">&quot;FIB(4)=&quot; <span style=" color: #527945;">3</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s115" style="padding-left: 47pt;text-indent: 0pt;text-align: left;">&quot;FIB(7)=&quot; <span style=" color: #527945;">13</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s35" style="padding-left: 48pt;text-indent: 0pt;text-align: left;">Console Assets Comments Shortcuts                 <span class="s118">LESS THAN A MINUTE AGO </span>Cj Delete       <span style=" color: #545585;">Add </span>to Collection   X <span style=" color: #545585;">Fork </span>Embed Export <span style=" color: #545585;">Share</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 149pt;text-indent: -29pt;line-height: 135%;text-align: left;"><span>Figure 1.4 - CodePen lets you try out modern JavaScript code (plus<br/>HTML and CSS) without requiring any other tools</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>Using these tools provides a very quick way to try out code or do small experiments - and I can truly<br/>vouch for this since I’ve tested much of the code in this book in this way!</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 43pt;text-indent: 0pt;text-align: left;"><a name="bookmark48">A step further - TypeScript</a><a name="bookmark70">&zwnj;</a></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: left;"><span>In the previous editions of this book, we went with straight JavaScript. Still, in the years since,<br/>Microsoft’s </span><a href="http://www/" class="s291" target="_blank">TypeScript </a><span>(www. typescriptlang. org/), a superset of the language that is itself<br/>compiled   into JavaScript, has gained a lot of following, is now standard with many frameworks, and<br/>you can use both for frontend and backend code.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 25pt;text-indent: 0pt;text-align: left;">20  Becoming Functional - Several Questions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>The main advantage of TypeScript is the ability to add (optional) static type checks to JavaScript, which<br/>helps detect programming errors at compile time. But beware: as with Babel, not all of ESI3 will be<br/>available. However, it’s entirely sufficient for our purposes, allowing us to be more careful with coding.</span></p><p style="padding-top: 7pt;padding-left: 53pt;text-indent: 0pt;line-height: 123%;text-align: justify;">Most statistics about programming language popularity rank TypeScript in the top 10; <i>Figure 1.5 </i><span>(from<br/>spectrum, ieee . org/top-programming-languages-2022) confirms this:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 50pt;text-indent: 0pt;text-align: left;"><span><img width="532" height="373" alt="image" src="Image_011.jpg"/></span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 96pt;text-indent: 0pt;text-align: left;">Figure 1.5 - Programming language popularity in 2022 according to IEEE Spectrum</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 66pt;text-indent: 0pt;text-align: left;"><a name="bookmark49">Going to the source</a></p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;line-height: 115%;text-align: left;"><span>Despite using TypeScript, in the rest of this book, we’ll keep referring to JavaScript, which is,<br/>after all, the language that is executed.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;">You can also perform type checks by using Facebook’s <b>Flow </b><span>(flow. org/). However, there’s more<br/>support for using external libraries with TypeScript than with Flow. Also, the tooling and installation<br/>for development are simpler for TypeScript.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 12pt;padding-left: 314pt;text-indent: 0pt;text-align: left;">How do we work with JavaScript?  21</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 57pt;text-indent: 0pt;text-align: left;"><a name="bookmark50">Ignoring types?</a></p><p style="padding-top: 4pt;padding-left: 57pt;text-indent: 0pt;line-height: 113%;text-align: left;"><span>There’s a proposal (that may go nowhere - be warned!) to allow JavaScript to process (by ignoring)<br/>types, so you would be able to run TypeScript directly, with no preprocessing or transpiling of</span></p><p style="padding-left: 57pt;text-indent: 0pt;text-align: left;">any kind. For more on this, go to tc3 9 . es/proposal-type-annotations/.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 8pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>It should be made clear that TypeScript is more than just a type checker; it’s a language on its own<br/>(OK, it&#39;s very similar to JavaScript, but still...). For example, it adds interfaces, decorators, enumerated<br/>types, and more to the language, so you can use such features that are typical in other languages. In<br/>any case, if you don’t care for TypeScript, you can just ignore the types-related syntax, and then you’ll<br/>have plain JavaScript.</span></p><p style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><a href="http://www/" class="s11" target="_blank">TypeScript is available via online tools, and you can also test it online on their playground </a><span>(www.<br/>typescriptlang  .  org/play/).  You  can  set  options  to  be  more  or  less  strict  with  data  type<br/>checks,  and you can also run your code on the spot; see </span><i>Figure </i>1.6 for more details:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s36" style="padding-left: 47pt;text-indent: 0pt;text-align: justify;"><span class="s120">B </span>TypeScript: <span style=" color: #866B45;">TS </span>Playground -AX <span class="s37">4-</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s36" style="padding-left: 48pt;text-indent: 0pt;text-align: left;"><a href="https://www.typescriptlang.org/play?target=1&amp;jsx=0&amp;module=5%2523code/MYGwhgzhAEDiBOBTRAXR9oG8CwAoa" class="s38" target="_blank">&lt;] C □ A </a>https://www.typescriptlang.org/play?target=1&amp;jsx=0&amp;module=5#code/MYGwhgzhAEDiBOBTRAXR9oG8CwAoa... i @            * ra =</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 3pt;padding-left: 48pt;text-indent: 0pt;text-align: left;"><span class="s121" style=" background-color: #1654B0;">E3 </span><span class="s122" style=" background-color: #1654B0;">TypeScript </span><span class="s123" style=" background-color: #1654B0;">Download Docs Handbook Community Playground Tools </span><span class="s124">  </span><span class="s123" style=" background-color: #1654B0;">.P Search Docs </span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s36" style="padding-left: 180pt;text-indent: 0pt;text-align: left;">les</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s101" style="padding-top: 5pt;padding-left: 48pt;text-indent: 0pt;text-align: left;">v4.8.4 ▼ Run Export Share                          <span class="s125">JS</span><span class="s126"> .D.TS Errors Logs Plugins</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><ol id="l12"><li data-list-text="1"><p class="s127" style="padding-top: 3pt;padding-left: 67pt;text-indent: -13pt;text-align: left;">class <span style=" color: #545585;">Greeter </span><span style=" color: #000;">{</span></p></li><li data-list-text="2"><p class="s36" style="padding-top: 1pt;padding-left: 68pt;text-indent: -13pt;text-align: left;">greeting: <span style=" color: #6861D5;">string;</span></p></li><li data-list-text="3"><p class="s41" style="padding-top: 1pt;padding-left: 68pt;text-indent: -13pt;text-align: left;">constructor(message: <span style=" color: #6861D5;">string) </span><span style=" color: #523122;">{</span></p></li><li data-list-text="4"><p class="s127" style="padding-top: 1pt;padding-left: 67pt;text-indent: -13pt;text-align: left;">this.<span style=" color: #000;">greeting = message;</span></p></li><li data-list-text="5"><p class="s36" style="padding-top: 1pt;padding-left: 68pt;text-indent: -13pt;text-align: left;">}</p></li><li data-list-text="6"><p class="s36" style="padding-top: 1pt;padding-left: 67pt;text-indent: -13pt;text-align: left;">greetO  {</p></li><li data-list-text="7"><p class="s127" style="padding-top: 1pt;padding-left: 67pt;text-indent: -13pt;text-align: left;">return <span style=" color: #527945;">&#39;Hello, </span><span style=" color: #545585;">${th</span>is.<span style=" color: #000;">greeting}&#39;</span><span style=" color: #523122;">;</span></p></li><li data-list-text="8"><p class="s36" style="padding-top: 1pt;padding-left: 67pt;text-indent: -13pt;text-align: left;">}</p></li><li data-list-text="9"><p class="s36" style="padding-top: 1pt;padding-left: 67pt;text-indent: -12pt;text-align: left;">}</p></li></ol><p class="s36" style="padding-top: 1pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">10</p><p class="s41" style="padding-left: 52pt;text-indent: 0pt;line-height: 134%;text-align: left;">11 <span style=" color: #6861D5;">let </span><span style=" color: #000;">greeter = </span><span style=" color: #6861D5;">new </span>GreeterC<span style=" color: #527945;">&quot;world&quot;</span><span>);<br/>12</span></p><ol id="l13"><li data-list-text="13"><p class="s127" style="padding-left: 67pt;text-indent: -15pt;line-height: 5pt;text-align: left;">let <span style=" color: #000;">button = document.createElement(&quot;</span><span style=" color: #527945;">button&quot;);</span></p></li><li data-list-text="14"><p class="s80" style="padding-top: 1pt;padding-left: 67pt;text-indent: -15pt;text-align: left;">button.<span style=" color: #000;">textcontent = </span><span style=" color: #527945;">&quot;Say hello&quot;;</span></p></li><li data-list-text="15"><p class="s80" style="padding-top: 1pt;padding-left: 52pt;text-indent: 0pt;line-height: 133%;text-align: left;">button.<span style=" color: #000;">onclick = () =&gt; alert(greeter.greetC));<br/></span><span style=" color: #545585;">16</span></p></li></ol><p class="s41" style="padding-left: 52pt;text-indent: 0pt;line-height: 5pt;text-align: left;">17 <span style=" color: #000;">document.body.appendChild(button);</span></p><p class="s36" style="padding-top: 1pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">18</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s129" style="padding-left: 37pt;text-indent: 0pt;text-align: left;">1</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s130" style="padding-left: 38pt;text-indent: 0pt;text-align: left;">r <span class="s131">JO);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s128" style="padding-top: 3pt;padding-left: 1pt;text-indent: 0pt;text-align: left;">&quot;use strict&quot;;</p><p class="s41" style="padding-top: 2pt;padding-left: 13pt;text-indent: -12pt;line-height: 142%;text-align: left;"><span style=" color: #6861D5;">var </span>Greeter <span style=" color: #527945;">= /** @class */ </span>(function <span style=" color: #523122;">() </span><span style=" color: #000;">{<br/></span><span style=" color: #6861D5;">function </span><span style=" color: #000;">Greeter(message) </span><span style=" color: #523122;">{</span></p><p class="s127" style="padding-left: 25pt;text-indent: 0pt;text-align: left;">this.<span style=" color: #000;">greeting = message;</span></p><p class="s36" style="padding-top: 3pt;padding-left: 14pt;text-indent: 0pt;text-align: left;">}</p><p class="s127" style="padding-top: 1pt;padding-left: 25pt;text-indent: -12pt;line-height: 146%;text-align: left;"><span style=" color: #545585;">Greeter.</span><span style=" color: #523122;">prototype.</span><span style=" color: #000;">greet </span><span style=" color: #527945;">= </span>function <span style=" color: #523122;">C) {<br/></span>return <span style=" color: #527945;">&quot;Hello, &quot;</span><span style=" color: #000;">.concat</span>(this.<span style=" color: #523122;">greeting);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s127" style="padding-top: 2pt;padding-left: 13pt;text-indent: 0pt;text-align: left;">return <span style=" color: #545585;">Greeter;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s127" style="padding-left: 1pt;text-indent: 0pt;text-align: left;">var <span style=" color: #523122;">greeter </span><span style=" color: #000;">= </span>new <span style=" color: #545585;">GreeterC</span><span style=" color: #527945;">&quot;world&quot;</span><span style=" color: #000;">);</span></p><p class="s36" style="padding-top: 2pt;padding-left: 1pt;text-indent: 0pt;line-height: 142%;text-align: left;"><span style=" color: #6861D5;">var </span>button <span style=" color: #527945;">= </span><span>document.createElementC’button&quot;);<br/></span><span style=" color: #523122;">button.textcontent </span><span style=" color: #527945;">= &quot;Say hello&quot;;</span></p><p class="s36" style="padding-left: 1pt;text-indent: 0pt;line-height: 146%;text-align: left;"><span style=" color: #523122;">button.onclick </span><span style=" color: #527945;">= </span><span style=" color: #6861D5;">function </span>() <span style=" color: #545585;">{ </span><span style=" color: #6861D5;">return </span>alert<span style=" color: #523122;">(greeter.</span>greet())<span style=" color: #523122;">; </span><span>}<br/></span><span style=" color: #523122;">document.</span>body.appendChild(button)<span style=" color: #527945;">;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 92pt;text-indent: 0pt;text-align: left;">Figure 1.6 - You can check and transpile your code online, on Typescript&#39;s website</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;">Later in this book, in the <i>Specifying data types </i>section of <i>Chapter 12, Building Better Containers, </i><span>we<br/>will consider a formal type system for FP languages (not just JavaScript) and we’ll find out that our<br/>TypeScript work has allayed most difficulties.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>A final admission: at times, TypeScript may seem more of a hindrance than a help when you have to<br/>deal with complex data typing expressions. (Updating all the code in this book to TypeScript sometimes<br/>led me to doubt my sanity in using it!) However, in the long run, code written in TypeScript is less<br/>prone to bugs, because its static type checks detect and avoid many common errors.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 25pt;text-indent: 0pt;text-align: left;">22  Becoming Functional - Several Questions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;text-align: left;"><a name="bookmark51">Testing</a><a name="bookmark71">&zwnj;</a></p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>We will also touch on testing, which is, after all, one of FP’s main advantages. In previous editions of<br/>this book, we went with </span><b>Jasmine (</b><span>j asmine . github. io/), but now, we’ve changed to Facebook’s<br/></span><b>Jest </b>(jestjs.io/) - which is built on top of Jasmine!</p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Jest has grown in popularity due to its ease of use and broad applicability: you can test frontend and<br/>backend code equally well, with little configuration. (See jest j s . io/docs/get ting -started<br/>for  its installation and configuration.) We won’t be writing tests for every single piece of code in this<br/>book, but while following the ideas of </span><b>test-driven development (TDD), </b>we’ll often do so.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-left: 52pt;text-indent: 0pt;text-align: left;"><a name="bookmark52">Summary</a><a name="bookmark72">&zwnj;</a></p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>In this chapter, we have seen the basics of FP, a bit of its history, its advantages (and also some possible<br/>disadvantages, to be fair), why we can apply it in JavaScript (which isn’t usually considered a functional<br/>language), and what tools we’ll need to go through the rest of this book.</span></p><p style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: justify;">In <i>Chapter 2, Thinking Functionally, </i><span>we’ll go over an example of a simple problem, look at it in common<br/>ways, and end by solving it in a functional manner and analyzing the advantages of our method.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-left: 52pt;text-indent: 0pt;text-align: left;"><a name="bookmark53">Questions</a><a name="bookmark73">&zwnj;</a></p><ol id="l14"><ol id="l15"><li data-list-text="1.1"><p class="s10" style="padding-top: 9pt;padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: justify;">TypeScript, please! <span class="p">Let’s keep our promise: convert the JavaScript examples provided in this<br/>chapter into TypeScript.</span></p></li><li data-list-text="1.2"><p class="s10" style="padding-top: 7pt;padding-left: 52pt;text-indent: 1pt;line-height: 123%;text-align: justify;">Classes as first-class objects: <span class="p">We learned that functions are first-class objects, but did you know<br/>that classes also are? (Though, of course, speaking of classes as objects does sound weird.) Look at the<br/>following example and see what makes it tick! Be careful: there’s some purposefully weird code in it:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 73pt;text-indent: -12pt;line-height: 144%;text-align: left;"><span>const makeSaluteClass = (term) =&gt;<br/>class {</span></p><p style="padding-left: 97pt;text-indent: -12pt;line-height: 144%;text-align: left;"><span>constructor(x) {<br/>this.x = x;</span></p><p class="s84" style="padding-left: 86pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 86pt;text-indent: 0pt;text-align: left;">salute(y) {</p><p style="padding-top: 4pt;padding-left: 97pt;text-indent: 0pt;text-align: left;">console.log(&#39;${this.x} says &quot;${term}&quot; to ${y}&#39;);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 401pt;text-indent: 0pt;text-align: left;">Questions  23</p><p style="padding-top: 2pt;padding-left: 52pt;text-indent: 0pt;line-height: 30pt;text-align: left;"><span>const Spanish = makeSaluteClass(&quot;HOLA&quot;);<br/>new Spanish(&quot;ALFA&quot;).salute(&quot;BETA&quot;);</span></p><p style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// ALFA says &quot;HOLA&quot; to BETA</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">new (makeSaluteClass(&quot;HELLO&quot;))(&quot;GAMMA&quot;).salute(&quot;DELTA&quot;);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// GAMMA says &quot;HELLO&quot; to DELTA</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 53pt;text-indent: 0pt;line-height: 286%;text-align: left;"><span>const fullSalute = (c, x, y) =&gt; new c(x).salute(y);<br/>const French = makeSaluteClass(&quot;BON JOUR&quot;);</span></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">fullSalute(French, &quot;EPSILON&quot;, &quot;ZETA&quot;);</p><p style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// EPSILON says &quot;BON JOUR&quot; to ZETA</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="1.3"><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><b>Climbing factorial: </b>Our implementation of a factorial starts by multiplying by <i>n, </i><span>then by n-1,<br/>then n-2, and so on in what we could call a downward fashion. Can you write a new version of the<br/>factorial function that will loop upwards?</span></p></li><li data-list-text="1.4"><p style="padding-top: 6pt;padding-left: 43pt;text-indent: 1pt;line-height: 124%;text-align: justify;"><b>Factorial errors: </b><span>Factorials, as we defined them, should only be calculated for non-negative integers.<br/>However, the function that we wrote in the </span><i>Recursion </i><span>section doesn’t check whether its argument is<br/>valid. Can you add the necessary checks? Try to avoid repeated, redundant tests!</span></p></li><li data-list-text="1.5"><p class="s10" style="padding-top: 7pt;padding-left: 44pt;text-indent: 0pt;line-height: 123%;text-align: justify;">Factorial testing: <span class="p">Write complete tests for the function in the previous question. Try to achieve<br/>100% coverage.</span></p></li><li data-list-text="1.6"><p class="s10" style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;">Code squeezing: <span class="p">Not that it’s a goal in itself, but by using arrow functions and some other JavaScript<br/>features, you can shorten newCounter () to half its length. Can you see how?</span></p></li><li data-list-text="1.7"><p class="s10" style="padding-top: 7pt;padding-left: 64pt;text-indent: -20pt;text-align: justify;">What type is it?: <span class="p">What is the type of the newCounter () function?</span></p></li></ol></ol><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-top: 5pt;text-indent: 0pt;text-align: right;"><a name="bookmark74">2</a></h2><h2 style="padding-top: 2pt;text-indent: 0pt;text-align: right;">Thinking Functionally</h2><h2 style="padding-top: 2pt;text-indent: 0pt;text-align: right;">- A First Example</h2><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;">In <i>Chapter 1, Becoming Functional, </i><span>we went over what FP is, mentioned some advantages of applying<br/>it, and listed some tools wed need in JavaScript. For now, let’s leave the theory behind and start by<br/>considering a simple problem and how to solve it in a functional way.</span></p><p style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;text-align: justify;">In this chapter, we will do the following:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l16"><li data-list-text="•"><p style="padding-left: 70pt;text-indent: -13pt;text-align: left;">Look at a simple, e-commerce-related problem</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">Consider several usual ways to solve it (with their associated defects)</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">Find a way to solve the problem by looking at it functionally</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">Devise a higher-order solution that can be applied to other problems</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">Work out how to carry out unit testing for functional solutions</p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>In future chapters, we’ll be returning to some of the topics listed here, so we won’t be going into too<br/>much detail. We’ll just show how FP can give a different outlook on our problem and leave further<br/>details for later.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>After working through this chapter, you will have had a first look at a common problem and at a way<br/>of solving it by thinking functionally, as a prelude for the rest of this book.</span></p><p class="s6" style="padding-top: 8pt;padding-left: 43pt;text-indent: 0pt;text-align: justify;"><a name="bookmark75">Our problem - doing something only once</a></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Let’s consider a simple but common situation. You have developed an e-commerce site; the user can<br/>fill their shopping cart, and in the end, they must click on a </span><b>Bill me </b><span>button so that their credit card<br/>will be charged. However, the user shouldn’t click twice (or more), or they will be billed several times.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 25pt;text-indent: 0pt;text-align: left;">26 Thinking Functionally - A First Example</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">The HTML part of your application might have something like this somewhere:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">&lt;button id=&quot;billButton&quot;</p><p style="padding-top: 4pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">onclick=&quot;billTheUser(some, sales, data)&quot;&gt;Bill me</p><p style="padding-top: 4pt;padding-left: 98pt;text-indent: 0pt;text-align: left;">&lt;/button&gt;</p><p style="padding-top: 2pt;padding-left: 62pt;text-indent: -9pt;line-height: 23pt;text-align: left;"><span>And, among the scripts, you’d have something similar to the following code:<br/>function billTheUser(some, sales, data) {</span></p><p style="padding-top: 1pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">window.alert(&quot;Billing the user...&quot;);</p><p style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">// actually bill the user</p><p style="padding-top: 6pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-top: 6pt;padding-left: 65pt;text-indent: 0pt;text-align: left;"><a name="bookmark76">A bad example</a></p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;line-height: 115%;text-align: left;"><span>Assigning the events handler directly in HTML, the way I did it, isn’t recommended. Instead,<br/>unobtrusively, you should set the handler through code. So, </span><i>do as I say, not as I do!</i></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>This is a bare-bones explanation of the web page problem, but it’s enough for our purposes. Now,<br/>let’s get to thinking about ways of avoiding repeated clicks on that button. How can we manage to<br/>prevent the user from clicking more than once? That’s an interesting problem, with several possible<br/>solutions - let’s start by looking at bad ones!</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>How many ways can you think of to solve our problem? Let’s go over several solutions and analyze<br/>their quality.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 52pt;text-indent: 0pt;text-align: justify;"><a name="bookmark77">Solution 1 - hoping for the best!</a><a name="bookmark96">&zwnj;</a></p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: justify;"><span>How can we solve the problem? The first solution may seem like a joke: do nothing, tell the user not<br/>to click twice, and hope for the best! Your page might look like </span><i>Figure 2.1:</i></p><p style="text-indent: 0pt;text-align: left;"><br/></p><table style="border-collapse:collapse;margin-left:52.28pt" cellspacing="0"><tr style="height:22pt"><td style="width:107pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#E0E1E2"><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s132" style="padding-left: 8pt;text-indent: 0pt;text-align: left;">HI <span style=" color: #6861D5;">Back</span></p></td><td style="width:133pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt" bgcolor="#F89904"><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s134" style="padding-right: 31pt;text-indent: 0pt;text-align: right;">Send</p></td><td style="width:49pt;border-top-style:solid;border-top-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#F89503"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:107pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#E0E1E1"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr></table><p class="s101" style="padding-top: 4pt;padding-left: 141pt;text-indent: 0pt;text-align: left;">CAUTION: please DO NOT click &quot;Send&quot; button twice, this may cause error on your order!</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">Figure 2.1 - An actual screenshot of a page, just warning you against clicking more than once</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>This is a way to weasel out of the problem; I’ve seen several websites that just warn the user about the<br/>risks of clicking more than once and do nothing to prevent the situation. So, the user got billed twice?<br/>We warned them... it’s their fault!</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 12pt;padding-left: 279pt;text-indent: 0pt;text-align: left;">Our problem - doing something only once   27</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: left;">Your solution might simply look like the following code:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">&lt;button</p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">id=&quot;billButton&quot;</p><p style="padding-top: 4pt;padding-left: 64pt;text-indent: 0pt;text-align: left;">onclick=&quot;billTheUser(some, sales, data)&quot;&gt;Bill me</p><p style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">&lt;/button&gt;</p><p style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">&lt;b&gt;WARNING: PRESS ONLY ONCE, DO NOT PRESS AGAIN!!&lt;/b&gt;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: left;">Okay, this isn’t an actual solution; let’s move on to more serious proposals.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 43pt;text-indent: 0pt;text-align: left;"><a name="bookmark78">Solution 2 - using a global flag</a><a name="bookmark97">&zwnj;</a></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>The solution most people would probably think of first is using some global variable to record whether<br/>the user has already clicked on the button. You define a flag named something like clicked, initialized<br/>with false. When the user clicks on the button, if clicked is false, you change it to true and<br/>execute the function; otherwise, you do nothing at all. This can be seen in the following code:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">let clicked = false;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 65pt;text-indent: -12pt;line-height: 144%;text-align: left;"><span>function billTheUser(some, sales, data) {<br/>if (!clicked) {</span></p><p style="padding-left: 76pt;text-indent: 0pt;line-height: 142%;text-align: left;"><span>clicked = true;<br/>window.alert(&quot;Billing the user...&quot;);</span></p><p style="padding-left: 77pt;text-indent: 0pt;text-align: left;">// actually bill the user</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;text-align: left;">This works, but it has several problems that must be addressed:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l17"><li data-list-text="•"><p style="padding-left: 70pt;text-indent: -13pt;line-height: 124%;text-align: justify;"><span>You are using a global variable, and you could change its value by accident. Global variables<br/>aren’t a good idea, in JavaScript or other languages. You must also remember to re-initialize<br/>it to false when the user starts buying again. If you don’t, the user won’t be able to make a<br/>second purchase because paying will become impossible.</span></p></li><li data-list-text="•"><p class="s33" style="padding-top: 5pt;padding-left: 70pt;text-indent: -13pt;line-height: 123%;text-align: justify;">	<span class="p">You will have difficulties testing this code because it depends on external things (that is, the<br/>clicked variable).</span></p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: left;">So, this isn’t a very good solution. Let’s keep thinking!</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 25pt;text-indent: 0pt;text-align: left;">28 Thinking Functionally - A First Example</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;text-align: justify;"><a name="bookmark79">Solution 3 - removing the handler</a><a name="bookmark98">&zwnj;</a></p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>We may go for a lateral kind of solution, and instead of having the function avoid repeated clicks, we<br/>might just remove the possibility of clicking altogether. The following code does just that; the first<br/>thing that billTheUser () does is remove the one lick handler from the button, so no further<br/>calls will be possible:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 73pt;text-indent: -11pt;line-height: 142%;text-align: left;"><span>function    billTheUser(some,    sales,    data)    {<br/>document</span></p><p style="padding-left: 87pt;text-indent: 0pt;text-align: left;">.getElementByld(&quot;billButton&quot;)</p><p style="padding-top: 4pt;padding-left: 87pt;text-indent: 0pt;text-align: left;">.onelick = null;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">window.alert(&quot;Billing the user...&quot;);</p><p style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">// actually bill the user</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: justify;">This solution also has some problems:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l18"><li data-list-text="•"><p style="padding-left: 79pt;text-indent: -13pt;text-align: left;">The code is tightly coupled to the button, so you won’t be able to reuse it elsewhere</p></li><li data-list-text="•"><p class="s33" style="padding-top: 8pt;padding-left: 79pt;text-indent: -13pt;line-height: 123%;text-align: left;">	<span class="p">You must remember to reset the handler; otherwise, the user won’t be able to make a<br/>second purchase</span></p></li><li data-list-text="•"><p style="padding-top: 5pt;padding-left: 79pt;text-indent: -13pt;text-align: left;">Testing will also be more complex because you’ll have to provide some DOM elements</p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>We can enhance this solution a bit and avoid coupling the function to the button by providing the<br/>latter’s ID as an extra argument in the call. (This idea can also be applied to some of the further solutions<br/>that well see.) The HTML part would be as follows; note the extra argument to billTheUser ():</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">&lt;button</p><p style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">id=&quot;billButton&quot;</p><p style="padding-top: 4pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">onclick=&quot;billTheUser(&#39;billButton&#39;, some, sales, data)&quot;</p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">&gt;Bill me</p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">&lt;/button&gt;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>We also have to change the called function so that it will use the received but ton Id value to access<br/>the corresponding button:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 73pt;text-indent: -11pt;line-height: 143%;text-align: left;"><span>function billTheUser(buttonld, some, sales, data) {<br/>document.getElementByld(buttonld).onclick = null;<br/>window.alert(&quot;Billing the user...&quot;);</span></p><p style="padding-left: 74pt;text-indent: 0pt;text-align: left;">// actually bill the user</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 279pt;text-indent: 0pt;text-align: left;">Our problem - doing something only once   29</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>This solution is somewhat better. But, in essence, we are still using a global element - not a variable, but<br/>the one lick value. So, despite the enhancement, this isn’t a very good solution either. Let’s move on.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 43pt;text-indent: 0pt;text-align: left;"><a name="bookmark80">Solution 4 - changing the handler</a><a name="bookmark99">&zwnj;</a></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: left;"><span>A variant to the previous solution would be not to remove the click function, but to assign a new one<br/>instead. We are using functions as first-class objects here when we assign the alreadyBilled ()<br/>function to the click event. The function warning the user that they have already clicked could look<br/>something like this:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">function alreadyBilled() {</p><p style="padding-top: 4pt;padding-left: 76pt;text-indent: -12pt;line-height: 144%;text-align: left;"><span>window.alert(&quot;Your billing process is running; don&#39;t<br/>click, please.&quot;);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Our billTheUser () function would then be like the following code - note how instead of assigning<br/>null to the onclick handler as in the previous section, now, the alreadyBilled () function<br/>is assigned:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 64pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>function    billTheUser(some,    sales,    data)    {<br/>document</span></p><p style="padding-left: 78pt;text-indent: 0pt;line-height: 10pt;text-align: left;">.getElementByld(&quot;billButton&quot;)</p><p style="padding-top: 4pt;padding-left: 78pt;text-indent: 0pt;text-align: left;">.onclick = alreadyBilled;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 64pt;text-indent: 0pt;text-align: left;">window.alert(&quot;Billing the user. &quot;);</p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">// actually bill the user</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>There’s a good point to this solution; if the user clicks a second time, they’ll get a warning not to do<br/>that, but they won’t be billed again. (From the point of view of user experience, it’s better.) However,<br/>this solution still has the very same objections as the previous one (code coupled to the button, needing<br/>to reset the handler, and harder testing), so we don’t consider it quite good anyway.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 43pt;text-indent: 0pt;text-align: justify;"><a name="bookmark81">Solution 5 - disabling the button</a><a name="bookmark100">&zwnj;</a></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>A similar idea here is instead of removing the event handler, we can disable the button so the user<br/>won’t be able to click. You might have a function such as the one shown in the following code, which<br/>does exactly that by setting the disabled attribute of the button:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 64pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>function billTheUser(some, sales, data) {<br/>document</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 25pt;text-indent: 0pt;text-align: left;">30 Thinking Functionally - A First Example</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 87pt;text-indent: 0pt;text-align: left;">.getElementByld(&quot;billButton&quot;)</p><p style="padding-top: 4pt;padding-left: 87pt;text-indent: 0pt;text-align: left;">.setAttribute(&quot;disabled&quot;, &quot;true&quot;);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">window.alert(&quot;Billing the user...&quot;);</p><p style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">// actually bill the user</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>This also works, but we still have objections as with the previous solutions (coupling the code to the<br/>button, needing to re-enable the button, and harder testing), so we don’t like this solution either.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 52pt;text-indent: 0pt;text-align: justify;"><a name="bookmark82">Solution 6 - redefining the handler</a><a name="bookmark101">&zwnj;</a></p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Another idea: instead of changing anything in the button, let’s have the event handler change itself.<br/>The trick is in the second line of the following code; by assigning a new value to the billTheUser<br/>variable, we are dynamically changing what the function does! The first time you call the function,<br/>it  will do its thing, but it will also change itself out of existence by giving its name to a new function:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 73pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>function billTheUser(some, sales, data) {<br/>billTheUser = function() {};<br/>window.alert(&quot;Billing the user...&quot;);</span></p><p style="padding-left: 74pt;text-indent: 0pt;line-height: 10pt;text-align: left;">// actually bill the user</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>There’s a special trick in the solution. Functions are global, so the billTheUser= . . . line changes<br/>the function’s inner workings. From that point on, billTheUser will be the new (null) function. This<br/>solution is still hard to test. Even worse, how would you restore the functionality of bi 1 ITheUser,<br/>setting it back to its original objective?</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 52pt;text-indent: 0pt;text-align: justify;"><a name="bookmark83">Solution 7 - using a local flag</a><a name="bookmark102">&zwnj;</a></p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>We can go back to the idea of using a flag, but instead of making it global (which was our main<br/>objection to the second solution), we can use an </span><b>Immediately Invoked Function Expression (IIFE),</b>which we’ll see more about in <i>Chapter 3, Starting Out with Functions, </i>and <i>Chapter 11, Implementing</i><span>With this, we can use a closure, so clicked will be local to the function and not<br/>visible anywhere else:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 73pt;text-indent: -12pt;line-height: 144%;text-align: left;"><span>var billTheUser = (clicked =&gt; {<br/>return (some, sales, data) =&gt; {</span></p><p style="padding-left: 97pt;text-indent: -11pt;line-height: 143%;text-align: left;"><span>if (1 clicked) {<br/>clicked = true;</span></p><p style="padding-left: 97pt;text-indent: 0pt;text-align: left;">window.alert(&quot;Billing the user...&quot;);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 302pt;text-indent: 0pt;text-align: left;">A functional solution to our problem   31</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 89pt;text-indent: 0pt;text-align: left;">// actually bill the user</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: justify;">}) (false) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>This solution is along the lines of the global variable solution, but using a private, local variable is an<br/>enhancement. (Note how clicked gets its initial value from the call at the end.) The only drawback<br/>we could find is that we&#39;ll have to rework every function that needs to be called only once to work in<br/>this fashion (and, as we’ll see in the following section, our FP solution is similar to it in some ways).<br/>Okay, it’s not too hard to do, but don’t forget the </span><b>Don’t Repeat Yourself (DRY), </b>usual advice!</p><p style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>We have now gone through multiple ways of solving our “do something only once” problem - but<br/>as we’ve seen, they were not very good! Let’s think about the problem functionally so that we get a<br/>more general solution.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-left: 43pt;text-indent: 0pt;text-align: justify;"><a name="bookmark84">A functional solution to our problem</a></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: justify;"><span>Let’s try to be more general; after all, requiring that some function or other be executed only once isn’t<br/>that outlandish, and may be required elsewhere! Let’s lay down some principles:</span></p><ul id="l19"><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;line-height: 125%;text-align: left;"><span>The original function (the one that may be called only once) should do whatever it is expected<br/>to do and nothing else</span></p></li><li data-list-text="•"><p style="padding-top: 5pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">We don’t want to modify the original function in any way</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">We need a new function that will call the original one only once</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">We want a general solution that we can apply to any number of original functions</p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-top: 7pt;padding-left: 56pt;text-indent: 0pt;text-align: justify;"><a name="bookmark85">A SOLID base</a></p><p style="padding-top: 4pt;padding-left: 56pt;text-indent: 0pt;line-height: 115%;text-align: justify;">The first principle listed previously is the single responsibility principle (the S in the <b>SOLID</b><span>acronym), which states that every function should be responsible for a single functionality.<br/>For more on SOLID, check the article by Uncle Bob (Robert C. Martin, who wrote the five<br/>principles) at butunclebob . com/ArticleS . UncleBob . PrinciplesOf Ood.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Can we do it? Yes, and we’ll write a higher-order function, which we’ll be able to apply to any function,<br/>to produce a new function that will work only once. Let’s see how! We will introduce higher-order<br/>functions in </span><i>Chapter 6, Producing Functions. </i><span>There, we’ll go about testing our functional solution, as<br/>well as making some enhancements to it.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 25pt;text-indent: 0pt;text-align: left;">32  Thinking Functionally - A First Example</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;text-align: justify;"><a name="bookmark86">A higher-order solution</a><a name="bookmark103">&zwnj;</a></p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>If we don’t want to modify the original function, we can create a higher-order function, which<br/>we’ll (inspiredly!) name once (). This function will receive a function as a parameter and return<br/>a new function, which will work only once. (As we mentioned previously, we’ll be seeing more of<br/>higher-order functions later; in particular, see the </span><i>Doing things once, revisited </i>section of <i>Chapter 6,</i></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 65pt;text-indent: 0pt;text-align: left;"><a name="bookmark87">Many solutions</a></p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;line-height: 115%;text-align: left;"><span>Underscore and Lodash already have a similar function, invoked as _. once (). Ramda also<br/>provides R. once (), and most FP libraries include similar functionality, so you wouldn’t have<br/>to program it on your own.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Our once () function may seem imposing at first, but as you get accustomed to working in an FP<br/>fashion, you’ll get used to this sort of code and find it to be quite understable:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// once.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 74pt;text-indent: -12pt;line-height: 142%;text-align: left;"><span>const once = &lt;FNType extends (...args: any[]) =&gt; any&gt;(<br/>fn: FNType</span></p><p style="padding-top: 2pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">) =&gt; {</p><p style="padding-top: 2pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">let done = false;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 86pt;text-indent: -12pt;line-height: 142%;text-align: left;"><span>return ((...args: Parameters&lt;FNType&gt;) =&gt; {<br/>if (1 done) {</span></p><p style="padding-left: 97pt;text-indent: 0pt;line-height: 143%;text-align: left;"><span>done = true;<br/>return fn(...args);</span></p><p style="padding-top: 2pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">}</p><p style="padding-top: 2pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">}) as FNType;</p><p style="padding-top: 6pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">};</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">Let’s go over some of the finer points of this function:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l20"><li data-list-text="•"><p class="s33" style="padding-left: 79pt;text-indent: -13pt;line-height: 123%;text-align: justify;">	<span class="p">Our once () function receives a function (f n) as its parameter and returns a new function,<br/>of the same type. (We’ll discuss this typing in more detail shortly.)</span></p></li><li data-list-text="•"><p style="padding-top: 5pt;padding-left: 79pt;text-indent: -12pt;line-height: 123%;text-align: justify;"><span class="s33">	</span>We define an internal, private done variable, by taking advantage of <i>closure, </i>as in <i>Solution 7.</i><span>We opted not to call it c 1 i eked (as we did previously) because you don’t necessarily need to<br/>click on a button to call the function; we went for a more general term. Each time you apply<br/>once () to some function, a new, distinct done variable will be created and will be accessible<br/>only from the returned function.</span></p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 302pt;text-indent: 0pt;text-align: left;">A functional solution to our problem   33</p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l21"><li data-list-text="•"><p style="padding-left: 70pt;text-indent: -13pt;line-height: 123%;text-align: left;"><span>The return statement shows that once () will return a function, with the same type of<br/>parameters as the original f n () one. We are using the spread syntax we saw in </span><i>Chapter 1,</i></p><p class="s9" style="padding-left: 70pt;text-indent: 0pt;line-height: 125%;text-align: left;">Becoming Functional. <span class="p">With older versions of JavaScript, you’d have to work with the arguments<br/>object; see developer.mozilla. org/en/docs/Web/JavaScript/Reference/</span></p><p style="padding-left: 71pt;text-indent: 0pt;line-height: 10pt;text-align: left;">Functions/arguments for more on that. The modern way is simpler and shorter!</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">We assign done = true before calling fn () Just in case that function throws an exception.</p><p style="padding-top: 2pt;padding-left: 70pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>Of course, if you don’t want to disable the function unless it has successfully ended, you could<br/>move the assignment below the f n () call. (See </span><i>Question 2.4 </i>in the <i>Questions </i><span>section for<br/>another take on this.)</span></p></li><li data-list-text="•"><p style="padding-top: 5pt;padding-left: 70pt;text-indent: -13pt;line-height: 123%;text-align: left;"><span>After the setting is done, we finally call the original function. Note the use of the spread operator<br/>to pass along whatever parameters the original f n () had.</span></p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Typing for once () may be obscure. We have to specify that the type of the input function and the<br/>type of once () are the same, and that’s the reason for defining FNType. </span><i>Figure 2.2 </i><span>shows that<br/>TypeScript correctly understands this (Check the answer to </span><i>Question </i><span>7.7 at the end of this book for<br/>another example of this):</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s135" style="padding-bottom: 2pt;padding-left: 46pt;text-indent: 0pt;text-align: justify;">File Edit Selection View <span style=" color: #000;">Go Run </span>Terminal Help</p><p style="padding-left: 41pt;text-indent: 0pt;text-align: left;"><span><img width="532" height="242" alt="image" src="Image_012.jpg"/></span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 81pt;text-indent: 0pt;text-align: left;">Figure 2.2 - Hovering shows that the type of onceO&#39;s output matches the type of its input</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 25pt;text-indent: 0pt;text-align: left;">34 Thinking Functionally - A First Example</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>If you’re not still used to TypeScript, let’s see the pure JavaScript equivalent, which is the same code<br/>but for typing:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// once_JS.js</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 74pt;text-indent: -12pt;line-height: 143%;text-align: left;"><span>const once = (fn) =&gt; {<br/>let done = false;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 86pt;text-indent: -12pt;line-height: 143%;text-align: left;"><span>return (...args) =&gt; {<br/>if (1 done) {</span></p><p style="padding-left: 97pt;text-indent: 0pt;line-height: 142%;text-align: left;"><span>done = true;<br/>return fn(...args);</span></p><p style="padding-top: 2pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">}</p><p style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">};</p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">};</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 61pt;text-indent: -9pt;line-height: 222%;text-align: left;"><span>So, how would we use it? We first create a new version of the billing function.<br/>const billOnce = once(billTheUser);</span></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">Then, we rewrite the onclick method as follows:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">&lt;button id=&quot;billButton&quot;</p><p style="padding-top: 4pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">onclick=<b>&quot;billOnce(some, sales, </b>data)&quot;&gt;Bill me</p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">&lt;/button&gt;;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: left;"><span>When the user clicks on the button, the function that gets called with the (some, sales, data)<br/>argument isn’t the original billTheUser () but rather the result of having applied once () to it.<br/>The result of that is a function that can be called only a single time.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 65pt;text-indent: 0pt;text-align: left;"><a name="bookmark88">You can’t always get what you want!</a></p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;line-height: 115%;text-align: left;"><span>Note that our once () function uses functions such as first-class objects, arrow functions,<br/>closures, and the spread operator. Back in </span><i>Chapter 1, Becoming Functional, </i><span>we said we’d be<br/>needing those, so we’re keeping our word! All we are missing from that chapter is recursion,<br/>but as the Rolling Stones sang, </span><i>You Can’t Always Get What You Want!</i></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>We now have a functional way of getting a function to do its thing only once, but how would we test<br/>it? Let’s get into that topic now.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 302pt;text-indent: 0pt;text-align: left;">A functional solution to our problem   35</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 43pt;text-indent: 0pt;text-align: left;"><a name="bookmark89">Testing the solution manually</a><a name="bookmark104">&zwnj;</a></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;">We can run a simple test. Let’s write a squeak () function that will, appropriately, <i>squeak </i><span>when<br/>called! The code is simple:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// once.manual.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">const squeak = a =&gt; console.log(a, &quot; squeak!!&quot;);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 53pt;text-indent: 0pt;line-height: 144%;text-align: justify;"><span>squeak(&quot;original&quot;); // &quot;original squeak!!&quot;<br/>squeak(&quot;original&quot;); // &quot;original squeak!!&quot;<br/>squeak(&quot;original&quot;); // &quot;original squeak!!&quot;</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>If we apply once () to it, we get a new function that will squeak only once. See the highlighted line<br/>in the following code:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;text-align: left;"><a name="bookmark90">const squeakOnce = once(squeak);</a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-top: 7pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">squeakOnce(&quot;only once&quot;); // &quot;only once squeak!!&quot;</p><p style="padding-top: 1pt;padding-left: 53pt;text-indent: 0pt;line-height: 143%;text-align: left;"><span>squeakOnce(&quot;only once&quot;); // no output<br/>squeakOnce(&quot;only once&quot;); // no output</span></p><p style="padding-top: 8pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>The previous steps showed us how we could test our once () function by hand, but our method is<br/>not exactly ideal. In the next section, we’ll see why and how to do better.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 43pt;text-indent: 0pt;text-align: left;"><a name="bookmark91">Testing the solution automatically</a><a name="bookmark105">&zwnj;</a></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>Running tests by hand isn’t suitable: it gets tiresome and boring, and it leads, after a while, to not<br/>running the tests any longer. Let’s do better and write some automatic tests with </span><b>Jest:</b></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// once.test.ts</p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 30pt;text-align: left;"><span>import once } from &quot;./once&quot;;<br/>describe(&quot;once&quot;, () =&gt; {</span></p><p style="padding-top: 4pt;padding-left: 76pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>it(&quot;without &#39;once&#39;, a function always runs&quot;, () =&gt; {<br/>const myFn = jest.fnf);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 25pt;text-indent: 0pt;text-align: left;">36 Thinking Functionally - A First Example</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 85pt;text-indent: 0pt;text-align: left;">myFn();</p><p style="padding-top: 4pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">myFn();</p><p style="padding-top: 4pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">myFn();</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">expect(myFn) .toHaveBeenCalledTimes (3) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 85pt;text-indent: -11pt;line-height: 142%;text-align: left;"><span>it(&quot;with &#39;once&#39;, a function runs one time&quot;, () =&gt; {<br/>const myFn = jest.fnO;</span></p><p style="padding-left: 85pt;text-indent: 0pt;text-align: left;">const onceFn = jest.fn(once(myFn));</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">onceFn();</p><p style="padding-top: 4pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">onceFn();</p><p style="padding-top: 4pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">onceFn();</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: right;">});</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;">});</p><p style="padding-top: 4pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>expect(onceFn).toHaveBeenCalledTimes(3);<br/>expect(myFn).toHaveBeenCalledTimes(1) ;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">There are several points to note here:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l22"><li data-list-text="•"><p style="padding-left: 79pt;text-indent: -13pt;line-height: 124%;text-align: left;"><span>To spy on a function (for instance, to count how many times it was called), we need to pass it<br/>as an argument to j est. f n (); we can apply tests to the result, which works exactly like the<br/>original function, but can be spied on.</span></p></li><li data-list-text="•"><p style="padding-top: 5pt;padding-left: 79pt;text-indent: -13pt;line-height: 123%;text-align: left;"><span>When you spy on a function, Jest intercepts your calls and registers that the function was called,<br/>with which arguments, and how many times it was called.</span></p></li><li data-list-text="•"><p style="padding-top: 5pt;padding-left: 79pt;text-indent: -12pt;line-height: 123%;text-align: left;"><span>The first test only checks that if we call the function several times, it gets called that number of<br/>times. This is trivial, but we’d be doing something wrong if that didn’t happen!</span></p></li><li data-list-text="•"><p style="padding-top: 5pt;padding-left: 79pt;text-indent: -13pt;line-height: 124%;text-align: left;"><span>In the second test, we apply once () to a (dummy) myFn () function, and we call the result<br/>(onceFn ()) several times. We then check that myFn () was called only once, though<br/>onceFn                                             () was called three times.</span></p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 12pt;padding-left: 302pt;text-indent: 0pt;text-align: left;">A functional solution to our problem   37</p><p style="padding-top: 22pt;padding-left: 43pt;text-indent: 0pt;text-align: left;">We can see the results in <i>Figure 2.3:</i></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s137" style="padding-left: 1pt;text-indent: 0pt;line-height: 10pt;text-align: left;">codeF<span class="s138">orCh</span>apters/chapt<span class="s138">er02/once.test.ts</span></p><p style="padding-left: 82pt;text-indent: 0pt;line-height: 10pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s139" style="padding-left: 1pt;text-indent: 0pt;line-height: 8pt;text-align: left;">once</p><p class="s139" style="padding-top: 1pt;padding-left: 22pt;text-indent: 0pt;text-align: left;">without   &#39;once<span class="s140">1</span>,  a   function   always   runs  (2  ms)</p><p class="s139" style="padding-top: 1pt;padding-left: 12pt;text-indent: 0pt;text-align: left;"><span class="s141">J </span>with &#39;once<span class="s140">1</span>, a function runs one time (1 ms)</p><p style="padding-left: 55pt;text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"><br/></p><table style="border-collapse:collapse" cellspacing="0"><tr style="height:5pt"><td style="width:245pt;border-bottom-style:solid;border-bottom-width:1pt" colspan="5" bgcolor="#000000"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:17pt;border-bottom-style:solid;border-bottom-width:1pt" colspan="2" bgcolor="#040404"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:128pt;border-bottom-style:solid;border-bottom-width:1pt" colspan="2" bgcolor="#000000"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:14pt"><td style="width:54pt;border-top-style:solid;border-top-width:1pt" bgcolor="#000000"><p class="s142" style="padding-top: 5pt;padding-left: 1pt;text-indent: 0pt;line-height: 7pt;text-align: left;">File</p></td><td style="width:64pt;border-top-style:solid;border-top-width:1pt" bgcolor="#000000"><p class="s143" style="padding-left: 4pt;text-indent: 0pt;line-height: 6pt;text-align: left;">1     1</p><p class="s142" style="padding-left: 4pt;text-indent: 0pt;line-height: 7pt;text-align: left;">| % Stmts |</p></td><td style="width:61pt;border-top-style:solid;border-top-width:1pt;border-bottom-style:solid;border-bottom-width:1pt" rowspan="2" bgcolor="#000000"><p class="s143" style="padding-left: 48pt;text-indent: 0pt;line-height: 6pt;text-align: center;">l</p><p class="s143" style="padding-right: 2pt;text-indent: 0pt;line-height: 8pt;text-align: center;">% Branch |</p><p class="s144" style="padding-right: 1pt;text-indent: 0pt;line-height: 5pt;text-align: center;"> &nbsp;&nbsp;&nbsp;&nbsp; <span class="s142">i.</span></p></td><td style="width:44pt;border-top-style:solid;border-top-width:1pt" bgcolor="#000000"><p class="s143" style="padding-top: 5pt;padding-right: 4pt;text-indent: 0pt;line-height: 7pt;text-align: right;">% Funes</p></td><td style="width:39pt;border-top-style:solid;border-top-width:1pt" colspan="3" bgcolor="#000000"><p class="s145" style="padding-top: 5pt;padding-left: 3pt;text-indent: 0pt;line-height: 7pt;text-align: left;">1 <span style=" color: #FFF;">%  </span><span class="s143">Lin</span></p></td><td style="width:15pt;border-top-style:solid;border-top-width:1pt" bgcolor="#000000"><p class="s143" style="padding-top: 5pt;padding-left: 3pt;text-indent: 0pt;line-height: 7pt;text-align: left;">es</p></td><td style="width:113pt;border-top-style:solid;border-top-width:1pt;border-bottom-style:solid;border-bottom-width:1pt" rowspan="2" bgcolor="#000000"><p class="s143" style="padding-left: 3pt;text-indent: 0pt;line-height: 6pt;text-align: left;">1</p><p class="s143" style="padding-left: 4pt;text-indent: 0pt;line-height: 8pt;text-align: left;">| Uncovered Line #s</p><p class="s144" style="text-indent: 0pt;line-height: 5pt;text-align: left;"><span class="s142">. । </span>&nbsp;&nbsp; <span class="s142">_ </span>&nbsp;&nbsp;&nbsp;&nbsp; <span class="s147"> </span>&nbsp;&nbsp;&nbsp;&nbsp; </p></td></tr><tr style="height:6pt"><td style="width:54pt;border-bottom-style:solid;border-bottom-width:1pt" bgcolor="#030103"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:64pt;border-bottom-style:solid;border-bottom-width:1pt" bgcolor="#000000"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:44pt;border-bottom-style:solid;border-bottom-width:1pt" bgcolor="#040304"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:22pt;border-bottom-style:solid;border-bottom-width:1pt" bgcolor="#000000"><p class="s142" style="padding-left: 4pt;text-indent: 0pt;line-height: 4pt;text-align: left;">1 —. 1</p></td><td style="width:3pt;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#DEE5CF" bgcolor="#000000"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:14pt;border-bottom-style:solid;border-bottom-width:1pt" bgcolor="#040304"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:15pt;border-bottom-style:solid;border-bottom-width:1pt" bgcolor="#040304"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:15pt"><td style="width:54pt;border-top-style:solid;border-top-width:1pt" bgcolor="#000000"><p class="s148" style="padding-top: 3pt;padding-left: 1pt;text-indent: 0pt;line-height: 10pt;text-align: left;">ATI files</p></td><td style="width:64pt;border-top-style:solid;border-top-width:1pt" bgcolor="#000000"><p class="s142" style="padding-left: 4pt;text-indent: 0pt;line-height: 5pt;text-align: left;">1     <span class="s149">1</span></p><p class="s148" style="padding-left: 4pt;text-indent: 0pt;line-height: 9pt;text-align: left;">1  100 ।</p></td><td style="width:61pt;border-top-style:solid;border-top-width:1pt" bgcolor="#000000"><p class="s142" style="padding-right: 5pt;text-indent: 0pt;line-height: 5pt;text-align: right;">1</p><p class="s148" style="padding-right: 5pt;text-indent: 0pt;line-height: 9pt;text-align: right;">100 <span style=" color: #DFE6D0;">|</span></p></td><td style="width:44pt;border-top-style:solid;border-top-width:1pt" bgcolor="#000000"><p class="s148" style="padding-top: 3pt;padding-right: 4pt;text-indent: 0pt;line-height: 10pt;text-align: right;">109</p></td><td style="width:22pt;border-top-style:solid;border-top-width:1pt" bgcolor="#000000"><p class="s142" style="padding-top: 6pt;padding-left: 3pt;text-indent: 0pt;line-height: 7pt;text-align: left;">1</p></td><td style="width:3pt;border-top-style:solid;border-top-width:1pt;border-top-color:#DEE5CF" bgcolor="#000000"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:29pt;border-top-style:solid;border-top-width:1pt" colspan="2" bgcolor="#000000"><p class="s148" style="padding-top: 3pt;padding-left: 10pt;text-indent: 0pt;line-height: 10pt;text-align: left;">199</p></td><td style="width:113pt;border-top-style:solid;border-top-width:1pt" bgcolor="#000000"><p class="s142" style="padding-left: 3pt;text-indent: 0pt;line-height: 5pt;text-align: left;">1</p><p class="s142" style="padding-top: 1pt;padding-left: 3pt;text-indent: 0pt;line-height: 7pt;text-align: left;">1</p></td></tr><tr style="height:10pt"><td style="width:54pt" bgcolor="#000000"><p class="s148" style="padding-left: 7pt;text-indent: 0pt;line-height: 8pt;text-align: left;">once.ts</p></td><td style="width:58pt" bgcolor="#000000"><p class="s148" style="padding-left: 4pt;text-indent: 0pt;line-height: 8pt;text-align: left;">|  180 |</p></td><td style="width:6pt" bgcolor="#000000"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:61pt" bgcolor="#000000"><p class="s148" style="padding-left: 36pt;text-indent: 0pt;line-height: 8pt;text-align: left;">100 <span style=" color: #DFE6D0;">|</span></p></td><td style="width:44pt" bgcolor="#000000"><p class="s148" style="padding-right: 4pt;text-indent: 0pt;line-height: 8pt;text-align: right;">199</p></td><td style="width:22pt;border-bottom-style:solid;border-bottom-width:1pt" rowspan="2" bgcolor="#000000"><p class="s142" style="padding-top: 2pt;padding-left: 3pt;text-indent: 0pt;line-height: 7pt;text-align: left;">1</p><p class="s142" style="padding-left: 4pt;text-indent: 0pt;line-height: 4pt;text-align: left;">1 <span style=" color: #FFF;">. . .</span></p></td><td style="width:32pt;border-bottom-style:solid;border-bottom-width:1pt" colspan="2" rowspan="2" bgcolor="#000000"><p class="s148" style="padding-left: 13pt;text-indent: 0pt;line-height: 9pt;text-align: left;">109</p></td><td style="width:113pt;border-bottom-style:solid;border-bottom-width:1pt" rowspan="2" bgcolor="#000001"><p class="s142" style="padding-top: 2pt;padding-left: 3pt;text-indent: 0pt;line-height: 7pt;text-align: left;">1</p><p class="s144" style="text-indent: 0pt;line-height: 4pt;text-align: left;"><span class="s142">. ।  </span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<span class="s147"> </span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;</p></td></tr><tr style="height:6pt"><td style="width:54pt;border-bottom-style:solid;border-bottom-width:1pt" bgcolor="#040403"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:125pt;border-bottom-style:solid;border-bottom-width:1pt" colspan="2" bgcolor="#000000"><p class="s143" style="padding-left: 1pt;text-indent: 0pt;line-height: 4pt;text-align: left;">. i<span class="s150"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="s151"> </span>i<span class="s151">        </span><span style=" color: #DFE6D0;">1.</span></p></td><td style="width:44pt;border-bottom-style:solid;border-bottom-width:1pt" bgcolor="#030403"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:4pt"><td style="width:390pt;border-top-style:solid;border-top-width:1pt" colspan="9" bgcolor="#030403"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:21pt"><td style="width:69pt;border-right-style:solid;border-right-width:6pt;border-right-color:#FFFFFF" colspan="2" rowspan="3" bgcolor="#000000"><p class="s149" style="padding-right: 15pt;text-indent: 0pt;text-align: left;"><span>Test Suites:<br/>Tests:<br/>Snapshots:<br/>Tiie:</span></p><p class="s142" style="text-indent: 0pt;line-height: 8pt;text-align: left;">Ran all test</p></td><td style="width:97pt;border-left-style:solid;border-left-width:6pt;border-left-color:#FFFFFF" bgcolor="#000000"><p class="s148" style="text-indent: 0pt;line-height: 10pt;text-align: left;">1 passed, <span class="s143">1 total</span></p><p class="s148" style="text-indent: 0pt;line-height: 9pt;text-align: left;">2 passed, <span class="s143">2 total</span></p></td><td style="width:79pt" colspan="2" rowspan="2"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:145pt" colspan="4" rowspan="3"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:11pt"><td style="width:43pt;border-left-style:solid;border-left-width:6pt;border-left-color:#FFFFFF" bgcolor="#000000"><p class="s152" style="text-indent: 0pt;line-height: 9pt;text-align: left;">0 <span class="s142">total</span></p></td><td style="width:54pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:21pt"><td style="width:176pt;border-left-style:solid;border-left-width:6pt;border-left-color:#FFFFFF" colspan="3" bgcolor="#000000"><p class="s143" style="text-indent: 0pt;text-align: left;">1.138 s, estimated 3 s</p><p class="s143" style="padding-top: 1pt;padding-left: 1pt;text-indent: 0pt;line-height: 8pt;text-align: left;">suites matching /once.test.ts/i,</p></td></tr></table><p style="text-indent: 0pt;text-align: left;"/><p class="s139" style="padding-left: 51pt;text-indent: 0pt;text-align: center;">1 <span style=" color: #FFF;">—</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 129pt;text-indent: 0pt;text-align: left;">Figure 2.3 - Running automatic tests on our function with Jest</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>With that, we have seen not only how to test our functional solution by hand but also in an automatic<br/>way, so we are done with testing. Let’s just finish by considering an even better solution, also achieved<br/>in a functional way.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 44pt;text-indent: 0pt;text-align: justify;"><a name="bookmark92">Producing an even better solution</a><a name="bookmark106">&zwnj;</a></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>In one of the previous solutions, we mentioned that it would be a good idea to do something every time<br/>after the first click, and not silently ignore the user’s clicks. We’ll write a new higher-order function<br/>that takes a second parameter - a function to be called every time from the second call onward. Our<br/>new function will be called onceAndAfter () and can be written as follows:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// onceAndAfter.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">const onceAndAfter = &lt;</p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">FNType   extends   (...args:   any[])   =&gt;   any</p><p style="padding-top: 5pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">&gt;(</p><p style="padding-top: 3pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">f:  FNType,</p><p style="padding-top: 4pt;padding-left: 64pt;text-indent: 0pt;text-align: left;">g:  FNType</p><p style="padding-top: 6pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">) =&gt; {</p><p style="padding-top: 2pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">let done    false;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 25pt;text-indent: 0pt;text-align: left;">38 Thinking Functionally - A First Example</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 86pt;text-indent: -12pt;line-height: 144%;text-align: left;"><span>return ((...args: Parameters&lt;FNType&gt;) =&gt; {<br/>if (!done) {</span></p><p style="padding-left: 97pt;text-indent: 0pt;line-height: 141%;text-align: left;"><span>done = true;<br/>return f(...args);</span></p><p style="padding-left: 86pt;text-indent: 0pt;text-align: left;">} else {</p><p style="padding-top: 4pt;padding-left: 97pt;text-indent: 0pt;text-align: left;">return g(...args);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">}) as FNType;</p><p style="padding-top: 6pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">};</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>We have ventured further into higher-order functions; onceAndAfter () takes two functions as<br/>parameters and produces a third one, which includes the other two within.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-top: 5pt;padding-left: 65pt;text-indent: 0pt;text-align: left;"><a name="bookmark93">Function as default</a></p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;line-height: 114%;text-align: left;"><span>You could make onceAndAf ter () more powerful by giving a default value for g, such as<br/>() = &gt; {}, so if you didn’t specify the second function, it would still work fine because the<br/>default do-nothing function would be called instead of causing an error.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>We can do a quick-and-dirty test along the same lines as we did earlier. Let’s add a creak () creaking<br/>function to our previous squeak () one and check out what happens if we apply onceAndAf ter ()</span></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">to them. We can then get a makeSound () function that should squeak once and creak afterward:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// onceAndAfter.manual.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">import { onceAndAfter } from &quot;./onceAndAfter&quot;;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;line-height: 287%;text-align: left;"><span>const squeak = (x: string) =&gt; console.log(x, &quot;squeak!!&quot;);<br/>const creak = (x: string) =&gt; console.log(x, &quot;creak!!&quot;);<br/>const makeSound = onceAndAfter(squeak, creak);</span></p><p style="padding-left: 61pt;text-indent: 0pt;line-height: 143%;text-align: justify;"><span>makeSound(&quot;door&quot;);<br/>makeSound(&quot;door&quot;);<br/>makeSound(&quot;door&quot;);<br/>makeSound(&quot;door&quot;);</span></p><p style="padding-left: 37pt;text-indent: 0pt;line-height: 10pt;text-align: left;">//   &quot;door   squeak!!</p><p style="padding-top: 4pt;padding-left: 37pt;text-indent: 0pt;text-align: left;">//   &quot;door   creak!!&quot;</p><p style="padding-top: 4pt;padding-left: 37pt;text-indent: 0pt;text-align: left;">//   &quot;door   creak!!&quot;</p><p style="padding-top: 4pt;padding-left: 37pt;text-indent: 0pt;text-align: left;">// &quot;door creak!!&quot;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 403pt;text-indent: 0pt;text-align: left;">Summary  39</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>Writing a test for this new function isn’t hard, only a bit longer. We have to check which function was<br/>called and how many times:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// onceAndAfter.test.ts</p><p style="padding-top: 3pt;padding-left: 52pt;text-indent: 0pt;line-height: 30pt;text-align: left;"><span>import { onceAndAfter } from &quot;,/onceAndAfter&quot;;<br/>describe(&quot;onceAndAfter&quot;, () =&gt; {</span></p><p style="padding-left: 77pt;text-indent: -11pt;line-height: 143%;text-align: left;"><span>it (&quot;calls the 1st function once &amp; the 2nd after&quot;, () =&gt; {<br/>const fund = jest.fn();</span></p><p style="padding-left: 76pt;text-indent: 0pt;text-align: left;">const func2 = jest.fnO;</p><p style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">const testFn = jest.fn(onceAndAfter(fund, func2));</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">testFn();</p><p style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">testFn();</p><p style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">testFn();</p><p style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">testFn();</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 8pt;text-indent: 0pt;text-align: right;">});</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;">});</p><p style="padding-top: 4pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>expect(testFn).toHaveBeenCalledTimes(4);<br/>expect (fund) . toHaveBeenCalledTimes (1) ;<br/>expect(func2).toHaveBeenCalledTimes(3);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><a name="bookmark94"><span>Notice that we always check that fund () is called only once. Similarly, we check func2 (); the<br/>count of calls starts at zero (the time that fund () is called), and from then on, it goes up by one<br/>on each call.</span></a><a name="bookmark107">&zwnj;</a></p><p class="s6" style="padding-top: 9pt;padding-left: 43pt;text-indent: 0pt;text-align: left;">Summary</p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>In this chapter, we’ve seen a common, simple problem based on a real-life situation. After analyzing<br/>several typical ways of solving that, we went for a functional thinking solution. We saw how to apply<br/>FP to our problem and found a more general higher-order solution that we could apply to similar<br/>problems with no further code changes. We saw how to write unit tests for our code to round out the<br/>development job.</span></p><p style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Finally, we produced an even better solution (from the point of view of the user experience) and saw<br/>how to code it and how to unit-test it. Now, you’ve started to get a grip on how to solve a problem<br/>functionally; next, in </span><i>Chapter 3, Starting Out with Functions, </i><span>we’ll delve more deeply into functions,<br/>which  are at the core of all FP.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: right;">40 Thinking Functionally - A First Example</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;text-align: left;"><a name="bookmark95">Questions</a><a name="bookmark108">&zwnj;</a></p><ol id="l23"><ol id="l24"><li data-list-text="2.1"><p class="s10" style="padding-top: 9pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;">No extra variables: <span class="p">Our functional implementation required using an extra variable, done, to<br/>mark whether the function had already been called. Not that it matters, but could you make do without<br/>using any extra variables? Note that we aren’t telling you not to use any variables, it’s just a matter of<br/>not adding any new ones, such as done, and only as an exercise!</span></p></li><li data-list-text="2.2"><p class="s10" style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;">Alternating functions: In <span class="p">the spirit of our onceAndAfter () function, can you write an<br/>alternator  ()  higher-order  function  that  gets  two  functions  as  arguments  and,  on  each  call,<br/>alternatively calls one and another? The expected behavior should be as in the following example:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;line-height: 139%;text-align: left;"><span>const sayA = () =&gt; console.log(&quot;A&quot;);<br/>const sayB = () =&gt; console.log(&quot;B&quot;);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: right;">const alt = alternator(sayA, sayB);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">alt();    //A</p><p style="padding-top: 4pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">alt  ();  //  B</p><p style="padding-top: 4pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">alt();    //A</p><p style="padding-top: 4pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">alt();  //  B</p><p style="padding-top: 4pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">alt()  ;  //A</p><p style="padding-top: 5pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">alt() ; // B</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="2.3"><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><b>Everything has a limit! </b><span>As an extension of once (), could you write a higher-order function,<br/>thisManyTimes (f n, n), that would let you call the f n () function up to </span><i>n </i><span>times, but would do<br/>nothing afterward? To give an example, once (f n) and thisManyTimes (f n, 1) would produce<br/>functions that behave the same way. Do also write tests for it.</span></p></li><li data-list-text="2.4"><p class="s10" style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;">Allow for crashing: <span class="p">Suppose we apply once 0 to a function, and the first time that function gets<br/>called, it crashes. Here, we may want to allow a second call to the function, hoping it wouldn’t crash<br/>again. We want an oncelf Success () function, that will get a function as a parameter and produce<br/>a new function that will run successfully only once, but will be allowed to fail (throwing exceptions)<br/>many times if need be. Implement oncelf Success (), and don’t forget to write unit tests for it.</span></p></li><li data-list-text="2.5"><p class="s10" style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;">Say no to arrows: <span class="p">Implement once () using classic functions, instead of arrow functions. This is<br/>just meant to help you explore the slightly different needed data typing syntax.</span></p></li></ol></ol><p style="text-indent: 0pt;text-align: left;"><br/></p><h3 style="padding-top: 10pt;text-indent: 0pt;text-align: right;"><a name="bookmark109">3</a><a name="bookmark110">&zwnj;</a></h3><h2 style="padding-top: 4pt;text-indent: 0pt;text-align: right;">Starting Out with Functions</h2><h2 style="padding-top: 2pt;text-indent: 0pt;text-align: right;">- A Core Concept</h2><p style="padding-top: 29pt;padding-left: 43pt;text-indent: 0pt;line-height: 126%;text-align: justify;">In <i>Chapter 2, Thinking Functionally, </i><span>we discussed an example of FP thinking, but now, let’s look at<br/>the basics and review functions.</span></p><p style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;text-align: justify;">In this chapter, we’ll do the following:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l25"><li data-list-text="•"><p class="s33" style="padding-left: 70pt;text-indent: -13pt;line-height: 125%;text-align: left;">	<span class="p">Discuss functions in JavaScript, including how to define them, with a particular focus on<br/>arrow functions</span></p></li><li data-list-text="•"><p style="padding-top: 5pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">Learn about currying and functions as first-class objects</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">Explore several ways of using functions in an FP way</p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><a name="bookmark111"><span>After going through all this content, you’ll be up to date with the generic and specific concepts relating<br/>to functions, which are, after all, at the core of FP!</span></a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-left: 43pt;text-indent: 0pt;text-align: justify;">All about functions</p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Let’s start with a short review of functions in JavaScript and their relationship to FP concepts. We<br/>will begin with something that we mainly mentioned in the </span><i>Functions as first-class objects </i><span>section of<br/></span><i>Chapter 1, Becoming Functional, </i>and again in a couple of places in <i>Chapter 2, Thinking Functionally,</i><span>and then go on to several considerations about their usage in actual coding. In particular, we’ll be<br/>looking at the following:</span></p><p style="padding-top: 8pt;padding-left: 70pt;text-indent: 0pt;text-align: left;">Some basic concepts about lambda calculus, which is the theoretical basis for FP</p><p style="padding-top: 8pt;padding-left: 70pt;text-indent: 0pt;line-height: 179%;text-align: left;"><span>Arrow functions, which are the most direct translation of lambda calculus into JavaScript<br/>Using functions as first-class objects, a key concept in FP</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 25pt;text-indent: 0pt;text-align: left;">42  Starting Out with Functions - A Core Concept</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;text-align: justify;"><a name="bookmark112">Of lambdas and functions</a></p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;">In lambda calculus terms, a function can look like <i>\x.2*x. </i><span>The understanding is that the variable<br/>after the X character (the Greek letter </span><i>lambda </i><span>in lowercase) is the parameter for the function, and the<br/>expression after the dot is where you would replace whatever value is passed as an argument. Later in<br/>this chapter, we will see that this particular example could be written as (x) =&gt; 2 *x in JavaScript<br/>in arrow function form, which, as you can see, is very similar.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 65pt;text-indent: 0pt;text-align: justify;"><a name="bookmark113">An alliterative aid</a></p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;line-height: 115%;text-align: justify;"><span>If you sometimes wonder about the difference between arguments and parameters, a mnemonic<br/>with some alliteration may help: </span><i>Parameters are Potential, Arguments are Actual. </i><span>Parameters<br/>are placeholders for potential values that will be passed, and arguments are the actual values<br/>passed to the function. In other words, when you define the function, you list its parameters,<br/>and when you call it, you provide arguments.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Applying a function means you provide an actual argument to it, which is written in the usual way,<br/>using parentheses. For example, (A.x.2*x)(3) would be calculated as 6. What’s the equivalent of these<br/>lambda functions in JavaScript? That’s an interesting question! There are several ways of defining<br/>functions, and not all have the same meaning.</span></p><p style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>In how many ways can you define a function in JavaScript? The answer is probably in more ways than<br/>you thought! (A good article that shows the many ways of defining functions, methods, and more is<br/></span><i>The Many Faces of Functions in JavaScript, </i><span>by Leo Balter and Rick Waldron, at bocoup . com/blog/<br/>the-many-f  aces-of  -  functions-in-javascript  -  give  it  a  look!)  At  the  very  least,  you<br/>could write the following - and I’ll use vanilla JavaScript because here types aren’t a concern:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l26"><li data-list-text="•"><p style="padding-left: 79pt;text-indent: -13pt;text-align: left;">A named function declaration: function first (...) {...};</p></li><li data-list-text="•"><p style="padding-top: 7pt;padding-left: 79pt;text-indent: -13pt;text-align: left;">An anonymous function expression: var second = function ( . . . )</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 79pt;text-indent: -13pt;text-align: left;">A named function expression: var third = function someName (...) {...};</p></li><li data-list-text="•"><p class="s33" style="padding-top: 8pt;padding-left: 80pt;text-indent: -13pt;line-height: 128%;text-align: left;">	<span class="p">An  immediately-invoked  expression:  var  fourth  =  (function  ()  {  ...; return<br/>function (...) {...}; }) 0 ;</span></p></li><li data-list-text="•"><p style="padding-top: 4pt;padding-left: 79pt;text-indent: -13pt;text-align: left;">A function constructor: var fifth = new Function (...) ;</p></li><li data-list-text="•"><p style="padding-top: 7pt;padding-left: 79pt;text-indent: -13pt;text-align: left;">An arrow function: var sixth = (...) =&gt; {...};</p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 121%;text-align: justify;"><span>If you wanted, you could add object method declarations since they also imply functions, but the<br/>preceding list should be enough.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 368pt;text-indent: 0pt;text-align: left;">All about functions  43</p><p class="s10" style="padding-top: 26pt;padding-left: 56pt;text-indent: 0pt;text-align: left;"><a name="bookmark114">More function types</a></p><p style="padding-top: 4pt;padding-left: 57pt;text-indent: 0pt;text-align: left;">JavaScript also allows us to define <b>generator </b>functions (as in function* (...) {. }) that</p><p style="padding-top: 1pt;padding-left: 57pt;text-indent: 0pt;line-height: 120%;text-align: left;"><span>return a Generator object and async functions that are a mix of generators and promises. You<br/>can read more about them at developer. moziIla. org/en/docs/Web/JavaScript/<br/>Reference/Statements/function and developer.mozilla.org/en-US/</span></p><p style="padding-left: 57pt;text-indent: 0pt;text-align: left;">docs/Web/JavaScript/Ref erence/Statements/async_f unction, respectively.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>What’s the difference between all these ways of defining functions, and why should we care? Let’s go<br/>over them one by one:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l27"><li data-list-text="•"><p style="padding-left: 70pt;text-indent: -12pt;line-height: 124%;text-align: justify;"><span class="s33">	</span><span>The first definition, function f irst ( . . .) {...},a standalone declaration starting<br/>with the function keyword, is probably the most used in JavaScript and defines a function<br/>named first (that is, first. name= = =&quot; first &quot;)■ Because of </span><b>hoisting, </b><span>this function will<br/>be accessible everywhere in the scope where it’s defined; we’ll touch on this again later in the<br/></span><i>Functions as objects </i><span>section. (Of course, this only happens if you use a var definition; with<br/>let   or const, hoisting doesn’t apply. You can read more about hoisting at developer .<br/>mozilla  .  org/en-US/docs/Glossary/Hoisting.  Remember  that  it  applies  only<br/>to declarations, not to initializations.)</span></p></li><li data-list-text="•"><p style="padding-top: 5pt;padding-left: 70pt;text-indent: -12pt;line-height: 124%;text-align: justify;"><span class="s33">	</span><span>The  second  =  function  (...)  {  .  .  .  }  definition,  which  assigns  a  function  to a<br/>variable, also produces a function, but an </span><i>anonymous </i><span>(that is, not named) one. However, many<br/>JavaScript engines can deduce what the name should be and will then set second. name ===<br/>&quot; second&quot;. (Look at the following code, which shows a case where the anonymous function<br/>has no name assigned.) Since the assignment isn’t hoisted, the function will only be accessible<br/>after the assignment has been executed. Also, you’d probably prefer defining the variable with<br/>const rather than var, because you wouldn’t (shouldn’t) be changing the function - take a<br/>look at the ESLint no-var and pref er-const rules to enforce this:</span></p><p style="padding-top: 7pt;padding-left: 84pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>var second = function() {};<br/>console.log(second.name);</span></p><p style="padding-left: 84pt;text-indent: 0pt;line-height: 10pt;text-align: left;">// &quot;second&quot;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 83pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>var myArray = new Array(3);<br/>myArray[1] = function!) {};<br/>console.log(myArray[1].name);</span></p><p style="padding-top: 1pt;padding-left: 84pt;text-indent: 0pt;text-align: left;">// &quot;&quot;</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="•"><p style="padding-left: 70pt;text-indent: -12pt;line-height: 124%;text-align: justify;"><span class="s33">	</span><span>The  third  definition,  third  =  function  someName  (...)  {...},  is  the  same  as the<br/>second, except that the function now has its own name: third. name === &quot; someName&quot;.<br/>Ure name of a function is relevant when you want to call it and is needed for recursive calls;<br/>we’ll return to this in </span><i>Chapter 9, Designing Functions. </i><span>If you just want a function for, say, a<br/>callback, you can use one without a name. However, note that named functions are more easily</span></p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 25pt;text-indent: 0pt;text-align: left;">44  Starting Out with Functions - A Core Concept</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 79pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>recognized in an error traceback, the kind of listing you use when trying to understand what<br/>happened, and which function called what.</span></p><ul id="l28"><li data-list-text="•"><p style="padding-top: 4pt;padding-left: 79pt;text-indent: -13pt;text-align: justify;">The fourth definition, fourth = (function!) {            return f unction (... )</p><p style="padding-top: 1pt;padding-left: 79pt;text-indent: 1pt;line-height: 115%;text-align: justify;"><span>{...}; }) (), with an immediately-invoked expression, lets you use a closure. Going back<br/>to the counter-making function that we saw in the </span><i>Closures </i>section of <i>Chapter 1, Becoming</i><span>we could write something like the following. An inner function can use variables<br/>or  other functions, defined in its outer function, in a private, encapsulated way. The outer<br/>function receives an argument (77, in this case) that is used as the initial value of count (if<br/>no initial value is provided, we start at 0). The inner function can access count (because of<br/>the closure), but the variable cannot be accessed anywhere else. In all aspects, the returned<br/>function is common - the only difference is its access to private elements. This is also the basis<br/>of the </span><b>module </b>pattern:</p><p style="padding-top: 3pt;padding-left: 105pt;text-indent: -12pt;line-height: 16pt;text-align: justify;"><span>const myCounter = (function myCounter(initialvalue =<br/>0) {</span></p><p style="padding-top: 1pt;padding-left: 105pt;text-indent: 0pt;line-height: 132%;text-align: justify;"><span>let count = initialvalue;<br/>return function () {</span></p><p style="padding-left: 117pt;text-indent: 0pt;line-height: 132%;text-align: justify;"><a name="bookmark115"><span>count++;<br/>return count;</span></a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 94pt;text-indent: 0pt;text-align: left;">}) (77) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 5pt;padding-left: 93pt;text-indent: 0pt;text-align: left;">console.log(myCounter()); // 78</p><p style="padding-top: 3pt;padding-left: 93pt;text-indent: 0pt;text-align: left;">console.log(myCounter()); // 79</p><p style="padding-top: 3pt;padding-left: 93pt;text-indent: 0pt;text-align: left;">console.log(myCounter()); // 80</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="•"><p style="padding-left: 79pt;text-indent: -12pt;line-height: 115%;text-align: justify;"><span class="s33">	</span><span>The fifth definition, fifth = new Function (...), isn’t safe and you shouldn’t use<br/>it! You pass the names of the arguments first, then the actual function body as a string, and<br/>the equivalent of eval () is used to create the function - this allows many dangerous hacks,<br/>so don’t do this! (Also, TypeScript cannot deduce the type of the produced function; it just<br/>assumes the generic Function type.) Just to whet your curiosity, let’s look at an example of<br/>rewriting the very simple sum3 () function we saw back in the </span><i>Spread </i>section of <i>Chapter 1,</i></p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 106pt;text-indent: -12pt;line-height: 142%;text-align: left;"><span>const sum3 = new Function(<br/>&quot;x&quot; ,</span></p><p style="padding-top: 1pt;padding-left: 106pt;text-indent: 0pt;text-align: left;">&quot;y&quot;,</p><p style="padding-top: 3pt;padding-left: 106pt;text-indent: 0pt;text-align: left;">&quot; z&quot;,</p><p style="padding-top: 4pt;padding-left: 106pt;text-indent: 0pt;text-align: left;">&quot;const t = x+y+z; return t;&quot;</p><p style="padding-top: 5pt;padding-left: 94pt;text-indent: 0pt;text-align: left;">) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 6pt;padding-left: 93pt;text-indent: 0pt;text-align: left;">sum3(4, 6, 7); // 17</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 368pt;text-indent: 0pt;text-align: left;">All about functions  <span class="s153">45</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 57pt;text-indent: 0pt;text-align: justify;">Quirks of eval()</p><p style="padding-top: 4pt;padding-left: 56pt;text-indent: 0pt;line-height: 115%;text-align: justify;"><span>This definition is not only unsafe but has some other quirks - they don’t create closures with<br/>their creation contexts, so they are always global. See developer. mozilla . org/en-US/<br/>docs/Web/JavaScript/Reference/Global_Obj     ects/Function     for    more    on<br/>this, but remember that this way of creating functions isn’t a good idea!</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l29"><li data-list-text="•"><p class="s33" style="padding-top: 7pt;padding-left: 70pt;text-indent: -13pt;line-height: 123%;text-align: left;">	<span class="p">Finally, the last definition, sixth = (...) =&gt; {...}, which uses an arrow, = &gt;, is the<br/>most compact way to define a function and the one we’ll try to use whenever possible.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>At this point, we have seen several ways of defining a function, so let’s focus on arrow functions,<br/>a style we’ll favor in our coding for this book.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 43pt;text-indent: 0pt;text-align: justify;"><a name="bookmark116">Arrow functions - the modern way</a></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 121%;text-align: justify;"><span>Even if arrow functions work in pretty much the same way as the other functions, there are some<br/>crucial   differences   (see   developer   .   mozilla   .   org/en-US/docs/Web/JavaScript/<br/>Ref  erence/Functions/Arrow_functions)  between  them  and  the  usual  ones:  arrow<br/>functions can implicitly return a value even with no return statement present; the value of this<br/>(the context for the function) is not bound; there is no arguments object; they cannot be used as<br/>constructors; they do not have a prototype property; and they cannot be used as generators because<br/>they  don’t allow the yield keyword.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;text-align: justify;">In this section, we’ll go into several JavaScript function-related topics, including these:</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="•"><p style="padding-left: 70pt;text-indent: -13pt;text-align: left;">How to return different values</p></li><li data-list-text="•"><p style="padding-top: 7pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">How to handle problems with the value of this</p></li><li data-list-text="•"><p style="padding-top: 7pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">How to work with varying numbers of arguments</p></li><li data-list-text="•"><p style="padding-top: 7pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">An important concept, currying, for which we’ll find many usages in the rest of this book</p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s34" style="padding-left: 43pt;text-indent: 0pt;text-align: justify;">Returning values</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>In the lambda coding style, functions only consist of a result. For the sake of brevity, the new arrow<br/>functions provide a syntax for this. When you write something such as (x, y, z) = &gt; followed by<br/>an expression, a return is implied. For instance, the following two functions do the same as the<br/>sum3 () function that we showed previously:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: justify;">const   fl =  (x: number,    y: number,    z:  number):   number =&gt;</p><p class="s10" style="padding-top: 4pt;padding-left: 64pt;text-indent: 0pt;text-align: left;">x + y + z;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 53pt;text-indent: 0pt;text-align: justify;">const   f2 =  (x: number,    y: number,    z:  number):   number =&gt;   {</p><p class="s10" style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">return x + y + z;</p><p class="s10" style="padding-top: 6pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">};</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 25pt;text-indent: 0pt;text-align: left;">46  Starting Out with Functions - A Core Concept</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>If you want to return an object, you must use parentheses; otherwise, JavaScript will assume that<br/>code follows. Lest you think this is a wildly improbable case, check out </span><i>Question 3.1 </i>in the <i>Questions</i>section later in this chapter for a very common scenario!</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 65pt;text-indent: 0pt;text-align: left;"><a name="bookmark117">A matter of style</a></p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;line-height: 115%;text-align: left;"><span>When you define an arrow function with only one parameter, you can omit the parentheses<br/>around it. For consistency, I prefer to always include them. Prettier, the formatting tool I use<br/>(we mentioned it in </span><i>Chapter 1, Becoming Functional), </i><span>originally didn’t approve, but in version<br/>2.0, it changed the default of its arrow-parens configuration item from avoid (meaning,</span></p><p style="padding-left: 65pt;text-indent: 0pt;line-height: 10pt;text-align: left;">try to do without parentheses) to always.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s34" style="padding-left: 52pt;text-indent: 0pt;text-align: left;">Handling the <span class="p">this </span>value</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: left;"><span>A classic problem with JavaScript is handling this, whose value isn’t always what you expect it to be.<br/>ES2015 solved this with arrow functions, which inherit the proper this value so that problems are<br/>avoided. Look at the following code for an example of the possible problems: by the time the timeout<br/>function is called, this will point to the global (window) variable instead of the new object, so</span></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 10pt;text-align: left;">you’ll get undefined in the console:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 73pt;text-indent: -11pt;line-height: 143%;text-align: left;"><span>function Showltselfl(identity: string) {<br/>this.identity = identity;<br/>setTimeout(function () {</span></p><p style="padding-left: 85pt;text-indent: 0pt;text-align: left;">console.log(this.identity);</p><p style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">} , 10 0 0);</p><p class="s84" style="padding-top: 5pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;text-align: left;">var x = new Showltselfl(&quot;Functional&quot;);</p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">// after one second, <b>undefined </b>is displayed, not <b>Functional</b></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">There are traditional ways of solving this with old-fashioned JavaScript:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l30"><li data-list-text="•"><p class="s33" style="padding-left: 80pt;text-indent: -13pt;line-height: 125%;text-align: left;">	<span class="p">One solution uses a closure and defines a local variable (usually named that or sometimes<br/>self) that will get the original value of this, so it won’t be undefined</span></p></li><li data-list-text="•"><p style="padding-top: 5pt;padding-left: 79pt;text-indent: -12pt;line-height: 123%;text-align: left;"><span class="s33">	</span><span>The second way uses bind (), so the timeout function will be bound to the correct value of<br/>this (we used bind () for a similar purpose in the </span><i>Of lambdas and functions </i>section)</p></li><li data-list-text="•"><p style="padding-top: 5pt;padding-left: 79pt;text-indent: -12pt;line-height: 123%;text-align: left;"><span>A third, more modern way just uses an arrow function, so thi s gets the correct value (pointing<br/>to the object) without further ado</span></p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 12pt;padding-left: 368pt;text-indent: 0pt;text-align: left;">All about functions  47</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>Let’s see the three solutions in actual code. We use a closure for the first timeout, binding for the<br/>second, and an arrow function for the third:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 65pt;text-indent: -12pt;line-height: 142%;text-align: left;"><span>function Showltself2(identity: string) {<br/>this.identity = identity;</span></p><p class="s10" style="padding-left: 64pt;text-indent: 0pt;text-align: left;">const that = this;</p><p style="padding-top: 4pt;padding-left: 76pt;text-indent: -11pt;line-height: 143%;text-align: left;"><span>setTimeout(function () {<br/>console.log(</span><b>that.identity);</b></p><p style="padding-left: 65pt;text-indent: 0pt;text-align: left;">} , 1000) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 77pt;text-indent: -12pt;line-height: 144%;text-align: left;"><span>setTimeout(<br/>function () {</span></p><p style="padding-left: 89pt;text-indent: 0pt;text-align: left;">console.log(this.identity);</p><p class="s10" style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">}.bind(this),</p><p style="padding-top: 4pt;padding-left: 76pt;text-indent: 0pt;text-align: left;">2000</p><p style="padding-top: 5pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 6pt;padding-left: 76pt;text-indent: -11pt;line-height: 143%;text-align: left;"><span>setTimeout(() =&gt; {<br/>console.log(this.identity);</span></p><p style="padding-left: 65pt;text-indent: 0pt;text-align: left;">} , 3 0 0 0);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">const x2 = new Showltself2(&quot;JavaScript&quot;);</p><p style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// after one second, &quot;JavaScript&quot;</p><p style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// after another second, the same</p><p style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// after yet another second, once again</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>If you run this code, you’ll get JavaScript after 1 second, then again after another second, and<br/>a third time after another second. All three methods worked correctly, so whichever you pick just<br/>depends on which you like better.</span></p><p class="s34" style="padding-top: 8pt;padding-left: 44pt;text-indent: 0pt;text-align: justify;">Working with arguments</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;">In <i>Chapter 1, Becoming Functional, </i>and <i>Chapter 2, Thinking Functionally, </i><span>we saw some uses of the<br/>spread (...) operator. However, the most practical usage we’ll be making of it has to do with working<br/>with arguments; we’ll see some cases of this in </span><i>Chapter 6, Producing Functions.</i></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 25pt;text-indent: 0pt;text-align: left;">48  Starting Out with Functions - A Core Concept</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">Let’s review our once () function from <i>Chapter 2, Thinking Functionally:</i></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// once.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 74pt;text-indent: -12pt;line-height: 143%;text-align: left;"><span>const once = &lt;FNType extends (...args: any[J) =&gt; any&gt;(<br/>fn: FNType</span></p><p style="padding-top: 2pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">) =&gt; {</p><p style="padding-top: 2pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">let done = false;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 86pt;text-indent: -12pt;line-height: 143%;text-align: left;">return <b>((...args: </b><span>Parameters&lt;FNType&gt;) =&gt; {<br/>if (I done) {</span></p><p style="padding-left: 97pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>done = true;<br/>return </span><b>fn(...args);</b></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">}) as FNType;</p><p style="padding-top: 6pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">};</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Why are we writing return ( . . . args) = &gt; and then afterward f unc ( . . . args) ? Ure answer<br/>has to do with the more modern way of handling a variable number (possibly zero) of arguments. How<br/>did you manage such kinds of code in older versions of JavaScript? The answer is the argument s object<br/>(not   an   array;   read   developer.   mozilla.   org/en/docs/Web/JavaScript/Reference/<br/>Functions/arguments) that lets you access the actual arguments passed to the function.</span></p><p style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;">It happens that arguments is an <i>array-like </i><span>object, not really an array - the only array property it<br/>has is length. You cannot use methods such as map (), f orEach (), and others on arguments.<br/>To convert arguments into a real array, you have to use slice (); you would also have to use<br/>apply () to call another function, like so:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: right;">function useArguments() {</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 74pt;text-indent: 0pt;line-height: 142%;text-align: left;"><span>var myArray = Array.prototype.slice.call(arguments);<br/>somethingElse.apply(null, myArray);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: -9pt;line-height: 223%;text-align: left;"><span>In modern JavaScript, you don’t need to use arguments, slicing, or applying:<br/>function useArguments2(...args) {</span></p><p style="padding-top: 6pt;text-indent: 0pt;text-align: right;">somethingElse(...args);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 368pt;text-indent: 0pt;text-align: left;">All about functions  49</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: justify;">You should bear in mind the following points when looking at this code:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l31"><li data-list-text="•"><p class="s33" style="padding-left: 70pt;text-indent: -13pt;line-height: 125%;text-align: left;">	<span class="p">By writing useArguments2 (. . . args), we immediately and clearly express that our new<br/>function receives several (possibly zero) arguments</span></p></li><li data-list-text="•"><p style="padding-top: 3pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">You don’t need to do anything to get an array; args is a genuine array</p></li><li data-list-text="•"><p style="padding-top: 6pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">Writing somethingElse ( . . . args) is much clearer than using apply ()</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>By the way, the arguments object is still available in the current version of JavaScript. If you want<br/>to create an array from it, you have two alternative ways of doing so without having to resort to the<br/>Array. prototype . slice . call trick:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="•"><p style="padding-left: 70pt;text-indent: -13pt;text-align: left;">Use the from () method and write myArray=Ar ray. from (arguments)</p></li><li data-list-text="•"><p class="s33" style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;line-height: 120%;text-align: left;">	<span class="p">Write myArray= [ . . . arguments] , which shows yet another type of usage of the<br/>spread operator</span></p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>When we get to the topic of higher-order functions, writing functions that deal with other functions,<br/>with a possibly unknown number of parameters, will be commonplace.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>JavaScript provides a much shorter way of doing this, so you’ll have to get accustomed to this usage.<br/>It’s worth it!</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s34" style="padding-left: 43pt;text-indent: 0pt;text-align: justify;">One argument or many?</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;">It’s also possible to write functions that return functions, and in <i>Chapter 6, Producing Functions, </i><span>we will<br/>see more of this. For instance, in lambda calculus, you don’t write functions with several parameters,<br/>but only one; you do this using a technique called </span><b>currying. </b><span>(But why would you do this? Hold that<br/>thought; we’ll come to this later.)</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s154" style="padding-top: 3pt;padding-left: 42pt;text-indent: 0pt;text-align: left;">Z<span class="s155">                                                                       </span>X</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 57pt;text-indent: 0pt;text-align: left;">Twice recognized</p><p style="padding-top: 4pt;padding-left: 57pt;text-indent: 0pt;text-align: left;">Currying gets its name from Haskell Curry, who developed the concept. A functional language,</p><p class="s9" style="padding-top: 1pt;padding-left: 56pt;text-indent: 0pt;text-align: left;">Haskell, <span class="p">is also named after him - double recognition!</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: left;">For instance, the function that we saw previously that sums three numbers would be written as follows:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// sum3.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 76pt;text-indent: -23pt;line-height: 285%;text-align: left;"><span>const altSum3 = (x: number) =&gt; (y: number) =&gt; (z: number)<br/>x + y + z;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 25pt;text-indent: 0pt;text-align: left;">50  Starting Out with Functions - A Core Concept</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;">Why did I change the function’s name? Simply put, this is <i>not </i><span>the same function we saw previously.<br/>The type of sum3 () is (x: number, y: number, z: number) =&gt; number, while that of<br/>altSum3()  is  (x:  number)  =&gt;  (y:  number)  =&gt;  (z:  number)  =&gt;  number,which<br/>is different. (See </span><i>Question 3.3 </i><span>for more on this.) As-is, though, it can be used to produce the very same<br/>results as our earlier function. Let’s look at how you would use it, say, to sum the numbers 1, 2, and 3:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;text-align: left;">altSum3(1)(2)(3); // 6</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Test yourself before reading on, and think about this: what would have been returned if you had<br/>written altSum3 (1,2,3) instead? Tip: it would not be a number! For the full answer, keep reading.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>How does this work? Separating it into many calls can help; this would be the way the previous<br/>expression is calculated by the JavaScript interpreter:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>const fnl = altSum3(1) ;<br/>const fn2 = fnl(2);<br/>const fn3 = fn2 (3) ;</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: justify;"><span>Think functionally! The result of calling altSum3 (1) is, according to the definition, a function,<br/>which, in virtue of a closure, resolves to be equivalent to the following:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;text-align: left;">const fnl = y =&gt; z =&gt; 1 + y + z;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Our altSum3 () function is meant to receive a single argument, not three! The result of this call,<br/>fnl, is also a single-argument function. When you use fnl (2), the result is again a function, also<br/>with a single parameter, which is equivalent to the following:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;text-align: left;">const fn2 = z =&gt; 1 + 2 + z;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: justify;"><span>And when you calculate f n2 (3), a value is finally returned - great! As we said, the function performs<br/>the same kind of calculations as we saw earlier, but in an intrinsically different way.</span></p><p style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>You might think that currying is a peculiar trick: who would want to use only single-argument<br/>functions? You’ll see the reasons for this when we consider how to join functions together in </span><i>Chapter 8,</i>and <i>Chapter 12, Building Better Containers, </i><span>where it won’t be feasible to pass<br/>more than one parameter from one step to the next.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 53pt;text-indent: 0pt;text-align: justify;"><a name="bookmark118">Functions as objects</a></p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>The concept of first-class objects means that functions can be created, assigned, changed, passed as<br/>parameters, and returned as a result of other functions in the same way you can with, say, numbers<br/>or strings. Let’s start with its definition. Let’s look at how you usually define a function - and do you<br/>recognize the function’s name? (Hint: google “Colossal Cave Adventure”!)</span></p><p style="padding-top: 8pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">function xyzzy(...) { ... }</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: right;">All about functions  51</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: justify;">This is (almost) equivalent to writing the following:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">var xyzzy = function (...) { ... }</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;">However, this is not true for hoisting, as we explained in the <i>Of lambdas and functions </i><span>section. JavaScript<br/>moves all definitions to the top of the current scope but does </span><i>not </i><span>move the assignments. With the<br/>first definition, you can invoke xyz zy ( . . . ) from any place in your code, but with the second, you<br/>cannot invoke the function until the assignment has been executed.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>The point that we want to make is that a function can be assigned to a variable and can also be<br/>reassigned if desired. In a similar vein, we can define functions on the spot where they are needed.<br/>We  can even do this without naming them: as with common expressions, if they are used only once,<br/>you don’t need to name them or store them in a variable.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 56pt;text-indent: 0pt;text-align: left;"><a name="bookmark119">A colossal parallel</a></p><p style="padding-top: 4pt;padding-left: 56pt;text-indent: 0pt;line-height: 113%;text-align: left;">See the parallel with the <i>Colossal Cave Adventure </i><span>game from the 70s? Invoking xyz zy () anywhere<br/>won’t always work! If you have never played that famous interactive fiction game, try it online</span></p><p style="padding-left: 57pt;text-indent: 0pt;line-height: 115%;text-align: left;"><a href="http://www/" class="s11" target="_blank">- for example, at </a><a href="http://www.amc.com/blogs/play-the-colossal-cave-adventure-game-just-" class="s11" target="_blank">www. web-adventures . org/cgi -bin/webf rotz?s=Adventure<br/>orwww.amc.com/blogs/play-the-colossal-cave-adventure-game-just-</a></p><p style="padding-left: 57pt;text-indent: 0pt;text-align: left;">like -halt -and- cat ch- fires -cameron -howe- -1009966.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 8pt;padding-left: 43pt;text-indent: 0pt;text-align: justify;">Let’s see an actual code example that involves assigning functions.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s34" style="padding-left: 42pt;text-indent: 0pt;text-align: justify;">A React-Redux reducer</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;">As we mentioned in <i>Chapter 1, Becoming Functional, </i><span>React-Redux works by dispatching actions that<br/>a  </span><i>reducer  </i><span>processes.  (Read  more  about  this  at  redux.  j  s  .  org/tutorials/fundamentals/<br/>part - 3 - state-act ions - reducers.) Usually, the reducer includes code with a switch. An<br/>example follows - and I’m using JavaScript (not TypeScript) to focus on logic aspects:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// reducer.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 65pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>function doAction(<br/>state = initialstate,</span></p><p style="padding-left: 64pt;text-indent: 0pt;line-height: 10pt;text-align: left;">action = emptyAction</p><p style="padding-top: 6pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">) {</p><p style="padding-top: 2pt;padding-left: 65pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>const newState: State = {};<br/>switch (action?.type) {</span></p><p style="padding-left: 76pt;text-indent: 0pt;line-height: 10pt;text-align: left;">case &quot;CREATE&quot;:</p><p style="padding-top: 4pt;padding-left: 89pt;text-indent: 0pt;text-align: left;">// update state, generating newState,</p><p style="padding-top: 4pt;padding-left: 89pt;text-indent: 0pt;text-align: left;">// depending on the action data</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 25pt;text-indent: 0pt;text-align: left;">52  Starting Out with Functions - A Core Concept</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 97pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>//to create a new item<br/>return newState;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 85pt;text-indent: 0pt;text-align: left;">case &quot;DELETE&quot;:</p><p style="padding-top: 4pt;padding-left: 98pt;text-indent: 0pt;text-align: left;">// update state, generating newState,</p><p style="padding-top: 4pt;padding-left: 97pt;text-indent: 0pt;line-height: 143%;text-align: left;"><span>// after deleting an item<br/>return newState;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 85pt;text-indent: 0pt;text-align: left;">case &quot;UPDATE&quot;:</p><p style="padding-top: 4pt;padding-left: 98pt;text-indent: 0pt;text-align: left;">// update an item,</p><p style="padding-top: 4pt;padding-left: 97pt;text-indent: 0pt;line-height: 143%;text-align: left;"><span>// and generate an updated state<br/>return newState;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">default:</p><p style="padding-top: 4pt;padding-left: 97pt;text-indent: 0pt;text-align: left;">return state;</p><p style="padding-top: 6pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;text-align: justify;"><a name="bookmark120">Initial state</a></p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;line-height: 115%;text-align: justify;"><span>Providing initialstate as a default value for the state is a simple way of initializing the<br/>global state. Pay no attention to that default; its irrelevant to our example, and I included<br/>it just for completeness. I’m also assuming the existence of State, Action, and others as<br/>types - see </span><i>Question </i>3.5!</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: left;">By taking advantage of the possibility of storing functions, we can build a <b>dispatch table </b><span>and simplify<br/>the preceding code. First, we initialize an object with the code for the functions for each action type.<br/>We are just taking the preceding code and creating separate functions:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: justify;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 73pt;text-indent: -12pt;line-height: 142%;text-align: left;"><span>const dispatchTable = {<br/>CREATE: (state, action) =&gt; {</span></p><p style="padding-left: 86pt;text-indent: 0pt;text-align: left;">// update state, generating newState,</p><p style="padding-top: 4pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">// depending on the action data</p><p style="padding-top: 4pt;padding-left: 85pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>// to create a new item<br/>const NewState = {</span></p><p style="padding-left: 98pt;text-indent: 0pt;line-height: 10pt;text-align: left;">/* updated State */</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 368pt;text-indent: 0pt;text-align: left;">All about functions  53</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 77pt;text-indent: 0pt;text-align: left;">return NewState;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 64pt;text-indent: 0pt;text-align: left;">DELETE: (state, action) =&gt; {</p><p style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">// update state, generating newState,</p><p style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;line-height: 146%;text-align: left;"><span>// after deleting an item<br/>const NewState = {</span></p><p style="padding-left: 77pt;text-indent: 12pt;line-height: 287%;text-align: left;"><span>/* updated State */<br/>return NewState;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 64pt;text-indent: 0pt;text-align: left;">UPDATE: (state, action) =&gt; {</p><p style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">// update an item,</p><p style="padding-top: 4pt;padding-left: 76pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>// and generate an updated state<br/>const NewState = {</span></p><p style="padding-left: 77pt;text-indent: 12pt;line-height: 286%;text-align: left;"><span>/* updated State */<br/>return NewState;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>We store the different functions that process each type of action as attributes in an object that will<br/>work as a dispatcher table. This object is created only once and is constant during the execution of the<br/>application. With it, we can now rewrite the action-processing code in a single line of code:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 64pt;text-indent: -11pt;line-height: 146%;text-align: left;"><span>function    doAction2(state,    action)    {<br/>return dispatchTable[action.type]</span></p><p class="s10" style="padding-left: 77pt;text-indent: 0pt;line-height: 10pt;text-align: left;">? dispatchTable[action.type] (state, action)</p><p style="padding-top: 4pt;padding-left: 78pt;text-indent: 0pt;text-align: left;">: state;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 25pt;text-indent: 0pt;text-align: left;">54  Starting Out with Functions - A Core Concept</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Let’s analyze it: given the action, if action. type matches an attribute in the dispatching object, we<br/>execute the corresponding function taken from the object where it was stored. If there isn’t a match,<br/>we just return the current state as Redux requires. This kind of code wouldn’t be possible if we couldn’t<br/>handle functions (storing and recalling them) as first-class objects.</span></p><p class="s34" style="padding-top: 8pt;padding-left: 52pt;text-indent: 0pt;text-align: justify;">An unnecessary mistake</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>There is, however, a common (though, in fact, harmless) mistake that is usually made. You often see<br/>code like this:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 73pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>fetch(&quot;some/url&quot;).then(function(data) {<br/>processResult(data);</span></p><p style="padding-top: 1pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">});</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 5pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">fetch(&quot;some/url&quot;).then(<b>(data) =&gt; processResult(data));</b></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>What does this code do? The idea is that a remote URL is fetched, and when the data arrives, a function<br/>is called - and this function calls processResult with data as an argument. That is to say, in<br/>the then () part, we want a function that, given data, calculates processResult (data). But<br/>don’t we already have such a function?</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;text-align: justify;">There is a rule that you can apply whenever you see something like the following:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 73pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>function    someFunction(someData)    {<br/>return someOtherFunction(someData);</span></p><p style="padding-top: 2pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>This rule states that you can replace code resembling the preceding code with just someOtherFunction.<br/>So, in our example, we can directly write what follows:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">fetch(&quot;some/url&quot;).then<b>(processResult);</b></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>This code is equivalent to the previous method that we looked at (although it is infinitesimally quicker<br/>since you avoid one function call), but is it simpler to understand?</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 66pt;text-indent: 0pt;text-align: justify;"><a name="bookmark121">Some terminology</a></p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;line-height: 115%;text-align: justify;">In lambda calculus terms, we are replacing <i>Xx.fimc x </i>with simply <i>fimc - </i>this is called an <b>q (eta)</b>or more specifically, an <b>q reduction. </b><span>(If you were to do it the other way round, it<br/>would  be an </span><b>q abstraction.) </b><span>In our case, it could be considered a (very, very small!) optimization,<br/>but its main advantage is shorter, more compact code.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 368pt;text-indent: 0pt;text-align: left;">All about functions  <span class="s153">55</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;">This programming style is called <b>pointfree </b>(also <b>point-free) </b>or <b>tacit </b><span>style, and its defining characteristic<br/>is that you never specify the arguments for each function application. An advantage of this way of<br/>coding is that it helps the writer (and the future readers of the code) think about the functions and their<br/>meanings instead of working at a low level, passing data around, and working with it. In the shorter<br/>version of the code, there are no extraneous or irrelevant details: if you know what the called function<br/>does, you understand the meaning of the complete piece of code. We’ll often (but not necessarily<br/>always) work this way in our text.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 57pt;text-indent: 0pt;text-align: justify;"><a name="bookmark122">Old Unix style</a></p><p style="padding-top: 4pt;padding-left: 56pt;text-indent: 0pt;line-height: 115%;text-align: justify;"><span>Unix/Linux users are already accustomed to this style because they work in a similar way when<br/>they use pipes to pass the result of a command as input to another. When you write something<br/>as 1 s | grep doc | sort, the output of 1 s is the input to grep, and the latter’s output is the<br/>input to sort - but input arguments aren’t written out anywhere; they are implied. We’ll come<br/>back to this in the </span><i>Pointfree style </i>section of <i>Chapter 8, Connecting Functions.</i></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s34" style="padding-top: 7pt;padding-left: 44pt;text-indent: 0pt;text-align: justify;">Working with methods</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>However, there is a case that you should be aware of: what happens if you call an object’s method?<br/>Look at the following code:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 64pt;text-indent: -11pt;line-height: 143%;text-align: left;"><span>fetch(&quot;some/remote/url&quot;).then(function (data) {<br/>myObject.store(data);</span></p><p style="padding-top: 2pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">});</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>If your original code had been something along the lines of the preceding code, then the seemingly<br/>obvious transformed code would fail:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">fetch(&quot;some/remote/url&quot;).then<b>(myObject.store); </b>// Fail!</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>Why? The reason is that in the original code, the called method is bound to an object (myObj ect),<br/>but in the modified code, it isn’t bound and is just a free function. We can fix it by using bind ():</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">fetch(&quot;some/remote/url&quot;).then(</p><p class="s10" style="padding-top: 4pt;padding-left: 64pt;text-indent: 0pt;text-align: left;">myObj ect.store.bind(myObj ect)</p><p style="padding-top: 5pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>This is a general solution. When dealing with a method, you cannot just assign it; you must use<br/>bind () so that the correct context will be available. Look at the following code:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 65pt;text-indent: -12pt;line-height: 144%;text-align: left;"><span>const doSomeMethod = (someData) =&gt; {<br/>return someObject.someMethod(someData);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 25pt;text-indent: 0pt;text-align: left;">56  Starting Out with Functions - A Core Concept</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: justify;">Following this rule, such code should be converted into the following:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;text-align: left;">const doSomeMethod = someObject.someMethod.bind(someObject);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 65pt;text-indent: 0pt;text-align: left;"><a name="bookmark123">Tip</a></p><p style="padding-top: 2pt;padding-left: 66pt;text-indent: 0pt;line-height: 115%;text-align: left;"><span>Read   more   on   bind()   at   developer.mozilla.org/en/docs/Web/JavaScript/<br/>Reference/Global_obj ects/Function/bind.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>This looks rather awkward and not too elegant, but it’s required so that the method will be associated<br/>with the correct object. We will see one application of this when we </span><i>promisify </i>functions in <i>Chapter 6,</i><span>Even if this code isn’t so nice to look at, whenever you have to work with objects<br/>(and remember, we didn’t say that we would be trying to aim for fully FP code, and did say that we<br/>would accept other constructs if they made things easier), you’ll have to remember to bind methods<br/>before passing them as first-class objects in pointfree style.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><a name="bookmark124"><span>So far, we have been discussing many aspects of functions; now, let’s get more into functions in FP,<br/>and see how we’ll use them.</span></a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-left: 53pt;text-indent: 0pt;text-align: justify;">Using functions in FP ways</p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Several common coding patterns take advantage of the FP style, even if you aren’t aware of it. In this<br/>section, we will go through them and look at the functional aspects of the code so that you can get<br/>more accustomed to this coding style.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Then, we’ll look in detail at using functions in an FP way by considering several FP techniques, such<br/>as the following:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l32"><li data-list-text="•"><p class="s10" style="padding-left: 79pt;text-indent: -13pt;text-align: left;">Injection, <span class="p">which is needed for sorting different strategies, as well as other uses</span></p></li><li data-list-text="•"><p class="s10" style="padding-top: 5pt;padding-left: 79pt;text-indent: -13pt;text-align: left;">Callbacks <span class="p">and </span>promises, <span class="p">introducing the </span>continuation-passing <span class="p">style</span></p></li><li data-list-text="•"><p class="s10" style="padding-top: 5pt;padding-left: 79pt;text-indent: -13pt;text-align: left;">Polyfilling <span class="p">and </span>stubbing</p></li><li data-list-text="•"><p class="s10" style="padding-top: 5pt;padding-left: 79pt;text-indent: -13pt;text-align: left;"><a name="bookmark125">Immediate invocation </a><span class="p">schemes</span></p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 53pt;text-indent: 0pt;text-align: justify;">Injection - sorting it out</p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>The  Array.  prototype  .  sort  ()  method  provides  the  first  example  of  passing  functions  as<br/>parameters. If you have an array of strings and you want to sort it, you can just use the sort ()<br/>method. For example, to alphabetically sort an array with the colors of the rainbow, we would write<br/>something like the following:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// sort.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 6pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">const colors = [</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 340pt;text-indent: 0pt;text-align: left;">Using functions in FP ways  57</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 65pt;text-indent: 0pt;text-align: left;">&quot;violet&quot;,</p><p style="padding-top: 3pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">&quot;indigo&quot;,</p><p style="padding-top: 3pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">&quot;blue&quot;,</p><p style="padding-top: 3pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">&quot;green&quot;,</p><p style="padding-top: 3pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">&quot;yellow&quot;,</p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">&quot;orange&quot;,</p><p style="padding-top: 3pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">&quot;red&quot;,</p><p style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">] ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">colors.sort();</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 6pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">console.log(colors);</p><p style="padding-top: 3pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// &#39;blue&#39;, &#39;green&#39;, &#39;indigo&#39;, &#39;orange&#39;, &#39;red&#39;,</p><p style="padding-top: 3pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// &#39;violet&#39;, &#39;yellow&#39;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Note that we didn’t have to provide any parameters to the sort () call, but the array got sorted<br/>perfectly well. By default, this method sorts strings according to their ASCII internal representation.<br/>So,  if you use this method to sort an array of numbers, it will fail because it will decide that 20 must<br/>be between 100 and 3, as 100 precedes 20 (taken as strings!) and the latter precedes 3, so this needs<br/>fixing! The following code shows the problem:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">const someNumbers = [3, 20, 100];</p><p style="padding-left: 53pt;text-indent: 0pt;line-height: 30pt;text-align: left;"><span>someNumbers.sort();<br/>console.log(someNumbers);</span></p><p style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// 100, 20, 3</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: left;"><span>But let’s forget numbers for a while and stick to sorting strings. What would happen if we wanted to<br/>sort some Spanish words </span><i>(palabras) </i><span>while following the appropriate locale rules? We would be sorting<br/>strings, but the results wouldn’t be correct:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 65pt;text-indent: -13pt;line-height: 144%;text-align: left;"><span>const palabras = [<br/>&quot;handu&quot;,<br/>oasis</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 25pt;text-indent: 0pt;text-align: left;">58  Starting Out with Functions - A Core Concept</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 74pt;text-indent: 0pt;line-height: 143%;text-align: left;"><span>&quot;mano&quot;,<br/>&quot;natural&quot;,<br/>&quot;mitico&quot;,<br/>&quot;musical&quot;,</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;line-height: 30pt;text-align: left;"><span>palabras.sort () ;<br/>console.log(palabras);</span></p><p class="s10" style="padding-top: 4pt;padding-left: 61pt;text-indent: 0pt;text-align: justify;">// &quot;mano&quot;, &quot;musical&quot;, &quot;mitico&quot;,</p><p class="s10" style="padding-top: 4pt;padding-left: 61pt;text-indent: 0pt;text-align: justify;">// &quot;natural&quot;, &quot;oasis&quot;, &quot;nandu&quot; -- wrong result!</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 65pt;text-indent: 0pt;text-align: justify;"><a name="bookmark126">What’s in a word?</a></p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;line-height: 115%;text-align: justify;">For language or biology buffs, <i>handii </i>in English is <i>rhea, </i><span>a running bird similar to an ostrich.<br/>There aren’t many Spanish words beginning with </span><i>n, </i><span>and we happen to have these birds in my<br/>country, Uruguay, so that’s the reason for the odd word!</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;">Oops! In Spanish, <i>n </i>comes between <i>n </i><span>and o, but &quot;nandu&quot; got sorted at the end. Also, &quot;mitico&quot;<br/>(in English, mythical; note the accented z) should appear between &quot;mano&quot; and &quot;musical&quot; because<br/>the tilde should be ignored. The appropriate way of solving this is by providing a comparison function<br/>to sort (). In this case, we can use the localeCompare () method as follows:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: justify;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 73pt;text-indent: -12pt;line-height: 144%;text-align: left;"><span>palabras.sort((a: string, b: string) =&gt;<br/>a.localeCompare(b, &quot;es&quot;)</span></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 6pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">console.log(palabras) ;</p><p class="s10" style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">// &quot;mano&quot;, &quot;mitico&quot;, &quot;musical&quot;,</p><p class="s10" style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">// &quot;natural&quot;, &quot;nandu&quot;, &quot;oasis&quot; -- correct result!</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>The a. localeCompare (b, &quot; es&quot;) call compares the a and b strings and returns a negative value<br/>should a precede b, a positive value should a follow b, and 0 if a and b are the same - but according<br/>to Spanish (&quot; es&quot;) ordering rules.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 340pt;text-indent: 0pt;text-align: left;">Using functions in FP ways  59</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 44pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>Now, things are right! And the code could be made clearer by introducing a new function,<br/>spanishComparison (), to perform the required strings comparison:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: justify;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 64pt;text-indent: -11pt;line-height: 146%;text-align: left;"><span>const spanishComparison = (a: string, b: string) =&gt;<br/>a.localeCompare(b, &quot;es&quot;);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: justify;">palabras.sort(spanishComparison); // same correct result</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 57pt;text-indent: 0pt;text-align: justify;"><a name="bookmark127">International sorting</a></p><p style="padding-top: 4pt;padding-left: 57pt;text-indent: 0pt;line-height: 115%;text-align: justify;"><span>For more on the localeCompare () possibilities, see developer . mozilla. org/en/<br/>docs/Web/JavaScript/Reference/Global_Obj ects/String/localeCompare.</span></p><p style="padding-left: 56pt;text-indent: 0pt;line-height: 115%;text-align: justify;"><span>You can specify which locale rules to apply, in which order to place upper/lowercase letters,<br/>whether to ignore punctuation, and much more. But be careful: not all browsers may support<br/>the required extra parameters.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>In upcoming chapters, we will discuss how FP lets you write code in a more declarative fashion,<br/>producing more understandable code, and how this sort of minor change helps. When readers of<br/>the code get to the sort function, they will immediately deduce what is being done, even if the<br/>comment wasn’t present.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-top: 5pt;padding-left: 57pt;text-indent: 0pt;text-align: left;"><a name="bookmark128">Of strategies and patterns</a></p><p style="padding-top: 4pt;padding-left: 56pt;text-indent: 0pt;line-height: 115%;text-align: left;"><span>This way of changing how the sort () function works by injecting different comparison<br/>functions is a case of the strategy </span><b>design pattern. </b>We’ll learn more about this in <i>Chapter 11,</i></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>Providing a sort function as a parameter (in a very FP way!) can also help with several other<br/>problems, such as the following:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l33"><li data-list-text="•"><p class="s33" style="padding-left: 70pt;text-indent: -12pt;line-height: 124%;text-align: justify;">	<span class="p">sort () only works with strings by default. If you want to sort numbers (as we tried to do<br/>previously), you have to provide a function that will compare numerically. For example, you<br/>would write something like myNumbers . sort ( (a: number, b:number) = &gt; a - b).<br/>(Why? See </span><span class="s9">Question 3.7.)</span></p></li><li data-list-text="•"><p class="s33" style="padding-top: 5pt;padding-left: 70pt;text-indent: -12pt;line-height: 124%;text-align: justify;">	<span class="p">If you want to sort objects by a given attribute, you will use a function that compares to it. For<br/>example, you could sort people by age with something like my People . sort ( (a: Person,<br/>b:Person) =&gt; a.age - b.age).</span></p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>This is a simple example you have probably used before, but it’s an FP pattern, after all. Let’s move on<br/>to even more common usage of functions as parameters when you perform Ajax calls.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 25pt;text-indent: 0pt;text-align: left;">60  Starting Out with Functions - A Core Concept</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;text-align: justify;"><a name="bookmark129">Callbacks and promises</a></p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Probably the most used example of functions passed as first-class objects has to do with callbacks<br/>and promises. In Node.js, reading a file is accomplished asynchronously with something like the<br/>following code:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;text-align: left;">const fs = require (&quot;fs&quot;) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 74pt;text-indent: -12pt;line-height: 142%;text-align: left;"><span>fs.readFile(&quot;someFile.txt&quot;,    (err,    data)    =&gt;    {<br/>if (err) {</span></p><p style="padding-left: 86pt;text-indent: 0pt;text-align: left;">// handle the error</p><p style="padding-top: 4pt;padding-left: 75pt;text-indent: 0pt;text-align: left;">} else {</p><p style="padding-top: 4pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">// do something with the received data</p><p style="padding-top: 6pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">}</p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">});</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>The readFile () function requires a callback - in this example, an anonymous function - that will<br/>get called when the file-reading operation is finished.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>A better, more modern way is using promises; read more at developer. mozilla. org/en-US/<br/>docs/Web/  JavaScrip  t/Ref  er  ence/Globa  l_Ob  j  ects/Promise.  With  this,  when<br/>performing an Ajax web service call using the fetch () function, you could write something along<br/>the  lines of the following code:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 4pt;text-indent: 0pt;text-align: center;">fetch(&quot;some/remote/url&quot;)</p><p style="padding-top: 4pt;padding-left: 1pt;text-indent: 0pt;text-align: center;">.then((data) =&gt; {</p><p style="padding-top: 4pt;padding-left: 51pt;text-indent: 0pt;text-align: center;">// do something with the received data</p><p style="padding-top: 6pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">})</p><p style="padding-top: 2pt;padding-left: 75pt;text-indent: 0pt;text-align: left;">. catch((error) =&gt; {</p><p style="padding-top: 4pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">// handle the error</p><p style="padding-top: 6pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">});</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>Finally, you should also look into using async/await; read more about them at developer .<br/>mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_</span></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>function and developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/<br/>Operators/await, respectively.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 340pt;text-indent: 0pt;text-align: left;">Using functions in FP ways  61</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-top: 5pt;padding-left: 43pt;text-indent: 0pt;text-align: justify;"><a name="bookmark130">Continuation-passing style</a></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>The preceding code, in which you call a function but also pass another function to be executed when<br/>the input/output operation is finished, can be considered something called </span><b>continuation-passing style</b><span>What is this technique of coding? One way of looking at it is by thinking about the question:<br/></span><i>how would you program if using the return statement was forbidden?</i></p><p style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>At first glance, this may appear to be an impossible situation. However, we can get out of our fix by<br/>passing a callback to the called function so that when that procedure is ready to return to the caller,<br/>instead of returning, it invokes the given callback. By doing this, the callback provides the called<br/>function with the way to continue the process, hence the word </span><i>continuation. </i><span>We won’t get into this<br/>now, but in </span><i>Chapter 9, Designing Functions, </i><span>we will study it in depth. In particular, CPS will help us<br/>to avoid an important recursion restriction, as we’ll see.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Working out how to use continuations is sometimes challenging, but always possible. An exciting<br/>advantage of this way of coding is that by specifying how the process will continue, you can go beyond<br/>all  the usual structures (if, while, return, and so on) and implement whatever mechanisms you<br/>want. This can be very useful in problems where the process isn’t necessarily linear. Of course, this<br/>can also lead to you inventing a kind of control structure far worse than the possible usage of GOTO<br/>statements that you might imagine! </span><i>Figure 3.1 </i>shows the dangers of that practice!</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s156" style="padding-top: 7pt;padding-left: 46pt;text-indent: 2pt;line-height: 74%;text-align: left;"><a name="bookmark131"><span>I CW1MESIRUCW<br/>THE PROGRAM&#39;S FLOV&#39;</span></a></p><p class="s157" style="padding-top: 4pt;padding-left: 55pt;text-indent: 0pt;line-height: 10pt;text-align: left;">CRUSE ONE LITTLE.</p><p class="s158" style="padding-left: 58pt;text-indent: 0pt;line-height: 12pt;text-align: left;">&#39;Goto&#39; instead.</p><p class="s159" style="padding-top: 6pt;padding-left: 7pt;text-indent: 1pt;text-align: left;"><span>EH, 5CREV 0O5D FRflCTlCE.<br/>HOU BAD CAN 1T0E?</span></p><p style="text-indent: 0pt;text-align: left;"><span><img width="108" height="77" alt="image" src="Image_013.gif"/></span></p><p style="text-indent: 0pt;text-align: left;"><span><img width="52" height="68" alt="image" src="Image_014.gif"/></span></p><p style="text-indent: 0pt;text-align: left;"><span><img width="152" height="144" alt="image" src="Image_015.gif"/></span></p><p class="s160" style="padding-top: 5pt;padding-left: 38pt;text-indent: 0pt;text-align: left;">goto main^subd;</p><p style="padding-left: 66pt;text-indent: 0pt;text-align: left;"><span><img width="49" height="59" alt="image" src="Image_016.gif"/></span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 108pt;text-indent: -4pt;line-height: 137%;text-align: left;"><span>Figure 3.1 - What&#39;s the worst that could happen if you start messing with the<br/>program flow? (This XKCD comic is available online at xkcd. com/2 92/)</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>You are not limited to passing a single continuation. As with promises, you can provide two or more<br/>alternative callbacks. And this, by the way, can provide a solution to the problem of how you would<br/>work with exceptions. If we simply allowed a function to throw an error, it would be an implied return<br/>to the caller, and we don’t want this. The way out of this is to provide an alternative callback (that is,<br/>a different continuation) to be used whenever an exception is thrown (in </span><i>Chapter 12, Building Better</i>we’ll find another solution using monads):</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 64pt;text-indent: -11pt;line-height: 141%;text-align: left;"><span>function   doSomething(a,   b,   c,<br/>normalcontinuation, errorcontinuation) {</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 25pt;text-indent: 0pt;text-align: left;">62  Starting Out with Functions - A Core Concept</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 74pt;text-indent: 0pt;text-align: left;">let r = 0;</p><p style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">// ... do some calculations involving a, b, and c,</p><p style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">// and store the result in r</p><p style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">// if an error happens, invoke:</p><p style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">// errorcontinuation(&quot;description of the error&quot;)</p><p style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">// otherwise, invoke:</p><p style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">// normalcontinuation(r)</p><p style="padding-top: 6pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>Using CPS can even allow you to go beyond the control structures that JavaScript provides, but that<br/>would be beyond the objectives of this book, so I’ll let you research that on your own!</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 53pt;text-indent: 0pt;text-align: left;"><a name="bookmark132">Polyfills</a></p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>Being able to assign functions dynamically (in the same way that you can assign different values to a<br/>variable) also allows you to work more efficiently when defining polyfills.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s34" style="padding-left: 52pt;text-indent: 0pt;text-align: left;">Detecting Ajax</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: left;"><span>Let’s go back a bit in time to when Ajax started to appear. Given that different browsers implemented<br/>Ajax calls in distinct fashions, you would always have to code around these differences. The following<br/>code shows how you would go about implementing an Ajax call by testing several different conditions:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// ajax.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 74pt;text-indent: -12pt;line-height: 144%;text-align: left;"><span>function getAjaxO {<br/>let ajax = null;</span></p><p style="padding-left: 74pt;text-indent: 0pt;line-height: 10pt;text-align: left;">if (window.XMLHttpRequest) {</p><p style="padding-top: 4pt;padding-left: 85pt;text-indent: 0pt;line-height: 143%;text-align: left;"><span>// modern browser? use XMLHttpRequest<br/>ajax = new XMLHttpRequest();</span></p><p style="padding-left: 75pt;text-indent: 0pt;line-height: 10pt;text-align: left;">} else if (window.ActiveXObject) {</p><p style="padding-top: 4pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">// otherwise, use ActiveX for IE5 and IE6</p><p style="padding-top: 4pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">ajax = new ActiveXObject(&quot;Microsoft.XMLHTTP&quot;);</p><p style="padding-top: 4pt;padding-left: 75pt;text-indent: 0pt;text-align: left;">} else {</p><p style="padding-top: 4pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">throw new Error(&quot;No Ajax support!&quot;);</p><p style="padding-top: 6pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">}</p><p style="padding-top: 2pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">return ajax;</p><p style="padding-top: 6pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 340pt;text-indent: 0pt;text-align: left;">Using functions in FP ways  63</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>This worked but implied that you would redo the Ajax check for every call, even though the test results<br/>wouldn’t ever change. There’s a more efficient way to do this, and it has to do with using functions as<br/>first-class objects. We could define </span><i>two </i><span>different functions, test for the condition only once, and then<br/>assign the correct function to be used later; study the following code for such an alternative:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 65pt;text-indent: -10pt;line-height: 143%;text-align: left;"><span>(function initializeGetAjax() {<br/>let myAjax = null;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 65pt;text-indent: 0pt;text-align: left;">if (window.XMLHttpRequest) {</p><p style="padding-top: 4pt;padding-left: 76pt;text-indent: 1pt;line-height: 144%;text-align: left;"><span>// modern browsers? use XMLHttpRequest<br/>myAjax = function () {</span></p><p style="padding-left: 89pt;text-indent: 0pt;line-height: 10pt;text-align: left;">return new XMLHttpRequest();</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">} else if (window.ActiveXObject) {</p><p style="padding-top: 4pt;padding-left: 76pt;text-indent: 1pt;line-height: 142%;text-align: left;"><span>// it&#39;s ActiveX for IE5 and IE6<br/>myAjax = function () {</span></p><p style="padding-left: 88pt;text-indent: 0pt;text-align: left;">new ActiveXObject(&quot;Microsoft.XMLHTTP&quot;);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">} else {</p><p style="padding-top: 4pt;padding-left: 76pt;text-indent: 0pt;text-align: left;">myAjax = function () {</p><p style="padding-top: 4pt;padding-left: 88pt;text-indent: 0pt;text-align: left;">throw new Error(&quot;No Ajax support!&quot;);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 64pt;text-indent: 0pt;text-align: left;">window.getAjax = myAjax;</p><p style="padding-top: 6pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">}) ();</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>This piece of code shows two important concepts. First, we can dynamically assign a function: when<br/>this code runs, window. getAj ax (the global getAj ax variable) will get one of three possible<br/>values according to the current browser. When you later call getAj ax () in your code, the correct<br/>function will execute without you needing to do any further browser-detection tests.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>The second interesting idea is that we define the initializeGetAj ax () function and immediately<br/>run it - this pattern is called the </span><b>immediately invoked function expression (IIFE), </b><span>and we already<br/>saw it in the </span><i>Solution </i>7 - <i>using a local flag </i>section in <i>Chapter 2, Thinking Functionally. </i><span>The function<br/>runs but cleans up after itself because all its variables are local and won’t even exist after the function<br/>runs. We’ll learn more about this later in this chapter.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 25pt;text-indent: 0pt;text-align: left;">64  Starting Out with Functions - A Core Concept</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">Nowadays, you would use a module instead of an IIFE, as follows:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;line-height: 286%;text-align: left;"><span>// ajax.module.ts<br/>let getAjax = null;</span></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">if (window.XMLHttpRequest) {</p><p style="padding-top: 4pt;padding-left: 73pt;text-indent: 0pt;line-height: 142%;text-align: left;"><span>// modern browsers? use XMLHttpRequest<br/>getAjax = function () {</span></p><p style="padding-left: 85pt;text-indent: 0pt;text-align: left;">return new XMLHttpRequest();</p><p style="padding-top: 6pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">};</p><p style="padding-top: 2pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">} else if (window.ActiveXObject) {</p><p style="padding-top: 4pt;padding-left: 73pt;text-indent: 0pt;line-height: 141%;text-align: left;"><span>// it&#39;s ActiveX for IE5 and IE6<br/>getAjax = function () {</span></p><p style="padding-left: 85pt;text-indent: 0pt;text-align: left;">new ActiveXObject(&quot;Microsoft.XMLHTTP&quot;);</p><p style="padding-top: 6pt;padding-left: 26pt;text-indent: 0pt;text-align: center;">};</p><p style="padding-top: 2pt;padding-left: 22pt;text-indent: 0pt;text-align: center;">} else {</p><p style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: center;">getAjax = function () {</p><p style="padding-top: 4pt;padding-left: 51pt;text-indent: 0pt;text-align: center;">throw new Error(&quot;No Ajax support!&quot;);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;text-align: left;">export { getAjax };</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>The code in the module is guaranteed to run only once. Wherever you need to do an Ajax call, you<br/>would  just  import  {  getAjax  }  from  &quot;/path/to/aj  ax.  module&quot;  and  you  could  use<br/>getAj ax () at will.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s34" style="padding-left: 52pt;text-indent: 0pt;text-align: justify;">Adding missing functions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>This idea of defining a function on the run also allows us to write polyfills that provide otherwise<br/>missing functions. For example, let’s say that we had some code such as the following:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">if (currentName.indexOf(&quot;Mr.&quot;) !== -1) {</p><p style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">// it&#39;s a man</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 340pt;text-indent: 0pt;text-align: left;">Using functions in FP ways  <span class="s153">65</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: -9pt;line-height: 23pt;text-align: left;"><span>Instead of this, you might very much prefer using the newer includes () method and just write this:<br/>if (currentName.includes(&quot;Mr.&quot;)) {</span></p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">// it&#39;s a man</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>What happens if your browser doesn’t provide includes () ? Once again, we can define the appropriate<br/>function on the fly, but only if needed. If includes () is available, you don’t need to do anything,<br/>but  if it is missing, you need to define a polyfill that will provide the same workings. (You can find<br/>links to polyfills on Mozilla’s developer site.) The following code shows an example of such a polyfill:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">if (!String.prototype.includes) {</p><p style="padding-top: 4pt;padding-left: 77pt;text-indent: -13pt;line-height: 143%;text-align: left;"><span>String.prototype.includes    =    function    (search,    start)    {<br/>&quot;use strict&quot;;</span></p><p style="padding-left: 89pt;text-indent: -11pt;line-height: 143%;text-align: left;"><span>if   (typeof   start   !==   &quot;number&quot;)   {<br/>start = 0;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 6pt;padding-left: 89pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>if   (start   +   search.length   &gt;   this.length)   {<br/>return false;</span></p><p style="padding-left: 77pt;text-indent: 0pt;text-align: left;">} else {</p><p style="padding-top: 4pt;padding-left: 88pt;text-indent: 0pt;text-align: left;">return this.indexOf(search, start) !== -1;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>When this code runs, it checks whether the String prototype already has the includes () method.<br/>If not, it assigns a function to it that does the same job, so from that point onward, you’ll be able to<br/>use includes () without further worries. By the way, there are other ways of defining a polyfill:<br/>check the answer to </span><i>Question 3.7 </i><span>for an alternative. Yet another solution is the core - j s package<br/>(github.  com/zloirock/core-j  s),  which  provides  polyfills  for  ECMAScript  up  to  the  latest<br/>version, and even some proposals that haven’t made it into the language yet.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-top: 6pt;padding-left: 57pt;text-indent: 0pt;text-align: justify;"><a name="bookmark133">Good or bad?</a></p><p style="padding-top: 4pt;padding-left: 57pt;text-indent: 0pt;line-height: 115%;text-align: justify;"><span>Directly modifying a standard type’s prototype object is usually frowned upon because, in<br/>essence, it’s equivalent to using a global variable, and thus it’s prone to errors; however, in this<br/>case (writing a polyfill for a well-established, known function) is quite unlikely to provoke<br/>any conflicts.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 25pt;text-indent: 0pt;text-align: left;">66  Starting Out with Functions - A Core Concept</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Finally, if you happened to think that the Ajax example shown previously was old hat, consider this:<br/>if you want to use the more modern fetch () way of calling services, you will also find that not all<br/>modern browsers support it (check caniuse . com/#search=fetch to verify this), so youd have<br/>to  use a polyfill, such as the one at github . com/github/fetch. Study the code, and you’ll see<br/>that it uses the same method described previously to see whether a polyfill is needed and create it.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 52pt;text-indent: 0pt;text-align: left;"><a name="bookmark134">Stubbing</a></p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Here, we will look at a use case similar to using a polyfill: having a function do different work depending<br/>on the environment. The idea is to perform stubbing, an idea that comes from testing and involves<br/>replacing a function with another that does a simpler job instead of the actual work.</span></p><p style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Stubbing is commonly used with logging functions. You may want the application to perform detailed<br/>logging when in development but not to say a peep when in production. A common solution would<br/>be to write something along the lines of the following:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 74pt;text-indent: -12pt;line-height: 137%;text-align: left;"><span>let myLog = (someText) =&gt; {<br/>if (DEVELOPMENT) {</span></p><p style="padding-left: 85pt;text-indent: 0pt;line-height: 10pt;text-align: left;">console.log(someText); // or some other way of logging</p><p style="padding-top: 3pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">} else {</p><p style="padding-top: 3pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">// do nothing</p><p style="padding-top: 5pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">}</p><p style="padding-top: 3pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">};</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>This works, but as in the example of Ajax detection, it does more work than it needs to because it<br/>checks whether the application is in development every time.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>We could simplify the code (and get a really, really tiny performance gain!) if we stub out the logging<br/>function so that it won’t log anything; an easy implementation is as follows:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">let myLog;</p><p style="padding-top: 3pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">if (DEVELOPMENT) {</p><p style="padding-top: 3pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">myLog = (someText: string) =&gt; console.log(someText);</p><p style="padding-top: 3pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">} else {</p><p style="padding-top: 3pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">myLog = (someText: string) =&gt; {};</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: -9pt;line-height: 21pt;text-align: left;"><span>We can do even better with the ternary operator:<br/>const myLog = DEVELOPMENT</span></p><p style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">? (someText: string) =&gt; console.log(someText)</p><p style="padding-top: 4pt;padding-left: 75pt;text-indent: 0pt;text-align: left;">: (someText: string) =&gt; {};</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 340pt;text-indent: 0pt;text-align: left;">Using functions in FP ways  67</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 193%;text-align: left;"><span>This is a bit more cryptic, but I prefer it because it uses const, which cannot be modified.<br/>There’s yet another possibility: you could modify the original method like this:</span></p><p style="padding-top: 2pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">if (DEVELOPMENT)</p><p style="padding-top: 4pt;padding-left: 51pt;text-indent: 0pt;text-align: center;">// do nothing,</p><p style="padding-top: 4pt;padding-left: 51pt;text-indent: 0pt;text-align: center;">} else {</p><p style="padding-top: 4pt;padding-left: 51pt;text-indent: 0pt;text-align: center;">console.log =</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 6pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">let things be</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">someText: string) =&gt; {};</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 43pt;text-indent: 0pt;text-align: justify;">In this case, we are directly changing how console . log () works, so it won’t log anything.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-top: 8pt;padding-left: 57pt;text-indent: 0pt;text-align: justify;"><a name="bookmark135">Useless arguments - ignore or exclude?</a></p><p style="padding-top: 4pt;padding-left: 56pt;text-indent: 0pt;line-height: 115%;text-align: justify;"><span>Given that JavaScript allows us to call functions with more arguments than parameters, and<br/>given that we aren’t doing anything in myLog () when we are not in development, we could<br/>also have written () = &gt; { } and it would have worked fine. However, I do prefer keeping<br/>the same signature, and that’s why I specified the someText argument, even if it wouldn’t be<br/>used. But, if you use ESLint’s no-unused-vars rule to detect unused variables, you may<br/>have to tweak its configuration to allow unused arguments.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>You’ll notice that we are using the concept of functions as first-class objects over and over again; look<br/>through all the code samples and you’ll see!</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 44pt;text-indent: 0pt;text-align: justify;"><a name="bookmark136">Immediate invocation (IIFE)</a></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>There’s yet another common usage of functions, usually seen in popular libraries and frameworks,<br/>that lets you bring some modularity advantages from other languages into JavaScript (even the older<br/>versions!). The usual way of writing this is something like the following:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 54pt;text-indent: 0pt;text-align: justify;">(function () {</p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">//   do   something...</p><p style="padding-top: 5pt;padding-left: 53pt;text-indent: 0pt;text-align: justify;">}) ();</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Alternatively, you may find (function!) { ... } () ) - note the different placement of the<br/>parentheses for the function call. Both styles have their fans; pick whichever suits you, and follow<br/>it consistently.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;text-align: justify;">You can also pass some arguments to the function that will be used as the initial values for its parameters:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 54pt;text-indent: 0pt;text-align: justify;">(function (a, b) {</p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">// do something, using the</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 25pt;text-indent: 0pt;text-align: left;">68  Starting Out with Functions - A Core Concept</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 74pt;text-indent: 0pt;text-align: left;">// received arguments for a and b. . .</p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">})(some, values);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Finally, you could also return something from the function - usually, an object (with several methods)<br/>or a function:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">let x = (function (a, b) {</p><p style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">// ...return an object or function</p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">}) (some, values) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Note the parentheses around the function. These help the parser understand that we are writing an<br/>expression. If you were to omit the first set of parentheses, JavaScript would think you were writing a<br/>function declaration instead of an invocation. The parentheses also serve as a visual note, so readers<br/>of your code will immediately recognize the IIFE.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;">As previously mentioned, the pattern is called IIFE (pronounced <i>iffy). </i><span>The name is easy to understand:<br/>you define a function and call it right away so that it gets executed on the spot. Why would you do<br/>this, instead of simply writing the code inline? The reason has to do with scopes.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>If you define any variables or functions within IIFE, then because of how JavaScript defines the scope<br/>of functions, those definitions will be internal, and no other part of your code will be able to access<br/>them. Imagine that you wanted to write some complicated initialization, such as the following:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">function ready() { ... }</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">function set() { ... }</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">function go() { ... }</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">// initialize things calling ready(),</p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">// set(), and go() appropriately</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>What could go wrong? The problem hinges on the fact that you could (by accident) have a function<br/>with the same name as any of the three here, and hoisting would imply that the last function would<br/>be called:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 73pt;text-indent: -11pt;line-height: 142%;text-align: left;"><span>function ready() {<br/>console.log(&quot;ready&quot;);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-top: 6pt;padding-left: 73pt;text-indent: -11pt;line-height: 143%;text-align: left;"><span>function set() {<br/>console.log(&quot;set&quot;);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 340pt;text-indent: 0pt;text-align: left;">Using functions in FP ways  69</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 64pt;text-indent: -11pt;line-height: 143%;text-align: left;"><span>function go() {<br/>console.log(&quot;go&quot;);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 6pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">ready();</p><p style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">set () ;</p><p style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">go () ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-top: 7pt;padding-left: 64pt;text-indent: -11pt;line-height: 143%;text-align: left;"><span>function set() {<br/>console.log(&quot;UNEXPECTED</span></p><p class="s10" style="padding-top: 2pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// &quot;ready&quot;</p><p style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// &quot;UNEXPECTED&quot;</p><p style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// &quot;go&quot;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Oops! If you had used IIFE, the problem wouldn’t have happened. (Using ESLint’s no- f unc - assign<br/>rule would have prevented this, too.) Also, the three inner functions wouldn’t even be visible to the<br/>rest of the code, which helps to keep the global namespace less polluted. The following code shows a<br/>widespread pattern for this:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 54pt;text-indent: 0pt;text-align: left;"><a name="bookmark137">(function () {</a></p><p style="padding-top: 4pt;padding-left: 77pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>function ready() {<br/>console.log(&quot;ready&quot;);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 6pt;padding-left: 76pt;text-indent: -11pt;line-height: 143%;text-align: left;"><span>function set() {<br/>console.log (&quot;set&quot;) ;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 6pt;padding-left: 77pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>function go() {<br/>console.log(&quot;go&quot;);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 6pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">ready();</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 25pt;text-indent: 0pt;text-align: left;">70  Starting Out with Functions - A Core Concept</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 74pt;text-indent: 0pt;text-align: left;">set();</p><p style="padding-top: 4pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">go () ;</p><p class="s160" style="padding-top: 5pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">}) 0;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 73pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>function set() {<br/>console.log(&quot;UNEXPECTED</span></p><p style="padding-top: 2pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// &quot;ready&quot;</p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">// &quot;set&quot;</p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">// &quot;go&quot;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;">To see an example involving returned values, we could revisit the example from <i>Chapter 1, Becoming</i>and write the following, which would create a single counter:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 74pt;text-indent: -12pt;line-height: 146%;text-align: left;"><span>const  myCounter  =  (function  ()  {<br/>let count = 0;</span></p><p style="padding-left: 85pt;text-indent: -12pt;line-height: 144%;text-align: left;"><span>return function () {<br/>count++;</span></p><p style="padding-left: 85pt;text-indent: 0pt;line-height: 10pt;text-align: left;">return count;</p><p style="padding-top: 6pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">};</p><p class="s160" style="padding-top: 3pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">}) 0;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Then, every call to myCounter () would return an incremented count, but there is no chance that<br/>any other part of your code will overwrite the inner count variable because it’s only accessible within<br/>the returned function.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-left: 52pt;text-indent: 0pt;text-align: left;"><a name="bookmark138">Summary</a></p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>In this chapter, we went over several ways of defining functions in JavaScript, focusing mainly on<br/>arrow functions, which have several advantages over standard functions, including being terser. We<br/>learned about the concept of currying (which we’ll be revisiting later), considered some aspects of<br/>functions as first-class objects, and reviewed several techniques that happen to be fully FP in concept.<br/>Rest assured that we’ll be using everything in this chapter as the building blocks for more advanced<br/>techniques in the rest of this book; just wait and see!</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;">In <i>Chapter 4, Behaving Properly, </i><span>we will delve even more deeply into functions and learn about the<br/>concept of pure functions, leading us to an even better programming style.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 12pt;padding-left: 401pt;text-indent: 0pt;text-align: left;">Questions  71</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-left: 43pt;text-indent: 0pt;text-align: left;"><a name="bookmark139">Questions</a></p><ol id="l34"><ol id="l35"><li data-list-text="3.1"><p style="padding-top: 9pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><b>Uninitialized object? </b><span>React-Redux programmers usually code action creators to simplify the<br/>creation of actions that will later be processed by a reducer. (We saw this in the </span><i>A React-Redux reducer</i><span>section.) Actions are objects with a type attribute, used to determine what kind of action you are<br/>creating. The following code supposedly produces an action, but can you explain the unexpected results?</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 65pt;text-indent: -12pt;line-height: 143%;text-align: left;"><span>const   simpleAction   =   (t:string)   =&gt;   {<br/>type: t;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 6pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">console.log(simpleAction(&quot;INITIALIZE&quot;));</p><p style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// undefined</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="3.2"><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><b>Are arrows allowed? </b><span>Would everything be the same if you defined useArguments () and<br/>useArguments2 () from the </span><i>Working with arguments </i><span>section by using arrow functions instead of<br/>the    way we did, with the function keyword?</span></p></li><li data-list-text="3.3"><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><b>Three more types: </b>Back in the <i>One argument or many? </i><span>section, we showed the types of sum3 ()<br/>and altsum3 (), but we didn’t do that for f nl, f n2, and f n3. What are the types of those functions?</span></p></li><li data-list-text="3.4"><p class="s10" style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;">One-liner: <span class="p">A programmer, particularly thrifty with lines of code, suggested rewriting doAct ion2 ()<br/>as a one-liner, even though you can’t tell this from the formatting! What do you think: is it correct<br/>or isn’t it?</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 67pt;text-indent: -14pt;line-height: 144%;text-align: left;"><span>const doAction3 = (state = initialstate, action) =&gt;<br/>(dispatchTable[action.type] &amp;&amp;</span></p><p style="padding-left: 65pt;text-indent: 11pt;line-height: 144%;text-align: left;"><span>dispatchTable[action.type](state,          action))<br/>state;</span></p></li><li data-list-text="3.5"><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><b>Reducing types: </b>In the <i>A React-Redux reducer </i><span>section, I used JavaScript instead of TypeScript<br/>to focus on the details of the needed logic. Can you provide TypeScript versions of doAct ion (),<br/>dispatchTable, and doAction2 () ? Be sure to describe all needed types, too.</span></p></li><li data-list-text="3.6"><p class="s10" style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;">Spot the bug! <span class="p">A programmer, working with a global store for state (similar in concept to those<br/>of Redux, Mobx, Vuex, and others used by different web frameworks), wanted to log (for debugging<br/>purposes) all calls to the store’s set () method. After creating the new store object, he wrote the following<br/>so  that the arguments to store . set () would be logged before being processed. Unfortunately, the<br/>code didn’t work as expected. What’s the problem? Can you spot the mistake?</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>window.store = new Store();<br/>const oldSet = window.store.set;<br/>window.store.set = (...data) =&gt; (</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 25pt;text-indent: 0pt;text-align: left;">72  Starting Out with Functions - A Core Concept</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 73pt;text-indent: 0pt;text-align: left;">console.log(...data), oldSet(...data)</p><p style="padding-top: 5pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="3.7"><p class="s10" style="padding-top: 4pt;padding-left: 70pt;text-indent: -18pt;text-align: justify;">Bindless binding: <span class="p">Suppose that bind () was not available; how could you do a polyfill for it?</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="3.8"><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><b>Mystery sort: </b>Back in the <i>Injection - sorting it out </i><span>section, we mentioned that we could sort<br/>numbers  with  something  like  myNumbers  .  sort  (  (a  :  number,  b:number)  =&gt;  a-b)-why/<br/>how does this work?</span></p></li><li data-list-text="3.9"><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><b>Negative sort: </b>Earlier, in the <i>Injection - sorting it out </i><span>section, we saw that sorting numbers as<br/>strings produces unexpected results. What would the result be if the array included both negative<br/>and positive numbers?</span></p></li><li data-list-text="3.10"><p class="s10" style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;">Lexicographic sorting: <span class="p">When sorting, say, book titles or personal names, special collation rules<br/>are applied. For instance, “THE SHINING” would be sorted as “SHINING, THE,” and “Stephen King”<br/>would be sorted as “King, Stephen.” How could you (efficiently) implement such sorting?</span></p></li><li data-list-text="3.11"><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><b>Stubbed logging: </b>In the <i>Stubbing </i><span>section, the stubbed console . log () method doesn’t have<br/>the correct data type - for instance, our version just allows a single argument. Can you provide the<br/>right data type definition?</span></p></li></ol></ol><p style="text-indent: 0pt;text-align: left;"><br/></p><h3 style="padding-top: 10pt;text-indent: 0pt;text-align: right;"><a name="bookmark140">4</a><a name="bookmark141">&zwnj;</a></h3><h2 style="padding-top: 4pt;text-indent: 0pt;text-align: right;">Behaving Properly</h2><h2 style="padding-top: 2pt;text-indent: 0pt;text-align: right;">- Pure Functions</h2><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;">In <i>Chapter 3, Starting Out with Functions, </i>we considered functions as the critical elements in <b>functional</b><span>went into detail about arrow functions, and introduced some concepts, such as<br/>injection, callbacks, polyfilling, and stubbing. In this chapter, we’ll have the opportunity to revisit or<br/>apply some of those ideas.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;text-align: justify;">In this chapter, we will do the following:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l36"><li data-list-text="•"><p style="padding-left: 70pt;text-indent: -13pt;line-height: 123%;text-align: justify;"><span class="s33">	</span>Consider the notion of <b>purity </b>and why we should care about <b>pure functions—</b>and <b>impure</b>as well!</p></li><li data-list-text="•"><p style="padding-top: 5pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">Examine the concept of <b>referential transparency</b></p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">Recognize the problems implied by side effects</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">Show some advantages of pure functions</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">Describe the main reasons behind impure functions</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">Discover ways to minimize the number of impure functions</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">Focus on ways of testing both pure and impure functions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-left: 44pt;text-indent: 0pt;text-align: justify;"><a name="bookmark142">Pure functions</a></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Pure functions behave the same way as mathematical functions and provide various benefits.<br/>A function is pure if it satisfies two conditions:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="•"><p class="s10" style="padding-left: 70pt;text-indent: -13pt;line-height: 123%;text-align: justify;">Given the same arguments, the function always calculates and returns the same result: <span class="p">This<br/>should be true no matter how many times its invoked or under which conditions you call it.<br/>This result cannot depend on any outside information or state, which could change during</span></p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 25pt;text-indent: 0pt;text-align: left;">74  Behaving Properly - Pure Functions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 79pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>the program execution and cause it to return a different value. Nor can the function result<br/>depend on I/O results, random numbers, some other external variable, or a value that is not<br/>directly controllable.</span></p><ul id="l37"><li data-list-text="•"><p class="s33" style="padding-top: 5pt;padding-left: 79pt;text-indent: -13pt;line-height: 124%;text-align: justify;">	<span class="s10">When calculating its result, the function doesn’t cause any observable side effects: </span><span class="p">This<br/>includes output to I/O devices, the mutation of objects, changes to a programs state outside<br/>of  the function, and so on.</span></p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>You can simply say that pure functions don’t depend on (and don’t modify) anything outside their<br/>scope and always return the same result for the same input arguments.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;">Another word used in this context is <b>idempotency, </b><span>but it’s not exactly the same. An idempotent<br/>function can be called as many times as desired and will always produce the same result. However,<br/>this doesn’t imply that the function is free from side effects.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Idempotency is usually mentioned in the context of RESTful services. Let’s see a simple example<br/>showing the difference between purity and idempotency. A PUT call would cause a database record<br/>to  be updated (a side effect), but if you repeat the call, the element will not be further modified, so<br/>the global state of the database won’t change any further.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;">We might also invoke a software design principle and remind ourselves that a function should <i>do</i><span>If a function does something else and has some<br/>hidden functionality, then that dependency on the state will mean that we won’t be able to predict<br/>the function’s output and will make things harder for us as developers.</span></p><p style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;text-align: left;"><a name="bookmark143">Let’s look into these conditions in more detail.</a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 53pt;text-indent: 0pt;text-align: left;">Referential transparency</p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>In mathematics, referential transparency is the property that lets you replace an expression with its value<br/>without changing the results of whatever you are doing. The counterpart of referential transparency<br/>is, appropriately enough, </span><b>referential opacity. </b><span>A referentially opaque function cannot guarantee that<br/>it will always produce the same result, even when called with the same arguments.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">To give a simple example, let’s consider what happens with an optimizing compiler that performs</p><p class="s10" style="padding-top: 2pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">constant folding. <span class="p">Suppose you have a sentence like this:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;text-align: left;">const x = 1 + 2 * 3;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: -9pt;line-height: 220%;text-align: left;"><span>The compiler might optimize the code to the following by noting that 2*3 is a constant value:<br/>const x = 1 + 6;</span></p><p style="padding-left: 61pt;text-indent: -9pt;line-height: 223%;text-align: left;"><span>Even better, a new round of optimization could avoid the sum altogether:<br/>const x    7;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 385pt;text-indent: 0pt;text-align: left;">Pure functions  <span class="s153">75</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>To save execution time, the compiler is taking advantage of the fact that all mathematical expressions<br/>and functions are (by definition) referentially transparent.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>On the other hand, if the compiler cannot predict the output of a given expression, it won’t be able to<br/>optimize the code in any fashion, and the calculation will have to be done at runtime.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: justify;"><span>(TypeScript does a similar type analysis, and given the original const x = 1 + 2 * 3 line, it<br/>would correctly decide that x is of type number.)</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 57pt;text-indent: 0pt;text-align: justify;"><a name="bookmark144">Of lambdas and betas</a></p><p style="padding-top: 4pt;padding-left: 56pt;text-indent: 0pt;line-height: 115%;text-align: justify;"><span>In lambda calculus, if you replace the value of an expression involving a function with the<br/>calculated value for the function, then that operation is called a </span><b>0 (beta) reduction. </b><span>Note that<br/>you can only do this safely with referentially transparent functions.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>All arithmetical expressions (involving both mathematical operators and functions) are referentially<br/>transparent: 22*9 can always be replaced by 19 8. Expressions involving 1/O are not transparent,<br/>given that their results cannot be known until executed. For the same reason, expressions involving<br/>date- and time-related functions or random numbers are also not transparent.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Concerning JavaScript functions you can produce, it’s pretty easy to write some that won’t fulfill the<br/>referential transparency condition. In fact, a function is not even required to return a value, though<br/>the JavaScript interpreter will return undefined in that situation.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 56pt;text-indent: 0pt;text-align: justify;"><a name="bookmark145">A matter of distinction</a></p><p style="padding-top: 4pt;padding-left: 56pt;text-indent: 0pt;line-height: 115%;text-align: justify;"><span>Some languages distinguish between functions, which are expected to return a value, and<br/>procedures, which do not return anything, but that’s not the case with JavaScript. Some languages<br/>even provide the means to ensure that functions are referentially transparent.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;text-align: justify;">If you wanted to, you could classify functions as follows:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l38"><li data-list-text="•"><p class="s33" style="padding-left: 70pt;text-indent: -13pt;line-height: 123%;text-align: left;">	<span class="s10">Pure functions: </span><span class="p">These return a value that depends only on its arguments and have no side<br/>effects whatsoever.</span></p></li><li data-list-text="•"><p class="s33" style="padding-top: 5pt;padding-left: 70pt;text-indent: -13pt;line-height: 126%;text-align: left;">	<span class="s10">Side effects only: </span><span class="p">These don’t return anything (actually, in JavaScript, these functions return<br/>undefined, but that’s not relevant here) but do produce some side effects.</span></p></li><li data-list-text="•"><p class="s10" style="padding-top: 5pt;padding-left: 70pt;text-indent: -13pt;line-height: 123%;text-align: left;">Functions with side effects: <span class="p">This means that they return a value that may not only depend on<br/>the function arguments but also involve side effects.</span></p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>In FP, much emphasis is put on the first group: referentially transparent pure functions. A compiler<br/>can reason about the program behavior (and thus be able to optimize the generated code), and the<br/>programmer can more easily reason about the program and the relationship between its components.<br/>This,   in turn, can help prove the correctness of an algorithm or optimize the code by replacing a<br/>function with an equivalent one.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 25pt;text-indent: 0pt;text-align: left;">76  Behaving Properly - Pure Functions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;text-align: justify;"><a name="bookmark146">Side effects</a></p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>What are side effects? We can define these as a change in state or an interaction with outside elements<br/>(the user, a web service, another computer—whatever) that occurs during the execution of some<br/>calculations or a process.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>There’s a possible misunderstanding as to the scope of this meaning. In everyday speech, when you<br/>speak of side effects, it’s a bit like talking about collateral damage—some unintended consequences for<br/>a given action; however, in computing, we include every possible effect or change outside the function.<br/>If you write a function meant to perform a console . log () call to display a result, that would be<br/>considered a side effect, even if it’s exactly what you intended the function to do in the first place!</span></p><p style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;text-align: justify;">In this section, we will look at the following:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l39"><li data-list-text="•"><p style="padding-left: 79pt;text-indent: -13pt;text-align: left;">Common side effects in JavaScript programming</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 79pt;text-indent: -13pt;text-align: left;">The problems that global and inner states cause</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 79pt;text-indent: -13pt;text-align: left;">The possibility of functions mutating their arguments</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 79pt;text-indent: -13pt;text-align: left;">Some functions that are always troublesome</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s34" style="padding-left: 53pt;text-indent: 0pt;text-align: justify;">Usual side effects</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>In programming, there are (too many!) things that are considered side effects. In JavaScript programming,<br/>including both front- and backend coding, the more common ones you may find include the following:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="•"><p style="padding-left: 79pt;text-indent: -13pt;text-align: left;">Changing global variables.</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 79pt;text-indent: -13pt;text-align: left;">Mutating objects received as arguments.</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 79pt;text-indent: -13pt;text-align: left;">Performing any I/O, such as showing an alert message or logging some text.</p></li><li data-list-text="•"><p style="padding-top: 7pt;padding-left: 79pt;text-indent: -13pt;text-align: left;">Working with, or changing, the filesystem.</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 79pt;text-indent: -13pt;text-align: left;">Querying or updating a database.</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 79pt;text-indent: -13pt;text-align: left;">Calling a web service.</p></li><li data-list-text="•"><p style="padding-top: 7pt;padding-left: 79pt;text-indent: -13pt;text-align: left;">Querying or modifying the DOM.</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 79pt;text-indent: -13pt;text-align: left;">Triggering any external process.</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 79pt;text-indent: -13pt;line-height: 123%;text-align: left;"><span>Just calling another function that produces a side effect of its own. You could say that impurity is<br/>contagious: a function that calls an impure function automatically becomes impure on its own!</span></p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: justify;">With this definition, let’s start looking at what can cause functional impurity (or referential opaqueness).</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 12pt;padding-left: 385pt;text-indent: 0pt;text-align: left;">Pure functions  77</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s34" style="padding-top: 8pt;padding-left: 43pt;text-indent: 0pt;text-align: justify;">Global state</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Of all the preceding points, the most common reason for side effects is the usage of nonlocal variables<br/>that share a global state with other parts of the program. Since pure functions, by definition, always<br/>return the same output value given the same input arguments, if a function refers to anything outside its<br/>internal state, it automatically becomes impure. Furthermore—and this is a hindrance to debugging—<br/>to understand what a function has done, you must understand how the state got its current values,<br/>which means understanding all of the past history from your program: not easy!</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Let’s write a function to detect whether a person is a legal adult by checking whether they were born at<br/>least 18 years ago. (OK—that’s not precise enough because we are not considering the day and month<br/>of birth, but bear with me; the problem is elsewhere.) A version of an isOldEnough () function<br/>could be as follows:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// isOldEnough.ts</p><p style="padding-top: 3pt;padding-left: 52pt;text-indent: 0pt;line-height: 30pt;text-align: left;">const <b>limitYear = 2004; </b><span>// only good for 2022!<br/>const isOldEnough = (birthYear: number) -&gt;</span></p><p class="s10" style="padding-left: 64pt;text-indent: 0pt;text-align: left;">birthYear &lt;= limitYear;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 53pt;text-indent: 0pt;line-height: 143%;text-align: left;"><span>console.log(isOldEnough(1960)); // true<br/>console.log(isOldEnough(2010)); // false</span></p><p style="padding-top: 8pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>The isOldEnough () function correctly detects whether a person is at least 18 years old, but it<br/>depends on an external variable—a variable good for 2022 only! Even though the function works,<br/>the implementation isn’t the best that it could possibly be. You cannot tell what the function does<br/>unless you know about the external variable and how it got its value. Testing is also hard; you must<br/>remember to create the global limitYear variable, or all your tests will fail.</span></p><p style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: justify;"><span>There is an exception to this rule. Check out the following case: is the following circleArea ()<br/>function, which calculates the area of a circle given its radius, pure or not?</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// area.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">const PI = 3.14159265358979;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 8pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">const circleArea = (r: number) =&gt; PI * r ** 2;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Even though the function is accessing an external state, the fact that PI is a constant (and thus cannot<br/>be modified) would allow us to substitute it inside circleArea with no functional change, and<br/>so we should accept that the function is pure. The function will always return the same value for the<br/>same argument and thus fulfills our purity requirements.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 25pt;text-indent: 0pt;text-align: left;">78  Behaving Properly - Pure Functions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>If you were to use Math. PI instead of a constant as we defined in the code (a better idea, by the way)<br/>the constant cannot be changed, so the function would remain pure.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">Here, we have dealt with problems caused by the global state; let’s move on to the inner state.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s34" style="padding-left: 52pt;text-indent: 0pt;text-align: left;">Inner state</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>The notion is also extended to internal variables, in which a local state is stored and used for future<br/>calls. The external state is unchanged, but internal side effects imply future differences regarding what<br/>the function will return. Lets imagine a roundFix () rounding function that considers whether it<br/>has been rounding up or down too much so that the next time, it will round the other way, bringing<br/>the accumulated difference closer to zero. Our function will have to accumulate the effects of previous<br/>roundings to decide how to proceed next. The implementation could be as follows:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// roundFix.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 74pt;text-indent: -12pt;line-height: 143%;text-align: left;"><span>const roundFix = (function () {<br/>let accum = 0;</span></p><p style="padding-left: 73pt;text-indent: 0pt;text-align: left;">return (n: number): number =&gt; {</p><p style="padding-top: 4pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">// reals get rounded up or down</p><p style="padding-top: 4pt;padding-left: 85pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>// depending on the sign of accum<br/>const nRounded =</span></p><p style="padding-left: 97pt;text-indent: 0pt;line-height: 10pt;text-align: left;">accum &gt; 0 ? Math.ceil(n) : Math.floor(n);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 97pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>console.log(<br/>&quot;accum&quot;,<br/>accum.toFixed(5),<br/>&quot; result&quot;,<br/>nRounded</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 85pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>accum += n - nRounded;<br/>return nRounded;</span></p><p class="s17" style="text-indent: 0pt;text-align: right;">};</p><p class="s17" style="padding-top: 1pt;text-indent: 0pt;text-align: right;">}) ();</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 385pt;text-indent: 0pt;text-align: left;">Pure functions  79</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: justify;">Some comments regarding this function:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l40"><li data-list-text="•"><p style="padding-left: 70pt;text-indent: -13pt;line-height: 123%;text-align: left;"><span>The console . log () call is just for the sake of this example; it wouldn’t be included in the<br/>real-world function. It lists the accumulated difference up to the point and the result it will<br/>return: the given number rounded up or down.</span></p></li><li data-list-text="•"><p style="padding-top: 5pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">We are using the IIFE pattern from the my Count er () example in the <i>Immediate invocation</i></p><p style="padding-top: 2pt;padding-left: 70pt;text-indent: 0pt;text-align: left;">section of <i>Chapter 3, Starting Out with Functions, </i>to get a hidden internal variable.</p></li><li data-list-text="•"><p style="padding-top: 7pt;padding-left: 71pt;text-indent: -14pt;line-height: 125%;text-align: left;"><span>The nRounded calculation could also be written as Math [accum &gt; 0 ? &quot;ceil&quot;:<br/>&quot;floor&quot; ] (n) —we test accum to see which method to invoke (&quot; ceil&quot; or &quot; floor&quot;)</span></p></li></ul><p style="padding-left: 70pt;text-indent: 0pt;line-height: 10pt;text-align: left;">and then use the Obj ect [ &quot;method&quot; ] notation to indirectly invoke Obj ect. method ().</p><p style="padding-top: 2pt;padding-left: 70pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>The way we used it, I think, is more clear, but I just wanted to give you a heads-up in case you<br/>happen to find this other coding style.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Running this function with just two values (recognize them?) shows that results are not always the same<br/>for a given input. The result part of the console log shows how the value got rounded, up or down:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><table style="border-collapse:collapse;margin-left:50.28pt" cellspacing="0"><tr style="height:14pt"><td style="width:95pt"><p class="s29" style="padding-left: 2pt;text-indent: 0pt;line-height: 10pt;text-align: left;">roundFix(3.14159);</p></td><td style="width:33pt"><p class="s161" style="padding-right: 5pt;text-indent: 0pt;text-align: right;">//</p></td><td style="width:37pt"><p class="s29" style="padding-left: 5pt;text-indent: 0pt;line-height: 10pt;text-align: left;">accum</p></td><td style="width:53pt"><p class="s29" style="padding-right: 12pt;text-indent: 0pt;line-height: 10pt;text-align: right;">0.00000</p></td><td style="width:51pt"><p class="s29" style="padding-right: 3pt;text-indent: 0pt;line-height: 10pt;text-align: right;">result</p></td><td style="width:11pt"><p class="s29" style="padding-left: 1pt;text-indent: 0pt;line-height: 10pt;text-align: center;">3</p></td></tr><tr style="height:15pt"><td style="width:95pt"><p class="s29" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">roundFix(2.71828);</p></td><td style="width:33pt"><p class="s161" style="padding-top: 1pt;padding-right: 5pt;text-indent: 0pt;text-align: right;">//</p></td><td style="width:37pt"><p class="s29" style="padding-top: 1pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">accum</p></td><td style="width:53pt"><p class="s29" style="padding-top: 1pt;padding-right: 12pt;text-indent: 0pt;text-align: right;">0.14159</p></td><td style="width:51pt"><p class="s29" style="padding-top: 1pt;padding-right: 3pt;text-indent: 0pt;text-align: right;">result</p></td><td style="width:11pt"><p class="s29" style="padding-top: 1pt;padding-left: 1pt;text-indent: 0pt;text-align: center;">3</p></td></tr><tr style="height:15pt"><td style="width:95pt"><p class="s29" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">roundFix(2.71828);</p></td><td style="width:33pt"><p class="s161" style="padding-top: 1pt;padding-right: 5pt;text-indent: 0pt;text-align: right;">//</p></td><td style="width:37pt"><p class="s29" style="padding-top: 1pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">accum</p></td><td style="width:53pt"><p class="s29" style="padding-top: 1pt;padding-right: 12pt;text-indent: 0pt;text-align: right;">-0 .14013</p></td><td style="width:51pt"><p class="s29" style="padding-top: 1pt;padding-right: 3pt;text-indent: 0pt;text-align: right;">result</p></td><td style="width:11pt"><p class="s29" style="padding-top: 1pt;padding-left: 1pt;text-indent: 0pt;text-align: center;">2</p></td></tr><tr style="height:15pt"><td style="width:95pt"><p class="s29" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">roundFix(3.14159);</p></td><td style="width:33pt"><p class="s161" style="padding-top: 1pt;padding-right: 5pt;text-indent: 0pt;text-align: right;">//</p></td><td style="width:37pt"><p class="s29" style="padding-top: 1pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">accum</p></td><td style="width:53pt"><p class="s29" style="padding-top: 1pt;padding-right: 12pt;text-indent: 0pt;text-align: right;">0.57815</p></td><td style="width:51pt"><p class="s29" style="padding-top: 1pt;padding-left: 12pt;text-indent: 0pt;text-align: left;">result</p></td><td style="width:11pt"><p class="s29" style="padding-top: 1pt;padding-left: 1pt;text-indent: 0pt;text-align: center;">4</p></td></tr><tr style="height:15pt"><td style="width:95pt"><p class="s29" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">roundFix(2.71828);</p></td><td style="width:33pt"><p class="s161" style="padding-top: 1pt;padding-right: 5pt;text-indent: 0pt;text-align: right;">//</p></td><td style="width:37pt"><p class="s29" style="padding-top: 1pt;padding-left: 6pt;text-indent: 0pt;text-align: left;">accum</p></td><td style="width:53pt"><p class="s29" style="padding-top: 1pt;padding-right: 14pt;text-indent: 0pt;text-align: right;">-0.28026</p></td><td style="width:51pt"><p class="s29" style="padding-top: 1pt;padding-right: 3pt;text-indent: 0pt;text-align: right;">result</p></td><td style="width:11pt"><p class="s29" style="padding-top: 1pt;padding-left: 1pt;text-indent: 0pt;text-align: center;">2</p></td></tr><tr style="height:15pt"><td style="width:95pt"><p class="s29" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">roundFix(2.71828);</p></td><td style="width:33pt"><p class="s161" style="padding-top: 1pt;padding-right: 5pt;text-indent: 0pt;text-align: right;">//</p></td><td style="width:37pt"><p class="s29" style="padding-top: 1pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">accum</p></td><td style="width:53pt"><p class="s29" style="padding-top: 1pt;padding-right: 12pt;text-indent: 0pt;text-align: right;">0.43802</p></td><td style="width:51pt"><p class="s29" style="padding-top: 1pt;padding-right: 3pt;text-indent: 0pt;text-align: right;">result</p></td><td style="width:11pt"><p class="s29" style="padding-top: 1pt;padding-left: 1pt;text-indent: 0pt;text-align: center;">3</p></td></tr><tr style="height:14pt"><td style="width:95pt"><p class="s29" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">roundFix(2.71828);</p></td><td style="width:33pt"><p class="s161" style="padding-top: 1pt;padding-right: 5pt;text-indent: 0pt;line-height: 11pt;text-align: right;">//</p></td><td style="width:37pt"><p class="s29" style="padding-top: 1pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">accum</p></td><td style="width:53pt"><p class="s29" style="padding-top: 1pt;padding-right: 12pt;text-indent: 0pt;text-align: right;">0.15630</p></td><td style="width:51pt"><p class="s29" style="padding-top: 1pt;padding-right: 3pt;text-indent: 0pt;text-align: right;">result</p></td><td style="width:11pt"><p class="s29" style="padding-top: 1pt;padding-left: 1pt;text-indent: 0pt;text-align: center;">3</p></td></tr></table><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>The first time around, accum is zero, so 3.14159 gets rounded down, and accum becomes 0.14159 in<br/>our favor. The second time, since accum is positive (meaning that we have been rounding in our favor),<br/>2.71828 gets rounded up to 3, and now accum becomes negative. The third time, the same 2.71828<br/>value gets rounded down to 2 because the accumulated difference was negative—we got different values<br/>for the same input! The rest of the example is similar; you can get the same value rounded up or down,<br/>depending on the accumulated differences, because the function’s result depends on its inner state.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 56pt;text-indent: 0pt;text-align: justify;"><a name="bookmark147">Why not OOP?</a></p><p style="padding-top: 4pt;padding-left: 56pt;text-indent: 0pt;line-height: 115%;text-align: justify;"><span>This usage of the internal state is why many FP programmers think that using objects is potentially<br/>flawed. In OOP, we developers are used to storing information (attributes) and using them for<br/>future calculations; however, this usage is considered impure insofar as repeated method calls<br/>may return different values, although the same arguments are being passed.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>We have now dealt with the problems caused by both global and inner states, but there are still more<br/>possible side effects. For example, what happens if a function changes the values of its arguments?<br/>Let’s consider this next.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 25pt;text-indent: 0pt;text-align: left;">80  Behaving Properly - Pure Functions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s34" style="padding-left: 52pt;text-indent: 0pt;text-align: justify;">Argument mutation</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>You also need to be aware of the possibility that an impure function will modify its arguments. In<br/>JavaScript, arguments are passed by value, except for arrays and objects, which are passed by reference.<br/>This implies that any modification to the functions parameters will affect an actual modification of<br/>the original object or array. This can be further obscured by the fact that several </span><b>mutator </b><span>methods<br/>change the underlying objects by definition. For example, say you wanted a function that would find<br/>the maximum element of an array of strings (of course, if it were an array of numbers, you could use<br/>Math. max () with no further ado). A short implementation could be as follows:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// maxStrings.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">const maxStrings = (a: string!]) =&gt; <b>a.sort().pop();</b></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 74pt;text-indent: -13pt;line-height: 143%;text-align: left;"><span>const countries = [<br/>&quot;Argentina&quot;,<br/>&quot;Uruguay&quot;,<br/>&quot;Brasil&quot; ,<br/>&quot;Paraguay&quot;,</span></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">] ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">console.log(maxStrings(countries)); // <b>&quot;Uruguay&quot;</b></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>The function does provide the correct result (and if you worry about foreign languages, we already saw<br/>a way around that in the </span><i>Injection - sorting it out </i>section of <i>Chapter 3, Starting Out with Functions),</i>but it has a defect. Tet’s see what happened with the original array:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;text-align: left;">console.log(countries);</p><p class="s10" style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">// [&quot;Argentina&quot;, &quot;Brasil&quot;, &quot;Paraguay&quot;]</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Oops—the original array was modified; this is a side effect by definition! (TypeScript would have<br/>helped detect this error if we had only written a complete type definition for maxStrings (); see<br/></span><i>Question 4.2 </i><span>for details.) If you were to call maxStrings (countries) again, then instead of<br/>returning the same result as before, it would produce another value; clearly, this is not a pure function.</span></p><p style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>In this case, a quick solution is to work on a copy of the array, and we can use the spread operator<br/>to help. Still, we’ll be dealing with more ways of avoiding these sorts of problems in </span><i>Chapter 10,</i></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 385pt;text-indent: 0pt;text-align: left;">Pure functions  81</p><p style="padding-top: 22pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">const maxStrings2 = (a: string[]) =&gt; <b>[...a] .sort () .pop ();</b></p><p style="padding-top: 16pt;padding-left: 65pt;text-indent: -12pt;line-height: 130%;text-align: left;"><span>let countries = [<br/>&quot;Argentina&quot;,<br/>&quot;Uruguay&quot;,<br/>&quot;Brasil&quot;,<br/>&quot;Paraguay&quot;,</span></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">] ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">console.log(maxStrings2(countries));</p><p style="padding-top: 3pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// &quot;Uruguay&quot;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">console.log(countries);</p><p style="padding-top: 3pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// [&quot;Argentina&quot;, &quot;Uruguay&quot;, &quot;Brasil&quot;, &quot;Paraguay&quot;]</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>So now, we have found yet another cause for side effects: functions that modify their arguments. A<br/>final case to consider is functions that just have to be impure!</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s34" style="padding-left: 44pt;text-indent: 0pt;text-align: left;">Troublesome functions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>Finally, some functions also cause problems. For instance, Math. random () is impure: it doesn’t<br/>always return the same value, and it would defeat its purpose if it did! Furthermore, each call to the<br/>function modifies a global seed value, from which the next random value will be calculated.</span></p><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;line-height: 10pt;text-align: right;">N</p><p class="s10" style="padding-top: 3pt;padding-left: 56pt;text-indent: 0pt;text-align: justify;">Not really random</p><p style="padding-top: 4pt;padding-left: 57pt;text-indent: 0pt;line-height: 115%;text-align: justify;"><span>The fact that random numbers are actually calculated by an internal function makes them<br/>not random at all; </span><i>pseudorandom </i><span>would be a better name for them. If you knew the used<br/>formula and the seed’s initial value, you’d be able to predict the following numbers, in a totally<br/>non-random way.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;text-align: left;">For instance, consider the following function that generates random letters from &quot;A&quot; to &quot; Z&quot;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: justify;">// random.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 6pt;padding-left: 64pt;text-indent: -11pt;line-height: 137%;text-align: left;"><span>const getRandomLetter = (): string =&gt; {<br/>const min = &quot;A&quot;.charCodeAt(0);<br/>const max = &quot;Z&quot;.charCodeAt(0);<br/>return String.fromCharCode(</span></p><p style="padding-left: 76pt;text-indent: 0pt;line-height: 10pt;text-align: left;">Math.floor(Math.random()  *  (1  +  max  -  min))  +  min</p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 25pt;text-indent: 0pt;text-align: left;">82  Behaving Properly - Pure Functions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>The fact that it receives no arguments, but is expected to produce different results upon each call,<br/>clearly points out that this function is impure.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 65pt;text-indent: 0pt;text-align: left;"><a name="bookmark148">Random explanations</a></p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;line-height: 115%;text-align: left;"><span>Go to developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/<br/>Global_Ob j ects/Math/random for an explanation of our getRandomLetter ()<br/>function, and to developer .mozilla . org/en-US/docs/Web/JavaScript/<br/>Reference/Global_Objects/String/charCodeAtforthe .charCodeAt () method.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: left;"><span>Impurity can be inherited by calling functions. If a function uses an impure function, it immediately<br/>becomes impure itself. We might want to use getRandomLetter () to generate random filenames<br/>with  an optional given extension; our getRandomFileName () function could then be as follows:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 73pt;text-indent: -12pt;line-height: 141%;text-align: left;"><span>const getRandomFileName = (fileExtension = &quot;&quot;): string =&gt; {<br/>const NAMEJLENGTH = 12;</span></p><p style="padding-left: 74pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>const namePart = new Array(NAME_LENGTH);<br/>for (let i = 0; i &lt; NAME_LENGTH; i++) {</span></p><p style="padding-left: 85pt;text-indent: 0pt;line-height: 10pt;text-align: left;">namePart[i] = getRandomLetter();</p><p class="s84" style="padding-top: 5pt;padding-left: 75pt;text-indent: 0pt;text-align: left;">}</p><p style="padding-top: 2pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">return namePart.join(&quot;&quot;) + fileExtension;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>Because of its usage of getRandomLetter (), getRandomFileName () is also impure, though<br/>it performs as expected, correctly producing totally random filenames:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><table style="border-collapse:collapse;margin-left:59.18pt" cellspacing="0"><tr style="height:13pt"><td style="width:112pt"><p class="s29" style="padding-left: 2pt;text-indent: 0pt;line-height: 10pt;text-align: left;">getRandomFileName(&quot;.pdf;</p></td><td style="width:23pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:23pt"><p class="s29" style="padding-right: 6pt;text-indent: 0pt;line-height: 10pt;text-align: right;">//</p></td><td style="width:14pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:119pt"><p class="s29" style="padding-right: 2pt;text-indent: 0pt;line-height: 10pt;text-align: right;">&quot;SVHSSKHXPQKG.pdf&quot;</p></td></tr><tr style="height:15pt"><td style="width:112pt"><p class="s29" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">getRandomFileName(&quot;.pdf&quot;);</p></td><td style="width:23pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:23pt"><p class="s29" style="padding-top: 1pt;padding-right: 5pt;text-indent: 0pt;text-align: right;">//</p></td><td style="width:14pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:119pt"><p class="s29" style="padding-top: 1pt;padding-right: 2pt;text-indent: 0pt;text-align: right;">&quot;DCHKTMNWFHYZ.pdf&quot;</p></td></tr><tr style="height:15pt"><td style="width:112pt"><p class="s29" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">getRandomFileName  (&quot;</p></td><td style="width:23pt"><p class="s29" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">.pdf</p></td><td style="width:23pt"><p class="s29" style="padding-top: 1pt;padding-left: 6pt;text-indent: 0pt;text-align: left;">&quot;)</p></td><td style="width:14pt"><p class="s29" style="padding-top: 1pt;padding-right: 1pt;text-indent: 0pt;text-align: center;">;</p></td><td style="width:119pt"><p class="s29" style="padding-top: 1pt;padding-right: 2pt;text-indent: 0pt;text-align: right;">//  &quot;GBTEFTWHADO.pdf&quot;</p></td></tr><tr style="height:13pt"><td style="width:112pt"><p class="s29" style="padding-top: 2pt;padding-left: 2pt;text-indent: 0pt;line-height: 9pt;text-align: left;">getRandomFileName(&quot;.pdf&quot;);</p></td><td style="width:23pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:23pt"><p class="s29" style="padding-top: 2pt;padding-right: 4pt;text-indent: 0pt;line-height: 9pt;text-align: right;">//</p></td><td style="width:14pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:119pt"><p class="s29" style="padding-top: 2pt;padding-right: 2pt;text-indent: 0pt;line-height: 9pt;text-align: right;">&quot;ATCBVUOSXLXW.pdf&quot;</p></td></tr></table><p style="padding-top: 5pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">getRandomFileName(&quot;.pdf&quot;); // &quot;OIFADZKKNVAH.pdf&quot;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>Keep this function in mind; we’ll see some ways around the unit testing problem later in this chapter,<br/>and we’ll rewrite it a bit to help with that.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>The concern about impurity also extends to functions that access the current time or date because their<br/>results will depend on an external condition (namely, the time of day) that is part of the application’s</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 385pt;text-indent: 0pt;text-align: left;">Pure functions  83</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s9" style="padding-left: 43pt;text-indent: -1pt;line-height: 123%;text-align: justify;">global <span class="p">state. We could rewrite our isOldEnough () function to remove the dependency upon<br/>a global variable, but it wouldn’t help much. One attempt is as follows:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// isOldEnough.js</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 64pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>const is01dEnough2 = (birthYear: number): boolean =&gt;<br/>birthYear &lt;= </span><b>new Date().getFullYear() - 18;</b></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 143%;text-align: left;"><span>console.log(is01dEnough2(1960)); // true<br/>console.log(is01dEnough2(2010)); // false</span></p><p style="padding-top: 8pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>A problem has been removed—the new is01dEnough2 () function is now safer. Also, as long as<br/>you don’t use it near midnight just before New Year’s Day, it will consistently return the same results, so<br/>you could say—paraphrasing the </span><i>Ivory Soap </i>slogan from the 19<span class="s162">th </span>century—that it’s about <i>99.44% pure;</i><span>however, an inconvenience remains: how would you test it? If you were to write some tests that worked<br/>fine today, they’d start to fail next year. We’ll have to work a bit to solve this, and we’ll see how later.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Several other functions that are also impure are those that cause I/O. If a function gets input from<br/>a source (a web service, the user themself, a file, or some other source), then the result may obviously<br/>vary. You should also consider the possibility of an I/O error, so the very same function, calling the<br/>same service or reading the same file, might at some point fail for reasons outside its control (you<br/>should assume that your filesystem, database, socket, and so on could be unavailable, and thus a given<br/>function call might produce an error instead of the expected constant, unvarying, answer).</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Even having a pure output and a generally safe statement (such as a console . log ()) that doesn’t<br/>change anything internally (at least in a visible way) causes some side effects because the user does<br/>see a change: namely, the produced output.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Does this imply that we won’t ever be able to write a program that requires random numbers, handles<br/>dates, performs I/O, and also uses pure functions? Not at all—but it does mean that some functions<br/>won’t be pure, and they will have some disadvantages that we will have to consider; we’ll return to<br/>this in a bit.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 43pt;text-indent: 0pt;text-align: justify;"><a name="bookmark149">Advantages of pure functions</a></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>The main advantage of using pure functions is that they don’t have any side effects. When you call<br/>a pure function, you don’t need to worry about anything other than which arguments you are passing<br/>to it. Also, more to the point, you can be sure that you will not cause any problems or break anything<br/>else because the function will only work with whatever you give it and not with outside sources. But<br/>this is not their only advantage. Let’s learn more in the following sections.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 25pt;text-indent: 0pt;text-align: left;">84  Behaving Properly - Pure Functions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s34" style="padding-left: 52pt;text-indent: 0pt;text-align: left;">Order of execution</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">Another way of looking at what we have been saying in this chapter is to see pure functions as robust.</p><p style="padding-top: 2pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: left;"><span>You know that their execution—in whichever order—won’t ever impact the system. This idea can<br/>be extended further: you could evaluate pure functions in parallel, with the assurance that results<br/>wouldn’t vary from what you would get in a single-threaded execution. (JavaScript doesn’t provide</span></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;">Java-like threads, but we can make do, more or less, with workers. We’ll cover this topic in <i>Chapter 5,</i></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: left;"><span>Another consideration to keep in mind when you work with pure functions is that there’s no explicit<br/>need to specify the order in which they should be called. If you work with mathematics, an expression<br/>such as f (2) + f (5) is always the same as f (5) + f (2 ); this is called the </span><i>commutative property.</i></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>However, when you deal with impure functions, that can be false, as shown in the following purposefully<br/>written tricky function:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// tricky.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">let mult = 1;</p><p style="padding-top: 4pt;padding-left: 73pt;text-indent: -11pt;line-height: 143%;text-align: left;"><span>const  f  =  (x:  number):  number  =&gt;  {<br/>mult = -mult;</span></p><p style="padding-left: 73pt;text-indent: 0pt;text-align: left;">return x * mult;</p><p style="padding-top: 6pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">};</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;text-align: left;">console.log(f(2) + f (5)) ; // 3</p><p style="padding-top: 4pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">console.log(f(5) + f (2) ) ; // -3</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>With impure functions such as the previous one, you cannot assume that calculating f (3 ) + f (3 )<br/>would produce the same result as 2 * f (3) or that f (4) - f (4) would actually be zero; check it out<br/>for yourself... Common mathematical properties, down the drain!</span></p><p style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Why should you care? When writing code, willingly or not, you always keep in mind those properties<br/>you learned about, such as the commutative property. So, while you might think that both expressions<br/>should produce the same result and code accordingly, you may be in for a surprise when using impure<br/>functions, with hard-to-find bugs that are difficult to fix.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s34" style="padding-left: 52pt;text-indent: 0pt;text-align: left;">Memoization</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Since the output of a pure function for a given input is always the same, you can cache the function<br/>results and avoid a possibly costly recalculation. This process, which implies evaluating an expression<br/>only the first time and caching the result for later calls, is called </span><b>memoization.</b></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 385pt;text-indent: 0pt;text-align: left;">Pure functions  <span class="s153">85</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;">We will return to this idea in <i>Chapter 6, Producing Functions, </i><span>but let’s look at an example done by<br/>hand. The Fibonacci sequence is always used for this example because of its simplicity and hidden<br/>calculation costs. This sequence is defined as follows:</span></p><ul id="l41"><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">For <span class="s163">H</span>=0, fib(n)=0</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">For „=1, fib(n)=l</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">For <span class="s163">H</span>&gt;1, fib(n)=fib(n-2)+fib(«-l)</p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-top: 4pt;padding-left: 57pt;text-indent: 0pt;text-align: justify;"><a name="bookmark150">Fibonacci who?</a></p><p style="padding-top: 4pt;padding-left: 57pt;text-indent: 0pt;text-align: justify;">Fibonacci’s name actually comes from <i>filius Bonacci </i>or <i>son ofBonacci. </i>He is best known for</p><p class="s164" style="padding-top: 1pt;padding-left: 44pt;text-indent: 0pt;text-align: justify;">, <u>having introduced the usage of digits 0-9 as we know them today instead of the cumbersome</u></p><p style="padding-top: 2pt;padding-left: 56pt;text-indent: 0pt;line-height: 117%;text-align: justify;"><span>Roman numbers. He derived the sequence named after him as the answer to a puzzle involving<br/>rabbits! You can read more about it, and Fibonacci’s life in general, at en. wikipedia. org/<br/>wiki/Fibonacci_number#History        or        plus.maths.org/content/Iife-and-<br/>numbers-fibonacci.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>If you run the numbers, the sequence starts with 0, then 1, and from that point onward, each term<br/>is the sum of the two previous ones: 1 again, then 2, 3, 5, 8, 13, 21, 34, 55, and so on. Programming<br/>this series using recursion is simple; we’ll revisit this example in </span><i>Chapter 9, Designing Functions. </i><span>The<br/>following code, a direct translation of the definition, will do—and see </span><i>Question 4.4 </i>for an alternative:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: justify;">// fibonacci.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 65pt;text-indent: -12pt;line-height: 144%;text-align: left;"><span>const  fib  =  (n:  number):  number  =&gt;  {<br/>if (n == 0) {</span></p><p style="padding-left: 77pt;text-indent: 0pt;text-align: left;">return 0;</p><p style="padding-top: 4pt;padding-left: 76pt;text-indent: -10pt;line-height: 142%;text-align: left;"><span>} else if (n == 1) {<br/>return 1;</span></p><p style="padding-left: 65pt;text-indent: 0pt;text-align: left;">} else {</p><p style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">return fib(n - 2) + fib(n - 1) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: justify;">console.log(fib(10)); // 55, a bit slowly</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>If you try out this function for growing values of n, you’ll soon realize that there is a problem, and<br/>computation starts taking too much time. For example, I took timings (measured in milliseconds) at<br/>my machine and plotted them on a graph. Since the function is quite speedy, I had to run calculations<br/>100 times for values of n between 0 and 40. Even then, the times for small values of n were really tiny;<br/>it was only from 25 onward that I got interesting numbers.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 25pt;text-indent: 0pt;text-align: left;">86  Behaving Properly - Pure Functions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">The chart (see <i>Figure 4.1) </i>shows exponential growth, which bodes ill:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s154" style="padding-top: 8pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">140000</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 65pt;text-indent: 0pt;text-align: left;"><span><img width="492" height="260" alt="image" src="Image_017.jpg"/></span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="436" height="199" alt="image" src="Image_018.gif"/></span></p><p style="padding-left: 52pt;text-indent: 48pt;line-height: 254%;text-align: left;"><span>Figure 4.1 - Calculation times for the fib() recursive function go up exponentially<br/>If we draw a diagram of all the calls required to calculate f ib (6), you’ll notice the problem:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 120pt;text-indent: 0pt;text-align: left;">Figure 4.2 - The calculations needed for fib(6) show lots of duplication</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>Each node represents a call to compute f ib (n). We note the value of n in the node. Every call, except<br/>those for n=0 or n=l, requires further calls, as you can see in </span><i>Figure 4.2.</i></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 12pt;padding-left: 385pt;text-indent: 0pt;text-align: left;">Pure functions  87</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>The reason for the increasing delays becomes obvious: for example, the calculation for f ib (2) was<br/>repeated on four different occasions, and f ib (3 ) was itself calculated three times. Given that our<br/>function is pure, we could have stored the calculated values to avoid running the numbers over and<br/>over again. A possible version, using a cache array for previously calculated values, would be as follows:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;text-align: left;"><a name="bookmark151">const cache: number!] = [] ;</a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 65pt;text-indent: -12pt;line-height: 144%;text-align: left;"><span>const fib2 = (n: number): number =&gt; {<br/>if </span><b>(cache [n] = = = undefined) {</b></p><p style="padding-left: 88pt;text-indent: -11pt;line-height: 146%;text-align: left;"><span>if (n === 0) {<br/>cache[0] = 0;</span></p><p style="padding-left: 88pt;text-indent: -10pt;line-height: 144%;text-align: left;"><span>} else if (n === 1) {<br/>cache[1] = 1;</span></p><p style="padding-left: 77pt;text-indent: 0pt;text-align: left;">} else {</p><p style="padding-top: 3pt;padding-left: 89pt;text-indent: 0pt;text-align: left;">cache[n] = fib2(n - 2) + fib2(n - 1);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 65pt;text-indent: 0pt;text-align: left;"><a name="bookmark152">return cache[n];</a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">console.log(fib2(10)); // 55, as before, but more quickly!</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Initially, the cache array is empty. Whenever we need to calculate the value of f ib2 (n), we check<br/>whether it was already calculated beforehand. If that’s not true, we do the calculation, but with a twist:<br/>instead of immediately returning the value, we first store it in the cache and then return it. This means<br/>that no calculation will be done twice: after we have calculated f ib2 (n) for a particular n value,<br/>future calls will not repeat the procedure and will return the earlier evaluated result.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;text-align: justify;">A few short notes:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l42"><li data-list-text="•"><p style="padding-left: 70pt;text-indent: -12pt;line-height: 124%;text-align: justify;"><span class="s33">	</span><span>We memoized the function by hand, but we can do it with a higher-order function. We’ll see<br/>this later in </span><i>Chapter 6, Producing Functions. </i><span>It is perfectly possible to memoize a function<br/>without having to change or rewrite it.</span></p></li><li data-list-text="•"><p style="padding-top: 5pt;padding-left: 70pt;text-indent: -13pt;line-height: 123%;text-align: justify;"><span class="s33">	</span><span>Using a global cache variable isn’t a very good practice; we could have used an IIFE and<br/>a closure to hide cache from sight—do you see how? (Also, see </span><i>Question 4.3 </i><span>at the end of<br/>this chapter.) The myCounter () example in the </span><i>Immediate invocation </i>section of <i>Chapter 3,</i>shows how.</p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 25pt;text-indent: 0pt;text-align: left;">88  Behaving Properly - Pure Functions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l43"><li data-list-text="•"><p class="s33" style="padding-left: 79pt;text-indent: -13pt;line-height: 124%;text-align: justify;">	<span class="p">Of course, you will be constrained by the available cache space, and it’s possible you could<br/>eventually crash your application by eating up all available RAM. Resorting to external memory<br/>(a database, a file, or a cloud solution) would probably eat up all the performance advantages<br/>of caching. There are some standard solutions (involving eventually deleting items from the<br/>cache), but they are beyond the scope of this book.</span></p></li></ul><p style="padding-top: 8pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Of course, you don’t need to do this for every pure function in your program. You’d do this sort of<br/>optimization only for frequently called functions that take a significant amount of time; otherwise,<br/>the added cache management time would cost more than what you expected to save!</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s34" style="padding-left: 52pt;text-indent: 0pt;text-align: left;">Self-documentation</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Pure functions have another advantage. Since everything the function needs to work with is given to<br/>it through its parameters, with no hidden dependency whatsoever, when you read its source code,<br/>you have all you need to understand its objective.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>An extra advantage: knowing that a function doesn’t access anything beyond its parameters makes<br/>you more confident in using it since you won’t be accidentally producing a side effect; the only thing<br/>the function will accomplish is what you already learned through its documentation.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Unit tests (which we’ll cover in the next section) also work as documentation because they provide<br/>examples of what the function returns when given certain arguments. Most programmers will agree<br/>that  the best kind of documentation is full of examples, and each unit test can be considered such a<br/>sample case.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s34" style="padding-left: 53pt;text-indent: 0pt;text-align: left;">Testing</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Yet another advantage of pure functions—and one of the most important ones—has to do with unit<br/>testing. Pure functions have a single responsibility: producing their output in terms of their input. So,<br/>when you write tests for pure functions, your work is greatly simplified because there is no context<br/>to consider and no state to simulate.</span></p><p style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>You can focus on providing inputs and checking outputs because all function calls can be reproduced<br/>in isolation, independently from the rest of the world.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>We have seen several aspects of pure functions. Let’s move on, learn about impure functions a bit, and<br/>finish by testing both pure and impure functions.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-left: 53pt;text-indent: 0pt;text-align: left;"><a name="bookmark153">Impure functions</a></p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>If you decided to entirely forgo all kinds of side effects, then your programs would only be able to<br/>work with hardcoded inputs and wouldn’t be able to show you the calculated results! Similarly, most<br/>web pages would be useless: you wouldn’t be able to make web service calls or update the DOM;<br/>you’d only have static pages. And your Node code would be really useless for server-side work, as it<br/>wouldn’t be able to perform any I/O.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 375pt;text-indent: 0pt;text-align: left;">Impure functions  89</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Reducing side effects is a good goal in FP, but we shouldn’t go overboard! So, let’s think of how to<br/>avoid using impure functions, if possible, and how to deal with them if not, looking for the best way<br/>to contain or limit their scope.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 43pt;text-indent: 0pt;text-align: justify;"><a name="bookmark154">Avoiding impure functions</a></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Earlier in this chapter, we saw the more common reasons for using impure functions. Let’s now consider<br/>how we can reduce the number of impure functions, even if doing away with all of them isn’t really<br/>feasible. Basically, we’ll have two methods for this:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l44"><li data-list-text="•"><p style="padding-left: 70pt;text-indent: -13pt;text-align: left;">Avoiding the usage of state</p></li><li data-list-text="•"><p style="padding-top: 7pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">Using a programming pattern, <b>injection, </b>to control impurities</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s34" style="padding-left: 43pt;text-indent: 0pt;text-align: justify;">Avoiding the usage of state</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: justify;"><span>With regard to the usage of the global state—both getting and setting it—the solution is well known.<br/>The key points to this are as follows:</span></p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">Provide whatever is needed of the global state to the function as arguments</p></li><li data-list-text="•"><p class="s33" style="padding-top: 7pt;padding-left: 70pt;text-indent: -12pt;line-height: 125%;text-align: left;">	<span class="p">If the function needs to update the state, it shouldn’t do it directly, but instead produce a new<br/>version of the state and return it</span></p></li><li data-list-text="•"><p style="padding-top: 5pt;padding-left: 71pt;text-indent: -14pt;text-align: left;">It should be the caller’s responsibility to take the returned state, if any, and update the global state</p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;">This is the technique that Redux uses for its reducers. (We saw this in the <i>What FP is not </i><span>section<br/>of </span><i>Chapter 1, Becoming Functional, </i>and the <i>Functions as objects </i>section of <i>Chapter 3, Starting Out</i><span>with  Functions.)  The  signature  for  a  reducer  is  (previousState,  action)  =&gt;  newState,<br/>meaning that it takes a state and an action as parameters and returns a new state as the result. Most<br/>specifically, the reducer is not supposed to change the previousState argument, which must<br/>remain untouched (we’ll learn more about this in </span><i>Chapter 10, Ensuring Purity).</i></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>For our first version of the isOldEnough () function, which used a global limitYear variable,<br/>the change is simple enough: we have to provide limitYear as a parameter for the function. With<br/>this change, it will become pure since it will produce its result by only using its parameters.</span></p><p style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: justify;"><span>Even better, we should provide the current year and let the function do the math instead of forcing<br/>the caller to do so. Our newer version of the adult age test could then be as follows:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// isOldEnough.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 64pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>const isOldEnough.3 = (<br/>birthYear: number,</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 25pt;text-indent: 0pt;text-align: left;">90  Behaving Properly - Pure Functions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 73pt;text-indent: 0pt;text-align: left;"><a name="bookmark155">currentYear: </a><span class="p">number</span></p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">): boolean =&gt; birthYear &lt;= <b>currentYear - 18;</b></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Obviously, well have to change all the calls to provide the required currentYear argument (we could<br/>also use partial application, as we will see in </span><i>Chapter 7, Transforming Functions). </i><span>The responsibility<br/>for the value of currentYear remains outside of the function, as before, but we have managed to<br/>avoid a defect:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;line-height: 143%;text-align: left;"><span>console.log(is01dEnough3(1960, 2022)); // true<br/>console.log(is01dEnough3(2010, 2022)); // false</span></p><p style="padding-top: 8pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>We can also apply this solution to our peculiar roundFix () function. As you will recall, the function<br/>worked by accumulating the differences caused by rounding and deciding whether to round up or<br/>down depending on the sign of that accumulator. We cannot avoid using that state, but we can split off<br/>the rounding part from the accumulating part. Our original code (with fewer comments, no logging,<br/>and using arrow functions throughout) would be as follows:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// roundFix.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 74pt;text-indent: -12pt;line-height: 143%;text-align: left;"><span>const  roundFixl  =  (()  =&gt;  {<br/>let accum = 0;</span></p><p style="padding-left: 85pt;text-indent: -12pt;line-height: 144%;text-align: left;"><span>return  (n:  number):  number  =&gt;  {<br/>const nRounded =</span></p><p style="padding-left: 85pt;text-indent: 12pt;line-height: 144%;text-align: left;"><span>accum  &gt;  0  ?  Math.ceil(n)  :  Math.floor(n);<br/>accum += n - nRounded;</span></p><p style="padding-bottom: 4pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">return nRounded;</p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;"><span><img width="36" height="35" alt="image" src="Image_019.gif"/></span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: justify;">The newer version (see <i>Question 4.6 </i>for more about this) would have two parameters:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;text-align: left;"><a name="bookmark156">const roundFix2 = </a><b>(accum: number, n: number) =&gt; {</b></p><p style="padding-top: 4pt;padding-left: 73pt;text-indent: 0pt;line-height: 143%;text-align: left;"><a name="bookmark157"><span>const nRounded = accum &gt; 0 ? Math.ceil(n) : Math.floor(n);<br/>accum += n - nRounded;</span></a></p><p class="s10" style="padding-left: 73pt;text-indent: 0pt;text-align: left;">return { accum, nRounded };</p><p style="padding-top: 6pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">};</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 375pt;text-indent: 0pt;text-align: left;">Impure functions  91</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>How would you use this function? Initializing the accumulator, passing it to the function, and updating<br/>it afterward are now the responsibility of the caller code. You would have something like the following:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">let accum = 0;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// ... some other code...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>let { a, r } = roundFix2(accum, 3.1415);<br/>accum = a;</span></p><p style="padding-left: 43pt;text-indent: 9pt;line-height: 222%;text-align: left;"><span>console.log(accum, r); // 0.1415 3<br/>Note the following:</span></p><ul id="l45"><li data-list-text="•"><p style="padding-left: 70pt;text-indent: -13pt;line-height: 9pt;text-align: left;">The accum value is now part of the global state of the application</p></li><li data-list-text="•"><p style="padding-top: 7pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">Since roundFix2 () needs it, its value is provided in each call</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">The caller is responsible for updating the global state, not roundFix2 ()</p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s154" style="padding-left: 42pt;text-indent: 0pt;text-align: left;">Z<span class="s155">                                                                       </span>X</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 57pt;text-indent: 0pt;text-align: left;">Spreading, once more</p><p style="padding-top: 4pt;padding-left: 57pt;text-indent: 0pt;line-height: 114%;text-align: left;"><span>Note the usage of the destructuring assignment to allow a function to return more than a value<br/>and easily store each one in a different variable. For more on this, go to developer .mozilla.<br/>org/en/docs/Web/JavaScript/Reference/Operators/Destructuring_</span></p><p style="padding-left: 57pt;text-indent: 0pt;text-align: left;">assignment. For an alternative see <i>Question 4.7.</i></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 8pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: left;"><span>This new roundFix2 () function is totally pure and can be easily tested. If you want to hide the<br/>accumulator from the rest of the application, you could still use a closure, as we have seen in other<br/>examples, but that would again introduce impurity in your code—your call!</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s34" style="padding-left: 43pt;text-indent: 0pt;text-align: left;">Injecting impure functions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>If a function becomes impure because it needs to call another function that is itself impure, a way around<br/>this problem is to inject the required function in the call. This technique provides more flexibility in</span></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 10pt;text-align: left;">your code and allows for easier future changes and less complex unit testing.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>Let’s consider the random filename generator function that we saw earlier. The problematic part of<br/>this function is its usage of getRandomLetter () to produce the filename:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// random.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">const getRandomFileNae = (fileExtension = &quot;&quot;): string =&gt;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 25pt;text-indent: 0pt;text-align: left;">92  Behaving Properly - Pure Functions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 85pt;text-indent: 0pt;text-align: left;"><a name="bookmark158">namePart[i] = getRandomLetter();</a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 8pt;padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>A way to solve this is to replace the impure function with an injected external one; we must now<br/>provide a randomLetterFunc () argument for our random filename function to use:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 5pt;padding-left: 73pt;text-indent: -12pt;line-height: 133%;text-align: left;"><span>const getRandomFileName2 = (<br/>fileExtension =<br/></span><b>randomLetterFunc:                                   () =&gt; string</b></p><p style="padding-left: 62pt;text-indent: 0pt;line-height: 10pt;text-align: left;">): string =&gt; {</p><p style="padding-top: 3pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">const NAME_LENGTH = 12;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 5pt;padding-left: 74pt;text-indent: 0pt;line-height: 132%;text-align: left;"><span>const namePart = new Array(NAME_LENGTH);<br/>for (let i = 0; i &lt; NAME_LENGTH; i++) {</span></p><p style="padding-left: 85pt;text-indent: 0pt;text-align: left;">namePart[i] = <b>randomLetterFunc();</b></p><p style="padding-top: 5pt;padding-left: 75pt;text-indent: 0pt;text-align: left;">}</p><p style="padding-top: 1pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">return namePart.join(&quot;&quot;) + fileExtension;</p><p style="padding-top: 5pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">};</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Now, we have removed the inherent impurity from this function. If we want to provide a predefined<br/>pseudorandom function that returns fixed, known values, we can easily unit-test this function; we’ll<br/>see    how in the following examples. The usage of the function will change, and we would have to write<br/>the following:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">let fn = getRandomFileName2(&quot;.pdf&quot;, getRandomLetter);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>If this bothers you, you may want to provide a default value for the randomLetterFunc parameter<br/>as follows:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 5pt;padding-left: 74pt;text-indent: -12pt;line-height: 132%;text-align: left;"><span>const getRandomFileName3 = (<br/>fileExtension =</span></p><p style="padding-left: 73pt;text-indent: 0pt;text-align: left;">randomLetterFunc: () =&gt; string = <b>getRandomLetter</b></p><p style="padding-top: 3pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">) : string =&gt; {</p><p style="padding-top: 3pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">const NAME_LENGTH = 12;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 375pt;text-indent: 0pt;text-align: left;">Impure functions  93</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 64pt;text-indent: 0pt;text-align: justify;">const namePart = new Array(NAME_LENGTH);</p><p style="padding-top: 3pt;padding-left: 76pt;text-indent: -11pt;line-height: 134%;text-align: left;"><span>for (let i = 0; i &lt; NAME_LENGTH; i + + ) {<br/>namePart[i] = randomLetterFunc();</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 65pt;text-indent: 0pt;text-align: justify;">return namePart.join(&quot;&quot;) + fileExtension;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: left;">You can also solve this using <b>partial application, </b>as we’ll see in <i>Chapter 7, Transforming Functions.</i></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>This hasn’t actually avoided the usage of impure functions. Normally, you’ll call getRandomFileName ()<br/>by providing it with the random letter generator we wrote, so it will behave as an impure function.</span></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>However, if for testing purposes you provide a function that returns predefined (that is, not random)<br/>letters, you’ll be able to test it as if it were pure much more easily.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>But what about the original problem function, getRandomLetter () ? We can apply the same<br/>trick and write a new version, such as the following, which will have an argument that will produce<br/>random numbers:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: justify;">// random.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;text-align: justify;">const getRandomLetter2 = (</p><p style="padding-top: 4pt;padding-left: 64pt;text-indent: 0pt;text-align: justify;">getRandomNum: () =&gt; number = <b>Math.random.bind(Math)</b></p><p style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: justify;">): string =&gt; {</p><p style="padding-top: 4pt;padding-left: 64pt;text-indent: 0pt;line-height: 144%;text-align: justify;"><span>const min = &quot;A&quot;.charCodeAt(0);<br/>const max = &quot;Z&quot;.charCodeAt(0);<br/>return String.fromCharCode(</span></p><p style="padding-left: 76pt;text-indent: 0pt;line-height: 10pt;text-align: justify;">Math.floor(getRandomNum() * (1 + max - min)) + min</p><p style="padding-top: 5pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>We should change getRandomFileName3 () to call getRandomLetter2 (). Ifit calls it without<br/>providing any parameters, getRandomLetter2 () will behave in its expected random ways. But<br/>if   we want to test whether getRandomFileName3 () does what we wanted, we can run it with an<br/>injected function that will return whatever we decide, letting us test it thoroughly.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 57pt;text-indent: 0pt;text-align: justify;"><a name="bookmark159">Bind them all</a></p><p style="padding-top: 4pt;padding-left: 56pt;text-indent: 0pt;line-height: 115%;text-align: justify;"><span>For the default of getRandomNum, we wrote Math. random .bind (Math), as explained<br/>in the </span><i>Working with methods </i><span>section of the previous chapter. The alternative (arguably clearer<br/>for some people) is () =&gt; Math. random (); we’ll use it in the </span><i>Is your function pure? </i><span>section<br/>later in this chapter, just for variety.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 25pt;text-indent: 0pt;text-align: left;">94  Behaving Properly - Pure Functions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Let’s finish this section with a more complex case: what happens with a function with multiple<br/>impurities? For instance, we could be working on a backend calculateDebt () service that<br/>calculates a person’s debt, given their id. To do that, we could access a database, get the list of the<br/>person’s invoices, and then call some service to get the amount owed in each invoice; the sum of those<br/>amounts would be the calculated debt. A skeleton of such a function could be as follows—and I’m<br/>using plain JavaScript to omit unnecessary details:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// calculateDebt.js</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 6pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">const calculateDebt = async (id) =&gt; {</p><p style="padding-top: 3pt;padding-left: 73pt;text-indent: 0pt;line-height: 137%;text-align: left;"><span>//  access  a  database  to  get  a  list  of  invoices<br/>const listOfInvoices =</span></p><p class="s10" style="padding-left: 85pt;text-indent: 0pt;line-height: 10pt;text-align: left;">await mySqlConn.query(/* SQL query to get invoices */);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 6pt;padding-left: 73pt;text-indent: 0pt;line-height: 137%;text-align: left;"><span>// call a remote service to learn what&#39;s owed for each<br/>const owedAmounts =</span></p><p class="s10" style="padding-left: 85pt;text-indent: 0pt;text-align: left;">await axios.get(/* API call to get owed amounts */);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 6pt;padding-left: 88pt;text-indent: -14pt;line-height: 137%;text-align: left;"><span>const calculatedDebt = owedAmounts.reduce(<br/>(x,                                     y) =&gt; x + y,</span></p><p style="padding-left: 86pt;text-indent: 0pt;text-align: left;">0</p><p style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">) ;</p><p style="padding-top: 2pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">return calculatedDebt;</p><p style="padding-top: 5pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">};</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: justify;">(If calculatedDebt = wedAmounts. reduce (...) is foreign to you, see the <i>Summing an array</i></p><p style="padding-top: 2pt;padding-left: 52pt;text-indent: 0pt;text-align: justify;">section of <i>Chapter 5, Programming Declaratively.)</i></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>We cannot easily test such a function because it depends on the availability of a database and another<br/>service. To </span><i>purify </i><span>it, we need to inject two functions: one to get data from a database and another to<br/>query a service. The purified function would become this:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 74pt;text-indent: -12pt;line-height: 146%;text-align: left;"><span>const   calculateDebt2   =   async   (<br/>id,</span></p><p class="s10" style="padding-left: 74pt;text-indent: 0pt;line-height: 10pt;text-align: left;">{ getlnvoices, getOwedAmounts } =</p><p class="s10" style="padding-top: 4pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">{ getlnvoicesFromDb, getOwedAmountFromAPI }</p><p style="padding-top: 6pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">) =&gt; {</p><p style="padding-top: 2pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">const    listOfInvoices    =    await    getlnvoices(id);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 375pt;text-indent: 0pt;text-align: left;">Impure functions  95</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 65pt;text-indent: 0pt;line-height: 132%;text-align: left;"><span>const owedAmounts = await getOwedAmounts(listOfInvoices);<br/>const calculatedDebt = owedAmounts.reduce(</span></p><p style="padding-left: 77pt;text-indent: 1pt;line-height: 134%;text-align: left;"><span>(x, y) =&gt; x + y,<br/>0</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 64pt;text-indent: 0pt;text-align: left;">return calculatedDebt;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>In this code, getlnvoicesFromDb () and getOwedAmountFromAPI () would be the functions<br/>that do the DB access and API call. Our calculateDebt2 () function now doesn’t know (or<br/>need to know) the details of how to access and work with the DB or the other service; that’s a better<br/>software design.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Now, the function has two parameters: id (as before) and an optional object with the two functions<br/>to be injected. In regular use, we wouldn’t supply the second parameter, and the function accesses the<br/>DB and calls the API as needed. But here’s the point: for testing purposes, we inject an object with<br/>two mock functions and are then able to write simple tests. (If you are wondering why we injected<br/>an object, see </span><i>Question 4.8.)</i></p><p style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>An extra detail: thorough real-world testing of functions is usually hard to achieve. For instance, how<br/>do you simulate a dropped connection or a failed service call? With injection, that’s no problem; we<br/>can easily provide a mock that will return wrong values, throw an exception, and do anything else<br/>you need for your complete testing.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Using injection to avoid impurities is very important and has a broad spectrum of applications for<br/>other problems. For example, instead of having a function directly access the DOM, we can provide<br/>it with injected functions that would do this. For testing purposes, it would be simple to verify that<br/>the tested function does what it needs to do without really interacting with the DOM (of course, we’d<br/>have to find another way to test those DOM-related functions). This can also apply to functions that<br/>need to update the DOM, generate new elements, and do all sorts of manipulations—you use some<br/>intermediary functions. We’ll even apply injection in </span><i>Chapter 11, Implementing Design Patterns, </i><span>to<br/>derive   a better system architecture, so it’s a powerful, key concept.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 44pt;text-indent: 0pt;text-align: justify;"><a name="bookmark160">Is your function pure?</a></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Let’s end this section by considering an important question: can you ensure that a function is truly<br/>pure? To show the difficulties of this task, we’ll go back to the simple sum3 () function that we saw<br/>in the </span><i>Spread </i>section of <i>Chapter 1, Becoming Functional, </i><span>just rewritten to use arrow functions for<br/>brevity. Would you say that this function is pure? It certainly looks like it!</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// sum3.ts (in chapter 3)</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 25pt;text-indent: 0pt;text-align: left;">96  Behaving Properly - Pure Functions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 73pt;text-indent: -11pt;line-height: 143%;text-align: left;"><span>const  sum3  =  (x:  number,  y:  number,  z:  number):  number  =&gt;<br/>x + y + z ;</span></p><p style="padding-top: 8pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Let’s see: the function doesn’t access anything but its parameters, doesn’t even try to modify them<br/>(not that it could (or could it?)), doesn’t perform any I/O, or work with any of the impure functions<br/>or methods that we mentioned earlier. What could go wrong?</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>The answer has to do with checking your assumptions. For example, who says the arguments for this<br/>function should be numbers? In plain JavaScript, we could call it with, say, strings, but we’re now<br/>using TypeScript, and it’s supposed to check that, right? And even if passing strings to the function,<br/>you might ask yourself: </span><i>OK, they could be strings, but the function would still be pure, wouldn’t it? </i><span>For<br/>an (assuredly evil!) answer to that, see the following code:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// sum3.trick.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;text-align: left;"><a name="bookmark161">const x = {} as number;</a></p><p class="s10" style="padding-top: 4pt;padding-left: 61pt;text-indent: 0pt;text-align: left;"><a name="bookmark162">x.valueOf = () =&gt; Math.random();</a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>const y = 1;<br/>const z = 2;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 61pt;text-indent: 0pt;line-height: 143%;text-align: justify;"><span>console.log(sum3(x, y,<br/>console.log(sum3(x, y,<br/>console.log(sum3(x, y,</span></p><p style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">z)); // 3.2034400919849431</p><p style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">z)); // 3.8537045249277906</p><p style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">z)); // 3.0833258308458734</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;text-align: justify;"><a name="bookmark163">Evil coding!</a></p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;line-height: 115%;text-align: justify;"><span>We assigned a new function to the x . valueOf () method to make an object look like a<br/>number. We also lied when saying x = {} as number; otherwise, TypeScript would have<br/>objected that you were passing an object where a number was expected.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Well, sum3 () ought to be pure, but that actually depends on whichever parameters you pass to it;<br/>you can make a pure function behave impurely! You might console yourself by thinking that surely<br/>no one would pass such arguments, but edge cases are usually where bugs reside. But you need not<br/>resign yourself to abandoning the idea of pure functions. As we see, you can even con TypeScript into<br/>accepting wrong data types, so you can never be totally sure that your code is always pure!</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Throughout these sections, we have gone through the characteristics of pure and impure functions.<br/>Let’s finish the chapter by looking at how we can test these sorts of functions.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 12pt;padding-left: 331pt;text-indent: 0pt;text-align: left;">Testing - pure versus impure   97</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-left: 43pt;text-indent: 0pt;text-align: justify;"><a name="bookmark164">Testing - pure versus impure</a></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>We have seen how pure functions are conceptually better than impure ones, but we cannot set out<br/>on a crusade to vanquish all impurities from our code. First, no one can deny that side effects can<br/>be useful, or at least unavoidable: you will need to interact with the DOM or call a web service, and<br/>there are no ways to do this in a pure way. So, rather than bemoaning the fact that you have to allow<br/>for impurity, try to structure your code to isolate the impure functions and let the rest of your code<br/>be the best it can possibly be.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>With this in mind, you’ll have to be able to write unit tests for all kinds of functions, pure or impure.<br/>Writing unit tests is different, in terms of difficulty and complexity, for pure and impure functions.<br/>While coding tests for the former is usually quite simple and follows a basic pattern, the latter usually<br/>requires scaffolding and complex setups. So, let’s finish this chapter by seeing how to go about testing<br/>both types of functions.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 43pt;text-indent: 0pt;text-align: justify;"><a name="bookmark165">Testing pure functions</a></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Given the characteristics of pure functions that we have already described, most of your unit tests<br/>could be the following:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l46"><li data-list-text="•"><p style="padding-left: 70pt;text-indent: -13pt;text-align: left;">Calling the function with a given set of arguments</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">Verifying that the results match what you expected</p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Let’s start with a couple of simple examples. Testing the isOldEnough () function would have<br/>been more complex than we needed for the version that required access to a global variable. On the<br/>other hand, the last version, i sOldEnough3 (), which didn’t require anything because it received<br/>two parameters, is simple to test:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// isOldEnough.test.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">describe(&quot;isOldEnough&quot;, function () {</p><p style="padding-top: 4pt;padding-left: 76pt;text-indent: -11pt;line-height: 143%;text-align: left;"><span>it(&quot;is false for people younger than 18&quot;, () =&gt; {<br/>expect(is01dEnough3(2010, 2022)).toBe(false);</span></p><p style="padding-top: 2pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">});</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 5pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">it (&quot;is true for people older than 18&quot;, () =&gt; {</p><p style="padding-top: 4pt;padding-left: 76pt;text-indent: 0pt;text-align: left;">expect ( isOldEnough.3 (1960 , 2022 ) ) . toBe (true) ;</p><p style="padding-top: 6pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">});</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 5pt;padding-left: 76pt;text-indent: -11pt;line-height: 143%;text-align: left;"><span>it (&quot;is true for people exactly 18&quot;, () =&gt; {<br/>expect(is01dEnough3(2004, 2022)).toBe(true);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 25pt;text-indent: 0pt;text-align: left;">98  Behaving Properly - Pure Functions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 74pt;text-indent: 0pt;text-align: left;">});</p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">});</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: left;"><span>Testing another of the pure functions we wrote is equally simple, but we must be careful because of<br/>precision considerations. If we test the circleArea function, we must use the Jest toBeCloseTo ()<br/>matcher, which allows for approximate equality when dealing with floating-point numbers. (See<br/></span><i>Question 4.9 </i><span>for more on math in JavaScript.) Other than this, the tests are just about the same—call<br/>the function with known arguments and check the expected results:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// area.test.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 74pt;text-indent: -12pt;line-height: 144%;text-align: left;"><span>describe(&quot;circle area&quot;, function () {<br/>it (&quot;is zero for radius 0&quot;, () = &gt; {</span></p><p style="padding-left: 85pt;text-indent: 0pt;line-height: 143%;text-align: left;"><span>const area = circleArea(0);<br/>expect(area). toBe(0);</span></p><p style="padding-top: 2pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">});</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 5pt;padding-left: 85pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>it(&quot;is PI for radius 1&quot;, () =&gt; {<br/>expect(circleArea(1)).toBeCloseTo(Math.PI);</span></p><p style="padding-top: 2pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">});</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 85pt;text-indent: -11pt;line-height: 143%;text-align: left;"><span>it(&quot;is   approximately   12.5664   for   radius   2&quot;,   ()   =&gt;<br/>expect(circleArea(2)).toBeCloseTo(12.5664));</span></p><p style="padding-top: 2pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">});</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>No difficulty whatsoever! (I wrote the three tests in different styles on purpose, just for variety.) The<br/>test run reports success for both suites (see </span><i>Figure 4.3):</i></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 331pt;text-indent: 0pt;text-align: left;">Testing - pure versus impure   99</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s171" style="padding-left: 1pt;text-indent: 0pt;line-height: 10pt;text-align: left;"><span style=" color: #35C736; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: underline; font-size: 9pt;">B7.</span><span style=" color: #35C736; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 6pt; vertical-align: 2pt;">T</span><span style=" color: #35C736; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt;">?</span><span style=" color: #35C736; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 6pt; vertical-align: 2pt;">:</span><span style=" color: #35C736; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt;">-&#39;S </span>codeF or Chap tars/ch apt er 04is0ldEnough.test.ts</p><p class="s181" style="padding-left: 12pt;text-indent: 0pt;line-height: 9pt;text-align: left;">isOldEnough</p><p class="s171" style="padding-left: 31pt;text-indent: 0pt;line-height: 90%;text-align: left;"><span>is false for people younger tnan 18 (2 ms)<br/>is true for people older than IB</span></p><p class="s181" style="padding-left: 31pt;text-indent: 0pt;text-align: left;">is true for people exactly <span class="s137">18</span></p><p style="padding-left: 44pt;text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s181" style="text-indent: 0pt;line-height: 9pt;text-align: center;"><span style=" color: #35C736; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: underline; font-size: 8pt;">IdT;.</span><span style=" color: #35C736; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 8pt;">&#39; :</span>codeForChapters/chapter 04/area, test. ts</p><p class="s181" style="padding-left: 21pt;text-indent: 0pt;line-height: 10pt;text-align: left;"><span style=" color: #FFF; font-family:&quot;Times New Roman&quot;, serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 8.5pt;">circle </span>area</p><p class="s171" style="padding-left: 4pt;text-indent: 0pt;line-height: 10pt;text-align: center;"><span style=" color: #FFF; font-family:&quot;Times New Roman&quot;, serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 8.5pt;">IS </span>zero for radius 0 (2 ms)</p><p class="s181" style="text-indent: 0pt;line-height: 9pt;text-align: center;">PI for radius 1 (1 ms)</p><p class="s171" style="padding-left: 26pt;text-indent: 0pt;line-height: 10pt;text-align: center;">&#39; is <span class="s169">approximately 12.5664 for radius 2</span></p><p style="padding-left: 44pt;text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 45pt;text-indent: 0pt;text-align: left;"><span class="s166" style=" background-color: #000;">File </span><span class="s167">        </span><span class="s168" style=" background-color: #000;">| £ Stmts ) % Branch </span><span class="s169"> </span><span class="s170" style=" background-color: #000;">% Funes </span><span class="s171">  </span><span class="s168" style=" background-color: #000;">% tines </span><span class="s169">  </span><span class="s166" style=" background-color: #000;">Uncovered line us  </span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s172" style="padding-left: 1pt;text-indent: 0pt;line-height: 9pt;text-align: left;">All files      <span style=" color: #9FE68F;">j</span></p><p class="s172" style="padding-left: 6pt;text-indent: 0pt;text-align: left;"><span>area.ts<br/>is01rtEnough.ts </span><span style=" color: #9FE68F;">|</span></p><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: right;"><span class="s174" style=" background-color: #000;">109 </span><span class="s175" style=" background-color: #000;">| </span></p><p style="text-indent: 0pt;text-align: right;"><span class="s174" style=" background-color: #000;">109 </span><span class="s175" style=" background-color: #000;">| </span></p><p style="text-indent: 0pt;text-align: right;"><span class="s174" style=" background-color: #000;">199 </span><span class="s175" style=" background-color: #000;">| </span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 29pt;text-indent: 0pt;text-align: left;"><span class="s176" style=" background-color: #000;">106 </span></p><p style="padding-top: 1pt;padding-left: 29pt;text-indent: 0pt;text-align: left;"><span class="s176" style=" background-color: #000;">lee </span><span class="s177"><br/></span><span class="s176" style=" background-color: #000;">160 </span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 32pt;text-indent: 0pt;text-align: left;"><span class="s178" style=" background-color: #000;">100 </span></p><p style="padding-left: 32pt;text-indent: 0pt;text-align: left;"><span class="s178" style=" background-color: #000;">160 </span></p><p style="padding-left: 32pt;text-indent: 0pt;text-align: left;"><span class="s178" style=" background-color: #000;">160 </span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 31pt;text-indent: 0pt;text-align: left;"><span class="s178" style=" background-color: #000;">109 </span></p><p style="padding-left: 31pt;text-indent: 0pt;text-align: left;"><span class="s178" style=" background-color: #000;">109 </span></p><p style="padding-left: 31pt;text-indent: 0pt;text-align: left;"><span class="s178" style=" background-color: #000;">109 </span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s179" style="padding-left: 1pt;text-indent: 0pt;line-height: 10pt;text-align: left;"><a name="bookmark166">2 passed, </a><span style=" color: #FFF;">2 total</span></p><p class="s179" style="padding-left: 1pt;text-indent: 0pt;line-height: 10pt;text-align: left;">6 passed, <span style=" color: #FFF;">6 total</span></p><p style="padding-left: 110pt;text-indent: 0pt;text-align: left;"/><p class="s180" style="padding-left: 2pt;text-indent: 0pt;text-align: left;"><span>Test  Suites:<br/></span><span class="s181">Tests:<br/>Snapshots:<br/>Tine:</span></p><p style="text-indent: 0pt;text-align: left;"/><p style="padding-left: 112pt;text-indent: 0pt;line-height: 8pt;text-align: left;"><span class="s182" style=" background-color: #000;">Q </span><span class="s183"> </span><span class="s184" style=" background-color: #000;">total  </span></p><p style="padding-left: 112pt;text-indent: 0pt;text-align: left;"><span class="s184" style=" background-color: #000;">1.109 s </span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 131pt;text-indent: 0pt;text-align: left;">Figure 4.3 - A successful test run for a pair of pure functions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>We don’t have to worry about pure functions; let’s move on to the impure ones we dealt with by<br/>transforming them into pure equivalents.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 43pt;text-indent: 0pt;text-align: left;"><a name="bookmark167">Testing purified functions</a></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>When we considered the following roundFix () special function that required us to use the state<br/>to accumulate the differences due to rounding, we produced a new version by providing the current<br/>state as an added parameter and by having the function return two values—the rounded one and the<br/>updated state:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// roundFix.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 64pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>const roundFix2 = (accum: number, n: number) =&gt; {<br/>const nRounded = accum &gt; 0 ? Math.ceil(n) :</span></p><p style="padding-left: 64pt;text-indent: 11pt;line-height: 142%;text-align: left;"><span>Math.floor(n) ;<br/>accum += n - nRounded;</span></p><p style="padding-left: 64pt;text-indent: 0pt;text-align: left;">return { accum, nRounded };</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 21pt;text-indent: 0pt;text-align: left;">100  Behaving Properly - Pure Functions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>This function is now pure, but testing it requires validating not only the returned values but also the<br/>updated states. We can base our tests on the experiments we did previously. Once again, we have to<br/>use toBeCloseTo () for dealing with floating-point numbers (and see </span><i>Question 4.10 </i><span>for more on<br/>this), but we can use toBe () with integers, which produces no rounding errors. We could write our<br/>tests as follows:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// roundFix.test.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">describe(&quot;roundFix2&quot;, function () {</p><p style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">it(&quot;rounds 3.14159-&gt;3 if differences are 0&quot;, () = &gt; {</p><p style="padding-top: 4pt;padding-left: 85pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>const { accum, nRounded } = roundFix2(0.0, 3.14159);<br/>expect(accum).toBeCloseTo(0.14159);<br/>expect(nRounded).toBe(3);</span></p><p style="padding-top: 2pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">});</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 85pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>it(&quot;rounds   2.71828-&gt;3   if   differences   are   0.14159&quot;,   ()   =&gt;   {<br/>const { accum, nRounded } = roundFix2(0.14159,</span></p><p style="padding-left: 97pt;text-indent: 0pt;text-align: left;">2.71828);</p><p style="padding-top: 4pt;padding-left: 85pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>expect(accum).toBeCloseTo(-0.14013);<br/>expect(nRounded).toBe(3);</span></p><p style="padding-top: 1pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">});</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 5pt;padding-left: 85pt;text-indent: -11pt;line-height: 143%;text-align: left;"><span>it(&quot;rounds   2.71828-&gt;2   if   differences   are   -0.14013&quot;,   ()   =&gt;   {<br/>const { accum, nRounded } = roundFix2(</span></p><p style="padding-left: 98pt;text-indent: 0pt;text-align: left;">-0.14013,</p><p style="padding-top: 4pt;padding-left: 97pt;text-indent: 0pt;text-align: left;">2.71828</p><p style="padding-top: 5pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">) ;</p><p style="padding-top: 3pt;padding-left: 85pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>expect(accum).toBeCloseTo(0.57815);<br/>expect(nRounded).toBe(2);</span></p><p style="padding-top: 2pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">});</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 85pt;text-indent: -11pt;line-height: 143%;text-align: left;"><span>it(&quot;rounds   3.14159-&gt;4   if   differences   are   0.57815&quot;,   ()   =&gt;   {<br/>const { accum, nRounded } = roundFix2(0.57815,</span></p><p style="padding-left: 98pt;text-indent: 0pt;text-align: left;">3.14159) ;</p><p style="padding-top: 4pt;padding-left: 85pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>expect(accum).toBeCloseTo(-0.28026);<br/>expect(nRounded).toBe(4);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 331pt;text-indent: 0pt;text-align: left;">Testing - pure versus impure   101</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>We included several cases, with positive, zero, or negative accumulated differences, and checked<br/>whether they rounded up or down on each occasion. We could certainly go further by rounding<br/>negative numbers, but the idea is clear: if your function takes the current state as a parameter and<br/>updates it, the only difference with the pure functions’ tests is that you will also have to test whether<br/>the returned state matches your expectations.</span></p><p style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;">Let’s now consider an alternative way of testing for our <i>purified </i><span>getRandomLetter2 () function.<br/>This is simple: you have to provide a function that produces random numbers. (This kind of function,<br/>in testing parlance, is called a stub.) There’s no limit to the complexity of a stub, but you’ll want to<br/>keep it simple.</span></p><p style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Based on our knowledge of the workings of the function, we can then do some tests to verify that<br/>low values produce an &quot;A&quot; output and values close to 1 produce a &quot; </span><i>Z</i><span>&quot; output so that we can have a<br/>little confidence that no extra values are produced. We should also test that a middle value (around<br/>0.5) should generate a letter around the middle of the alphabet. However, this kind of test is not very<br/>good—if we implemented getRandomLetter2 () in another way, it might work perfectly well<br/>but  not pass this test! Our tests could be written as follows:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// random.test.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 6pt;padding-left: 65pt;text-indent: -12pt;line-height: 139%;text-align: left;"><span>describe(&quot;getRandomLetter2&quot;, function () {<br/>it(&quot;returns A for values close to 0&quot;, () =&gt; {</span></p><p style="padding-left: 76pt;text-indent: 0pt;line-height: 137%;text-align: left;"><span>const letterSmall = getRandomLetter2(() = &gt; 0.0001);<br/>expect(letterSmall).toBe(&quot;A&quot;);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 65pt;text-indent: 0pt;text-align: left;">it(&quot;returns Z for values close to 1&quot;, () =&gt; {</p><p style="padding-top: 3pt;padding-left: 76pt;text-indent: 0pt;line-height: 137%;text-align: left;"><span>const letterBig = getRandomLetter2(() =&gt; 0.99999);<br/>expect(letterBig).toBe(&quot;Z&quot;);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 76pt;text-indent: -11pt;line-height: 135%;text-align: left;"><span>it(&quot;returns middle letter for values around 0.5&quot;,<br/>const letterMiddle = getRandomLetter2(() =&gt;</span></p><p style="padding-left: 89pt;text-indent: 0pt;text-align: left;">0.49384712) ;</p><p style="padding-top: 4pt;padding-left: 76pt;text-indent: 0pt;line-height: 137%;text-align: left;"><span>expect(letterMiddle &gt; &quot;G&quot;).toBeTruthy();<br/>expect(letterMiddle &lt; &quot;S&quot;).toBeTruthy();</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 21pt;text-indent: 0pt;text-align: left;">102  Behaving Properly - Pure Functions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 85pt;text-indent: -11pt;line-height: 142%;text-align: left;"><span>it(&quot;returns   ascending   letters   for   ascending   #s&quot;,   ()   =&gt;   {<br/>const letterl = getRandomLetter2(() =&gt; 0.09);</span></p><p style="padding-left: 85pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>const letter2 = getRandomLetter2(() =&gt; 0.22);<br/>const letters = getRandomLetter2(() =&gt; 0.60);<br/>expect(letterl &lt; letters) .toBeTruthy() ;<br/>expect(letter2  &lt; letters).toBeTruthy();</span></p><p style="padding-top: 2pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">});</p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">});</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Testing our filename generator can be done similarly, by using stubs. We can provide a simple stub,<br/>f (), that will return the letters of &quot; SORTOFRANDOM&quot; in sequence (this function is quite impure;<br/>can you see why?). So, we can verify that the returned filename matches the expected name and a<br/>couple more properties of the returned filename, such as its length and extension. Our test could then<br/>be written as follows:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 74pt;text-indent: -12pt;line-height: 142%;text-align: left;"><span>describe(&quot;getRandomFileNameS&quot;,    function    ()    {<br/>let a: string!] = [] ;</span></p><p style="padding-left: 73pt;text-indent: 0pt;text-align: left;">const f = () =&gt; a.shift() as string;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">beforeEach(()</p><p style="padding-top: 4pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">a = &quot;SORTOFRANDOM&quot;.split (&quot;&quot;) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 85pt;text-indent: -11pt;line-height: 143%;text-align: left;"><span>it(&quot;uses   the   given   letters   for   the   file   name&quot;,   ()   =&gt;   {<br/>const fileName = getRandomFileNameS(&quot;&quot;, f);<br/>expect(fileName.startsWith(&quot;SORTOFRANDOM&quot;)).toBe(true);</span></p><p style="padding-top: 2pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">});</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 5pt;padding-left: 85pt;text-indent: -11pt;line-height: 143%;text-align: left;"><span>it(&quot;includes   right   extension,   has   right   length&quot;,   ()   =&gt;   {<br/>const fileName = getRandomFileNameS(&quot;.pdf&quot;, f);<br/>expect(fileName.endsWith(&quot;.pdf&quot;)).toBe(true);</span></p><p style="padding-left: 85pt;text-indent: 0pt;text-align: left;">expect(fileName.length).toBe(16);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 331pt;text-indent: 0pt;text-align: left;">Testing - pure versus impure   103</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;">Testing <i>purified </i><span>impure functions is the same as testing originally pure functions. Now, we need to<br/>consider some cases of truly impure functions because, as we said, it’s quite certain that at some time<br/>or another, you’ll have to use such functions.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 43pt;text-indent: 0pt;text-align: justify;"><a name="bookmark168">Testing impure functions</a></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>For starters, we’ll return to our original getRandomLetter () function. With insider knowledge<br/>about its implementation (this is called </span><b>white-box testing, </b>as opposed to <b>black-box testing, </b><span>where<br/>we know nothing about the function’s code itself), we can </span><i>spy on </i><span>(a Jest expression) on the Math.<br/>random () method and set a mock function that will return whichever values we desire.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>We can revisit some of the test cases we went through in the previous section. In the first case, we set<br/>Math. random () to return 0.0001 (and test that it was actually called) and we also check that the<br/>final return is &quot;A&quot;. In the second case, just for variety, we set things up so that Math. random ()<br/>will be called twice, returning two different values. We also verify that both results are &quot; Z &quot;. Our<br/>revisited tests could look as follows:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 64pt;text-indent: -12pt;line-height: 144%;text-align: left;"><span>describe(&quot;getRandomLetter&quot;, function () {<br/>afterEach(() =&gt; {</span></p><p style="padding-left: 77pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>//  so  count  of  calls  to  Math.random  will  be  OK<br/>jest.restoreAllMocks();</span></p><p style="padding-top: 2pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">});</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 5pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">it(&quot;returns A for values - 0&quot;, () =&gt; {</p><p style="padding-top: 4pt;padding-left: 76pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>jest.spyOn(Math, &quot;random&quot;).mockReturnValue(0.00001);<br/>const letterSmall = getRandomLetter();<br/>expect(Math.random).toHaveBeenCalled();</span></p><p style="padding-left: 76pt;text-indent: 0pt;line-height: 10pt;text-align: left;">expect (letterSmall) . toBeC&#39;A&quot;) ;</p><p style="padding-top: 6pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">});</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 5pt;padding-left: 77pt;text-indent: -11pt;line-height: 142%;text-align: left;"><span>it(&quot;returns Z for values ~ 1&quot;, () =&gt; {<br/>j est</span></p><p style="padding-left: 90pt;text-indent: 0pt;line-height: 10pt;text-align: left;">.spyOn(Math, &quot;random&quot;)</p><p style="padding-top: 4pt;padding-left: 90pt;text-indent: 0pt;text-align: left;">.mockReturnValueOnce(0.988)</p><p style="padding-top: 4pt;padding-left: 76pt;text-indent: 13pt;line-height: 143%;text-align: left;"><span>.mockReturnValueOnce(0.999);<br/>const letterBigl = getRandomLetter();<br/>const letterBig2 = getRandomLetter();</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 21pt;text-indent: 0pt;text-align: left;">104  Behaving Properly - Pure Functions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 85pt;text-indent: 0pt;line-height: 146%;text-align: left;"><span>expect(Math.random).toHaveBeenCalledTimes(2);<br/>expect(letterBigl).toBe(&quot;Z&quot;);</span></p><p style="padding-left: 85pt;text-indent: 0pt;line-height: 10pt;text-align: left;">expect(letterBig2) .toBe(&quot;Z&quot;) ;</p><p style="padding-top: 6pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">});</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 85pt;text-indent: -11pt;line-height: 143%;text-align: left;"><span>it(&quot;returns middle letter for values ~ 0.5&quot;, () =&gt; {<br/>jest.spyOn(Math, &quot;random&quot;).mockReturnValue(0.49384712);<br/>const letterMiddle = getRandomLetter();<br/>expect(Math.random).toHaveBeenCalledTimes(1);<br/>expect(letterMiddle                                        &gt; &quot;G&quot;).toBeTruthy();<br/>expect(letterMiddle &lt; &quot;S&quot;).toBeTruthy();</span></p><p style="padding-top: 2pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">});</p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">});</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>(Of course, you wouldn’t go around inventing whatever tests came into your head. In all likelihood,<br/>you’ll work from the description of the desired getRandomLetter () function, which was written<br/>before you started to code or test it. In our case, I’m making do as if that specification did exist, and it<br/>pointedly said—for example—that values close to 0 should produce an &quot;A&quot; output, values close to 1<br/>should return &quot; Z&quot;, and the function should return ascending letters for ascending random values.)</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Now, how would you test the original getRandomFileName () function, the one that called the<br/>impure getRandomLetter () function? That’s a much more complicated problem.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>What kind of expectations do you have? You cannot know the results it will give, so you won’t be<br/>able to write any . toBe () type of tests. What you can do is test for some properties of the expected<br/>results, and also, if your function implies randomness of some kind, you can repeat the tests as many<br/>times as you want so that you have a bigger chance of catching a bug. We could do some tests along<br/>the lines of the following code:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 74pt;text-indent: -12pt;line-height: 144%;text-align: left;"><span>describe(&quot;getRandomFileName+impure getRandomLetter&quot;, () =&gt; {<br/>it(&quot;generates  12  letter  long  names&quot;,  ()  =&gt;  {</span></p><p style="padding-left: 97pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>for (let i = 0; i &lt; 100; i++) {<br/>expect(getRandomFileName().length).toBe(12);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 75pt;text-indent: 0pt;text-align: left;">});</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 5pt;padding-left: 86pt;text-indent: -12pt;line-height: 144%;text-align: left;"><span>it(&quot;generates   names   with   letters   A   to   Z,   only&quot;,  ()   =&gt;   {<br/>for (let i = 0; i &lt; 100; i++) {</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 331pt;text-indent: 0pt;text-align: left;">Testing - pure versus impure   105</p><p style="padding-top: 22pt;padding-left: 89pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>const name = getRandomFileName();<br/>for (let j = 0; j &lt; name.length; j++) {</span></p><p style="padding-left: 113pt;text-indent: -13pt;line-height: 143%;text-align: left;"><span>expect(name[j] &gt;= &quot;A&quot; &amp;&amp; namelj] &lt;=<br/>&quot;Z&quot;).toBe(true);</span></p><p style="padding-top: 31pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">});</p><p style="padding-top: 17pt;padding-left: 76pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>it(&quot;includes right extension if provided&quot;, () =&gt; {<br/>const fileNamel = getRandomFileName(&quot;.pdf&quot;);<br/>expect(fileNamel.length) .toBe (16) ;<br/>expect(fileNamel.endsWith(&quot;.pdf&quot;)).toBe(true);</span></p><p style="padding-top: 2pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">});</p><p style="padding-top: 17pt;padding-left: 76pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>it(&quot;doesn&#39;t include extension if not provided&quot;, () =&gt; {<br/>const fileName2 = getRandomFileName();<br/>expect(fileName2.length) .toBe (12) ;<br/>expect(fileName2.includes(&quot;.&quot;)).toBe(false);</span></p><p style="padding-top: 2pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">});</p><p style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">});</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>We are not passing any random letter generator function to getFileName (), so it will use the<br/>original, impure one. We ran some of the tests a hundred times, as extra insurance. Our tests check<br/>for the following:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l47"><li data-list-text="•"><p style="padding-left: 70pt;text-indent: -13pt;text-align: left;">Filenames are 12 letters long</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">Names only include letters “A” to “Z”</p></li><li data-list-text="•"><p style="padding-top: 7pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">Filenames include the provided extension</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">If no extension is provided, none is included</p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-top: 8pt;padding-left: 56pt;text-indent: 0pt;text-align: left;"><a name="bookmark169">Need for evidence</a></p><p style="padding-top: 4pt;padding-left: 56pt;text-indent: 0pt;line-height: 115%;text-align: left;">When testing code, always remember that <i>absence of evidence isn’t evidence of absence. </i><span>Even<br/>if our repeated tests succeed, there is no guarantee that they won’t produce an unexpected,<br/>hitherto undetected, error with some other random input.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 21pt;text-indent: 0pt;text-align: left;">106  Behaving Properly - Pure Functions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Let’s do another property test. Suppose we want to test a shuffling algorithm; we might decide to<br/>implement the Fisher-Yates version along the lines of the following code. (For more on this algorithm—<br/>including  some  pitfalls  for  the  unwary  programmer—see  en.  wikipedia.  org/wiki/Fisher-<br/>Yates_shuf f le.) As implemented, the algorithm is doubly impure: it doesn’t always produce the<br/>same result (obviously!) and it modifies its input parameter:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// shuffie.test.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 5pt;padding-left: 73pt;text-indent: -12pt;line-height: 132%;text-align: left;"><span>const shuffle = &lt;T&gt;(arr: T[] ) : T[] =&gt; {<br/>const len = arr.length;</span></p><p style="padding-left: 74pt;text-indent: 0pt;text-align: left;">for (let i = 0; i &lt; len - 1; i++) {</p><p style="padding-top: 3pt;padding-left: 88pt;text-indent: -2pt;line-height: 135%;text-align: left;"><span>let r = Math.floor(Math.random() * (len - i) ) ;<br/>[arr[i], arr[i + r] ] = [arr [i + r] , arr[i]];</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">return arr;</p><p style="padding-top: 5pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">};</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">const xxx = [11, 22, 33, 44, 55, 66, 77, 88];</p><p style="padding-top: 3pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">console.log(shuffle(xxx));</p><p style="padding-top: 3pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">// [55, 77, 88, 44, 33, 11, 66, 22]</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>How could you test this algorithm? Given that the result won’t be predictable, we can check for the<br/>properties of its output. We can call it with a known array and then test some properties—but see<br/></span><i>Question 4.13 </i>for an important detail:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 5pt;padding-left: 74pt;text-indent: -12pt;line-height: 132%;text-align: left;"><span>describe(&quot;shuffleTest&quot;, function () {<br/>it(&quot;shouldn</span><span class="s162">1</span>t change the array length&quot;, () =&gt; {</p><p style="padding-left: 85pt;text-indent: 0pt;text-align: left;">const a = [22, 9, 60, 12, 4, 56];</p><p style="padding-top: 3pt;padding-left: 85pt;text-indent: 0pt;line-height: 134%;text-align: left;"><span>shuffle(a) ;<br/>expect(a.length).toBe(6);</span></p><p style="padding-top: 2pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">});</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 85pt;text-indent: -11pt;line-height: 134%;text-align: left;">it(&quot;shouldn<span class="s162">1</span><span>t change the values&quot;, () =&gt; {<br/>const a = [22, 9, 60, 12, 4, 56];</span></p><p style="padding-left: 85pt;text-indent: 0pt;line-height: 134%;text-align: left;"><span>shuffle(a);<br/>expect(a.includes(22)).toBe(true);<br/>expect(a.includes(9)).toBe(true);<br/>expect(a.includes(60)).toBe(true);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 12pt;padding-left: 403pt;text-indent: 0pt;text-align: left;">Summary  107</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: right;">});</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 8pt;text-indent: 0pt;text-align: left;">});</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;line-height: 133%;text-align: left;"><span>expect(a.includes(12)).toBe(true);<br/>expect(a.includes(4)).toBe(true);<br/>expect(a.includes(56)).toBe(true);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>We had to write the second part of the unit tests in that way because, as we saw, shuf f le () modifies<br/>the input parameter. For tests for a different (and bad!) shuffling function, see </span><i>Question 4.14.</i></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-left: 43pt;text-indent: 0pt;text-align: left;"><a name="bookmark170">Summary</a></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>In this chapter, we introduced the concept of pure functions and studied why they matter. We also<br/>saw the problems caused by side effects—one of the causes of impure functions—looked at some<br/>ways of purifying such impure functions, and finally, we saw several ways of performing unit tests for<br/>both pure and impure functions. With these techniques, you’ll be able to favor using pure functions<br/>in your programming, and when impure functions are needed, you’ll have some ways of using them<br/>in a controlled manner.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;">In <i>Chapter 5, Programming Declarative!.)/, </i><span>we’ll show other advantages of FP: how you can program in<br/>a declarative fashion at a higher level for more straightforward and robust code.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-left: 43pt;text-indent: 0pt;text-align: left;"><a name="bookmark171">Questions</a></p><ol id="l48"><ol id="l49"><li data-list-text="4.1"><p class="s10" style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;">Must return?<span class="p">A simple, almost philosophical question: must pure functions always return something?<br/>Could you have a pure function that doesn’t return anything?</span></p></li><li data-list-text="4.2"><p class="s10" style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: justify;">Well-specified return: <span class="p">What would have happened if we had added the return type definition<br/>to maxStrings () ?</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">const maxStrings = (a: string!]): <b>string =&gt; </b>a.sort().pop();</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="4.3"><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><b>Go for a closure: </b>As suggested in the <i>Memoization </i><span>section, use a closure to avoid needing a global<br/>cache array for the optimized f ib2 () function.</span></p></li><li data-list-text="4.4"><p class="s10" style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;">Minimalistic function: <span class="p">Functional programmers sometimes write code in a minimalistic way.<br/>Can you examine the following version of the Fibonacci function and explain whether it works, and<br/>if so, how?</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// Fibonacci.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 64pt;text-indent: -11pt;line-height: 143%;text-align: left;"><span>const fib3 = (n: number): number =&gt;<br/>n &lt; 2 ? n : fib2(n - 2) + fib2(n - 1);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 21pt;text-indent: 0pt;text-align: left;">108  Behaving Properly - Pure Functions</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="4.5"><p class="s10" style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;">A cheaper way: <span class="p">The following version of the Fibonacci function is quite efficient, doesn’t require<br/>memoization or caching, and doesn’t require unnecessary or repeated computations. Can you see<br/>how? Here’s a suggestion: try to calculate f ib4 (6) by hand and compare it with the example given<br/>earlier in the book:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// fibonacci.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 73pt;text-indent: -11pt;line-height: 143%;text-align: left;"><span>const fib4 = (n: number, a = 0, b = 1): number = &gt;<br/>n === 0 ? a : fib4(n - 1, b, a + b) ;</span></p></li><li data-list-text="4.6"><p class="s10" style="padding-top: 8pt;padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: justify;">Rounding type: <span class="p">Whafs the type of the roundFix2 () function? Even when TypeScript can work<br/>it out by itself (as in this case), I prefer spelling it out for extra checks.</span></p></li><li data-list-text="4.7"><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><b>Tuples to go: </b><span>If we need to return more than one value from a function, we can return an array<br/>instead of an object. For better clarity, TypeScript allows using </span><i>tuples, </i><a href="http://www/" class="s11" target="_blank">which are arrays of known<br/>length  and  data  types.  (See  </a><span>www.  type  script  lang  .  org/docs/handbook/2/obj  ects .<br/>html#tuple-types  for  more  on  this.)  Rewrite  roundFix2  ()  so  that  it  will  return  a  tuple<br/>instead                                                                                                          of a record. The input to this rewritten function could be two separate arguments or a single<br/>tuple argument.</span></p></li><li data-list-text="4.8"><p class="s10" style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: justify;">One injection or two? <span class="p">Why is it better to inject an object with two functions rather than two<br/>separate functions? In other words, why not write something like the following?</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 74pt;text-indent: -12pt;line-height: 146%;text-align: left;"><span>const calculateDebt2 = async (<br/>id,</span></p><p class="s10" style="padding-left: 73pt;text-indent: 0pt;line-height: 142%;text-align: left;"><span>getlnvoices = getlnvoicesFromDb,<br/>getOwedAmounts = getOwedAmountFromAPI</span></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">) =&gt; ... ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="4.9"><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><b>JavaScript does math? </b>In the <i>Testing purified functions </i><span>section, we mentioned the need for<br/>toBeCloseTo () because of precision problems. A related question, often asked in job interviews,<br/>is </span><i>what will the following code output, and why?</i></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;line-height: 133%;text-align: justify;"><span>const a = 0.1;<br/>const b = 0.2;<br/>const c = 0.3;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 73pt;text-indent: -11pt;line-height: 134%;text-align: left;"><span>if (a + b === c) {<br/>console.log(&quot;Math works I&quot;);</span></p><p style="padding-left: 62pt;text-indent: 0pt;line-height: 10pt;text-align: left;">} else {</p><p style="padding-top: 3pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">console.log(&quot;Math failure?&quot;);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 401pt;text-indent: 0pt;text-align: left;">Questions  109</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="4.10"><p class="s10" style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;">Breaking laws: <span class="p">Using toBeCloseTo () is practical but can cause problems. Some basic<br/>mathematics properties are as follows:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l50"><li data-list-text="•"><p style="padding-left: 70pt;text-indent: -13pt;text-align: left;">A number should equal itself: for all numbers <i>a, a </i>should equal <i>a</i></p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">If <i>a </i>equals <i>b, </i>then <i>b </i>should equal <i>a</i></p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">If <i>a </i>equals <i>b, </i>and <i>b </i>equals <i>c, </i>then <i>a </i>should equal <i>c</i></p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 71pt;text-indent: -14pt;text-align: left;">If a equals <i>b, </i>and <i>c </i>equals <i>d, </i>then <i>a+c </i>should equal <i>b+d, a-c </i>should equal <i>b-d, a*c </i>should equal</p><p class="s9" style="padding-top: 2pt;padding-left: 70pt;text-indent: 0pt;text-align: left;">b*d, <span class="p">and </span>a/c <span class="p">should equal </span>b/d</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 6pt;text-indent: 0pt;text-align: center;">Does toBeCloseTo () satisfy all these properties?</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li></ul></li><li data-list-text="4.11"><p class="s10" style="padding-left: 65pt;text-indent: -22pt;text-align: justify;">Shuffling kinds: <span class="p">Why did we need to use a generic type &lt; T &gt; in the definition of shuf f 1 e () ?</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="4.12"><p class="s10" style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;">No return needed: <span class="p">Given that shuffle () modifies the input array in place (a side effect!) we<br/>don’t really need the final return arr line and could remove it. What would be the type definition<br/>ofshuffleO then?</span></p></li><li data-list-text="4.13"><p style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;">. <b>A shuffle test: </b><span>How would you write unit tests for s hu f f 1 e () to test whether it works correctly<br/>with arrays with repeated values? The tests we wrote are only valid for arrays with distinct values;<br/>can you see why?</span></p></li><li data-list-text="4.14"><p class="s10" style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;">Popular, but wrong! <span class="p">Many online articles suggest the following code as a way of shuffling. The<br/>idea is to sort the array, but, instead of using a correct comparison function to randomly return positive<br/>or negative values, these random comparisons should get the array in disorder. However, the idea is<br/>wrong and the algorithm is bad because it doesn’t produce all possible outputs with equal probability.<br/>How can you check that?</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">const poorShuffle = (arr) =&gt;</p><p style="padding-top: 4pt;padding-left: 51pt;text-indent: 0pt;text-align: center;">arr.sort(() =&gt; <b>Math.random() - 0.5);</b></p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="4.15"><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><b>Shuffling by sorting: </b><span>Sorting and shuffling can be seen as opposite functions; one brings order,<br/>and the other produces disorder. However, there’s a way to shuffle an array by sorting; can you figure<br/>out how? (And no, the answer is </span><i>not </i><span>the lousy algorithm shown in the previous question!) We are<br/>looking for an algorithm that can produce every possible output with the same probability, not favoring<br/>some outputs over others.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><h3 style="padding-top: 10pt;text-indent: 0pt;text-align: right;"><a name="bookmark172">5</a><a name="bookmark173">&zwnj;</a></h3><h2 style="padding-top: 3pt;text-indent: 0pt;text-align: right;">Programming Declaratively</h2><h2 style="padding-top: 2pt;text-indent: 0pt;text-align: right;">- A Better Style</h2><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;">Up to now, we haven’t really been able to appreciate the possibilities of <b>functional programming (FP)</b><span>as it pertains to working in a higher-level, declarative fashion. In this chapter, we will correct this and<br/>start producing shorter, more concise, and easier-to-understand code, by using some </span><b>higher-order</b>that is, functions that take functions as parameters, such as the following:</p><ul id="l51"><li data-list-text="•"><p class="s33" style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;line-height: 123%;text-align: left;">	<span class="p">reduce () and reduceRight () to apply an operation to a whole array, reducing it to<br/>a single result</span></p></li><li data-list-text="•"><p style="padding-top: 5pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">map () to transform one array into another by applying a function to each of its elements</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">f 1 at () to make a single array out of an array of arrays</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">flatMapO to mix together mapping and flattening</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 43pt;text-indent: 13pt;line-height: 211%;text-align: left;"><span>f orEach () to simplify writing loops by abstracting the necessary looping code<br/>We’ll also be able to perform searches and selections with the following:</span></p></li><li data-list-text="•"><p style="padding-left: 70pt;text-indent: -13pt;text-align: left;">filter () to pick some elements from an array</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">f ind () and f indlndex () to search for elements that satisfy a condition</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">A pair of predicates, every () and some (), to check an array for a Boolean test</p></li></ul></li></ol></ol><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Using these functions will let you work more declaratively, and you’ll see that your focus will shift to<br/>what you need to do and not so much to how it’s going to be done; the dirty details are hidden inside<br/>our functions. Instead of writing a series of possibly nested loops, we’ll focus on using functions as<br/>building blocks to specify our desired result.</span></p><p style="padding-top: 7pt;padding-left: 41pt;text-indent: 1pt;line-height: 123%;text-align: justify;">We will use these functions to work with events in a declarative style, as we’ll see in <i>Chapter 11,</i>when we use the <b>observer </b><span>pattern. We will also be able to work in a<br/></span><i>fluent </i><span>fashion, in which the output of a function becomes the input of the next one, a style we will<br/>look at later.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 21pt;text-indent: 0pt;text-align: left;">112  Programming Declaratively - A Better Style</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;text-align: left;"><a name="bookmark174">Transformations</a></p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>The first set of operations that we are going to consider works on an array and processes it in the<br/>base of a function to produce certain results. There are several possible results: a single value with the<br/>reduce () operation, a new array with map (), or just about any kind of result with f orEach ().</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-top: 5pt;padding-left: 66pt;text-indent: 0pt;text-align: justify;"><a name="bookmark175">Caring about inefficiency</a></p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;line-height: 115%;text-align: justify;"><span>If you google around, you will find some articles declaring that these functions are inefficient<br/>because a loop done by hand can be faster. This, while possibly true, is practically irrelevant.<br/>Unless your code really suffers from speed problems and you can determine that the slowness<br/>derives from using these HOFs, trying to avoid them using longer code, with a higher probability<br/>of bugs, simply doesn’t make much sense.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Let’s start by considering the preceding list of functions in order, beginning with the most general<br/>of all, which, as we’ll see, can even be used to emulate the rest of the transformations in this chapter!</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 53pt;text-indent: 0pt;text-align: left;"><a name="bookmark176">Reducing an array to a value</a></p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Answer this question: how many times have you had to loop through an array, performing an operation<br/>(say, summing) to produce a single value (maybe the sum of all the array values) as a result? Probably<br/>many, many, many times. This kind of operation can usually be implemented functionally by applying<br/>reduce () and reduceRight (). Let’s start with the former!</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 65pt;text-indent: 0pt;text-align: left;"><a name="bookmark177">To fold or not to fold</a></p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;line-height: 115%;text-align: left;">Time for some terminology! In usual FP parlance, we speak of <b>folding operations: </b><span>reduce ()<br/>is </span><b>foldl </b>(for <i>fold left) </i>or just plain <b>fold, </b><span>and reduceRight () is correspondingly known as<br/></span><b>foldr. </b>In category theory terms, both operations are <b>catamorphisms: </b><span>the reduction of all the<br/>values in a container down to a single result.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;text-align: justify;">The inner workings of the reduce () function are illustrated in <i>Figure 5.1:</i></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="295" height="253" alt="image" src="Image_020.gif"/></span></p><p style="padding-top: 13pt;padding-left: 378pt;text-indent: 0pt;text-align: left;">Transformations  113</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s185" style="padding-left: 342pt;text-indent: 2pt;text-align: left;"><span>final<br/>result</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 149pt;text-indent: 0pt;text-align: left;">Figure 5.1 -The workings of the reduceO operation</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: justify;"><span>See how reduce () traverses the array, applying a reducing function to each element and the<br/>accumulated value.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Why should you always try to use reduce () or reduceRight () instead of hand-coded loops?<br/>The following points might answer this question:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l52"><li data-list-text="•"><p class="s33" style="padding-left: 70pt;text-indent: -13pt;line-height: 123%;text-align: left;">	<span class="p">All the aspects of loop control are automatically taken care of, so you don’t even have the<br/>possibility of an off-by-one mistake</span></p></li><li data-list-text="•"><p style="padding-top: 5pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">The initialization and handling of the result values are also done implicitly</p></li><li data-list-text="•"><p class="s33" style="padding-top: 8pt;padding-left: 70pt;text-indent: -12pt;line-height: 123%;text-align: left;">	<span class="p">Unless you work really hard at being impure and modifying the original array, your code will<br/>be free of side-effects</span></p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: justify;">Now that we can reduce () an array, let’s see some of its practical use cases.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s34" style="padding-left: 43pt;text-indent: 0pt;text-align: justify;">Summing an array</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>The most common example of the application of reduce (), usually seen in all textbooks and on<br/>all web pages, is the summing of all of the elements of an array. So, to keep with tradition, let’s start<br/>with precisely this example!</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;">To reduce an array, you must provide a <b>dyadic </b>function (a function with two parameters; <b>binary </b><span>would<br/>be another name for that) and an initial value. In our case, the function will sum up its two arguments.<br/>Initially, the function will be applied to the provided initial value and the first element of the array.<br/>For us, the initial value to provide is a zero, and the first result will be the first element itself. Then,</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 21pt;text-indent: 0pt;text-align: left;">114  Programming Declaratively - A Better Style</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>the function will be applied again, this time, to the result of the previous operation and the second<br/>element of the array, and so the second result will be the sum of the first two elements of the array.<br/>Progressing in this fashion along the whole array, the final result will be the sum of all its elements:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// sum.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">const myArray = [22, 9, 60, 12, 4, 56];</p><p style="padding-top: 3pt;padding-left: 61pt;text-indent: 0pt;line-height: 30pt;text-align: left;"><span>const sum = (x: number, y: number): number =&gt; x + y;<br/>const mySum = myArray.reduce(</span><b>sum, 0); </b>// 163</p><p style="padding-top: 8pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">You don’t actually need the sum definition—you could have just written myArray. reduce ( (x, y)</p><p style="padding-top: 2pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">= &gt; x+y, 0) —however, when written in this fashion, the meaning of the code is clearer: you want</p><p style="padding-top: 2pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>to reduce the array to a single value by sum-ming all its elements. (Would we be forgetting data types<br/>with this? No; TypeScript can deduce all the implied types on its own.)</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Instead of writing out the loop, initializing a variable to hold the result of the calculations, and going<br/>through the array doing the sums, you just declare which operation should be performed. This is what<br/>I meant when I said that programming with functions such as those we’ll see in this chapter allows<br/>you to work more declaratively, focusing on what rather than how.</span></p><p style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>You can also even use reduce () without providing the initial value: if you skip it, the first value of<br/>the array will be used, and the internal loop will start with the second element of the array; however,<br/>be careful if the array is empty and you skipped providing an initial value, as you’ll get a runtime<br/>error!   See   developer   .   mozilla   .   org/en-US/docs/Web/JavaScript/Ref   erence/<br/>Global_Obj ects/Array/Reduce for more details.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>We can change the reducing function to see how it progresses through its calculations by just including<br/>a little bit of impurity!</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">const sumAndLog = (x: number, y: number): number = &gt; {</p><p class="s10" style="padding-top: 4pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">console.log(&#39;${x}+${y}=${x + y}*);</p><p style="padding-top: 4pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">return x+y;</p><p style="padding-top: 6pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">};</p><p style="padding-top: 2pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">myArray.reduce(sumAndLog, 0);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 378pt;text-indent: 0pt;text-align: left;">Transformations  115</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: justify;">The output would be as follows:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 53pt;text-indent: 0pt;text-align: left;">0+22=22</p><p class="s10" style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">22+9=31</p><p class="s10" style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">31+60=91</p><p class="s10" style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">91+12=103</p><p class="s10" style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">103+4=107</p><p class="s10" style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">107+56=163</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 126%;text-align: justify;"><span>You can see how the first sum was done by adding the initial value (0) and the first element of the<br/>array, how that result was used in the second addition, and so on.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 56pt;text-indent: 0pt;text-align: justify;"><a name="bookmark178">What’s in a name?</a></p><p style="padding-top: 4pt;padding-left: 56pt;text-indent: 0pt;line-height: 115%;text-align: justify;">Part of the reason for the <i>foldl </i><span>name seen previously (at least, its ending, /) should now be<br/>clear: the reducing operation proceeds from left to right, from the first element to the last. You<br/>may wonder, however, how it would have been named if it had been defined by a right-to-left<br/>language (such as Arabic, Hebrew, Farsi, or Urdu) speaker!</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: justify;"><span>This example is common and well known; let’s do something more complicated. As we’ll find out,<br/>reduce () will be quite useful for many different objectives!</span></p><p class="s34" style="padding-top: 8pt;padding-left: 43pt;text-indent: 0pt;text-align: justify;">Calculating an average</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Let’s do a bit more work. How do you calculate the average of a list of numbers? If you were explaining<br/>this to someone, your answer would surely be something such as </span><i>sum all the elements in the list and</i><span>In programming terms, this is not a procedural description<br/>(you don’t explain how to sum elements or traverse the array) but rather a declarative one since you<br/>say what to do, not how.</span></p><p style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>We can transform that description of the calculation into an almost self-explanatory function (In<br/>the </span><i>Averaging arrays </i><span>section of the next chapter, we’U extend arrays to include an averaging method,<br/>based on this code.):</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: justify;">// average.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">const myArray = [22, 9, 60, 12, 4, 56] ;</p><p style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">const sum = (x: number, y: number): number =&gt; x + y;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">const average = (arr: number!]): number =&gt;</p><p class="s10" style="padding-top: 4pt;padding-left: 64pt;text-indent: 0pt;text-align: left;">arr.reduce(sum, 0) / arr.length;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 8pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">console.log(average(myArray)); // 27.166667</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 21pt;text-indent: 0pt;text-align: left;">116  Programming Declaratively - A Better Style</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>The definition of average () follows what a verbal explanation would be: sum the elements of the<br/>array, starting from 0, and divide by the arrays length—simpler: impossible!</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 65pt;text-indent: 0pt;text-align: left;"><a name="bookmark179">Not-so-safe reducing</a></p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;line-height: 114%;text-align: left;"><span>As we mentioned in the previous section, you could also have written arr. reduce (sum)<br/>without specifying the initial value (0) for the reduction; it’s even shorter and closer to the<br/>verbal description of the required calculation. This, however, is less safe, because it would fail<br/>(producing a runtime error) should the array be empty. So, it’s better to always provide the<br/>starting value.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>This isn’t, however, the only way of calculating the average. The reducing function also gets passed<br/>the index of the current position of the array as well as the array itself, so you could do something<br/>different from last time:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 74pt;text-indent: -12pt;line-height: 141%;text-align: justify;"><span>const sumOrDivide = (<br/>sum: number,</span></p><p style="padding-left: 73pt;text-indent: 0pt;line-height: 144%;text-align: justify;"><span>val: number,<br/>ind: number,<br/>arr: number!]</span></p><p style="padding-top: 2pt;padding-left: 62pt;text-indent: 0pt;text-align: justify;">) =&gt; {</p><p style="padding-top: 2pt;padding-left: 74pt;text-indent: 0pt;text-align: justify;">sum += val;</p><p style="padding-top: 4pt;padding-left: 73pt;text-indent: 0pt;text-align: justify;">return <b>ind == arr.length - 1 ? sum / arr.length : sum;</b></p><p style="padding-top: 6pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">};</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 5pt;padding-left: 73pt;text-indent: -12pt;line-height: 144%;text-align: left;"><span>const averages = (arr: number!]): number =&gt;<br/>arr.reduce(sumOrDivide, 0);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;text-align: left;">console.log(myArray.reduce(averages, 0)); // 27.166667</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>Given the current index (and, obviously, having access to the array’s length), we can do some trickery:<br/>in this case, our reducing sumOrDivide () function always sums values, but at the end of the array,</span></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>it throws in a division so that the average value of the array will be returned. This is slick, but from the<br/>point of view of legibility, we can agree that the first version we saw was more declarative and closer<br/>to the mathematical definition than this second version.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 12pt;padding-left: 378pt;text-indent: 0pt;text-align: left;">Transformations  117</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 57pt;text-indent: 0pt;text-align: left;"><a name="bookmark180">Impurity warning!</a></p><p style="padding-top: 4pt;padding-left: 56pt;text-indent: 0pt;line-height: 115%;text-align: left;"><span>Getting the array and the index means you could also turn the function into an impure one.<br/>Avoid this! Anybody who sees a reduce () call will automatically assume it’s a pure function<br/>and will surely introduce bugs when using it.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 126%;text-align: justify;"><span>This example and the previous one required calculating a single result, but it’s possible to go beyond<br/>this and calculate several values in a single pass. Let’s see how.</span></p><p class="s34" style="padding-top: 8pt;padding-left: 43pt;text-indent: 0pt;text-align: justify;">Calculating several values at once</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>What would you do if you needed to calculate two or more results instead of a single value? This would<br/>seem to be a case for providing a clear advantage for standard loops, but there’s a trick that you can<br/>use. Let’s yet again revisit the average calculation. We could do it the old-fashioned way by looping<br/>and simultaneously summing and counting all the numbers. Well, reduce () only lets you produce<br/>a single result, but there’s no reason you can’t return an object with as many fields as desired, as we<br/>did in the </span><i>Impure functions </i>section in <i>Chapter 4, Behaving Properly:</i></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s9" style="padding-left: 53pt;text-indent: 0pt;text-align: left;">11 <span class="p">continued...</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 64pt;text-indent: -12pt;line-height: 144%;text-align: left;"><span>const averages = (arr: number!]): number =&gt; {<br/>const sc = arr.reduce(</span></p><p class="s10" style="padding-left: 78pt;text-indent: 0pt;line-height: 10pt;text-align: left;">(ac, val) =&gt; ({</p><p class="s10" style="padding-top: 4pt;padding-left: 88pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>sum: val + ac.sum,<br/>count: ac.count + 1,</span></p><p class="s10" style="padding-top: 2pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">}),</p><p class="s10" style="padding-top: 2pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">{ sum: 0, count: 0 }</p><p style="padding-top: 5pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">) ;</p><p style="padding-top: 3pt;padding-left: 64pt;text-indent: 0pt;text-align: left;">return <b>sc.sum / sc.count;</b></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">console.log(averages(myArray)); // 27.166667</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Scrutinize the code carefully. We need two variables: one for the sum and one for the count of all<br/>numbers. We provide an object as the initial value for the accumulator, with two properties set to 0,<br/>and our reducing function updates those two properties. After getting the final result with both sum<br/>and count, we divide to get the desired average.</span></p><p style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>By the way, there are options other than using an object. You could also produce any other data<br/>structure; let’s see an example with a tuple. The resemblance is pretty obvious:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 21pt;text-indent: 0pt;text-align: left;">118  Programming Declaratively - A Better Style</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 73pt;text-indent: -12pt;line-height: 146%;text-align: left;"><span>const  average4  =  (arr:  number  [])  =&gt;  {<br/>const sc = arr.reduce(</span></p><p class="s10" style="padding-left: 88pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>(ac,  val)  =&gt;  [ac[0]  +  val,  ac[1]  +  1],<br/>[0,                             0]</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 73pt;text-indent: 0pt;text-align: left;"><a name="bookmark181">return </a><b>sc [0] / sc [1] ;</b></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;text-align: left;">console.log(average4(myArray)); // 27.166667</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>To be frank, I think it’s way more obscure than the solution with the object. Consider this an alternative<br/>(and not well-recommended) way of calculating many values simultaneously!</span></p><p style="padding-top: 7pt;padding-left: 53pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>We have now seen several examples of the use of reduce (), so it’s high time to meet a variant of it,<br/>reduceRight (), which works similarly.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s34" style="padding-left: 52pt;text-indent: 0pt;text-align: justify;">Folding left and right</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>The complementary reduceRight () method works just as reduce () does, only starting at the end<br/>and looping until the beginning of the array. (Read more about reduceRight () at developer.<br/>mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Obj                 ects/Array/<br/>ReduceRight.) For many operations (such as the calculation of averages that we saw previously),<br/>this makes no difference, but there are some cases in which it will. See </span><i>Figure 5.2.</i></p><p style="padding-top: 7pt;padding-bottom: 4pt;padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: justify;">We shall be seeing a clear case of this in <i>Chapter 8, Connecting Functions-, </i><span>let’s go with a simpler<br/>example here:</span></p><p style="padding-left: 145pt;text-indent: 0pt;text-align: left;"><span><img width="281" height="231" alt="image" src="Image_021.gif"/></span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 77pt;text-indent: 0pt;text-align: left;">Figure 5.2 - The reduceRightO operation works the same way as reduced, but in reverse order</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 378pt;text-indent: 0pt;text-align: left;">Transformations  119</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Suppose that we want to implement a function to reverse a string. (And, obviously, also that we don’t<br/>know that JavaScript already provides a reverse () method!) A solution could be to transform<br/>the string into an array by using split (), then reversing that array, and finally using j oin () to<br/>make it whole again:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// reverse.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 65pt;text-indent: -12pt;line-height: 146%;text-align: left;"><span>const reversestring = (str: string): string =&gt; {<br/>const arr = str.split(&quot;&quot;);</span></p><p style="padding-left: 64pt;text-indent: 0pt;line-height: 10pt;text-align: left;">arr.reverse();</p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">return arr.j oin(&quot;&quot;) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">console.log(reversestring(&quot;MONTEVIDEO&quot;));           // OEDIVETNOM</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>This solution works (and yes, it can be shortened, but that’s not the point here), but let’s do it in another<br/>way, just to experiment with reduceRight ():</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s9" style="padding-left: 53pt;text-indent: 0pt;text-align: left;">I/ <span class="p">continued...</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">const reverseString2 = (str: string): string = &gt;</p><p class="s10" style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">str.split(&quot;&quot;).reduceRight((x, y) =&gt; x + y, &quot;&quot;);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">console.log(reverseString2(&quot;OEDIVETNOM&quot;)); // MONTEVIDEO</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Note that we didn’t need to specify data types for the reducing function; just like earlier in this chapter,<br/>TypeScript was able to figure them out. Also, if you like to re-use code, look at Question 5.2!</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>From the previous examples, you can also get an idea: if you first apply reverse () to an array and<br/>then use reduce (), the effect will be the same as if you had just applied reduceRight () to the<br/>original array. There is only one point to take into account: reverse () alters the given array, so<br/>you would be causing an unintended side-effect by reversing the original array! The only way out<br/>would be to first generate a copy of the array and only then do the rest. Too much work, so it’s best<br/>to use reduceRight ()!</span></p><p style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>However, we can draw another conclusion, showing a result we had foretold: it is possible, albeit more<br/>cumbersome, to use reduce () to simulate the same result as reduceRight () —and in later<br/>sections, we’ll also use it to emulate the other functions in the chapter. Let’s now move on to another<br/>common and powerful operation: </span><b>mapping.</b></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 21pt;text-indent: 0pt;text-align: left;">120  Programming Declaratively - A Better Style</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-top: 5pt;padding-left: 52pt;text-indent: 0pt;text-align: justify;"><a name="bookmark182">Applying an operation - map()</a></p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Processing lists of elements and applying some kind of operation to each of them is a quite common<br/>pattern in computer programming. Writing loops that systematically go through all the elements in<br/>an array or collection, starting at the first and looping until finishing with the last, and performing<br/>some kind of process on each of them is a basic coding exercise, usually learned in the first days of<br/>all programming courses. We already saw one such kind of operation in the previous section with<br/>reduce () and reduceRight (); let’s now turn to a new one, called map ().</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;">In mathematics, a <b>map </b><span>is a transformation of elements from a domain into elements of a codomain.<br/>For example, you might transform numbers into strings or strings into numbers, but also numbers into<br/>numbers, or strings into strings: the important point is that you have a way to transform an element<br/>of  the first </span><b>kind </b>or <b>domain </b>(think <b>type, </b>if it helps) into an element of the second kind, or <b>codomain.</b><span>In our case, this will mean taking the elements of an array and applying a function to each of them<br/>to produce a new array. In more computer-like terms, the map () function transforms an array of<br/>inputs into an array of outputs.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 65pt;text-indent: 0pt;text-align: justify;"><a name="bookmark183">Names, names, names...</a></p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;line-height: 115%;text-align: justify;">Some more terminology: we would say that an array is a <b>functor </b><span>because it provides a mapping<br/>operation with some prespecified properties, which we shall see later. And, in category theory,<br/>which we’ll talk about a little in </span><i>Chapter 12, Building Better Containers, </i><span>the mapping operation<br/>itself would be called a </span><b>morphism.</b></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;text-align: justify;">The inner workings of the map () operation can be seen in <i>Figure 5.3:</i></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="202" height="278" alt="image" src="Image_022.gif"/></span></p><p class="s186" style="padding-left: 167pt;text-indent: 1pt;line-height: 94%;text-align: left;"><span>input<br/>array</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s186" style="padding-top: 7pt;padding-left: 169pt;text-indent: -3pt;text-align: left;"><span>output<br/>array</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 171pt;text-indent: -36pt;line-height: 137%;text-align: left;"><span>Figure 5.3 -The map() operation transforms each element of the<br/>input array by applying a mapping function</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 378pt;text-indent: 0pt;text-align: left;">Transformations  121</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 56pt;text-indent: 0pt;text-align: justify;"><a name="bookmark184">More maps available</a></p><p style="padding-top: 4pt;padding-left: 56pt;text-indent: 0pt;line-height: 115%;text-align: justify;"><span>The jQuery library provides a function, $ . map (array, callback), that is similar to<br/>the map () method. Be careful, though, because there are important differences. The jQuery<br/>function processes the undefined values of the array, while map () skips them. Also, if the<br/>applied function produces an array as its result, jQuery flattens it and adds each of its individual<br/>elements separately, while map () just includes those arrays in the result. Underscore, and<br/>Ramda also provide similar functions. Finally, JavaScript itself provides an alternative way of<br/>doing  map  ():  check  out  the  Array. from  ()  method  at  developer .  mozilla  .  org/<br/>en-US/docs/Web/JavaScript/Reference/Global_Obj                 ects/Array/from<br/>and pay special attention to its second argument!</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;text-align: left;">What are the advantages of using map () over using a straightforward loop?</p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l53"><li data-list-text="•"><p style="padding-left: 71pt;text-indent: -14pt;text-align: left;">First, you don’t have to write any loops, so that’s one less possible source of bugs</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;line-height: 123%;text-align: left;"><span>Second, you don’t even have to access the original array or the index position, even though<br/>they are there for you to use if you really need them</span></p></li><li data-list-text="•"><p style="padding-top: 5pt;padding-left: 70pt;text-indent: -12pt;line-height: 125%;text-align: left;"><span>Lastly, a new array is produced, so your code is pure (although, of course, if you really want to<br/>produce side effects, you can!)</span></p><p style="padding-top: 8pt;padding-left: 43pt;text-indent: 0pt;text-align: left;">There are only two caveats when doing this:</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="•"><p class="s33" style="padding-left: 70pt;text-indent: -12pt;line-height: 124%;text-align: justify;">	<span class="p">Always return something from your mapping function. If you forget this, then you’ll just<br/>produce an array filled with undefined values, because JavaScript always provides a default<br/>return undefined for all functions.</span></p></li><li data-list-text="•"><p style="padding-top: 5pt;padding-left: 70pt;text-indent: -13pt;line-height: 123%;text-align: justify;"><span>If the input array elements are objects or arrays, and you include them in the output array, then<br/>JavaScript will still allow the original elements to be accessed.</span></p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Also, there’s a restriction. In JavaScript, map () is basically available only for arrays (you can read more<br/>about   this   at   developer   .mozilla.   org/en-US/docs/Web/JavaScript/Ref   erence/<br/>Global_Obj  ect  s/Array/map);  however,  in  the  </span><i>Extending  current  data  types  </i><span>section  in<br/></span><i>Chapter 12, Building Better Containers, </i><span>we will learn how to make it available for other basic types,<br/>such as numbers, Booleans, strings, and even functions. Also, libraries such as Lodash, Underscore,<br/>and Ramda, provide similar functionalities.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>As we did earlier with reduce (), let’s now look at some examples of the use of map () for common<br/>processes so that you’ll better appreciate its power and convenience.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s34" style="padding-left: 43pt;text-indent: 0pt;text-align: justify;">Extracting data from objects</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Let’s start with a simple example. Suppose that we have some geographic data (as shown in the following<br/>snippet) related to some South American countries and the coordinates (latitude and longitude) of<br/>their capitals. Let’s say that we want to calculate the average position of those cities. (No, I don’t have<br/>a clue why we’d want to do that.) How would we go about it?</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 21pt;text-indent: 0pt;text-align: left;">122  Programming Declaratively - A Better Style</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 50pt;text-indent: 0pt;line-height: 1pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"><br/></p><table style="border-collapse:collapse;margin-left:59.38pt" cellspacing="0"><tr style="height:20pt"><td style="width:62pt"><p class="s29" style="padding-left: 2pt;text-indent: 0pt;line-height: 10pt;text-align: left;">// average.ts</p></td><td style="width:34pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:25pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:45pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:28pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:40pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:23pt"><td style="width:62pt"><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s29" style="padding-left: 2pt;text-indent: 0pt;text-align: left;">const markers =</p></td><td style="width:34pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:25pt"><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s29" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">[</p></td><td style="width:45pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:28pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:40pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:15pt"><td style="width:62pt"><p class="s29" style="padding-top: 1pt;padding-left: 15pt;text-indent: 0pt;text-align: left;">{ name:</p></td><td style="width:34pt"><p class="s29" style="padding-top: 1pt;padding-right: 6pt;text-indent: 0pt;text-align: center;">&quot;AR&quot; ,</p></td><td style="width:25pt"><p class="s29" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">lat:</p></td><td style="width:45pt"><p class="s29" style="padding-top: 1pt;padding-left: 8pt;text-indent: 0pt;text-align: left;">-34.6,</p></td><td style="width:28pt"><p class="s29" style="padding-top: 1pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">Ion:</p></td><td style="width:40pt"><p class="s29" style="padding-top: 1pt;padding-left: 5pt;padding-right: 1pt;text-indent: 0pt;text-align: center;">-58.4 } ,</p></td></tr><tr style="height:15pt"><td style="width:62pt"><p class="s29" style="padding-top: 2pt;padding-left: 15pt;text-indent: 0pt;text-align: left;">{ name:</p></td><td style="width:34pt"><p class="s29" style="padding-top: 2pt;padding-right: 6pt;text-indent: 0pt;text-align: center;">&quot;BO&quot; ,</p></td><td style="width:25pt"><p class="s29" style="padding-top: 2pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">lat :</p></td><td style="width:45pt"><p class="s29" style="padding-top: 2pt;padding-left: 8pt;text-indent: 0pt;text-align: left;">-16.5,</p></td><td style="width:28pt"><p class="s29" style="padding-top: 2pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">Ion:</p></td><td style="width:40pt"><p class="s29" style="padding-top: 2pt;padding-left: 5pt;padding-right: 1pt;text-indent: 0pt;text-align: center;">-68.1 } ,</p></td></tr><tr style="height:15pt"><td style="width:62pt"><p class="s29" style="padding-top: 2pt;padding-left: 15pt;text-indent: 0pt;text-align: left;">{ name:</p></td><td style="width:34pt"><p class="s29" style="padding-top: 2pt;padding-right: 6pt;text-indent: 0pt;text-align: center;">&quot;BR&quot; ,</p></td><td style="width:25pt"><p class="s29" style="padding-top: 2pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">lat :</p></td><td style="width:45pt"><p class="s29" style="padding-top: 2pt;padding-left: 8pt;text-indent: 0pt;text-align: left;">-15.8,</p></td><td style="width:28pt"><p class="s29" style="padding-top: 2pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">Ion:</p></td><td style="width:40pt"><p class="s29" style="padding-top: 2pt;padding-left: 5pt;padding-right: 1pt;text-indent: 0pt;text-align: center;">-47.9 } ,</p></td></tr><tr style="height:15pt"><td style="width:62pt"><p class="s29" style="padding-top: 2pt;padding-left: 15pt;text-indent: 0pt;text-align: left;">{ name:</p></td><td style="width:34pt"><p class="s29" style="padding-top: 1pt;padding-right: 7pt;text-indent: 0pt;text-align: center;">&quot;CL&quot; ,</p></td><td style="width:25pt"><p class="s29" style="padding-top: 2pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">lat :</p></td><td style="width:45pt"><p class="s29" style="padding-top: 1pt;padding-left: 8pt;text-indent: 0pt;text-align: left;">-33.4,</p></td><td style="width:28pt"><p class="s29" style="padding-top: 1pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">Ion:</p></td><td style="width:40pt"><p class="s29" style="padding-top: 1pt;padding-left: 5pt;padding-right: 1pt;text-indent: 0pt;text-align: center;">-70.7 } ,</p></td></tr><tr style="height:15pt"><td style="width:62pt"><p class="s29" style="padding-top: 2pt;padding-left: 15pt;text-indent: 0pt;text-align: left;">{ name:</p></td><td style="width:34pt"><p class="s29" style="padding-top: 2pt;padding-right: 6pt;text-indent: 0pt;text-align: center;">&quot;CO&quot; ,</p></td><td style="width:25pt"><p class="s29" style="padding-top: 2pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">lat:</p></td><td style="width:45pt"><p class="s29" style="padding-top: 2pt;padding-left: 27pt;text-indent: 0pt;text-align: left;">4.6,</p></td><td style="width:28pt"><p class="s29" style="padding-top: 1pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">Ion:</p></td><td style="width:40pt"><p class="s29" style="padding-top: 2pt;padding-left: 5pt;padding-right: 1pt;text-indent: 0pt;text-align: center;">-74.0 } ,</p></td></tr><tr style="height:15pt"><td style="width:62pt"><p class="s29" style="padding-top: 1pt;padding-left: 15pt;text-indent: 0pt;text-align: left;">{ name:</p></td><td style="width:34pt"><p class="s29" style="padding-top: 2pt;padding-right: 7pt;text-indent: 0pt;text-align: center;">&quot;EC&quot; ,</p></td><td style="width:25pt"><p class="s29" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">lat :</p></td><td style="width:45pt"><p class="s29" style="padding-top: 2pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">-0.3,</p></td><td style="width:28pt"><p class="s29" style="padding-top: 1pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">Ion :</p></td><td style="width:40pt"><p class="s29" style="padding-top: 1pt;padding-left: 5pt;padding-right: 1pt;text-indent: 0pt;text-align: center;">-78.6 } ,</p></td></tr><tr style="height:14pt"><td style="width:62pt"><p class="s29" style="padding-top: 1pt;padding-left: 15pt;text-indent: 0pt;text-align: left;">{ name:</p></td><td style="width:34pt"><p class="s29" style="padding-top: 1pt;padding-right: 8pt;text-indent: 0pt;text-align: center;">&quot;PE&quot; ,</p></td><td style="width:25pt"><p class="s29" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">lat :</p></td><td style="width:45pt"><p class="s29" style="padding-top: 1pt;padding-left: 8pt;text-indent: 0pt;text-align: left;">-12.0,</p></td><td style="width:28pt"><p class="s29" style="padding-top: 1pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">Ion :</p></td><td style="width:40pt"><p class="s29" style="padding-top: 1pt;padding-left: 5pt;padding-right: 1pt;text-indent: 0pt;text-align: center;">-77.0 } ,</p></td></tr><tr style="height:16pt"><td style="width:62pt"><p class="s29" style="padding-top: 3pt;padding-left: 15pt;text-indent: 0pt;text-align: left;">{ name:</p></td><td style="width:34pt"><p class="s29" style="padding-top: 1pt;padding-right: 6pt;text-indent: 0pt;text-align: center;">ii p <span class="s187">Y </span>&quot;</p></td><td style="width:25pt"><p class="s29" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">lat :</p></td><td style="width:45pt"><p class="s29" style="padding-top: 3pt;padding-left: 8pt;text-indent: 0pt;text-align: left;">-25.2,</p></td><td style="width:28pt"><p class="s29" style="padding-top: 3pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">Ion:</p></td><td style="width:40pt"><p class="s29" style="padding-top: 3pt;padding-left: 3pt;padding-right: 1pt;text-indent: 0pt;text-align: center;">-57.5 },</p></td></tr><tr style="height:15pt"><td style="width:62pt"><p class="s29" style="padding-top: 2pt;padding-left: 15pt;text-indent: 0pt;text-align: left;">{ name:</p></td><td style="width:34pt"><p class="s29" style="padding-top: 1pt;padding-right: 1pt;text-indent: 0pt;text-align: center;">&quot; UY &quot; ,</p></td><td style="width:25pt"><p class="s29" style="padding-top: 2pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">lat :</p></td><td style="width:45pt"><p class="s29" style="padding-top: 1pt;padding-left: 8pt;text-indent: 0pt;text-align: left;">-34.9,</p></td><td style="width:28pt"><p class="s29" style="padding-top: 1pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">Ion:</p></td><td style="width:40pt"><p class="s29" style="padding-top: 1pt;padding-left: 3pt;padding-right: 1pt;text-indent: 0pt;text-align: center;">-56.2 },</p></td></tr><tr style="height:13pt"><td style="width:62pt"><p class="s29" style="padding-top: 1pt;padding-left: 15pt;text-indent: 0pt;line-height: 10pt;text-align: left;">{ name:</p></td><td style="width:34pt"><p class="s29" style="padding-top: 1pt;padding-right: 2pt;text-indent: 0pt;line-height: 10pt;text-align: center;">&quot; VE &quot; ,</p></td><td style="width:25pt"><p class="s29" style="padding-top: 2pt;padding-left: 2pt;text-indent: 0pt;line-height: 9pt;text-align: left;">lat :</p></td><td style="width:45pt"><p class="s29" style="padding-top: 2pt;padding-left: 13pt;text-indent: 0pt;line-height: 9pt;text-align: left;">10.5,</p></td><td style="width:28pt"><p class="s29" style="padding-top: 1pt;padding-left: 4pt;text-indent: 0pt;line-height: 10pt;text-align: left;">Ion:</p></td><td style="width:40pt"><p class="s29" style="padding-top: 2pt;padding-left: 5pt;padding-right: 1pt;text-indent: 0pt;line-height: 9pt;text-align: center;">-66.9 } ,</p></td></tr></table><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 65pt;text-indent: 0pt;text-align: left;"><a name="bookmark185">A lot of negativity?</a></p><p style="padding-top: 4pt;padding-left: 66pt;text-indent: 0pt;line-height: 115%;text-align: left;"><span>In case you are wondering whether all the data is negative and if so, why, it’s because the countries<br/>shown here are all south of the Equator and west of the Greenwich Meridian. However, some<br/>South American countries, such as Colombia and Venezuela, have positive latitudes. We’ll</span></p><p style="padding-left: 65pt;text-indent: 0pt;line-height: 10pt;text-align: left;">return to these data a little later when we study the some () and every () methods.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 8pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>We would want to use our average () function (which we developed earlier in this chapter), but<br/>there is a problem: that function can only be applied to an array of </span><i>numbers, </i><span>and what we have here<br/>is an array of </span><i>objects. </i><span>We can, however, do a trick: we can focus on calculating the average latitude<br/>(we can deal with the longitude later, in a similar fashion). We can map each element of the array to<br/>its latitude, and we would then have an appropriate input for average (). The solution would be<br/>something like the following:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">const averageLat = average<b>(markers.map((x) =&gt; x.lat));</b></p><p style="padding-top: 4pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">const averageLon = average<b>(markers.map((x) =&gt; x.lon));</b></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 8pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">console.log(averageLat, averageLon); // -15.76, -65.53</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>Mapping an array to extract data is powerful, but you must be careful. Let’s now look at a case that<br/>seems right but produces incorrect results!</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 378pt;text-indent: 0pt;text-align: left;">Transformations  123</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s34" style="padding-top: 8pt;padding-left: 43pt;text-indent: 0pt;text-align: justify;">Parsing numbers tacitly</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Working with map () is usually far safer and simpler than looping by hand, but some edge cases may<br/>trip you up. Say you received an array of strings representing numeric values and wanted to parse<br/>them into actual numbers. Can you explain the following results?</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 55pt;text-indent: 0pt;text-align: left;">[&quot;123.45&quot;, &quot;67.8&quot;, &quot;90&quot;].map(parseFloat);</p><p style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// [123.45, 67.8, 90]</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 55pt;text-indent: 0pt;text-align: left;">[&quot;123.45&quot;, &quot;-67.8&quot;, &quot; 90 &quot; ] .map(parselnt) ;</p><p style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// [123, <b>NaN, NaN]</b></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Let’s analyze the results. When we used parseFloat () to get floating-point results, everything<br/>was OK; however, when we wanted to truncate the results to integer values with parselnt (), the<br/>output was really awry, and weird NaN values appeared. What happened?</span></p><p style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>The answer lies in a problem with tacit programming. (We have already seen some uses of tacit<br/>programming in the </span><i>An unnecessary mistake </i>section of <i>Chapter 3, Starting Out with Functions, </i><span>and<br/>we’ll see more in </span><i>Chapter 8, Connecting Functions.) </i><span>When you don’t explicitly show the parameters<br/>to a function, it’s easy for there to be oversights. Look at the following code, which will lead us to<br/>the solution:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 55pt;text-indent: 0pt;text-align: left;">[&quot;123.45&quot;,         &quot;-67.8&quot;, &quot;90&quot;].map(<b>(x) =&gt; parseFloat(x) ) ;</b></p><p style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// [123.45, -67.8, 90]</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 55pt;text-indent: 0pt;text-align: left;">[&quot;123.45&quot;, &quot;-67.8&quot;, &quot; 90 &quot; ] .map(<b>(x) =&gt; parselnt(x) ) ;</b></p><p style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// [123, -67, 90]</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>The reason for the unexpected behavior with parselnt () is that this function can also receive<br/>a second parameter—namely, the radix to use when converting the string into a number. For instance,<br/>a call such as parselnt (&quot;100010100001&quot;, 2) will convert a binary number of 100010100001<br/>into a decimal.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 56pt;text-indent: 0pt;text-align: left;"><a name="bookmark186">Note:</a></p><p style="padding-top: 4pt;padding-left: 57pt;text-indent: 0pt;line-height: 115%;text-align: justify;"><span>You  can  read  more  about  parselnt  ()  at  developer  .  mozilla.  org/en/docs/Web/<br/>JavaScript/Ref  erence/Global_Obj  ects/parselnt,  where  the  radix  parameter<br/>is   explained in detail. You should always provide it because some browsers might interpret<br/>strings with a leading zero to be octal, which would once again produce unwanted results.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>So, what happens when we provide parselnt () to map () ? Remember that map () calls your<br/>mapping function with three parameters: the array element value, its index, and the array itself. When<br/>parselnt receives these values, it ignores the array but assumes that the provided index is actually a<br/>radix, and NaN values are produced since the original strings are not valid numbers in the given radix.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 21pt;text-indent: 0pt;text-align: left;">124  Programming Declaratively - A Better Style</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>OK, some functions can lead you astray when mapping, and you now know what to look for. Let’s keep<br/>enhancing the way we work by using ranges to write code that would usually require a hand-written loop.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s34" style="padding-left: 53pt;text-indent: 0pt;text-align: justify;">Working with ranges</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Let’s now turn to a helper function, which will come in handy for many uses. We want a<br/>range  (start,  stop)  function  that  generates  an  array  of  numbers,  with  values  ranging  from<br/>start (inclusive) to stop (exclusive):</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// range.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 73pt;text-indent: -11pt;line-height: 142%;text-align: left;"><span>const range = (start: number, stop: number) : number [] =&gt;<br/>new Array(stop - start) .fill(0) .map((v, i) =&gt; start + i) ;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;text-align: left;">range(2, 7); // [2, 3, 4, 5, 6]</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Why f i 11 ( 0 ) ? Undefined array elements are skipped by map (), so we need to fill them with<br/>something or our code will have no effect.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 65pt;text-indent: 0pt;text-align: left;"><a name="bookmark187">Expanding your range</a></p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;line-height: 115%;text-align: left;"><span>Libraries such as Underscore and Lodash provide a more powerful version of our range ()<br/>function, letting us go in ascending or descending order and also specifying the step to use—as<br/>in                                                                                          _. range ( 0 , - 8 , - 2), which produces [0, - 2, -4, -6] —but for our needs, the</span></p><p style="padding-left: 65pt;text-indent: 0pt;line-height: 10pt;text-align: left;">version we wrote is enough. Refer to the <i>Questions </i>section at the end of this chapter.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 8pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>How can we use it? In the following section, we’ll see some uses for controlled looping with f orEach (),<br/>but we can redo our factorial function by applying range () and then reduce (). The idea of this<br/>is to generate all the numbers from 1 to n and then multiply them together:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 73pt;text-indent: -12pt;line-height: 144%;text-align: left;"><span>const factorialByRange = (n: number): number =&gt;<br/>ranged, n + 1) . reduce ( (x, y) = &gt; x * y, 1) ;</span></p><p style="padding-top: 8pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>It’s important to check the border cases, but the function also works for zero; can you see why? The<br/>reason for this is that the produced range is empty: the call is range (1,1), which returns an empty<br/>array. Then, reduce () doesn’t do any calculations and returns the initial value (1), which is correct.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;">In <i>Chapter </i>7, <i>Transforming Functions, </i><span>we’ll have the opportunity to use range () to generate source<br/>code; check out the </span><i>Currying with eval() </i>and <i>Partial application with eval() </i>sections.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 378pt;text-indent: 0pt;text-align: left;">Transformations  125</p><p style="padding-top: 22pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>You could use these numeric ranges to produce other kinds of ranges. For example, should you need<br/>an array with the alphabet, you could certainly (and tediously) write [&quot;A&quot;, &quot;B&quot;, &quot;C&quot;.  upto</span></p><p style="padding-left: 43pt;text-indent: 7pt;line-height: 125%;text-align: left;"><span>&quot; X&quot;, &quot; Y&quot;, &quot; Z&quot; ] • A simpler solution would be to generate a range with the ASCII codes for the<br/>alphabet and map those to letters:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 65pt;text-indent: -12pt;line-height: 144%;text-align: left;"><span>const ALPHABET = range(<br/>&quot;A&quot;.charCodeAt(0) ,<br/>&quot;ZcharCodeAt(0) + 1</span></p><p style="padding-left: 53pt;text-indent: 0pt;line-height: 10pt;text-align: left;">).map((x) <b>=&gt; String.fromCharCode(x));</b></p><p style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// [&quot;A&quot;    &quot;B&quot;   ”C”     &quot;X&quot;   &quot;Y&quot;   &quot;Z&quot;]</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: justify;"><span>Note the use of charCodeAt () to get the ASCII codes for the letters and String. fromCharCode (x)<br/>to transform the ASCII code into a character.</span></p><p style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: justify;"><span>Mapping is very important and often used, so let’s now analyze how you could implement it on your<br/>own, which could help you develop code for more complex cases.</span></p><p class="s34" style="padding-top: 8pt;padding-left: 43pt;text-indent: 0pt;text-align: justify;">Emulating map() with reduce!)</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Earlier in this chapter, we saw how reduce () could be used to implement reduceRight (). Now,<br/>let’s see how reduce () can also be used to provide a polyfill for map () (not that you will need it<br/>because nowadays, browsers offer both methods, but it will give you more of an idea of what you can<br/>achieve with these tools).</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Our own myMap () is a one-liner but can be hard to understand. We apply the function to each element<br/>of the array and use concat () to append the result to a result array (which is initially empty). When<br/>the loop finishes working with the input array, the result array will have the desired output values.<br/>Let’s first see a plain JavaScript version before getting to data typing:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// map.js</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">const myMap = (arr, fn) =&gt;</p><p style="padding-top: 4pt;padding-left: 64pt;text-indent: 0pt;text-align: left;">arr.reduce((x, y) =&gt; x.concat(fn(y)), [] ) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: justify;"><span>We apply the mapping function to each array element, one by one, and we concatenate the result to<br/>the accumulated output array.</span></p><p style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: justify;"><span>Let’s test this with an array and a simple function. We will use both the original map () method and<br/>myMap (), and the results should match! Our mapping function will return double its input:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 21pt;text-indent: 0pt;text-align: left;">126  Programming Declaratively - A Better Style</p><p style="padding-top: 2pt;padding-left: 61pt;text-indent: 0pt;line-height: 30pt;text-align: left;"><a name="bookmark188"><span>const dup = (x: number): number = &gt; 2 * x;<br/>console.log</span></a><b>(myMap(myArray, dup));</b><a name="bookmark189">&zwnj;</a></p><p style="padding-top: 4pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">console.log<b>(myArray.map(dup));</b></p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">// [44, 18, 120, 24, 8, 112] both times</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>The first log shows the expected result, produced by map (). The second output gives the same result,<br/>so it seems that myMap () works! And the final output is just to check that the original input array<br/>wasn’t modified in any way; mapping operations should always produce a new array. See </span><i>Question</i></p><p class="s9" style="padding-left: 52pt;text-indent: 0pt;line-height: 10pt;text-align: justify;">5.3 <span class="p">for testing our myMap () function more thoroughly.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Let’s review our myMap () function and add typing. The needed data types are more complex, and<br/>we’ll have a generic function:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// map.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 73pt;text-indent: -12pt;line-height: 143%;text-align: left;"><span>const myMap = &lt;T, R&gt;(arr: T [] , fn: (x: T) =&gt; R) : R [] =&gt;<br/>arr.reduce(</span></p><p style="padding-left: 88pt;text-indent: 0pt;line-height: 146%;text-align: left;"><span>(x: R [] , y: T) : R [] =&gt; x. concat (fn (y) ) ,<br/>[] as R[]</span></p><p style="padding-left: 74pt;text-indent: 0pt;text-align: left;">) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Our myMap () function receives an array of elements of type T and an f n () mapping function<br/>that transforms its T argument into an R-type result. The result of this mapping is an array of R-type<br/>elements. Examine the accumulator function by yourself; is its typing understandable?</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Let’s try a different mapping function to verify that our typing is correct. We’ll use one that returns<br/>strings instead of numbers - it just adds dashes before and after its input, to produce a string.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="padding-top: 3pt;padding-left: 61pt;text-indent: 0pt;line-height: 30pt;text-align: left;"><span>const addDashes = (x: number): string =&gt; &#39;-${x}-&#39;;<br/>const myDashes = myArray.map</span><b>(addDashes);</b></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// [ &#39;-22-&#39;, &#39;-9-&#39;, &#39;-60-&#39;, &#39;-12-&#39;, &#39;-4-&#39;, &#39;-56-&#39; ]</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: justify;">OK, it seems that our complex type definitions were correct!</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>All the previous examples in the chapter focused on simple arrays. But what happens if things get more<br/>complicated, say if you had to deal with an array whose elements were arrays themselves? Fortunately,<br/>there’s a way out of that. Let’s move on.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 12pt;padding-left: 378pt;text-indent: 0pt;text-align: left;">Transformations  127</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 44pt;text-indent: 0pt;text-align: justify;"><a name="bookmark190">Dealing with arrays of arrays</a></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>So far, we have worked with an array of (single) values as an input, but what would happen if your<br/>input was an array of arrays? If you consider this to be a far-fetched case, there are many possible<br/>scenarios where this could apply:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l54"><li data-list-text="•"><p class="s33" style="padding-left: 70pt;text-indent: -13pt;line-height: 124%;text-align: justify;">	<span class="p">For some applications, you could have a table of distances, which in JavaScript requires an<br/>array of arrays: distance [ i ] [ j ] would be the distance between i and j. How could you<br/>find the maximum distance between any two points? Finding the maximum is simple with a<br/>common array, but how do you deal with an array of arrays?</span></p></li><li data-list-text="•"><p class="s33" style="padding-top: 5pt;padding-left: 70pt;text-indent: -12pt;line-height: 124%;text-align: justify;">	<span class="p">A more complex example, also in a geographic vein, is that you could query a geographic API<br/>for cities matching a string, and the response could be an array of countries, each with an array<br/>of states, each itself with an array of matching cities: an array of arrays of arrays!</span></p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>In the first case, you could want a single array with all distances, and in the second, an array with all<br/>cities; how would you manage this? A new operation, </span><b>flattening, </b>is required; let’s take a look.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s34" style="padding-left: 43pt;text-indent: 0pt;text-align: justify;">Flattening an array</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>In ES2019, two operations were added to JavaScript: flat (), which we’U look at now, and f latMap (),<br/>which we’ll look at later. It’s easier to show what they do than to explain—bear with me!</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 56pt;text-indent: 0pt;text-align: justify;"><a name="bookmark191">No flat() allowed?</a></p><p style="padding-top: 4pt;padding-left: 57pt;text-indent: 0pt;line-height: 115%;text-align: justify;"><span>As often happens, not all browsers have been updated to include these new methods, and<br/>Microsoft’s Internet Explorer and others were deficient in this regard, so for web programming,<br/>a polyfill will be required. As usual, for updated compatibility data, check out the </span><i>Can I use?</i><span>site, in this case, at caniuse . com/#f eat=array- f lat. A piece of good news: since<br/>September 2018, all major browsers provide this feature natively!</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>The flat () method creates a new array, concatenating all elements of its subarrays to the desired<br/>level, which is, by default, 1:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: justify;">const a = [[1, 2], [3, 4, [5, 6, 7]], 8, [[[9]]]];</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 55pt;text-indent: -2pt;line-height: 141%;text-align: left;"><span>console.log(a.flat()); // or a.flat(l)<br/>11,2,3,4,                        [5, 6, 7], 8, [[9]]]</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 55pt;text-indent: -2pt;line-height: 143%;text-align: left;"><span>console.log(a.flat(2));<br/>11,2,3,4,5,6,7,8, [9]]</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 55pt;text-indent: -2pt;line-height: 143%;text-align: left;"><span>console.log(a.flat(Infinity));<br/>[ 1, 2, 3, 4, 5, 6, 7, 8, 9 ]</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 21pt;text-indent: 0pt;text-align: left;">128  Programming Declaratively - A Better Style</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: left;"><span>So, how could we use this function to solve our problems? Using flat(), spreading, and Math.<br/>max () answers the first question (as we saw back in the </span><i>Spread </i>section of <i>Chapter 1, Becoming</i><span>we could have used the maxArray () function we wrote back then), and we can also<br/>use reduce () for variety. Suppose we have the following table of distances:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;text-align: left;">const distances = [</p><p style="text-indent: 0pt;text-align: left;"><br/></p><table style="border-collapse:collapse;margin-left:73.78pt" cellspacing="0"><tr style="height:13pt"><td style="width:27pt"><p class="s29" style="padding-left: 1pt;padding-right: 2pt;text-indent: 0pt;line-height: 10pt;text-align: center;">[0, 20</p></td><td style="width:39pt"><p class="s29" style="padding-right: 6pt;text-indent: 0pt;line-height: 10pt;text-align: right;">35,</p></td><td style="width:27pt"><p class="s29" style="padding-right: 4pt;text-indent: 0pt;line-height: 10pt;text-align: right;">40] ,</p></td></tr><tr style="height:15pt"><td style="width:27pt"><p class="s29" style="padding-top: 1pt;padding-left: 1pt;padding-right: 9pt;text-indent: 0pt;text-align: center;">[20,</p></td><td style="width:39pt"><p class="s29" style="padding-top: 2pt;padding-right: 6pt;text-indent: 0pt;text-align: right;">10,</p></td><td style="width:27pt"><p class="s29" style="padding-top: 1pt;padding-right: 4pt;text-indent: 0pt;text-align: right;">50] ,</p></td></tr><tr style="height:15pt"><td style="width:27pt"><p class="s29" style="padding-top: 1pt;padding-left: 1pt;padding-right: 9pt;text-indent: 0pt;text-align: center;">[35,</p></td><td style="width:39pt"><p class="s29" style="padding-top: 2pt;padding-left: 3pt;text-indent: 0pt;text-align: left;">10, 0,</p></td><td style="width:27pt"><p class="s29" style="padding-top: 1pt;padding-right: 4pt;text-indent: 0pt;text-align: right;">30] ,</p></td></tr><tr style="height:13pt"><td style="width:27pt"><p class="s29" style="padding-top: 1pt;padding-left: 1pt;padding-right: 9pt;text-indent: 0pt;line-height: 10pt;text-align: center;">[40,</p></td><td style="width:39pt"><p class="s29" style="padding-top: 1pt;padding-left: 3pt;text-indent: 0pt;line-height: 10pt;text-align: left;">50, 30</p></td><td style="width:27pt"><p class="s29" style="padding-top: 2pt;padding-right: 2pt;text-indent: 0pt;line-height: 9pt;text-align: right;">0] ,</p></td></tr></table><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 126%;text-align: left;"><span>Then, we can find our maximum distance in a couple of ways: we either flatten the array, spread it,<br/>and use Math. max (), or flatten the array and use reducing to explicitly find the maximum:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// flat.js</p><p style="padding-top: 3pt;padding-left: 61pt;text-indent: 0pt;line-height: 30pt;text-align: left;"><span>const maxDistl = Math.max(...distances.flat ()); // 50<br/>const maxDist2 = distances</span></p><p style="padding-left: 75pt;text-indent: 0pt;text-align: left;">.flat ()</p><p style="padding-top: 4pt;padding-left: 75pt;text-indent: 0pt;text-align: left;">.reduce((p, d) =&gt; Math.max(p, d), 0); // also 50</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: -1pt;line-height: 123%;text-align: left;"><span>Let’s go back to the second question. Suppose we queried a geographic API for cities that have<br/>&quot;LINCOLN&quot; (upper or lower case) in their names and got the following answer:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">const apiAnswer = [</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 85pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>country: &quot;AR&quot;,<br/>name: &quot;Argentine&quot;<br/>states: [</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 110pt;text-indent: 0pt;text-align: left;">state: &quot;1&quot;</p><p style="padding-top: 4pt;padding-left: 109pt;text-indent: 0pt;text-align: left;">name: &quot;Buenos Aires&quot;,</p><p style="padding-top: 4pt;padding-left: 109pt;text-indent: 0pt;text-align: left;">cities: [{city: 3846864, name: &quot;Lincoln&quot;}],</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 378pt;text-indent: 0pt;text-align: left;">Transformations  <span class="s153">129</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 5pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">country: &quot;GB&quot;,</p><p style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>name: &quot;Great Britain&quot;,<br/>states: [</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 100pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>state: &quot;ENG&quot;,<br/>name: &quot;England&quot;,</span></p><p style="padding-left: 100pt;text-indent: 0pt;line-height: 10pt;text-align: left;">cities: [{city: 2644487, name: &quot;Lincoln&quot;}],</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 8pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">] ,</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 77pt;text-indent: 0pt;text-align: left;">country: &quot;US&quot;,</p><p style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>name: &quot;United States of America&quot;,<br/>states: [</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 101pt;text-indent: 0pt;text-align: left;">state: &quot;CA&quot;,</p><p style="padding-top: 4pt;padding-left: 100pt;text-indent: 0pt;text-align: left;">name: &quot;California&quot;,</p><p style="padding-top: 4pt;padding-left: 100pt;text-indent: 0pt;text-align: left;">cities: [{city: 5072006, name: &quot;Lincoln&quot;}],</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 100pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>state: &quot;IL&quot;,<br/>name: &quot;Illinois&quot;,<br/>cities: [</span></p><p style="padding-left: 113pt;text-indent: 0pt;line-height: 10pt;text-align: left;">{city: 4899911,</p><p style="padding-top: 4pt;padding-left: 113pt;text-indent: 0pt;text-align: left;">{city: 4899966,</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 36pt;text-indent: 0pt;line-height: 146%;text-align: left;"><span>name: &quot;Lincoln Park&quot;},<br/>name: &quot;Lincoln Square&quot;},</span></p><p style="padding-left: 101pt;text-indent: 0pt;text-align: left;">] ,</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 21pt;text-indent: 0pt;text-align: left;">130  Programming Declaratively - A Better Style</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: justify;">Extracting the list of cities can be done by applying map () and flat () twice:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><table style="border-collapse:collapse" cellspacing="0"><tr style="height:28pt"><td style="width:53pt"><p class="s29" style="padding-right: 11pt;text-indent: 0pt;line-height: 10pt;text-align: right;">apiAnswer</p><p class="s188" style="padding-top: 4pt;padding-right: 10pt;text-indent: 0pt;text-align: right;">.map(x</p></td><td style="width:31pt"><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s188" style="padding-left: 8pt;padding-right: 9pt;text-indent: 0pt;text-align: center;">=&gt;</p></td><td style="width:44pt"><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s188" style="padding-right: 2pt;text-indent: 0pt;text-align: right;">x.states)</p></td></tr><tr style="height:30pt"><td style="width:53pt"><p class="s188" style="padding-top: 2pt;padding-left: 15pt;text-indent: 0pt;text-align: left;">.flat()</p><p class="s188" style="padding-top: 4pt;padding-left: 15pt;text-indent: 0pt;text-align: left;">.map(y</p></td><td style="width:31pt"><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s188" style="padding-left: 9pt;padding-right: 8pt;text-indent: 0pt;text-align: center;">=&gt;</p></td><td style="width:44pt"><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s188" style="padding-right: 2pt;text-indent: 0pt;text-align: right;">y.cities)</p></td></tr><tr style="height:13pt"><td style="width:53pt"><p class="s188" style="padding-top: 2pt;padding-left: 15pt;text-indent: 0pt;line-height: 9pt;text-align: left;">.flat()</p></td><td style="width:31pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:44pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr></table><p style="text-indent: 0pt;text-align: left;"/><p style="padding-left: 61pt;text-indent: 0pt;line-height: 286%;text-align: left;"><span>// continued...<br/>console.log(</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><table style="border-collapse:collapse;margin-left:59.63pt" cellspacing="0"><tr style="height:14pt"><td style="width:21pt"><p class="s19" style="padding-left: 2pt;text-indent: 0pt;line-height: 12pt;text-align: left;">/*</p></td><td style="width:31pt"><p class="s29" style="padding-right: 3pt;text-indent: 0pt;text-align: center;">Results:</p></td><td style="width:56pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:39pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:66pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:16pt"><td style="width:21pt"><p class="s19" style="padding-top: 1pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">[ {</p></td><td style="width:31pt"><p class="s29" style="padding-top: 1pt;padding-left: 5pt;padding-right: 9pt;text-indent: 0pt;text-align: center;">city:</p></td><td style="width:56pt"><p class="s29" style="padding-top: 1pt;padding-left: 9pt;padding-right: 10pt;text-indent: 0pt;text-align: center;">3846864,</p></td><td style="width:39pt"><p class="s29" style="padding-top: 1pt;padding-right: 6pt;text-indent: 0pt;text-align: right;">name:</p></td><td style="width:66pt"><p class="s29" style="padding-top: 1pt;padding-left: 6pt;text-indent: 0pt;text-align: left;">&#39;Lincoln&#39; },</p></td></tr><tr style="height:15pt"><td style="width:21pt"><p class="s19" style="padding-top: 1pt;text-indent: 0pt;text-align: right;">{</p></td><td style="width:31pt"><p class="s29" style="padding-left: 5pt;padding-right: 9pt;text-indent: 0pt;text-align: center;">city:</p></td><td style="width:56pt"><p class="s29" style="padding-left: 9pt;padding-right: 10pt;text-indent: 0pt;text-align: center;">2644487,</p></td><td style="width:39pt"><p class="s29" style="padding-right: 6pt;text-indent: 0pt;text-align: right;">name:</p></td><td style="width:66pt"><p class="s29" style="padding-left: 6pt;text-indent: 0pt;text-align: left;">&#39;Lincoln&#39; },</p></td></tr><tr style="height:15pt"><td style="width:21pt"><p class="s19" style="padding-top: 1pt;text-indent: 0pt;text-align: right;">{</p></td><td style="width:31pt"><p class="s29" style="padding-left: 5pt;padding-right: 9pt;text-indent: 0pt;text-align: center;">city:</p></td><td style="width:56pt"><p class="s29" style="padding-left: 9pt;padding-right: 10pt;text-indent: 0pt;text-align: center;">5072006,</p></td><td style="width:39pt"><p class="s29" style="padding-right: 6pt;text-indent: 0pt;text-align: right;">name:</p></td><td style="width:66pt"><p class="s29" style="padding-left: 6pt;text-indent: 0pt;text-align: left;">&#39;Lincoln&#39; },</p></td></tr><tr style="height:15pt"><td style="width:21pt"><p class="s19" style="padding-top: 1pt;text-indent: 0pt;text-align: right;">{</p></td><td style="width:31pt"><p class="s29" style="padding-left: 5pt;padding-right: 9pt;text-indent: 0pt;text-align: center;">city:</p></td><td style="width:56pt"><p class="s29" style="padding-left: 9pt;padding-right: 9pt;text-indent: 0pt;text-align: center;">8531960,</p></td><td style="width:39pt"><p class="s29" style="padding-right: 6pt;text-indent: 0pt;text-align: right;">name:</p></td><td style="width:66pt"><p class="s29" style="padding-left: 6pt;text-indent: 0pt;text-align: left;">&#39;Lincoln&#39; },</p></td></tr><tr style="height:15pt"><td style="width:21pt"><p class="s19" style="padding-top: 1pt;text-indent: 0pt;text-align: right;">{</p></td><td style="width:31pt"><p class="s29" style="padding-left: 5pt;padding-right: 9pt;text-indent: 0pt;text-align: center;">city:</p></td><td style="width:56pt"><p class="s29" style="padding-left: 9pt;padding-right: 10pt;text-indent: 0pt;text-align: center;">4769608,</p></td><td style="width:39pt"><p class="s29" style="padding-right: 6pt;text-indent: 0pt;text-align: right;">name:</p></td><td style="width:66pt"><p class="s29" style="padding-left: 6pt;text-indent: 0pt;text-align: left;">&#39;Lincolnia&#39; },</p></td></tr><tr style="height:15pt"><td style="width:21pt"><p class="s19" style="text-indent: 0pt;text-align: right;">{</p></td><td style="width:31pt"><p class="s29" style="padding-left: 5pt;padding-right: 9pt;text-indent: 0pt;text-align: center;">city:</p></td><td style="width:56pt"><p class="s29" style="padding-left: 8pt;padding-right: 10pt;text-indent: 0pt;text-align: center;">4999311,</p></td><td style="width:39pt"><p class="s29" style="padding-right: 6pt;text-indent: 0pt;text-align: right;">name:</p></td><td style="width:66pt"><p class="s29" style="padding-left: 6pt;text-indent: 0pt;text-align: left;">&#39;Lincoln Park&#39;</p></td></tr><tr style="height:15pt"><td style="width:21pt"><p class="s19" style="padding-top: 1pt;text-indent: 0pt;text-align: right;">{</p></td><td style="width:31pt"><p class="s29" style="padding-left: 5pt;padding-right: 9pt;text-indent: 0pt;text-align: center;">city:</p></td><td style="width:56pt"><p class="s29" style="padding-left: 9pt;padding-right: 10pt;text-indent: 0pt;text-align: center;">5072006,</p></td><td style="width:39pt"><p class="s29" style="padding-right: 6pt;text-indent: 0pt;text-align: right;">name:</p></td><td style="width:66pt"><p class="s29" style="padding-left: 6pt;text-indent: 0pt;text-align: left;">&#39;Lincoln&#39; },</p></td></tr><tr style="height:15pt"><td style="width:21pt"><p class="s19" style="padding-top: 1pt;text-indent: 0pt;text-align: right;">{</p></td><td style="width:31pt"><p class="s29" style="padding-left: 5pt;padding-right: 9pt;text-indent: 0pt;text-align: center;">city:</p></td><td style="width:56pt"><p class="s29" style="padding-left: 9pt;padding-right: 10pt;text-indent: 0pt;text-align: center;">4899911,</p></td><td style="width:39pt"><p class="s29" style="padding-right: 6pt;text-indent: 0pt;text-align: right;">name:</p></td><td style="width:66pt"><p class="s29" style="padding-left: 6pt;text-indent: 0pt;text-align: left;">&#39;Lincoln Park&#39;</p></td></tr><tr style="height:14pt"><td style="width:21pt"><p class="s19" style="padding-top: 1pt;text-indent: 0pt;line-height: 12pt;text-align: right;">{</p></td><td style="width:31pt"><p class="s29" style="padding-left: 5pt;padding-right: 9pt;text-indent: 0pt;text-align: center;">city:</p></td><td style="width:56pt"><p class="s29" style="padding-left: 9pt;padding-right: 10pt;text-indent: 0pt;text-align: center;">4899966,</p></td><td style="width:39pt"><p class="s29" style="padding-right: 6pt;text-indent: 0pt;text-align: right;">name:</p></td><td style="width:66pt"><p class="s29" style="padding-left: 6pt;text-indent: 0pt;text-align: left;">&#39;Lincoln Square</p></td></tr></table><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>We have seen how to use f lat () to flatten an array; lets now see how to use flatMap (), an<br/>interesting mixture of flat () and map (), to further streamline our coding and even further shorten<br/>our preceding second solution! (And if you think this exercise wasn’t hard enough and its output was<br/>sort of lame, try out </span><i>Question 5.10 </i>for a more challenging version!)</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s34" style="padding-left: 52pt;text-indent: 0pt;text-align: justify;">Mapping and flattening - flatMapO</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Basically, what f latMap () does is first apply a map () function and then apply flat () to the<br/>result of the mapping operation. This is an interesting combination because it lets you produce a new<br/>array with a different number of elements. (With the normal map () operation, the output array would<br/>be precisely the same length as the input array). If your mapping operation produces an array with<br/>two or more elements, then the output array will include many output values, and if you produce an<br/>empty array, the output array will include fewer values.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 378pt;text-indent: 0pt;text-align: left;">Transformations  131</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Let’s look at a (somehow nonsensical) example. Assume that we have a list of names, such as &quot;Winston<br/>Spencer  Churchill&quot;,  &quot;Abraham  Lincoln&quot;,  and  &quot;Socrates&quot;.  Our  rule  is  that  if  a  name<br/>has several words, exclude the initial one (the first name, we assume) and separate the rest (last names),<br/>but if a name is a single word, drop it (assuming the person has no last name):</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">const names = [</p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>&quot;Winston Spencer Churchill&quot;,<br/>&quot;Plato&quot;,</span></p><p style="padding-left: 65pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>&quot;Abraham Lincoln&quot;,<br/>&quot;Socrates&quot;,<br/>&quot;Charles Darwin&quot;,</span></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">] ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 6pt;padding-left: 65pt;text-indent: -12pt;line-height: 143%;text-align: left;">const lastNames = names<b>.flatMap(</b><span>(x) =&gt; {<br/>const s = x.split(&quot; &quot;);</span></p><p style="padding-left: 65pt;text-indent: 0pt;line-height: 10pt;text-align: left;">return s.length === 1 ? [] : s.splice(l);</p><p style="padding-top: 6pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">});</p><p style="padding-top: 2pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// [ &#39;Spencer&#39;, &#39;Churchill&#39;, &#39;Lincoln&#39;, &#39;Darwin&#39; ]</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>As we can see, the output array has a different number of elements than the input array: just because<br/>of this, we could consider flatMap () to be an upgraded version of map (), even including some<br/>aspects of filter (), like when we excluded single names.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;text-align: left;">Lets now move on to a simple example. Keeping with the Lincolnian theme from the last section,</p><p style="padding-top: 2pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: left;"><span>let’s count how many words are in Lincoln’s Gettysburg address, given as an array of sentences. By the<br/>way, this address is usually considered to be 272 words long, but the version I found doesn’t produce<br/>that number! This may be because there are five manuscript copies of the address written by Lincoln<br/>himself, plus another version transcribed from shorthand notes taken at the event. In any case, I will<br/>leave  the discrepancy to historians and stick to coding!</span></p><p style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>We can use f 1atMap () to split each sentence into an array of words and then see the length of the<br/>flattened array:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">const gettysburg = [</p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;line-height: 143%;text-align: left;"><span>&quot;Four score and seven years ago our fathers&quot;,<br/>&quot;brought forth, on this continent, a new nation,&quot;,<br/>&quot;conceived in liberty, and dedicated to the&quot;,<br/>&quot;proposition that all men are created equal.&quot;,</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 21pt;text-indent: 0pt;text-align: left;">132  Programming Declaratively - A Better Style</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 74pt;text-indent: 0pt;line-height: 142%;text-align: left;"><span>&quot;Now we are engaged in a great civil war,&quot;,<br/>&quot;testing whether that nation, or any nation&quot;,</span></p><p style="padding-left: 74pt;text-indent: 0pt;line-height: 141%;text-align: left;"><span>&quot;so conceived and so dedicated, can long endure.&quot;,<br/>&quot;We are met on a great battle field of that&quot;,</span></p><p style="padding-left: 74pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>&quot;war. We have come to dedicate a portion of&quot;,<br/>&quot;that field, as a final resting place for&quot;,</span></p><p style="padding-left: 74pt;text-indent: 0pt;line-height: 142%;text-align: left;"><span>&quot;those who here gave their lives, that that&quot;,<br/>&quot;nation might live. It is altogether&quot;,</span></p><p style="padding-left: 74pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>&quot;fitting and proper that we should do this.&quot;,<br/>&quot;But, in a larger sense, we cannot dedicate,&quot;,<br/>&quot;we cannot consecrate, we cannot hallow,&quot;,<br/>&quot;this ground.&quot;,</span></p><p style="padding-left: 74pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>&quot;The brave men, living and dead, who&quot;,<br/>&quot;struggled here, have consecrated it far&quot;,<br/>&quot;above our poor power to add or detract.&quot;,<br/>&quot;The world will little note nor long&quot;,<br/>&quot;remember what we say here, but it can&quot;,<br/>&quot;never forget what they did here.&quot;,</span></p><p style="padding-left: 74pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>&quot;It is for us the living, rather, to be&quot;,<br/>&quot;dedicated here to the unfinished work&quot;,<br/>&quot;which they who fought here have thus far&quot;,<br/>&quot;so nobly advanced.&quot;,</span></p><p style="padding-left: 74pt;text-indent: 0pt;line-height: 143%;text-align: left;"><span>&quot;It is rather for us to be here dedicated&quot;,<br/>&quot;to the great task remaining before us—&quot;,<br/>&quot;that from these honored dead we take&quot;,<br/>&quot;increased devotion to that cause for&quot;,<br/>&quot;which they here gave the last full&quot;,</span></p><p style="padding-left: 74pt;text-indent: 0pt;line-height: 143%;text-align: left;"><span>&quot;measure of devotion— that we here highly&quot;,<br/>&quot;resolve that these dead shall not have&quot;,<br/>&quot;died  in vain— that this nation, under&quot;,<br/>&quot;God, shall have a new birth of freedom-&quot;,<br/>&quot;and that government of the people, by&quot;,</span></p><p style="padding-left: 74pt;text-indent: 0pt;line-height: 142%;text-align: left;"><span>&quot;the people, for the people, shall not&quot;,<br/>&quot;perish from the earth.&quot;,</span></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">] ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">console.log(</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 378pt;text-indent: 0pt;text-align: left;">Transformations  133</p><p style="padding-top: 22pt;padding-left: 64pt;text-indent: 0pt;text-align: left;">gettysburg.<b>flatMap((s: string) =&gt; s.splitC </b>&quot;)).length</p><p style="padding-top: 5pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">) ;</p><p style="padding-top: 3pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// 270 ...not 272?</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Let’s go back to the problem with the cities. If we notice that each map () was followed by f 1 at (),<br/>an alternative solution is immediately apparent. Compare this solution with the one we wrote in the<br/></span><i>Flattening an array </i>section; it’s essentially the same but conflates each map () with its following f 1 at ():</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 64pt;text-indent: -12pt;line-height: 144%;text-align: left;"><span>console.log(<br/>apiAnswer</span></p><p class="s10" style="padding-left: 78pt;text-indent: 0pt;text-align: left;">.flatMap( (x) =&gt; x.states)</p><p class="s10" style="padding-top: 4pt;padding-left: 78pt;text-indent: 0pt;text-align: left;">.flatMap!(y) =&gt; y.cities)</p><p style="padding-top: 5pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">) ;</p><p style="padding-top: 3pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// same result as with separate map() and flat() calls</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>We have now seen the new operations. (And, yes, it’s perfectly possible to solve the problems in this<br/>section without mapping, but that wouldn’t be a good example for this section! See </span><i>Question 5.11 </i><span>for<br/>an alternative to the word counting problem.) Let’s now learn how to emulate these operations should<br/>you not have them readily available.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s34" style="padding-left: 43pt;text-indent: 0pt;text-align: justify;">Emulating flat() and flatMapO</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>We have already seen how reduce () could be used to emulate map (). Let’s now see how to work<br/>out equivalents for flat () and flatMap () to get more practice. We’ll also throw in a recursive<br/>version, a topic we’ll return to in </span><i>Chapter 9, Designing Functions. </i><span>As was mentioned earlier, we are<br/>not aiming for the fastest or smallest or any particular version of the code; instead, we want to focus<br/>on using the concepts we’ve been looking at in this book.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Totally flattening an array can be done with a recursive call. We use reduce () to process the array<br/>element by element, and if an element happens to be an array, we recursively flatten it:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 64pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>const  flatAll  =  &lt;T&gt;(arr:  T[])  :  T[]  =  &gt;<br/>arr.reduce(</span></p><p style="padding-left: 78pt;text-indent: 0pt;line-height: 10pt;text-align: left;">(f : T [] , V: T) =&gt;</p><p style="padding-top: 4pt;padding-left: 79pt;text-indent: 10pt;line-height: 146%;text-align: left;"><span>f.concat(Array.isArray(v) ? flatAll(v) : v),<br/>[] as T[]</span></p><p style="padding-left: 65pt;text-indent: 0pt;text-align: left;">) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-left: 21pt;text-indent: 0pt;text-align: left;">134  <span class="s189">Programming Declaratively - A Better Style</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>Flattening an array to a given level (not infinity; let’s leave that for later) is easy if you can first<br/>flatten an array one level. We can do this either by using spreading or with reduce (). Let’s write a<br/>fl atOne () function that flattens just a single level of an array. There are two versions of this; pick<br/>whichever you prefer:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 76pt;text-indent: -14pt;line-height: 143%;text-align: left;"><span>const flatOnel = &lt;T&gt;(arr: T[J) : T[] =&gt;<br/>(                                [] as T [] ) . concat ( . . . arr) ;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;text-align: left;">const flat0ne2 = &lt;T&gt;(arr: T[]) : T[] =&gt;</p><p style="padding-top: 4pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">arr . reduce ( (f , v) =&gt; f. concat (v), [] as T [] ) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>Using either of these two functions, we can flatten an array of several levels, and we can do this in<br/>two different ways. Our two versions of a flat () function use our previous f latOne () and</span></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>fl at All () functions, but the first one only uses standard looping, while the second one works in<br/>a fully recursive way. Which one do you prefer?</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 74pt;text-indent: -12pt;line-height: 144%;text-align: left;"><span>const flatl = &lt;T&gt;(arr: T[] , n = 1): T[] =&gt; {<br/>if (n === Infinity) {</span></p><p style="padding-left: 85pt;text-indent: 0pt;line-height: 10pt;text-align: left;">return flatAll(arr);</p><p style="padding-top: 4pt;padding-left: 75pt;text-indent: 0pt;text-align: left;">} else {</p><p style="padding-top: 4pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">let result = arr;</p><p style="padding-top: 4pt;padding-left: 97pt;text-indent: -12pt;line-height: 146%;text-align: left;"><span>range(0, n).forEach(() =&gt; {<br/>result = flatOne(result);</span></p><p style="padding-top: 1pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">});</p><p style="padding-top: 2pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">return result;</p><p style="padding-top: 6pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 73pt;text-indent: -11pt;line-height: 141%;text-align: left;"><span>const flat2 = &lt;T&gt;(arr: T[] , n = 1) : T[] =&gt; {<br/>n === Infinity</span></p><p style="padding-left: 86pt;text-indent: 0pt;text-align: left;">? flatAll(arr)</p><p style="padding-top: 4pt;padding-left: 87pt;text-indent: 0pt;text-align: left;">: n === 1</p><p style="padding-top: 4pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">? flatOne(arr)</p><p style="padding-top: 4pt;padding-left: 87pt;text-indent: 0pt;text-align: left;">: flat2(flatOne(arr), n - 1);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 378pt;text-indent: 0pt;text-align: left;">Transformations  135</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>I think the recursive one is nicer and more aligned with the theme of this book. Still, it’s up to you,<br/>really—although if you don’t feel comfortable with the ternary operator, then the recursive version<br/>is definitely not for you!</span></p><p style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: justify;"><span>If you wish to polyfill these functions (despite our suggestions not to), it’s not complex, and is similar<br/>to what we did with the average () method previously. I took care not to create any extra methods:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">if (!Array.prototype.flat) {</p><p style="padding-top: 4pt;padding-left: 77pt;text-indent: -13pt;line-height: 141%;text-align: left;"><span>Array.prototype.flat = function (this, n): any[] {<br/>if (n === undefined || n === 1) {</span></p><p style="padding-left: 88pt;text-indent: 0pt;text-align: left;">return flatOne(this as any[]);</p><p style="padding-top: 4pt;padding-left: 89pt;text-indent: -11pt;line-height: 143%;text-align: left;"><span>}  else  if  (n  ===  Infinity)  {<br/>return flatAll(this as any[]);</span></p><p style="padding-left: 77pt;text-indent: 0pt;text-align: left;">} else {</p><p style="padding-top: 4pt;padding-left: 88pt;text-indent: 0pt;text-align: left;">return flatOne(this as any[]).flat(n - 1);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Our f latOneX () and fl at Al IX () methods are just copies of what we developed before, and<br/>you’ll recognize the code of our previous f lat2 () function at the end of our implementation.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Finally, emulating f latMap () is simple in itself, and we can skip it because it’s just a matter of<br/>applying map () first, and then f lat (); no big deal!</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>We have seen how to work with arrays in several ways, but sometimes what you need isn’t really<br/>well served by any of the functions we have seen. Let’s move on to more general ways of looping, for<br/>greater power.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 43pt;text-indent: 0pt;text-align: justify;"><a name="bookmark192">More general looping</a></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>The preceding examples that we’ve seen all loop through arrays, doing some work. However, sometimes,<br/>you need to loop, but the required process doesn’t really fit map () or reduce (). So, what can be done<br/>in such cases? There is a f orEach () method that can help. (Read more about it at developer.<br/>mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/</span></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: justify;">Array/f orEach.)</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>You must provide a callback that will receive the value, the index, and the array on which you are<br/>operating. (The last two arguments are optional.) JavaScript will take care of the loop control, and you<br/>can do whatever you want at each step. For instance, we can program an object copying method by<br/>using Ob j ect methods to copy the source object attributes one at a time and generate a new object:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 21pt;text-indent: 0pt;text-align: left;">136  Programming Declaratively - A Better Style</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// copy.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">const objCopy = &lt;T&gt;(obj: T): T =&gt; {</p><p style="padding-top: 4pt;padding-left: 73pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>const copy = Object.create(Object.getPrototypeOf(obj));<br/>Object.getOwnPropertyNames(obj).forEach((prop: string) =&gt;</span></p><p style="padding-left: 97pt;text-indent: -12pt;line-height: 143%;text-align: left;"><span>Obj ect.defineProperty(<br/>copy,</span></p><p style="padding-left: 97pt;text-indent: 0pt;line-height: 10pt;text-align: left;">prop,</p><p style="padding-top: 4pt;padding-left: 97pt;text-indent: 0pt;text-align: left;">Object.getOwnPropertyDescriptor(obj,      prop)      as      string</p><p style="padding-top: 5pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">)</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 6pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">return copy;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;line-height: 144%;text-align: justify;"><span>const myObj = { fk: 22, st: 12, desc: &quot;couple&quot; };<br/>const myCopy = objCopy(myObj);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;text-align: justify;">console.log(myObj, myCopy);</p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: justify;">// {fk: 22, st: 12, desc: &quot;couple&quot;}, twice</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>The idea is: we create a copy object with the same prototype as the original obj, and then for each<br/>property in the original, we define an equivalent property in the copy. The function’s signature makes<br/>clear that the input and output types are the same. One particular detail: given the loop we are writing,<br/>we  know  for  sure  that  Obj  ect.  getOwnPropertyDescriptor  (obj  ,  prop)  will  be  a  string<br/>(and not undefined), but TypeScript cannot tell; adding as string solves this.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-top: 5pt;padding-left: 66pt;text-indent: 0pt;text-align: justify;"><a name="bookmark193">Shallow or deep?</a></p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;line-height: 115%;text-align: justify;"><span>Yes, of course, we could have written myCopy= { . . . myObj }, but where’s the fun in that?<br/>It would be better, but I needed a nice example to use f orEach () with. Sorry about that!<br/>Also, there are some hidden inconveniences in that code, which we’ll explain in </span><i>Chapter 10,</i><span>when we try to get frozen, unmodifiable objects. Just a hint: the new object<br/>may share values with the old one because we have a shallow copy, not a deep one. We’ll learn<br/>more about this later in the book.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 53pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>If we use the range () function that we defined previously, we can also perform common loops of the<br/>for(let i=0; i&lt;10; i + + ) variety. We might write yet another version of factorial (!) using that:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: justify;">// loops.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: right;">Logical HOFs  137</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: justify;">import { range } from &quot;./range&quot;;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 65pt;text-indent: -12pt;line-height: 143%;text-align: left;"><span>const  fact4  =  (n:  number):  number  =&gt;  {<br/>let result = 1;</span></p><p style="padding-left: 65pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>range(1,  n  +  1).forEach((v)  =&gt;  (result  *=  v)  )  ;<br/>return result;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;text-align: justify;">console.log(fact4(5)); // 120</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>This definition of factorial really matches the usual description: it generates all the numbers from 1<br/>to </span><i>n </i>inclusive and multiplies them—simple!</p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>For greater generality, consider expanding range () so it can generate ascending and descending<br/>ranges of values, possibly stepping by a number other than 1. This would allow you to replace all the<br/>loops in your code with f orEach () loops.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>At this point, we have seen many ways of processing arrays to generate results, but other objectives<br/>may be of interest, so lets now move on to logical functions, which will also simplify our coding needs.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-left: 44pt;text-indent: 0pt;text-align: justify;"><a name="bookmark194">Logical HOFs</a></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Up to now, we have been using HOFs to produce new results. However, some other functions produce<br/>logical results by applying a predicate to all the elements of an array. (By the way, we’ll see much more<br/>about HOFs in the next chapter.)</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 56pt;text-indent: 0pt;text-align: justify;"><a name="bookmark195">Many meanings</a></p><p style="padding-top: 4pt;padding-left: 56pt;text-indent: 0pt;line-height: 115%;text-align: justify;">A bit of terminology: the word <b>predicate </b><span>can be used in several senses (as in predicate logic),<br/>but for us, in computer science, it has the meaning of </span><i>a function that returns true or false. </i><span>OK,<br/>this isn’t a very formal definition, but it’s enough for our needs. For example, saying that we<br/>will filter an array depending on a predicate means that we get to decide which elements are<br/>included or excluded depending on the predicate’s result.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: justify;"><span>Using these functions implies that your code will become shorter: you can get results corresponding<br/>to a whole set of values with a single line of code.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 44pt;text-indent: 0pt;text-align: justify;"><a name="bookmark196">Filtering an array</a></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>We will encounter a common need to filter the elements of an array according to a specific condition.<br/>The filter () method lets you inspect each element of an array in the same fashion as map (). The<br/>difference is that instead of producing a new element, the result of your function determines whether</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 21pt;text-indent: 0pt;text-align: left;">138  Programming Declaratively - A Better Style</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>the input value will be kept in the output (if the function returned true) or if it will be skipped (if<br/>the function returned false). Also, similar to map (), filter () doesn’t alter the original array<br/>but produces a new array with the chosen items. You can read more on the f i Iter () function<br/>at                    developer.mozilla.org/en/docs/Web/JavaScript/Reference/Globa1_<br/>Obj           ects/Array/filter.</span></p><p style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;text-align: justify;">See <i>Figure 5.4 </i>for a diagram showing the input and output:</p><p style="text-indent: 0pt;text-align: left;"><span><img width="239" height="327" alt="image" src="Image_023.gif"/></span></p><p class="s190" style="padding-top: 8pt;padding-left: 151pt;text-indent: 0pt;text-align: left;"><span>input<br/>array</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s190" style="padding-top: 8pt;padding-left: 153pt;text-indent: -4pt;line-height: 94%;text-align: left;"><span>output<br/>array</span></p><p style="padding-top: 6pt;padding-left: 52pt;text-indent: 30pt;line-height: 26pt;text-align: left;"><span>Figure 5.4 - The filter() method picks the elements of an array that satisfy a given predicate<br/>There are a couple of things to remember when filtering an array:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l55"><li data-list-text="•"><p class="s10" style="padding-left: 79pt;text-indent: -12pt;line-height: 126%;text-align: left;">Always return something from your predicate: <span class="p">If you forget to include a return, the function<br/>will implicitly return undef ined, and since that’s a falsy value, the output will be an empty array</span></p></li><li data-list-text="•"><p class="s10" style="padding-top: 5pt;padding-left: 79pt;text-indent: -13pt;line-height: 123%;text-align: left;">The copy that is made is shallow: <span class="p">If the input array elements are objects or arrays, then the<br/>original elements will still be accessible</span></p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Let’s get into more detail by seeing a practical example of f i 11 e r () and then looking at how we<br/>could implement that functionality by using reduce ().</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: right;">Logical HOFs  139</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s34" style="padding-top: 4pt;padding-left: 43pt;text-indent: 0pt;text-align: justify;">A filterf) example</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Let’s look at a practical example. Suppose a service has returned a JSON object, which has an array of<br/>objects containing an account’s id value and balance. How can we get the list of IDs </span><i>“in the red”,</i>with a negative balance? The input data could be as follows:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// filter.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 64pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>const   serviceResult   =   {<br/>accountsData: [</span></p><p style="padding-left: 77pt;text-indent: 0pt;line-height: 10pt;text-align: left;">{ id: &quot;F220960K&quot;, balance: 1024 },</p><p style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">{ id: &quot;S120456T&quot;, balance: 2260 },</p><p style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">{ id: &quot;J140793A&quot;, balance: -38 },</p><p style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">{ id: &quot;M120396V&quot;, balance: -114 },</p><p style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">{   id:   &quot;A120289L&quot;,   balance:   55000   },</p><p style="padding-top: 5pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">] ,</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>We could get the delinquent accounts with something like the following. You can check that the value<br/>of the delinquent variable correctly includes the two IDs of accounts with a negative balance:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;text-align: left;"><a name="bookmark197">const delinquent = serviceResult.accountsData.filter(</a></p><p class="s10" style="padding-top: 4pt;padding-left: 66pt;text-indent: 0pt;text-align: left;">(v) =&gt; v.balance &lt; 0</p><p style="padding-top: 5pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">) ;</p><p style="padding-top: 3pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">console.log(delinquent);</p><p style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// two objects, with id&#39;s <b>J140793A </b>and <b>M120396V</b></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>By the way, given that the filtering operation produced yet another array, if you just wanted the accounts<br/>IDs, you could get them by mapping the output to only get the id field:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s9" style="padding-left: 53pt;text-indent: 0pt;text-align: left;">11 <span class="p">continued...</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">const delinquentlds = delinquent<b>.map((v) =&gt; v.id);</b></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: left;">And if you didn’t care for the intermediate result, a one-liner would have worked as well:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s9" style="padding-left: 53pt;text-indent: 0pt;text-align: left;">11 <span class="p">continued...</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 21pt;text-indent: 0pt;text-align: left;">140  Programming Declaratively - A Better Style</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;text-align: left;">const delinquentlds2 = serviceResult.accountsData</p><p style="padding-top: 4pt;padding-left: 75pt;text-indent: 0pt;text-align: left;">.filter!(v) =&gt; v.balance &lt; 0)</p><p style="padding-top: 4pt;padding-left: 75pt;text-indent: 0pt;text-align: left;">.map((v) =&gt; v.id);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: justify;"><span>Filtering is a very useful function, so now, to get a better handle on it, let’s see how you can emulate<br/>it, which you could use as a basis for more sophisticated, powerful functions of your own.</span></p><p class="s34" style="padding-top: 8pt;padding-left: 52pt;text-indent: 0pt;text-align: justify;">Emulating filterf) with reduce()</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>As we did before with map (), we can also create our own version of filter () by using reduce ().<br/>The idea is similar: loop through all the elements of the input array, apply the predicate to it, and if<br/>the result is true, add the original element to the output array. When the loop is done, the output<br/>array will only have those elements for which the predicate was true:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 73pt;text-indent: -12pt;line-height: 146%;text-align: left;"><span>const  myFilter  =  &lt;T&gt;(arr:  T[],  fn:  (x:  T)  =&gt;  boolean)  =&gt;<br/>arr.reduce(</span></p><p style="padding-left: 88pt;text-indent: 0pt;line-height: 153%;text-align: left;"><span>(x:  T[],  y:  T)  =&gt;  (fn(y)  ?  x.concat(y)  :  x)  ,<br/>[]</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Our function is generic; it takes an array of elements of type T and a predicate that accepts a T-type<br/>parameter and generates a new array of elements of type T. We can quickly see that our function<br/>works as expected:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;text-align: left;">myFilter(serviceResult.accountsData, (v) =&gt; v.balance &lt; 0) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: justify;">The output is the same pair of accounts that we saw earlier in this section.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 52pt;text-indent: 0pt;text-align: justify;"><a name="bookmark198">Searching an array</a></p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Sometimes, instead of filtering all the elements of an array, you want to find an element that satisfies<br/>a given predicate. There are a couple of functions that can be used for this, depending on your<br/>specific needs:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l56"><li data-list-text="•"><p class="s33" style="padding-left: 79pt;text-indent: -12pt;line-height: 123%;text-align: left;">	<span class="p">find () searches through the array and returns the value of the first element that satisfies a<br/>given condition, or undefined if no such element is found</span></p></li><li data-list-text="•"><p class="s33" style="padding-top: 5pt;padding-left: 79pt;text-indent: -13pt;line-height: 123%;text-align: left;">	<span class="p">f indlndex () performs a similar task, but instead of returning an element, it returns the<br/>index of the first element in the array that satisfies the condition, or -1 if none were found</span></p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: right;">Logical HOFs  141</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>The similarity to includes () and indexOf () is clear; these functions search for a specific value<br/>instead of an element that satisfies a more general condition. We can easily write equivalent one-liners:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;line-height: 115%;text-align: left;"><span>arr.includes(value);        // arr.find(v =&gt; v === value) arr.<br/>indexOf(value);      // arr.findindex(v =&gt; v === value)</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 44pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>Going back to the geographic data we used earlier, we could easily find a given country by using the<br/>f ind () method. For instance, let’s get data for Brazil ( &quot; BR &quot;); it just takes a single line of code:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// search.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">import { markers } from &quot;./average&quot;;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;text-align: left;"><a name="bookmark199">const brazilData = markers.</a><b>find((v) =&gt; v.name === &quot;BR&quot;);</b></p><p style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// {name:&quot;BR&quot;, lat:-15.8, lon:-47.9}</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>We can’t use the simpler includes () method because we have to delve into the object to get the field<br/>we want. If we wanted the position of the country in the array, we would have used f indlndex ():</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;text-align: left;"><a name="bookmark200">const brazillndex = markers.</a><b>findindex(</b></p><p class="s10" style="padding-top: 4pt;padding-left: 66pt;text-indent: 0pt;text-align: left;"><a name="bookmark201">(v) =&gt; v.name === &quot;BR&quot;</a></p><p class="s10" style="padding-top: 5pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">) ;</p><p style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// 2</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: justify;">OK, this was easy! What about a special case, which could even be a trick interview question? Read on!</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s34" style="padding-left: 43pt;text-indent: 0pt;text-align: justify;">A special search case</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Suppose you had an array of numbers and wanted to run a sanity check, studying whether any of them<br/>were NaN. How would you do this? A tip: don’t try checking the types of the array elements—even<br/>though NaN stands for not a number, typeof NaN </span><i>is </i><span>&quot; number&quot;. You’ll get a surprising result if<br/>you try to search in an obvious way:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 55pt;text-indent: 0pt;text-align: left;">[1, 2, NaN, 4].findindex((x) =&gt; x === NaN); // -1</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 126%;text-align: justify;"><span>What’s going on here? It’s a bit of interesting JavaScript trivia: NaN is the only value that isn’t equal<br/>to itself. Should you need to look for NaN, you’ll have to use the new isNaN () function as follows:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 55pt;text-indent: 0pt;text-align: left;">[1, 2, NaN, 4].findindex(x =&gt; isNaN(x)); // 2</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 21pt;text-indent: 0pt;text-align: left;">142  Programming Declaratively - A Better Style</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>ESLint  would  help  with  the  use-  isnan  rule:  see  eslint.  org/docs/latest/rules/<br/>use- isnan for more on this. </span><i>Figure 5.5 </i>shows the result.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s191" style="padding-left: 189pt;text-indent: 0pt;text-align: left;">var <span style=" color: #000;">NaN: number</span></p><p class="s192" style="padding-top: 5pt;padding-left: 189pt;text-indent: 0pt;text-align: left;">Use the isNaN function to compare with NaN. eslint(<span style=" color: #277EB3;">use-isnan)</span></p><p class="s194" style="padding-top: 5pt;padding-left: 189pt;text-indent: 0pt;text-align: left;">View Problem Quick Fix... (Ctrl+.)</p><p class="s191" style="padding-top: 2pt;padding-left: 52pt;text-indent: 0pt;text-align: justify;"><span style=" color: #164DA9;">[1, </span><span style=" color: #000;">2, </span>NaN, 4]<span style=" color: #393953;">,findlndex((x) </span>=&gt; <span style=" color: #000;">x </span>NaN); <span class="s141">// -1</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 139pt;text-indent: 0pt;text-align: left;">Figure 5.5 - ESLint prevents you from a NaN-related mistake</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>This was a particular case worth knowing about; I had to deal with it once! Now, let’s continue as we<br/>have done previously, by emulating the searching methods with reduce () so that we can see more<br/>examples of the power of that function.</span></p><p class="s34" style="padding-top: 9pt;padding-left: 52pt;text-indent: 0pt;text-align: justify;">Emulating find() and findlndexf) with reduce()</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>As with the other methods, let’s finish this section by studying how to implement the methods we<br/>showed by using the omnipotent reduce (). This is a good exercise to get accustomed to working<br/>with HOFs, even if you will never actually use these polyfills!</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>The f ind () method requires a bit of work. We start the search with an undefined value, and if<br/>we find an array element so that the predicate is true, we change the accumulated value to that of<br/>the array:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;line-height: 141%;text-align: left;"><span>arr.find(fn); // or arr.find((x) =&gt; fn(x));<br/>arr.reduce(</span></p><p style="padding-left: 76pt;text-indent: 0pt;text-align: left;">(x,  y)  =&gt;  <b>(x  ===  undefined  &amp;&amp;  fn(y)  ?  y  :  x),</b></p><p style="padding-top: 4pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">undefined</p><p style="padding-top: 5pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>In terms of performance, there’s a slight difference with the standard f ind () method. The language<br/>specification  (at  tc3  9.  es/ecma262/#sec-array.  prototype  .  find)  shows  that  the  search<br/>stops    as soon as an element satisfies the search. Our code, however, keeps processing the rest of the<br/>array (because that’s how reduce () works), although it doesn’t evaluate the predicate again; can<br/>you see why?</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>For f indlndex (), we must remember that the callback function receives the accumulated value,<br/>the array’s current element, and the index of the current element, but other than that, the equivalent<br/>expression is quite similar to the one for f ind (); comparing them is worth the time:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;text-align: left;">arr.findindex(fn);</p><p style="padding-top: 4pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">arr.reduce((x, y, i) =&gt; (x == -1 &amp;&amp; fn(y) ? i : x) , -1);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: right;">Logical HOFs  143</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>The initial accumulated value is -1 here, which will be the returned value if no element fulfills the<br/>predicate. Whenever the accumulated value is still -1, but we find an element that satisfies the predicate,<br/>we change the accumulated value to the array index.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: justify;"><span>OK, we are now done with searches: let’s move on to considering higher-level predicates that will<br/>simplify testing arrays for a condition, but always in the declarative style we’ve been using so far.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 44pt;text-indent: 0pt;text-align: justify;"><a name="bookmark202">Higher-level predicates - everyO and some()</a></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: justify;"><span>The last functions we will consider greatly simplify going through arrays to test for conditions. These<br/>functions are as follows:</span></p><ul id="l57"><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">every (), which is true if and only if every element in the array satisfies a given predicate</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">some (), which is true if at least one element in the array satisfies the predicate</p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: justify;">For example, we could quickly check our hypothesis about all the countries having negative coordinates:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">markers.every((v) =&gt; v.lat &lt; 0 &amp;&amp; v.lon &lt; 0); // false</p><p style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">markers.some((v) =&gt; v.lat &lt; 0 &amp;&amp; v.lon &lt; 0);               // true</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: justify;"><span>If we want to find equivalents to these two functions in terms of reduce (), the two alternatives<br/>show nice symmetry:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">arr.every(fn);</p><p style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">arr.reduce((x, y) =&gt; x &amp;&amp; fn(y), true);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">arr.some(fn);</p><p style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">arr.reduce((x, y) =&gt; x || fn(y), false);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>The first folding operation evaluates fn (y) and ANDs the result with the previous tests; the only<br/>way the final result will be true is if every test succeeds. The second folding operation is similar, but<br/>ORs the result with the previous results and will produce true unless every test fails.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 57pt;text-indent: 0pt;text-align: left;"><a name="bookmark203">Boolean duality</a></p><p style="padding-top: 4pt;padding-left: 57pt;text-indent: 0pt;line-height: 115%;text-align: left;"><span>In terms of Boolean algebra, the alternative formulations for every () and some () exhibit<br/>duality. This duality is the same kind that appears in the x === x &amp;&amp; true and x === x</span></p><p style="padding-left: 57pt;text-indent: 8pt;line-height: 115%;text-align: left;"><span>| false expressions; if x is a Boolean value, and we exchange &amp;&amp; and | |, and also true<br/>and false, then we transform one expression into the other, and both are valid.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 21pt;text-indent: 0pt;text-align: left;">144  <span class="p">Programming Declaratively - A Better Style</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: justify;"><span>In this section, we saw how to check for a given Boolean condition. Let’s finish by seeing how to check<br/>a negative condition by inventing a method of our own.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 52pt;text-indent: 0pt;text-align: justify;"><a name="bookmark204">Checking negatives - none()</a></p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>If you wanted, you could also define none () as the complement of every (). This new function<br/>would be true only if none of the elements of the array satisfied the given predicate. The simplest<br/>way of coding this would be by noting that if no elements satisfy the condition, then all elements<br/>satisfy the negation of the condition:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 73pt;text-indent: -11pt;line-height: 142%;text-align: left;"><span>const none = &lt;T&gt;(arr: T [], fn: (x: T) =&gt; boolean) =&gt;<br/>arr.</span><b>every((v) =&gt; !fn(v));</b></p><p style="padding-top: 8pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>You can turn it into a method by modifying the array prototype, as we saw earlier. It’s still a bad<br/>practice, but it’s what we have until we start looking into better methods for composing and chaining<br/>functions, which we will do in </span><i>Chapter 8, Connecting Functions:</i></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s9" style="padding-left: 62pt;text-indent: 0pt;text-align: left;">I<span class="p">/ continued...</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 74pt;text-indent: -12pt;line-height: 144%;text-align: left;"><span>declare global {<br/>interface Array&lt;T&gt; {</span></p><p class="s10" style="padding-left: 85pt;text-indent: 0pt;line-height: 10pt;text-align: left;">none(f: (x: T) =&gt; boolean): boolean;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 73pt;text-indent: -12pt;line-height: 142%;text-align: left;"><span>Array.prototype.none   =   function   (fn)   {<br/>return this.every((v) =&gt; Ifn(v));</span></p><p style="padding-top: 2pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">};</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>We had to use function () instead of an arrow function for the same reasons we saw on earlier<br/>occasions: we need this to be correctly assigned. We also had to add a global definition like when we<br/>used averages so that TypeScript wouldn’t object to the newly added none () method. Other than that,<br/>it’s simple coding, and we now have a none () method available for all arrays. In </span><i>Chapter 6, Producing</i>we will see yet other ways of negating a function by writing an appropriate HOF of our own.</p><p style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>In this and the preceding section, we worked with everyday problems and saw how to solve them<br/>declaratively. However, things change a bit when you start working with async functions. We will<br/>see in the following section that new solutions will be needed.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 328pt;text-indent: 0pt;text-align: left;">Working with async functions  145</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-left: 43pt;text-indent: 0pt;text-align: justify;"><a name="bookmark205">Working with async functions</a></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>All the examples and code we studied in the previous sections were meant to be used with common<br/>functions, specifically meaning </span><i>not </i><span>async ones. When you want to do mapping, filtering, reducing,<br/>and  so on, but the function you are using is an async one, the results may surprise you. To simplify<br/>our work and not deal with actual API calls, let’s create a fakeAPI (delay, value) function<br/>that will delay a while before returning the given value:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// async.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">const fakeAPI = &lt;T&gt;(delay: number, value: T): Promise&lt;T&gt; =&gt;</p><p class="s10" style="padding-top: 4pt;padding-left: 64pt;text-indent: 0pt;text-align: left;"><a name="bookmark206">new Promise((resolve) =&gt;</a></p><p class="s10" style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;text-align: left;"><a name="bookmark207">setTimeout(() =&gt; resolve(value), delay)</a></p><p class="s10" style="padding-top: 5pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>Let’s also have a function to display what f akeAPI () returns so that we can see that things are<br/>working as expected:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 65pt;text-indent: -12pt;line-height: 143%;text-align: left;"><span>const useResult = (x: any): void =&gt;<br/>console.log(new Date(), x) ;</span></p><p style="padding-top: 8pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>We are using the modern async and await features from ES2017 to simplify our code, and we are<br/>avoiding the top-level await:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// async.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 64pt;text-indent: -9pt;line-height: 145%;text-align: left;"><span>(async () =&gt; {<br/>console.log(&quot;START&quot;);<br/>console.log(new          Date() ) ;</span></p><p style="padding-left: 64pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>const result = await fakeAPI(1000, 229);<br/>useResult(result);</span></p><p style="padding-left: 65pt;text-indent: 0pt;line-height: 10pt;text-align: left;">console.log(&quot;END&quot;);</p><p style="padding-top: 5pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">}) 0;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-top: 6pt;padding-left: 53pt;text-indent: 0pt;text-align: left;"><a name="bookmark208">/*</a></p><p class="s10" style="padding-top: 2pt;padding-left: 53pt;text-indent: 0pt;text-align: left;"><a name="bookmark209">START</a></p><p class="s10" style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;"><a name="bookmark210">2022 -10 -29T01:28 :12.986Z</a></p><p class="s10" style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">2022-10-29T01:28 : 13.989Z 229</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 21pt;text-indent: 0pt;text-align: left;">146  Programming Declaratively - A Better Style</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 61pt;text-indent: 0pt;text-align: left;"><a name="bookmark211">END</a></p><p class="s17" style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">*/</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>The results are previsible: we get the START text, then about 1 second (1,000 milliseconds) later, the<br/>result of the fake API call (22 9), and finally the END text. What could go wrong?</span></p><p class="s10" style="padding-top: 3pt;padding-left: 52pt;text-indent: 0pt;text-align: left;"><a name="bookmark212">/</a><span class="p">                                                    </span>X<a name="bookmark213">&zwnj;</a></p><p class="s10" style="padding-top: 3pt;padding-left: 65pt;text-indent: 0pt;text-align: justify;">Top-level await</p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;line-height: 115%;text-align: justify;">Why are we using the immediate invocation pattern we saw in <i>Chapter 3, Starting Out with</i><span>The reason is that the use of await at the top level has been available for Node,<br/>js since version 14.8 (August 2020) and browsers since 2021, so it’s not yet widespread. So,<br/>as you can only use await within an async function, I opted to go with an IIFE here for<br/>major compatibility.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">The critical problem is that all the functions we saw earlier in this chapter are not <i>async-aware, so</i></p><p style="padding-top: 2pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">they won’t work as you’d expect. Let’s start looking at this.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 52pt;text-indent: 0pt;text-align: left;"><a name="bookmark214">Some strange behaviors</a></p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Let’s start with a simple quiz: are results what you expected? Let’s look at a couple of examples of code<br/>involving async calls, and we’ll see some unexpected results. First, let’s look at a typical straightforward<br/>sequence of async calls:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: justify;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 64pt;text-indent: 0pt;text-align: justify;">(async () =&gt; {</p><p style="padding-top: 4pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">console.log(&quot;START SEQUENCE&quot;);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 73pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>const xl = await fakeAPI(1000, 1);<br/>useResult(xl);</span></p><p style="padding-left: 73pt;text-indent: 0pt;line-height: 143%;text-align: left;"><span>const x2 = await fakeAPI(2000, 2);<br/>useResult(x2);</span></p><p style="padding-left: 73pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>const x3 = await fakeAPI(3000, 3);<br/>useResult(x3);</span></p><p style="padding-left: 73pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>const x4 = await fakeAPI(4000, 4);<br/>useResult(x4);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 73pt;text-indent: 0pt;text-align: left;">console.log(&quot;END SEQUENCE&quot;);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 12pt;padding-left: 328pt;text-indent: 0pt;text-align: left;">Working with async functions  147</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>If you run this code, you’ll get the following results, which are indeed what you would expect—a<br/>START SEQUENCE text, four individual lines with the results of the fake API calls, and a final END<br/>SEQUENCE text. Nothing special here—everything is fine!</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 53pt;text-indent: 0pt;text-align: left;">START SEQUENCE</p><p class="s10" style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">2022-10-29T01:32:11.671Z 1</p><p class="s10" style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">2022-10-29T01:32:13.677Z 2</p><p class="s10" style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">2022-10-29T01:32 : 16.680Z 3</p><p class="s10" style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;line-height: 143%;text-align: left;"><a name="bookmark215"><span>2022-10-29T01:32 :20.683Z 4<br/>END SEQUENCE</span></a></p><p style="padding-top: 8pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>Let’s go for an alternative second version, which you’d expect to be equivalent to the first one. The only<br/>difference here is that we are using looping to do the four API calls; it should be the same, shouldn’t</span></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: left;">it? (We could also have used a forEach () loop with the range () function that we saw earlier,</p><p style="padding-top: 2pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>but that makes no difference.) I kept using an IIFE, though in this particular case, it wasn’t needed;<br/>can you see why?</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 8pt;padding-left: 54pt;text-indent: 0pt;text-align: left;">(() =&gt; {</p><p style="padding-top: 3pt;padding-left: 64pt;text-indent: 0pt;text-align: left;">console.log(&quot;START FOREACH&quot;);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 67pt;text-indent: 0pt;text-align: left;">[1, 2, 3, 4].forEach(async (n) =&gt; {</p><p style="padding-top: 4pt;padding-left: 76pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>const x = await fakeAPI(n * 1000, n) ;<br/>useResult(x);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 6pt;padding-left: 64pt;text-indent: 0pt;text-align: left;">console.log(&quot;END FOREACH&quot;);</p><p style="padding-top: 5pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">}) ();</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: left;">This code certainly looks equivalent to the first one, but it produces something entirely different!</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 52pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>START FOREACH<br/>END FOREACH</span></p><p class="s10" style="padding-left: 53pt;text-indent: 0pt;line-height: 10pt;text-align: left;">2022-10-29T01:34:06.287Z 1</p><p class="s10" style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">2022-10-29T01:34:07.287Z 2</p><p class="s10" style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">2022-10-29T01:34 : 08.286Z 3</p><p class="s10" style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">2022-10-29T01:34 : 09.286Z 4</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 21pt;text-indent: 0pt;text-align: left;">148  Programming Declaratively - A Better Style</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>The END FOREACH text appears before the results of the API calls. What’s happening? The answer is<br/>what we mentioned before: methods similar to forEach () and the like are meant to be used with<br/>standard, sync function calls and behave strangely with async function calls.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>The key concept is that async functions always return promises, so after getting the START FOREACH<br/>text, the loop actually creates four promises (which will eventually be resolved at some point), </span><i>but</i>and our code goes on to print the END FOREACH text.</p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>The problem is not only with f orEach () but also affects all other similar methods. Let’s see how<br/>we can work around this situation and write async-aware functions to let us keep working in a<br/>declarative fashion, as we did earlier in the chapter.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 52pt;text-indent: 0pt;text-align: justify;"><a name="bookmark216">Async-ready looping</a></p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 126%;text-align: justify;"><span>If we cannot directly use methods such as f orEach (), map (), and the like, we’ll have to develop<br/>new versions of our own. Let’s see how to achieve this.</span></p><p class="s34" style="padding-top: 8pt;padding-left: 52pt;text-indent: 0pt;text-align: justify;">Looping over async calls</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Since async calls return promises, we can emulate f orEach () with reduce () by starting with<br/>a resolved promise and chaining to it the promises for each value in the array. The then () methods<br/>will be called in the proper order, so the results will be correct. The following piece of code manages<br/>to get the right, expected results:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-top: 7pt;padding-left: 73pt;text-indent: -12pt;line-height: 143%;text-align: left;"><span>const forEachAsync = &lt;T&gt;(<br/>arr: T [] ,</span></p><p class="s10" style="padding-left: 74pt;text-indent: 0pt;text-align: left;">fn: (x: T) =&gt; any</p><p class="s10" style="padding-top: 4pt;padding-left: 73pt;text-indent: -11pt;line-height: 146%;text-align: left;"><span>): Promise&lt;any&gt; =&gt;<br/>arr.reduce(</span></p><p class="s10" style="padding-left: 97pt;text-indent: -9pt;line-height: 143%;text-align: left;"><span>(promise: Promise&lt;void&gt;, value: T) =&gt;<br/>promise.then(() =&gt; fn(value)).</span></p><p class="s10" style="padding-left: 85pt;text-indent: 0pt;text-align: left;">Promise.resolve()</p><p class="s10" style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 64pt;text-indent: 0pt;text-align: left;">(async () =&gt; {</p><p style="padding-top: 4pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">console.log(&quot;START FOREACH VIA REDUCE&quot;);</p><p style="padding-top: 4pt;padding-left: 85pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>await forEachAsync([1, 2, 3, 4], async (n) =&gt; {<br/>const x = await fakeAPI(n * 1000, n);<br/>useResult(x);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 328pt;text-indent: 0pt;text-align: left;">Working with async functions  149</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: right;">});</p><p style="padding-top: 2pt;padding-left: 64pt;text-indent: 0pt;text-align: left;">console.log(&quot;END FOREACH VIA REDUCE&quot;);</p><p style="padding-top: 5pt;text-indent: 0pt;text-align: right;">}) ();</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: justify;">The result is as follows:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 53pt;text-indent: 0pt;line-height: 143%;text-align: left;"><span>START FOREACH VIA REDUCE<br/>2022-10-29T01:42:09.385Z 1</span></p><p class="s10" style="padding-left: 53pt;text-indent: 0pt;text-align: left;">2022-10-29T01:42:11.388Z 2</p><p class="s10" style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">2022-10-29101:42:14.391Z 3</p><p class="s10" style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;line-height: 142%;text-align: left;"><a name="bookmark217"><span>2022-10-29T01:42:18.392Z 4<br/>END FOREACH VIA REDUCE</span></a></p><p style="padding-top: 8pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>As forEachAsync () returns a promise, we must remember to await it before showing the final<br/>text message. Other than not forgetting all the await statements, the code is similar to what we build<br/>using f orEach () with the crucial difference being that this does work as expected!</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s34" style="padding-left: 43pt;text-indent: 0pt;text-align: justify;">Mapping async calls</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Can we use the other functions? Writing mapAsync (), a version of map () that can work with an<br/>async mapping function, is simple because you can take advantage of Promise . all () to create<br/>a promise out of an array of promises:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s9" style="padding-left: 53pt;text-indent: 0pt;text-align: left;">11 <span class="p">continued...</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-top: 7pt;padding-left: 64pt;text-indent: -12pt;line-height: 143%;text-align: left;"><span>const mapAsync = &lt;T, R&gt;(<br/>arr: T [] ,</span></p><p class="s10" style="padding-left: 65pt;text-indent: 0pt;line-height: 10pt;text-align: left;">fn: (x: T) =&gt; Promise&lt;R&gt;</p><p class="s10" style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">) =&gt; Promise.all(arr.map(fn));</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 54pt;text-indent: 0pt;text-align: left;">(async ()</p><p style="padding-top: 4pt;padding-left: 64pt;text-indent: 0pt;text-align: left;">console.log(&quot;START MAP&quot;);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 77pt;text-indent: -12pt;line-height: 141%;text-align: left;"><span>const mapped = await mapAsync([1, 2, 3, 4], async (n) =&gt; {<br/>const x = await fakeAPI(n * 1000, n) ;</span></p><p style="padding-left: 77pt;text-indent: 0pt;text-align: left;">return x * 10;</p><p style="padding-top: 6pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">});</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 5pt;padding-left: 64pt;text-indent: 0pt;text-align: left;">useResult(mapped);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 21pt;text-indent: 0pt;text-align: left;">150  Programming Declaratively - A Better Style</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 73pt;text-indent: 0pt;text-align: left;">console.log(&quot;END MAP&quot;);</p><p style="padding-top: 5pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">}) 0;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">We get the following:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 61pt;text-indent: 0pt;text-align: left;">START MAP</p><p class="s10" style="padding-top: 4pt;padding-left: 61pt;text-indent: 0pt;line-height: 142%;text-align: left;"><a name="bookmark218"><span>2022-10-29T01:47:06.726Z [ 10, 20, 30, 40 ]<br/>END MAP</span></a></p><p style="padding-top: 8pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: left;"><span>The structure of the solution is similar to the forEachAsync () code. As before, we must remember<br/>to await the result of mapAsync () before continuing the process. Other than that, the logic is<br/>straightforward, and the results are as expected; the mapping function delays for a while and returns<br/>10   times its input argument, and we see the correct output is produced.</span></p><p class="s34" style="padding-top: 8pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">Filtering with async calls</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>Filtering with an async function is a tad more complicated. We will have to use mapAsync () to<br/>produce an array of true or false results and then use the standard filter () method to pick</span></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>values out of the original array depending on what the async filtering function returned. Let’s try<br/>out a simple example, calling the API and accepting only even results utilizing a fakeFilter ()<br/>function, which, for our example, accepts even numbers and rejects odd ones:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 73pt;text-indent: -11pt;line-height: 146%;text-align: left;"><span>const fakeFilter = (value: number): Promise&lt;boolean&gt; =&gt;<br/>new Promise((resolve) =&gt;</span></p><p style="padding-left: 86pt;text-indent: 0pt;line-height: 10pt;text-align: left;">setTimeout(() = &gt; resolve(value % 2 === 0), 1000)</p><p style="padding-top: 5pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">The needed async filtering code is as follows:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-top: 7pt;padding-left: 73pt;text-indent: -12pt;line-height: 144%;text-align: left;"><span>const filterAsync = &lt;T&gt;(<br/>arr : T [] ,</span></p><p class="s10" style="padding-left: 74pt;text-indent: 0pt;line-height: 10pt;text-align: left;">fn: (x: T) =&gt; Promise&lt;boolean&gt;</p><p class="s10" style="padding-top: 5pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">) =&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 85pt;text-indent: -12pt;line-height: 143%;text-align: left;"><span>mapAsync(arr, fn).then((arr2) =&gt;<br/>arr.filter((v, i) =&gt; Boolean(arr2[i]))</span></p><p class="s10" style="padding-left: 74pt;text-indent: 0pt;text-align: left;">) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 328pt;text-indent: 0pt;text-align: left;">Working with async functions  151</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 64pt;text-indent: -9pt;line-height: 142%;text-align: left;"><span>(async () =&gt; {<br/>console.log(&quot;START FILTER&quot;);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 79pt;text-indent: -14pt;line-height: 144%;text-align: left;"><span>const filtered = await filterAsync(<br/>[1,                         2, 3, 4] ,</span></p><p style="padding-left: 76pt;text-indent: 0pt;text-align: left;">async (n) = &gt; {</p><p style="padding-top: 4pt;padding-left: 88pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>const x = await fakeFilter(n);<br/>return x;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 64pt;text-indent: 0pt;line-height: 142%;text-align: left;"><span>useResult(filtered);<br/>console.log(&quot;END FILTER&quot;);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: left;">The result is as follows:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 53pt;text-indent: 0pt;text-align: left;">START FILTER</p><p class="s10" style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;line-height: 144%;text-align: left;"><a name="bookmark219"><span>2022-10-29T01:56 :19.798Z [ 2, 4 ]<br/>END FILTER</span></a></p><p style="padding-top: 8pt;padding-left: 43pt;text-indent: 0pt;text-align: left;">Note that the result of the mapping of async calls is a Boolean array (arr2), which we then use with</p><p style="padding-top: 2pt;padding-left: 44pt;text-indent: 0pt;text-align: left;">f i 11 e r () to select elements from the original array of values (arr); this can be tricky to understand!</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s34" style="padding-left: 43pt;text-indent: 0pt;text-align: left;">Reducing async calls</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Finally, finding an equivalent for reduce () is a bit more complex, but not so much after the other<br/>functions that we’ve seen. The key idea is the same as for f orEachAsync (): each function call<br/>will return a promise, which must be awaited in order to update the accumulator in an upcoming<br/>then (). We set up this iteration with an initial promise that immediately resolves to the initial value<br/>for the accumulator:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 64pt;text-indent: -12pt;line-height: 142%;text-align: left;"><span>const reduceAsync = &lt;T, R&gt;(<br/>arr : T [] ,</span></p><p style="padding-left: 65pt;text-indent: 0pt;line-height: 142%;text-align: left;"><span>fn: (acc: R, val: T) =&gt; Promise&lt;R&gt;,<br/>init: R</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 64pt;text-indent: 0pt;text-align: left;">Promise.resolve(init).then((accum) =&gt;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 21pt;text-indent: 0pt;text-align: left;">152  Programming Declaratively - A Better Style</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 97pt;text-indent: -11pt;line-height: 143%;text-align: left;"><span>forEachAsync(arr, async (v: T) =&gt; {<br/>accum = await fn(accum, v);</span></p><p class="s10" style="padding-left: 86pt;text-indent: 0pt;text-align: left;">}).then(() =&gt; accum)</p><p class="s10" style="padding-top: 5pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">To do the reducing, let’s use an async fakeSum () function that will sum the API-returned values:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: justify;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 73pt;text-indent: -11pt;line-height: 144%;text-align: justify;"><span>const fakeSum = (<br/>valuel: number,<br/>value2: number</span></p><p style="padding-left: 62pt;text-indent: 0pt;line-height: 10pt;text-align: justify;">): Promise&lt;number&gt; =&gt;</p><p style="padding-top: 4pt;padding-left: 73pt;text-indent: 0pt;text-align: justify;">new Promise((resolve) =&gt;</p><p style="padding-top: 4pt;padding-left: 86pt;text-indent: 0pt;text-align: justify;">setTimeout(() =&gt; resolve(valuel + value2), 1000)</p><p style="padding-top: 5pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 6pt;padding-left: 64pt;text-indent: 0pt;text-align: left;">(async () =&gt; {</p><p style="padding-top: 4pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">console.log(&quot;START REDUCE&quot;);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 88pt;text-indent: -14pt;line-height: 149%;text-align: left;"><span>const summed = await reduceAsync(<br/>[1,                            2, 3, 4],</span></p><p style="padding-left: 85pt;text-indent: 0pt;line-height: 9pt;text-align: left;">async (_accum, n) =&gt; {</p><p style="padding-top: 4pt;padding-left: 97pt;text-indent: 0pt;text-align: left;">const accum = <b>await accum;</b></p><p style="padding-top: 4pt;padding-left: 97pt;text-indent: 0pt;line-height: 144%;text-align: left;">const x = <b>await fakeSum(accum, n);</b><span>useResult(&#39;accum=${accum} value=${x} &#39;);<br/>return x;</span></p><p style="padding-top: 2pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">b</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 73pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>useResult(summed);<br/>console.log(&quot;END REDUCE&quot;);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 322pt;text-indent: 0pt;text-align: left;">Working with parallel functions  153</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Note the critical detail: in our reducing function, we must first await the value of the accumulator<br/>and only afterward await the result of our async function. This is an important point you must not<br/>miss: since we are reducing in an async fashion, getting the accumulator is also an async matter,<br/>so we need to await both the accumulator and the new API call.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;text-align: justify;">The result shows four intermediate values and the final result:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 53pt;text-indent: 0pt;text-align: left;">START REDUCE</p><p class="s10" style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">2022-10-29T02 : 04 :20.862Z accum=0 value=l</p><p class="s10" style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">2022-10-29T02:04:21.864Z accum=l value=3</p><p class="s10" style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">2022-10-29T02:04:22.865Z accum=3 value=6</p><p class="s10" style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">2022-10-29T02:04:23.866Z accum=6 value=10</p><p class="s10" style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;line-height: 144%;text-align: left;"><a name="bookmark220"><span>2022-10-29T02 : 04 :23.866Z 10<br/>END REDUCE</span></a></p><p style="padding-top: 8pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>By looking at these equivalents, we have seen that async functions, despite producing problems with<br/>the usual declarative methods that we studied at the beginning of the chapter, may also be handled by<br/>similar new functions of our own, so we can keep the new style even for these cases. Even if we have<br/>to use a somewhat different set of functions, your code will still be declarative, tighter, and clearer;<br/>an all-around win!</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-left: 43pt;text-indent: 0pt;text-align: justify;"><a name="bookmark221">Working with parallel functions</a></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>JavaScript provides concurrency through async functions, meaning that several tasks can go on at<br/>the same time, even if a single CPU is doing all the jobs. </span><b>Web workers </b>(for the frontend) and <b>worker</b><span>(for the backend) allow processing in parallel in a different core, for better performance. This<br/>can offload work from the main thread and solve potential problems, in line with our FP approach.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>In this section, we’ll see how to avoid bottlenecks in frontend and backend programming by using<br/>workers in functional ways, along the lines of the previous sections in this chapter.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 44pt;text-indent: 0pt;text-align: justify;"><a name="bookmark222">Unresponsive pages</a></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;">Let’s return to our Fibonacci slow-performing code from the <i>Memoization </i><span>section in the previous<br/>chapter. Suppose we want to create a web page that will allow users to enter a number and calculate<br/>the corresponding Fibonacci number, as in </span><i>Figure 5.6.</i></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-left: 21pt;text-indent: 0pt;text-align: left;">154  <span class="s189">Programming Declaratively - A Better Style</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s197" style="padding-top: 4pt;padding-left: 71pt;text-indent: 0pt;text-align: left;">0 <span class="s104">Fibonacci</span><span class="s198">         </span><span class="s199">x</span></p><p class="s199" style="padding-top: 8pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">-&gt; O 0 <span class="s104">http://localhost:8887/test_worker_ 1.html &lt; •£? </span><span class="s200">O </span>P &#39;.* * 3 <span class="s104">s</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s201" style="padding-left: 66pt;text-indent: 0pt;text-align: left;">Fibonacci: <u>|22</u> |</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s101" style="padding-left: 65pt;text-indent: 0pt;text-align: left;">|<span class="s203"> </span><u>Locally </u>|</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s201" style="padding-top: 4pt;padding-left: 66pt;text-indent: 0pt;text-align: left;">Result: 17711</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 51pt;text-indent: 0pt;text-align: center;">Figure 5.6 - A Fibonacci calculator</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>The code for this page is very basic—and no, I’m not even trying to do any styling; that’s not the<br/>problem here!</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// workersZtest_worker_l.html</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">&lt;!DOCTYPE html&gt;</p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">&lt;html lang=&quot;en&quot;&gt;</p><p style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">&lt;head&gt;</p><p style="padding-top: 4pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">&lt;meta charset=&quot;UTF-8&quot; /&gt;</p><p style="padding-top: 4pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">&lt;title&gt;Fibonacci&lt;/title&gt;</p><p style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">&lt;/head&gt;</p><p style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">&lt;body&gt;</p><p style="padding-top: 4pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">Fibonacci:</p><p style="padding-top: 4pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">&lt;input id=&quot;num&quot; type=&quot;number&quot; min=&quot;0&quot; value=&quot;0&quot; /&gt;</p><p style="padding-top: 4pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">&lt;br /&gt;</p><p style="padding-top: 4pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">&lt;br /&gt;</p><p class="s10" style="padding-top: 4pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">&lt;button onclick=&quot;locally()&quot;&gt;Locally&lt;/button&gt;</p><p style="padding-top: 4pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">&lt;br /&gt;</p><p style="padding-top: 4pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">&lt;br / &gt;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 322pt;text-indent: 0pt;text-align: left;">Working with parallel functions  <span class="s153">155</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 76pt;text-indent: 0pt;text-align: left;">Result: &lt;span id=&quot;res&quot;&gt;&lt;/span&gt;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">&lt;script src=&quot;test_worker_l.j s&quot;&gt;&lt;/script&gt;</p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">&lt;/body&gt;</p><p style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">&lt;/html&gt;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: right;">The script code is as follows:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: right;">// workers/test_worker_l.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">function fib(n: number): number {</p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">return n &lt; 2 ? n : fib(n - 2) + fib(n - 1);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 65pt;text-indent: -12pt;line-height: 143%;text-align: left;"><span>function getNumber(): number {<br/>return Number(</span></p><p style="padding-left: 79pt;text-indent: 0pt;text-align: left;">(document.getElementByld(&quot;num&quot;)      as      HTMLInputElement)</p><p style="padding-top: 4pt;padding-left: 90pt;text-indent: 0pt;text-align: left;">.value</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 64pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>function    showResult(result:    number):    void    {<br/>document.getElementByld(&quot;res&quot;)!.innerText =</span></p><p style="padding-left: 76pt;text-indent: 0pt;line-height: 10pt;text-align: left;">String(result);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 65pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>function   locally():   void   {<br/>showResult(fib(getNumber()));</span></p><p class="s10" style="padding-top: 2pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>The corresponding Fibonacci number is calculated and shown when the user enters a number and<br/>clicks on the </span><b>Locally </b><span>button, but what happens if a fairly large number (say, around 50) is entered?<br/></span><i>Figure 5.7 </i>illustrates the problem.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 21pt;text-indent: 0pt;text-align: left;">156  Programming Declaratively - A Better Style</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 67pt;text-indent: 0pt;text-align: left;"><span><img width="497" height="231" alt="image" src="Image_024.jpg"/></span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 8pt;padding-left: 130pt;text-indent: 0pt;text-align: left;">Figure 5.7 - A long-running process eventually blocks the browser</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>As the code runs, the page becomes totally unresponsive, and you cannot click anywhere or enter a<br/>new number. Furthermore, if a process requires too much processing time, the browser will think<br/>there’s a problem and offer the user to kill the page... not what we want!</span></p><p style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: justify;"><span>What’s the solution? We want to offload the calculation to a worker, which will run in parallel, freeing<br/>the browser. Let’s see how we’d set this up in not a particularly functional way!</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 52pt;text-indent: 0pt;text-align: justify;"><a name="bookmark223">A frontend worker</a></p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Workers   (see   developer   .mozilla   .   org/en-US/docs/Web/API/Web_Workers_API<br/>for web workers and node j s . org/api/worker_threads . html for Node.js worker threads)<br/>work in similar ways. They are plain JavaScript code that can listen to messages, and after doing their<br/>work, they respond to their caller by sending another message.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;text-align: justify;">For our Fibonacci calculation, the following would do:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// workers/web_fib_worker.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">function fib(n: number): number {</p><p style="padding-top: 4pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">return  n  &lt;  2  ?  n  :  fib(n  -  2)  +  fib(n  -  1)  ;</p><p style="padding-top: 6pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-top: 5pt;padding-left: 73pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>onmessage    (e: MessageEvent&lt;number&gt;) =&gt;<br/>postMessage(fib(e.data)) ; ;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 12pt;padding-left: 322pt;text-indent: 0pt;text-align: left;">Working with parallel functions  157</p><p style="padding-top: 22pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>The last line of the code provides all the interaction between the caller and the worker. On getting a<br/>message, e, its e . data value is passed to the f ib () function, and the result is posted back to the caller.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;">How would this be used? <i>Figure 5.8 </i><span>shows the result we try to achieve. We now want to allow two ways<br/>of calculating Fibonacci numbers: locally, as before, subject to lengthy processing time problems, or<br/>in parallel, by offloading the job to a worker.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s199" style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">|| 0 <span class="s104">Fibonacci</span><span class="s198">          </span>x</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s199" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">O <span class="s104">® http://localhost:8887/test_worker_2.html &lt; </span><span class="s186">■ir </span><span style=" color: #E20D1B;">O </span>0               * Cl :</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s201" style="padding-left: 56pt;text-indent: 0pt;text-align: left;">Fibonacci: <u>[45 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </u>|</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s204" style="padding-left: 56pt;text-indent: 0pt;text-align: left;"><span class="s101">|</span><span class="s203"> </span>Locally <span class="s206">11 </span>Parallelly <span class="s101">|</span></p><p class="s201" style="padding-top: 10pt;padding-left: 57pt;text-indent: 0pt;text-align: left;">Result: 0</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 5pt;padding-left: 43pt;text-indent: 64pt;line-height: 26pt;text-align: left;"><span>Figure 5.8 - Calculating Fibonacci numbers by using workers as an option<br/>The new code is as follows; we’ll highlight the additions:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// workers/test_worker_2.html</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">&lt;!DOCTYPE html&gt;</p><p style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">&lt;html lang=&quot;en&quot;&gt;</p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">&lt;head&gt;</p><p style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">&lt;meta charset=&quot;UTF-8&quot; /&gt;</p><p style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">&lt;title&gt;Fibonacci&lt;/title&gt;</p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">&lt;/head&gt;</p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">&lt;body&gt;</p><p style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">Fibonacci:</p><p style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">&lt;input id=&quot;num&quot; type=&quot;number&quot; min=&quot;0&quot; value=&quot;0&quot; /&gt;</p><p style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">&lt;br / &gt;</p><p style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">&lt;br /&gt;</p><p style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">cbutton onclick=&quot;locally()&quot;&gt;Locally&lt;/button&gt;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 21pt;text-indent: 0pt;text-align: left;">158  Programming Declaratively - A Better Style</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 85pt;text-indent: 0pt;text-align: left;"><a name="bookmark224">cbutton onclick=&quot;parallelly()&quot;&gt;Parallelly&lt;/button&gt;</a></p><p style="padding-top: 4pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">&lt;br /&gt;</p><p style="padding-top: 4pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">&lt;br /&gt;</p><p style="padding-top: 4pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">Result: &lt;span id=&quot;res&quot;&gt;&lt;/span&gt;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">&lt;script src=&quot;test_worker_2.j s&quot;&gt;&lt;/script&gt;</p><p style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">&lt;/body&gt;</p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">&lt;/html&gt;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">The new script file is just like the previous one, with some additions at the end:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// workers/test_worker_2.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;text-align: left;">const worker = <b>new Worker(</b></p><p class="s10" style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">&quot;http://localhost:8887/test    fib    worker.j    s&quot;</p><p class="s10" style="padding-top: 5pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 6pt;padding-left: 74pt;text-indent: -12pt;line-height: 146%;text-align: left;"><a name="bookmark225">worker.onmessage = </a><b>(e: MessageEvent&lt;number&gt;) =&gt;</b><a name="bookmark226">&zwnj;</a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;line-height: 142%;text-align: left;"><span>/*     eslint-disable-next-line     */<br/>function parallelly(): void {</span></p><p class="s10" style="padding-left: 73pt;text-indent: 0pt;text-align: left;">worker.postMessage(getNumber());</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>The  new  Parallelly  button  calls  the  corresponding  parallelly  ()  function.  This  function<br/>gets the number that the user entered and posts it via a message to the worker that had been created<br/>earlier. The onmessage method of that worker receives the calculated result and shows it onscreen.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: justify;"><span>Using this method, the user can ask for any Fibonacci number, and the window will remain responsive,<br/>and no warning will pop up for the user to close the page; see </span><i>Figure 5.9.</i></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 322pt;text-indent: 0pt;text-align: left;">Working with parallel functions  159</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 56pt;text-indent: 0pt;text-align: left;"><span><img width="500" height="231" alt="image" src="Image_025.jpg"/></span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 8pt;padding-left: 100pt;text-indent: 0pt;text-align: left;">Figure 5.9 -The page remains responsive even as calculations take a long time</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>OK, using workers clearly helps if you have lots of calculations to perform at the frontend; let’s see a<br/>similar implementation for the backend.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 43pt;text-indent: 0pt;text-align: justify;"><a name="bookmark227">A backend worker</a></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Lets see a quick example of a backend worker, as we could use with Node.js or similar. The example<br/>will be very bare-bones; in real life, we’d include route definitions and much more, but we want to<br/>focus on worker creation and usage here.</span></p><p style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;text-align: justify;">Our worker is similar to the web worker; the differences are easy to understand:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// workers/fib_worker.ts</p><p style="padding-left: 53pt;text-indent: 0pt;line-height: 30pt;text-align: left;"><span>import { parentPort } from &quot;worker_threads&quot;;<br/>function fib(n: number): number {</span></p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">return n &lt; 2 ? n : fib(n - 2) + fib(n - 1);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 64pt;text-indent: -12pt;line-height: 142%;text-align: left;"><span>parentPort!.on(&quot;message&quot;,    (m:    number)    =&gt;<br/>parentPort!.postMessage(fib(m))</span></p><p class="s10" style="padding-top: 1pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 21pt;text-indent: 0pt;text-align: left;">160  <span class="p">Programming Declaratively - A Better Style</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>The idea is precisely the same; when the message event occurs, we call f ib () to calculate the<br/>corresponding Fibonacci number, and we use postMessage () to send it to the caller.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">The caller code would be simple too:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// workers/fib_worker_test.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">import { Worker } from &quot;worker_threads&quot;;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;text-align: left;"><a name="bookmark228">const worker = </a><b>new Worker(&quot;./fib_worker.js&quot;);</b></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>console.log(&quot;START&quot;);<br/></span><b>worker.postMessage(40) ;</b>console.log(&quot;END&quot;);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 73pt;text-indent: -12pt;line-height: 143%;text-align: left;"><span>worker.on(&quot;message&quot;, (msg) =&gt; {<br/>console.log(&quot;MESSAGE&quot;, msg);<br/>worker.terminate();</span></p><p class="s10" style="padding-top: 2pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">});</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: left;"><span>The code is totally analogous to the frontend code. We create a worker (with the new Worker ()<br/>call), we post a message to it with postMessage (), and we listen to the workers message event.<br/>When we receive the computed result, we display it, and terminate () the worker. Running this<br/>code produces the following simple result—the last line takes a while to appear!</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 61pt;text-indent: 0pt;line-height: 144%;text-align: left;"><a name="bookmark229"><span>START<br/>END</span></a></p><p class="s10" style="padding-left: 61pt;text-indent: 0pt;line-height: 10pt;text-align: left;">MESSAGE 102334155</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>We have seen how to use workers in event-oriented programming, but this isn’t particularly suited to<br/>our desired FP way of working; let’s fix that.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 52pt;text-indent: 0pt;text-align: left;"><a name="bookmark230">Workers, FP style</a></p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">Workers are appropriate for FP programming for the following reasons:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">Workers run in separate contexts, so they cannot interact with the DOM or global variables.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">All communication is done through messages; otherwise, workers are separated from their caller.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l58"><li data-list-text="•"><p style="padding-left: 79pt;text-indent: -12pt;line-height: 123%;text-align: justify;"><span>Data passed to and from workers is a copy; it is serialized before it is passed and deserialized<br/>when received. Even if the worker were to modify the arguments it received, that wouldn’t<br/>cause any problem for the caller.</span></p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 322pt;text-indent: 0pt;text-align: left;">Working with parallel functions  161</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>We can work with events, but it would be better to wrap workers in promises so we can apply the<br/>async functions we developed in the previous section.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 56pt;text-indent: 0pt;text-align: left;"><a name="bookmark231">Events or promises?</a></p><p style="padding-top: 4pt;padding-left: 57pt;text-indent: 0pt;line-height: 114%;text-align: left;"><span>Workers can send multiple messages to their caller. If this is the case, a promise wont be a good<br/>idea because it will be resolved after the first result, disregarding future messages. In most cases,<br/>a single result is expected, so promises are OK, but keep in mind there are other possibilities.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;text-align: left;">A direct way to wrap a worker would be the following:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;line-height: 283%;text-align: left;"><span>// workers/fib_worker_test_with_promise.ts<br/>import { Worker } from &quot;worker_threads&quot;;</span></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">const callWorker = (filename: string, value: unknown) =&gt;</p><p class="s10" style="padding-top: 4pt;padding-left: 64pt;text-indent: 0pt;text-align: left;">new Promise((resolve) =&gt; {</p><p class="s10" style="padding-top: 4pt;padding-left: 76pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>const worker = new Worker(filename);<br/>worker.on(&quot;message&quot;, resolve);<br/>worker.postMessage(value);</span></p><p style="padding-top: 2pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">});</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">console.log(&quot;START&quot;);</p><p style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>const result = await callworker(&quot;./fib_worker.js&quot;, 40);<br/>console.log(&quot;AWAITED&quot;, result);<br/>console.log(&quot;END&quot;);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">/* Result:</p><p class="s10" style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">START</p><p class="s10" style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;line-height: 142%;text-align: left;"><a name="bookmark232"><span>AWAITED 102334155<br/>END</span></a></p><p style="padding-top: 1pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">*/</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>The cal IWorker object we create is a promise that will resolve when the worker sends back a result.<br/>Results are as expected: the START text, the AWAITED result from the worker, and the END text. Note<br/>that we are using a point-free style for processing the message event.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: left;"><span>These code examples work well, but they have a performance issue: every time you call them, a worker<br/>is created (meaning that its JavaScript code must be read, parsed, and processed), so there will be<br/>delays. Let’s think about ways to avoid that.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 21pt;text-indent: 0pt;text-align: left;">162  Programming Declaratively - A Better Style</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-top: 6pt;padding-left: 53pt;text-indent: 0pt;text-align: justify;"><a name="bookmark233">Long-living pooled workers</a></p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Workers can stay unterminated and will be able to receive new messages and reply to them. Messages<br/>get queued, so if you need to use the same worker more than once at the same time, there will be a<br/>logical delay; calls will go out sequentially. If you need a worker and its free, you can call it directly,<br/>but if you need it and it’s occupied, it makes sense to create a new worker. We’ll keep a pool of threads,<br/>and whenever a call comes in, we’ll check whether there’s an available worker to deal with it or whether<br/>we need to create a new worker first.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;text-align: justify;">Let’s see how to do this. First, we’ll need a pool:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// workers/pool. ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">import { Worker } from &quot;worker_threads&quot;;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-top: 7pt;padding-left: 73pt;text-indent: -11pt;line-height: 143%;text-align: left;"><span>type PoolEntry = {<br/>worker: Worker;<br/>filename: string;<br/>value: any;<br/>inUse: boolean;</span></p><p class="s10" style="padding-top: 2pt;padding-left: 62pt;text-indent: 0pt;text-align: left;"><a name="bookmark234">};</a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;text-align: left;">const <b>pool: PoolEntry [] = [] ;</b></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: justify;">The PoolEntry objects will have the following:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l59"><li data-list-text="•"><p style="padding-left: 79pt;text-indent: -13pt;text-align: left;">The worker object.</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 79pt;text-indent: -13pt;text-align: left;">The filename corresponding to the path with which the worker was created.</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 79pt;text-indent: -13pt;line-height: 125%;text-align: left;"><span>The value with which it was called the last time we used this worker (just for logging; we can<br/>do without it).</span></p></li><li data-list-text="•"><p style="padding-top: 5pt;padding-left: 79pt;text-indent: -13pt;text-align: left;">the inUse flag to show whether it’s available or not. pool is just an array of PoolEntry objects.</p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>We need a function that will allow us to call a worker; let’s name it workerCal 1 (). We’ll have<br/>to specify the filename of the function to call, and the value to pass to it. The function will first see<br/>whether there’s an appropriate available free worker (with the same filename and not in use) in a very<br/>declarative fashion; if no worker of this kind is found, it will create a new one. Then, the worker will<br/>be called by using a promise, as in the previous section, and when a result comes, the worker will be<br/>marked as not in use, ready for a new call:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 322pt;text-indent: 0pt;text-align: left;">Working with parallel functions  163</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 65pt;text-indent: -12pt;line-height: 144%;text-align: left;"><span>export const workerCall = (<br/>filename: string,</span></p><p style="padding-left: 64pt;text-indent: 0pt;text-align: left;">value: any</p><p style="padding-top: 4pt;text-indent: 0pt;text-align: right;">): Promise&lt;any&gt; =&gt; {</p><p class="s10" style="padding-top: 4pt;text-indent: 0pt;text-align: right;"><a name="bookmark235">let available = pool</a></p><p class="s10" style="padding-top: 4pt;padding-left: 78pt;text-indent: 0pt;text-align: left;">•filter((v) =&gt; !v.inUse)</p><p class="s10" style="padding-top: 4pt;padding-left: 78pt;text-indent: 0pt;text-align: left;">.find((x) =&gt; x.filename ===        filename);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">if (available === undefined) {</p><p style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">// console.log(&quot;CREATING&quot;, filename, value);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 76pt;text-indent: 0pt;text-align: left;">available = {</p><p style="padding-top: 4pt;padding-left: 89pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>worker: new Worker(filename),<br/>filename,</span></p><p style="padding-left: 89pt;text-indent: -1pt;line-height: 144%;text-align: left;"><span>value,<br/>inUse: true,</span></p><p style="padding-left: 77pt;text-indent: 0pt;line-height: 10pt;text-align: left;">} as PoolEntry;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 76pt;text-indent: 0pt;text-align: left;">pool.push(available),-</p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">} else {</p><p style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">// console.log(&quot;REUSING&quot;, filename, available.value);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 76pt;text-indent: -12pt;line-height: 143%;text-align: left;"><span>return new Promise((resolve) =&gt; {<br/>available!.inUse = true;<br/>available!.worker.on(&quot;message&quot;, (x) =&gt; {</span></p><p style="padding-left: 89pt;text-indent: 0pt;text-align: left;">resolve(x);</p><p style="padding-top: 4pt;padding-left: 88pt;text-indent: 0pt;text-align: left;">available 1.inUse = false;</p><p style="padding-top: 4pt;padding-left: 89pt;text-indent: 0pt;text-align: left;">// console.log(&quot;RESOLVING&quot;, filename, value, x) ;</p><p style="padding-top: 6pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">});</p><p style="padding-top: 2pt;padding-left: 76pt;text-indent: 0pt;text-align: left;">available!.worker.postMessage(value);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 8pt;padding-left: 43pt;text-indent: 0pt;line-height: 120%;text-align: left;"><span>We can see how this works with our previous Fibonacci worker, plus a new random one that delays<br/>a while before returning a random number:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// workers/random_worker.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-left: 21pt;text-indent: 0pt;text-align: left;">164  <span class="s189">Programming Declaratively - A Better Style</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">import { parentPort } from &quot;workerthreads&quot;;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-top: 7pt;padding-left: 73pt;text-indent: -12pt;line-height: 143%;text-align: left;"><span>async function randomfn: number): Promiseenumber&gt; {<br/>await new Promise((resolve) =&gt; setTimeout(resolve, n));<br/>return Math.floor(n * Math.random());</span></p><p class="s10" style="padding-top: 2pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 73pt;text-indent: -12pt;line-height: 143%;text-align: left;"><span>parentPort1.on(&quot;message&quot;, async (m) =&gt;<br/>parentPort!.postMessage(await random(m))</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: right;">We can verify this works:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: right;">// workers/pool_test.ts</p><p style="padding-top: 3pt;padding-left: 61pt;text-indent: 0pt;line-height: 30pt;text-align: left;"><span>import { workerCall } from &quot;./pool&quot;;<br/>const FIBWORKER = &quot;./fibworker.js&quot;;</span></p><p style="padding-left: 61pt;text-indent: 0pt;text-align: left;">const RANDOM_WORKER = &quot;./random_worker.js&quot;;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 73pt;text-indent: -12pt;line-height: 144%;text-align: left;"><span>const showResult           (s: string) =&gt; (x: any) =&gt;<br/>console.log(s , x) ;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;line-height: 143%;text-align: left;"><span>workerCall(FIB_WORKER, 35).then(showResult(&quot;fib(35)&quot;));<br/>workerCall(RANDOM_WORKER, 3000).then(showResult(&quot;random&quot;));<br/>workerCall(FIB_WORKER,                                                          2 0).then(showResult(&quot;fib(2 0)&quot;)) ;<br/>workerCall(FIB_WORKER, 44).then(showResult(&quot;fib(44)&quot;));<br/>workerCall(FIB—WORKER, 10).then((x) =&gt; {</span></p><p style="padding-left: 73pt;text-indent: 0pt;text-align: left;">console.log(&quot;fib(10)&quot;, <i>x) ;</i></p><p style="padding-top: 4pt;padding-left: 85pt;text-indent: -12pt;line-height: 143%;text-align: left;"><span>workerCall(FIB_WORKER, ll).then((y) =&gt;<br/>console.log(&quot;fib(11)&quot;, y)</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">});</p><p style="padding-top: 2pt;padding-left: 61pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>workerCall(RANDOM_WORKER, 2000).then(showResult(&quot;random&quot;));<br/>workerCall(RANDOM_WORKER, 1000).then(showResult(&quot;random&quot;));</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 403pt;text-indent: 0pt;text-align: left;">Summary  165</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>The results of running this code are as follows—but I disabled the &quot;Resolving&quot; logging line since<br/>I was also logging output in another way:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 52pt;text-indent: 0pt;line-height: 143%;text-align: left;"><span>CREATING ./fibworker.js 35<br/>CREATING ./random worker.js 3000<br/>CREATING ./fib worker.js 20<br/>CREATING ./fib_worker.js 44</span></p><p class="s10" style="padding-left: 52pt;text-indent: 0pt;text-align: left;">CREATING ./fibworker.js 10</p><p class="s10" style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;line-height: 143%;text-align: justify;"><span>CREATING ./random_worker.js 2000<br/>CREATING ./random worker.js 1000<br/>fib(10)                    55</span></p><p class="s10" style="padding-left: 52pt;text-indent: 0pt;text-align: left;">REUSING ./test_fib_worker.js 10</p><p class="s10" style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">fib(11) 89</p><p class="s10" style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">fib(20) 6765</p><p class="s10" style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">fib(35) 9227465</p><p class="s10" style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">random 602</p><p class="s10" style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">random 135</p><p class="s10" style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">random 17</p><p class="s10" style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">fib(44) 701408733</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>The results of Fibonacci calls come in order; this is logical since we know their calculation time<br/>grows. The 3 calls to the random worker take a bit longer, but less than the calculation of the 44</span><span class="s162">th<br/></span>Fibonacci number.</p><p style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: justify;">Notice that we didn’t ask for the 11<span class="s162">th </span>Fibonacci number until the result for the 10<span class="s162">th </span><span>had come in. Our<br/>pool correctly detected it had an available worker to use, and it didn’t create a new one.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;">You could explore several extra ideas (see the <i>Questions </i><span>section at the end of this chapter), but we<br/>achieved an efficient solution that let us run functional code in parallel with good performance; a<br/>nice win!</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-left: 43pt;text-indent: 0pt;text-align: left;"><a name="bookmark236">Summary</a></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>In this chapter, we started working with HOFs to show a more declarative way of working with shorter,<br/>more expressive code. We went over several operations: we used reduce () and reduceRight () to<br/>get a single result from an array, map () to apply a function to each element of an array, f orEach ()<br/>to simplify looping, flat () and f latMap () to work with arrays of arrays, filter () to pick<br/>elements from an array, f ind () and f indlndex () to search in the arrays, and every () and<br/>some () (plus a made-up none ()) to verify general logic conditions. We then considered some<br/>unexpected situations when you deal with async functions, and we wrote special functions for those<br/>cases. Finally, we showed how to do parallel work functionally for extra performance.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 21pt;text-indent: 0pt;text-align: left;">166  Programming Declaratively - A Better Style</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;">In <i>Chapter 6, Producing Functions, </i><span>we will continue working with HOFs, but we will write our own<br/>ones to gain more expressive power for our coding.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-left: 52pt;text-indent: 0pt;text-align: left;"><a name="bookmark237">Questions</a></p><ol id="l60"><ol id="l61"><li data-list-text="5.1"><p style="padding-top: 9pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: left;"><b>Generating HTML code, with restrictions: </b><span>Using the filter () -&gt; map () -&gt; reduced<br/>sequence is quite common (even though sometimes you won’t use all three), and we’ll come back<br/>to  this in the </span><i>Functional design patterns </i>section of <i>Chapter 11, Implementing Design Patterns. </i><span>The<br/>problem here is how to use those functions (and no others!) to produce an unordered list of elements<br/>(&lt;ul &gt; . . . &lt; /ul &gt;) that can later be used onscreen. Your input is an array of characters such as the</span></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>following (does the list date me?), and you must produce a list of each name that corresponds to chess<br/>or checkers players:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;text-align: left;">const characters = [</p><p style="padding-top: 4pt;padding-left: 75pt;text-indent: 0pt;text-align: left;">{ name: &quot;Fred&quot;, plays: &quot;bowling&quot; },</p><p style="padding-top: 4pt;padding-left: 75pt;text-indent: 0pt;text-align: left;">{ name: &quot;Barney&quot;, plays: &quot;chess&quot; },</p><p style="padding-top: 4pt;padding-left: 75pt;text-indent: 0pt;text-align: left;">{ name: &quot;Wilma&quot;, plays: &quot;bridge&quot; },</p><p style="padding-top: 4pt;padding-left: 75pt;text-indent: 0pt;text-align: left;">{ name: &quot;Betty&quot;, plays: &quot;checkers&quot; },</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 85pt;text-indent: 0pt;text-align: left;">name:  &quot;Pebbles&quot;, plays: &quot;chess&quot; },</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>The output would be something like the following (although it doesn’t matter if you don’t generate<br/>spaces and indentation). It would be easier if you could use, say, j oin (), but in this case, it won’t be<br/>allowed; only the three functions mentioned can be used:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">&lt;div&gt;</p><p style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">&lt;ul&gt;</p><p style="padding-top: 4pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">&lt;li&gt;Barney&lt;/li&gt;</p><p style="padding-top: 4pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">&lt;li&gt;Betty&lt;/li&gt;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 86pt;text-indent: 0pt;text-align: left;">&lt;li&gt;Pebbles&lt;/li&gt;</p><p style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">&lt;/ul&gt;</p><p style="padding-top: 4pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">&lt;/div&gt;;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 12pt;padding-left: 401pt;text-indent: 0pt;text-align: left;">Questions  167</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="5.2"><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><b>More formal testing: </b>In some preceding examples, such as those in the <i>Emulating map() with</i><span>section, we didn’t write actual unit tests but were satisfied with doing some console logging.<br/>Can you write appropriate unit tests instead?</span></p></li><li data-list-text="5.3"><p style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><b>Reverse by summing: </b><span>When we wrote our reverseString2 () function, we used a summing<br/>function for the reduction, but we already had written a sum () function in the </span><i>Summing an array</i>section; couldn’t we use it here? Why not? How can we solve that?</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 12pt;text-indent: 0pt;text-align: center;">const reverseString2 = (str: string): string = &gt;</p><p class="s10" style="padding-top: 4pt;padding-left: 51pt;text-indent: 0pt;text-align: center;">str.split(&quot;&quot;).reduceRight(sum, &quot;&quot;);</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="5.4"><p class="s10" style="padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: justify;">Reversed  reverse?:  <span class="p">What  would  happen  with  our  reverseString2  ()  function  (see the<br/>previous question) if we summed x and y the reverse way, writing this instead?</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">const reversedReverse = (str: string): string =&gt;</p><p class="s10" style="padding-top: 4pt;padding-left: 51pt;text-indent: 0pt;text-align: center;">str.splitreduceRight((x, y) =&gt; y + x,</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="5.5"><p class="s10" style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;">Ranging far and wide: <span class="p">The range () function we saw here has many uses but lacks a bit of<br/>generality. Can you expand it to allow for descending ranges, as in, range (10,1)? (What should<br/>the last number in the range be?) Could you also include a step size to specify the difference between<br/>consecutive numbers in the range? With this, range (1,10,2) would produce [1, 3, 5, 7, 9],</span></p></li><li data-list-text="5.6"><p class="s10" style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;">Range generators: <span class="p">JavaScript’s </span>generators <span class="p">allow another solution to our range () function.<br/>Instead of first generating a whole array of numbers and then processing them, a generator-based<br/>solution generates the range numbers one at a time. Can you provide such an implementation?</span></p></li><li data-list-text="5.7"><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><b>Doing the alphabet: </b>What would have happened in the <i>Working with ranges </i><span>section if instead<br/>of  writing  map  (x  =&gt;  String  .  fromCharCode  (x)  ),  you  had  written  map  (String .<br/>fromCharCode) ? Can you explain the different behavior? Hint: we have seen a similar problem<br/>elsewhere  in this chapter.</span></p></li><li data-list-text="5.8"><p class="s10" style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;">Producing a CSV: <span class="p">In a certain scenario, you may want to enable the user to download a dataset<br/>as a </span>comma-separated value (CSV) <span class="p">file by using a data URI. (You can read more about this at<br/>en.  wikipedia  .  org/wiki/Data_URI_scheme.)  Of  course,  the  first  problem  is  producing<br/>the CSV itself! Assume that you have an array of arrays of numeric values, as shown in the following<br/>snippet, and write a function that will transform that structure into a CSV string that you will then<br/>be able to plug into the URI. As usual, \n stands for the newline character:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">let myData = [[1, 2, 3, 4], [5, 6, 7, 8], [9, 10, 11, 12]];</p><p style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">let myCSV = dataToCsv(myData);</p><p style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// &quot;1,2,3,4\n5,6,7,8\n9,10,11,12\n&quot;</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="5.9"><p class="s10" style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;">An empty question?: <span class="p">Check that f latl () and fl at 2 () work properly if applied to arrays<br/>with empty places, such as [22, , 9, , , 60, , ]. Why do they work?</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 21pt;text-indent: 0pt;text-align: left;">168  Programming Declaratively - A Better Style</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="5.10"><p class="s10" style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;">Producing better output: <span class="p">Modify the cities query to produce a list of strings that includes not<br/>only the name of the city but the state and country as well.</span></p></li><li data-list-text="5.11"><p class="s10" style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;">Old-style code only!: <span class="p">Can you rewrite the word-counting solution without using any mapping<br/>or reducing? This is more of a JavaScript problem than an FP one, but why not?</span></p></li><li data-list-text="5.12"><p class="s10" style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;">Filtering... but what?: <span class="p">Suppose you have an array called someArray, and apply the following<br/>filter () to it, which at first sight doesn’t even look like valid JavaScript code. What will be in the<br/>new array, and why?</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">let newArray = someArray.filter<b>(Boolean);</b></p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="5.13"><p class="s10" style="padding-left: 52pt;text-indent: 0pt;line-height: 126%;text-align: justify;">Yet another factorial question: <span class="p">Does f act4 (0) produce the correct result, i.e., 1? Why, or<br/>why not?</span></p></li><li data-list-text="5.14"><p class="s10" style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;">Async chaining: <span class="p">Our . . . Async () functions are not methods; can you modify them and add<br/>them to Array. prototype so that we can write, for example, [1,2,3,4 ] . mapAsync (...) ?<br/>And by the way, will chaining work with your solution?</span></p></li><li data-list-text="5.15"><p class="s10" style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;">Missing equivalents: <span class="p">We wrote f orEach (), map (), f ilter (), and reduce () equivalents<br/>for async, but we didn’t do the same for f ind (), f indlndex (), some (), and every (); can you?</span></p></li><li data-list-text="5.16"><p class="s10" style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;">Emptying the pool: <span class="p">As coded, the pool of workers can only grow in size. What can you do to<br/>prevent it from growing indefinitely? Try this idea: whenever there are more than, say, 10 workers<br/>not in use, remove some from the pool.</span></p></li><li data-list-text="5.17"><p class="s10" style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;">Queueing for the pool: <span class="p">You cannot have an unlimited number of parallel workers running<br/>simultaneously. Implement a queueing procedure so that all calls will be accepted, but they will only<br/>call     a worker when the number of workers in use is below a certain threshold.</span></p></li><li data-list-text="5.18"><p class="s10" style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: justify;">Showing results: <span class="p">The showResult () function in the last section is interesting; how does it<br/>work? It’s a function that returns a function; an optimal example of FP!</span></p></li><li data-list-text="5.19"><p style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: justify;"><b>Double filtering?: </b>In workerCall () in the <i>Long-living pooled workers </i><span>section, we wrote the<br/>following—is this the best way to find the available workers?</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 74pt;text-indent: 0pt;text-align: left;">let available = pool</p><p style="padding-top: 4pt;padding-left: 87pt;text-indent: 0pt;text-align: left;">.filter! (v) =&gt; !v.inUse)</p><p style="padding-top: 4pt;padding-left: 87pt;text-indent: 0pt;text-align: left;">.find((x) =&gt; x.filename === filename);</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="5.20"><p class="s10" style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;">Wishful thinking: <span class="p">The way we are working with parallel calls, we assume everything will be all<br/>right, with no errors or problems. What should you add to make workerCall () more suited to<br/>real-world problems?</span></p></li></ol></ol><p style="text-indent: 0pt;text-align: left;"><br/></p><h3 style="padding-top: 10pt;text-indent: 0pt;text-align: right;"><a name="bookmark238">6</a><a name="bookmark239">&zwnj;</a></h3><h2 style="padding-top: 4pt;text-indent: 0pt;text-align: right;">Producing Functions</h2><h2 style="padding-top: 1pt;text-indent: 0pt;text-align: right;">- Higher-Order Functions</h2><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;">In <i>Chapter 5, Programming Declaratively, </i><span>we worked with some declarative code so that we could<br/>gain understandability and more compact, shorter code. In this chapter, we will go further toward<br/></span><b>higher-order functions (HOFs) </b><span>and develop our own. We can roughly classify the results that we<br/>are  going to get into three groups:</span></p><ul id="l62"><li data-list-text="•"><p class="s33" style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;line-height: 124%;text-align: justify;">	<span class="s10">Wrapped functions: </span><span class="p">These keep their original functionality while adding some kind of new<br/>feature. In this group, we can consider logging (adding log production capacity to any function),<br/>timing (producing time and performance data for a given function), and memoization of<br/>functions and promises (caching results to avoid future rework).</span></p></li><li data-list-text="•"><p style="padding-top: 5pt;padding-left: 70pt;text-indent: -12pt;line-height: 123%;text-align: justify;"><span class="s33">	</span><b>Altered functions: </b><span>These differ in some key points from their original versions. Here, we can<br/>include the once () function (we covered this in </span><i>Chapter 2, Thinking Functionally&#39;), </i><span>which<br/>changes the original function so that it only runs once; functions such as not () or invert (),<br/>which alter what the function returns; arity-related conversions, which produce a new function<br/>with a fixed number of parameters; and throttling and debouncing functions for performance.</span></p></li><li data-list-text="•"><p style="padding-top: 5pt;padding-left: 70pt;text-indent: -13pt;line-height: 124%;text-align: justify;"><b>Other productions: </b><span>These provide new operations, turn functions into promises, allow enhanced<br/>search functions, decouple methods from objects, transform them into plain functions, and<br/>go the other way around, converting functions into methods. We shall leave a special case -<br/></span><i>transducers - </i>for <i>Chapter 8, Connecting Functions.</i></p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-left: 43pt;text-indent: 0pt;text-align: justify;"><a name="bookmark240">Wrapping functions - keeping behavior</a></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>In this section, we’ll consider some HOFs that provide a wrapper around other functions to enhance<br/>them in some way but without altering their original objective. In terms of design patterns (which<br/>we’ll be revisiting in </span><i>Chapter 11, Implementing Design Patterns), </i>we can also speak of <b>decorators. </b><span>This<br/>pattern is based on the concept of adding some behavior to an object (in our case, a function) without<br/>affecting other objects. The term decorator is also popular because of its usage in frameworks, such<br/>as Angular, or (in an experimental mode) for general programming in JavaScript.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 21pt;text-indent: 0pt;text-align: left;">170  Producing Functions - Higher-Order Functions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 65pt;text-indent: 0pt;text-align: justify;"><a name="bookmark241">Waiting for decorators</a></p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;line-height: 115%;text-align: justify;"><span>Decorators are being considered for general adoption in JavaScript. Currently (as of December<br/>2022), they are at Stage 3, Candidate level, so it may still be a while until they get to Stage 4<br/>(Finished, meaning “officially adopted”). You can read more about the proposal for decorators<br/>at  tc3  9  .  github  .  io/proposal  -decorators/  and  about  the  JavaScript  adoption<br/>process, called TC39, at tc3 9 . es/process-document/. See the </span><i>Questions </i><span>section in<br/></span><i>Chapter 11, Implementing Design Patterns, </i>for more information.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;">As for the term <i>wrapper, </i><span>it’s more important and pervasive than you might have thought; in fact,<br/>JavaScript uses it widely. Where? You already know that object properties and methods are accessed<br/>through dot notation. However, you also know that you can write code such as mySbring. length<br/>or 22.9 . toPrecision (5), so where are those properties and methods coming from, given that<br/>neither strings nor numbers are objects? JavaScript actually creates a </span><i>wrapper object </i><span>around your<br/>primitive value. This object inherits all the methods that are appropriate to the wrapped value. As soon<br/>as  the needed evaluation has been done, JavaScript throws away the just-created wrapper. We cannot<br/>do anything about these transient wrappers, but there is a concept we will come back to regarding<br/>a wrapper that allows methods to be called on things that are not of the appropriate type. This is an<br/>interesting idea; see </span><i>Chapter 12, Building Better Containers, </i>for more applications of that!</p><p style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;text-align: justify;">In this section, well look at three examples:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l63"><li data-list-text="•"><p style="padding-left: 79pt;text-indent: -13pt;text-align: left;">Adding logging to a function</p></li><li data-list-text="•"><p style="padding-top: 7pt;padding-left: 79pt;text-indent: -13pt;text-align: left;">Getting timing information from functions</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 52pt;text-indent: 13pt;line-height: 211%;text-align: left;">Using caching <i>(memoizing) </i><span>to improve the performance of functions<br/>Let’s get to work!</span></p></li></ul><p class="s12" style="padding-top: 1pt;padding-left: 53pt;text-indent: 0pt;text-align: left;"><a name="bookmark242">Logging</a></p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Let’s start with a common problem. When debugging code, you usually need to add some logging<br/>information to see whether a function was called, with what arguments, what it returned, and so on.<br/>(Yes,  of course, you can simply use a debugger and set breakpoints, but bear with me for this example!)<br/>Working normally, this means that you’ll have to modify the code of the function itself, both at entry<br/>and  on exit, to produce some logging output. For example, your original code could be something<br/>like the following:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">function someFunction(paraml, param2, param3) {</p><p style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">// do something</p><p style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">// do something else</p><p style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">// and a bit more,</p><p style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">// and finally</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 12pt;padding-left: 291pt;text-indent: 0pt;text-align: left;">Wrapping functions - keeping behavior   171</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 65pt;text-indent: 0pt;text-align: left;">return some expression;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>In this case, you would have to modify it to look like the following. Here, we need to add an auxValue<br/>variable to store the value that we want to log and return:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">function someFunction(paraml, param2, param3) {</p><p class="s10" style="padding-top: 4pt;padding-left: 64pt;text-indent: 0pt;text-align: left;">console.log(</p><p class="s10" style="padding-top: 4pt;padding-left: 76pt;text-indent: 1pt;line-height: 144%;text-align: left;"><span>&quot;entering someFunction: &quot;,<br/>paraml,</span></p><p class="s10" style="padding-left: 76pt;text-indent: 0pt;line-height: 143%;text-align: left;"><span>param2,<br/>param3</span></p><p class="s10" style="padding-left: 65pt;text-indent: 0pt;text-align: left;">) ;</p><p style="padding-top: 3pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">// do something</p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">// do something else</p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">// and a bit more,</p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">// and finally</p><p class="s10" style="padding-top: 4pt;padding-left: 64pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>const auxValue = ...some expression... ;<br/>console.log(&quot;exiting someFunction: &quot;, auxValue);<br/>return auxValue;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: left;">If the function can return at several places, you’ll have to modify all the return statements to log</p><p style="padding-top: 1pt;padding-left: 43pt;text-indent: 0pt;line-height: 115%;text-align: left;"><span>the values to be returned. And if you are just calculating the return expression on the fly, you’ll need<br/>an auxiliary variable to capture that value.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>In the next section, we’ll learn about logging and some special cases, such as functions that throw<br/>exceptions, and we’ll work more purely.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s34" style="padding-left: 43pt;text-indent: 0pt;text-align: left;">Logging in a functional way</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 115%;text-align: left;"><span>Logging by modifying your functions isn’t difficult, but modifying code is always dangerous and prone<br/>to accidents. So, let’s put our FP hats on and think of a new way of doing this. We have a function</span></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: left;">that performs some work, and we want to know the arguments it receives and the value it returns.</p><p style="padding-top: 8pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>Here, we can write an HOF that will have a single parameter - the original function - and return a<br/>new function that will do the following in sequence:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><ol id="l64"><li data-list-text="1."><p style="padding-left: 70pt;text-indent: -17pt;text-align: left;">Log the received arguments.</p></li><li data-list-text="2."><p style="padding-top: 6pt;padding-left: 69pt;text-indent: -17pt;text-align: left;">Call the original function, catching its returned value.</p></li><li data-list-text="3."><p style="padding-top: 6pt;padding-left: 70pt;text-indent: -17pt;text-align: left;">Log that value.</p></li><li data-list-text="4."><p style="padding-top: 6pt;padding-left: 69pt;text-indent: -17pt;text-align: left;">Return it to the caller.</p></li></ol><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 21pt;text-indent: 0pt;text-align: left;">172  Producing Functions - Higher-Order Functions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">A possible solution would be as follows, and let’s use plain JavaScript first to focus on the implementation:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// logging.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 73pt;text-indent: -11pt;line-height: 143%;text-align: left;"><span>function    addLogging(fn)    {<br/>return (...args) =&gt; {</span></p><p class="s10" style="padding-left: 85pt;text-indent: 0pt;line-height: 143%;text-align: left;"><span>console.log(&#39;entering ${fn.name}(${args})&#39;);<br/>const valueToReturn = fn(...args);</span></p><p class="s10" style="padding-left: 85pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>console.log(&#39;exiting          ${fn.name}=&gt;${valueToReturn}&#39;);<br/>return valueToReturn;</span></p><p style="padding-top: 2pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">};</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: justify;">The function returned by addLogging () behaves as follows:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l65"><li data-list-text="•"><p style="padding-left: 79pt;text-indent: -13pt;text-align: left;">The first console. log (...) line shows the original functions name and its list of arguments.</p></li><li data-list-text="•"><p class="s33" style="padding-top: 8pt;padding-left: 79pt;text-indent: -13pt;line-height: 126%;text-align: left;">	<span class="p">Then, the original function, f n (), is called, and the returned value is stored. The second<br/>console . log (...) line shows the function name (again) and its returned value.</span></p></li><li data-list-text="•"><p style="padding-top: 5pt;padding-left: 79pt;text-indent: -13pt;text-align: left;">Finally, the value that fn () calculated is returned.</p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>A small comment: If you were doing this for a Node.js application, you would probably opt for a<br/>better way of logging than console . log () by using libraries such as </span><i>Winston, Morgan, </i>or <i>Bunyan,</i><span>depending on what you wanted to log. However, our focus is on how to wrap the original function,<br/>and the needed changes for using those libraries would be negligible.</span></p><p style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;text-align: justify;">Let’s turn to a TypeScript implementation now:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">function addLogging&lt;T <b>extends (...args: any[]) =&gt; any&gt; (</b></p><p style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">fn: T</p><p class="s10" style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">): (...args: ParameterscTs) =&gt; ReturnType&lt;T&gt; {</p><p style="padding-top: 4pt;padding-left: 85pt;text-indent: -12pt;line-height: 143%;text-align: left;"><span>return    (...args:    Parameters&lt;T&gt;):    ReturnType&lt;T&gt;    =&gt;    {<br/>console.log(&#39;entering ${fn.name}(${args})&#39;);</span></p><p style="padding-left: 85pt;text-indent: 0pt;line-height: 10pt;text-align: left;">const valueToReturn = fn(...args);</p><p style="padding-top: 4pt;padding-left: 85pt;text-indent: 0pt;line-height: 143%;text-align: left;"><span>console.log(&#39;exiting     ${fn.name}     =&gt;     ${valueToReturn}&#39;);<br/>return valueToReturn;</span></p><p style="padding-top: 2pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">};</p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 291pt;text-indent: 0pt;text-align: left;">Wrapping functions - keeping behavior   173</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Our addLogging () function applies to a generic function T type and returns a new function of precisely<br/>the same type: its arguments (Parameters&lt;T&gt;) are those of T, and its result (ReturnType&lt;T&gt;)<br/>is also the same type as T’s. We will be using this kind of definition many times in this chapter and<br/>the rest of the book.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Let’s have an example now. We can use addLogging () with the upcoming functions—which<br/>are written, I agree, in an overly complicated way, just to have an appropriate example! We’ll have a<br/>function that accomplishes subtraction by changing the sign of the second number and then adding<br/>it  to the first. And, just to have an error case, we’ll have the function throw an error if we attempt to<br/>subtract zero. (Yes, of course, you can subtract zero from another number! But I wanted to have some<br/>kind of an error-throwing situation at any cost!) The following code does this:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 65pt;text-indent: -12pt;line-height: 142%;text-align: left;"><span>function   subtract(a:   number,   b:   number):   number   {<br/>if (b === 0) {</span></p><p style="padding-left: 76pt;text-indent: 0pt;text-align: left;">throw new Error(&quot;We don&#39;t subtract zero!&quot;);</p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">} else {</p><p style="padding-top: 4pt;padding-left: 76pt;text-indent: 0pt;line-height: 142%;text-align: left;"><span>b = changesign(b);<br/>return a + b;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">let changesign = (a: number): number =&gt; -a;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 53pt;text-indent: 0pt;line-height: 146%;text-align: left;"><span>// ©ts-expect-error We want to reassign the function<br/>subtract = addLogging(subtract);</span></p><p style="padding-left: 53pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>subtract(8, 3);<br/>console.log(); // to separate</span></p><p style="padding-left: 53pt;text-indent: 0pt;line-height: 146%;text-align: left;"><span>changesign = addLogging(changesign);<br/>subtract(7, 5) ;</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: left;"><span>What’s that ®ts - expect - error comment? TypeScript rejects the assignment in the following line,<br/>sayingCannot  assign  to  &#39;subtract&#39;  because  it  is  a  function,  ts  (2630).  This<br/>prohibition keeps code safe, but since we are very sure that we won’t be changing the subtract ()<br/>type, we can include the comment, and TypeScript will let us get away with it.</span></p><p style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;text-align: left;">The result of executing this would be the following lines of logging:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">entering subtract(8,3)</p><p style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">exiting   subtract   =&gt;   5</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-left: 21pt;text-indent: 0pt;text-align: left;">174  <span class="s189">Producing Functions - Higher-Order Functions</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;line-height: 143%;text-align: left;"><span>entering subtract(7,5)<br/>entering changesign(5)<br/>exiting changesign =&gt; -5<br/>exiting subtract =&gt; 2</span></p><p style="padding-top: 8pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">All the changes we had to make in our code were the reassignments of subtract () and</p><p style="padding-top: 2pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>changesign (), which essentially replaced them everywhere with their new log-producing wrapped<br/>versions. Any call to those two functions will produce this output.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>This works fine for most functions, but what would happen if the wrapped function threw an exception?<br/>Let’s take a look.</span></p><p class="s34" style="padding-top: 8pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">Taking exceptions into account</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>Lets enhance our logging function a bit by considering an adjustment. What happens to your log if the<br/>function throws an error? Fortunately, this is easy to solve. We have to add a try/catch structure,</span></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 10pt;text-align: left;">as shown in the following code:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 74pt;text-indent: -12pt;line-height: 141%;text-align: left;"><span>function addLogging2&lt;T extends (...args: any[]) =&gt; any&gt;(<br/>fn: T</span></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">): (...args: Parameters&lt;T&gt;) =&gt; ReturnType&lt;T&gt; {</p><p style="padding-top: 4pt;padding-left: 85pt;text-indent: -12pt;line-height: 146%;text-align: left;"><span>return (...args: Parameters&lt;T&gt;): ReturnType&lt;T&gt; =&gt; {<br/>console.log(&#39;entering ${fn.name}(${args})&#39;);</span></p><p class="s10" style="padding-left: 86pt;text-indent: 0pt;line-height: 10pt;text-align: left;">try {</p><p class="s10" style="padding-top: 4pt;padding-left: 97pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>const valueToReturn = fn(...args);<br/></span><span class="p">console.log(&#39;exiting ${fn.name}=&gt;${valueToReturn}&#39;);<br/>return valueToReturn;</span></p><p class="s10" style="padding-left: 97pt;text-indent: -10pt;line-height: 143%;text-align: left;"><span>} catch (thrownError) {<br/>console.log(</span></p><p class="s10" style="padding-left: 110pt;text-indent: 0pt;text-align: left;">&#39;exiting ${fn.name}=&gt;threw ${thrownError}&#39;</p><p class="s10" style="padding-top: 5pt;padding-left: 98pt;text-indent: 0pt;text-align: left;">) ;</p><p class="s10" style="padding-top: 3pt;padding-left: 98pt;text-indent: 0pt;text-align: left;">throw thrownError;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 63pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 291pt;text-indent: 0pt;text-align: left;">Wrapping functions - keeping behavior   <span class="s153">175</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>With this change, if the function threw an error, you’d also get an appropriate logging message, and<br/>the exception would be rethrown for processing. The following is a quick demo of this:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">try {</p><p class="s10" style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">subtract2(11, 0);</p><p style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">} catch (e) {</p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">/* nothing */</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s158" style="padding-top: 7pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">/*</p><p class="s10" style="padding-top: 2pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">entering subtract(11,0)</p><p class="s10" style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">exiting subtract=&gt;threw Error: We don&#39;t subtract zero!</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Other changes to get an even better logging output would be up to you - adding date and time data,<br/>enhancing the way parameters are listed, and so on. However, our implementation still has an important<br/>defect; let’s make it better and purer.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s34" style="padding-left: 44pt;text-indent: 0pt;text-align: justify;">Working in a purer way</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;">When we wrote the addLogging () function, we ignored some precepts we saw in <i>Chapter 4,</i><span>because we included an impure element (console . log ()) in our code. With<br/>this, not only did we lose flexibility (would you be able to select an alternate way of logging?), but we<br/>also complicated our testing. We could manage to test it by spying on the console . log () method,<br/>but that isn’t very clean: we depend on knowing the internals of the function we want to test instead of<br/>doing a purely black-box test. Take a look at the following example for a clearer understanding of this:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// logging.test.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">import { addLogging2 } from &quot;./logging&quot;;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 64pt;text-indent: -12pt;line-height: 144%;text-align: left;"><span>describe(&quot;a   logging   function&quot;,   function   ()   {<br/>afterEach(() =&gt; {</span></p><p style="padding-left: 77pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>// so count of calls to Math.random will be OK<br/>j est. restoreAHMocks () ;</span></p><p style="padding-top: 1pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">});</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 5pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">it(&quot;should   log   twice   with   well   behaved   functions&quot;,   ()   =&gt;   {</p><p class="s10" style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">jest.spyOn(global.console, &quot;log&quot;);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">let something = (a: number, b: number): string = &gt;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-left: 21pt;text-indent: 0pt;text-align: left;">176  <span class="s189">Producing Functions - Higher-Order Functions</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 98pt;text-indent: 0pt;text-align: left;">&#39;result=${a}:${b}&#39;;</p><p style="padding-top: 3pt;padding-left: 86pt;text-indent: 0pt;line-height: 30pt;text-align: left;"><span>something = addLogging2(something);<br/>something(22, 9);</span></p><p class="s10" style="padding-left: 85pt;text-indent: 0pt;line-height: 143%;text-align: left;"><span>expect(global.console.log).toHaveBeenCalledTimes(2);<br/>expect(global.console.log).toHaveBeenNthCalledWith(</span></p><p class="s10" style="padding-left: 98pt;text-indent: 0pt;line-height: 10pt;text-align: left;">1,</p><p class="s10" style="padding-top: 4pt;padding-left: 98pt;text-indent: 0pt;text-align: left;">&quot;entering something(22,9)&quot;</p><p class="s10" style="padding-top: 5pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">) ;</p><p class="s10" style="padding-top: 3pt;padding-left: 97pt;text-indent: -12pt;line-height: 143%;text-align: left;"><span>expect(global.console.log).toHaveBeenNthCalledWith(<br/>2,</span></p><p class="s10" style="padding-left: 98pt;text-indent: 0pt;line-height: 10pt;text-align: left;">&quot;exiting something=&gt;result=22:9&quot;</p><p class="s10" style="padding-top: 5pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">) ;</p><p style="padding-top: 5pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">});</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 86pt;text-indent: -12pt;line-height: 143%;text-align: left;"><span>it(&quot;should   report   a   thrown   exception&quot;,   ()   =&gt;   {<br/>j est.spyOn(global.console, &quot;log&quot;) ;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 86pt;text-indent: 0pt;line-height: 143%;text-align: left;"><span>let subtractZero = (x: number) =&gt; subtract(x, 0) ;<br/>subtractZero = addLogging2(subtractZero);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 85pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>expect (() =&gt; subtractZero (10) ). toThrowO ;<br/>expect(global.console.log).toHaveBeenCalledTimes(2);<br/>expect(global.console.log).toHaveBeenNthCalledWith(</span></p><p class="s10" style="padding-left: 98pt;text-indent: 0pt;line-height: 10pt;text-align: left;">1,</p><p class="s10" style="padding-top: 4pt;padding-left: 98pt;text-indent: 0pt;text-align: left;">&quot;entering subtractZero(10)&quot;</p><p class="s10" style="padding-top: 5pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">) ;</p><p class="s10" style="padding-top: 3pt;padding-left: 97pt;text-indent: -12pt;line-height: 149%;text-align: left;"><span>expect(global.console.log).toHaveBeenNthCalledWith(<br/>2,</span></p><p class="s10" style="padding-left: 98pt;text-indent: 0pt;line-height: 9pt;text-align: left;">&quot;exiting subtractZero=&gt;threw Error: We don&#39;t subtract</p><p class="s10" style="padding-top: 1pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">zero!&quot;</p><p class="s10" style="padding-top: 5pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">) ;</p><p style="padding-top: 5pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">});</p><p style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">});</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 12pt;padding-left: 291pt;text-indent: 0pt;text-align: left;">Wrapping functions - keeping behavior   177</p><p style="padding-top: 22pt;padding-left: 42pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Running this test shows that addLogging () behaves as expected, so this is a solution. Our first test<br/>just does a simple subtraction and verifies that logging was called with appropriate data. The second<br/>test checks that our (purposefully failing) subtract () function throws an error to also verify that<br/>the correct logs were produced.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Even so, being able to test our function this way doesn’t solve the lack of flexibility we mentioned. We<br/>should pay attention to what we wrote in the </span><i>Injecting impure functions </i>section in <i>Chapter 4, Behaving</i><span>the logging function should be passed as an argument to the wrapper function so that we<br/>can change it if we need to:</span></p><p style="padding-top: 10pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// loggings.ts</p><p style="padding-top: 19pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">function addLogging3&lt;T extends (. args: any[]) =&gt; any&gt; (</p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">f n: T,</p><p class="s10" style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">logger = console.log.bind(console)</p><p style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">): (. args: Parameters&lt;T&gt;) =&gt; ReturnType&lt;T&gt; {</p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">return (. args: Parameters&lt;T&gt;): ReturnType&lt;T&gt; =&gt; {</p><p class="s10" style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">logger(&#39;entering ${fn.name}(${args})&#39;);</p><p style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">try {</p><p style="padding-top: 4pt;padding-left: 89pt;text-indent: 0pt;text-align: left;">const valueToReturn = fn(. args);</p><p class="s10" style="padding-top: 4pt;padding-left: 89pt;text-indent: 0pt;text-align: left;">logger(&#39;exiting ${fn.name}=&gt;${valueToReturn}&#39;);</p><p style="padding-top: 4pt;padding-left: 89pt;text-indent: 0pt;text-align: left;">return valueToReturn;</p><p style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">} catch (thrownError) {</p><p class="s10" style="padding-top: 4pt;padding-left: 89pt;text-indent: 0pt;text-align: left;">logger(&#39;exiting ${fn.name}=&gt;threw ${thrownError}&#39;);</p><p style="padding-top: 4pt;padding-left: 88pt;text-indent: 0pt;text-align: left;">throw thrownError;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>If we don’t do anything, the logging wrapper will produce the same results as in the previous section.<br/>However, we could provide a different logger - for example, with Node.js, we could use the </span><i>winston</i><span>logging  tool  (see  github  .  com/winstonj  s/winston  for  more  on  it),  and  the  results  would<br/>vary accordingly:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s9" style="padding-left: 53pt;text-indent: 0pt;text-align: left;">/I <span class="p">continued...</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">function subtract (...) {  }</p><p style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">let changesign =  ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 21pt;text-indent: 0pt;text-align: left;">178  Producing Functions - Higher-Order Functions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;line-height: 145%;text-align: left;"><span>// @ts-expect-error We want to reassign the function<br/></span><b>subtract = addLogging3(subtract, myLogger);</b>subtract (8, 3) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;text-align: left;">console.log(); // to separate</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;text-align: left;"><a name="bookmark243">changeSign = addLogging3(changesign, myLogger);</a></p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">subtract(7 , 5) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 8pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">/*</p><p style="padding-top: 3pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">{&quot;level&quot;:&quot;debug&quot;,&quot;message&quot;:&quot;entering subtract(8,3)&quot;}</p><p style="padding-top: 4pt;padding-left: 63pt;text-indent: 0pt;text-align: left;">{&quot;level&quot;:&quot;debug&quot;,&quot;message&quot;:&quot;exiting subtract=&gt;5&quot;}</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">{&quot;level&quot;:&quot;debug&quot;,&quot;message&quot;:&quot;entering subtract(7,5)&quot;}</p><p style="padding-top: 4pt;padding-left: 63pt;text-indent: 0pt;text-align: left;">{&quot;level&quot;:&quot;debug&quot;,&quot;message&quot;:&quot;entering changeSign(5)&quot;}</p><p style="padding-top: 4pt;padding-left: 63pt;text-indent: 0pt;text-align: left;">{&quot;level&quot;:&quot;debug&quot;,&quot;message&quot;:&quot;exiting changeSign=&gt;-5&quot;}</p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">{&quot;level&quot;:&quot;debug&quot;,&quot;message&quot;:&quot;exiting subtract=&gt;2&quot;}</p><p style="padding-top: 5pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">*/</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>The log format is JSON by default. It’s more usual to route it to a file for storage, so it isn’t so clear<br/>as console output, but we could (if needed) reformat it more legibly. However, this suffices for our<br/>example, and we won’t do anything else.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Now that we have followed our own advice, we can take advantage of stubs. Ure code for testing is<br/>practically the same as before; however, we are using a dummy. logger () stub with no provided<br/>functionality or side effects, so it’s safer all around. In this case, the real function that was being<br/>invoked originally, console . log (), can’t do any harm, but that’s not always the case, so using a<br/>stub is recommended:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// loggings.test.ts</p><p style="padding-left: 61pt;text-indent: 0pt;line-height: 30pt;text-align: left;"><span>import { addLogging3 } from &quot;./loggings&quot;;<br/>describe(&quot;addLoggingS()&quot;, function () {</span></p><p style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">it(&quot;should call the provided logger&quot;, () =&gt; {</p><p class="s10" style="padding-top: 4pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">const logger = jest.fnO;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 98pt;text-indent: -12pt;line-height: 141%;text-align: left;"><span>let something = (a: number, b: number): string =&gt;<br/>&#39;result=${a}:${b}&#39;;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 291pt;text-indent: 0pt;text-align: left;">Wrapping functions - keeping behavior   179</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 77pt;text-indent: 0pt;text-align: left;">something = addLogging3(something, <b>logger);</b></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">something(22, 9);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-top: 7pt;padding-left: 77pt;text-indent: 0pt;line-height: 141%;text-align: left;"><span>expect(logger).toHaveBeenCalledTimes(2);<br/>expect(logger).toHaveBeenNthCalledWith(</span></p><p class="s10" style="padding-left: 89pt;text-indent: 0pt;text-align: left;">1,</p><p class="s10" style="padding-top: 4pt;padding-left: 89pt;text-indent: 0pt;text-align: left;">&quot;entering something(22,9)&quot;</p><p class="s10" style="padding-top: 5pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">) ;</p><p class="s10" style="padding-top: 3pt;padding-left: 88pt;text-indent: -11pt;line-height: 146%;text-align: left;"><span>expect(logger).toHaveBeenNthCalledWith(<br/>2,</span></p><p class="s10" style="padding-left: 89pt;text-indent: 0pt;line-height: 10pt;text-align: left;">&quot;exiting something=&gt;result=22:9&quot;</p><p class="s10" style="padding-top: 5pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">) ;</p><p style="padding-top: 5pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">});</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 76pt;text-indent: -11pt;line-height: 143%;text-align: left;"><span>it(&quot;a   throwing   function   should   be   reported&quot;,   ()   =&gt;   {<br/>const logger = jest.fnO;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 89pt;text-indent: -11pt;line-height: 142%;text-align: left;"><span>let thrower = () =&gt; {<br/>throw &quot;CRASH!&quot;;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 76pt;text-indent: 0pt;text-align: left;">thrower = addLogging3(thrower, logger);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-top: 7pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">try {</p><p class="s10" style="padding-top: 4pt;padding-left: 89pt;text-indent: 0pt;text-align: left;">thrower();</p><p class="s10" style="padding-top: 4pt;padding-left: 89pt;text-indent: -11pt;line-height: 143%;text-align: left;"><span>} catch (e) {<br/>expect(logger).toHaveBeenCalledTimes(2);<br/>expect(logger).toHaveBeenNthCalledWith(</span></p><p class="s10" style="padding-left: 101pt;text-indent: 0pt;text-align: left;">1,</p><p class="s10" style="padding-top: 4pt;padding-left: 101pt;text-indent: 0pt;text-align: left;">&quot;entering thrower()&quot;</p><p class="s10" style="padding-top: 5pt;padding-left: 89pt;text-indent: 0pt;text-align: left;">) ;</p><p class="s10" style="padding-top: 3pt;padding-left: 101pt;text-indent: -12pt;line-height: 148%;text-align: left;"><span>expect(logger).toHaveBeenNthCalledWith(<br/>2,</span></p><p class="s10" style="padding-left: 101pt;text-indent: 0pt;line-height: 9pt;text-align: left;">&quot;exiting thrower=&gt;threw CRASH!&quot;</p><p class="s10" style="padding-top: 5pt;padding-left: 89pt;text-indent: 0pt;text-align: left;">) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 21pt;text-indent: 0pt;text-align: left;">180  Producing Functions - Higher-Order Functions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 86pt;text-indent: 0pt;text-align: left;">}</p><p style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">});</p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">});</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>The preceding tests work exactly like the previous ones we wrote earlier (though, for variety, in the<br/></span><i>Working in a purer way </i><span>section, we used expect (...) . toThrow (), and here we used a try/<br/>catch structure to test error-throwing functions). We used and inspected the dummy logger instead<br/>of dealing with the original console . log () calls. Writing the test in this way avoids all possible<br/>problems due to side effects, so it’s much cleaner and safer.</span></p><p style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>When applying FP techniques, remember that if you are somehow complicating your job - for example,<br/>making it difficult to test any of your functions - then you must be doing something wrong. In our<br/>case, the mere fact that the output of addLogging () was an impure function should have raised<br/>the alarm. Of course, given the simplicity of the code, in this particular case, you might decide that<br/>it’s not worth a fix, that you can do without testing, and that you don’t need to be able to change the<br/>way logging is produced. However, long experience in software development suggests that, sooner or<br/>later, you’ll come to regret that sort of decision, so try to go with the cleaner solution instead.</span></p><p style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;text-align: justify;">Now that we have dealt with logging, we’ll look at another need: timing functions for performance reasons.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 52pt;text-indent: 0pt;text-align: justify;"><a name="bookmark244">Timing functions</a></p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Another possible application for wrapped functions is to record and log the timing of each function<br/>invocation in a fully transparent way. Simply put, we want to be able to tell how long a function call<br/>takes, most likely for performance studies. However, in the same way we dealt with logging, we don’t<br/>want to have to modify the original function and will use an HOF instead.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 65pt;text-indent: 0pt;text-align: justify;"><a name="bookmark245">The three rules for optimization</a></p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;line-height: 115%;text-align: justify;">If you plan to optimize your code, remember the following three rules: <i>Don’t do it, Don’t do</i>and <i>Don’t do it without measuring. </i><span>It has been mentioned that a lot of bad code arises<br/>from early attempts at optimization, so don’t start by trying to write optimal code, don’t try<br/>to optimize until you recognize the need for it, and don’t do it haphazardly without trying to<br/>determine the reasons for the slowdown by measuring all the parts of your application.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Along the lines of the preceding example, we can write an addTiming () function that, given<br/>any function, will produce a wrapped version that will write out timing data on the console but will<br/>otherwise work in exactly the same way. Data types are very much what we saw in the previous section,<br/>so  let’s write TypeScript at once:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;line-height: 287%;text-align: left;"><span>const myGet = (): number =&gt; performance.now();<br/>const myPut = (</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 291pt;text-indent: 0pt;text-align: left;">Wrapping functions - keeping behavior   181</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 64pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>text: string,<br/>name: string,<br/>tStart: number,<br/>tEnd: number</span></p><p style="padding-left: 53pt;text-indent: 0pt;line-height: 10pt;text-align: left;">): void =&gt;</p><p style="padding-top: 4pt;padding-left: 64pt;text-indent: 0pt;text-align: left;">console.log(&#39;${name} - ${text} ${tEnd - tStart} ms&#39;);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 65pt;text-indent: -12pt;line-height: 144%;text-align: left;"><span>function addTimingcT extends (...args: any[]) =&gt; any&gt;(<br/>fn: T,</span></p><p style="padding-left: 76pt;text-indent: -10pt;line-height: 143%;text-align: left;"><span>{ getTime, output } = {<br/>getTime: myGet,<br/>output: myPut,</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">): (...args: Parameters&lt;T&gt;) =&gt; ReturnType&lt;T&gt; {</p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">return (...args: Parameters&lt;T&gt;): ReturnType&lt;T&gt; =&gt; {</p><p class="s10" style="padding-top: 4pt;padding-left: 76pt;text-indent: 0pt;text-align: left;">const tStart = getTime();</p><p style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">try {</p><p style="padding-top: 4pt;padding-left: 88pt;text-indent: 0pt;text-align: left;">const valueToReturn = fn(...args);</p><p class="s10" style="padding-top: 4pt;padding-left: 88pt;text-indent: 0pt;text-align: left;">output(&quot;normal exit&quot;, fn.name, tStart, getTime());</p><p style="padding-top: 4pt;padding-left: 89pt;text-indent: 0pt;text-align: left;">return valueToReturn;</p><p style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">} catch (thrownError) {</p><p class="s10" style="padding-top: 4pt;padding-left: 88pt;text-indent: 0pt;text-align: left;">output(&quot;exception!!&quot;, fn.name, tStart, getTime());</p><p style="padding-top: 4pt;padding-left: 88pt;text-indent: 0pt;text-align: left;">throw thrownError;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: left;"><span>Along the lines of the enhancement we applied in the previous section to the logging function, we are<br/>providing separate logger and time access functions. Writing tests for our addTiming () function<br/>should prove easy, given that we can inject both impure functions.</span></p><p style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;text-align: left;">We can see how this works here:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 53pt;text-indent: 0pt;line-height: 142%;text-align: left;"><span>function subtract (...) { ... }<br/>let changesign = ... ;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 21pt;text-indent: 0pt;text-align: left;">182  Producing Functions - Higher-Order Functions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;line-height: 145%;text-align: left;"><span>// @ts-expect-error We want to reassign the function<br/></span><b>subtract = addTiming(subtract, myLogger);</b>subtract(8, 3);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;text-align: left;"><a name="bookmark246">console.log(); // to separate</a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">changeSign = addTiming(changeSign, myLogger);</p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">subtract (7, 5) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 8pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">/*</p><p style="padding-top: 3pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">subtract - normal exit 0.0217440128326416 ms</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 62pt;text-indent: 0pt;line-height: 142%;text-align: left;"><span>changeSign - normal exit 0.0014679431915283203 ms<br/>subtract - normal exit 0.0415341854095459 ms</span></p><p style="padding-top: 1pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">*/</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-top: 7pt;padding-left: 65pt;text-indent: 0pt;text-align: left;"><a name="bookmark247">Accuracy matters</a></p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;line-height: 115%;text-align: left;"><span>Using performance . now () provides the highest accuracy. If you don’t need such precision<br/>as what’s provided by that function (arguably, it is overkill), you could use Date . now ()<br/>instead. For more on these alternatives, see developer .mozilla. org/en-US/docs/<br/>Web/API/Performance/now and developer.mozilla.org/en/docs/Web/</span></p><p style="padding-left: 65pt;text-indent: 0pt;line-height: 115%;text-align: left;"><span>JavaScript/Ref erence/Global_Obj ects/Date/now. Consider using console .<br/>time() and console.timeEnd(); see developer.mozilla.org/en-US/docs/<br/>Web/API /Console/time for more information.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><a name="bookmark248"><span>The preceding code is quite similar to the previous addLogging () function, and that’s reasonable:<br/>in both cases, we add some code before the actual function call and then some new code after the<br/>function returns. You might even consider writing a </span></a><i>higher </i><span>HOF, which would receive three functions<br/>and produce a new HOF as output (such as addLogging () or addTiming ()) that would call<br/>the first function at the beginning, and then the second function if the wrapped function returned a<br/>value, or the third function if an error had been thrown! How about that?</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 53pt;text-indent: 0pt;text-align: justify;">Memoizing functions</p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;">In <i>Chapter 4, Behaving Properly, </i><span>we considered the case of the Fibonacci function and learned how<br/>we could transform it, by hand, into a much more efficient version using </span><i>memoizatiorv. </i><span>caching<br/>calculated values to avoid recalculations. A </span><i>memoized </i><span>function would avoid redoing a process if the<br/>result was found earlier. We want to be able to turn any function into a memoized one so that we can<br/>get a more optimized version. However, a real-life memoizing solution should also take into account</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 291pt;text-indent: 0pt;text-align: left;">Wrapping functions - keeping behavior   183</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>the available RAM and have some ways of avoiding filling it up; however, this is beyond the scope<br/>of this book, and we won’t be looking into performance issues either; those optimizations are also<br/>beyond the scope of this book.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-top: 5pt;padding-left: 57pt;text-indent: 0pt;text-align: justify;"><a name="bookmark249">Of frameworks and memos</a></p><p style="padding-top: 4pt;padding-left: 56pt;text-indent: 0pt;line-height: 115%;text-align: justify;"><span>Some memoizing functionality is provided by tools such as React (the us eMemo () hook)<br/>or Vue (the v-memo directive), but it’s not really the same. In these cases, only the previous<br/>result is kept, and re-rendering is avoided if a value changes. With the kind of memoization<br/>were discussing, </span><i>all </i>previous values are cached for reuse; React and Vue cache just one value.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>For simplicity, let’s only consider functions with a single, non-structured parameter and leave<br/>functions with more complex parameters (objects and arrays) or more than one parameter for later.<br/>The kind of values we can handle with ease are JavaScript’s primitive values: data that aren’t objects<br/>and  have  no  methods.  JavaScript  has  six  of  these:  boolean,  null,  number,  string,  symbol,<br/>and undefined. Usually, we only see the first four as actual arguments. You can find out more by<br/>going to developer . mozilla . org/en-US/docs/Glossary/Primitive.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Were not aiming to produce the best-ever memoizing solution, but let’s study the subject a bit and<br/>produce several variants of a memoizing HOF. First, we’ll deal with functions with a single parameter<br/>and then consider functions with several parameters.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s34" style="padding-left: 43pt;text-indent: 0pt;text-align: justify;">Simple memoization</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>We will work with the Fibonacci function we mentioned previously, which is a simple case: it receives<br/>a single numeric parameter. This function is as follows:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: justify;">// fibonacci.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 65pt;text-indent: -12pt;line-height: 146%;text-align: left;"><span>function fib(n: number): number {<br/>if (n == 0) {</span></p><p style="padding-left: 77pt;text-indent: 0pt;line-height: 10pt;text-align: left;">return 0;</p><p style="padding-top: 4pt;padding-left: 77pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>} else if (n == 1) {<br/>return 1;</span></p><p style="padding-left: 65pt;text-indent: 0pt;line-height: 10pt;text-align: left;">} else {</p><p style="padding-top: 4pt;padding-left: 76pt;text-indent: 0pt;text-align: left;">return fib(n - 2) + fib(n - 1);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>The solution we previously created was general in concept but not particularly good in its implementation:<br/>we had to directly modify the function’s code to take advantage of said memoization. Let’s look into<br/>how to do this automatically, in the same fashion as other wrapped functions. The solution would be</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-left: 21pt;text-indent: 0pt;text-align: left;">184  <span class="s189">Producing Functions - Higher-Order Functions</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>a memoize () function that wraps any other function to apply memoization. For clarity, let’s work<br/>with JavaScript first and just for functions with a single numeric parameter:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// memoize.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 73pt;text-indent: -12pt;line-height: 143%;text-align: left;"><span>const memoize = (fn) =&gt; {<br/>const cache = {};<br/>return (x) =&gt;</span></p><p style="padding-left: 85pt;text-indent: 0pt;text-align: left;">x in cache ? cache[x] : (cache [x] = fn(x));</p><p style="padding-top: 6pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">};</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>How does this work? The returned function, for any given argument, checks whether the argument<br/>was already received; that is, whether it can be found as a key in the cache object. (See </span><i>Question 6.2</i><span>for an alternative implementation of the cache.) If so, there’s no need for calculation, and the cached<br/>value is returned. Otherwise, we calculate the missing value and store it in the cache. (We use a closure<br/>to hide the cache from external access.) Here, we assume that the memoized function receives only<br/>one argument (x) and that it is a numeric value, which can then be directly used as a key value for<br/>the cache object; we’ll consider other cases later.</span></p><p style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>We now need to go to TypeScript; here’s the equivalent version of memoize (). The generic data<br/>typing is along the same lines as what we saw in the </span><i>Logging in afunctional way </i><span>section, with the only<br/>difference being that now we work with functions that get a single numeric argument:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;"><a name="bookmark250">// continued...</a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">const memoize = <b>&lt;T extends (x: number) =&gt; any&gt; (</b></p><p style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">fn: T</p><p class="s10" style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">): ((x: number) =&gt; ReturnType&lt;T&gt;) =&gt; {</p><p style="padding-top: 4pt;padding-left: 73pt;text-indent: 0pt;line-height: 143%;text-align: left;"><span>const cache = {} as Recordcnumber, ReturnType&lt;T&gt;&gt;;<br/>return (x) =&gt;</span></p><p style="padding-left: 85pt;text-indent: 0pt;text-align: left;">x in cache ? cache[x] : (cache [x] = fn(x));</p><p style="padding-top: 6pt;padding-left: 63pt;text-indent: 0pt;text-align: left;">};</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: left;"><span>Is memoization working? We’ll have to time it - and we happen to have a useful addTiming ()<br/>function for that! First, we time the original f ib () function. We want to time the complete calculation<br/>and not each recursive call, so we write an auxiliary testFib () function, which is the one we’ll time.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>We should repeat the timing operations and do an average, but since we just want to confirm that<br/>memoizing works, we’ll tolerate differences:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;line-height: 142%;text-align: left;"><span>const testFib = (n: number) =&gt; fib(n);<br/>addTiming(testFib)(45); // 18,957 ms</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 291pt;text-indent: 0pt;text-align: left;">Wrapping functions - keeping behavior   <span class="s153">185</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">addTiming(testFib) (40); //         1,691 ms</p><p style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">addTiming(testFib)(35); //           152 ms</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Of course, your times will depend on your specific CPU, RAM, and so on. However, the results seem<br/>logical: the exponential growth we mentioned in </span><i>Chapter 4, Behaving Properly, </i><span>appears to be present,<br/>and times grow quickly. Now, let’s memoize f ib (). We should get shorter times... shouldn’t we?</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><table style="border-collapse:collapse" cellspacing="0"><tr style="height:14pt"><td style="width:30pt"><p class="s29" style="padding-left: 2pt;text-indent: 0pt;text-align: left;">(45) ;</p></td><td style="width:24pt"><p class="s19" style="padding-left: 7pt;text-indent: 0pt;line-height: 12pt;text-align: left;">//</p></td><td style="width:38pt"><p class="s29" style="padding-right: 3pt;text-indent: 0pt;text-align: right;">19,401</p></td><td style="width:42pt"><p class="s29" style="padding-left: 3pt;text-indent: 0pt;line-height: 10pt;text-align: left;">ms</p></td></tr><tr style="height:15pt"><td style="width:30pt"><p class="s29" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">(45) ;</p></td><td style="width:24pt"><p class="s19" style="padding-left: 7pt;text-indent: 0pt;text-align: left;">//</p></td><td style="width:38pt"><p class="s29" style="padding-top: 1pt;padding-right: 3pt;text-indent: 0pt;text-align: right;">0.005</p></td><td style="width:42pt"><p class="s29" style="padding-top: 1pt;padding-left: 3pt;text-indent: 0pt;text-align: left;">ms - good</p></td></tr><tr style="height:15pt"><td style="width:30pt"><p class="s29" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">(40) ;</p></td><td style="width:24pt"><p class="s19" style="padding-left: 7pt;text-indent: 0pt;text-align: left;">//</p></td><td style="width:38pt"><p class="s29" style="padding-top: 1pt;padding-right: 3pt;text-indent: 0pt;text-align: right;">2,467</p></td><td style="width:42pt"><p class="s29" style="padding-top: 1pt;padding-left: 3pt;text-indent: 0pt;text-align: left;">ms ???</p></td></tr><tr style="height:14pt"><td style="width:30pt"><p class="s29" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">(35) ;</p></td><td style="width:24pt"><p class="s19" style="padding-left: 7pt;text-indent: 0pt;line-height: 12pt;text-align: left;">//</p></td><td style="width:38pt"><p class="s29" style="padding-top: 1pt;padding-right: 3pt;text-indent: 0pt;text-align: right;">174</p></td><td style="width:42pt"><p class="s29" style="padding-top: 1pt;padding-left: 3pt;text-indent: 0pt;text-align: left;">ms ???</p></td></tr></table><p style="text-indent: 0pt;text-align: left;"/><p style="padding-left: 52pt;text-indent: 0pt;line-height: 144%;text-align: justify;"><span>const testMemoFib = memoize((n: number) =&gt; fib(n));<br/>addTiming(testMemoFib)</span></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 144%;text-align: justify;"><span>addTiming(testMemoFib)<br/>addTiming(testMemoFib)<br/>addTiming(testMemoFib)</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: left;"><span>Something’s wrong! The times should have gone down, but they are just about the same. This is<br/>because of a common error, which I’ve even seen in some articles and web pages. We are timing<br/>testMemoFib (), but nobody calls that function except for timing, which only happens once!<br/>Internally, all recursive calls are to f ib (), which isn’t memoized. If we called testMemoFib (45)<br/>again, </span><i>that </i><span>call would be cached, and it would return almost immediately, but that optimization doesn’t<br/>apply to the internal f ib () calls. This is the reason why the calls for testMemoFib (40) and<br/>testMemoFib (35) weren’t optimized - when we did the calculation for testMemoFib (45),<br/>that   was the only value that got cached.</span></p><p style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;text-align: left;">The correct solution is as follows:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 143%;text-align: left;"><span>fib = memoize(fib);<br/>addTiming(testFib)(45); // 0.1481 ms<br/>addTiming(testFib)(45); // 0.0022 ms<br/>addTiming(testFib)(40); // 0.0019 ms<br/>addTiming(testFib)(35); // 0.0029 ms</span></p><p style="padding-top: 8pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>Now, when calculating f ib (4 5), all the intermediate Fibonacci values (from fib(0) to fib (45)<br/>itself) are stored, so the forthcoming calls have practically no work to do.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;text-align: left;">Now that we know how to memoize single-argument functions, let’s look at functions with more arguments.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s34" style="padding-left: 43pt;text-indent: 0pt;text-align: left;">More complex memoization</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>What can we do if we have to work with a function that receives two or more arguments, or can receive<br/>arrays or objects as arguments? Of course, like in the problem that we looked at in </span><i>Chapter 2, Thinking</i><span>about having a function do its job only once, we could simply ignore the question: if<br/>the function to be memoized is unary, we go through the memoization process; otherwise, we don’t<br/>do anything!</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-left: 21pt;text-indent: 0pt;text-align: left;">186  <span class="s189">Producing Functions - Higher-Order Functions</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 66pt;text-indent: 0pt;text-align: justify;"><a name="bookmark251">On the length of functions</a></p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;line-height: 115%;text-align: justify;">The number of parameters of a function is called the functions <i>arity, </i>or <i>valence, </i><span>and JavaScript<br/>provides it as the function’s length attribute; see developer. mozilla . org/en-US/<br/>docs/Web/JavaScript/Reference/Global_Objects/Function/length.</span></p><p style="padding-left: 65pt;text-indent: 0pt;line-height: 115%;text-align: justify;"><span>You may speak in three different ways: you can say a function has arity one, two, three, and so<br/>on; you can say that a function is unary, binary, ternary, and so on; or you can say it’s monadic,<br/>dyadic, triadic, and so on. Take your pick!</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>Our first attempt could be just memoizing unary functions and leaving the rest alone, as in the<br/>following code:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: justify;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;text-align: justify;">const memoize2 = &lt;</p><p style="padding-top: 4pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">T extends (x: number, ...y: any[]) =&gt; any</p><p style="padding-top: 5pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">&gt;(</p><p style="padding-top: 3pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">fn: T</p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">): ((x: number, ...y: any[]) =&gt; ReturnType&lt;T&gt;) =&gt; {</p><p class="s10" style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">if (fn.length === 1) {</p><p style="padding-top: 4pt;padding-left: 85pt;text-indent: 0pt;line-height: 143%;text-align: left;"><span>const cache = {} as Recordcnumber, ReturnType&lt;T&gt;&gt;;<br/>return (x) =&gt;</span></p><p style="padding-left: 97pt;text-indent: 0pt;text-align: left;">x in cache ? cache [x] : (cache [x] = fn(x));</p><p class="s10" style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">} else {</p><p class="s10" style="padding-top: 4pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">return fn;</p><p style="padding-top: 6pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Working more seriously, if we want to be able to memoize any function, we must find a way to<br/>generate cache keys. To do this, we must find a way to convert any argument into a string. We cannot<br/>use a non-primitive as a cache key directly. We could attempt to convert the value into a string with<br/>something such as strX = String (x), but we&#39;d have problems. With arrays, it seems this could<br/>work. However, take a look at the following three cases that involve different arrays but with a twist:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;text-align: left;">var a = [1, 5, 3, 8, 7, 4, 6] ;</p><p style="padding-top: 4pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">String(a); // &quot; 1,5,3,8,7,4,6 &quot;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">var b = [[1, 5], [3, 8, 7, 4, 6]];</p><p style="padding-top: 4pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">String(b); // &quot;1,5,3,8,7,4,6&quot;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 12pt;padding-left: 291pt;text-indent: 0pt;text-align: left;">Wrapping functions - keeping behavior   187</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">var c = [[1, 5, 3], [8, 7, 4, 6]];</p><p style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">string(c); // &quot;1,5,3,8,7,4,6&quot;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>These three cases produce the same result. If we were only considering a single array argument, we’d<br/>be able to make do, but when different arrays produce the same key, that’s a problem. Things become<br/>worse if we have to receive objects as arguments because the String () representation of any object<br/>is, invariably, &quot; [object Object]</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">var d = {a: &quot;fk&quot;};</p><p style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">String(d); // &quot;[object Object]&quot;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">var e = [{p: 1, q: 3}, {p: 2, q: 6}];</p><p style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">String(e); // &quot; [object Object] , [object Object] &quot;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>The simplest solution is to use JSON . stringify () to convert whatever arguments we have<br/>received into a useful, distinct string:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">var a = [1, 5, 3, 8, 7, 4, 6] ;</p><p style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">JSON.stringify(a); // &quot; [1,5,3,8,7,4,6] &quot;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">var b = [[1, 5], [3, 8, 7, 4, 6] ] ;</p><p style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">JSON.stringify(b) ; // &quot; [ [1,5] , [3,8,7,4,6]] &quot;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">var c = [[1, 5, 3], [8, 7, 4, 6]];</p><p style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">JSON.stringify(c) ; // &quot; [ [1,5,3] , [8,7,4,6]] &quot;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">var d = {a: &quot;fk&quot;}; JSON.stringify(d); // &quot;{&quot;a&quot;:&quot;fk&quot;}</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 8pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">var e = [{p: 1, q: 3}, {p: 2, q: 6}];</p><p style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">JSON.stringify(e) ; // &quot; [ {&quot;p&quot;:1, &quot;q&quot;:3}, {&quot;p&quot;:2, &quot;q&quot;:6}] &quot;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>For performance, our logic should be as follows: if the function we are memoizing receives a single<br/>argument that’s a primitive value, we can use that argument directly as a cache key. In other cases, we<br/>would use the result of JSON. stringify () that’s applied to the array of arguments. Our enhanced<br/>memoizing HOF could be as follows:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s9" style="padding-left: 53pt;text-indent: 0pt;text-align: left;">I<span class="p">/ continued...</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 65pt;text-indent: -12pt;line-height: 142%;text-align: left;"><span>const memoize3 = &lt;T extends (...x: any[]) =&gt; any&gt;(<br/>fn: T</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 21pt;text-indent: 0pt;text-align: left;">188  Producing Functions - Higher-Order Functions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 73pt;text-indent: -11pt;line-height: 146%;text-align: left;"><span>): ((...x: Parameters&lt;T&gt;) =&gt; ReturnType&lt;T&gt;) =&gt; {<br/>const cache = {} as Record&lt;</span></p><p style="padding-left: 85pt;text-indent: 0pt;line-height: 143%;text-align: left;"><span>number | string,<br/>ReturnType&lt;T&gt;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 73pt;text-indent: 0pt;line-height: 143%;text-align: left;"><span>const PRIMITIVES = [&quot;number&quot;, &quot;string&quot;];<br/>return (...args) =&gt; {</span></p><p style="padding-left: 97pt;text-indent: -12pt;line-height: 144%;text-align: left;"><span>const strX: number | string =<br/>args.length === 1 &amp;&amp;</span></p><p class="s10" style="padding-left: 97pt;text-indent: 0pt;line-height: 10pt;text-align: left;">PRIMITIVES.includes(typeof args[0])</p><p class="s10" style="padding-top: 4pt;padding-left: 110pt;text-indent: 0pt;text-align: left;">? args[0]</p><p class="s10" style="padding-top: 4pt;padding-left: 111pt;text-indent: 0pt;text-align: left;">: JSON.stringify(args);</p><p style="padding-top: 4pt;padding-left: 32pt;text-indent: 0pt;text-align: center;">return strX in cache</p><p style="padding-top: 4pt;padding-left: 34pt;text-indent: 0pt;text-align: center;">? cache[strX]</p><p style="padding-top: 4pt;padding-left: 51pt;text-indent: 0pt;text-align: center;">: (cache[strX] = fn(...args));</p><p style="padding-top: 6pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">};</p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">};</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>In terms of universality, this is the safest version. If you are sure about the type of parameters in the<br/>function you will process, it’s arguable that our first version was faster. On the other hand, if you want<br/>to have easier-to-understand code, even at the cost of some wasted CPU cycles, you could go with a<br/>simpler version:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 74pt;text-indent: -12pt;line-height: 141%;text-align: left;"><span>const memoize4 = &lt;T extends (...x: any[]) =&gt; any&gt;(<br/>fn: T</span></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">): ((...x: Parameters&lt;T&gt;) =&gt; ReturnType&lt;T&gt;) =&gt; {</p><p style="padding-top: 4pt;padding-left: 73pt;text-indent: 0pt;line-height: 143%;text-align: left;"><span>const cache = {} as Record&lt;string, ReturnType&lt;T&gt;&gt;;<br/>return (...args) =&gt; {</span></p><p class="s10" style="padding-left: 85pt;text-indent: 0pt;text-align: left;">const strX = JSON.stringify(args);</p><p style="padding-top: 4pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">return strX in cache</p><p style="padding-top: 4pt;padding-left: 98pt;text-indent: 0pt;text-align: left;">? cache[strX]</p><p style="padding-top: 4pt;padding-left: 99pt;text-indent: 0pt;text-align: left;">: (cache[strX] = fn(...args));</p><p style="padding-top: 6pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">};</p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">};</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 291pt;text-indent: 0pt;text-align: left;">Wrapping functions - keeping behavior   189</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 57pt;text-indent: 0pt;text-align: justify;"><a name="bookmark252">Birth of a speeder</a></p><p style="padding-top: 4pt;padding-left: 56pt;text-indent: 0pt;line-height: 114%;text-align: justify;"><span>If you want to learn about the development of a top-performance memoizing function, read<br/>Caio Gondim’s </span><i>How I wrote the world’s fastest JavaScript memoization library </i><span>article, available<br/>online  at  blog  .  rising  st  ack  .  com/the  -worlds  -  fastest-j  avascript-<br/>memoization-library/.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>So far, we have achieved several interesting memoizing functions, but how will we write tests for<br/>them? Let’s analyze this problem now.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s34" style="padding-left: 43pt;text-indent: 0pt;text-align: left;">Memoization testing</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: left;"><span>Testing the memoization HOF poses an interesting problem - how would you go about it? The first<br/>idea would be to look into the cache, but that’s private and not visible. Then, of course, we could<br/>change memoi ze () so that it uses a global cache or somehow allows external access to the cache, but<br/>doing that sort of internal exam is frowned upon: you should try to do your tests based on external<br/>properties only.</span></p><p style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>Accepting that we shouldn’t try to examine the cache, we could go for a time control: calling a function<br/>such as fib (n) for a large value of n should take longer if the function isn’t memoized. This is</span></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: left;"><span>certainly possible, but it’s also prone to possible failures: something external to your tests could run<br/>at just the wrong time, and it could be possible that your memoized run would take longer than the<br/>original one. Okay, it’s possible, but not probable - but your test isn’t entirely reliable.</span></p><p style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>We could think about calculating some Fibonacci numbers and testing how many times the function<br/>was called - once directly and all the other times because of recursion. (See </span><i>Question 6.3 </i><span>for more on<br/>this.) The preceding code is fairly straightforward: we are using the Fibonacci function we developed<br/>earlier and testing that it produces correct values. For instance, we can find out that calculating f ib (6)<br/>requires 25 calls by revisiting the diagram we looked at in </span><i>Chapter 4, Behaving Properly, </i><span>and seeing<br/>that there are 25 nodes (each one representing a call to f ib ()) in it:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 79pt;text-indent: 0pt;text-align: left;"><span><img width="434" height="197" alt="image" src="Image_026.gif"/></span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 145pt;text-indent: 0pt;text-align: left;">Figure 6.1 - 25 calls are needed for calculating fib(6)</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 21pt;text-indent: 0pt;text-align: left;">190  <span class="p">Producing Functions - Higher-Order Functions</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">The first idea would be counting calls, as shown here - but it won’t work!</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// memoize.test.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">import { fib } from /fibonacci&quot;;</p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">import * as moduleFib from         /fibonacci&quot;;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 74pt;text-indent: -12pt;line-height: 144%;text-align: left;"><span>describe(&quot;the    original    fib&quot;,    function    ()    {<br/>it(&quot;should   repeat   calculations&quot;,   ()   =&gt;   {</span></p><p style="padding-left: 85pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>jest.spyOn(moduleFib, &quot;fib&quot;);<br/>expect(fib(6)).toBe(8);<br/></span><b>expect(fib).toHaveBeenCalledTimes(25);</b></p><p style="padding-top: 1pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">});</p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">});</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>We first calculate f ib (6) - which correctly returns 8 - and then we check that there should have<br/>been 25 calls to f ib (), but only one was found; what’s going on? The problem is in Jest: when you</span></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 10pt;text-align: left;">spy on a function, you are actually spying on a wrapper that calls the function you want to check. <i>Tins</i></p><p style="padding-top: 2pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">wrapper function is called only once; our f ib () function was called 25 times, but Jest doesn’t see that!</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>We’ll have to do something else in a very non-functional way! Let’s test a modified f ib () function<br/>that will update an external counter; we’ll call it f ibM ():</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 74pt;text-indent: -12pt;line-height: 144%;text-align: left;"><span>describe(&quot;the modified fib&quot;, function () {<br/>it(&quot;should repeat calculations&quot;, () =&gt; {</span></p><p class="s10" style="padding-left: 86pt;text-indent: 0pt;line-height: 10pt;text-align: left;">let count = 0;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">const fibM = (n: number): number =&gt; {</p><p class="s10" style="padding-top: 4pt;padding-left: 97pt;text-indent: 0pt;text-align: left;">count++;</p><p style="padding-top: 4pt;padding-left: 120pt;text-indent: -6pt;line-height: 142%;text-align: left;"><span>if (n == 0) {<br/>return 0;</span></p><p style="padding-left: 109pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>} else if (n == 1) {<br/>return 1;</span></p><p style="padding-left: 98pt;text-indent: 0pt;line-height: 10pt;text-align: left;">} else {</p><p style="padding-top: 4pt;padding-left: 109pt;text-indent: 0pt;text-align: left;">return fibM(n - 2) + fibM(n - 1);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 86pt;text-indent: 0pt;text-align: left;">};</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 291pt;text-indent: 0pt;text-align: left;">Wrapping functions - keeping behavior   191</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 77pt;text-indent: 0pt;text-align: left;"><a name="bookmark253">expect(fibM(6)) .toBe (8);</a><a name="bookmark254">&zwnj;</a></p><p class="s10" style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">expect(count) .toBe (25);</p><p class="s17" style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">});</p><p class="s17" style="padding-top: 2pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">});</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Now that the test works out, how about testing the memoized, modified version instead? In this case,<br/>the count of calls should be lower because of cached results. In fact, it should just be 7 because we’ll<br/>need all values from f ib (6) down to f ib (0):</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s9" style="padding-left: 53pt;text-indent: 0pt;text-align: left;">I<span class="p">/ continued...</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 65pt;text-indent: -12pt;line-height: 143%;text-align: left;"><span>describe(&quot;the   memoized,   modified   fib&quot;,   function   ()   {<br/>it(&quot;should repeat calculations&quot;, () =&gt; {</span></p><p style="padding-left: 77pt;text-indent: 0pt;text-align: left;">let count = 0;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 89pt;text-indent: -12pt;line-height: 144%;text-align: left;"><span>const fibMM = memoize((n: number): number = &gt; {<br/>count++;</span></p><p style="padding-left: 111pt;text-indent: -6pt;line-height: 142%;text-align: left;"><span>if (n == 0) {<br/>return 0;</span></p><p style="padding-left: 101pt;text-indent: -11pt;line-height: 143%;text-align: left;"><span>} else if (n == 1) {<br/>return 1;</span></p><p style="padding-left: 89pt;text-indent: 0pt;text-align: left;">} else {</p><p style="padding-top: 4pt;padding-left: 101pt;text-indent: 0pt;text-align: left;">return fibMM(n - 2) + fibMM(n - 1);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 77pt;text-indent: 0pt;text-align: left;">});</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 76pt;text-indent: 0pt;text-align: left;">expect(f ibMM(6)) .toBe(8) ;</p><p class="s10" style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">expect(count).toBe(7);</p><p class="s17" style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">});</p><p style="padding-top: 9pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>In this section, we’ve dealt with several examples that implied wrapping functions so that they keep<br/>working but with some extra features added in. Now, let’s look at a different case where we want to<br/>change how a function works.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s34" style="padding-left: 43pt;text-indent: 0pt;text-align: justify;">Memoizing promises</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: justify;"><span>Let’s go a bit further and consider memoizing async functions, which return promises. In a complex<br/>web application with many related components, it may very well be the case that redundant, repeated</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 21pt;text-indent: 0pt;text-align: left;">192  Producing Functions - Higher-Order Functions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>API calls go out for no good reason, harming performance and producing a bad user experience.<br/>Imagine, for instance, a dashboard-style web page with several tabs. Whenever a user selects a tab,<br/>several API calls go out to get the data that the page needs. However, if the user selects a different tab<br/>but later returns to the first one, the very same API calls will go out again. For many applications, data<br/>is basically constant, meaning “not changing in real time.” You don’t then need to re-send API calls;<br/>re-using previously fetched data also works.</span></p><p style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Some solutions are not practical: we could modify the server to enable caching, but what if that’s not<br/>possible? Or we could work with a cache, checking before every call whether that data was already<br/>fetched, but that would entail hand-modifying every single API call to check the cache first! We want<br/>a solution that requires no code changes, and memoizing comes to mind.</span></p><p style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: left;"><span>Assume we call the API with an async function that returns a promise. Given the memoize ()<br/>function we developed, we could memoize the async function, and it would be a start. The first time<br/>you call the function with some arguments, the API call will go out, and a promise will be returned<br/>(since that’s what the function returns). If you call the function again with the same arguments, the<br/>memoized promise will be immediately returned. Great! Except there’s a catch... what would happen<br/>if the API call failed? We need to add some error-catching logic:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// memoize.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 73pt;text-indent: -11pt;line-height: 143%;text-align: left;"><span>const promiseMemoize = &lt;<br/>A,</span></p><p style="padding-left: 73pt;text-indent: 0pt;text-align: left;">T extends (...x: any[]) =&gt; Promise&lt;A&gt;</p><p style="padding-top: 5pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">&gt;(</p><p style="padding-top: 3pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">fn: T</p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">): ((...x: Parameters&lt;T&gt;) =&gt; Promise&lt;A&gt;) =&gt; {</p><p style="padding-top: 4pt;padding-left: 73pt;text-indent: 0pt;line-height: 143%;text-align: left;"><span>const cache = {} as Record&lt;string, Promise&lt;A&gt;&gt;;<br/>return (...args) =&gt; {</span></p><p style="padding-left: 85pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>const strX = JSON.stringify(args);<br/>return strX in cache</span></p><p style="padding-left: 98pt;text-indent: 0pt;line-height: 10pt;text-align: left;">? cache[strX]</p><p style="padding-top: 4pt;padding-left: 121pt;text-indent: -22pt;line-height: 143%;text-align: left;">: (cache[strX] = <b>fn(...args).catch((x) =&gt; {</b></p><p class="s10" style="padding-left: 121pt;text-indent: 0pt;line-height: 10pt;text-align: left;">return x;</p><p style="padding-top: 6pt;padding-left: 110pt;text-indent: 0pt;text-align: left;">}));</p><p style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">};</p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">};</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 329pt;text-indent: 0pt;text-align: left;">Altering a function&#39;s behavior  193</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: justify;">All logic is as before, with a couple of additional details:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l66"><li data-list-text="•"><p class="s33" style="padding-left: 70pt;text-indent: -13pt;line-height: 123%;text-align: left;">	<span class="p">We are now making explicit that the memoized function returns a promise (Promise&lt;A&gt;)<br/>of some generic type A</span></p></li><li data-list-text="•"><p class="s33" style="padding-top: 5pt;padding-left: 70pt;text-indent: -13pt;line-height: 123%;text-align: left;">	<span class="p">If the promise is rejected, we add code to delete the cached promise, so a future call will go<br/>out again</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 126%;text-align: justify;"><span>Our newpromiseMemoize () function can deal with errors, allowing future retries of rejected calls;<br/>good! Now let’s look at a different case, where we want to change the way a function actually works.</span></p><p class="s6" style="padding-top: 8pt;padding-left: 43pt;text-indent: 0pt;text-align: justify;"><a name="bookmark255">Altering a function&#39;s behavior</a></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>In the previous section, we considered some ways of wrapping functions so that they maintain their<br/>original functionality, even though they’ve been enhanced in some way. Now, we’ll turn to modifying<br/>what the functions do so that the new results will differ from their original ones.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;text-align: justify;">We’ll be covering the following topics:</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="•"><p style="padding-left: 70pt;text-indent: -13pt;text-align: left;">Revisiting the problem of having a function work, but just once</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">Negating or inverting a function’s result</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">Changing the arity of a function</p></li><li data-list-text="•"><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 13pt;line-height: 213%;text-align: left;"><span>Throttling and debouncing functions for performance<br/>Let’s get started!</span></p></li></ul><p class="s12" style="padding-top: 1pt;padding-left: 44pt;text-indent: 0pt;text-align: justify;"><a name="bookmark256">Doing things once, revisited</a></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: left;">In <i>Chapter 2, Thinking Functionally, </i><span>we went through an example of developing an FP-style solution<br/>for a simple problem: fixing things so that a given function works only once. We defined once ()<br/>with an arrow function then; let’s go with a standard function for variety:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// once.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 65pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>function once&lt;T extends (...args: any[]) =&gt; void&gt;(<br/>f: T</span></p><p style="padding-left: 65pt;text-indent: -11pt;line-height: 143%;text-align: left;"><span>):   (...args:   Parameters&lt;T&gt;)   =&gt;   void   {<br/>let done = false;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 77pt;text-indent: -12pt;line-height: 143%;text-align: left;"><span>return ((...args: Parameters&lt;T&gt;) =&gt; {<br/>if (1 done) {</span></p><p style="padding-left: 88pt;text-indent: 0pt;text-align: left;">done = true;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-left: 21pt;text-indent: 0pt;text-align: left;">194  <span class="s189">Producing Functions - Higher-Order Functions</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 98pt;text-indent: 0pt;text-align: left;">f(...args);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 8pt;padding-left: 47pt;text-indent: 0pt;text-align: center;">}) as T;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>This is a perfectly acceptable solution; it works well, and we have nothing to object to. We can, however,<br/>think of a variation. We could observe that the given function gets called once, but its return value<br/>gets lost. This is easy to fix: we need to add a return statement. However, that wouldn’t be enough;<br/>what would the function return if it’s called more than once? We can take a page from the memoizing<br/>solution and store the function’s return value for future calls.</span></p><p style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;text-align: justify;">Let’s store the function’s value in a result variable so that we can return it later:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: center;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 74pt;text-indent: -12pt;line-height: 142%;text-align: left;"><span>function once2&lt;T extends (...args: any[]) =&gt; any&gt;(<br/>f: T</span></p><p style="padding-left: 74pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>): (...args: Parameters&lt;T&gt;) =&gt; ReturnType&lt;T&gt; {<br/>let done = false;</span></p><p class="s10" style="padding-left: 74pt;text-indent: 0pt;line-height: 10pt;text-align: left;">let result: ReturnType&lt;T&gt;;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 86pt;text-indent: -12pt;line-height: 144%;text-align: left;"><span>return ((...args: Parameters&lt;T&gt;): ReturnType&lt;T&gt; =&gt; {<br/>if (1 done) {</span></p><p style="padding-left: 97pt;text-indent: 0pt;line-height: 10pt;text-align: left;">done = true;</p><p class="s10" style="padding-top: 4pt;padding-left: 97pt;text-indent: 0pt;text-align: left;"><a name="bookmark257">result = f(...args);</a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-top: 7pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">return result;</p><p style="padding-top: 5pt;padding-left: 47pt;text-indent: 0pt;text-align: center;">}) as T;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>The first time the function gets called, its value is stored in result; further calls just return that<br/>value with no further process. You could also think of making the function work only once but for<br/>each set of arguments. You wouldn’t have to do any work for that - memoize () would be enough!</span></p><p style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;">Back in the <i>Producing an even better solution </i>section of <i>Chapter 2, Thinking Functionally, </i><span>we considered<br/>a possible alternative to once (): another HOF that took two functions as parameters and allowed<br/>the first function to be called only once, calling the second function from that point on. Adding a<br/>return statement to the previous code and rewriting it as a standard function would result as follows:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: center;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 329pt;text-indent: 0pt;text-align: left;">Altering a function&#39;s behavior  195</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 65pt;text-indent: -12pt;line-height: 146%;text-align: left;"><span>function onceAndAfter&lt;T extends (...args: any[]) =&gt; any&gt;(<br/>f: T,</span></p><p style="padding-left: 64pt;text-indent: 0pt;line-height: 10pt;text-align: left;">g: T</p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>): (...args: Parameters&lt;T&gt;) =&gt; ReturnType&lt;T&gt; {<br/>let done = false;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 64pt;text-indent: 0pt;text-align: left;">return ( (...args: Parameters&lt;T&gt;) : ReturnType&lt;T&gt; =&gt; {</p><p class="s10" style="padding-top: 4pt;padding-left: 88pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>if (idone) {<br/>done = true;</span></p><p class="s10" style="padding-left: 89pt;text-indent: 0pt;line-height: 10pt;text-align: left;">return f(...args);</p><p class="s10" style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">} else {</p><p class="s10" style="padding-top: 4pt;padding-left: 89pt;text-indent: 0pt;text-align: left;">return g(...args);</p><p style="padding-top: 6pt;text-indent: 0pt;text-align: center;">}</p><p style="padding-top: 2pt;padding-left: 29pt;text-indent: 0pt;text-align: center;">}) as T;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>We can rewrite this if we remember that functions are first-order objects. Instead of using a flag to<br/>remember which function to call, we can use a toCall variable to directly store whichever function<br/>needs to be called. Logically, that variable will be initialized to the first function but will then change<br/>to the second one. The following code implements that change:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s9" style="padding-left: 26pt;text-indent: 0pt;text-align: center;">/I <span class="p">continued...</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 65pt;text-indent: -12pt;line-height: 144%;text-align: left;"><span>function onceAndAfter2&lt;T extends (...args: any[]) =&gt; any&gt;(<br/>f:  T,</span></p><p style="padding-left: 23pt;text-indent: 0pt;text-align: center;">g:  T</p><p style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">): (...args: Parameters&lt;T&gt;) =&gt; ReturnType&lt;T&gt; {</p><p class="s10" style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">let toCall = f;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">return ((...args: Parameters&lt;T&gt;): ReturnType&lt;T&gt; =&gt; {</p><p class="s10" style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;line-height: 143%;text-align: left;"><span>let result = toCall(...args);<br/>toCall = g;</span></p><p class="s10" style="padding-left: 77pt;text-indent: 0pt;text-align: left;">return result;</p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">}) as T;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-left: 21pt;text-indent: 0pt;text-align: left;">196  <span class="s189">Producing Functions - Higher-Order Functions</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>The toCall variable is initialized with f, so f () will get called the first time, but then toCall gets<br/>the g value, implying that all future calls will execute g () instead. The very same example we looked<br/>at earlier in this book would still work:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>const   squeak   =   (x:   string)   =&gt;   console.log(x,   &quot;squeak!!&quot;);<br/>const creak = (x: string) =&gt; console.log(x, &quot;creak!!&quot;);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;text-align: left;">const makeSound = onceAndAfter2(squeak, creak);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 61pt;text-indent: 0pt;line-height: 144%;text-align: justify;"><span>makeSound(&quot;door&quot;);<br/>makeSound(&quot;door&quot;);<br/>makeSound(&quot;door&quot;);<br/>makeSound(&quot;door&quot;);</span></p><p style="padding-top: 4pt;padding-left: 37pt;text-indent: 0pt;text-align: left;">// &quot;door squeak!!&quot;</p><p style="padding-top: 4pt;padding-left: 37pt;text-indent: 0pt;text-align: left;">// &quot;door creak!!&quot;</p><p style="padding-top: 4pt;padding-left: 37pt;text-indent: 0pt;text-align: left;">// &quot;door creak!!&quot;</p><p style="padding-top: 4pt;padding-left: 37pt;text-indent: 0pt;text-align: left;">// &quot;door creak!!&quot;</p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>In terms of performance, the difference may be negligible. The reason for showing this further variation<br/>is to show that you should keep in mind that, by storing functions, you can often produce results more<br/>simply. Using flags to store state is a common technique in procedural programming. However, here,<br/>we manage to skip that usage and produce the same result. Now, let’s look at some new examples of<br/>wrapping functions to change their behaviors.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 53pt;text-indent: 0pt;text-align: justify;"><a name="bookmark258">Logically negating a function</a></p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;">Let’s consider the filter () method from <i>Chapter 5, Programming Declaratively. </i><span>Given a predicate,<br/>we can filter the array to only include those elements for which the predicate is true. But how would<br/>you                                                                                                      do a reverse filter and exclude the elements for which the predicate is true?</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>The first solution should be pretty obvious: rework the predicate to return the opposite of whatever it<br/>originally returned. In the mentioned chapter, we looked at the following example:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// not.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">const      delinquent      =      serviceResult.accountsData.filter(</p><p style="padding-top: 4pt;padding-left: 76pt;text-indent: 0pt;text-align: left;">(v) =&gt; v.balance &lt; 0</p><p style="padding-top: 5pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">(For the serviceResult object, see the <i>Afilter() example </i>section in the previous chapter.)</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>So, we could write it the other way round, in either of these equivalent fashions. Note the different<br/>ways of writing the same predicate to test for non-negative values:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 12pt;padding-left: 329pt;text-indent: 0pt;text-align: left;">Altering a function&#39;s behavior  197</p><p style="padding-top: 22pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">const notDelinquent = serviceResult.accountsData.filter(</p><p class="s10" style="padding-top: 4pt;padding-left: 66pt;text-indent: 0pt;text-align: left;">(v) =&gt; v.balance &gt;= 0</p><p style="padding-top: 5pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">const notDelinquent2 = serviceResult.accountsData.filter(</p><p class="s10" style="padding-top: 4pt;padding-left: 66pt;text-indent: 0pt;text-align: left;">(v) =&gt; !(v.balance &lt; 0)</p><p style="padding-top: 5pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: left;">That’s perfectly fine, but we could also have had something like the following in our code:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><table style="border-collapse:collapse;margin-left:50.53pt" cellspacing="0"><tr style="height:10pt"><td style="width:146pt"><p class="s29" style="padding-left: 2pt;text-indent: 0pt;line-height: 9pt;text-align: left;">const isNegativeBalance = (v:</p></td><td style="width:154pt"><p class="s29" style="padding-left: 35pt;text-indent: 0pt;line-height: 9pt;text-align: left;">AccountData) =&gt; v.balance &lt; 0;</p></td></tr></table><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 54pt;text-indent: 0pt;text-align: left;">. many lines later</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 65pt;text-indent: -12pt;line-height: 144%;text-align: left;"><span>const delinquent2 = serviceResult.accountsData.filter(<br/>isNegativeBalance</span></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>In  this  case,  rewriting  the  original  isNegativeBalance  ()  function  isn’t  possible.  (Another<br/>possibility: the function could be defined in a separate module, which you can’t or shouldn’t modify.)<br/>However, working in a functional way, we can write an HOF that will take any predicate, evaluate<br/>it,  and then negate its result. A possible implementation would be pretty straightforward, thanks to<br/>modern JavaScript syntax - and for the TypeScript version, check </span><i>Question 6.5:</i></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">const <b>not = </b>(fn) =&gt; (...args) =&gt; !fn(...args);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>Working in this way, we could have rewritten the preceding filter as follows; to test for non-negative<br/>balances, we use the original i sNegat iveBalance () function, which is negated via our not () HOF:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">const notDelinquent3 = serviceResult.accountsData.filter(</p><p class="s10" style="padding-top: 4pt;padding-left: 64pt;text-indent: 0pt;text-align: left;">not(isNegativeBalance)</p><p style="padding-top: 5pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 21pt;text-indent: 0pt;text-align: left;">198  Producing Functions - Higher-Order Functions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>There is an additional solution we might want to try out. Instead of reversing the condition (as we did),<br/>we could write a new filtering method (possibly f ilterNot () ?) that would work in the opposite<br/>way to f ilter (). The following code shows how this new function would be written. Given an<br/>arr array of values and an f n predicate, we’d have the following:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;"><a name="bookmark259">// continued...</a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">const <b>filterNot =</b></p><p style="padding-top: 4pt;padding-left: 76pt;text-indent: -1pt;line-height: 142%;text-align: left;"><a name="bookmark260"><span>&lt;A, T extends (x: A) =&gt; boolean&gt;(arr: A[]) =&gt;<br/>(fn: T) : A [] =&gt;</span></a></p><p class="s10" style="padding-left: 85pt;text-indent: 0pt;text-align: left;">arr.filter(not((y) =&gt; fn(y)));</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>This solution doesn’t fully match filter () since you cannot use it as a method, but we could<br/>either add it to Array. prototype or apply some methods. We’ll look at these ideas in </span><i>Chapter 8,</i><span>However, it’s more interesting to note that we used the negated function, so<br/>not   () is necessary for both solutions to the reverse filtering problem. In the upcoming </span><i>Demethodizing</i></p><p class="s9" style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;">- turning methods into functions <span class="p">section, we will see that we have yet another solution since we can<br/>decouple methods such as filter () from the objects they apply to, thereby changing them into<br/>common functions.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>As for negating the function versus using a new f i 1 terNot () function, even though both possibilities<br/>are equally valid, I think using not () is clearer. If you already understand how filtering works, then<br/>you can practically read the code aloud, and it will be understandable: we want those accounts that don’t<br/>have a negative balance, right? Now, let’s consider a related problem: inverting the results of a function.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 53pt;text-indent: 0pt;text-align: justify;"><a name="bookmark261">Inverting the results</a></p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;text-align: justify;">In the same vein as the preceding filtering problem, let’s revisit the sorting problem from the <i>Injection</i></p><ul id="l67"><li data-list-text="-"><p class="s9" style="padding-top: 2pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;">sorting it out <span class="p">section of </span>Chapter 3, Starting Out with Functions. <span class="p">Here, we wanted to sort an array<br/>with a specific method. Therefore, we used sort (), providing it with a comparison function that<br/>basically pointed out which of the two strings should go first. To refresh your memory, given two<br/>strings, the function should do the following:</span></p><ul id="l68"><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 79pt;text-indent: -13pt;text-align: left;">Return a negative number if the first string should precede the second one</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 79pt;text-indent: -13pt;text-align: left;">Return 0 if the strings are the same</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 79pt;text-indent: -13pt;text-align: left;">Return a positive number if the first string should follow the second one</p></li></ul></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Let’s go back to the code we looked at for sorting in Spanish. We had to write a specialized comparison<br/>function so that sorting would take into account the character-ordering rules from Spanish, such as<br/>placing the letter </span><i>h </i>between <i>n </i>and <i>o, </i>and more. The code for this was as follows:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;text-align: left;">const spanishComparison = (a: string, b: string)</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 329pt;text-indent: 0pt;text-align: left;">Altering a function&#39;s behavior  199</p><p style="padding-top: 3pt;padding-left: 52pt;text-indent: 12pt;line-height: 30pt;text-align: left;"><span>a.localeCompare(b, &quot;es&quot;);<br/>palabras.sort(spanishComparison);</span></p><p style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// sorts the array according to Spanish rules</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>We are facing a similar problem: how can we sort in descending order? Given what we saw in the<br/>previous section, some options should immediately come to mind:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l69"><li data-list-text="•"><p class="s33" style="padding-left: 70pt;text-indent: -13pt;line-height: 126%;text-align: justify;">	<span class="p">Sort into ascending order, and afterward reverse the array. While this solves the problem, we<br/>still only sort into ascending order, and we would want to avoid the extra reversing step.</span></p></li><li data-list-text="•"><p class="s33" style="padding-top: 5pt;padding-left: 70pt;text-indent: -13pt;line-height: 124%;text-align: justify;">	<span class="p">Write a function that will invert the result from the comparing function. This will invert the<br/>result of all the decisions as to which string should precede, and the final result will be an array<br/>sorted in exactly the opposite way.</span></p></li><li data-list-text="•"><p class="s33" style="padding-top: 5pt;padding-left: 70pt;text-indent: -13pt;line-height: 125%;text-align: justify;">	<span class="p">Write a sortDescending () function or method that does its work in the opposite fashion<br/>to sort ().</span></p></li></ul><p style="padding-top: 8pt;padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>Let’s opt for the second option and write an invert () function that will change the comparison result.<br/>The code itself is quite similar to that of not (). Again, check </span><i>Question 6.5 </i>for the TypeScript equivalent:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// invert.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">const invert = (fn) =&gt; (...args) =&gt; <b>-fn(...args);</b></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Given this HOF, we can sort in descending order by providing a suitably inverted comparison<br/>function. Take a look at the last few lines, where we use invert () to change the result of the<br/>sorting comparison:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 64pt;text-indent: -11pt;line-height: 143%;text-align: left;"><span>const spanishComparison = (a: string, b: string): number =&gt;<br/>a.localeCompare(b, &quot;es&quot;);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 65pt;text-indent: -12pt;line-height: 142%;text-align: left;"><span>const palabras = [<br/>&quot;nandu&quot;,</span></p><p style="padding-left: 65pt;text-indent: 0pt;text-align: left;">&quot;oasis&quot;,</p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;line-height: 143%;text-align: left;"><span>&quot;mano&quot;,<br/>&quot;natural&quot;,<br/>&quot;mitico&quot;,<br/>&quot;musical&quot;,</span></p><p style="padding-top: 1pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">] ;</p><p style="padding-top: 3pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">palabras.sort(spanishComparison);</p><p style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// &quot;mano&quot;, &quot;mitico&quot;, &quot;musical&quot;, &quot;natural&quot;, &quot;nandu&quot;, &quot;oasis&quot;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 20pt;text-indent: 0pt;text-align: left;">200  Producing Functions - Higher-Order Functions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;text-align: left;"><a name="bookmark262">palabras.sort</a><b>(invert(spanishComparison));</b></p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">// &quot;oasis&quot;, &quot;nandu&quot;, &quot;natural&quot;, &quot;musical&quot;, &quot;mitico&quot;, &quot;mano&quot;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>The output is as expected: when we invert () the comparison function, the results are in the<br/>opposite order. Writing unit tests would be quite easy, given that we already have some test cases with<br/>their expected results, wouldn’t it?</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 52pt;text-indent: 0pt;text-align: justify;"><a name="bookmark263">Arity changing</a></p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;">Back in the <i>Parsing numbers tacitly </i>section of <i>Chapter 5, Programming Declaratively, </i><span>we saw that using<br/>parselnt () with reduce () produces problems because of the unexpected arity of that function,<br/>which took more than one argument—remember the example from earlier?</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 64pt;text-indent: 0pt;text-align: left;">[&quot;123.45&quot;, &quot;-67.8&quot;, &quot;90&quot;].map(parselnt);</p><p class="s10" style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">// [123, NaN, NaN]</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>We have more than one way to solve this. In the mentioned chapter, we went with an arrow function.<br/>This was a simple solution, with the added advantage of being clear to understand. In </span><i>Chapter </i><span>7,<br/></span><i>Transforming Functions, </i><span>we will look at yet another, based on partial application. For now, let’s go with<br/>an   HOF We need a function that will take another function as a parameter and turn it into a unary<br/>function. Using JavaScript’s spread operator and an arrow function, this is easy to manage:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 9pt;line-height: 220%;text-align: justify;"><span>const unary = fn =&gt; (...args) = &gt; fn(args[0]);<br/>The following is the example in TypeScript:</span></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// arity.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">const unary =</p><p class="s10" style="padding-top: 4pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">&lt;T extends (...x: any[]) =&gt; any&gt;(</p><p style="padding-top: 4pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">fn: T</p><p class="s10" style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;"><a name="bookmark264">): ((arg: Parameters&lt;T&gt;[0]) =&gt; ReturnType&lt;T&gt;) =&gt;</a></p><p style="padding-top: 4pt;padding-left: 64pt;text-indent: 0pt;text-align: left;">(x) =&gt; fn(x);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Our unary () function works with a generic T function. It produces a new function with just a single<br/>argument (the first one, Parameters&lt;T&gt; [0]) that returns the same type of result (ReturnType&lt;T&gt;)<br/>as   the original function does.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;text-align: justify;">Using this function, our number parsing problem goes away:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 64pt;text-indent: 0pt;text-align: left;">[&quot;123.45&quot;,     &quot;-67.8&quot;,</p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">// [123, -67, 90]</p><p style="padding-top: 4pt;padding-left: 8pt;text-indent: 0pt;text-align: left;">&quot;90&quot;] .map<b>(unary(parselnt)) ;</b></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 329pt;text-indent: 0pt;text-align: left;">Altering a function&#39;s behavior  201</p><p style="padding-top: 22pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: left;"><span>It goes without saying that it would be equally simple to define further binary () or ternary ()<br/>functions, and others that would turn any function into an equivalent but restricted-arity version.<br/>Let’s  not go overboard and just look at a couple of all the possible functions - see </span><i>Question 6.10 </i><span>for<br/>more on this:</span></p><p style="padding-top: 10pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="padding-top: 19pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">const binary = fn =&gt; (. a) =&gt; <b>fn(a[0], a[l]);</b></p><p style="padding-top: 19pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">const ternary = fn =&gt; (. a) =&gt; <b>fn(a[0], a[l], a[2]);</b></p><p style="padding-top: 12pt;padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>This works, but spelling out all the parameters can become tiresome. We can even go one better by using<br/>array operations and spreading and make a generic function to deal with all of these cases, as follows:</span></p><p style="padding-top: 10pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="padding-top: 19pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">const arity = <b>(n, </b>fn) = &gt; (...a) =&gt; fn(. <b>a.slice(0, n));</b></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>With this generic arity () function, we can give alternative definitions for unary (), binary (),<br/>and so on. We could even rewrite the earlier functions as follows:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;line-height: 143%;text-align: justify;"><span>const unary = fn =&gt; arity(1, fn);<br/>const binary = fn =&gt; arity(2, fn);<br/>const ternary = fn =&gt; arity(3, fn);</span></p><p style="padding-top: 8pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>You may think that there aren’t many cases in which you would want to apply this kind of solution,<br/>but there are many more than you would expect. Going through all of JavaScript’s functions and<br/>methods, you can quickly produce a list starting with apply (), assign (), bind (), concat (),<br/>copyWithin (), and many more! If you wanted to use any of those in a tacit way, you would probably<br/>need  to fix their arity so that they would work with a fixed, non-variable number of parameters.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 57pt;text-indent: 0pt;text-align: left;"><a name="bookmark265">Everything under the sun</a></p><p style="padding-top: 4pt;padding-left: 57pt;text-indent: 0pt;line-height: 115%;text-align: left;"><span>If you want a nice list of JavaScript functions and methods, check out developer. mozilla.<br/>org/en-US/docs/Web/JavaScript/Guide/Functions and developer.</span></p><p style="padding-left: 56pt;text-indent: 0pt;text-align: left;">mozilla.org/en-US/docs/Web/JavaScript/Reference/Methods_Index. As</p><p style="padding-top: 1pt;padding-left: 57pt;text-indent: 0pt;text-align: left;">for tacit programming (or pointfree style), we’ll return to it in <i>Chapter 8, Connecting Functions.</i></p><p style="padding-top: 6pt;padding-left: 56pt;text-indent: 0pt;line-height: 115%;text-align: left;"><span>There will be a problem with TypeScript, though. TypeScript deals with static typing, but the<br/>type of the result of a call to arity () is determined at runtime. The most we may manage</span></p><p style="padding-left: 56pt;text-indent: 0pt;line-height: 115%;text-align: left;"><span>is, by a series of overloads, to say that given a function with several parameters, the result of<br/>applying arity () to it will have zero, one, two, and so on different possibilities - but we<br/>won’t be able to do more.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 20pt;text-indent: 0pt;text-align: left;">202  Producing Functions - Higher-Order Functions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>So far, we have learned how to wrap functions while keeping their original behavior or changing it in<br/>some fashion. Now, lets consider some other ways of modifying functions.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 52pt;text-indent: 0pt;text-align: justify;"><a name="bookmark266">Throttling and debouncing</a></p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;text-align: justify;">Let’s finish this section with two techniques that limit when and how often a function “does its thing”:</p><p class="s10" style="padding-top: 2pt;padding-left: 52pt;text-indent: 0pt;text-align: justify;">debouncing <span class="p">and </span>throttling. <span class="p">Both techniques share the same concept, so we’ll tackle them together:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l70"><li data-list-text="•"><p class="s9" style="padding-left: 79pt;text-indent: -12pt;line-height: 123%;text-align: left;"><span class="s33">	</span>Debouncing <span class="p">a function means we delay for some time, doing nothing </span>until we <span class="p">actually call<br/>the function</span></p></li><li data-list-text="•"><p class="s9" style="padding-top: 5pt;padding-left: 79pt;text-indent: -12pt;line-height: 123%;text-align: left;"><span class="s33">	</span>Throttling <span class="p">a function means we delay for some time, doing nothing </span>after <span class="p">we actually call<br/>the function</span></p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>These techniques are very efficient for web pages and allow for better performance. In a sense, they<br/>are related to memoizing. With memoization, you modify a function so it will get called only once<br/>(for some given arguments) but never more. With the techniques here, we do not go that far - we will<br/>allow a function to do its thing again, but in a restricted way, with some delays added in.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s34" style="padding-left: 52pt;text-indent: 0pt;text-align: justify;">Debouncing functions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>The idea of debouncing comes from electronics and involves waiting to do something until a stable<br/>state has been reached. For example, if you write an autocomplete component, every time the user<br/>types a letter, you could query an API to fetch the possible options. However, you wouldn’t want to<br/>do this keypress by keypress because you’d be generating lots of calls, most of which you won’t even<br/>use since you’ll only care for the last one you made. Other usual examples involve mouse movement<br/>or page scrolling events; you don’t want to run associated handlers too often since that will negatively<br/>impact the page’s performance.</span></p><p style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>If you debounced the API-calling function, you could still call it for every keypress, but no API call<br/>would be made until some time elapsed without any more calls. See </span><i>Figure 6.2 </i><span>for an example of this;<br/>events are shown as circles, and the actual call goes only given some event-less time after the last event:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 104pt;text-indent: 0pt;text-align: left;"><span><img width="391" height="74" alt="image" src="Image_027.png"/></span></p><p style="padding-top: 2pt;padding-left: 52pt;text-indent: 60pt;line-height: 26pt;text-align: left;"><span>Figure 6.2 - A debounced function executes only after a pause in calls to it<br/>We can implement this with a timeout as follows:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// debounce.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 329pt;text-indent: 0pt;text-align: left;">Altering a function&#39;s behavior  203</p><p style="padding-top: 22pt;padding-left: 65pt;text-indent: -12pt;line-height: 142%;text-align: left;"><span>const  debounce  =  &lt;T  extends  (...args:  any[])  =&gt;  void&gt;(<br/>fn:  T,</span></p><p style="padding-left: 64pt;text-indent: 0pt;text-align: left;">delay = 1000</p><p style="padding-top: 6pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">) =&gt; {</p><p class="s10" style="padding-top: 2pt;padding-left: 65pt;text-indent: 0pt;line-height: 144%;text-align: left;">let timer: <span class="p">ReturnTypectypeof setTimeout&gt;;<br/>return (. args: Parameters&lt;T&gt;): void =&gt; {</span></p><p class="s10" style="padding-left: 76pt;text-indent: 0pt;line-height: 10pt;text-align: left;">clearTimeout(timer);</p><p class="s10" style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">timer = setTimeout(() =&gt; fn(.<span class="p"> </span>args), timeDelay);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>A debounced function is a new one that can be called as often as desired but won’t do anything until<br/>a timer has run. If you call the function once and then call it again, the timer will be reset and start<br/>running again. The only way for the function to actually do its thing is if a given de 1 ay period passes<br/>without any new calls.</span></p><p class="s34" style="padding-top: 8pt;padding-left: 44pt;text-indent: 0pt;text-align: justify;">Throttling functions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;">For the complementary throttling transformation, imagine a web form with a <b>FETCH, APPLY</b>or <b>RETRIEVE </b><span>button. When you click on it, an API call is made to get some data. However,<br/>if   the user starts clicking again and again, too many calls will be made, even if they will get the same<br/>results. We want to throttle the calls so the first call will go through, but further calls will be disabled<br/>until some time has passed. A similar use case applies to </span><i>infinite scrolling; </i><span>as the user scrolls down the<br/>page, you want to fetch more data, but you neither want to do it very often for performance reasons<br/>nor wait until the user reaches the bottom (as would be the case with debouncing) because then<br/>scrolling would be stopped.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Throttling is similar to debouncing, but a throttled function runs but then waits until the next run,<br/>while a debounced function first waits and then runs. </span><i>Figure 6.3 </i><span>shows how throttling works. As in<br/>the previous section, events are shown as circles. After a call to the API, no further calls are done<br/>unless some time has passed:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 99pt;text-indent: 0pt;text-align: left;"><span><img width="377" height="63" alt="image" src="Image_028.jpg"/></span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 6pt;padding-left: 63pt;text-indent: 0pt;text-align: left;">Figure 6.3 - A throttled function runs the first time it&#39;s called but then delays until running again</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 5pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// throttle.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 20pt;text-indent: 0pt;text-align: left;">204  Producing Functions - Higher-Order Functions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 74pt;text-indent: -12pt;line-height: 142%;text-align: left;"><span>const throttle = &lt;T extends (...args: any[]) =&gt; void&gt;(<br/>fn: T,</span></p><p style="padding-left: 73pt;text-indent: 0pt;text-align: left;">delay = 1000</p><p style="padding-top: 6pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">) =&gt; {</p><p class="s10" style="padding-top: 2pt;padding-left: 73pt;text-indent: 0pt;line-height: 144%;text-align: left;">let timer: <span class="p">ReturnType&lt;typeof setTimeout&gt; | undefined;<br/>return (...args: Parameters&lt;T&gt;): void =&gt; {</span></p><p class="s10" style="padding-left: 86pt;text-indent: 0pt;line-height: 10pt;text-align: left;">if (!timer) {</p><p class="s10" style="padding-top: 4pt;padding-left: 110pt;text-indent: -12pt;line-height: 144%;text-align: left;"><span>timer = setTimeout(() =&gt; {<br/>timer = undefined;</span></p><p class="s10" style="padding-left: 98pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>},   delay);<br/>fn(...args);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>A throttled function is a new one, which you can call as often as desired, but it will “do its thing” the<br/>first time and not again until a certain delay. When you call the function, it first checks whether<br/>the t imer is set; if so, it won’t do anything. If the timer isn’t set, a timeout will be set to clear the<br/>timer after some delay, and the function will be called. We are using the timer variable both<br/>for the timeout and as a flag (“are we waiting?”).</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>So far, we have learned how to wrap functions while keeping their original behavior or by altering<br/>them in some fashion. Now, let’s consider some other ways of modifying functions.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-left: 52pt;text-indent: 0pt;text-align: justify;"><a name="bookmark267">Changing functions in other ways</a><a name="bookmark285">&zwnj;</a></p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: justify;"><span>Let’s end this chapter by considering other sundry functions that provide results, such as new finders,<br/>decoupling methods from objects, and more. Our examples will include the following:</span></p><ul id="l71"><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 79pt;text-indent: -13pt;text-align: left;">Turning operations (such as adding with the + operator) into functions</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 79pt;text-indent: -13pt;text-align: left;">Turning functions into promises</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 79pt;text-indent: -13pt;text-align: left;">Accessing objects to get the value of a property</p></li><li data-list-text="•"><p style="padding-top: 7pt;padding-left: 79pt;text-indent: -13pt;text-align: left;">Turning methods into functions</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 79pt;text-indent: -13pt;text-align: left;">A better way of finding optimum values</p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 313pt;text-indent: 0pt;text-align: left;">Changing functions in other ways   205</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 43pt;text-indent: 0pt;text-align: justify;"><a name="bookmark268">Turning operations into functions</a><a name="bookmark286">&zwnj;</a></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>We have already seen several cases where we needed to write a function just to add or multiply a pair<br/>of numbers. For example, in the </span><i>Summing an array </i>section of <i>Chapter 5, Programming Declaratively,</i>we had to write code equivalent to the following:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">const mySum = myArray.reduce(</p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 1pt;line-height: 144%;text-align: left;"><span>(x: number, y: number): number =&gt; x + y,<br/>0</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: justify;">In the <i>Working with ranges </i>section of <i>Chapter 5, Programming Declaratively, </i><span>we wrote this to calculate<br/>a factorial:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 65pt;text-indent: -12pt;line-height: 143%;text-align: left;"><span>const factorialByRange = (n: number): number =&gt;<br/>range (1, n + 1).reduce((x, y) = &gt; x * y, 1) ;</span></p><p style="padding-top: 8pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>It would have been easier if we could just turn a binary operator into a function that calculates the<br/>same result. The preceding two examples could have been written more succinctly, as follows. Can<br/>you understand the change we made?</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">const mySum = myArray.reduce<b>(binaryOp2(&quot;+&quot;), </b>0);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 65pt;text-indent: -12pt;line-height: 148%;text-align: left;"><span>const factorialByRange = (n: number): number =&gt;<br/>range(1, n + 1).reduce</span><b>(binary0p2(&quot;*&quot;), </b>1);</p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;text-align: left;">We haven’t looked at how binaryOp () is implemented yet, but the key notion is that instead of</p><p style="padding-top: 2pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>an infix operator (like we use when we write 22 + 9), we now have a function (as if we could write<br/>our sum like +(22,9), which certainly isn’t valid JavaScript). Let’s see how we can make this work.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s34" style="padding-left: 43pt;text-indent: 0pt;text-align: left;">Implementing operations</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>How would we write this binaryOp () function? There are at least two ways of doing so: a safe but<br/>long one and a riskier and shorter alternative. The first would require listing each possible operator.<br/>The following code does this by using a longish switch:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// binaryOp.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 65pt;text-indent: -12pt;line-height: 141%;text-align: left;"><span>const  binaryOpl  =  (op:  string)  =&gt;  {<br/>switch   (op)   {</span></p><p style="padding-left: 77pt;text-indent: 0pt;text-align: left;">case &quot;+&quot;:</p><p style="padding-top: 4pt;padding-left: 89pt;text-indent: 0pt;text-align: left;">return (x: number, y: number): number =&gt; x + y;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 20pt;text-indent: 0pt;text-align: left;">206  Producing Functions - Higher-Order Functions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 85pt;text-indent: 0pt;text-align: left;">case &quot;- &quot; :</p><p style="padding-top: 4pt;padding-left: 85pt;text-indent: 12pt;line-height: 146%;text-align: left;"><span>return (x: number, y: number): number =&gt; x - y;<br/>case &quot;*&quot; :</span></p><p style="padding-left: 97pt;text-indent: 0pt;line-height: 10pt;text-align: left;">return (x: number, y: number): number =&gt; x * y;</p><p class="s17" style="padding-top: 3pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">//</p><p style="padding-top: 2pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">// etc.</p><p class="s17" style="padding-top: 3pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">//</p><p style="padding-top: 2pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">default:</p><p style="padding-top: 4pt;padding-left: 97pt;text-indent: 0pt;text-align: left;">throw new Error(&#39;Unknown ${op} operator&#39;);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>This solution is perfectly fine but requires too much work. By the way, we should have separate<br/>binaryMathOp () and binaryLogicalOp () functions; the first would be (op: string)</span></p><p style="padding-left: 53pt;text-indent: 0pt;line-height: 10pt;text-align: left;">= &gt; ( (x: number, y: number) =&gt; number) while the second would be (op: string)</p><p style="padding-top: 2pt;padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>= &gt; ( (x: boolean, y: boolean) =&gt; boolean) because, as in the previous section,<br/>TypeScript cannot deduce the type of the returned function.</span></p><p style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>There’s a second solution, which is shorter but more dangerous. Please consider this only as an example<br/>for learning purposes; using eval () isn’t recommended for security reasons! Our second version</span></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">would use Function () to create a new function that uses the desired operator, as follows:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">const binary0p2 = (op) =&gt;</p><p style="padding-top: 4pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">new Function(&quot;x&quot;, &quot;y&quot;, &#39;return x ${op} y;&#39;);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>Again, TypeScript cannot determine the type of the returned function because that will be determined<br/>only at runtime. So, we need to write the following:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">const binary0p2 = (op: string) =&gt;</p><p style="padding-top: 4pt;padding-left: 85pt;text-indent: -12pt;line-height: 142%;text-align: left;">new Function(&quot;x&quot;, &quot;y&quot;, &#39;return x ${op} y;&#39;) <b>as (</b></p><p class="s10" style="text-indent: 0pt;text-align: right;">y: number</p><p class="s10" style="padding-top: 4pt;text-indent: 0pt;text-align: right;">) =&gt; number;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>We don’t have to specify the type of binaryOp2 () because TypeScript can work it out to be (o :<br/>string) =&gt; (x: number, y: number) =&gt; number by itself, given the cast that we</span></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 10pt;text-align: left;">applied to the result.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 12pt;padding-left: 313pt;text-indent: 0pt;text-align: left;">Changing functions in other ways   207</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 57pt;text-indent: 0pt;text-align: left;"><a name="bookmark269">The (easier) way out</a></p><p style="padding-top: 4pt;padding-left: 57pt;text-indent: 0pt;text-align: left;">Some libraries, such as Lodash, already provide functions such as _. multiply () and</p><p style="padding-top: 1pt;padding-left: 57pt;text-indent: 0pt;line-height: 115%;text-align: left;"><span>_. sum (), so that’s a more straightforward solution! You could quickly whip up your own and<br/>create your own mini-library of mathematical and logical essential functions.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>If you follow this train of thought, you may also define a unaryOp () function, even though there are<br/>fewer applications for it. (I leave this implementation to you; it’s similar to what we already wrote.) In<br/></span><i>Chapter 7, Transforming Functions, </i><span>we will look at an alternative way of creating this unary function<br/>by using a partial application.</span></p><p class="s34" style="padding-top: 8pt;padding-left: 43pt;text-indent: 0pt;text-align: justify;">A handier implementation</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Let’s get ahead of ourselves. Doing FP doesn’t always mean getting down to the simplest possible<br/>functions. For example, in an upcoming section of this book, we will need a function to check whether<br/>a number is negative, and we’ll consider (see the </span><i>Converting to pointfree style </i>section of <i>Chapter 8,</i>using binary0p2 () to write it:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">const isNegative = curry(binary0p2(&quot;&gt;&quot;))(0);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Don’t worry about the curry () function for now (we’ll get to it soon, in the following chapter) - the<br/>idea is that it fixes the first argument to 0 so that our function will check for a given n number if 0 &gt;n.<br/>The point is that the function we just wrote isn’t very clear. We could do better if we defined a binary<br/>operation function that lets us specify one of its parameters - the left or the right one - in addition<br/>to  the operator to be used. Here, we can write the following couple of functions, which define the<br/>functions where the left or right operators are missing:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">const binaryLeftOp =</p><p style="padding-top: 4pt;padding-left: 76pt;text-indent: -9pt;line-height: 144%;text-align: left;"><span>(x:  number,  op:  string)  =&gt;  (y:  number)  =&gt;<br/>binary0p2(op)(x, y);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">const   binaryOpRight   =</p><p style="padding-top: 4pt;padding-left: 76pt;text-indent: -9pt;line-height: 143%;text-align: left;"><span>(op:   string,   y:   number)<br/>binary0p2(op)(x, y);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 7pt;text-indent: 0pt;text-align: left;">= &gt; (x: number) =&gt;</p><p style="padding-top: 8pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>With these new functions, we could write either of the following two definitions, though I think<br/>the second is clearer. I’d rather test whether a number is less than 0 than whether 0 is greater than<br/>the number:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;line-height: 143%;text-align: left;"><span>const isNegativel = binaryLeftOp(0, &quot;&gt;&quot;);<br/>const isNegative2 = binaryOpRight(&quot;&lt;&quot;, 0);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 20pt;text-indent: 0pt;text-align: left;">208  Producing Functions - Higher-Order Functions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>What is the point of this? Don’t strive for some basic simplicity or go down to basics. We can transform<br/>an operator into a function, but if you can do better and simplify your coding by specifying one of the<br/>two parameters for the operation, just do it! The idea of FP is to help write better code, and creating<br/>artificial limitations won’t help anybody.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Of course, for a simple function such as checking whether a number is negative, I would never want<br/>to complicate things with currying, binary operators, pointfree style, or anything else, and I’d write<br/>the following with no further ado:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;text-align: left;">const isNegative3 = (x: number): boolean = &gt; <b>x &lt; 0;</b></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>So far, we have seen several ways of solving the same problem. Keep in mind that FP doesn’t force you<br/>to pick one way of doing things; instead, it allows you a lot of freedom in deciding which way to go!</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 52pt;text-indent: 0pt;text-align: justify;"><a name="bookmark270">Turning functions into promises</a><a name="bookmark287">&zwnj;</a></p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>In  Node.js,  most  asynchronous  functions  require  a  callback  such  as  (err,  data)  =&gt;{...}:  if<br/>err is falsy, the function was successful, and data is its result; otherwise, the function failed, and<br/>err  gives  the  cause.  (See  nodej  s  .  org/api/errors  .  html#error-  first  -callbacks<br/>for more on this.)</span></p><p style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>However, you might prefer to work with promises instead. So, we can think of writing an HOF that<br/>will transform a function that requires a callback into a promise that lets you use the then () and<br/>catch () methods. (In </span><i>Chapter 12, Building Better Containers, </i><span>we will see that promises are actually<br/></span><i>monads, </i><span>so this transformation is interesting in yet another way.) This will be an exercise for some<br/>developers because Node.js (since version 8) already provides the util, promi s i f y () function,<br/>which  turns  an  async  function  into  a  promise.  See  nodej  s  .  org/dist/latest-v8  .  x/docs/<br/>api/util. html#util_util_promisify_original for more on that.</span></p><p style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>So, how can we manage this? The transformation is relatively simple. Given a function, we produce<br/>a new one: this will return a promise that, upon calling the original function with some parameters,<br/>will either re j ect () or resolve () the promise appropriately.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>The promisif y () function does precisely that. Its parameter is an fn function that returns either<br/>an err error of generic type E, or some data of generic type D. The arguments of f n may be any<br/>type, except that the last one must be a callback; this requires using </span><i>variadic </i><span>data types, available in<br/>TypeScript since version 4.0, from 2020:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// promisify.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">const promisify =</p><p style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">&lt;E, T extends any[] , D&gt; (</p><p style="padding-top: 4pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">fn: (...args: [...T, (err: E, data: D) =&gt; void]) =&gt; void</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 313pt;text-indent: 0pt;text-align: left;">Changing functions in other ways   209</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 65pt;text-indent: 0pt;text-align: left;">) =&gt;</p><p class="s10" style="padding-top: 3pt;padding-left: 66pt;text-indent: 0pt;text-align: left;">(...args: T): <span class="p">Promise&lt;D&gt; =&gt;</span></p><p class="s10" style="padding-top: 4pt;padding-left: 89pt;text-indent: -12pt;line-height: 143%;text-align: left;"><span>new Promise((resolve, reject) =&gt;<br/>fn(...args, (err: E, data: D) =&gt;</span></p><p class="s10" style="padding-left: 101pt;text-indent: 0pt;text-align: left;">err ? reject(err) : resolve(data)</p><p style="padding-top: 5pt;padding-left: 89pt;text-indent: 0pt;text-align: left;">)</p><p style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: left;"><span>The given f n function is turned into a promise. The promise calls f n with a special callback: if that<br/>callback gets a non-null err value, the promise is rejected with that error; otherwise, the promise is<br/>resolved with data.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: -9pt;line-height: 223%;text-align: left;"><span>When working in Node.js, the following style is fairly common:<br/>const fs = require(&quot;fs&quot;);</span></p><p style="padding-top: 6pt;padding-left: 64pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>const cb = (err, data) =&gt;<br/>err</span></p><p style="padding-left: 77pt;text-indent: 0pt;text-align: left;">? console.log(&quot;ERROR&quot;, err)</p><p style="padding-top: 4pt;padding-left: 78pt;text-indent: 0pt;text-align: left;">: console.log(&quot;SUCCESS&quot;, data);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 53pt;text-indent: 0pt;line-height: 142%;text-align: left;"><span>fs.readFile(&quot;./exists.txt&quot;, cb);                 // success, data<br/>fs.readFile(&quot;./doesnt_exist.txt&quot;, cb); // fail, exception</span></p><p style="padding-top: 8pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>You can use promises instead by using our promisif y () function - or in current versions of Node.js,<br/>util. promisif y () (but see the following, by the end of this section!):</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">const fspromise = <b>promisify(</b>fs.readFile.bind(fs));</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 65pt;text-indent: -12pt;line-height: 142%;text-align: left;"><span>const goodRead = (data) =&gt;<br/>console.log(&quot;SUCCESSFUL PROMISE&quot;, data);</span></p><p style="padding-left: 64pt;text-indent: -12pt;line-height: 143%;text-align: left;"><span>const badRead = (err) =&gt;<br/>console.log(&quot;UNSUCCESSFUL PROMISE&quot;, err);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">fspromise(&quot;./readme.txt&quot;)          // success</p><p style="padding-top: 4pt;padding-left: 66pt;text-indent: 0pt;text-align: left;">.then(goodRead)</p><p style="padding-top: 4pt;padding-left: 53pt;text-indent: 13pt;line-height: 287%;text-align: left;"><span>. catch(badRead) ;<br/>fspromise(&quot;./readmenot.txt&quot;) // failure</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 20pt;text-indent: 0pt;text-align: left;">210  Producing Functions - Higher-Order Functions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 75pt;text-indent: 0pt;text-align: left;">.then(goodRead)</p><p style="padding-top: 4pt;padding-left: 75pt;text-indent: 0pt;text-align: left;">.catch(badRead);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Now, you can use f spromise () instead of the original method. To do so, we had to bind<br/>f s . readFile, as we mentioned in the </span><i>An unnecessary mistake </i>section of <i>Chapter 3, Starting Out</i></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>By the way, when using Node.js, be aware that many modules already provide a promise-based API in<br/>addition to the older callback-based API; for example, see nodej s . org/api/f s . html#promises-<br/>api and compare it to nodej s . org/api/f s . html#callback-api.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 52pt;text-indent: 0pt;text-align: justify;"><a name="bookmark271">Getting a property from an object</a><a name="bookmark288">&zwnj;</a></p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>There is a simple function that we could also produce. Extracting an attribute from an object is a<br/>commonly required operation. For example, in </span><i>Chapter 5, Programming Declaratively, </i><span>we had to get<br/>latitudes and longitudes to calculate an average. The code for this was as follows:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><table style="border-collapse:collapse" cellspacing="0"><tr style="height:13pt"><td style="width:42pt"><p class="s29" style="padding-left: 3pt;text-indent: 0pt;line-height: 10pt;text-align: left;">{ name:</p></td><td style="width:42pt"><p class="s29" style="padding-left: 9pt;text-indent: 0pt;line-height: 10pt;text-align: left;">&quot; UY &quot; ,</p></td><td style="width:25pt"><p class="s29" style="padding-left: 2pt;text-indent: 0pt;line-height: 10pt;text-align: left;">lat:</p></td><td style="width:42pt"><p class="s29" style="padding-left: 8pt;text-indent: 0pt;line-height: 10pt;text-align: left;">-34.9,</p></td><td style="width:33pt"><p class="s29" style="padding-right: 4pt;text-indent: 0pt;line-height: 10pt;text-align: right;">Ion:</p></td><td style="width:26pt"><p class="s29" style="padding-left: 4pt;padding-right: 1pt;text-indent: 0pt;line-height: 10pt;text-align: center;">-56.2</p></td></tr><tr style="height:15pt"><td style="width:42pt"><p class="s29" style="padding-top: 2pt;padding-left: 3pt;text-indent: 0pt;text-align: left;">{ name:</p></td><td style="width:42pt"><p class="s29" style="padding-top: 1pt;padding-left: 9pt;text-indent: 0pt;text-align: left;">&quot;AR&quot; ,</p></td><td style="width:25pt"><p class="s29" style="padding-top: 2pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">lat:</p></td><td style="width:42pt"><p class="s29" style="padding-top: 2pt;padding-left: 8pt;text-indent: 0pt;text-align: left;">-34.6,</p></td><td style="width:33pt"><p class="s29" style="padding-top: 1pt;padding-right: 4pt;text-indent: 0pt;text-align: right;">Ion:</p></td><td style="width:26pt"><p class="s29" style="padding-top: 1pt;padding-left: 4pt;padding-right: 1pt;text-indent: 0pt;text-align: center;">-58.4</p></td></tr><tr style="height:16pt"><td style="width:42pt"><p class="s29" style="padding-top: 2pt;padding-left: 3pt;text-indent: 0pt;text-align: left;">{ name:</p></td><td style="width:42pt"><p class="s29" style="padding-top: 1pt;padding-left: 9pt;text-indent: 0pt;text-align: left;">&quot;BR&quot; ,</p></td><td style="width:25pt"><p class="s29" style="padding-top: 2pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">lat:</p></td><td style="width:42pt"><p class="s29" style="padding-top: 2pt;padding-left: 8pt;text-indent: 0pt;text-align: left;">-15.8,</p></td><td style="width:33pt"><p class="s29" style="padding-top: 1pt;padding-right: 4pt;text-indent: 0pt;text-align: right;">Ion:</p></td><td style="width:26pt"><p class="s29" style="padding-top: 1pt;padding-left: 4pt;padding-right: 1pt;text-indent: 0pt;text-align: center;">-47.9</p></td></tr><tr style="height:15pt"><td style="width:42pt"><p class="s29" style="padding-top: 2pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">// ...</p></td><td style="width:42pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:25pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:42pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:33pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:26pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:12pt"><td style="width:42pt"><p class="s29" style="padding-top: 1pt;padding-left: 3pt;text-indent: 0pt;line-height: 9pt;text-align: left;">{ name:</p></td><td style="width:42pt"><p class="s29" style="padding-top: 1pt;padding-left: 9pt;text-indent: 0pt;line-height: 9pt;text-align: left;">&quot;BO&quot; ,</p></td><td style="width:25pt"><p class="s29" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;line-height: 9pt;text-align: left;">lat :</p></td><td style="width:42pt"><p class="s29" style="padding-top: 1pt;padding-left: 8pt;text-indent: 0pt;line-height: 9pt;text-align: left;">-16.5,</p></td><td style="width:33pt"><p class="s29" style="padding-top: 1pt;padding-right: 4pt;text-indent: 0pt;line-height: 9pt;text-align: right;">Ion:</p></td><td style="width:26pt"><p class="s29" style="padding-top: 1pt;padding-left: 4pt;padding-right: 1pt;text-indent: 0pt;line-height: 9pt;text-align: center;">-68.1</p></td></tr></table><p style="text-indent: 0pt;text-align: left;"/><p style="padding-left: 61pt;text-indent: 0pt;line-height: 286%;text-align: left;"><span>// getField.ts<br/>const markers = [</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 8pt;padding-left: 62pt;text-indent: 0pt;line-height: 141%;text-align: left;"><span>let averageLat = average(markers.map(x =&gt; x.lat));<br/>let averageLon = average(markers.map(x = &gt; x.lon));</span></p><p style="padding-top: 8pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>We saw another example when we learned how to filter an array; in our example, we wanted to get the<br/>IDs for all the accounts with a negative balance. After filtering out all other accounts, we still needed<br/>to extract the id field:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;text-align: left;">const delinquent = serviceResult.accountsData.filter(</p><p style="padding-top: 4pt;padding-left: 76pt;text-indent: 0pt;text-align: left;">(v) =&gt; v.balance &lt; 0</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;text-align: left;">const delinquentlds = delinquent.map((v) = &gt; v.id);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 12pt;padding-left: 313pt;text-indent: 0pt;text-align: left;">Changing functions in other ways   211</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>What do we need? We need an HOF that will receive the name of an attribute and produce a new<br/>function that can extract an attribute from an object. Using the arrow function syntax, this function<br/>is easy to write; f is the name of the field we want, and ob j is the object from which to get the field:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// getField.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">const getField = <b>f =&gt; obj =&gt; obj[f];</b></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: justify;"><span>The full TypeScript version is a bit longer, but not much; mainly, we need to specify that f must be<br/>a key of the object:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s9" style="padding-left: 53pt;text-indent: 0pt;text-align: left;">11 <span class="p">continued...</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">const getField = &lt;D&gt;(f: <b>keyof D) =&gt; (obj: D) =&gt; obj [f];</b></p><p style="padding-top: 2pt;padding-left: 53pt;text-indent: -9pt;line-height: 23pt;text-align: left;"><span>With this function, the coordinate extraction process could have been written as follows:<br/>let averageLat = average(markers.map(getField(&quot;lat&quot;)));</span></p><p style="padding-top: 2pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">let averageLon = average(markers.map(getField(&quot;Ion&quot;)));</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>But that won’t be accepted! The issue is that TypeScript cannot detect the type of the result of the call<br/>to getField () because that will be decided at runtime. We must help by informing it that our two<br/>calls will return numbers. We can define the type of a generic number-returning function as NumFn,<br/>and then write the following:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">type <b>NumFn = </b>(. args: any[]) =&gt; number;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 64pt;text-indent: -11pt;line-height: 143%;text-align: left;"><span>const averageLat2 = average(<br/>markers.map(getField(&quot;lat&quot;) </span><b>as NumFn)</b></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 6pt;padding-left: 64pt;text-indent: -11pt;line-height: 142%;text-align: left;"><span>const averageLon2 = average(<br/>markers.map(getField(&quot;Ion&quot;) as NumFn)</span></p><p style="padding-top: 1pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>For variety, we could have used an auxiliary variable to get the delinquent IDs and avoid using an<br/>extra type similar to NumFn, as follows:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">const getld = getField(&quot;id&quot;) <b>as (...args: any[]) =&gt; string;</b></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">const delinquent = serviceResult.accountsData.filter(</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 20pt;text-indent: 0pt;text-align: left;">212  Producing Functions - Higher-Order Functions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;text-align: justify;">const delinquentlds = <b>delinquent.map(getld);</b></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Make sure that you fully understand what’s going on here. The result of the getField () call is a<br/>function that will be used in further expressions. The map () method requires a mapping function<br/>and is what getField () produces.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 53pt;text-indent: 0pt;text-align: justify;"><a name="bookmark272">Demethodizing - turning methods into functions</a><a name="bookmark289">&zwnj;</a></p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Methods such as filter () and map () are only available for arrays; however, you may want to apply<br/>them to, say, NodeList or String, and you’d be out of luck. Also, we are focusing on strings, so<br/>having to use these functions as methods is not exactly what we had in mind. Finally, whenever we<br/>create a new function (such as none (), which we saw in the </span><i>Checking negatives </i>section of <i>Chapter 5,</i><span>it cannot be applied in the same way as its peers (some () and every (),<br/>in this case) unless you do some prototype trickery. This is rightly frowned upon and not recommended,<br/>but we’ll look into it anyhow; another case of “do as I say, not as I do!”</span></p><p style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;line-height: 126%;text-align: justify;">Read the <i>Extending current data types </i>section of <i>Chapter 12, Building Better Containers, </i><span>where we will<br/>make map () available for most basic types.</span></p><p style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;">So, what can we do? We can apply the old saying <i>If the mountain wont come to Muhammad, then</i><span>Instead of worrying about not being able to create new methods,<br/>we  will turn the existing methods into functions. We can do this if we convert each method into a<br/>function that will receive, as its first parameter, the object it will work on.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Decoupling methods from objects can help you because once you achieve this separation, everything<br/>turns out to be a function, and your code will be simpler. (Remember what we wrote in the </span><i>Logically</i><span>section, regarding a possible f il terNo t () function in comparison to the<br/>f  ilter () method?) A decoupled method works similarly to generic functions in other languages<br/>since they can be applied to diverse data types.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 65pt;text-indent: 0pt;text-align: justify;"><a name="bookmark273">An important ABC: apply, bind, call</a></p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;line-height: 114%;text-align: justify;"><span>Take  a  look  at  developer  .  mozilla  .  org/en-US/docs/Web/JavaScript/<br/>Ref  erence/Global_Obj  ects/Function  for  explanations  on  apply  (),  call  (),<br/>and bind (). We are going to use these for our implementation. Back in </span><i>Chapter 1, Becoming</i><span>we saw the equivalence between apply () and call () when we used the<br/>spread operator.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: justify;"><span>There are three distinct but similar ways to implement this decoupling in JavaScript. The first argument<br/>in the list (argO) will correspond to the object, and the other arguments (. . . args) to the actual</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 313pt;text-indent: 0pt;text-align: left;">Changing functions in other ways   213</p><p style="padding-top: 22pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>ones for the called method. The three equivalent versions would be as follows, and any of them could<br/>be used as a demethodize () function; pick your favorite! Let’s go with a plain JavaScript version</span></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: left;">to understand how they work; see <i>Question 6.15 </i>for TypeScript versions:</p><p style="padding-top: 12pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// demethodize.ts</p><p style="padding-top: 19pt;padding-left: 66pt;text-indent: -14pt;line-height: 142%;text-align: left;"><span>const demethodizel =<br/>(fn) =&gt;</span></p><p style="padding-left: 66pt;text-indent: 0pt;text-align: left;">(argO,  args) =&gt;</p><p style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">fn.apply(argO, args);</p><p style="padding-top: 19pt;padding-left: 66pt;text-indent: -14pt;line-height: 142%;text-align: left;"><span>const demethodize2 =<br/>(fn) =&gt;</span></p><p style="padding-left: 66pt;text-indent: 0pt;text-align: left;">(argO,  args) =&gt;</p><p style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">fn.call(argO, args);</p><p style="padding-top: 19pt;padding-left: 66pt;text-indent: -13pt;line-height: 141%;text-align: left;"><span>const demethodize3 =<br/>(fn) =&gt;</span></p><p style="padding-left: 66pt;text-indent: 0pt;text-align: left;">(argO,  args) =&gt;</p><p style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">fn.bind(argO, args)();</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-top: 8pt;padding-left: 56pt;text-indent: 0pt;text-align: left;"><a name="bookmark274">A fourth way</a></p><p style="padding-top: 4pt;padding-left: 56pt;text-indent: 0pt;line-height: 115%;text-align: left;"><span>There’s yet another way of doing this: const demethodize = Function .prototype .<br/>bind . bind (Function . prototype . call) . If you want to understand how this</span></p><p style="padding-left: 57pt;text-indent: 0pt;line-height: 115%;text-align: left;">works, read Leland Richardson’s <i>Clever Way to Demethodize Native JS Methods, </i><a href="http://www/" class="s11" target="_blank">at </a><span>www.<br/>intelligiblebabble.com/clever-way-to-demethodize-native-j s-</span></p><p style="padding-left: 56pt;text-indent: 0pt;text-align: left;">methods.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 8pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>Let’s look at some applications of these! Let’s start with a simple one that will also serve as a warning.<br/>We can make the sort () method into a function - but don’t think it will be made pure!</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">const sort = demethodizel(Array.prototype.sort);</p><p style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>const a = [&quot;delta&quot;, &quot;alfa&quot;, &quot;beta&quot;, &quot;gamma&quot;, &quot;epsilon&quot;];<br/>const b = </span><b>sort(a);</b></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">console.log(a, b) ,-</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// [ &#39;alfa&#39;, &#39;beta&#39;, &#39;delta&#39;, &#39;epsilon&#39;, &#39;gamma&#39; ] twice!</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 20pt;text-indent: 0pt;text-align: left;">214  Producing Functions - Higher-Order Functions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>Now we can use sort () as a function - but it still produces the same side effect; a and b are the<br/>same array since sort () keeps working “in place.”</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>A more contrived case: we can use map () to loop over a string without converting it into an array of<br/>characters first. Say you wanted to separate a string into individual letters and make them uppercase;<br/>we could achieve this by using split () and toUpperCase ():</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;text-align: left;">const name = &quot;FUNCTIONAL&quot;;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">const result = name.split(&quot;&quot;).map((x) =&gt; x.toUpperCase());</p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">// [”F&quot;    &quot;U&quot;   &quot;N&quot;   &quot;C&quot;   &quot;T&quot;   &quot;I&quot;   &quot;O&quot;   &quot;N&quot;   &quot;A&quot;   &quot;L&quot;]</p><p style="padding-top: 2pt;padding-left: 61pt;text-indent: -9pt;line-height: 23pt;text-align: left;"><a name="bookmark275"><span>By demethodizing map () and toUpperCase (), we can simply write the following:<br/>const map = </span></a><b>demethodizel(Array.prototype.map);</b></p><p style="padding-top: 1pt;padding-left: 73pt;text-indent: -12pt;line-height: 144%;text-align: left;"><a name="bookmark276">const toUpperCase = </a><b>demethodize2(</b></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;"><a name="bookmark277">) ;</a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 6pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">const result2 = <b>map(name, toUpperCase);</b></p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">// [&quot; F&quot; &quot;U&quot;      &quot;N&quot;   ” c &quot;  ” T &quot;  &quot; I&quot;   &quot; 0<span class="s162">11   </span>”N”   &quot;A&quot;   &quot; L &quot; ]</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Yes, of course, for this particular case, we could have turned the string into uppercase and then split it<br/>into separate letters, as in name . toUpperCase () . split (&quot;&quot;), but it wouldn’t have been such<br/>a nice example, with two usages of demethodizing being used.</span></p><p style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: justify;"><span>Similarly, we could convert an array of decimal amounts into properly formatted strings with thousands<br/>separators and decimal points:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 73pt;text-indent: -11pt;line-height: 142%;text-align: left;"><span>const toLocaleString = demethodize3(<br/>Number.prototype.toLocaleString</span></p><p style="padding-top: 1pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">) ;</p><p style="padding-top: 3pt;padding-left: 61pt;text-indent: 0pt;line-height: 30pt;text-align: left;"><a name="bookmark278"><span>const numbers = [2209.6, 124.56, 1048576];<br/>const strings = </span></a><b>numbers.map(toLocaleString);</b></p><p style="padding-left: 61pt;text-indent: 0pt;text-align: left;">console.log(strings);</p><p style="padding-top: 5pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">/*</p><p style="padding-top: 3pt;padding-left: 64pt;text-indent: 0pt;text-align: left;">[ &#39;2.209,6&#39;, &#39;124,56&#39;, &#39;1.048.576&#39; ] // Uruguay Locale</p><p style="padding-top: 5pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">*/</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 313pt;text-indent: 0pt;text-align: left;">Changing functions in other ways   215</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Alternatively, given the preceding demethodized map () function, we could have done the mapping<br/>with map (numbers , toLocaleString) instead.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><a name="bookmark279"><span>The idea of demethodizing a method to turn it into a function will prove to be quite useful in diverse<br/>situations. We have already seen some examples where we could have applied it, and there will be<br/>more such cases in the rest of this book.</span></a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 43pt;text-indent: 0pt;text-align: justify;">Methodizing - turning functions into methods</p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>In the previous section, we saw how we could separate methods from objects to transform them into<br/>independent, standalone functions. Then, for fairness, let’s consider the complementary transformation,<br/>adding a function (as a method) to objects. We should call this operation </span><i>methodizing, </i>shouldn’t we?</p><p style="padding-top: 7pt;padding-left: 41pt;text-indent: 1pt;line-height: 124%;text-align: justify;">We already saw something of this when we defined and worked with polyfills in the <i>Adding missing</i>section of <i>Chapter 3, Starting Out with Functions. </i><span>Modifying prototypes is usually frowned<br/>upon because of the possibility of clashes with different libraries, at the very least. However, it’s an<br/>interesting technique, so let’s study it anyway.</span></p><p class="s34" style="padding-top: 8pt;padding-left: 43pt;text-indent: 0pt;text-align: justify;">Reversing strings</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;">Let’s start with a simple example. Back in the <i>Folding left and right </i>section of <i>Chapter </i>5, <i>Programming</i><span>we defined a reversestring () function to reverse a string. Since we already have a<br/>reverse  () method that works with arrays, we could implement a reverse () method for strings.<br/>For variety, let’s do a new implementation of the string-reversing logic. We’ll add a Boolean parameter;<br/>if set to true, the function will add dashes between letters; this is just to show that methodizing also<br/>works with functions with more parameters. What we want to achieve is the following:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>&quot;ABCDE&quot;.reverse();        // &quot;EDCBA&quot;<br/>&quot;ABCDE&quot;.reverse(true); // &quot;E-D-C-B-A&quot;</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: justify;"><span>The needed function is as follows (as a curiosity, note that we are using the array reverse () method<br/>to implement our reverse () string one!):</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// methodize.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 65pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>function   reverse(x:   string,   y   =   false):   string   {<br/>return x</span></p><p style="padding-left: 78pt;text-indent: 0pt;line-height: 10pt;text-align: left;">.split(&quot;&quot;)</p><p style="padding-top: 4pt;padding-left: 78pt;text-indent: 0pt;text-align: left;">.reverse()</p><p style="padding-top: 4pt;padding-left: 78pt;text-indent: 0pt;text-align: left;">.join(y ?       : &quot;&quot;);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 20pt;text-indent: 0pt;text-align: left;">216  Producing Functions - Higher-Order Functions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>We used a standard function (instead of an arrow one) because of the implicit handling of this,<br/>which wouldn’t be bound otherwise. Another crucial detail: the first argument to the function must<br/>be the string with which it will operate.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><a href="http://www/" class="s11" target="_blank">Now, we must tell TypeScript that we’ll be extending the String. prototype object with a new<br/>method (see </a>www. type script lang .org/docs/handbook/declaration - files/</p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">templates/global -modifying-module-d-ts . html for more on this):</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 74pt;text-indent: -12pt;line-height: 142%;text-align: left;"><span>declare global {<br/>interface String {</span></p><p class="s10" style="padding-left: 85pt;text-indent: 0pt;text-align: left;">reverse(y?: boolean): string;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>Without this definition (which could also have been in a separate . d. ts file), when we try to assign<br/>the new method, we’ll get the error shown in </span><i>Figure 6.4:</i></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s103" style="padding-top: 8pt;padding-left: 115pt;text-indent: 0pt;text-align: left;">(property) Stringconstructor.prototype: String</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s103" style="padding-left: 115pt;text-indent: 0pt;text-align: left;">Property &#39;reverse&#39; does not exist on type &#39;String<span class="s207">1</span>. &gt; .■ . ■■ &quot;i.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s208" style="padding-left: 114pt;text-indent: 0pt;text-align: left;">View Problem (Alt+FS) <span style=" color: #000;">No quick fives available</span></p><p class="s103" style="padding-top: 4pt;padding-left: 82pt;text-indent: -10pt;line-height: 134%;text-align: left;">String.prototype.reverse - <span style=" color: #6861D5;">function (this: </span>string): string <span style=" color: #6861D5;">1<br/></span><span style=" color: #3D27DC;">return this.</span>split!I.reversei J.joith</p><p class="s160" style="padding-left: 72pt;text-indent: 0pt;line-height: 10pt;text-align: left;">};</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 82pt;text-indent: 0pt;text-align: left;">Figure 6.4 - You cannot add new methods to an existing object without an extra definition</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>How do we add a new method to the String. prototype object? In essence, we want to achieve<br/>the following:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-top: 7pt;padding-left: 73pt;text-indent: -12pt;line-height: 143%;text-align: left;">String.prototype.reverse = <span class="p">function (<br/>this: string,</span></p><p style="padding-top: 2pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">y</p><p style="padding-top: 2pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">): string {</p><p class="s10" style="padding-top: 4pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">return reverse(this, y);</p><p style="padding-top: 6pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">};</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 12pt;padding-left: 313pt;text-indent: 0pt;text-align: left;">Changing functions in other ways   217</p><p style="padding-top: 22pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>We add a function that calls our original one. Note that this (the current string object) is passed<br/>as the first argument. Other parameters are passed untouched. We can implement all this with a<br/>methodize () function; let’s see it first in JavaScript and then get into typing details. We want to<br/>do  the following to achieve this:</span></p><p style="padding-top: 10pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="padding-top: 19pt;padding-left: 64pt;text-indent: -11pt;line-height: 143%;text-align: left;">function <b>methodize(obj, fn) {</b> <b>args) {</b></p><p class="s10" style="padding-left: 76pt;text-indent: 0pt;text-align: left;">return fn(this,<span class="p"> </span>args);</p><p class="s10" style="padding-top: 6pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">};</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>This is what we did before. We are using the functions name for the newly added method’s name. In<br/>TypeScript, this is a bit more complex, but we need the data type checks, so let’s do this:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 64pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>function methodize&lt;<br/>T extends any[] ,</span></p><p style="padding-left: 65pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>O extends { prototype: { [key: string]: any } },<br/>F extends (argO: any, ...args: T) =&gt; any</span></p><ul id="l72"><li data-list-text="&gt;"><p style="padding-left: 64pt;text-indent: -11pt;line-height: 141%;text-align: left;"><span>(obj : O, fn: F) {<br/>obj.prototype[fn.name] = function (</span></p></li></ul><p class="s10" style="padding-left: 77pt;text-indent: 0pt;text-align: left;">this: Parameters&lt;F&gt;[0],</p><p class="s10" style="padding-top: 4pt;padding-left: 78pt;text-indent: 0pt;text-align: left;">...args: T</p><p class="s10" style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">): ReturnType&lt;F&gt; {</p><p style="padding-top: 4pt;padding-left: 76pt;text-indent: 0pt;text-align: left;">return fn(this, ...args);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;text-align: left;">Let’s see the data types we added:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l73"><li data-list-text="•"><p style="padding-left: 70pt;text-indent: -13pt;text-align: left;">T is the generic type of the parameters that we’ll pass to our new methodized function</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">O is the object’s type to whose prototype we’ll add the new method</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 70pt;text-indent: -12pt;line-height: 123%;text-align: left;"><span>F is the function we’ll be methodizing; the first argument (argO) is key, and we’ll be assigned<br/>the value of this. The other arguments (if any) are of a T type</span></p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: -8pt;line-height: 220%;text-align: left;"><span>How do we use this methodize () function? Simple, with just one line:<br/>methodize(String, reverse);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 20pt;text-indent: 0pt;text-align: left;">218  Producing Functions - Higher-Order Functions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: -9pt;line-height: 23pt;text-align: left;"><span>With this, we can use our new method as planned:<br/>console.log(&quot;MONTEVIDEO&quot;.reverse() ) ;</span></p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">// OEDIVETNOM</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">console.log(&quot;MONTEVIDEO&quot;.reverse(true));</p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">// O-E-D-I-V-E-T-N-O-M</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s34" style="padding-left: 52pt;text-indent: 0pt;text-align: justify;">Averaging arrays</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 115%;text-align: justify;"><span>Let’s see one more example, to highlight a possible detail with typing. We’ll take the average ()<br/>function that we wrote in the </span><i>Calculating an average </i>section of <i>Chapter 5, Programming Declaratively,</i>and add it to Array. prototype:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 73pt;text-indent: -11pt;line-height: 144%;text-align: left;">function average<b>(x: number[]): </b><span>number {<br/>return (</span></p><p style="padding-left: 85pt;text-indent: 0pt;text-align: left;">x.reduce((x: number, y: number) =&gt; x + y, 0) / x.length</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: justify;"><span>The problem is that we want our function to only apply to arrays of numbers. We want TypeScript to<br/>detect and reject a line such as the following because of the wrong data type of the array:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;text-align: left;">const XX = [&quot;FK&quot;, &quot;ST&quot;, &quot;JA&quot;, &quot;MV&quot;].average();</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: justify;">When writing the global declaration for the added method, an error will pop up:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// methodize.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">declare global {</p><p class="s10" style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">// eslint-disable @typescript-eslint/no-unused-vars</p><p style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">interface Array&lt;T&gt; {</p><p class="s10" style="padding-top: 4pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">averaged: number;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 63pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 114%;text-align: justify;"><span>The definition of Array must be bound to a generic Array&lt;T&gt;. However, our definition for<br/>average () doesn’t depend on T. This means we have an unused definition to which ESLint objects.<br/>Since there’s no way of including T in our function, we’ll have to tell ESLint to let the error be; no<br/>other solution!</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 313pt;text-indent: 0pt;text-align: left;">Changing functions in other ways   219</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: -8pt;line-height: 223%;text-align: left;"><span>There’s nothing more to this; we can now methodize the average () function and use it as a method:<br/>methodize(Array, average);</span></p><p style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">const myAvg = [22, 9, 60, 12, 4, 56]<b>.average(); </b>// 27.166667</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: justify;">You can now extend all base classes as desired - but remember our advice about being very, very careful!</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 44pt;text-indent: 0pt;text-align: justify;"><a name="bookmark280">Finding the optimum</a><a name="bookmark290">&zwnj;</a></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Let’s end this section by creating an extension of the f ind () method. Suppose we want to find the<br/>optimum value - let’s suppose it’s the maximum - of an array of numbers. We could make do with this:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// optimum.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 64pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>const findOptimum = (arr: number]]): number =&gt;<br/>Math.max(. arr);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">const myArray = [22, 9, 60, 12, 4, 56];</p><p style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">console.log(findOptimum(myArray)); // 60</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Now, is this sufficiently general? There are at least a pair of problems with this approach. First, are<br/>you sure that the optimum of a set will always be the maximum? If you were considering several<br/>mortgages, the one with the lowest interest rate would be the best, right? To assume that you always<br/>want  the maximum of a set is too constrictive.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 56pt;text-indent: 0pt;text-align: left;"><a name="bookmark281">A negative maximum?</a></p><p style="padding-top: 4pt;padding-left: 57pt;text-indent: 0pt;line-height: 115%;text-align: left;"><span>You could do a roundabout trick: if you change the signs of all the numbers in an array, find<br/>its maximum, and change its sign, you actually get the minimum of the array. In our case,</span></p><p style="padding-left: 57pt;text-indent: 1pt;line-height: 118%;text-align: left;"><span>-findOptimum (myArray .map ( (x) =&gt; -x) ) would correctly produce 4, but it’s not<br/>easily understandable code.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Second, this way of finding the maximum depends on each option having a numeric value. But how<br/>would you find the optimum if such a value didn’t exist? The usual way depends on comparing elements<br/>with each other and picking the one that comes out on top:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><ol id="l74"><li data-list-text="1."><p style="padding-left: 70pt;text-indent: -17pt;text-align: left;">Compare the first element with the second and keep the best of those two.</p></li><li data-list-text="2."><p style="padding-top: 6pt;padding-left: 69pt;text-indent: -17pt;text-align: left;">Then compare that value with the third element and keep the best.</p></li><li data-list-text="3."><p style="padding-top: 6pt;padding-left: 70pt;text-indent: -17pt;text-align: left;">Keep at it until you have finished going through all the elements.</p></li></ol><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 20pt;text-indent: 0pt;text-align: left;">220  Producing Functions - Higher-Order Functions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>The way to solve this problem with more generality is to assume the existence of a comparator function,<br/>which takes two elements as arguments and returns the best of those. If you could associate a numeric<br/>value with each element, the comparator function could simply compare those values. In other cases,<br/>it could do whatever logic is needed to decide what element comes out on top.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;text-align: justify;">Let’s try to create an appropriate HOF; our newer version will use reduce () as follows:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">const find0ptimum2 =</p><p style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">&lt;T&gt;(fn: (x: T, y: T) =&gt; T) =&gt;</p><p style="padding-top: 4pt;padding-left: 76pt;text-indent: 0pt;text-align: left;">(arr: T [] ) : T =&gt;</p><p style="padding-top: 4pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">arr.reduce(fn);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: justify;"><span>This generic function takes a comparator that returns the best of two elements of a T type and then<br/>applies that function to an array of elements of a T type to produce the optimum.</span></p><p style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: justify;"><span>With this, we can easily replicate the maximum- and minimum-finding functions; we only have to<br/>provide the appropriate reducing functions:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;text-align: left;">const <b>findMaximum </b>= find0ptimum2(</p><p style="padding-top: 4pt;padding-left: 76pt;text-indent: 0pt;text-align: left;">(x: number, y: number): number =&gt; <b>(x &gt; y ? x : y)</b></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;text-align: left;">const</p><p style="padding-top: 4pt;padding-left: 76pt;text-indent: 0pt;text-align: left;">(x:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 10pt;text-indent: 0pt;text-align: left;">findMinimum = <span class="p">findOptimum2(</span></p><p style="padding-top: 4pt;padding-left: 9pt;text-indent: 0pt;text-align: left;">number, y: number): number =&gt; <b>(x &lt; y ? x : y)</b></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;text-align: left;">console.log(findMaximum(myArray)); // 60</p><p style="padding-top: 4pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">console.log(findMinimum(myArray)); // 4</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Let’s go one better and compare non-numeric values. Let’s imagine a superhero card game: each card<br/>represents a hero and has several numeric attributes, such as strength, powers, and tech. The<br/>corresponding class could be the following:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 73pt;text-indent: -11pt;line-height: 142%;text-align: left;"><span>class Card {<br/>name: string;</span></p><p style="padding-left: 73pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>strength: number;<br/>powers: number;<br/>tech: number;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 313pt;text-indent: 0pt;text-align: left;">Changing functions in other ways   221</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 76pt;text-indent: -12pt;line-height: 146%;text-align: justify;"><span>constructor(n: string, s: number, p: number, t: number) {<br/>this.name = n;</span></p><p style="padding-left: 77pt;text-indent: 0pt;line-height: 144%;text-align: justify;"><span>this.strength = s;<br/>this.powers = p;<br/>this.tech = t;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>When two heroes fight each other, the winner is the one with more categories with higher values than<br/>the other. Let’s implement a comparator for this; a suitable compareHeroes () function could be</span></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 10pt;text-align: left;">as follows:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 64pt;text-indent: -12pt;line-height: 141%;text-align: left;"><span>const compareHeroes = (cardl: Card, card2: Card): Card =&gt; {<br/>const onelfBigger = (x: number, y: number): number =&gt;</span></p><p style="padding-left: 76pt;text-indent: 0pt;text-align: justify;">x &gt; y ? 1 : 0;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">const winsl =</p><p style="padding-top: 4pt;padding-left: 76pt;text-indent: 0pt;line-height: 143%;text-align: left;"><span>onelfBigger(cardl.strength, card2.strength) +<br/>onelfBigger(cardl.powers, card2.powers) +<br/>onelfBigger(cardl.tech, card2.tech);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 65pt;text-indent: 0pt;text-align: left;">const wins2 =</p><p style="padding-top: 4pt;padding-left: 76pt;text-indent: 0pt;line-height: 143%;text-align: left;"><span>onelfBigger(card2.strength, cardl.strength) +<br/>onelfBigger(card2.powers, cardl.powers) +<br/>onelfBigger(card2.tech, cardl.tech);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 65pt;text-indent: 0pt;text-align: left;">return winsl &gt; wins2 ? cardl : card2;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: -9pt;line-height: 23pt;text-align: left;"><span>Then, we can apply this to our tournament of heroes. First, let’s create our own league of heroes:<br/>const codingLeagueOfAmerica = [</span></p><p style="padding-top: 4pt;padding-left: 64pt;text-indent: 0pt;text-align: left;">new Card(&quot;Forceful&quot;, 20, 15, 2),</p><p style="padding-top: 4pt;padding-left: 64pt;text-indent: 0pt;text-align: left;">new Card(&quot;Electrico&quot;, 12, 21, 8),</p><p style="padding-top: 4pt;padding-left: 64pt;text-indent: 0pt;text-align: left;">new Card(&quot;Speediest&quot;, 8, 11, 4),</p><p style="padding-top: 4pt;padding-left: 64pt;text-indent: 0pt;text-align: left;">new Card(&quot;TechWiz&quot;, 6, 16, 30),</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 20pt;text-indent: 0pt;text-align: left;">222  Producing Functions - Higher-Order Functions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: -9pt;line-height: 223%;text-align: left;"><span>With these definitions, we can write a findBestHero () function to get the top hero:<br/>const findBestHero = find0ptimum2(compareHeroes);</span></p><p style="padding-top: 6pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">console.log(findBestHero(codingLeagueOfAmerica));</p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">// Electrico is the top Card!</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 66pt;text-indent: 0pt;text-align: left;"><a name="bookmark282">Order does matter</a></p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;line-height: 115%;text-align: left;"><span>When you rank elements according to one-to-one comparisons, unexpected results may be<br/>produced. For instance, with our superheroes comparison rules, you could find three heroes<br/>where the results show that the first beats the second, the second beats the third, but the third<br/>beats the first! In mathematical terms, the comparison function is </span><i>not transitive, </i><span>and you don’t<br/>have a </span><i>total ordering </i>for the set.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>With this, we have seen several ways of modifying functions to produce newer variants with enhanced<br/>processing; think of particular cases you might be facing and consider whether an HOF might help<br/>you  out.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-left: 52pt;text-indent: 0pt;text-align: left;"><a name="bookmark283">Summary</a><a name="bookmark291">&zwnj;</a></p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>In this chapter, we learned how to write HOFs of our own that can either wrap another function to<br/>provide some new feature, alter a function’s objective so that it does something else, or even provide<br/>totally new features, such as decoupling methods from objects or creating better finders. The main<br/>takeaway from this chapter is that you have a way of modifying a function’s behavior without actually<br/>having to modify its own code; HOFs can manage this in an orderly way.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;">In <i>Chapter </i>7, <i>Trans forming Functions, </i><span>we’ll keep working with HOFs and learn how to produce specialized<br/>versions of existing functions with predefined arguments by using currying and partial application.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-left: 52pt;text-indent: 0pt;text-align: left;"><a name="bookmark284">Questions</a><a name="bookmark292">&zwnj;</a></p><ol id="l75"><ol id="l76"><li data-list-text="6.1"><p class="s10" style="padding-top: 9pt;padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: left;">Go with arrows: <span class="p">We implemented addLogging () using a function, and its typing was not simple.<br/>Just to deal with a different syntax, can you provide an alternate implementation of addLogging ()</span></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 10pt;text-align: justify;">but using an arrow function?</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="6.2"><p class="s10" style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;">Mapping for memory: <span class="p">We implemented our memoizing functions by using an object as a cache.<br/>However, using a map would be better; make the necessary changes.</span></p></li><li data-list-text="6.3"><p class="s10" style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: left;">How many? <span class="p">How many calls would be needed to calculate f ib (5 0) without memoizing? For<br/>example, one call and no further recursion were needed to calculate f ib (0) or f ib (1), and 25</span></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 10pt;text-align: justify;">calls were required for f ib (6). Can you find a formula to do this calculation?</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 401pt;text-indent: 0pt;text-align: left;">Questions  223</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="6.4"><p class="s10" style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;">A randomizing balancer: <span class="p">Write an HOF, that is, randomizer (f nl, f n2 , . . . ), that will<br/>receive a variable number of functions as arguments and return a new function that will, on each call,<br/>randomly call one of f nl, f n2, and so on. You could use this to balance calls to different services on<br/>a server if each function did an AJAX call. For bonus points, ensure that no function will be called<br/>twice in a row.</span></p></li><li data-list-text="6.5"><p class="s10" style="padding-top: 7pt;padding-left: 60pt;text-indent: -17pt;text-align: left;">Not in TypeScript: <span class="p">Write the fully typed TypeScript version of our not () and invert () functions.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="6.6"><p class="s10" style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;">Just say no! <span class="p">In this chapter, we wrote a not () function that worked with Boolean functions and<br/>a negate () function that worked with numerical ones. Can you go one better and write a single<br/>opposite () function that will behave as not () or negate (), as needed?</span></p></li><li data-list-text="6.7"><p class="s10" style="padding-top: 6pt;padding-left: 61pt;text-indent: -18pt;text-align: left;">Invert tests: <span class="p">Write some tests for invert (), as suggested.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="6.8"><p class="s10" style="padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: justify;">Why not shorter? <span class="p">If we write the f ilterNot () function with a slight change, as shown here,<br/>TypeScript will object; why?</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">const filterNot2 =</p><p style="padding-top: 4pt;padding-left: 66pt;text-indent: -1pt;line-height: 142%;text-align: left;"><span>&lt;A, T extends (x: A) =&gt; boolean&gt;(arr: A[]) =&gt;<br/>(fn: T) : A [] =&gt;</span></p><p style="padding-left: 76pt;text-indent: 0pt;text-align: left;">arr.filter<b>(not(fn));</b></p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="6.9"><p class="s10" style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;">Wrong function length: <span class="p">Our arity () function works well, but the produced functions don’t have<br/>the correct length attribute. Can you write a different arity-changing function without this defect?</span></p></li><li data-list-text="6.10"><p class="s10" style="padding-top: 7pt;padding-left: 66pt;text-indent: -22pt;text-align: left;">Many arities! <span class="p">Can you write TypeScript versions of binary () and ternary () ?</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="6.11"><p class="s10" style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;">Throttling promises: <span class="p">If you memoize an async function, every time you call it with the same<br/>arguments, you’ll get the same promise as a result. But imagine we were calling a weather API,<br/>which updates its data every 5 minutes. We don’t want to call it just once and never again (as with<br/>memoization), but we don’t want to call it every time either. Can you add throttling behavior to our<br/>promiseMemoize () function so, after a given delay, a new call to the API will be made?</span></p></li><li data-list-text="6.12"><p class="s10" style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;line-height: 126%;text-align: justify;">All operators called: <span class="p">When writing a full binaryOp () function that would work with numbers,<br/>what is the list of all the operators you should consider?</span></p></li><li data-list-text="6.13"><p style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><b>Missing companion: </b><span>If we have a getField () function, we should also have a setField ()<br/>function, so can you define it? We’ll need both in </span><i>Chapter 10, Ensuring Purity, </i><span>when we work with<br/>getters, setters, and lenses. Note that setField () shouldn’t directly modify an object; instead, it<br/>should return a new object with a changed value - it should be a pure function!</span></p></li><li data-list-text="6.14"><p class="s10" style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;">A border case: <span class="p">What happens with our getField () function if we apply it to a null object?<br/>What should its behavior be? If necessary, modify the function. This question has different answers<br/>in JavaScript and TypeScript; be careful!</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><table style="border-collapse:collapse;margin-left:18.38pt" cellspacing="0"><tr style="height:18pt"><td style="width:24pt"><p class="s29" style="padding-left: 2pt;text-indent: 0pt;line-height: 10pt;text-align: left;">224</p></td><td style="width:408pt;border-bottom-style:solid;border-bottom-width:1pt"><p class="s29" style="padding-left: 10pt;text-indent: 0pt;line-height: 10pt;text-align: left;">Producing Functions - Higher-Order Functions</p></td></tr><tr style="height:129pt"><td style="width:24pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:408pt;border-top-style:solid;border-top-width:1pt"><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s29" style="padding-left: 9pt;padding-right: 57pt;text-indent: 0pt;line-height: 13pt;text-align: left;"><span>compareHeroes () function? Wouldn’t that have been faster? Or even better: avoid calculating<br/>wins2 at all, and change the final line to return winsl &gt;= 2?</span></p></td></tr></table><ol id="l77"><ol id="l78"><li data-list-text="6.15"><p class="s188" style="padding-left: 9pt;padding-right: 41pt;text-indent: 0pt;line-height: 123%;text-align: left;">Typed demethodizing: <span class="s29">Provide TypeScript fully typed versions of our trio of demethodize ()<br/>functions. A tip: once you get one of them right, the other two will be pretty similar!</span></p></li><li data-list-text="6.16"><p class="s188" style="padding-top: 7pt;padding-left: 9pt;padding-right: 36pt;text-indent: 0pt;line-height: 124%;text-align: left;">Not reinventing the wheel: <span class="s29">When we wrote findMaximum() and f indMinimum (), we wrote<br/>our own functions to compare two values - but JavaScript already provides appropriate functions for<br/>that! Can you figure out alternative versions of our code based on that hint?</span></p></li><li data-list-text="6.17"><p class="s188" style="padding-top: 7pt;padding-left: 28pt;text-indent: -18pt;text-align: left;">Comparing heroes: <span class="s29">Why didn’t we just write const wins2 = 3 - winslinour</span></p></li></ol></ol><p style="text-indent: 0pt;text-align: left;"><br/></p><h3 style="padding-top: 10pt;text-indent: 0pt;text-align: right;"><a name="bookmark293">7</a><a name="bookmark294">&zwnj;</a></h3><h2 style="padding-top: 4pt;padding-left: 132pt;text-indent: 0pt;text-align: center;">Transforming Functions</h2><ul id="l79"><li data-list-text="-"><h2 style="padding-top: 1pt;padding-left: 62pt;text-indent: -14pt;text-align: justify;">Currying and Partial Application</h2><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;">In <i>Chapter 6, Producing Functions, </i><span>we saw several ways of manipulating functions to get new<br/>versions with some changes in their functionality. In this chapter, we will go into a particular kind of<br/>transformation, a sort of </span><b>factory method </b>that lets you produce new versions of any given function.</p><p style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;text-align: justify;">We will be considering the following:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l80"><li data-list-text="•"><p class="s33" style="padding-left: 70pt;text-indent: -13pt;line-height: 123%;text-align: left;">	<span class="s10">Currying: </span><span class="p">A classic FP theoretical function that transforms a function with many parameters<br/>into a sequence of unary functions</span></p></li><li data-list-text="•"><p class="s33" style="padding-top: 5pt;padding-left: 70pt;text-indent: -13pt;line-height: 123%;text-align: left;">	<span class="s10">Partial application: </span><span class="p">Another time-honored FP transformation, which produces new versions<br/>of functions by fixing some of their arguments</span></p></li><li data-list-text="•"><p class="s10" style="padding-top: 5pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">Partial currying <span class="p">(a name of my own): Can be seen as a mixture of the two previous transformations</span></p></li></ul></li></ul></li></ol></ol><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>The techniques in this chapter will provide you with a different way of producing functions from<br/>other functions. To be fair, we’ll also see that some of these techniques can be emulated, possibly with<br/>greater clarity, by simple arrow functions. However, since you are liable to find currying and partial<br/>application in all sorts of texts and web pages on FP, it is important that you know their meaning<br/>and usage, even if you opt for a simpler way out. We’ll look at several applications of the ideas in the<br/>following sections.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-left: 43pt;text-indent: 0pt;text-align: justify;"><a name="bookmark295">A bit of theory</a></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>The concepts we’ll discuss in this chapter are in some ways very similar, and in other ways quite different.<br/>It’s common to find confusion about their real meanings, and plenty of web pages misuse terms. You<br/>could even say that all the transformations in this chapter are roughly equivalent since they let you<br/>transform a function into another one that fixes some parameters, leaving other parameters free, and<br/>eventually leading to the same result. Okay, I agree; this isn’t very clear! So, let’s start by clearing the air</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 20pt;text-indent: 0pt;text-align: left;">226 Transforming Functions - Currying and Partial Application</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>and providing some short definitions, which we will expand on later. (If you feel your eyes are glazing<br/>over, please skip this section and return to it later!) Yes, you may find the following descriptions a bit<br/>perplexing, but bear with us—we’ll go into more detail in just a bit:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l81"><li data-list-text="•"><p class="s9" style="padding-left: 79pt;text-indent: -12pt;line-height: 124%;text-align: justify;"><span class="s33">	</span>Currying <span class="p">is transforming an m-ary function (that is, a function of arity m) into a sequence of<br/></span>m <span class="p">unary functions, each receiving one argument of the original function, from left to right.<br/>(The first function receives the first argument of the original function and returns a second<br/>function, which receives the second argument and returns a third function, which receives the<br/>third argument, and so on.) Upon being called with an argument, each function produces the<br/>next one in the sequence, and the last one does the actual calculations.</span></p></li><li data-list-text="•"><p class="s9" style="padding-top: 5pt;padding-left: 79pt;text-indent: -12pt;line-height: 124%;text-align: justify;">Partial application <span class="p">is providing </span>n <span class="p">arguments to an /n-ary function, with </span>n <span class="p">less than or equal to </span><span>m,<br/></span><span class="p">to transform it into a function with (m-n) parameters. Each time you provide some arguments,<br/>a new function is produced, with smaller arity. When you provide the last arguments, the actual<br/>calculations are performed.</span></p></li><li data-list-text="•"><p class="s9" style="padding-top: 5pt;padding-left: 79pt;text-indent: -12pt;line-height: 124%;text-align: justify;"><span class="s33">	</span>Partial currying <span class="p">is a mixture of both preceding ideas: you provide </span>n <span class="p">arguments (from left to<br/>right) to an m-ary function and produce a new function of arity </span>(m-n). <span class="p">When this new function<br/>receives some other arguments, also from left to right, it will produce yet another function.<br/>When the last parameters are provided, the function produces the correct calculations.</span></p></li></ul><p style="padding-top: 8pt;padding-left: 52pt;text-indent: 0pt;text-align: justify;">In this chapter, we will see these three transformations, what they require, and ways of implementing them.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-left: 52pt;text-indent: 0pt;text-align: left;"><a name="bookmark296">Currying</a></p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;">We already mentioned <i>currying </i>back in the <i>Arrow functions </i>section of <i>Chapter 1, Becoming Functional,</i>and in the <i>One argument or many? </i>section of <i>Chapter 3, Starting Out with Functions, </i><span>but let’s be more<br/>thorough here. Currying is a technique that enables you to only work with single-variable functions,<br/>even if you need a multi-variable one.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 66pt;text-indent: 0pt;text-align: left;"><a name="bookmark297">Currying by any other name?</a></p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;line-height: 114%;text-align: left;"><span>The idea of converting a multi-variable function into a series of single-variable functions (or,<br/>more rigorously, reducing operators with several operands to a sequence of applications of a<br/>single operand operator) was worked on by Moses Schonfinkel. Some authors suggest, not<br/>necessarily tongue-in-cheek, that currying would be more correctly named </span><i>Schonfinkeling\</i></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>In the following sections, we will first see how to deal with functions with many parameters, and then<br/>move on to how to curry by hand or by using bind ().</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: right;">Currying  227</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-top: 5pt;padding-left: 44pt;text-indent: 0pt;text-align: justify;"><a name="bookmark298">Dealing with many parameters</a></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>The idea of currying, by itself, is simple. If you need a function with, say, three parameters, you could<br/>write something like the following by using arrow functions:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s9" style="padding-left: 53pt;text-indent: 0pt;text-align: left;">I<span class="p">/ curryByHand.ts</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 65pt;text-indent: -12pt;line-height: 146%;text-align: left;"><span>const make3 = (a: string, b: number, c: string): string =&gt;<br/>&#39;${a}:${b}:${c}&#39;;</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;text-align: justify;">Alternatively, you can have a sequence of functions, each with a single parameter, as shown here:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s9" style="padding-left: 53pt;text-indent: 0pt;text-align: left;">11 <span class="p">continued...</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">const make3curried =</p><p style="padding-top: 4pt;padding-left: 77pt;text-indent: -10pt;line-height: 144%;text-align: left;"><span>(a: string) =&gt; (b: number) =&gt; (c: string) =&gt;<br/>&#39;${a}:${b}:${C}&#39;;</span></p><p style="padding-top: 8pt;padding-left: 43pt;text-indent: 0pt;text-align: justify;">Alternatively, you might want to consider them as nested functions, like the following code snippet:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 65pt;text-indent: -12pt;line-height: 141%;text-align: left;"><span>const   make3curried2   =   function   (a:   string)   {<br/>return function (b: number) {</span></p><p style="padding-left: 88pt;text-indent: -12pt;line-height: 144%;text-align: left;"><span>return function (c: string) {<br/>return &#39;${a}:${b}:${c}&#39;;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>In terms of usage, there’s an essential difference in how you’d use each function. While you would call<br/>the first in the usual fashion, such as make3 ( &quot;A&quot; , 2 , &quot; Z &quot; ), that wouldn’t work with the second<br/>definition. Let’s work out why: make3 curried () is a unary (single parameter), so we should write<br/>make3 curried (&quot; A&quot;). But what does this return? According to the preceding definition, this also<br/>returns a unary function—and that function also returns a unary function! So, the correct call to get the<br/>same result as with the ternary function would be make3 curried (&quot;A&quot;) (2) (&quot;Z&quot;)! See </span><i>Figure 7.1:</i></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 20pt;text-indent: 0pt;text-align: left;">228 Transforming Functions - Currying and Partial Application</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="264" height="181" alt="image" src="Image_029.gif"/></span></p><p class="s211" style="padding-top: 4pt;padding-left: 348pt;text-indent: 0pt;text-align: left;">result</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s211" style="padding-left: 348pt;text-indent: 0pt;text-align: left;">result</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 106pt;text-indent: 0pt;text-align: left;">Figure 7.1 -The difference between a common function and a curried equivalent</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Study this carefully—we have the first function, and when we apply an argument to it, we get a second<br/>function. Applying an argument to it produces a third function, and a final application produces the<br/>desired result. This can be seen as a needless exercise in theoretical computing, but it actually brings<br/>some advantages because you can then always work with unary functions, even if you need functions<br/>with more parameters.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 66pt;text-indent: 0pt;text-align: left;"><a name="bookmark299">Currying versus uncurrying</a></p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;line-height: 115%;text-align: left;"><span>Since there is a currying transformation, there is also an uncurrying one! In our case, we would<br/>write make3uncurried = (a, b, c) =&gt; make3curried(a) (b) (c) to reverse</span></p><p style="padding-left: 65pt;text-indent: 0pt;text-align: left;">the currying process and make it usable once again, to provide all parameters in one sitting.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 8pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>In some languages, such as Haskell, functions are only allowed to take a single parameter—but then<br/>again, the language’s syntax allows you to invoke functions as if multiple parameters were permitted.<br/>For our example, in Haskell, writing make3curried &quot;A&quot; 2 &quot; Z &quot; would have produced &quot; A: 2 : Z&quot;<br/>without anybody even needing to be aware that it involved three function calls, each with one of<br/>our arguments. Since you don’t write parentheses around parameters and don’t separate them with<br/>commas, you cannot tell that you are not providing a triplet of values instead of three singular ones.</span></p><p style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Currying is basic in Scala or Haskell, which are fully functional languages, but JavaScript has enough<br/>features to allow us to define and use currying in our work. It won’t be as easy since, after all, it’s not<br/>built-in—but we’ll be able to manage.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>So,  to review the basic concepts, the key differences between our original make 3 () and<br/>make3 curried () functions are as follows:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l82"><li data-list-text="•"><p style="padding-left: 79pt;text-indent: -13pt;text-align: left;">make3() is a ternary function, but make3curried () is unary</p></li><li data-list-text="•"><p class="s33" style="padding-top: 8pt;padding-left: 79pt;text-indent: -13pt;line-height: 123%;text-align: left;">	<span class="p">make3 () returns a string; make3 curried () returns another function—which itself returns<br/>a second function, which returns yet a third function, which finally does return a string</span></p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: right;">Currying  229</p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l83"><li data-list-text="•"><p style="padding-left: 71pt;text-indent: -14pt;line-height: 123%;text-align: left;"><span>You can produce a string by writing something like make3 (&quot;A&quot;,2, &quot; Z &quot; ), which returns<br/>&quot;A: 2 : Z&quot;, but you’ll have to write make3curried (&quot;A&quot;) (2) (&quot;Z&quot;) to get the same result</span></p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Why would you go to all this bother? Let’s look at a simple example, and further on, we will look at<br/>more examples. Suppose you had a function that calculated the value-added tax (VAT) for an amount,<br/>as shown here:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 64pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>const addVAT = (rate: number, amount: number): number =&gt;<br/>amount * (1 + rate / 100) ;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">addVAT(20,  500);  //  600  --  that  is,  500  +  20%</p><p style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">addVAT(15, 200); // 230 -- 200 +15%</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>If you had to apply a single, constant rate, you could curry the addVAT () function to produce a<br/>more specialized version that always applied your given rate. For example, if your national rate was<br/>6%, you could then have something like the following:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s9" style="padding-left: 53pt;text-indent: 0pt;text-align: left;">11 <span class="p">continued...</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 66pt;text-indent: -13pt;line-height: 143%;text-align: left;"><span>const addVATcurried =<br/>(rate: number) = &gt;</span></p><p style="padding-left: 76pt;text-indent: -9pt;line-height: 146%;text-align: left;"><span>(amount: number): number =&gt;<br/>amount * (1 + rate / 100) ;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">const addNationalVAT = <b>addVATcurried(6);</b></p><p style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">addNationalVAT(1500); // 1590 -- 1500 + 6%</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>The first line defines a curried version of our VAT-calculating function. Given a tax rate,<br/>addVATcurried () returns a new function, which, when given an amount of money, finally adds the<br/>original tax rate to it. So, if the national tax rate were 6%, addNationalVAT () would be a function that<br/>added 6% to any amount given to it. For example, if we were to calculate addNationalVAT (15 0 0),<br/>as in the preceding code, the result would be 15 9 0: $1,500, plus 6% tax.</span></p><p style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Of course, you are justified in saying that this currying thing is a bit too much just to add a 6% tax,<br/>but the simplification is what counts. Let’s look at one more example. In your application, you may<br/>want to include some logging with a function such as the following:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 20pt;text-indent: 0pt;text-align: left;">230 Transforming Functions - Currying and Partial Application</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">function myLog(severity: string, logText?: string) {</p><p style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">// display logText in an appropriate way,</p><p style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">// according to its severity</p><p style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">// (&quot;NORMAL&quot;, &quot;WARNING&quot;, or &quot;ERROR&quot;)</p><p style="padding-top: 6pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>However, with this approach, every time you wanted to display a normal log message, you would write<br/>myLog(&quot;NORMAL&quot;, &quot;some normal text&quot;), and for warnings, you’d write myLog (&quot;WARNING&quot;,<br/>&quot; some warning text&quot;). You could simplify this a bit with currying, by fixing the first parameter<br/>of myLog () as follows, with a curry () function that we’ll look at later. Our code could then be<br/>as follows:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;"><a name="bookmark300">// continued...</a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">myLog = curry(myLog);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 8pt;padding-left: 61pt;text-indent: 0pt;line-height: 144%;text-align: justify;">const myNormalLog = <b>myLog(&quot;NORMAL&quot;);</b><span>const myWarningLog = myLog(&quot;WARNING&quot;);<br/>const myErrorLog = myLog(&quot;ERROR&quot;);</span></p><p style="padding-top: 8pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>What  do  you  gain?  Now,  you  can  write  myNormalLog  (&quot;  some  normal  text&quot;)  or<br/>myWarningLog  (&quot;  some  warning  text&quot;)  because  you  have  curried  myLog  ()  and  then<br/>fixed its argument, making for simpler, easier-to-read code!</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>By the way, if you prefer, you could have also achieved the same result in a single step, with the original<br/>uncurried myLog () function, by currying it case by case:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;line-height: 144%;text-align: justify;">const myNormalLog2 = <b>curry(myLog)(&quot;NORMAL&quot;);</b><span>const myWarningLog2 = curry(myLog)(&quot;WARNING&quot;);<br/>const myErrorLog2 = curry(myLog)(&quot;ERROR&quot;);</span></p><p style="padding-top: 8pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>So, having a curry () function lets you fix some arguments while leaving others still open; let’s see<br/>how to do this in three different ways.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 52pt;text-indent: 0pt;text-align: justify;"><a name="bookmark301">Currying by hand</a></p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Before trying more complex things, we could curry a function by hand, without any special auxiliary<br/>functions or anything else. And, in fact, if we want to implement currying for a particular case, there’s</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: right;">Currying  231</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>no need to do anything complex because we can manage with simple arrow functions. We saw that<br/>with both make3curried () and addVATcurried (), so there’s no need to revisit that idea.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Instead, let’s look into some ways of doing that automatically, so we can produce an equivalent curried<br/>version of any function, even without knowing its arity beforehand. Going further, we should code a<br/>more intelligent version of a function that could work differently depending on the number of received<br/>arguments. For example, we could have a sum (x, y) function that behaved as in the following examples:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 53pt;text-indent: 0pt;text-align: left;">sum(3, 5); <span class="p">// 8; did you expect otherwise?</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">const add3 = sum(3);</p><p class="s10" style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">add3(5);    <span class="p">// 8</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-top: 7pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">sum(3)(5); <span class="p">// 8</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: justify;"><span>We can achieve that behavior by hand. Our function would be something like the following - and<br/>since we won’t be using this style, let’s stay with plain JavaScript, with no typing:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s9" style="padding-left: 53pt;text-indent: 0pt;text-align: left;">I<span class="p">/ continued...</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">const sum = (x, y) = &gt; {</p><p style="padding-top: 4pt;padding-left: 77pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>if (x !== undefined &amp;&amp; y !== undefined) {<br/>return x + y;</span></p><p style="padding-left: 76pt;text-indent: -10pt;line-height: 142%;text-align: left;"><span>} else if (x !== undefined &amp;&amp; y == undefined) {<br/>return (z) =&gt; sum(x, z);</span></p><p style="padding-left: 77pt;text-indent: -11pt;line-height: 143%;text-align: left;"><span>} else {   // x,y both undefined<br/>return sum;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: justify;">Let’s recap what we did here. Our curried-by-hand function has this behavior:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l84"><li data-list-text="•"><p style="padding-left: 70pt;text-indent: -13pt;line-height: 126%;text-align: justify;"><span>If we call it with two arguments, it adds them and returns the sum; this provides our first use<br/>case, as in sum (3,5) = = = 8.</span></p></li><li data-list-text="•"><p style="padding-top: 5pt;padding-left: 70pt;text-indent: -12pt;line-height: 124%;text-align: justify;"><span>If only one argument is provided, it returns a new function. This new function expects a single<br/>argument and will return the sum of that argument and the original one: this behavior is what<br/>we expected in the other two use cases, such as add2 (3 ) ===5 or sum (2) (7) = = = 9.</span></p></li><li data-list-text="•"><p class="s33" style="padding-top: 5pt;padding-left: 70pt;text-indent: -12pt;line-height: 123%;text-align: justify;">	<span class="p">Finally, if no arguments are provided, it returns itself. This means that we would be able to<br/>write sum () (1) (2) if we desired. (No, I cannot think of a reason for wanting to write that.)</span></p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 20pt;text-indent: 0pt;text-align: left;">232  Transforming Functions - Currying and Partial Application</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>So, we can incorporate currying in the definition itself of a function. However, you’ll have to agree that<br/>dealing with all the special cases in each function could quickly become troublesome and error-prone.<br/>So, let’s work out some generic ways of accomplishing the same result without any particular coding.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 52pt;text-indent: 0pt;text-align: justify;"><a name="bookmark302">Currying with bind()</a></p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>We can find a solution to currying by using the bind () method, which we have already applied in<br/>several places in this book. This allows us to fix one argument (or more, if need be; we won’t need to<br/>do that here, but later on we will use it) and provide a function with that fixed argument. Of course,<br/>many libraries (such as Lodash, Underscore, Ramda, and others) provide this functionality, but we<br/>want to see how to implement that ourselves.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s34" style="padding-left: 52pt;text-indent: 0pt;text-align: justify;">A plain JavaScript version</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Our implementation is relatively short but will require some explanation. First, let’s see a JavaScript<br/>version and deal with TypeScript later:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// curry.js</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 73pt;text-indent: -11pt;line-height: 143%;text-align: left;"><span>function curry(fn) {<br/>return fn.length === 0</span></p><p style="padding-left: 86pt;text-indent: 0pt;text-align: left;">? fn()</p><p style="padding-top: 4pt;padding-left: 87pt;text-indent: 0pt;text-align: left;">: (x) =&gt; curryByBind(fn.bind(null, x));</p><p style="padding-top: 6pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Start by noticing that curryByBind () always returns a new function, which depends on the f n<br/>function given as its parameter. If the function has no (more) parameters left (when fn. length===0)<br/>because all parameters have already been bound, we can evaluate it by using f n (). Otherwise, the<br/>result of currying the function will be a new function that receives a single argument and produces a<br/>newly curried function with another fixed argument. Let’s see this in action, with a detailed example,<br/>using the make 3 () function we saw at the beginning of this chapter once again:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">const make3 = (a, b, c) =&gt; &#39;${a}:${b}:${c}&#39;;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;line-height: 142%;text-align: left;"><span>// fl is the curried version of make3<br/>const fl = curry(make3);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;line-height: 142%;text-align: left;">// f2 is a function that will fix make3<span class="s162">1</span><span>s 1st parameter<br/>const f2 = </span><b>fl(&quot;A&quot;);</b></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: right;">Currying  233</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>// f3 is a function that will fix make3&#39;s 2nd parameter<br/>const f3 = </span><b>f2(2);</b></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// &quot;A2Z&quot; will be now calculated, since we are providing</p><p style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;line-height: 141%;text-align: left;"><span>// the 3rd (last) make3&#39;s parameter<br/>const f4 = </span><b>f3 (&quot;Z&quot;) ;</b></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">console.log(f4);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: left;">The explanation of this code is as follows:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l85"><li data-list-text="•"><p class="s33" style="padding-left: 70pt;text-indent: -12pt;line-height: 123%;text-align: justify;">	<span class="p">The first function, f 1 (), has yet to receive any arguments. When called with an argument, it<br/>will produce a curried version of make 3 (), with its first argument fixed.</span></p></li><li data-list-text="•"><p class="s33" style="padding-top: 5pt;padding-left: 70pt;text-indent: -12pt;line-height: 124%;text-align: justify;">	<span class="p">Calling fl (&quot; A&quot;) produces a new unary function, f 2 (), which will itself produce a curried<br/>version of make 3 () —but with its first argument set to &quot; A&quot;, so actually, the new function will<br/>end up fixing the second parameter of make 3 ().</span></p></li><li data-list-text="•"><p style="padding-top: 5pt;padding-left: 70pt;text-indent: -13pt;line-height: 125%;text-align: justify;"><span>Similarly, calling f 2 (2 ) produces a third unary function, f 3 (), which will produce a version<br/>of make 3 (), but fixing its third argument, since the first two have already been fixed.</span></p></li><li data-list-text="•"><p class="s33" style="padding-top: 5pt;padding-left: 70pt;text-indent: -13pt;line-height: 124%;text-align: justify;">	<span class="p">Finally, when we calculate f 3 (&quot; Z&quot;), this fixes the last parameter of make 3 () to &quot; Z&quot;, and<br/>since there are no more arguments left, the thrice-bound make 3 () function is called and the<br/>&quot; A: 2 : Z &quot; result is produced.</span></p></li></ul><p style="padding-top: 8pt;padding-left: 43pt;text-indent: 0pt;text-align: left;">You can do other call sequences as well, such as the following:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">const f2b = <b>fl(&quot;TEA&quot;)(4);</b></p><p style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">const f3b = <b>f2b(&quot;TW0&quot;);</b></p><p style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// &quot;TEA:4:TW0&quot;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">const flc = fl(&quot;IN&quot;)(10)(&quot;TION&quot;);</p><p style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// &quot;IN&quot;:10:&quot;TION&quot;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>To curry the function by hand, you could use JavaScript’s . bind () method. The sequence would<br/>be as follows:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">const stepl = make3<b>.bind(null, &quot;A&quot;);</b></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 20pt;text-indent: 0pt;text-align: left;">234 Transforming Functions - Currying and Partial Application</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;text-align: left;">const step2 = stepl<b>.bind(null, 2);</b></p><p style="padding-top: 4pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">const step3 = step2<b>.bind(null, &quot;Z&quot;);</b></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">console.log(step3()); // &quot;A:2:Z&quot;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>In each step, we provide an additional parameter. (The null value is required, to provide context. If it<br/>were a method attached to an object, we would provide that object as the first parameter to . bind ().<br/>Since that’s not the case, null is expected.) This is equivalent to what our code does, except that the<br/>last time, curryByBind () does the actual calculation instead of making you do it, as in step3 ().</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s34" style="padding-left: 52pt;text-indent: 0pt;text-align: justify;">A TypeScript version</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Now that have implemented this in JavaScript, let’s see how to define types for currying. We have to<br/>work recursively and consider two cases:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l86"><li data-list-text="•"><p style="padding-left: 79pt;text-indent: -13pt;text-align: left;">If we curry a function with just one parameter, the function will directly produce the desired result</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 79pt;text-indent: -12pt;line-height: 123%;text-align: left;"><span>If we curry a function with two or more parameters, we’ll create a unary function (with the first<br/>parameter) that will return a (curried!) function that will deal with the rest of the parameters:</span></p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// curry.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 51pt;text-indent: 0pt;text-align: center;">type Curry&lt;P, R&gt; = P extends [infer</p><p style="padding-top: 4pt;padding-left: 51pt;text-indent: 0pt;text-align: center;">? (arg: H) = &gt; R // only 1 arg</p><p style="padding-top: 4pt;padding-left: 75pt;text-indent: 0pt;text-align: left;">: P extends [infer H, ...infer T]</p><p style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">? (arg: H)    =&gt; Curry&lt;[. . . T] , R&gt;</p><p style="padding-top: 4pt;padding-left: 75pt;text-indent: 0pt;text-align: left;">: never;</p><p style="padding-top: 4pt;padding-left: 54pt;text-indent: 0pt;text-align: left;">H]</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 55pt;text-indent: 0pt;text-align: left;">// 2 or more args</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>We will have a generic type with two inputs: P, representing the parameters of the function to process,<br/>and R, standing for the result type of that function. If P has just one type, H, we return a function<br/>that, given an argument of the H type, returns a result of the R type. If P is formed by a first H type<br/>(“head”) and some other T types (“tail”), we return a function that will return a (curried) function<br/>with  T types as arguments.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Using this type has an added complexity. TypeScript cannot verify that our curryByBind () function<br/>works correctly because it cannot deduce that, for every function, we’ll eventually produce a result<br/>instead of yet another curried function. There’s a tricky solution involving an overloaded function<br/>with just </span><i>one </i><span>signature. The key is that the implementation is checked more loosely, and you can use<br/>any types to get by. Of course, working like this isn’t precisely type-safe; it’s up to you to ensure that<br/>the function is type-correct because you are essentially bypassing TypeScript’s checks. We’ll have to<br/>do this kind of trick more than once in this chapter:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: right;">Currying  235</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-top: 7pt;padding-left: 65pt;text-indent: -12pt;line-height: 143%;text-align: left;"><span>function currycA extends any[], R&gt;(<br/>fn: (...args: A) =&gt; R</span></p><p class="s10" style="padding-left: 53pt;text-indent: 0pt;line-height: 10pt;text-align: left;">): Curry&lt;A, R&gt;;</p><p style="padding-top: 4pt;padding-left: 64pt;text-indent: -11pt;line-height: 141%;text-align: left;"><span>function curry(fn: (...args: any) =&gt; any) {<br/>return fn.length === 0</span></p><p style="padding-left: 77pt;text-indent: 0pt;text-align: left;">? fn()</p><p style="padding-top: 4pt;padding-left: 78pt;text-indent: 0pt;text-align: left;">: (x: any) =&gt; curry(fn.bind(null, x) ) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: left;">Lets go back to our make3 () example. Types work out perfectly well:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">const fl = curry(make3);</p><p class="s10" style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// (arg: string) =&gt; (arg: number) =&gt; (arg: string) =&gt; string</p><p style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">const f2 = fl(&quot;A&quot;);</p><p class="s10" style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// (arg: number) =&gt; (arg: string) =&gt; string</p><p style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">const f3 = f2(2) ;</p><p class="s10" style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// (arg: string) =&gt; string</p><p style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">const f4 = f3(&quot;Z&quot;);</p><p class="s10" style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// string</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>The type of f 1 is key; it shows that our recursive typing worked as expected. The types of f 2 and f 3<br/>are shorter, and the type of f 4 is the type of the final result, string.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s34" style="padding-left: 43pt;text-indent: 0pt;text-align: left;">Currying tests</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: left;">Testing this transformation is rather simple because there are not many possible ways of currying:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// curry.test.js</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">describe(&quot;with curry&quot;, function () {</p><p style="padding-top: 4pt;padding-left: 76pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>it(&quot;you fix arguments one by one&quot;, () -&gt; {<br/>const make3a = curry(make3);</span></p><p style="padding-left: 76pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>const make3b = make3a(&quot;A&quot;)(2);<br/>const make3c = make3b(&quot;Z&quot;);</span></p><p style="padding-left: 76pt;text-indent: 0pt;line-height: 10pt;text-align: left;">expect(make3c).toBe(make3(&quot;A&quot;, 2, &quot;Z&quot;));</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 20pt;text-indent: 0pt;text-align: left;">236 Transforming Functions - Currying and Partial Application</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>What else could you test? Maybe functions with just one parameter could be added, but there are no<br/>more to try.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-left: 53pt;text-indent: 0pt;text-align: justify;"><a name="bookmark303">Partial application</a></p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>The second transformation we will be considering lets you fix some of the function’s parameters,<br/>creating a new function that will receive the rest of them. Let’s make this clear with a nonsense<br/>example. Imagine you have a function with five parameters. You might want to fix the second and<br/>fifth parameters, and partial application would produce a new version of the function that fixed those<br/>two parameters but left the other three open for new calls. If you called the resulting function with<br/>the three required arguments, it would produce the correct answer by using the original two fixed<br/>parameters plus the newly provided three.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 65pt;text-indent: 0pt;text-align: justify;"><a name="bookmark304">Projecting parameters</a></p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;line-height: 115%;text-align: justify;"><span>The idea of specifying only some parameters in function application, producing a function<br/>of the remaining parameters, is called </span><b>projection: </b><span>you are said to be projecting the function<br/>onto the remaining arguments. We will not use this term, but I wanted to cite it in case you<br/>find it elsewhere.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Let’s consider an example using the fetch () API, widely considered the modern way to go for Ajax<br/>calls. You might want to fetch several resources, always specifying the same parameters for the call<br/>(for example, request headers) and only changing the URL to search. By using partial application, you<br/>could create a new myFetch () function that would always provide fixed parameters.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 66pt;text-indent: 0pt;text-align: justify;"><a name="bookmark305">On fetching</a></p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;line-height: 114%;text-align: justify;"><span>You can read more on fetch () at developer . mozilla . org/en-US/docs/Web/<br/>API/Fetch_API/Using_Fetch.  According  to  caniuse  .  com/#search=fetch,  you<br/>can         use it in most browsers except for (oh, surprise!) Internet Explorer, but you can get around<br/>this limitation with a polyfill, such as the one found at github. com/ github/fetch.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Let’s assume we have apartial () function that implements this kind of application and let’s see<br/>how we’d use that to produce our new, specialized version of fetch ():</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;text-align: left;"><a name="bookmark306">const myFetch = </a><b>partial(fetch, undefined, myParameters);</b></p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">// undefined means the first argument for fetch</p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">//is not yet defined; the second argument for</p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">// fetch() is set to myParameters</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">myFetch(&quot;a/first/url&quot;)</p><p style="padding-top: 4pt;padding-left: 75pt;text-indent: 0pt;text-align: left;">.then(/* do something */)</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 12pt;padding-left: 372pt;text-indent: 0pt;text-align: left;">Partial application  237</p><p style="padding-top: 3pt;padding-left: 52pt;text-indent: 14pt;line-height: 30pt;text-align: left;"><span>.catch(/* on error */);<br/>myFetch(&quot;a/second/url&quot;)</span></p><p style="padding-top: 4pt;padding-left: 66pt;text-indent: 0pt;text-align: left;">.then(/* do something else */)</p><p style="padding-top: 4pt;padding-left: 66pt;text-indent: 0pt;text-align: left;">.catch(/* on error */) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Currying would have worked if the request parameters had been the first argument for fetch ().<br/>(Well have more to say about the order of parameters later.) With partial application, you can replace<br/>any arguments, no matter which, so in this case, myFetch () ends up as a unary function. This new<br/>function will get data from any URL you wish, always passing the same set of parameters for the<br/>GET operation.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 44pt;text-indent: 0pt;text-align: justify;"><a name="bookmark307">Partial application with arrow functions</a></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Trying to do partial application by hand, as we did with currying, is too complicated. For instance,<br/>for a function with 5 parameters, you would have to write code allowing the user to provide any of<br/>the 32 possible combinations of fixed and unfixed parameters - 32 being equal to 2 raised to the fifth<br/>power. Even if you could simplify the problem, it would still remain hard to write and maintain. See<br/></span><i>Figure 7.2 </i>for one of many possible combinations:</p><p class="s186" style="padding-top: 6pt;padding-left: 136pt;text-indent: 0pt;text-align: left;">a.b,c,d,e       <span><img width="26" height="22" alt="image" src="Image_030.gif"/></span><span class="s164">           </span><span class="s9">+ result</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="255" height="61" alt="image" src="Image_031.gif"/></span></p><p class="s186" style="padding-top: 9pt;padding-left: 137pt;text-indent: 0pt;text-align: left;">b.e</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 5pt;padding-left: 153pt;text-indent: -45pt;line-height: 135%;text-align: left;"><span>Figure 7.2 - Partial application may let you first provide some parameters,<br/>and then provide the rest, to finally get the result</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: left;"><span>Doing partial application with arrow functions, however, is much simpler. With the example we<br/>mentioned previously, we would have something like the following code. In this case, we will assume<br/>we want to fix the second parameter to 2 2 and the fifth parameter to 196 0:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: -12pt;line-height: 144%;text-align: left;"><span>const nonsense = (a, b, c, d,<br/>&#39;${a}/${b}/${c}/${d}/${e}&#39;;</span></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 10pt;text-align: left;">const fix2and5 = (a, c, d) =&gt;</p><p style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">e) =&gt;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">nonsense(a, 22, c, d, 1960)</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Doing partial application this way is quite simple, though we may want to find a more general solution.<br/>You can set any number of parameters, by creating a new function out of the previous one but fixing<br/>some more parameters. (Wrappers, as in </span><i>Chapter 6, Producing Functions, </i>could be used.) For instance,</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 13pt;text-indent: 0pt;text-align: center;">238 Transforming Functions - Currying and Partial Application</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>you might now want to also fix the last parameter of the new fix2and5 () function to 9,as shown<br/>in the following code; there’s nothing easier:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 18pt;text-indent: 0pt;text-align: center;">const fixLast = (a, c) =&gt; fix2and5(a, c, 9);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>You might also have written nonsense (a, 22, c, 9, 19 6 0) if you wished to, but the fact<br/>remains that fixing parameters by using arrow functions is simple. Let’s now consider, as we said, a<br/>more general solution.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 53pt;text-indent: 0pt;text-align: justify;"><a name="bookmark308">Partial application with closures</a></p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>If we want to be able to do partial application fixing of any combination of parameters, we must have<br/>a way to specify which arguments are to be left free and which will be fixed from that point on. Some<br/>libraries, such as Underscore and Lodash, use a special _ object to signify an omitted parameter. In<br/>this fashion, still using the same nonsense () function, we would write the following:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;text-align: left;">const fix2and5 = .partial(nonsense)(_, 22, _, _, 1960);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: justify;"><span>We could do the same sort of thing by having a global variable that would represent a pending, not yet<br/>fixed argument, but let’s make it simpler and just use unde f ined to represent a missing parameter.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 66pt;text-indent: 0pt;text-align: left;"><a name="bookmark309">Careful comparison</a></p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;line-height: 115%;text-align: left;"><span>When checking for undefined, remember to always use the = = = operator; with ==, it<br/>happens that null ==unde fined, and you don’t want that. See developer.mozilla.<br/>org/en-US/docs/Web/JavaScript/Reference/Global_Obj ects/undefined</span></p><p style="padding-left: 65pt;text-indent: 0pt;line-height: 10pt;text-align: left;">for more on this.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 8pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>We want to write a function that will partially apply some arguments and leave the rest open for the<br/>future. We want to write code similar to the following and produce a new function in the same fashion<br/>as we did earlier with arrow functions:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 74pt;text-indent: -13pt;line-height: 143%;text-align: left;"><span>const nonsense = (a, b, c, d, e) =&gt;<br/>&#39;${a}/${b}/${c}/${d}/${e}&#39;</span><span class="s212">;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;text-align: justify;">const fix2and5 <b>= partial(nonsense)(</b></p><p style="padding-top: 4pt;padding-left: 73pt;text-indent: 0pt;line-height: 142%;text-align: justify;"><span>undefined,<br/>22 ,</span></p><p style="padding-left: 73pt;text-indent: 0pt;line-height: 143%;text-align: justify;"><span>undefined,<br/>undefined,<br/>1960</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 372pt;text-indent: 0pt;text-align: left;">Partial application  239</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// fix2and5 would become</p><p style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// (XO, X2, X3) =&gt; nonsense(XO, 22, X2, X3, 1960);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: left;">How will we do this? Our implementation will use closures. (You may want to review that topic</p><p style="padding-top: 2pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: left;">in <i>Chapter 1, Becoming Functional.&#39;) </i><span>This way of doing partial application will behave in a fashion<br/>somewhat reminiscent of currying in the sense that each function will produce a new one with some<br/>more fixed parameters. Our new implementation would be as follows - and once again, let’s start<br/>with plain JavaScript:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// partial.js</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 64pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>function partial(fn) {<br/>const partialize =</span></p><p style="padding-left: 78pt;text-indent: 0pt;text-align: left;">(...argsl) =&gt;</p><p style="padding-top: 4pt;padding-left: 89pt;text-indent: -10pt;line-height: 142%;text-align: left;"><span>(...args2) =&gt; {<br/>for     (</span></p><p style="padding-left: 101pt;text-indent: 0pt;text-align: left;">let i = 0;</p><p style="padding-top: 4pt;padding-left: 101pt;text-indent: 0pt;text-align: left;">i &lt; argsl.length &amp;&amp; args2.length;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 89pt;text-indent: 0pt;text-align: left;">) {</p><p style="padding-top: 2pt;padding-left: 145pt;text-indent: -13pt;line-height: 142%;text-align: left;"><span>if (argsl [i] = = = undefined) {<br/>argsl[i] = args2.shift();</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 88pt;text-indent: 0pt;line-height: 143%;text-align: left;"><span>const allParams = [...argsl, .,.args2];<br/>return allParams.includes(undefined)</span></p><p style="padding-left: 100pt;text-indent: 0pt;line-height: 10pt;text-align: left;">allParams.length &lt; fn.length</p><p style="padding-top: 4pt;padding-left: 101pt;text-indent: 0pt;text-align: left;">? partialize(...allParams)</p><p style="padding-top: 4pt;padding-left: 102pt;text-indent: 0pt;text-align: left;">: fn(...allParams);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 65pt;text-indent: 0pt;text-align: left;">return partialize();</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>Wow—a longish bit of code! The key is the inner partialize () function. Given a list of parameters<br/>(argsl), it produces a function that receives a second list of parameters (args2):</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 70pt;text-indent: 0pt;text-align: left;">First, it replaces all possible undefined values in argsl with values from args 2</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 20pt;text-indent: 0pt;text-align: left;">240 Transforming Functions - Currying and Partial Application</p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l87"><li data-list-text="•"><p class="s33" style="padding-left: 79pt;text-indent: -13pt;line-height: 123%;text-align: left;">	<span class="p">Then, if any parameters are left in args2, it also appends them to those of argsl,<br/>producing allParams</span></p></li><li data-list-text="•"><p class="s33" style="padding-top: 5pt;padding-left: 79pt;text-indent: -12pt;line-height: 123%;text-align: left;">	<span class="p">Finally, if all Params does not include any more undefined, values and is sufficiently long,<br/>it calls the original function</span></p></li><li data-list-text="•"><p style="padding-top: 6pt;padding-left: 79pt;text-indent: -13pt;text-align: left;">Otherwise, it partializes itself to wait for more parameters</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>An example will make it more clear. Let’s go back to our trusty make 3 () function and construct a<br/>partial version of it:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 74pt;text-indent: -13pt;line-height: 144%;text-align: left;"><span>const make3 = (a: string, b: number, c: string): string =&gt;<br/>&#39;${a}:${b}:${c}&#39;;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;text-align: left;">const fO <b>= partial(make3);</b></p><p style="padding-top: 4pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">const fl = <b>fO(undefined, 2);</b></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: -9pt;line-height: 225%;text-align: justify;"><span>Thefl() function gets [undefined, 2] as parameters. Now, let’s create a new function:<br/>const f2 </span><b>= fl(&quot;A&quot;);</b></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>What happens? The previous list of parameters ([undefined, 2]) gets merged with the new list<br/>(a single element—in this case, [&quot;A&quot; ]), producing a function that now receives &quot;A&quot; and 2 as its first<br/>two arguments. However, this isn’t yet ready, because the original function requires three arguments.<br/>We can write the following:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;text-align: left;">const f3 <b>= f2(&quot;Z&quot;);</b></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Then, the current list of arguments would be merged with the new argument, producing [&quot; A&quot;, 2 , &quot; Z &quot; ].<br/>Since the list is now complete, the original function will be evaluated, producing &quot; A: 2 : Z &quot; as the<br/>final result.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>There are significant similarities between the structure of this code and the other higher-order function<br/>we wrote earlier in the </span><i>Currying with bind() </i>section:</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="•"><p style="padding-left: 79pt;text-indent: -13pt;text-align: left;">If all the arguments have been provided, the original function is called</p></li><li data-list-text="•"><p class="s33" style="padding-top: 8pt;padding-left: 79pt;text-indent: -12pt;line-height: 123%;text-align: justify;">	<span class="p">Otherwise, if some arguments are still required (when currying, it’s just a matter of counting<br/>arguments by checking the function’s length property; when doing partial application,<br/>you must also consider the possibility of having some undefined parameters), the higher-<br/>order function calls itself to produce a new version of the function, which will wait for the<br/>missing arguments</span></p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: justify;">Let’s get now to a TypeScript version with its data typing.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 12pt;padding-left: 372pt;text-indent: 0pt;text-align: left;">Partial application  241</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s34" style="padding-top: 8pt;padding-left: 43pt;text-indent: 0pt;text-align: justify;">Partial data types</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>We’ll use an auxiliary type, Partialize&lt;P, A&gt;. If P is the tuple of the parameter types for the<br/>function, and A is the tuple of the argument types for a function call, Partializeo will return a<br/>tuple with the types in P for which there is an undefined type in A:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// partial.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">type Partialize&lt;</p><p style="padding-top: 4pt;padding-left: 64pt;text-indent: 0pt;line-height: 141%;text-align: left;"><span>P extends any [] ,<br/>A extends any[]</span></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">&gt; = 0 extends P [&quot;length&quot;]</p><p style="padding-top: 5pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">? []</p><p style="padding-top: 3pt;padding-left: 66pt;text-indent: 0pt;text-align: left;">: 0 extends A[&quot;length&quot;]</p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">? P</p><p style="padding-top: 4pt;padding-left: 66pt;text-indent: 0pt;text-align: left;">: [P, A] extends [</p><p style="padding-top: 4pt;padding-left: 91pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>[infer PH, ...infer PT],<br/>[infer AH, ...infer AT]</span></p><p style="padding-left: 77pt;text-indent: 0pt;text-align: left;">]</p><p style="padding-top: 3pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">? AH extends undefined</p><p style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">? [PH, ...Partialize&lt;PT, AT&gt;]</p><p style="padding-top: 4pt;padding-left: 78pt;text-indent: 0pt;text-align: left;">: [...Partialize&lt;PT, AT&gt;]</p><p style="padding-top: 4pt;padding-left: 66pt;text-indent: 0pt;text-align: left;">: never;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: left;">How does this work?</p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l88"><li data-list-text="•"><p style="padding-left: 70pt;text-indent: -13pt;text-align: left;">If P is empty, the output is empty as well.</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">If A is empty (there are no more arguments left), the output is P.</p></li><li data-list-text="•"><p class="s33" style="padding-top: 7pt;padding-left: 70pt;text-indent: -12pt;line-height: 124%;text-align: justify;">	<span class="p">If P is split in PH (head) and PT (tail), and A is similarly split in AH and AT, then if AH is<br/>undefined, we return a new type that includes PH (because no value was given for it)<br/>and  Partialize&lt;PT,  AT&gt;,  to  recursively  process  the  rest  of  both  tuples.  Otherwise,  if<br/>AH is not undefined, we provide a value for the corresponding parameter, so the result is<br/>Partialize&lt;PT, AT&gt;; we don’t have to care about the parameter corresponding to PH.</span></p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: left;">Using recursion makes this harder to understand; let’s see some examples:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">type pOO = Partialize&lt;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 20pt;text-indent: 0pt;text-align: left;">242  Transforming Functions - Currying and Partial Application</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 76pt;text-indent: 0pt;line-height: 146%;text-align: left;"><span>[boolean, number, string],<br/>[undefined, undefined, undefined]</span></p><p class="s10" style="padding-left: 62pt;text-indent: 0pt;line-height: 10pt;text-align: left;">&gt;; // [boolean, number, string]</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 76pt;text-indent: -14pt;line-height: 144%;text-align: left;"><span>type pOl = Partialize&lt;<br/>[boolean, number, string],</span></p><p style="padding-left: 76pt;text-indent: 0pt;line-height: 10pt;text-align: left;">[boolean, undefined, undefined]</p><ul id="l89"><li data-list-text="&gt;"><p class="s10" style="padding-top: 4pt;padding-left: 73pt;text-indent: -11pt;text-align: left;">; // [number, string]</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 76pt;text-indent: -14pt;line-height: 144%;text-align: left;"><span>type p02 = Partialize&lt;<br/>[boolean, number, string],</span></p><p style="padding-left: 76pt;text-indent: 0pt;line-height: 10pt;text-align: left;">[undefined, string, undefined]</p></li><li data-list-text="&gt;"><p class="s10" style="padding-top: 4pt;padding-left: 73pt;text-indent: -11pt;text-align: left;">; // [boolean, string]</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 76pt;text-indent: -14pt;line-height: 144%;text-align: left;"><span>type p03 = Partialize&lt;<br/>[boolean, number, string],</span></p><p style="padding-left: 76pt;text-indent: 0pt;text-align: left;">[undefined, undefined, string]</p></li><li data-list-text="&gt;"><p class="s10" style="padding-top: 4pt;padding-left: 73pt;text-indent: -11pt;text-align: left;">; // [boolean, number]</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 76pt;text-indent: -14pt;line-height: 144%;text-align: left;"><span>type p04 = Partialize&lt;<br/>[boolean, number, string],<br/>[boolean, undefined, string]</span></p></li><li data-list-text="&gt;"><p class="s10" style="padding-left: 73pt;text-indent: -11pt;line-height: 10pt;text-align: left;">; // [number]</p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">type p05 = Partialize&lt;[boolean, number, string], [boolean]&gt;;</p><p class="s10" style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">// [number, string]</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">type p06 = Partialize&lt; [boolean, number, string], []&gt;;</p><p class="s10" style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">// [boolean, number, string]</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>For instance, the p04 type shows that if you have a function that expects three parameters - boolean,<br/>number, and string - and you call it with a boolean, anundef ined value, and a string, the</span></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>partialized function will have just a number parameter. Hie p05 type shows that if you had called<br/>that function with just a boolean, the partialized function would have a number and a string</span></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">as parameters.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 372pt;text-indent: 0pt;text-align: left;">Partial application  243</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: -9pt;line-height: 23pt;text-align: left;"><span>This isn’t totally right, however. Let’s say we had written the following instead:<br/>type p04    Partialize&lt;</span></p><p style="padding-top: 4pt;padding-left: 67pt;text-indent: 0pt;text-align: left;">[boolean, number, string],</p><p class="s10" style="padding-top: 4pt;padding-left: 67pt;text-indent: 0pt;text-align: left;">[string, <span class="p">undefined, </span>number]</p><p class="s10" style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">&gt;; // [number]</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>The result would have been the same; we are checking that we have the right number of arguments,<br/>but not their types. Let’s have another auxiliary type check:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 64pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>type TypesMatch&lt;<br/>P extends any[] ,<br/>A extends any[]</span></p><p style="padding-left: 53pt;text-indent: 0pt;line-height: 10pt;text-align: left;">&gt; = 0 extends P [&quot;length&quot;]</p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">? boolean</p><p style="padding-top: 4pt;padding-left: 66pt;text-indent: 0pt;text-align: left;">: 0 extends A[&quot;length&quot;]</p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">? boolean</p><p style="padding-top: 4pt;padding-left: 66pt;text-indent: 0pt;text-align: left;">: [P, A] extends [</p><p style="padding-top: 4pt;padding-left: 91pt;text-indent: 0pt;text-align: left;">[infer PH, ...infer PT],</p><p style="padding-top: 4pt;padding-left: 91pt;text-indent: 0pt;text-align: left;"><a name="bookmark310">[infer AH, ...infer AT]?</a></p><p class="s10" style="padding-top: 5pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">]</p><p style="padding-top: 3pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">? AH extends undefined</p><p style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">? TypesMatch&lt;PT, AT&gt;</p><p style="padding-top: 4pt;padding-left: 78pt;text-indent: 0pt;text-align: left;">: PH extends AH</p><p style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">? TypesMatch&lt;PT, AT&gt;</p><p style="padding-top: 4pt;padding-left: 78pt;text-indent: 0pt;text-align: left;">: never</p><p style="padding-top: 4pt;padding-left: 66pt;text-indent: 0pt;text-align: left;">: never;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: left;">TypesMatch gets two lists of types, P and A:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l90"><li data-list-text="•"><p style="padding-left: 70pt;text-indent: -13pt;text-align: left;">If any of the lists is empty, that’s OK.</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;line-height: 123%;text-align: left;"><span>If both lists are not empty, it splits them in head and tail as PH and PT, and AH and AT. If AH<br/>is undefined, or if it matches PH, then TypesMatch&lt; &gt; keeps going to analyze both tails.</span></p></li><li data-list-text="•"><p style="padding-top: 5pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">If AH isn’t undefined but doesn’t match PH, never (which implies an error) is generated.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 20pt;text-indent: 0pt;text-align: left;">244  Transforming Functions - Currying and Partial Application</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">We can now write the Parti al &lt;&gt; generic type using this auxiliary definition:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">type Partial&lt;P extends any[], R&gt; = &lt;A extends any[]&gt;(</p><p style="padding-top: 4pt;padding-left: 75pt;text-indent: 0pt;text-align: left;">...x: A</p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">) =&gt; TypesMatch&lt;P, A&gt; extends never</p><p style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">? never</p><p style="padding-top: 4pt;padding-left: 75pt;text-indent: 0pt;text-align: left;">: P extends any[]</p><p style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">? 0 extends Partialize&lt;P, A&gt;[&quot;length&quot;]</p><p style="padding-top: 4pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">? (...x: [...P]) =&gt; R</p><p style="padding-top: 4pt;padding-left: 87pt;text-indent: 0pt;text-align: left;">: Partial&lt;Partialize&lt;P, A&gt;, R&gt;</p><p style="padding-top: 4pt;padding-left: 75pt;text-indent: 0pt;text-align: left;">: never;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>Here, P stands for the types of the function’s parameters, R for its result type, and A for the types of<br/>the function’s arguments. We first check whether P and A match types. If so, if Partialize&lt;P, A&gt;</span></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>is empty, we return a ( . . . x : [ . . . P] ) =&gt; R function; otherwise, we (recursively) return a<br/>function with Partialize&lt;P, A&gt; parameter types.</span></p><p style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">Finally, we have all we need for our TypeScript version of partial ():</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s9" style="padding-left: 62pt;text-indent: 0pt;text-align: left;">11 <span class="p">continued. . .</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-top: 7pt;padding-left: 74pt;text-indent: -12pt;line-height: 146%;text-align: left;"><span>function   partial&lt;P   extends   any[],   R&gt;(<br/>fn: (...a: P) =&gt; R</span></p><p class="s10" style="padding-left: 62pt;text-indent: 0pt;line-height: 10pt;text-align: left;">) : Partial&lt;P, R&gt;;</p><p class="s10" style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">function   partial(fn:   (...a:   any)   =&gt;   any)   {</p><p style="padding-top: 4pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">const partialize =</p><p style="padding-top: 4pt;padding-left: 88pt;text-indent: 0pt;text-align: left;">( . . . argsl: any [] ) =&gt;</p><p style="padding-top: 4pt;padding-left: 98pt;text-indent: -10pt;line-height: 144%;text-align: left;"><span>( . . . args2 : any [] ) =&gt; {<br/>for                (</span></p><p style="padding-left: 110pt;text-indent: 0pt;line-height: 10pt;text-align: left;">let i = 0;</p><p style="padding-top: 4pt;padding-left: 110pt;text-indent: 0pt;line-height: 142%;text-align: left;"><span>i &lt; argsl.length &amp;&amp; args2.length;<br/>i++</span></p><p style="padding-top: 2pt;padding-left: 98pt;text-indent: 0pt;text-align: left;">) {</p><p style="padding-top: 2pt;padding-left: 152pt;text-indent: -7pt;line-height: 141%;text-align: left;"><span>if (argsl[i] === undefined) {<br/>argsl [i] = args2.shift() ;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 372pt;text-indent: 0pt;text-align: left;">Partial application  245</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 89pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>const allParams = [...argsl, .,.args2];<br/>return allParams.includes(undefined)</span></p><p style="padding-left: 100pt;text-indent: 0pt;line-height: 10pt;text-align: left;">allParams.length &lt; fn.length</p><p style="padding-top: 4pt;padding-left: 101pt;text-indent: 0pt;text-align: left;">? partialize(...allParams)</p><p style="padding-top: 4pt;padding-left: 64pt;text-indent: 37pt;line-height: 287%;text-align: left;"><span>: fn(...allParams);<br/>return partialize();</span></p><p style="padding-top: 8pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: left;"><span>It’s worth noting that, as in the currying examples, we use several any types because TypeScript isn’t<br/>really very good at working with recursion. This implies that we must be extra careful with our code<br/>because there will be no way of detecting errors.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s34" style="padding-left: 43pt;text-indent: 0pt;text-align: left;">Partial testing</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: left;">Let’s finish this section by writing some tests. Here are some things we should consider:</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="•"><p style="padding-left: 70pt;text-indent: -13pt;text-align: left;">When we do partial application, the arity of the produced function should decrease</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">The original function should be called when arguments are in the correct order</p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: left;"><span>We could write something like the following, allowing the fixing of arguments in different places.<br/>Instead of using a spy or mock, we can directly work with the nonsense () function we had because<br/>it’s quite efficient:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// partial.test.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 64pt;text-indent: -11pt;line-height: 144%;text-align: justify;"><span>function nonsense(<br/>a: number,</span></p><p style="padding-left: 64pt;text-indent: 0pt;line-height: 143%;text-align: justify;"><span>b: number,<br/>C: number,<br/>d: number,<br/>e: number</span></p><p style="padding-top: 2pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">) {</p><p style="padding-top: 2pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">return &#39;${a}/${b}/${c}/${d}/${e}&#39;;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 65pt;text-indent: -12pt;line-height: 143%;text-align: left;"><span>describe(&quot;with partial()&quot;, function () {<br/>it(&quot;you could fix no arguments&quot;, () =&gt; {</span></p><p style="padding-left: 76pt;text-indent: 0pt;text-align: left;">const nonsensePCO = partial(nonsense);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 13pt;text-indent: 0pt;text-align: center;">246 Transforming Functions - Currying and Partial Application</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 85pt;text-indent: 0pt;text-align: left;">expect(nonsensePCO(0, 1, 2, 3, 4)).toBe(</p><p style="padding-top: 4pt;padding-left: 51pt;text-indent: 0pt;text-align: center;">nonsense(0, 1, 2, 3, 4)</p><p style="padding-top: 5pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">) ;</p><p style="padding-top: 5pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">});</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 85pt;text-indent: -11pt;line-height: 143%;text-align: left;"><span>it(&quot;you could fix only some initial arguments&quot;, () =&gt; {<br/>const nonsensePCl = partial(nonsense)(1, 2, 3);</span></p><p style="padding-left: 85pt;text-indent: 0pt;line-height: 10pt;text-align: left;">expect(nonsensePCl(4, 5)).toBe(nonsense(1, 2, 3, 4,</p><p style="padding-top: 5pt;padding-left: 98pt;text-indent: 0pt;text-align: left;">5) ) ;</p><p style="padding-top: 5pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">});</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 5pt;padding-left: 85pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>it(&quot;you could skip some arguments&quot;, () =&gt; {<br/>const nonsensePC2 = partial(nonsense)(</span></p><p style="padding-left: 97pt;text-indent: 0pt;line-height: 143%;text-align: left;"><span>undefined,<br/>22 ,</span></p><p style="padding-left: 97pt;text-indent: 0pt;text-align: left;">undefined,</p><p class="s24" style="padding-top: 4pt;padding-left: 97pt;text-indent: 0pt;text-align: left;">44</p><p style="padding-top: 4pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">) ;</p><p style="padding-top: 3pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">expect(nonsensePC2(11, 33, 55)).toBe(</p><p style="padding-top: 4pt;padding-left: 97pt;text-indent: 0pt;text-align: left;">nonsense(ll, 22, 33, 44, 55)</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 75pt;text-indent: 0pt;text-align: left;">});</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 5pt;padding-left: 85pt;text-indent: -11pt;line-height: 142%;text-align: justify;"><span>it(&quot;you could fix only some last arguments&quot;, () =&gt; {<br/>const nonsensePC3 = partial(nonsense)(</span></p><p style="padding-left: 97pt;text-indent: 0pt;line-height: 143%;text-align: justify;"><span>undefined,<br/>undefined,<br/>undefined,<br/>444          ,</span></p><p style="padding-left: 98pt;text-indent: 0pt;text-align: left;">555</p><p style="padding-top: 5pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">) ;</p><p style="padding-top: 3pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">expect(nonsensePC3(111, 222, 333)).toBe(</p><p style="padding-top: 4pt;padding-left: 97pt;text-indent: 0pt;text-align: left;">nonsense(111, 222, 333, 444, 555)</p><p style="padding-top: 5pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">) ;</p><p style="padding-top: 5pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">});</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 12pt;padding-left: 382pt;text-indent: 0pt;text-align: left;">Partial currying  247</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 65pt;text-indent: 0pt;text-align: left;">it(&quot;you could fix ALL the arguments&quot;, () =&gt; {</p><p style="padding-top: 4pt;padding-left: 76pt;text-indent: 0pt;text-align: left;">const nonsensePC4 = partial(nonsense)(6, 7, 8, 9, 0);</p><p style="padding-top: 4pt;padding-left: 76pt;text-indent: 0pt;text-align: left;">expect(nonsensePC4).toBe(nonsense(6, 7, 8, 9, 0) ) ;</p><p style="padding-top: 6pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">});</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 5pt;padding-left: 76pt;text-indent: -11pt;line-height: 143%;text-align: left;"><span>it(&quot;you could work in steps - (a)&quot;, () =&gt; {<br/>const nonsensePC5 = partial(nonsense);</span></p><p style="padding-left: 77pt;text-indent: 0pt;line-height: 142%;text-align: left;"><span>const nn  = nonsensePC5(undefined,     2, 3);<br/>const   oo  = nn(undefined, undefined, 5);</span></p><p style="padding-left: 76pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>const  pp = oo(l, undefined);<br/>const  qq = pp(4);<br/>expect(qq).toBe(nonsense(1, 2, 3, 4, 5));</span></p><p style="padding-left: 65pt;text-indent: 0pt;line-height: 11pt;text-align: left;"><span><img width="20" height="15" alt="image" src="Image_032.gif"/></span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 6pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">it(&quot;you could work in steps - (b)&quot;, () =&gt; {</p><p style="padding-top: 4pt;padding-left: 88pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>const nonsensePCS = partial(nonsense)(undefined, 2, 3)(<br/>undefined,</span></p><p style="padding-left: 89pt;text-indent: 0pt;line-height: 142%;text-align: left;"><span>undefined,<br/>5</span></p><p style="padding-top: 1pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">) (</p><p style="padding-top: 3pt;padding-left: 89pt;text-indent: 0pt;text-align: left;">1,</p><p style="padding-top: 4pt;padding-left: 88pt;text-indent: 0pt;text-align: left;">undefined</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: right;">});</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;">});</p><p style="padding-top: 4pt;text-indent: 0pt;text-align: left;">) (4);</p><p style="padding-top: 4pt;text-indent: 0pt;text-align: left;">expect(nonsensePC6).toBe(nonsense(1, 2, 3, 4, 5));</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>We have now seen currying and partial application; let’s see our third and last transformation, a hybrid<br/>of                                                                                               our previous ones.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-left: 44pt;text-indent: 0pt;text-align: justify;"><a name="bookmark311">Partial currying</a></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>The last transformation we will look at is a mixture of currying and partial application. If you google<br/>it, in some places, you will find it called currying, and in others, partial application, but as it happens,<br/>it fits neither, so I’m sitting on the fence and calling it </span><i>partial currying&#39;.</i></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 121%;text-align: justify;"><span>Given a function, the idea is to fix its first few arguments and produce a new function that will receive<br/>the rest of them. However, if that new function is given fewer arguments, it will fix whatever it was</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 20pt;text-indent: 0pt;text-align: left;">248 Transforming Functions - Currying and Partial Application</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>given and produce a newer function to receive the rest of them, until all the arguments are given and<br/>the final result can be calculated. See </span><i>Figure 7.3:</i></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="249" height="171" alt="image" src="Image_033.gif"/></span></p><p class="s190" style="padding-left: 350pt;text-indent: 0pt;text-align: left;">result</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s190" style="padding-top: 6pt;padding-left: 350pt;text-indent: 0pt;text-align: left;">result</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 6pt;padding-left: 86pt;text-indent: -25pt;line-height: 135%;text-align: left;"><span>Figure 7.3 - Partial currying is a mixture of currying and partial application. You may provide arguments<br/>from the left, in any quantity, until all have been provided, and then the result is calculated</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: justify;"><span>To look at an example, let’s go back to the nonsense () function we have been using in previous<br/>sections, as follows. Assume we already have a partialCurry () function:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: right;">const nonsense = (a, b, c, d, e) =&gt;</p><p style="padding-top: 4pt;text-indent: 0pt;text-align: right;">${a}/${b}/${c}/${d}/${e}&#39;;</p><p style="padding-left: 61pt;text-indent: 0pt;line-height: 30pt;text-align: left;"><span>const pcNonsense = partialCurry(nonsense);<br/>const fixlAnd2 </span><b>= pcNonsense(9, 22);</b></p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">// fixlAnd2 is now a ternary function</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">const fix3 = <b>f ixlAnd.2 (60) ;</b></p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">// fix3 is a binary function</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">const fix4and5 = <b>fix3(12, 4);</b></p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">// fix4and5 === nonsense(9,22,60,12,4), &quot;9/22/60/12/4&quot;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>The original function had an arity of 5. When we partially curry that function and give it arguments<br/>of 9 and 2 2, it becomes a ternary function, because out of the original five parameters, two have<br/>become fixed. If we take that ternary function and give it a single argument, (60), the result is yet<br/>another function: in this case, a binary one, because now we have fixed the first three of the original five<br/>parameters. The final call, providing the last two arguments, then does the job of actually calculating<br/>the desired result.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 382pt;text-indent: 0pt;text-align: left;">Partial currying  249</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>There are some points in common with currying and partial application, but also some differences,<br/>as follows:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l91"><li data-list-text="•"><p style="padding-left: 70pt;text-indent: -13pt;line-height: 123%;text-align: justify;"><span>The original function is transformed into a series of functions, each producing the next one<br/>until the last in the series actually carries out its calculations.</span></p></li><li data-list-text="•"><p style="padding-top: 5pt;padding-left: 70pt;text-indent: -12pt;line-height: 125%;text-align: justify;"><span>You always provide parameters starting from the first one (the leftmost one), as in currying,<br/>but you can provide more than one, as in partial application.</span></p></li><li data-list-text="•"><p style="padding-top: 5pt;padding-left: 70pt;text-indent: -13pt;line-height: 124%;text-align: justify;"><span>When currying a function, all the intermediate functions are unary, but with partial currying,<br/>that need not be so. However, if in each instance we were to provide a single argument, then<br/>the result would require as many steps as plain currying.</span></p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>So, we have our definition—let’s now see how we can implement our new higher-order function; we’ll<br/>probably be reusing a few concepts from the previous sections in this chapter.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 44pt;text-indent: 0pt;text-align: left;"><a name="bookmark312">Partial currying with bind()</a></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Similar to what we did with currying, there’s a simple way to do partial currying. We will take advantage<br/>of the fact that bind () can actually fix many arguments at once, and we’ll look at JavaScript code<br/>first for clarity:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// partialCurry.js</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 65pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>function partialCurry(fn) {<br/>return fn.length === 0</span></p><p style="padding-left: 77pt;text-indent: 0pt;text-align: left;">? fn()</p><p class="s10" style="padding-top: 4pt;padding-left: 78pt;text-indent: 0pt;text-align: left;">: (...x) <span class="p">=&gt; partialCurry(fn.bind(null, ..</span>,x));</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: -9pt;line-height: 23pt;text-align: left;"><span>Compare the code to the previous curry () function and you’ll see the main, but very small, differences:<br/>function curry(fn) {</span></p><p style="padding-top: 4pt;padding-left: 64pt;text-indent: 0pt;text-align: left;">return fn.length === 0</p><p style="padding-top: 5pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">? fn()</p><p class="s10" style="padding-top: 4pt;padding-left: 78pt;text-indent: 0pt;text-align: left;">: (x) = &gt; <span class="p">curry(fn.bind(null, </span>x));</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>The mechanism is exactly the same. The only difference is that in our new function, we can bind many<br/>arguments simultaneously, while in curry (), we always bind just one.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>In a sense, the TypeScript version is akin to the one for partial (). The provided arguments must<br/>match the types of the original function parameters, so we’ll use again our TypesMatch&lt; &gt; type</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 20pt;text-indent: 0pt;text-align: left;">250 Transforming Functions - Currying and Partial Application</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>from the previous section. If the original function had several parameters, and we provide a few of<br/>them, we need to figure out the rest - our Minus&lt; &gt; type will do that:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// partialCurry.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;text-indent: 0pt;text-align: right;">type Minus&lt;X, Y&gt;</p><p style="padding-top: 4pt;text-indent: 0pt;text-align: right;">[any, ...infer</p><p style="padding-top: 4pt;text-indent: 0pt;text-align: right;">[any, ...infer</p><p style="padding-top: 4pt;padding-left: 4pt;text-indent: 0pt;line-height: 142%;text-align: left;"><span>= [X, Y] extends [<br/>XT] ,</span></p><p style="padding-left: 4pt;text-indent: 0pt;text-align: left;">YT]</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">? Minus&lt;XT, YT&gt;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>Basically, if both types have more than one element, we ignore the first ones and process the tails<br/>of both types; otherwise, we return the first. With this, we can write the Partial Cur ryo type:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// partialCurry.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">type PartialCurry&lt;P extends any[], R&gt; = &lt;A extends any[]&gt;(</p><p style="padding-top: 4pt;padding-left: 75pt;text-indent: 0pt;text-align: left;">...x: A</p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">)  =&gt;  TypesMatch&lt;P,  A&gt;  extends  never</p><p style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">? never</p><p style="padding-top: 4pt;padding-left: 75pt;text-indent: 0pt;text-align: left;">: P extends any[]</p><p style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">?   A[&quot;length&quot;]   extends   P   [&quot;length&quot;]</p><p style="padding-top: 4pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">? R</p><p style="padding-top: 4pt;padding-left: 87pt;text-indent: 0pt;text-align: left;">: PartialCurry&lt;Minus&lt;P, A&gt;, R&gt;</p><p style="padding-top: 4pt;padding-left: 75pt;text-indent: 0pt;text-align: left;">: never;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>If types don’t match (a wrong type argument was provided), the result is an error, never. Otherwise,<br/>if we’ve provided enough arguments, the original R result type will be produced; if not, we’ll produce<br/>a new function with fewer parameters by recursion and using Minus&lt; &gt;.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>We can revisit our earlier example with the make 3 () function, and the only difference is that we can<br/>get results in fewer steps - or more, as in the little sensical h7 example!</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;text-align: left;">const hl = partialCurryByBind(make3);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">const h2 = hl(&quot;A&quot;);</p><p style="padding-top: 4pt;padding-left: 61pt;text-indent: 0pt;line-height: 142%;text-align: left;"><span>const h3 = h2(2, &quot;Z&quot;);<br/>console.log(h3); </span><b>// A:2:Z</b></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 382pt;text-indent: 0pt;text-align: left;">Partial currying  251</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>const h5 = hl(&quot;BE&quot;, 4) ;<br/>const h6 = h5(&quot;Y0U&quot;);</span></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">console.log(h6); <b>// BE:4:YOU</b></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 139%;text-align: left;"><span>const h7 = h5 ()()()( &quot;ME&quot;) ;<br/>console.log(h7); </span><b>// B:4:ME</b></p><p style="padding-top: 8pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>By the way, and just to be aware of the existing possibilities, you can fix some parameters when<br/>currying, as shown here:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;line-height: 141%;text-align: left;"><span>const h8 = partialCurryByBind(make3) (&quot;I&quot;,8);<br/>const h9 = h8(&quot;SOME&quot;);</span></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">console . log (h.9) ; <b>// I:8:SOME</b></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: left;"><span>Testing this function is easy, and the examples we provided are a very good starting point. Note, however,<br/>that since we allow fixing any number of arguments, we cannot test the arity of the intermediate<br/>functions. Our tests could be as follows, then:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// partialCurry.test.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 65pt;text-indent: -12pt;line-height: 143%;text-align: left;"><span>describe(&quot;with partialCurryByBind&quot;, function () {<br/>it(&quot;you could fix arguments in several steps&quot;, () =&gt; {</span></p><p style="padding-left: 76pt;text-indent: 0pt;line-height: 142%;text-align: left;"><span>const make3a = partialCurryByBind(make3);<br/>const make3b = make3a(&quot;MAKE&quot;, 1) ;</span></p><p style="padding-left: 76pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>const make3c = make3b(&quot;TRY&quot;);<br/>expect(make3c).toBe(make3(&quot;MAKE&quot;, 1, &quot;TRY&quot;));</span></p><p style="padding-top: 2pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">});</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 5pt;padding-left: 76pt;text-indent: -11pt;line-height: 143%;text-align: left;"><span>it(&quot;you could fix arguments in a single step&quot;, () =&gt; {<br/>const make3a = partialCurryByBind(make3);<br/>const make3b = make3a(&quot;SET&quot;, 2, &quot;IT&quot;);<br/>expect(make3b).toBe(make3(&quot;SET&quot;, 2, &quot;IT&quot;));</span></p><p style="padding-top: 2pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">});</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 5pt;padding-left: 76pt;text-indent: -11pt;line-height: 142%;text-align: left;"><span>it(&quot;you could fix ALL the arguments&quot;, () =&gt; {<br/>const make3all = partialCurryByBind(make3);</span></p><p style="padding-left: 76pt;text-indent: 0pt;text-align: left;">expect(make3all(&quot;SOME&quot;, 1, &quot;KNOWS&quot;)).toBe(</p><p style="padding-top: 4pt;padding-left: 88pt;text-indent: 0pt;text-align: left;">make3(&quot;SOME&quot;, 1, &quot;KNOWS&quot;)</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 20pt;text-indent: 0pt;text-align: left;">252  Transforming Functions - Currying and Partial Application</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 75pt;text-indent: 0pt;text-align: left;">});</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 85pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>it(&quot;you could fix one argument at a time&quot;, () =&gt; {<br/>const make3one =</span></p><p style="padding-left: 85pt;text-indent: 11pt;line-height: 141%;text-align: left;"><span>partialCurryByBind(make3)(&quot;READY&quot;)(2)(&quot;GO&quot;);<br/>expect(make3one).toBe(make3(&quot;READY&quot;,      2,      &quot;GO&quot;));</span></p><p style="padding-top: 2pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">});</p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;"><a name="bookmark313">});</a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-top: 5pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">Partial currying with closures</p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>As with partial application, there’s a solution that works with closures. Since we have gone over many<br/>of the required details, let’s jump directly into the code, the JavaScript version first:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// partialCurry.js</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 73pt;text-indent: -12pt;line-height: 142%;text-align: left;"><span>const partialCurryByClosure = (fn) =&gt; {<br/>const curryize =</span></p><p style="padding-left: 88pt;text-indent: 0pt;text-align: left;">( . . .argsl) =&gt;</p><p style="padding-top: 4pt;padding-left: 88pt;text-indent: 0pt;text-align: left;">(...args2) =&gt; {</p><p style="padding-top: 4pt;padding-left: 97pt;text-indent: 0pt;line-height: 141%;text-align: left;"><span>const allParams = [...argsl, ..,args2];<br/>return allParams.length &lt; fn.length</span></p><p style="padding-left: 110pt;text-indent: 0pt;text-align: left;">? curryize(...allParams)</p><p style="padding-top: 4pt;padding-left: 111pt;text-indent: 0pt;text-align: left;">: fn(...allParams);</p><p style="padding-top: 6pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">};</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">return curryize();</p><p style="padding-top: 6pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">};</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>If  you  compare  partialCurryByClosure  ()  and  partial  (),  the  main  difference  is  that  with<br/>partial currying, since we are always providing arguments from the left and there is no way to skip<br/>some, you concatenate whatever arguments you had with the new ones, and check whether you got<br/>enough. If the new list of arguments has reached the expected arity of the original function, you can call<br/>it and get the final result. In other cases, you just use curryize () (in partial (), we had a similar<br/>part ial i ze () function) to get a new intermediate function, which will wait for more arguments.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>With TypeScript, we don’t need any new types since the function just works (internally) in a different<br/>way, but produces the same results:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 385pt;text-indent: 0pt;text-align: left;">Final thoughts  253</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// partialCurry.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-top: 7pt;padding-left: 65pt;text-indent: -12pt;line-height: 143%;text-align: left;"><span>function partialByClosure&lt;P extends any[], R&gt;(<br/>fn: (...a: P) =&gt; R</span></p><p class="s10" style="padding-left: 53pt;text-indent: 0pt;text-align: left;">): PartialCurry&lt;P, R&gt;;</p><p class="s10" style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">function partialByClosure(fn: (...a: any) =&gt; any) {</p><p style="padding-top: 4pt;padding-left: 64pt;text-indent: 0pt;text-align: left;">const curryize =</p><p style="padding-top: 4pt;padding-left: 78pt;text-indent: 0pt;text-align: left;">(. . . argsl: any [] ) =&gt;</p><p style="padding-top: 4pt;padding-left: 78pt;text-indent: 0pt;text-align: left;">(...args2: any[]) =&gt; {</p><p style="padding-top: 4pt;padding-left: 89pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>const allParams = [...argsl, .,.args2];<br/>return allParams.length &lt; fn.length</span></p><p style="padding-left: 101pt;text-indent: 0pt;line-height: 10pt;text-align: left;">? curryize(...allParams)</p><p style="padding-top: 4pt;padding-left: 102pt;text-indent: 0pt;text-align: left;">: fn(...allParams);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 65pt;text-indent: 0pt;text-align: left;">return curryize();</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>The results are exactly the same as in the previous section, so its not worth repeating them. You can change<br/>the  tests  we  wrote  to  use  partialCurryByClosure  ()  instead  of  partialCurryByBind  (),<br/>and they will work.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-left: 44pt;text-indent: 0pt;text-align: justify;"><a name="bookmark314">Final thoughts</a></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Let’s finish this chapter with some short topics. First, we should consider how we’d apply the methods<br/>in this chapter to a function with a variable number of parameters - not a trivial point, as all the code<br/>we’ve seen strongly depends on the function’s arity.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Then we’ll finish with two more philosophical considerations regarding currying and partial application,<br/>which may cause a bit of a discussion:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l92"><li data-list-text="•"><p class="s33" style="padding-left: 70pt;text-indent: -13pt;line-height: 123%;text-align: left;">	<span class="p">First, many libraries are just wrong about the order of their parameters, making them harder<br/>to use</span></p></li><li data-list-text="•"><p class="s33" style="padding-top: 5pt;padding-left: 70pt;text-indent: -13pt;line-height: 123%;text-align: left;">	<span class="p">Second, I don’t usually even use the higher-order functions in this chapter, going for simpler<br/>JavaScript code</span></p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>That’s probably not what you were expecting at this time, so let’s first solve the problem with the<br/>functions with an unknown number of parameters, and then go over the last two points in more<br/>detail, so you’ll see it’s not a matter of </span><i>do as I say, not as I do... </i>or as the libraries do!</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 20pt;text-indent: 0pt;text-align: left;">254 Transforming Functions - Currying and Partial Application</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;text-align: justify;"><a name="bookmark315">Variable number of parameters</a></p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>How can we work with functions that allow for a variable (possibly undefined, indeterminate) number of<br/>parameters? This is a problem because all the code we developed in the chapter depends on fn. length,<br/>the arity of the function to be processed. You could want to curry the reduce () function, but you’d<br/>find that its arity is 1, so the curried function would not accept a second argument. Another case: you<br/>could have a sumAll () function as follows, and you’d want to apply partial () to it and get a<br/>function with, say, three parameters, but sumAll. length is 0 because all its parameters are optional:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 73pt;text-indent: -12pt;line-height: 143%;text-align: left;"><span>const sumAll = (...args: number[]): number =&gt;<br/>args. reduce ( (x, y) =&gt; x + y, 0) ;</span></p><p style="padding-top: 8pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>In the two previous editions of this book, I added an extra parameter to curry () and the rest so I<br/>could override the length attribute of the input function:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;text-align: left;">const  curry  =  (fn,  <b>len  =  fn.length)  =&gt;</b></p><p style="padding-top: 4pt;text-indent: 0pt;text-align: right;">len === 0</p><p style="padding-top: 4pt;text-indent: 0pt;text-align: right;">? fn()</p><p style="padding-top: 4pt;padding-left: 87pt;text-indent: 0pt;text-align: left;">: (p) =&gt; curry(fn.bind(null, p), <b>len - 1);</b></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: left;"><span>However, currently, I don’t think this is best. First, TypeScript cannot understand how many arguments<br/>the function will have, and that’s not very good. And, second, we don’t really need this! Given the<br/>functions that we saw in the </span><i>Arity changing </i><span>section of the previous chapter, if you have an f n ()<br/>function  that you want to curry for just two parameters, you can do curry (binary (f n) ) - and</span></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 10pt;text-align: left;">that solves the issue!</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>I think combining functions is a better solution than twiddling with already good implementations,<br/>so from now on, I’m recommending this new approach. Check the </span><i>Being functional </i><span>section later in<br/>this chapter for more examples of this usage.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 53pt;text-indent: 0pt;text-align: justify;"><a name="bookmark316">Parameter order</a></p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>There’s a problem that’s common to not only functions such as Underscore’s or Lodash’s _. map (list,<br/>mappingFunction) orreduce(list, reducingFunction, initialvalue)</span></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: left;"><span>but also to some that we have produced in this book, such as the result of demethodize (), for<br/>example. (See the </span><i>Demethodizing - turning methods into functions </i>section of <i>Chapter 6, Producing</i><span>to review that higher-order function.) The problem is that the order of their parameters<br/>doesn’t really help with currying.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>When currying a function, you will probably want to store intermediate results. When we do something<br/>as in the code that follows, we assume that you are going to reuse the curried function with the fixed<br/>argument, and that means that the first argument to the original function is the least likely to change.</span></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">Let’s now consider a specific case. Answer this question: what’s more likely—that you’ll use map () to</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 385pt;text-indent: 0pt;text-align: left;">Final thoughts  255</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>apply the same function to several different arrays or that you’ll apply several different functions to the<br/>same array? With validations or transformations, the former is more likely, but that’s not what we get!</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: -9pt;line-height: 220%;text-align: left;"><a name="bookmark317"><span>We can write a simple function to flip the parameters for a binary function, as shown here:<br/>const flip2 = fn =&gt; </span></a><b>(pl, p2) =&gt; fn(p2, pl);</b></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: justify;">With this, you could then write code as follows:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 143%;text-align: left;"><a name="bookmark318">const myMap = curry(</a><b>flip2(demethodize(map)));</b>const makeString = (v) =&gt; String(v) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;line-height: 146%;text-align: left;"><span>const stringify = myMap(makeString);<br/>let x = stringify(anArray);</span></p><p style="padding-left: 53pt;text-indent: 0pt;line-height: 10pt;text-align: left;">let y = stringify(anotherArray);</p><p style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">let z = stringify(yetAnotherArray);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>The most common use case is that you’ll want to apply the function to several different lists; neither<br/>the library functions nor our own de-methodized ones provide that. However, by using f lip2 (),<br/>we can work in the fashion we prefer.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>(Yes, in this particular case, we might have solved our problem by using partial application instead<br/>of currying; with that, we could fix the second argument to map () without any further bother.<br/>However, flipping arguments to produce new functions that have a different order of parameters is<br/>also  an often-used technique, and you must be aware of it.)</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: justify;"><span>For situations such as with reduce (), which usually receives three arguments (the list, the function,<br/>and the initial value), we may opt for this:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;"><a name="bookmark319">const flip3 = (fn) =&gt; </a><b>(pl, p2, p3) =&gt; fn(p2, p3, pl);</b></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">const myReduce = partialCurry(</p><p class="s10" style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;text-align: left;"><a name="bookmark320">flip3(demethodize(Array.prototype.reduce))</a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">const sum = (x, y) =&gt; x + y;</p><p style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>const sumAll = myReduce(sum, 0);<br/>sumAll(anArray);<br/>sumAll(anotherArray);</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Here, we used partial currying to simplify the expression for sumAl 1 (). The alternative would have<br/>been using common currying, and then we would have defined sumAll = myReduce (sum) (0).</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 20pt;text-indent: 0pt;text-align: left;">256 Transforming Functions - Currying and Partial Application</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>You can also go for more esoteric parameter rearranging functions if you want, but you usually won’t<br/>need more than these two. For really complex situations, you may instead opt for using arrow functions<br/>(as we did when defining f lip2 () and f lip3 ()) and make it clear what kind of reordering you need.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 53pt;text-indent: 0pt;text-align: justify;"><a name="bookmark321">Being functional</a></p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Now that we are nearing the end of this chapter, a confession is in order: I do not always use currying<br/>and partial application, as shown previously! Don’t misunderstand me, I do apply those techniques—<br/>but sometimes they make for longer, less clear, not necessarily better code. Let me show you what<br/>I’m talking about.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>If I’m writing my own function and then I want to curry it to fix the first parameter, currying, partial<br/>application, or partial currying don’t really make a difference compared to arrow functions. I’d have<br/>to  write the following:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;text-align: left;">const myFunction = (a, b, c) =&gt; { ... };</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;text-align: left;"><a name="bookmark322">const myCurriedFn = </a><b>curry(myFunction)(fixlst);</b></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 62pt;text-indent: 0pt;text-align: left;"><a name="bookmark323">// and later in the code...</a></p><p class="s10" style="padding-top: 4pt;padding-left: 60pt;text-indent: 0pt;text-align: left;">myCurriedFn(set2nd)(set3rd);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Currying the function and giving it a first parameter, all in the same line, may be considered not<br/>so clear; the alternative calls for an added variable and one more line of code. Later, the future call<br/>isn’t so good either; however, partial currying makes it more straightforward, with something like<br/>myPartiallyCurriedFn(set2nd, set3rd).</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>In any case, when I compare the final code with the use of arrow functions, I think the other solutions<br/>aren’t really any better; make your own evaluation of the sample that follows:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;text-align: left;">const myFunction = (a, b, c) =&gt; { ... };</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;text-align: left;"><a name="bookmark324">const myFixedFirst = </a><b>(b, c) =&gt; myFn(fixlst, b, c);</b></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>// and later...<br/>myFixedFirst(set2nd, set3rd);</span></p><p style="padding-top: 8pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Where I do think that currying and partial application is quite good is in my small library of<br/>de-methodized, pre-curried, basic higher-order functions. I have my own set of functions, such as<br/>the following:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;text-align: left;"><a name="bookmark325">const </a><b>_plainMap = demethodize(Array.prototype.map);</b></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 12pt;padding-left: 403pt;text-indent: 0pt;text-align: left;">Summary  257</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 146%;text-align: left;"><span>const myMap = curry(binary(_plainMap));<br/>const myMapX = curry(flipTwo(_plainMap));</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;"><a name="bookmark326">const </a><b>_plainReduce = demethodize(Array.prototype.reduce) ;</b></p><p style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>const myReduce = curry(ternary(_plainReduce));<br/>const myReduceX = curry(flip3(_plainReduce));</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;"><a name="bookmark327">const </a><b>_plainFilter = demethodize(Array.prototype.filter);</b></p><p style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;line-height: 143%;text-align: left;"><span>const myFilter = curry(binary(_plainFilter));<br/>const myFilterX = curry(flipTwo(_plainFilter));</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 9pt;line-height: 220%;text-align: left;"><span>// ...and more functions in the same vein<br/>Here are some points to note about the code:</span></p><ul id="l93"><li data-list-text="•"><p style="padding-left: 70pt;text-indent: -13pt;line-height: 9pt;text-align: justify;">I have these functions in a separate module, and I only export the myXXX () named ones.</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;text-align: justify;">The other functions are private, and I use the leading underscore to remind me of that.</p></li><li data-list-text="•"><p class="s33" style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;line-height: 124%;text-align: justify;">	<span class="p">I use the my. . . prefix to remember that these are my functions, not the normal JavaScript<br/>ones. Some people would rather keep familiar names such as map () or filter (), but I<br/>prefer distinct names.</span></p></li><li data-list-text="•"><p style="padding-top: 5pt;padding-left: 73pt;text-indent: -15pt;text-align: justify;">Since most of the JavaScript methods have a variable arity, I fixed that as described in the</p><p class="s9" style="padding-top: 2pt;padding-left: 71pt;text-indent: 0pt;text-align: justify;">Variable number of parameters <span class="p">section.</span></p></li><li data-list-text="•"><p class="s33" style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;line-height: 125%;text-align: justify;">	<span class="p">I always provide the third argument (the initial value for reducing) to reduce (), so the arity<br/>I chose for that function is 3.</span></p></li><li data-list-text="•"><p class="s33" style="padding-top: 5pt;padding-left: 70pt;text-indent: -13pt;line-height: 125%;text-align: justify;">	<span class="p">When currying flipped functions, you don’t need to specify the number of parameters because<br/>flipping already does that for you.</span></p></li></ul><p style="padding-top: 8pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Ultimately, it all comes down to a personal decision; experiment with the techniques we’ve looked at<br/>in this chapter and see which ones you prefer!</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-left: 43pt;text-indent: 0pt;text-align: left;"><a name="bookmark328">Summary</a></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>In this chapter, we have considered a new way of producing functions by fixing arguments to an<br/>existing function in several different ways: currying, which originally came from computer theory;<br/>partial application, which is more flexible; and partial currying, which combines good aspects from<br/>both of the previous methods. Using these transformations, you can simplify your coding because<br/>you can generate more specialized versions of general functions without any hassle.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 20pt;text-indent: 0pt;text-align: left;">258 Transforming Functions - Currying and Partial Application</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;">In <i>Chapter 8, Connecting Functions, </i><span>we will turn back to some concepts we looked at in the chapter<br/>on pure functions, and we will consider ways of ensuring that functions cannot become impure by<br/>accident, by seeking ways to make their arguments immutable, making them impossible to mutate.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-left: 52pt;text-indent: 0pt;text-align: left;"><a name="bookmark329">Questions</a></p><ol id="l94"><ol id="l95"><li data-list-text="7.1"><p class="s10" style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;">Hard by hand: <span class="p">With our “curried by hand” sum () function, we could write sum () (3) (5) and<br/>get 8. But what happens if we write sum (3 ) () (5) instead?</span></p></li><li data-list-text="7.2"><p class="s10" style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;">Sum as you will: <span class="p">The following exercise will help you understand some of the concepts we dealt<br/>with in this chapter, even if you solve it without using any of the functions we looked at. Write a<br/>sumMany () function that lets you sum an indeterminate quantity of numbers in the following<br/>fashion. Note that when the function is called with no arguments, the sum is returned:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">let result = sumMany(9) (2) (3) (1) (4) (3) () ;</p><p style="padding-top: 5pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">// 22</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="7.3"><p class="s10" style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;">Curry with eval? <span class="p">You could also produce a curried version of a function by using eval () - yes,<br/>the unsafe, dangerous eval () ! If you are willing to avoid the potential security headaches that<br/>eval () can bring, you could use it to transform a function such as the following:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 74pt;text-indent: -13pt;line-height: 146%;text-align: left;"><span>const make3 = (a: string, b: number, c: string): string =&gt;<br/>&#39;${a}:${b}:${C}&#39;;</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;text-align: justify;">You could transform it into a curried equivalent:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;text-align: left;">const make3curried = xl =&gt; x2 =&gt; x3 =&gt; make3(xl, x2, x3);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;">Give it a try! A tip: using the range () function we wrote back in the <i>Working with ranges </i><span>section<br/>of </span><i>Chapter 5, Programming Declaratively, </i><span>may shorten your code. Also, remember that fn. length<br/>tells you the arity of the f n () function.</span></p></li><li data-list-text="7.4"><p class="s10" style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;">Uncurrying the curried: <span class="p">Write an unCurry (f n, arity) function that receives as arguments<br/>a (curried) function and its expected arity, and returns an uncurried version of f n () - that is, a<br/>function that will receive all arguments at once and produce a result (providing the expected arity is<br/>needed because you have no way of determining it on your own):</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;text-align: left;">const make3 = (a, b, c) =&gt; String(100 * a + 10 * b + c);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>const make3c = curry(make3);<br/>console.log(make3c(1)                          (2) (3)) ; // 123</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 401pt;text-indent: 0pt;text-align: left;">Questions  259</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>const remake3 = uncurry(make3c, 3);<br/>console.log(remake3(1, 2, 3)); // 123</span></p></li><li data-list-text="7.5"><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><b>Let me count the ways: </b><span>If you curry a function with three parameters, there’s only one way of<br/>using it: (a) =&gt; (b) =&gt; (c) =&gt; result. However, if you use partial curry, there are some<br/>more  ways  of  using  it:  (a,b)  =&gt;  (c)  =&gt;  result,  (a)  =&gt;  (b,c)  =&gt;  result,  and  even<br/>(a,                                                      b, c) = &gt; result. In how many ways can you use a partially curried function with </span><i>n </i>parameters?</p></li><li data-list-text="7.6"><p class="s10" style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;">Currying by prototype: <span class="p">Modify Function. prototype to provide a curry () method that<br/>will work like the curry () function we saw in the chapter. Completing the following code should<br/>produce the following results:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">Function.prototype.curry = function () {</p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">// ...your code goes here...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;line-height: 142%;text-align: left;"><span>const sum3 = (a, b, c) =&gt; 100 * a + 10 * b + c;<br/>sum3.curry()(1)(2)(4); // 124</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>const sum3C = sum3.curry()(2)(2);<br/>sum3C(9); // 229</span></p></li><li data-list-text="7.7"><p class="s10" style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: justify;">Shorter typing: <span class="p">A reader commented that the Curry&lt; &gt; type could be written in an equivalent<br/>but shorter way if you first tested for two or more arguments. Can you implement this change?</span></p></li><li data-list-text="7.8"><p class="s10" style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;">Counting arguments: <span class="p">When we wrote the Curry&lt; &gt; type, we tested whether a single argument<br/>was provided by writing P extends [infer H] - can you rewrite the code to work with<br/>[&quot; length&quot; ] instead? A hint: we did this kind of thing when we defined the Partialo type:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">type Curry&lt;P, R&gt; = <b>P extends [infer H]</b></p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">? (arg: H) =&gt; R // only 1 arg</p><p style="padding-top: 4pt;padding-left: 66pt;text-indent: 0pt;text-align: left;">: P extends [infer H, ...infer T] // 2 or more args</p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">? (arg: H) =&gt; Curry&lt;[...T], R&gt;</p><p style="padding-top: 4pt;padding-left: 66pt;text-indent: 0pt;text-align: left;">: never;</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="7.9"><p class="s10" style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;">Working stylishly: <span class="p">Write an applyStyle () function that will let you apply basic styling to<br/>strings in the following way. Use either currying or partial application:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 141%;text-align: left;"><span>const makeBold = applyStyle(&quot;b&quot;);<br/>document.getElementByld(&quot;myCity&quot;).innerHTML =</span></p><p style="padding-left: 64pt;text-indent: 0pt;text-align: left;">makeBold(&quot;Montevideo&quot;);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 20pt;text-indent: 0pt;text-align: left;">260 Transforming Functions - Currying and Partial Application</p><p style="padding-top: 3pt;padding-left: 61pt;text-indent: 0pt;line-height: 30pt;text-align: left;"><span>// &lt;b&gt;Montevideo&lt;/b&gt;, to produce Montevideo<br/>const makeUnderline = applyStyle(&quot;u&quot;);</span></p><p style="padding-top: 4pt;padding-left: 73pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>document.getElementByld(&quot;myCountry&quot;).innerHTML =<br/>makeUnderline(&quot;Uruguay&quot;);</span></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// &lt;u&gt;Uruguay&lt;/u&gt;, to produce Uruguay</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="7.10"><p class="s10" style="padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: left;">Mystery questions function: <span class="p">What does the following function, purposefully written in an<br/>unhelpful way, actually do?</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;text-align: left;">const what = (who) =&gt; (...why) =&gt; who.length &lt;= why.length</p><p style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">? who(...why) : (...when) =&gt; what(who)(...why, ...when);</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="7.11"><p class="s10" style="padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: left;">Partial transformations: <span class="p">Modify the prototype for functions, so both partial () and<br/>partialCurry () will be available as methods.</span></p></li><li data-list-text="7.12"><p class="s10" style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: left;">Yet more curry! <span class="p">Here is another proposal for a currying-style function: can you see why it works?<br/>A hint - the code is related to something we saw in the chapter:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 76pt;text-indent: -14pt;line-height: 144%;text-align: left;"><span>const curryN =<br/>(fn) =&gt;</span></p><p style="padding-left: 76pt;text-indent: 0pt;line-height: 10pt;text-align: left;">( . . .args) =&gt;</p><p style="padding-top: 4pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">args.length &gt;= fn.length</p><p style="padding-top: 4pt;padding-left: 98pt;text-indent: 0pt;text-align: left;">? fn(...args)</p><p style="padding-top: 4pt;padding-left: 99pt;text-indent: 0pt;text-align: left;">: curryN(fn.bind(null, ...args));</p><p style="text-indent: 0pt;text-align: left;"><br/></p><h3 style="padding-top: 10pt;text-indent: 0pt;text-align: right;">8</h3><h2 style="padding-top: 4pt;text-indent: 0pt;text-align: right;">Connecting Functions</h2><h2 style="padding-top: 1pt;text-indent: 0pt;text-align: right;">- Pipelining, Composition,</h2><h2 style="padding-top: 2pt;text-indent: 0pt;text-align: right;">and More</h2><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;">In <i>Chapter 7, Transforming Functions, </i><span>we looked at ways to build new functions by applying higher-<br/>order functions. In this chapter, we will go to the core of FP and learn how to create sequences of<br/>function calls and how to combine them to produce a more complex result out of several simpler<br/>components. To do this, we will cover the following topics:</span></p><ul id="l96"><li data-list-text="•"><p class="s10" style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">Pipelining: <span class="p">A way to join functions, similar to Unix/Linux pipes</span></p></li><li data-list-text="•"><p class="s10" style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">Chaining: <span class="p">A variant of pipelining, but restricted to objects</span></p></li><li data-list-text="•"><p class="s10" style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">Composing: <span class="p">A classic operation with its origins in basic computer theory</span></p></li><li data-list-text="•"><p class="s10" style="padding-top: 8pt;padding-left: 43pt;text-indent: 13pt;line-height: 211%;text-align: left;">Transducing: <span class="p">An optimized way to compose map, filter, or reduce operations<br/>Along the way, we will be touching on related concepts, such as the following:</span></p></li><li data-list-text="•"><p class="s10" style="padding-left: 70pt;text-indent: -13pt;line-height: 10pt;text-align: left;">Pointfree style, <span class="p">which is often used with pipelining and composition</span></p></li><li data-list-text="•"><p class="s10" style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">Debugging <span class="p">of composed or piped functions, for which we’ll whip up some auxiliary tools</span></p></li><li data-list-text="•"><p class="s10" style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">Testing <span class="p">for these functions, which won’t prove to be of high complexity</span></p></li></ul></li></ol></ol><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Armed with these techniques, you’ll be able to combine small functions to create larger ones, which<br/>is a characteristic of FP and will help you develop better code.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-left: 44pt;text-indent: 0pt;text-align: left;"><a name="bookmark330">Pipelining</a></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Pipelining and composition are techniques that are used to set up functions to work in sequence so<br/>that the output of a function becomes the input for the following function. There are two ways of</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 20pt;text-indent: 0pt;text-align: left;">262  Connecting Functions - Pipelining, Composition, and More</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>looking at this: from a computer point of view, and from a mathematical point of view. We’ll look at<br/>both in this section. Most FP texts start with the latter, but since I assume that most of you will prefer<br/>computers over math, let’s start with the former instead.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 53pt;text-indent: 0pt;text-align: justify;"><a name="bookmark331">Piping in Unix/Linux</a></p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>In Unix/Linux, executing a command and passing its output as input to a second command, whose<br/>output will yield the input of a third command, and so on, is called a pipeline. This is quite a common<br/>application of the philosophy of Unix, as explained in a Bell Laboratories article written by the creator<br/>of   the pipelining concept himself, Doug McIlroy:</span></p><ul id="l97"><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 79pt;text-indent: -13pt;line-height: 123%;text-align: left;"><span>Make each program do one thing well. To do a new job, build afresh rather than complicating<br/>old programs by adding new features.</span></p></li><li data-list-text="•"><p style="padding-top: 5pt;padding-left: 79pt;text-indent: -13pt;text-align: left;">Expect the output of every program to become the input to another, so far unknown program.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-top: 7pt;padding-left: 65pt;text-indent: 0pt;text-align: left;"><a name="bookmark332">A bit of history</a></p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;line-height: 115%;text-align: left;"><span>Given the historical importance of Unix, I’d recommend reading some of the seminal articles<br/>describing the (then new) operating system in the Bell System Technical Journal, July 1978,<br/>at emulator.pdp-11.org.ru/misc/1978.0 7_-_Bell_System_Technical_</span></p><p style="padding-left: 66pt;text-indent: 0pt;line-height: 10pt;text-align: left;">Journal. pdf. The two quoted rules are in the <i>Style </i>section of the <i>Foreword </i>article.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 8pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Let’s consider a simple example to get started. Suppose I want to know how many LibreOffice text<br/>documents there are in a directory. There are many ways to do this, but the following example will<br/>do. We will execute three commands, piping (that’s the meaning of the | character) each command’s<br/>output  as  input  to  the  next  one.  Suppose  we  have  cd  /home/fkereki/Documents  and  then<br/>do the following (please ignore the dollar sign, which is just the console prompt):</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 61pt;text-indent: 0pt;line-height: 142%;text-align: left;"><a name="bookmark333"><span>$ Is -1 | grep &quot;odt$&quot; | wc -1<br/>4</span></a><a name="bookmark334">&zwnj;</a></p><p style="padding-top: 8pt;padding-left: 52pt;text-indent: 0pt;text-align: justify;">What does this mean? How does it work? We have to analyze this process step by step:</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="•"><p class="s33" style="padding-left: 79pt;text-indent: -12pt;line-height: 125%;text-align: left;">	<span class="p">The first part of the pipeline, Is -1, lists all the files in the current directory (/home/fkereki/<br/>Documents, as per our cd command) in a single column, with one filename per line</span></p></li><li data-list-text="•"><p class="s33" style="padding-top: 5pt;padding-left: 79pt;text-indent: -13pt;line-height: 123%;text-align: left;">	<span class="p">The output from the first command is provided as input to grep &quot; odt $ &quot;, which filters<br/>(only lets pass) lines that finish with &quot; odt&quot;, the standard file extension for LibreOffice Writer</span></p></li><li data-list-text="•"><p class="s33" style="padding-top: 5pt;padding-left: 79pt;text-indent: -12pt;line-height: 123%;text-align: left;">	<span class="p">The filtered output is provided to the counting command, wc -1, which counts how many<br/>lines there are in its input</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 402pt;text-indent: 0pt;text-align: left;">Pipelining  263</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 56pt;text-indent: 0pt;text-align: left;"><a name="bookmark335">More on pipelining</a></p><p style="padding-top: 4pt;padding-left: 56pt;text-indent: 0pt;text-align: left;">You can find out more about pipelines in <i>Section 6.2, Filters, </i>of <i>The UNIX Time-Sharing System</i></p><p style="padding-top: 1pt;padding-left: 57pt;text-indent: 0pt;line-height: 115%;text-align: left;"><span>by Dennis Ritchie and Ken Thompson, also in the issue of the Bell Laboratories journal that<br/>I mentioned previously.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>From the point of view of FP, this is a key concept. We want to build more complex operations out of<br/>simple, single-purpose, shorter functions. Pipelining is what the Unix shell uses to apply that concept.<br/>It does this by simplifying the job of executing a command, taking its output, and providing it as input<br/>to yet another command. We will apply similar concepts in our own functional style in JavaScript later:</span></p><p class="s213" style="padding-top: 7pt;padding-left: 41pt;text-indent: 0pt;text-align: center;"><span><img width="236" height="29" alt="image" src="Image_034.gif"/></span>     <span><img width="26" height="22" alt="image" src="Image_035.gif"/></span><span class="s214">   </span><span class="s190">+ result</span></p><p style="padding-top: 8pt;padding-left: 44pt;text-indent: 0pt;text-align: center;">Figure 8.1 - Pipelines in JavaScript are similar to Unix/Linux pipelines.</p><p style="padding-top: 3pt;padding-left: 43pt;text-indent: 0pt;text-align: center;">The output of each function becomes the input for the next</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>By the way (and no—rest assured, this isn’t turning into a shell tutorial!), you can make pipelines<br/>accept parameters. For example, if I happened to want to count how many files I had with this or that<br/>extension, I could create a function such as cf e, standing for </span><i>count for extension:</i></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 53pt;text-indent: 0pt;text-align: left;">$ function cfe() {</p><p class="s10" style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">Is  -1  |  grep  &quot;$1\$&quot;|  wc  -1</p><p class="s10" style="padding-top: 6pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: justify;">Then, I could use c f e as a command, giving it the desired extension as an argument:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 52pt;text-indent: 0pt;line-height: 142%;text-align: left;"><span>$ cfe odt<br/>4</span></p><p class="s10" style="padding-left: 53pt;text-indent: 0pt;line-height: 143%;text-align: left;"><span>$ cfe pdf<br/>6</span></p><p style="padding-top: 8pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>cfe executes my pipeline and tells me I have four odt files (LibreOffice) and six pdf files; nice! We<br/>will also want to write similar parametric pipelines: we are not constrained to fixed functions in our<br/>flow; we have full liberty regarding what we want to include. Having worked in Linux, we can now<br/>go back to coding. Let’s see how.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 44pt;text-indent: 0pt;text-align: justify;"><a name="bookmark336">Revisiting an example</a></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>We can start tying ends together by revisiting a problem from a previous chapter. Remember when<br/>we had to calculate the average latitude and longitude for some geographic data that we looked at<br/>in the </span><i>Extracting data from objects </i>section of <i>Chapter 5, Programming Declaratively? </i><span>Basically, we<br/>started with some data such as the following, and the problem was to calculate the average latitude<br/>and longitude of the given points:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 20pt;text-indent: 0pt;text-align: left;">264  Connecting Functions - Pipelining, Composition, and More</p><p style="text-indent: 0pt;text-align: left;"><br/></p><table style="border-collapse:collapse;margin-left:59.38pt" cellspacing="0"><tr style="height:13pt"><td style="width:62pt"><p class="s29" style="padding-left: 1pt;text-indent: 0pt;line-height: 10pt;text-align: center;">const markers =</p></td><td style="width:34pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:25pt"><p class="s29" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">[</p></td><td style="width:47pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:28pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:26pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:15pt"><td style="width:62pt"><p class="s29" style="padding-top: 1pt;padding-left: 1pt;padding-right: 3pt;text-indent: 0pt;text-align: center;">{ name:</p></td><td style="width:34pt"><p class="s29" style="padding-top: 1pt;padding-left: 1pt;text-indent: 0pt;text-align: left;">&quot;AR&quot;,</p></td><td style="width:25pt"><p class="s29" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">lat :</p></td><td style="width:47pt"><p class="s29" style="padding-top: 1pt;padding-left: 8pt;text-indent: 0pt;text-align: left;">-34.6,</p></td><td style="width:28pt"><p class="s29" style="padding-top: 1pt;padding-right: 4pt;text-indent: 0pt;text-align: right;">Ion:</p></td><td style="width:26pt"><p class="s29" style="padding-top: 1pt;padding-left: 4pt;padding-right: 1pt;text-indent: 0pt;text-align: center;">-58.4</p></td></tr><tr style="height:15pt"><td style="width:62pt"><p class="s29" style="padding-top: 2pt;padding-left: 1pt;padding-right: 3pt;text-indent: 0pt;text-align: center;">{ name:</p></td><td style="width:34pt"><p class="s29" style="padding-top: 1pt;padding-left: 1pt;text-indent: 0pt;text-align: left;">&quot;BO&quot; ,</p></td><td style="width:25pt"><p class="s29" style="padding-top: 2pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">lat :</p></td><td style="width:47pt"><p class="s29" style="padding-top: 2pt;padding-left: 8pt;text-indent: 0pt;text-align: left;">-16.5,</p></td><td style="width:28pt"><p class="s29" style="padding-top: 1pt;padding-right: 4pt;text-indent: 0pt;text-align: right;">Ion:</p></td><td style="width:26pt"><p class="s29" style="padding-top: 2pt;padding-left: 4pt;padding-right: 1pt;text-indent: 0pt;text-align: center;">-68.1</p></td></tr><tr style="height:15pt"><td style="width:62pt"><p class="s29" style="padding-top: 1pt;padding-left: 1pt;padding-right: 3pt;text-indent: 0pt;text-align: center;">{ name:</p></td><td style="width:34pt"><p class="s29" style="padding-top: 1pt;padding-left: 1pt;text-indent: 0pt;text-align: left;">&quot;BR&quot; ,</p></td><td style="width:25pt"><p class="s29" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">lat:</p></td><td style="width:47pt"><p class="s29" style="padding-top: 1pt;padding-left: 8pt;text-indent: 0pt;text-align: left;">-15.8,</p></td><td style="width:28pt"><p class="s29" style="padding-top: 1pt;padding-right: 4pt;text-indent: 0pt;text-align: right;">Ion:</p></td><td style="width:26pt"><p class="s29" style="padding-top: 1pt;padding-left: 4pt;padding-right: 1pt;text-indent: 0pt;text-align: center;">-47.9</p></td></tr><tr style="height:15pt"><td style="width:62pt"><p class="s29" style="padding-top: 2pt;padding-left: 1pt;padding-right: 3pt;text-indent: 0pt;text-align: center;">{ name:</p></td><td style="width:34pt"><p class="s29" style="padding-top: 2pt;padding-left: 1pt;text-indent: 0pt;text-align: left;">&quot;CL&quot; ,</p></td><td style="width:25pt"><p class="s29" style="padding-top: 2pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">lat :</p></td><td style="width:47pt"><p class="s29" style="padding-top: 2pt;padding-left: 8pt;text-indent: 0pt;text-align: left;">-33.4,</p></td><td style="width:28pt"><p class="s29" style="padding-top: 2pt;padding-right: 4pt;text-indent: 0pt;text-align: right;">Ion:</p></td><td style="width:26pt"><p class="s29" style="padding-top: 2pt;padding-left: 4pt;padding-right: 1pt;text-indent: 0pt;text-align: center;">-70.7</p></td></tr><tr style="height:15pt"><td style="width:62pt"><p class="s29" style="padding-top: 2pt;padding-left: 1pt;padding-right: 3pt;text-indent: 0pt;text-align: center;">{ name:</p></td><td style="width:34pt"><p class="s29" style="padding-top: 2pt;padding-left: 1pt;text-indent: 0pt;text-align: left;">&quot;CO&quot; ,</p></td><td style="width:25pt"><p class="s29" style="padding-top: 2pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">lat :</p></td><td style="width:47pt"><p class="s29" style="padding-top: 2pt;padding-right: 6pt;text-indent: 0pt;text-align: right;">4.6,</p></td><td style="width:28pt"><p class="s29" style="padding-top: 2pt;padding-right: 4pt;text-indent: 0pt;text-align: right;">Ion:</p></td><td style="width:26pt"><p class="s29" style="padding-top: 2pt;padding-left: 4pt;padding-right: 1pt;text-indent: 0pt;text-align: center;">-74.0</p></td></tr><tr style="height:15pt"><td style="width:62pt"><p class="s29" style="padding-top: 2pt;padding-left: 1pt;padding-right: 3pt;text-indent: 0pt;text-align: center;">{ name:</p></td><td style="width:34pt"><p class="s29" style="padding-top: 2pt;padding-left: 1pt;text-indent: 0pt;text-align: left;">&quot;EC&quot; ,</p></td><td style="width:25pt"><p class="s29" style="padding-top: 2pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">lat :</p></td><td style="width:47pt"><p class="s29" style="padding-top: 2pt;padding-left: 14pt;text-indent: 0pt;text-align: left;">-0.3,</p></td><td style="width:28pt"><p class="s29" style="padding-top: 1pt;padding-right: 4pt;text-indent: 0pt;text-align: right;">Ion:</p></td><td style="width:26pt"><p class="s29" style="padding-top: 2pt;padding-left: 4pt;padding-right: 1pt;text-indent: 0pt;text-align: center;">-78.6</p></td></tr><tr style="height:15pt"><td style="width:62pt"><p class="s29" style="padding-top: 2pt;padding-left: 1pt;padding-right: 3pt;text-indent: 0pt;text-align: center;">{ name:</p></td><td style="width:34pt"><p class="s29" style="padding-top: 1pt;padding-left: 1pt;text-indent: 0pt;text-align: left;">&quot;PE&quot; ,</p></td><td style="width:25pt"><p class="s29" style="padding-top: 2pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">lat:</p></td><td style="width:47pt"><p class="s29" style="padding-top: 2pt;padding-left: 8pt;text-indent: 0pt;text-align: left;">-12.0,</p></td><td style="width:28pt"><p class="s29" style="padding-top: 1pt;padding-right: 4pt;text-indent: 0pt;text-align: right;">Ion:</p></td><td style="width:26pt"><p class="s29" style="padding-top: 2pt;padding-left: 4pt;padding-right: 1pt;text-indent: 0pt;text-align: center;">-77.0</p></td></tr><tr style="height:15pt"><td style="width:62pt"><p class="s29" style="padding-top: 1pt;padding-left: 1pt;padding-right: 3pt;text-indent: 0pt;text-align: center;">{ name:</p></td><td style="width:34pt"><p class="s29" style="padding-top: 1pt;padding-left: 1pt;text-indent: 0pt;text-align: left;">&quot; PY &quot;</p></td><td style="width:25pt"><p class="s29" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">lat :</p></td><td style="width:47pt"><p class="s29" style="padding-top: 1pt;padding-left: 8pt;text-indent: 0pt;text-align: left;">-25.2,</p></td><td style="width:28pt"><p class="s29" style="padding-top: 1pt;padding-right: 4pt;text-indent: 0pt;text-align: right;">Ion :</p></td><td style="width:26pt"><p class="s29" style="padding-top: 1pt;padding-left: 4pt;padding-right: 1pt;text-indent: 0pt;text-align: center;">-57.5</p></td></tr><tr style="height:15pt"><td style="width:62pt"><p class="s29" style="padding-top: 2pt;padding-left: 1pt;padding-right: 3pt;text-indent: 0pt;text-align: center;">{ name:</p></td><td style="width:34pt"><p class="s29" style="padding-top: 2pt;padding-left: 1pt;text-indent: 0pt;text-align: left;">&quot; UY &quot; ,</p></td><td style="width:25pt"><p class="s29" style="padding-top: 2pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">lat :</p></td><td style="width:47pt"><p class="s29" style="padding-top: 2pt;padding-left: 8pt;text-indent: 0pt;text-align: left;">-34.9,</p></td><td style="width:28pt"><p class="s29" style="padding-top: 2pt;padding-right: 4pt;text-indent: 0pt;text-align: right;">Ion :</p></td><td style="width:26pt"><p class="s29" style="padding-top: 2pt;padding-left: 4pt;padding-right: 1pt;text-indent: 0pt;text-align: center;">-56.2</p></td></tr><tr style="height:13pt"><td style="width:62pt"><p class="s29" style="padding-top: 2pt;padding-left: 1pt;padding-right: 3pt;text-indent: 0pt;line-height: 9pt;text-align: center;">{ name:</p></td><td style="width:34pt"><p class="s29" style="padding-top: 2pt;padding-left: 1pt;text-indent: 0pt;line-height: 9pt;text-align: left;">&quot;VE&quot; ,</p></td><td style="width:25pt"><p class="s29" style="padding-top: 2pt;padding-left: 2pt;text-indent: 0pt;line-height: 9pt;text-align: left;">lat :</p></td><td style="width:47pt"><p class="s29" style="padding-top: 2pt;padding-right: 6pt;text-indent: 0pt;line-height: 9pt;text-align: right;">10.5,</p></td><td style="width:28pt"><p class="s29" style="padding-top: 2pt;padding-right: 4pt;text-indent: 0pt;line-height: 9pt;text-align: right;">Ion:</p></td><td style="width:26pt"><p class="s29" style="padding-top: 2pt;padding-left: 4pt;padding-right: 1pt;text-indent: 0pt;line-height: 9pt;text-align: center;">-66.9</p></td></tr></table><p class="s17" style="padding-top: 3pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">1 ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;text-align: justify;">With what we know, we can write a solution in terms of the following:</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="•"><p style="padding-left: 81pt;text-indent: -15pt;text-align: left;">Being able to extract the latitude (and afterward, the longitude) from each point</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 81pt;text-indent: -15pt;text-align: left;">Using that function to create an array of latitudes</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 81pt;text-indent: -15pt;text-align: left;">Pipelining the resulting array to the average function we wrote in the <i>Calculating an average</i></p></li></ul><p style="padding-top: 2pt;padding-left: 79pt;text-indent: 0pt;text-align: left;">section of the aforementioned chapter</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;">To do the first task, we can use the myMap () function from the <i>Parameter order </i>section of <i>Chapter 7,</i><span>For the second task, we can make do with the getField () function from<br/>the </span><i>Getting a property from an object </i>section of <i>Chapter 6, Producing Functions. </i><span>Finally, for the third<br/>task, we’ll use the (yet unwritten) pipeline () function we’ll develop soon! In full, our solution<br/>could look like this:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;text-align: left;">const sum = (x: number, y: number): number =&gt; x + y;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 73pt;text-indent: -12pt;line-height: 144%;text-align: left;"><span>const average = (arr: number[]) =&gt;<br/>arr.reduce(sum, 0) / arr.length;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 74pt;text-indent: -12pt;line-height: 143%;text-align: left;"><span>const myMap = curry(<br/>flip2(demethodize(Array.prototype.map))</span></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 6pt;padding-left: 73pt;text-indent: -12pt;line-height: 142%;text-align: left;"><span>const getAHLats = myMap (getField (&quot;lat&quot;) ) as (<br/>arg: any</span></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">) =&gt; number [] ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 402pt;text-indent: 0pt;text-align: left;">Pipelining  265</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">const averageLat = <b>pipeline </b>(getAHLats, average) (markers);</p><p style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// and similar code to average longitudes</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: justify;"><span>We had to add some casting to getAHLats so that TypeScript would know to what we would<br/>apply that function.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Of course, you can always yield to the temptation of going for one-liners, but would it be much clearer<br/>or better?</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 64pt;text-indent: -12pt;line-height: 142%;text-align: left;"><span>const averageLat2 = pipeline!<br/>curry(flip2(demethodize(Array.prototype.map)))(</span></p><p style="padding-left: 76pt;text-indent: 0pt;text-align: left;">getField(&quot;lat&quot;)</p><p style="padding-top: 4pt;padding-left: 64pt;text-indent: 0pt;line-height: 143%;text-align: left;"><span>)  as  (arg:  any)  =&gt;  number[],<br/>average</span></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">)(markers);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Whether this makes sense to you will depend on your experience with FP. In any case, no matter<br/>which solution you take, the fact remains that adding pipelining (and later on, composition) to your<br/>set of tools can help you write tighter, declarative, simpler-to-understand code.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;text-align: justify;">Now, let’s learn how to pipeline functions in the right way.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 43pt;text-indent: 0pt;text-align: justify;"><a name="bookmark337">Creating pipelines</a></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>We want to be able to generate a pipeline of several functions. We can do this in two ways: by building<br/>the pipeline by hand, in a problem-specific way, or by using more generic constructs that can be applied<br/>with generality. Lets look at both.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 57pt;text-indent: 0pt;text-align: justify;"><a name="bookmark338">Potential pipeline proposal</a></p><p style="padding-top: 4pt;padding-left: 56pt;text-indent: 0pt;line-height: 115%;text-align: justify;"><span>A new operator, | &gt;, is being considered for JavaScript, but it’s currently only at stage 2, which<br/>means it may be a while before it’s accepted and available. You may read more about the proposal<br/>and its varied history at git hub . com/tc3 9/proposal - pipe line-operator/<br/>blob/main/HISTORY.md.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s34" style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;text-align: justify;">Building pipelines by hand</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Let’s go with a Node.js example, similar to the command-line pipeline we built earlier in this chapter.<br/>Here, we’ll build the pipeline we need by hand. We need a function to read all the files in a directory.<br/>We can do that (although this isn’t recommended because of the synchronous call, which is normally<br/>not good in a server environment) with something like this:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 20pt;text-indent: 0pt;text-align: left;">266  Connecting Functions - Pipelining, Composition, and More</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// pipeline.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 73pt;text-indent: -11pt;line-height: 143%;text-align: left;"><span>function getDir(path) {<br/>const fs = require(&quot;fs&quot;);</span></p><p style="padding-left: 73pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>const files = fs.readdirSync(path);<br/>return files;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">Selecting only odt files is quite simple. We start with the following function:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 73pt;text-indent: -12pt;line-height: 142%;text-align: left;"><span>const filterByText = (<br/>text: string,</span></p><p style="padding-left: 73pt;text-indent: 0pt;text-align: left;">arr: string!]</p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">): string!] =&gt; arr.filter(<b>(v) =&gt; v.endsWith(text));</b></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>This function takes an array of strings and filters out elements that do not end with the given text, so<br/>we can now write the following:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">const filterOdt = (arr: string!]): string!] =&gt;</p><p class="s10" style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">filterByText(&quot;.odt&quot; , arr);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">Better still, we can apply currying and go for pointfree style, as shown in the <i>An unnecessary mistake</i></p><p style="padding-top: 2pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">section of <i>Chapter 3, Starting Out with Functions, </i>and write this, instead:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">const filterOdt = <b>curry(filterByText)</b>(&quot;.odt&quot;);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>Both versions of the filtering function are equivalent; which one you use comes down to your tastes.<br/>Finally, we can write the following to count elements in an array. Since length is not a function, we<br/>cannot apply our demethodizing trick:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">const count = &lt;T&gt;(arr: T[]) : number =&gt; <b>arr.length;</b></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 12pt;padding-left: 402pt;text-indent: 0pt;text-align: left;">Pipelining  267</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: justify;">With these functions, we could write something like this:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 65pt;text-indent: -12pt;line-height: 143%;text-align: left;"><span>const countOdtFiles = (path: string): number =&gt; {<br/>const files = getDir(path);</span></p><p style="padding-left: 64pt;text-indent: 0pt;line-height: 144%;text-align: left;"><a name="bookmark339"><span>const filteredFiles = filterOdt(files);<br/>const countOfFiles = count(filteredFiles);<br/>return countOfFiles;</span></a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">countOdtFiles(&quot;/home/fkereki/Documents&quot;);</p><p style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// 4, as with the command line solution</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>We are essentially doing the same process as in Linux: getting the files, keeping only the odt ones,<br/>and counting how many files result from this. If you wanted to get rid of all the intermediate variables,<br/>you could also go for a one-liner definition that does precisely the same job in the very same way,<br/>albeit with fewer lines:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">const count0dtFiles2 = (path: string): number =&gt;</p><p class="s10" style="padding-top: 4pt;padding-left: 64pt;text-indent: 0pt;text-align: left;">count(filterOdt(getDir(path)));</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">const c2 = count0dtFiles2(&quot;/home/fkereki/Documents&quot;);</p><p style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// 4, again</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>This gets to the crux of the matter: both implementations of our file-counting function have disadvantages.<br/>The first definition uses several intermediate variables to hold the results and makes a multiline function<br/>out of what was a single line of code in the Linux shell. On the other hand, the second, much shorter<br/>definition is harder to understand, insofar as we are writing the steps of the computation in seemingly<br/>reverse order! Our pipeline has to read files first, then filter them, and finally count them, but those<br/>functions appear </span><i>the other way around </i>in our definition!</p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>We can undoubtedly implement pipelining by hand, as we have seen, but it would be better if we went<br/>for a more declarative style.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Let’s move on and try to build a better pipeline more clearly and more understandably by applying<br/>some of the concepts we’ve already seen.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s34" style="padding-left: 43pt;text-indent: 0pt;text-align: justify;">Using other constructs</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>If we think in functional terms, what we have is a list of functions and we want to apply them sequentially,<br/>starting with the first, then applying the second to whatever the first function produced as its result,</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 20pt;text-indent: 0pt;text-align: left;">268  Connecting Functions - Pipelining, Composition, and More</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>and then applying the third to the second function’s results, and so on. If we were fixing a pipeline of<br/>two functions, we could use the following code:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: justify;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;text-align: justify;">const pipeTwo =</p><p style="padding-top: 4pt;padding-left: 85pt;text-indent: -11pt;line-height: 143%;text-align: justify;"><span>&lt;AF  extends  any[],  RF,  RG&gt;  (<br/>f:   (...args:   AF[])   =&gt;   RF,<br/>g: (arg: RF) =&gt; RG</span></p><p style="padding-left: 74pt;text-indent: 0pt;text-align: justify;">) =&gt;</p><p style="padding-top: 3pt;padding-left: 76pt;text-indent: 0pt;text-align: justify;">(...args: any[]) =&gt; g(f(...args));</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: left;"><span>This is the basic definition we provided earlier in this chapter: we evaluate the first function, and its<br/>output becomes the input for the second function; relatively straightforward! Typing is simple: the<br/>first function to apply (f ()) may have any number of parameters, but the second function (g ())<br/>must have a single one, the same type that f () returns. The return type of the pipeline is the return<br/>type of g ().</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>You may object, though, that this pipeline of only two functions is a bit too limited! This is not as<br/>useless as it may seem because we can compose longer pipelines—though I’ll admit that it requires too<br/>much writing! Suppose we wanted to write our three-function pipeline (from the previous section);</span></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">we could do so in two different, equivalent ways:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: justify;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">const count0dtFiles3 = (path: string): number =&gt;</p><p class="s10" style="padding-top: 4pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">pipeTwo(pipeTwo(getDir, filterOdt), count)<span class="p">(path);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">const count0dtFiles4 = (path: string): number =&gt;</p><p class="s10" style="padding-top: 4pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">pipeTwo(getDir, pipeTwo(filterOdt, count))<span class="p">(path);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 65pt;text-indent: 0pt;text-align: left;"><a name="bookmark340">A touch of math</a></p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;line-height: 115%;text-align: left;"><span>We are taking advantage of the fact that piping is an associative operation. In mathematics,<br/>the associative property is the one that says that we can compute 1+2+3 either by adding 1+2<br/>first and then adding that result to 3 or by adding 1 to the result of first adding 2+3: in other<br/>terms, 1+2+3 is the same as (1 +2)+3 or l+(2+3).</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>How do they work? How is it that they are equivalent? Following the execution of a given call will be<br/>useful; it’s quite easy to get confused with so many calls! The first implementation can be followed<br/>step                                                 by step until the final result, which matches what we already know:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 402pt;text-indent: 0pt;text-align: left;">Pipelining  269</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 64pt;text-indent: -11pt;line-height: 143%;text-align: left;"><span>countOdtFiles3(path) ===<br/>pipeTwo(pipeTwo(getDir, filterOdt), count)<br/>pipeTwo(filterOdt(getDir(path)), count)(path)<br/>pipeTwo(count(filterOdt(getDir(path))))</span></p><p style="padding-top: 8pt;padding-left: 43pt;text-indent: 0pt;text-align: left;">The second implementation also comes to the same final result:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">count0dtFiles4(path) ===</p><p style="padding-top: 4pt;padding-left: 64pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>pipeTwo(getDir, pipeTwo(filterOdt, count))(path)<br/>pipeTwo(getDir(path), pipeTwo(filterOdt, count))<br/>pipeTwo(filterOdt, count)(getDir(path))<br/>pipeTwo(count(filterOdt(getDir(path))))</span></p><p style="padding-top: 8pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>Both derivations arrived at the same final expression—the same we had written by hand earlier, in<br/>fact—so we now know that we can make do just with a basic </span><i>pipe of two </i><span>higher-order functions, but<br/>we’d really like to be able to work in a shorter, more compact way. A first implementation could be<br/>along the lines of the following, and let’s look at typing later:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 65pt;text-indent: -12pt;line-height: 142%;text-align: left;"><span>function pipeline(...fns) {<br/>return (...args) =&gt; {</span></p><p style="padding-left: 77pt;text-indent: 0pt;text-align: left;">let result = fns [0] (...args) ;</p><p style="padding-top: 4pt;padding-left: 89pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>for (let i = 1; i &lt; fns.length; i++) {<br/>result = fns[i](result);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 77pt;text-indent: 0pt;text-align: left;">return result;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 52pt;text-indent: 0pt;text-align: left;">pipeline (</p><p class="s10" style="padding-top: 4pt;padding-left: 64pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>getDir,<br/>filterOdt,<br/>count</span></p><p style="padding-left: 53pt;text-indent: 0pt;line-height: 10pt;text-align: left;">)(&quot;/home/fkereki/Documents&quot;); // still 4</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: left;"><span>This does work—and specifying our file-counting pipeline is much clearer since the functions are<br/>given in their proper order. However, the implementation of the pipeline () function is not very<br/>functional and goes back to old, imperative, loop-by-hand methods. We can do better using reduce (),<br/>as  in </span><i>Chapter </i>5, <i>Programming Declaratively.</i></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 20pt;text-indent: 0pt;text-align: left;">270 Connecting Functions - Pipelining, Composition, and More</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>The idea is to start the evaluation with the first function, pass the result to the second, then that result<br/>to the third, and so on. By doing this, we can pipeline with shorter code, and again we’ll leave typing<br/>for later:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 73pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>function pipelines(...fns) {<br/>return fns.reduce(</span></p><p style="padding-left: 100pt;text-indent: -12pt;line-height: 142%;text-align: left;"><span>(result, f) =&gt;<br/>(...args) =&gt;</span></p><p style="padding-left: 110pt;text-indent: 0pt;text-align: left;">f(result ( . . .args))</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: justify;"><span>This code is more declarative. However, you could have gone one better by writing it using our<br/>pipeTwo () function, which does the same thing but more concisely:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 73pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>function pipelines(...fns) {<br/>return fns.reduce(pipeTwo);</span></p><p class="s17" style="padding-left: 62pt;text-indent: 0pt;text-align: left;">}</p><p style="padding-top: 9pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>(Using an arrow function would make for even shorter code.) You can understand this code by<br/>realizing that it uses the associative property we mentioned previously and pipes the first function to<br/>the second; then, it pipes this result to the third function, and so on.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Which version is better? I would say that the version that refers to the pipeTwo () function is clearer:<br/>if you know how reduce () works, you can readily understand that our pipeline goes through the<br/>functions two at a time, starting from the first—and that matches what you know about how pipes<br/>work. The other versions we wrote are more or less declarative, but not as simple to understand.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;text-align: justify;">We didn’t look at typing for all our pipelining functions, so let’s do that now.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s34" style="padding-left: 53pt;text-indent: 0pt;text-align: left;">Typing</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>When we pipeline several functions, a function’s output type should be the same as the following<br/>function’s parameter type. Let’s have an auxiliary FnsMatchPipec &gt; type to check whether two<br/>types satisfy this condition:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 12pt;padding-left: 402pt;text-indent: 0pt;text-align: left;">Pipelining  271</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">type FN = (...args: any[]) =&gt; any;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 65pt;text-indent: -12pt;line-height: 141%;text-align: left;"><span>type FnsMatchPipe&lt;FNS extends FN[]&gt;<br/>1 extends FNS[&quot;length&quot;]</span></p><p style="padding-left: 77pt;text-indent: 0pt;text-align: left;">? boolean</p><p style="padding-top: 4pt;padding-left: 89pt;text-indent: 0pt;text-align: left;">FNS extends [</p><p style="padding-top: 4pt;padding-left: 101pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>infer FNlst extends FN,<br/>infer FN2nd extends FN,</span></p><p style="padding-left: 102pt;text-indent: 0pt;line-height: 10pt;text-align: left;">...infer FNRest extends FN[]</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">? Parameters&lt;FN2nd&gt; extends [ReturnType&lt;FNlst&gt;]</p><p style="padding-top: 4pt;padding-left: 89pt;text-indent: 0pt;text-align: left;">? FnsMatchPipe&lt;[FN2nd, ...FNRest]&gt;</p><p style="padding-top: 4pt;padding-left: 90pt;text-indent: 0pt;text-align: left;">: never</p><p style="padding-top: 4pt;padding-left: 78pt;text-indent: 0pt;text-align: left;">: never;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: left;"><span>This works recursively. If we have a single function in the pipeline (the length of FNS is 1), then we<br/>return boolean to signify success. If we have more than one function, we take the first and second<br/>functions, check that the parameter of the latter is the same type as the return type of the former,</span></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>and apply recursion to check types from the second function onward. If there’s no match in types, we<br/>return never to mark a failure.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 126%;text-align: left;"><span>Now, what’s the type of the pipeline? The type of its arguments will match the first function’s argument<br/>type, and the type of the result will match the last function’s result type:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 64pt;text-indent: -11pt;line-height: 143%;text-align: left;"><span>type Pipeline&lt;FNS extends FN[]&gt; =<br/>boolean extends FnsMatchPipe&lt;FNS&gt;</span></p><p style="padding-left: 77pt;text-indent: 0pt;line-height: 10pt;text-align: left;">? 1 extends FNS[&quot;length&quot;]</p><p style="padding-top: 4pt;padding-left: 89pt;text-indent: 0pt;text-align: left;">? FNS [ 0]</p><p style="padding-top: 4pt;padding-left: 90pt;text-indent: 0pt;text-align: left;">: FNS extends [</p><p style="padding-top: 4pt;padding-left: 113pt;text-indent: 0pt;text-align: left;">infer FNFIRST extends FN,</p><p style="padding-top: 5pt;padding-left: 114pt;text-indent: 0pt;text-align: left;">• • -FN[] ,</p><p style="padding-top: 3pt;padding-left: 113pt;text-indent: 0pt;text-align: left;">infer FNLAST extends FN</p><p style="padding-top: 5pt;padding-left: 101pt;text-indent: 0pt;text-align: left;">]</p><p style="padding-top: 3pt;padding-left: 89pt;text-indent: 0pt;text-align: left;">? (...args: Parameters&lt;FNFIRST&gt;) =&gt; ReturnType&lt;FNLAST&gt;</p><p style="padding-top: 4pt;padding-left: 88pt;text-indent: 2pt;line-height: 144%;text-align: left;"><span>: never<br/>never;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 20pt;text-indent: 0pt;text-align: left;">272  Connecting Functions - Pipelining, Composition, and More</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">We first verify that the function’s types are correct, using FnsMatchPipeo. If the types match,</p><p style="padding-top: 2pt;padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>the type of the whole pipeline is that of a function that gets arguments of the same type as the first<br/>function in the pipeline and returns a value of the same type as the last pipelined function.</span></p><p style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>Now, our pipelines can be properly written - and we’ll have to use the same “overloading” as in the<br/>previous chapter to help TypeScript work out types:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 51pt;text-indent: 0pt;text-align: center;"><a name="bookmark341">function pipeline&lt;FNS </a><b>extends FN[]&gt;(</b></p><p class="s10" style="padding-top: 4pt;padding-left: 51pt;text-indent: 0pt;text-align: center;"><a name="bookmark342">...fns: FNS</a></p><p class="s10" style="padding-top: 4pt;padding-left: 46pt;text-indent: 0pt;text-align: center;">): Pipeline&lt;FNS&gt;;</p><p style="padding-top: 4pt;padding-left: 73pt;text-indent: -11pt;line-height: 142%;text-align: left;"><span>function pipeline&lt;FNS extends FN []&gt;(... fns: FNS): FN {<br/>return (...args: Parameters&lt;FNS[0]&gt;) =&gt; {</span></p><p style="padding-left: 86pt;text-indent: 0pt;text-align: left;">let result = fns[0](...args);</p><p style="padding-top: 4pt;padding-left: 97pt;text-indent: -11pt;line-height: 143%;text-align: left;"><span>for (let i = 1; i &lt; fns.length; i++) {<br/>result = fns [i] (result) ;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">return result;</p><p style="padding-top: 6pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">};</p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 51pt;text-indent: 0pt;text-align: center;">function pipeline2&lt;FNS <b>extends </b>FN[]&gt;(</p><p style="padding-top: 4pt;padding-left: 51pt;text-indent: 0pt;text-align: center;">...fns: FNS</p><p class="s10" style="padding-top: 4pt;padding-left: 45pt;text-indent: 0pt;text-align: center;">): Pipeline&lt;FNS&gt;;</p><p style="padding-top: 4pt;padding-left: 73pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>function pipeline2&lt;FNS extends FN[]&gt;(...fns: FNS): FN {<br/>return fns.reduce(</span></p><p style="padding-left: 100pt;text-indent: -12pt;line-height: 144%;text-align: left;"><span>(result, f) =&gt;<br/>(...args) =&gt;</span></p><p style="padding-left: 110pt;text-indent: 0pt;line-height: 10pt;text-align: left;">f(result(...args))</p><p style="padding-top: 5pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">) ;</p><p style="padding-top: 5pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 51pt;text-indent: 0pt;text-align: center;">function pipeline3&lt;FNS <b>extends FN[]&gt;(</b></p><p class="s10" style="padding-top: 4pt;padding-left: 51pt;text-indent: 0pt;text-align: center;"><a name="bookmark343">...fns: FNS</a><a name="bookmark344">&zwnj;</a></p><p class="s10" style="padding-top: 4pt;padding-left: 45pt;text-indent: 0pt;text-align: center;">): Pipeline&lt;FNS&gt;;</p><p style="padding-top: 4pt;padding-left: 51pt;text-indent: 0pt;text-align: center;">function pipeline3&lt;FNS extends FN[]&gt;(</p><p style="padding-top: 4pt;padding-left: 51pt;text-indent: 0pt;text-align: center;">...fns: FNS</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 402pt;text-indent: 0pt;text-align: left;">Pipelining  273</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">): (...fns: FNS) = &gt; FN {</p><p style="padding-top: 4pt;padding-left: 64pt;text-indent: 0pt;text-align: left;">return fns.reduce(pipeTwo);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: justify;">Before we look at other ways to connect functions, let’s consider how we would debug our pipelines.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 44pt;text-indent: 0pt;text-align: justify;"><a name="bookmark345">Debugging pipelines</a></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Now, let’s turn to a practical question: how do you debug your code? With pipelining, you can’t see<br/>what’s passed on from function to function, so how do you do it? We have two answers for that: one<br/>(also) comes from the Unix/Linux world, and the other (the most appropriate for this book) uses<br/>wrappers to provide some logs.</span></p><p class="s34" style="padding-top: 8pt;padding-left: 43pt;text-indent: 0pt;text-align: justify;">Using tee</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>The first solution we’ll use implies adding a function to the pipeline, which will just log its input. We<br/>want to implement something similar to the tee Linux command, which can intercept the standard<br/>data flow in a pipeline and send a copy to an alternate file or device. Remembering that /dev/tty<br/>is the usual console, we could execute something similar to the following and get an onscreen copy<br/>of everything that passes using the tee command:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 53pt;text-indent: 0pt;text-align: left;">$ Is -1 | grep &quot;odt$&quot; | tee /dev/tty | wc -1</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-top: 7pt;padding-left: 52pt;text-indent: 1pt;line-height: 142%;text-align: left;"><a name="bookmark346"><span>...the list of files with names ending in odt...<br/>4</span></a></p><p style="padding-top: 8pt;padding-left: 43pt;text-indent: 0pt;text-align: justify;">We could write a similar function with ease:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// pipeline_debug.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 64pt;text-indent: -11pt;line-height: 143%;text-align: left;"><span>const tee = &lt;A&gt;(arg: A)<br/>console.log(arg);<br/>return arg;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-top: 8pt;padding-left: 57pt;text-indent: 0pt;text-align: left;"><a name="bookmark347">Comma power!</a></p><p style="padding-top: 4pt;padding-left: 57pt;text-indent: 0pt;line-height: 113%;text-align: left;"><span>If you are aware of the uses of the comma operator, you can be more concise and write const<br/>tee2 = &lt;A&gt;(arg: A) =&gt; (console . log (arg) , arg)—do you see why? Check</span></p><p style="padding-left: 57pt;text-indent: 0pt;line-height: 111%;text-align: left;"><span>out developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/<br/>Operators/Ccmma_ Operator for the answer!</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 20pt;text-indent: 0pt;text-align: left;">274  Connecting Functions - Pipelining, Composition, and More</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Our logging function is short and to the point: it will receive a single argument, list it, and pass it on<br/>to the following function in the pipe. We can see it working in the following code:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 73pt;text-indent: -11pt;line-height: 143%;text-align: left;"><span>console.log(<br/>pipelines(</span></p><p style="padding-left: 85pt;text-indent: 0pt;line-height: 144%;text-align: left;"><a name="bookmark348"><span>getDir,<br/></span></a><b>tee,</b><span>filterOdt,<br/></span><b>tee,</b>count<a name="bookmark349">&zwnj;</a></p><p style="padding-left: 74pt;text-indent: 0pt;line-height: 10pt;text-align: left;"><a name="bookmark350">)(&quot;/home/fkereki/Documents&quot;)</a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 63pt;text-indent: 0pt;text-align: left;"><a name="bookmark351">...the list of all the files in the directory...</a></p><p class="s10" style="padding-top: 4pt;padding-left: 61pt;text-indent: 1pt;line-height: 144%;text-align: left;"><a name="bookmark352"><span>...the list of files with names ending in odt...<br/>4</span></a></p><p style="padding-top: 8pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>It would be even better if our tee () function could receive a logger function as a parameter, as in<br/>the </span><i>Logging in afunctional way </i>section of <i>Chapter 6, Producing Functions; </i><span>its just a matter of making<br/>the same kind of change we managed there. The same good design concepts are applied again!</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;"><a name="bookmark353">// continued...</a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">const tee2 = &lt;A&gt;(arg: A, <b>logger = console.log) =&gt; {</b></p><p style="padding-top: 4pt;padding-left: 73pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>logger(arg);<br/>return arg;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>This function works exactly in the same way as the previous tee (), although it will allow us to be<br/>more flexible when it comes to applying and testing. However, in our case, this would just be an extra<br/>enhancement to an already easily-testable function.</span></p><p style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: justify;"><span>Tet’s consider an even more generic tapping function, with more possibilities than just doing a bit<br/>of logging.</span></p><p class="s34" style="padding-top: 8pt;padding-left: 53pt;text-indent: 0pt;text-align: justify;">Tapping into a flow</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>If you wish, you could write an enhanced tee () function to produce more debugging information,<br/>send the reported data to a file or remote service, and so on—there are many possibilities you can</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 402pt;text-indent: 0pt;text-align: left;">Pipelining  275</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>explore. You could also explore a more general solution, of which tee () would be a particular case<br/>and allow us to create personalized tapping functions. This can be seen in the following diagram:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 99pt;text-indent: 0pt;text-align: left;"><span><img width="402" height="45" alt="image" src="Image_036.gif"/></span></p><p class="s211" style="padding-left: 215pt;text-indent: 10pt;text-align: left;"><span>some<br/>side-effect</span></p><p style="padding-top: 3pt;padding-left: 155pt;text-indent: -28pt;line-height: 135%;text-align: left;"><span>Figure 8.2 - Tapping allows you to apply a function so that you<br/>can inspect data as it flows through the pipeline</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>When working with pipelines, you may want to put a logging function in the middle of them, or you<br/>might want some other kind of </span><i>snooping </i><span>function—possibly for storing data somewhere, calling a<br/>service, or some other kind of side effect. We could have a generic tap () function to allow us to<br/>inspect data as it moves along our pipeline, which would behave in the following way:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">const tap = curry(&lt;A&gt;(fn: FN, x: A) =&gt; (fn(x), x));</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;">This is a candidate for the <i>trickiest-looking code-in-the-book </i><span>award, so let’s explain it. We want to<br/>produce a function that, given a function, f n (), and an argument, x, will evaluate f n (x) (to<br/>produce whatever sort of side effect we may be interested in) but return x (so the pipeline goes on<br/>without interference). The comma operator has exactly that behavior: if you write something similar<br/>to  (a, b, c), JavaScript will evaluate the three expressions in order and use the last value as the<br/>expression’s value.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Here, we can use currying to produce several different tapping functions. The one we wrote in the<br/>previous section, tee (), could also be written in the following fashion:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s9" style="padding-left: 53pt;text-indent: 0pt;text-align: left;">I<span class="p">/ continued...</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">const tee3 = tap(console.log);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: justify;"><span>By the way, you could have also written tap () without currying, but you’ll have to admit it loses<br/>some of its mystery! This is demonstrated here:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">const tap2 = (fn: FN) =&gt; &lt;A&gt;(x: A) =&gt; (fn(x), x);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;">This does exactly the same job, and you’ll recognize this way of currying from the <i>Currying by hand</i>section of <i>Chapter </i>7, <i>Transforming Functions. </i><span>Now that we have learned how to tap into a pipeline, let’s<br/>move on to a different way of logging by revisiting some concepts we looked at in previous chapters.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 20pt;text-indent: 0pt;text-align: left;">276  Connecting Functions - Pipelining, Composition, and More</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s34" style="padding-left: 53pt;text-indent: 0pt;text-align: left;">Using a logging wrapper</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;">The second idea we mentioned is based on the addLogging () function we wrote in the <i>Logging </i><span>section<br/>of </span><i>Chapter 6, Producing Functions. </i><span>The idea was to wrap a function with some logging functionality so<br/>that, on entry, the arguments would be printed and, on exit, the result of the function would be shown:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;text-align: left;">pipeline2(</p><p style="padding-top: 4pt;padding-left: 73pt;text-indent: 0pt;line-height: 143%;text-align: left;"><span>addLogging(getDir),<br/>addLogging(filterOdt),<br/>addLogging(count)</span></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">)(&quot;/home/fkereki/Documents&quot;);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;line-height: 141%;text-align: left;"><span>entering getDir(/home/fkereki/Documents)<br/>exiting getDir=&gt; ...list of files...</span></p><p style="padding-left: 61pt;text-indent: 0pt;line-height: 143%;text-align: left;"><span>entering filterOdt(...list of files, again...)<br/>exiting =&gt; .. .list of .odt files. . .<br/>entering count(...list of .odt files ...)<br/>exiting count=&gt;4</span></p><p style="padding-top: 8pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>We can trivially verify that the pipeline () function is doing its thing correctly—whatever a function<br/>produces as a result is given as input to the next function in the line, and we can also understand what’s<br/>happening with each call. Of course, you don’t need to add logging to every function in the pipeline:<br/>you would probably do so in places where you suspected an error was occurring.</span></p><p style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Now that we’ve looked at how to join functions, let’s look at a common way of defining functions in<br/>FP, </span><i>pointfree style, </i>which you may encounter.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 53pt;text-indent: 0pt;text-align: justify;"><a name="bookmark354">Pointfree style</a></p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>When you join functions together, either in a pipeline or with composition, as we’ll see later in this<br/>chapter, you don’t need any intermediate variables to hold the results that will become arguments to<br/>the following function in line: they are implicit. Similarly, you can write functions without mentioning<br/>their parameters; this is called the </span><i>pointfree style.</i></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: justify;">(By the way, pointfree style is also called <i>tacit </i>programming and <i>pointless </i><span>programming by detractors!<br/>The term point itself means a function parameter, while pointfree refers to not naming those parameters.)</span></p><p class="s34" style="padding-top: 8pt;padding-left: 52pt;text-indent: 0pt;text-align: justify;">Defining pointfree functions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>You can easily recognize a pointfree function definition because it doesn’t need the function keyword<br/>or the = &gt; arrow. Let’s revisit some of the previous functions we wrote in this chapter and check them<br/>out. For example, the definition of our original file-counting functions is as follows:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: right;">Pipelining 277</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 64pt;text-indent: -11pt;line-height: 146%;text-align: left;"><span>const count0dtFiles3 = (path: string): number =&gt;<br/>pipeTwo(pipeTwo(getDir, filterOdt), count)(path);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 64pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>const count0dtFiles4 = (path: string): number =&gt;<br/>pipeTwo(getDir, pipeTwo(filterOdt, count))(path);</span></p><p style="padding-top: 8pt;padding-left: 43pt;text-indent: 0pt;text-align: left;">The preceding code could be rewritten as follows:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// pointfree.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 64pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>const count0dtFiles3b = pipeTwo(<br/>pipeTwo(getDir,      filterOdt),<br/>count</span></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">) ;</p><p style="padding-top: 3pt;padding-left: 64pt;text-indent: -11pt;line-height: 143%;text-align: left;"><span>const count0dtFiles4b = pipeTwo(<br/>getDir,</span></p><p style="padding-left: 64pt;text-indent: 0pt;text-align: left;">pipeTwo(filterOdt, count)</p><p style="padding-top: 5pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: justify;">The new definitions don’t reference the parameter for the newly defined functions.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>You can deduce this by examining the first function in the pipeline (getDir (), in this case) and<br/>seeing what it receives as arguments. (Using type signatures, as we’ll see in </span><i>Chapter 12, Building Better</i><span>is of great help in terms of documentation, and complements TypeScript types.) In our<br/></span><i>Revisiting an example </i><span>section, we could have written a getLat () function to get the lat field out<br/>of   an object in a pointfree fashion:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">const getLat = curry(getField)(&quot;lat&quot;);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>What should the equivalent full-style definition be? You’d have to examine the getField () function<br/>(we looked at this in the </span><i>Revisiting an example </i><span>section) to decide that it expects an object as an<br/>argument. However, making that need explicit by writing the following wouldn’t make much sense:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">const getLat = (obj) =&gt; curry(getField)(&quot;lat&quot;)(obj);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: -9pt;line-height: 223%;text-align: left;"><span>If you were willing to write all this, you might wish to stick with the following:<br/>const getLat = (obj) =&gt; obj.lat;</span></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 10pt;text-align: justify;">Then, you simply wouldn’t need to worry about currying!</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 20pt;text-indent: 0pt;text-align: left;">278  Connecting Functions - Pipelining, Composition, and More</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s34" style="padding-left: 52pt;text-indent: 0pt;text-align: justify;">Converting to pointfree style</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>On the other hand, you had better pause for a minute and try not to write everything in pointfree<br/>code, at any cost. For example, consider the isNegativeBalance () function we wrote back in<br/></span><i>Chapter 6, Producing Functions:</i></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;text-align: left;">const isNegativeBalance = v =&gt; v.balance &lt; 0;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Can we write this in a pointfree style? Yes, we can, and we’ll see how—but I’m not sure we’d want<br/>to code this way! We can consider building a pipeline of two functions: one will extract the balance<br/>from the given object, while the other will check whether it’s negative. Due to this, we will write our<br/>alternative version of the balance-checking function like so:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 74pt;text-indent: -12pt;line-height: 144%;text-align: left;"><span>const isNegativeBalance2 = pipeline(getBalance,<br/>isNegative);</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>To extract the balance attribute from a given object, we can use getField. () and a bit of currying,<br/>and write the following:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;text-align: left;">const getBalance = curry(getField)(&quot;balance&quot;);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: justify;">For the second function, we could write the following code:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;text-align: left;">const isNegative = (x: number): boolean =&gt; x &lt; 0;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: justify;"><span>There goes our pointfree goal! Instead, we can use the binaryOp () function, also from the same<br/>chapter we mentioned earlier, plus some more currying, to write the following:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;text-align: left;">const isNegative = curry(binaryOp(&quot;&gt;&quot;))(0);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>I wrote the test the other way around (0 &gt;x instead of x&lt; 0) just for ease. An alternative would have<br/>been to use the enhanced functions I mentioned in the </span><i>A handier implementation </i>section of <i>Chapter 6,</i>which is a bit less complex, as follows:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 9pt;line-height: 220%;text-align: justify;"><span>const isNegative = binaryOpRight(&quot;&lt;&quot;, 0) ;<br/>So, finally, we could write the following:</span></p><p style="padding-left: 73pt;text-indent: -12pt;line-height: 144%;text-align: left;">const isNegativeBalance2 = <b>pipeline(</b><span>curry(getField) (&quot;balance&quot;) ,<br/>curry(binaryOp(&quot;&gt;&quot;)) (0)</span></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 326pt;text-indent: 0pt;text-align: left;">Chaining and fluent interfaces  279</p><p style="padding-top: 9pt;padding-left: 53pt;text-indent: -9pt;line-height: 23pt;text-align: left;"><span>Alternatively, we could write the following:<br/>const isNegativeBalance3 = </span><b>pipeline!</b></p><p style="padding-top: 4pt;padding-left: 64pt;text-indent: 0pt;line-height: 142%;text-align: left;"><span>curry(getField)(&quot;balance&quot;),<br/>binaryOpRight(&quot;&lt;&quot;, 0)</span></p><p style="padding-top: 1pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 115%;text-align: justify;"><span>Is that an improvement? Our new versions of isNegativeBalance () don’t make a reference to<br/>their argument and are fully pointfree, but the idea of using pointfree style should be to help improve the<br/>clarity and readability of your code and not to produce obfuscation and opaqueness! I doubt anybody<br/>would look at our new versions of the function and consider them to be an advantage over the original.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>If you find that your code is becoming harder to understand due to using pointfree programming,<br/>stop and roll back your changes. Remember our doctrine for this book: we want to do FP, but we don’t<br/>want to go overboard with it—and using the pointfree style is not a requirement!</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>In this section, we’ve learned how to build pipelines of functions—this is a powerful technique. For<br/>objects and arrays, however, we have another special technique that you may have used already:<br/></span><i>chaining. </i>Let’s take a look at this now.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-left: 43pt;text-indent: 0pt;text-align: justify;"><a name="bookmark355">Chaining and fluent interfaces</a></p><p style="padding-top: 9pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: left;"><span>When you work with objects or arrays, there is another way of linking the execution of several calls<br/>together: by applying </span><i>chaining. </i><span>For example, when you work with arrays, if you apply a map ()<br/>or  filter () method, the result is a new array, to which you can then apply another map () or<br/>filter () function, and so forth. We used these methods when we defined the range () function<br/>back in the </span><i>Working with ranges </i>section of <i>Chapter 5, Programming Declaratively:</i></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 64pt;text-indent: -11pt;line-height: 142%;text-align: left;"><span>const range = (start: number, stop: number): number!] =&gt;<br/>new Array(stop - start) .fill (0) .map((v, i) = &gt; start + i) ;</span></p><p style="padding-top: 8pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>First, we created a new array; then, we applied the fill () method to it, which updated the array<br/>in place (side effect) and returned the updated array, to which we finally applied a map () method.<br/>The latter method generated a new array, to which we could have applied further mapping, filtering,<br/>or any other available method.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><a name="bookmark356"><span>Let’s take a look at a common example of fluent APIs, which work by chaining, and then consider<br/>how we can do this on our own.</span></a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 43pt;text-indent: 0pt;text-align: left;">An example of fluent APIs</p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>This style of continuous chained operations is also used in fluent APIs or interfaces. To give just one<br/>example, the graphic D3 . j s library (see d3 j s . org for more on it) frequently uses this style. The<br/>following example, taken from bl. ocks . org/mbostock/4 0632 6 9, shows it in action:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 20pt;text-indent: 0pt;text-align: left;">280  Connecting Functions - Pipelining, Composition, and More</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;text-align: left;">var node = svg</p><p style="padding-top: 4pt;padding-left: 75pt;text-indent: 0pt;text-align: left;">.selectAll(&quot;.node&quot;)</p><p style="padding-top: 4pt;padding-left: 75pt;text-indent: 0pt;text-align: left;">.data(pack(root).leaves())</p><p style="padding-top: 4pt;padding-left: 75pt;text-indent: 0pt;text-align: left;">.enter()</p><p style="padding-top: 4pt;padding-left: 75pt;text-indent: 0pt;text-align: left;">.append(&quot;g&quot;)</p><p style="padding-top: 4pt;padding-left: 75pt;text-indent: 0pt;text-align: left;">.attr(&quot;class&quot;, &quot;node&quot;)</p><p style="padding-top: 4pt;padding-left: 75pt;text-indent: 0pt;text-align: left;">.attr(&quot;transform&quot;, function (d) {</p><p style="padding-top: 4pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">return &quot;translate(&quot; + d.x +             + d.y + &quot;)&quot;;</p><p style="padding-top: 6pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">});</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 5pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">node</p><p style="padding-top: 4pt;padding-left: 75pt;text-indent: 0pt;text-align: left;">.append(&quot;circle&quot; )</p><p style="padding-top: 4pt;padding-left: 85pt;text-indent: -10pt;line-height: 144%;text-align: left;"><span>.attr(&quot;id&quot;, function (d) {<br/>return d.id;</span></p><p style="padding-top: 2pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">})</p><p style="padding-top: 2pt;padding-left: 85pt;text-indent: -10pt;line-height: 142%;text-align: left;"><span>.attr(&quot;r&quot;, function (d) {<br/>return d.r;</span></p><p style="padding-top: 2pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">})</p><p style="padding-top: 2pt;padding-left: 85pt;text-indent: -10pt;line-height: 142%;text-align: left;"><span>.style(&quot;fill&quot;,    function    (d)    {<br/>return color(d.package);</span></p><p style="padding-top: 2pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">});</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>Each method works on the previous object and provides access to a new object to which future method<br/>calls will be applied (such as the selectAll () or append () methods) or updates the current</span></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>one (as the attr () attribute setting calls do). This style is not unique, and several other well-known<br/>libraries (j Query comes to mind) also apply it.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>Can we automate this? In this case, the answer is “possibly, but Id rather not.” I think using pipeline ()<br/>or compose () works just as well and achieves the same thing. With object chaining, you are limited</span></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: left;"><span>to returning new objects or arrays or something that methods can be applied to. (Remember, if you are<br/>working with standard types, such as strings or numbers, you can’t add methods to them unless you<br/>mess with their prototype, which isn’t recommended!). With composition, however, you can return<br/>any value; the only restriction is that the next function in line must expect the data type you provide.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: left;"><span>On the other hand, if you are writing your own API, you can provide a fluent interface by just having<br/>each method return this—unless it needs to return something else! If you were working with<br/>someone else’s API, you could also do some trickery by using a proxy. However, be aware that there<br/>may be cases in which your proxied code might fail: maybe another proxy is being used, or there are<br/>some getters or setters that somehow cause problems, and so on.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 326pt;text-indent: 0pt;text-align: left;">Chaining and fluent interfaces  281</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 57pt;text-indent: 0pt;text-align: left;"><a name="bookmark357">On proxies</a></p><p style="padding-top: 4pt;padding-left: 57pt;text-indent: 0pt;line-height: 115%;text-align: left;"><span>You may want to read up on proxy objects at developer. mozilla. org/en/docs/Web/<br/>JavaScript/Ref erence/Global_Obj ects/Proxy - they are very powerful and allow</span></p><p style="padding-left: 57pt;text-indent: 0pt;line-height: 115%;text-align: left;"><span>for interesting metaprogramming functionalities. Still, they can trap you with technicalities<br/>and will cause an (albeit slight) slowdown in your proxied code.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;text-align: left;">Lets now look at how to chain calls so we can do this with any class.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 43pt;text-indent: 0pt;text-align: left;"><a name="bookmark358">Chaining method calls</a></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>Let’s go for a basic example. We have a City class with name, latitude (lat), and longitude<br/>(long) attributes:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// chaining.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 64pt;text-indent: -11pt;line-height: 143%;text-align: left;"><span>class City {<br/>name: string;<br/>lat: number;<br/>long: number;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 77pt;text-indent: -12pt;line-height: 144%;text-align: left;"><span>constructor(name: string, lat: number, long: number) {<br/>this.name = name;</span></p><p style="padding-left: 77pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>this.lat = lat;<br/>this.long = long;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 6pt;padding-left: 64pt;text-indent: 0pt;text-align: left;">getName() {</p><p style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">return this.name;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 76pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>setName(newName: string) {<br/>this.name = newName;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 6pt;padding-left: 76pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>setLat(newLat: number) {<br/>this.lat = newLat;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 20pt;text-indent: 0pt;text-align: left;">282  Connecting Functions - Pipelining, Composition, and More</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 85pt;text-indent: -11pt;line-height: 143%;text-align: left;"><span>setLong(newLong: number) {<br/>this.long = newLong;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 6pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">getCoordsO {</p><p style="padding-top: 4pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">return [this.lat, this.long];</p><p style="padding-top: 6pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">}</p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>This is a common class with a few methods; everything’s quite normal. We could use this class as<br/>follows and provide details about my native city, Montevideo, Uruguay:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 74pt;text-indent: -13pt;line-height: 144%;text-align: left;"><span>const myCity = new City(<br/>&quot;Montevideo, Uruguay&quot;,</span></p><p style="padding-left: 74pt;text-indent: 0pt;line-height: 10pt;text-align: left;">-34.9011,</p><p style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">-56.1645</p><p style="padding-top: 5pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">) ;</p><p style="padding-top: 3pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">console.log(myCity.getCoords(), myCity.getName() ) ;</p><p class="s10" style="padding-top: 4pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">// [ -34.9011, -56.1645 ] &#39;Montevideo, Uruguay&#39;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: left;"><span>If we wanted the setters to be handled in a fluent manner, we could set up a proxy to detect these calls<br/>and provide the missing return this. How can we do that? If the original method doesn’t return<br/>anything, JavaScript will include a return undefined statement by default so that we can detect<br/>whether  that’s what the method returns and substitute return this instead. Of course, this is a</span></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: left;"><span>problem: what would we do if we had a method that could legally return undefined because of its<br/>semantics? We could have some kind of exceptions list to tell our proxy not to add anything in those<br/>cases, but let’s not get into that.</span></p><p style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>The code for our handler is as follows. Whenever the method of an object is invoked, a get () is<br/>implicitly called, and we catch it. If we get a function, we wrap it with some code of our own that will<br/>call the original method and then decide whether to return its value or a reference to the proxied object<br/>instead. If we didn’t get a function, we would return the requested property’s value. Our chaini f y ()<br/>function will take care of assigning the handler to an object and creating the needed proxy:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// chainify.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 73pt;text-indent: -11pt;line-height: 143%;text-align: left;"><span>const chainify = &lt;OBJ extends { [key: string]: any }&gt;(<br/>obj: OBJ</span></p><p style="padding-left: 73pt;text-indent: -10pt;line-height: 143%;text-align: left;"><span>): Chainify&lt;OBJ&gt; =&gt;<br/>new Proxy(obj, {</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 326pt;text-indent: 0pt;text-align: left;">Chaining and fluent interfaces  283</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 76pt;text-indent: 0pt;text-align: left;">get (target, property, receiver) {</p><p style="padding-top: 4pt;padding-left: 89pt;text-indent: 0pt;text-align: left;">if (typeof property === &quot;string&quot;) {</p><p style="padding-top: 4pt;padding-left: 101pt;text-indent: 0pt;text-align: left;">if (typeof target[property] === &quot;function&quot;) {</p><p style="padding-top: 4pt;padding-left: 113pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>// requesting a method? return a wrapped version<br/>return (...args: any[]) =&gt; {</span></p><p style="padding-left: 124pt;text-indent: 0pt;line-height: 143%;text-align: left;"><span>const result = target[property](...args);<br/>return result === undefined ? receiver :</span></p><p style="padding-left: 136pt;text-indent: 0pt;text-align: left;">result;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 101pt;text-indent: 0pt;text-align: left;">} else {</p><p style="padding-top: 4pt;padding-left: 112pt;text-indent: 0pt;line-height: 143%;text-align: left;"><span>// an attribute was requested - just return it<br/>return target[property];</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 89pt;text-indent: 0pt;text-align: left;">} else {</p><p style="padding-top: 4pt;padding-left: 101pt;text-indent: 0pt;text-align: left;">return Reflect.get(target, property, receiver);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 65pt;text-indent: 0pt;line-height: 11pt;text-align: left;"><span><img width="20" height="15" alt="image" src="Image_037.gif"/></span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>We must check whether the invoked get () was for a function or an attribute. In the first case, we wrap<br/>the method with extra code so that it will execute it and then return its results (if any) or a reference<br/>to the object itself. In the second case, we return the attribute, which is the expected behavior. (For<br/>the use of Ref lect. get (), check out developer . mozilla . org/en-US/docs/Web/<br/>JavaScript/Reference/Global_Objects/Refleet/get.)</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>What’s the type of a “chainified” object? Any property that isn’t a function is the same. A property<br/>that is a function that returns some non-void value is also still the same. However, if a function<br/>returns void, we wrap it, so it returns the object itself. The Chainify&lt; &gt; type definition does that:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">type Chainify&lt;A extends { [key: string]: any }&gt; = {</p><p style="padding-top: 4pt;padding-left: 67pt;text-indent: 0pt;text-align: left;">[key in keyof A]: A[key] extends (...args: any[]) =&gt; any</p><p style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">? void extends ReturnType&lt;A[key]&gt;</p><p style="padding-top: 4pt;padding-left: 89pt;text-indent: 0pt;text-align: left;">? (...args: Parameters&lt;A[key]&gt;) =&gt; Chainify&lt;A&gt;</p><p style="padding-top: 4pt;padding-left: 90pt;text-indent: 0pt;text-align: left;">: (...args: Parameters&lt;A[key]&gt;) =&gt; ReturnType&lt;A[key]&gt;</p><p style="padding-top: 4pt;padding-left: 78pt;text-indent: 0pt;text-align: left;">: A[key];</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 20pt;text-indent: 0pt;text-align: left;">284  Connecting Functions - Pipelining, Composition, and More</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>With this, we can chainify any object so that we can inspect any called method. As I’m writing this,<br/>I’m currently living in Pune, India, so let’s reflect that change:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;text-align: left;">const myCity2 = chainify(myCity);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 73pt;text-indent: -11pt;line-height: 142%;text-align: left;"><span>console.log(<br/>myCity2</span></p><p style="padding-left: 87pt;text-indent: 0pt;text-align: left;">.setName(&quot;Pune, India&quot;)</p><p style="padding-top: 4pt;padding-left: 87pt;text-indent: 0pt;text-align: left;">.setLat(18.5626)</p><p style="padding-top: 4pt;padding-left: 87pt;text-indent: 0pt;text-align: left;">.setLong(73.8087)</p><p style="padding-top: 4pt;padding-left: 73pt;text-indent: 14pt;line-height: 144%;text-align: left;"><span>.getCoords(),<br/>myCity.getName()</span></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">) ;</p><p style="padding-top: 3pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">// [ 18.5626, 73.8087 ] &#39;Pune, India<span class="s162">1</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: justify;">Notice the following:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l98"><li data-list-text="•"><p class="s33" style="padding-left: 79pt;text-indent: -12pt;line-height: 123%;text-align: justify;">	<span class="p">The type of myCity2 (which is chainified) is different from the type of myCity. For instance,<br/>myCity2.setLong()  is  now  of  thesetLong(newLong:  number)  :  Chainify&lt;City&gt;<br/>type instead of set Long (newLong : number) : void as before. (See </span><span class="s9">Question 8.8.)</span></p></li><li data-list-text="•"><p style="padding-top: 5pt;padding-left: 79pt;text-indent: -13pt;line-height: 123%;text-align: justify;"><span>We call several setters in a fluent manner, and they are working fine since our proxy is taking<br/>care of providing the value for the following call.</span></p></li><li data-list-text="•"><p class="s33" style="padding-top: 5pt;padding-left: 79pt;text-indent: -12pt;line-height: 123%;text-align: justify;">	<span class="p">The calls to getCoords () and getName () are intercepted, but nothing special is done<br/>because they already return a value.</span></p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Is working in a chained way worth it? That’s up to you—but remember that there may be cases in<br/>which this approach fails, so be wary! Now, let’s move on to composing, the other most common way<br/>of joining functions.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-left: 52pt;text-indent: 0pt;text-align: left;"><a name="bookmark359">Composing</a></p><p class="s9" style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;">Composing <span class="p">is quite similar to pipelining, but has its roots in mathematical theory. The concept of<br/>composition is a sequence of function calls in which the output of one function is the input for the<br/>next one—but in the opposite order to when pipelining. So, if you have a series of functions, from left<br/>to right, when pipelining, the first function of the series to be applied is the leftmost one, but when<br/>you use composition, you start with the rightmost one.</span></p><p style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>Let’s investigate this a bit more. When you define the composition of, say, three functions as (f °g°h)<br/>and apply this composition to x, this is equivalent to writing f (g (h (x) ) ).</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 396pt;text-indent: 0pt;text-align: left;">Composing  285</p><p style="padding-top: 22pt;padding-left: 43pt;text-indent: 0pt;line-height: 115%;text-align: justify;"><span>It’s important to note that, as with pipelining, the arity of the first function to be applied (actually<br/>the last one in the list) can be anything, but all the other functions must be unary. Also, besides the<br/>difference in the sequence of function evaluation, composing is an important tool in FP: it abstracts<br/>the implementation details (putting your focus on what you need to accomplish rather than on the<br/>specific details for achieving that), thereby letting you work in a more declarative fashion.</span></p><p style="padding-top: 4pt;padding-left: 42pt;text-indent: 0pt;text-align: justify;">/ \</p><p class="s10" style="padding-top: 3pt;padding-left: 57pt;text-indent: 0pt;text-align: left;">Tip for reading</p><p style="padding-top: 4pt;padding-left: 57pt;text-indent: 0pt;line-height: 115%;text-align: left;">If it helps, you can read (/°g°fi) as “/after <i>g </i>after <i>h” </i>so that it becomes clear that <i>h </i><span>is the first<br/>function to be applied, while/is the last.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;line-height: 115%;text-align: justify;"><span>Given its similarity to pipelining, it will be no surprise that implementing composition isn’t very hard.<br/>However, there are still some important and interesting details. Let’s see some examples of composition<br/>before moving on to using higher-order functions and finishing with some considerations about<br/>testing composed functions.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 43pt;text-indent: 0pt;text-align: justify;"><a name="bookmark360">Some examples of composition</a></p><p style="padding-top: 9pt;padding-left: 43pt;text-indent: 0pt;line-height: 115%;text-align: justify;"><span>It may not be a surprise to you, but we have already seen several examples of composition—or, at the<br/>very least, cases in which the solutions we achieved were functionally equivalent to using composition.<br/>Let’s review some of these and work with some new examples too.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s34" style="padding-left: 43pt;text-indent: 0pt;text-align: justify;">Unary operators</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 115%;text-align: left;">In the <i>Logically negating a function </i>section of <i>Chapter 6, Producing Functions, </i><span>we wrote a not ()<br/>function that, given another function, would logically invert its result. We used that function to negate<br/>a check for negative balances; the sample code for this (and I’m going with plain JavaScript here, for<br/>clarity) could be as follows:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">const not = (fn) =&gt; (...args) =&gt; !fn(...args);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">const positiveBalance = not(isNegativeBalance);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 115%;text-align: justify;">In another section <i>(Turning operations into functions&#39;) </i><span>of that chapter, I left you with the challenge of<br/>writing a unaryOp () function that would provide unary functions equivalent to common JavaScript<br/>operators. If you met that challenge, you should be able to write something such as the following:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">const logicalNot = unaryOp(&quot;!&quot;);</p><p style="padding-left: 52pt;text-indent: -9pt;line-height: 23pt;text-align: left;"><span>Assuming the existence of a compose () function, you could have also written the following:<br/>const positiveBalance = </span><b>compose(</b></p><p class="s10" style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>logicalNot,<br/>isNegativeBalance</span></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 20pt;text-indent: 0pt;text-align: left;">286  Connecting Functions - Pipelining, Composition, and More</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Which one do you prefer? It’s a matter of taste—but I think the second version clarifies what we are<br/>trying to do better. With the not () function, you must check what it does to understand the general<br/>code. With composition, you still need to know what logicalNot () is, but the global construct<br/>is open to see.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>To look at just one more example in the same vein, you could have achieved the same results that we<br/>got in the </span><i>Inverting the results </i><span>section in the same chapter. Recall that we had a function that could<br/>compare strings according to the rules of Spanish, but we wanted to invert the result of the comparison<br/>so that it was sorted in descending order:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;text-align: left;"><a name="bookmark361">const changesign = unaryOp(&quot;-&quot;);</a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">palabras.sort<b>(compose(changesign, spanishComparison));</b></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>This code produces the same result that our previous sorting problem did, but the logic is expressed<br/>more clearly and with less code: a typical FP result! Let’s look at some more examples of composing<br/>functions by reviewing another task we discussed earlier.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s34" style="padding-left: 52pt;text-indent: 0pt;text-align: justify;">Counting files</p><p style="padding-top: 1pt;padding-left: 61pt;text-indent: -9pt;line-height: 23pt;text-align: left;"><span>We can also go back to our pipeline. We wrote a single-line function to count the odt files in a given path:<br/>const count0dtFiles2 = (path: string): number =&gt;</span></p><p class="s10" style="padding-top: 1pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">count(filterOdt(getDir(path)));</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Disregarding (at least for the moment) the observation that this code is not as clear as the pipeline<br/>version that we developed later, we could have also written this function with composition:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 47pt;text-indent: 0pt;text-align: center;">const count0dtFiles2b = (path: string): number =&gt;</p><p class="s10" style="padding-top: 4pt;padding-left: 45pt;text-indent: 0pt;text-align: center;">compose(count, filterOdt, getDir)(path);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">count0dtFiles2b(&quot;/home/fkereki/Documents&quot;);</p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">// 4, no change here</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: justify;">We may also see this written in a one-liner fashion:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;text-align: left;">compose(count, filterOdt, getDir)(&quot;/home/fkereki/Documents&quot;);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Even if it’s not as clear as the pipeline version (and that’s just my opinion, which may be biased due<br/>to my liking of Linux!), this declarative implementation makes it clear that we depend on combining<br/>three distinct functions to get our result—this is easy to see and applies the idea of building large<br/>solutions out of simpler pieces of code.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;text-align: justify;">Let’s take a look at another example that’s designed to compose as many functions as possible.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 12pt;padding-left: 396pt;text-indent: 0pt;text-align: left;">Composing  287</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s34" style="padding-top: 8pt;padding-left: 43pt;text-indent: 0pt;text-align: justify;">Finding unique words</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Finally, let’s go for another example, which, I agree, could have also been used for pipelining. Suppose<br/>you have some text and want to extract all the unique words from it: how would you go about doing<br/>so? If you think about it in steps (instead of trying to create a full solution in one go), you would<br/>probably come up with a solution similar to this:</span></p><ol id="l99"><li data-list-text="1."><p style="padding-top: 8pt;padding-left: 70pt;text-indent: -17pt;text-align: left;">Ignore all non-alphabetic characters.</p></li><li data-list-text="2."><p style="padding-top: 6pt;padding-left: 69pt;text-indent: -17pt;text-align: left;">Put everything in uppercase.</p></li><li data-list-text="3."><p style="padding-top: 6pt;padding-left: 70pt;text-indent: -17pt;text-align: left;">Split the text into words.</p></li><li data-list-text="4."><p style="padding-top: 6pt;padding-left: 69pt;text-indent: -17pt;text-align: left;">Create a set of words.</p></li></ol><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>(Why a set? Because it automatically discards repeated values; check out developer. mozilia .<br/>org/ en/docs/Web/ JavaScript/Ref erence/Global_Ob j ects/Set for more on</span></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>this. By the way, we will use the Array. from () method to produce an array out of our set; see<br/>developer.mozilia.org/en-US/docs/Web/JavaScript/Reference/Global_</span></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 192%;text-align: left;"><span>Ob j ects/Array/from for more on this.)<br/>Now, using FP, let’s solve each problem:</span></p><p style="padding-top: 2pt;padding-left: 65pt;text-indent: -12pt;line-height: 146%;text-align: left;"><span>const removeNonAlpha = (str: string): string =&gt;<br/>str.replace(/[</span><span class="s162">A</span>a-z]/gi, &quot; &quot;);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 64pt;text-indent: -12pt;line-height: 143%;text-align: left;"><span>const toUpperCase = demethodize(<br/>String.prototype.toUpperCase</span></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 6pt;padding-left: 65pt;text-indent: -12pt;line-height: 144%;text-align: left;"><span>const splitlnWords = (str: string) : string [] =&gt;<br/>str.trim().split(/\s+/);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 64pt;text-indent: -11pt;line-height: 142%;text-align: left;"><span>const arrayToSet = (arr: string!]): Set&lt;string&gt; =&gt;<br/>new Set(arr);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 64pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>const setToList = (set: Set&lt;string&gt;): string!] =&gt;<br/>Array.from(set).sort();</span></p><p style="padding-top: 8pt;padding-left: 43pt;text-indent: 0pt;text-align: left;">With these functions, the result can be written as follows:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">const getUniqueWords = <b>compose(</b></p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">setToList,</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 20pt;text-indent: 0pt;text-align: left;">288  Connecting Functions - Pipelining, Composition, and More</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 73pt;text-indent: 0pt;line-height: 143%;text-align: left;"><span>arrayToSet,<br/>splitlnWords,<br/>toUpperCase,<br/>removeNonAlpha</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>Since you don’t get to see the arguments of any of the composed functions, you don’t need to show<br/>the parameter for getUniqueWords () either, so the pointfree style is natural in this case.</span></p><p style="padding-top: 7pt;padding-left: 50pt;text-indent: 1pt;line-height: 124%;text-align: left;"><span>Now, let’s test our function. To do this, let’s apply this function to the first two sentences of Abraham<br/>Lincoln’s address at Gettysburg (which we already used in an example back in the </span><i>Mapping and</i>section of <i>Chapter 5, Programming Declaratively) </i><span>and print out the 43 different<br/>words (trust me, I counted them!) in it:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;text-align: left;">const GETTYSBURG_1_2 = &#39;Four score and seven years ago</p><p style="padding-top: 4pt;padding-left: 61pt;text-indent: 0pt;line-height: 115%;text-align: left;"><span>our fathers brought forth on this continent, a new nation,<br/>conceived in liberty, and dedicated to the proposition that all<br/>men  are created equal. Now we are engaged in a great civil war,<br/>testing whether that nation, or any nation so conceived and so<br/>dedicated, can long</span></p><table style="border-collapse:collapse" cellspacing="0"><tr style="height:13pt"><td style="width:80pt"><p class="s29" style="padding-left: 2pt;text-indent: 0pt;line-height: 10pt;text-align: left;">// Output: 43</p></td><td style="width:94pt"><p class="s29" style="padding-left: 5pt;text-indent: 0pt;line-height: 10pt;text-align: left;">words, namely</p></td><td style="width:58pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:15pt"><td style="width:80pt"><p class="s215" style="padding-top: 1pt;padding-left: 16pt;text-indent: 0pt;text-align: left;">1 <span class="s216">A</span>1 <span class="s216">,</span></p></td><td style="width:94pt"><p class="s29" style="padding-top: 2pt;padding-left: 25pt;text-indent: 0pt;text-align: left;">&#39;AGO&#39;,</p></td><td style="width:58pt"><p class="s29" style="padding-top: 1pt;padding-left: 10pt;text-indent: 0pt;text-align: left;">&#39;ALL&#39;,</p></td></tr><tr style="height:15pt"><td style="width:80pt"><p class="s29" style="padding-top: 1pt;padding-left: 15pt;text-indent: 0pt;text-align: left;">&#39;AND&#39;,</p></td><td style="width:94pt"><p class="s29" style="padding-top: 1pt;padding-left: 25pt;text-indent: 0pt;text-align: left;">&#39;ANY&#39;,</p></td><td style="width:58pt"><p class="s29" style="padding-top: 1pt;padding-left: 10pt;text-indent: 0pt;text-align: left;">&#39;ARE&#39;,</p></td></tr><tr style="height:15pt"><td style="width:80pt"><p class="s29" style="padding-top: 2pt;padding-left: 16pt;text-indent: 0pt;text-align: left;">&#39;BROUGHT&#39;,</p></td><td style="width:94pt"><p class="s29" style="padding-top: 2pt;padding-left: 25pt;text-indent: 0pt;text-align: left;">&#39;CAN&#39;,</p></td><td style="width:58pt"><p class="s29" style="padding-top: 2pt;padding-left: 10pt;text-indent: 0pt;text-align: left;">&#39;CIVIL&#39;,</p></td></tr><tr style="height:15pt"><td style="width:80pt"><p class="s29" style="padding-top: 2pt;padding-left: 15pt;text-indent: 0pt;text-align: left;">&#39;CONCEIVED&#39;,</p></td><td style="width:94pt"><p class="s29" style="padding-top: 2pt;padding-left: 25pt;text-indent: 0pt;text-align: left;">&#39;CONTINENT&#39;,</p></td><td style="width:58pt"><p class="s29" style="padding-top: 2pt;padding-left: 10pt;text-indent: 0pt;text-align: left;">&#39;CREATED</p></td></tr><tr style="height:15pt"><td style="width:80pt"><p class="s29" style="padding-top: 2pt;padding-left: 16pt;text-indent: 0pt;text-align: left;">&#39;DEDICATED&#39;,</p></td><td style="width:94pt"><p class="s29" style="padding-top: 2pt;padding-left: 25pt;text-indent: 0pt;text-align: left;">&#39;ENDURE&#39;,</p></td><td style="width:58pt"><p class="s29" style="padding-top: 2pt;padding-left: 10pt;text-indent: 0pt;text-align: left;">&#39;ENGAGED</p></td></tr><tr style="height:15pt"><td style="width:80pt"><p class="s29" style="padding-top: 1pt;padding-left: 16pt;text-indent: 0pt;text-align: left;">&#39;EQUAL&#39;,</p></td><td style="width:94pt"><p class="s29" style="padding-top: 2pt;padding-left: 25pt;text-indent: 0pt;text-align: left;">&#39;FATHERS&#39;,</p></td><td style="width:58pt"><p class="s29" style="padding-top: 1pt;padding-left: 10pt;text-indent: 0pt;text-align: left;">&#39;FORTH&#39;,</p></td></tr><tr style="height:15pt"><td style="width:80pt"><p class="s29" style="padding-top: 1pt;padding-left: 15pt;text-indent: 0pt;text-align: left;">&#39;FOUR&#39;,</p></td><td style="width:94pt"><p class="s29" style="padding-top: 1pt;padding-left: 25pt;text-indent: 0pt;text-align: left;">&#39;GREAT&#39;,</p></td><td style="width:58pt"><p class="s29" style="padding-top: 1pt;padding-left: 10pt;text-indent: 0pt;text-align: left;">&#39; IN&#39; ,</p></td></tr><tr style="height:15pt"><td style="width:80pt"><p class="s29" style="padding-top: 2pt;padding-left: 15pt;text-indent: 0pt;text-align: left;">&#39;LIBERTY&#39;,</p></td><td style="width:94pt"><p class="s29" style="padding-top: 2pt;padding-left: 25pt;text-indent: 0pt;text-align: left;">&#39;LONG&#39;,</p></td><td style="width:58pt"><p class="s29" style="padding-top: 2pt;padding-left: 10pt;text-indent: 0pt;text-align: left;">&#39;MEN&#39;,</p></td></tr><tr style="height:15pt"><td style="width:80pt"><p class="s29" style="padding-top: 2pt;padding-left: 15pt;text-indent: 0pt;text-align: left;">&#39;NATION&#39;,</p></td><td style="width:94pt"><p class="s29" style="padding-top: 2pt;padding-left: 25pt;text-indent: 0pt;text-align: left;">&#39;NEW&#39;,</p></td><td style="width:58pt"><p class="s29" style="padding-top: 2pt;padding-left: 10pt;text-indent: 0pt;text-align: left;">&#39;NOW&#39;,</p></td></tr><tr style="height:15pt"><td style="width:80pt"><p class="s29" style="padding-top: 2pt;padding-left: 16pt;text-indent: 0pt;text-align: left;">&#39;ON&#39; ,</p></td><td style="width:94pt"><p class="s29" style="padding-top: 2pt;padding-left: 25pt;text-indent: 0pt;text-align: left;">&#39;OR&#39; ,</p></td><td style="width:58pt"><p class="s29" style="padding-top: 2pt;padding-left: 10pt;text-indent: 0pt;text-align: left;">&#39;OUR&#39;,</p></td></tr><tr style="height:15pt"><td style="width:80pt"><p class="s29" style="padding-top: 1pt;padding-left: 16pt;text-indent: 0pt;text-align: left;">&#39;PROPOSITION</p></td><td style="width:94pt"><p class="s29" style="padding-top: 1pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">■&#39; , &#39;SCORE&#39; ,</p></td><td style="width:58pt"><p class="s29" style="padding-top: 1pt;padding-left: 10pt;text-indent: 0pt;text-align: left;">&#39;SEVEN&#39;,</p></td></tr><tr style="height:15pt"><td style="width:80pt"><p class="s29" style="padding-top: 2pt;padding-left: 16pt;text-indent: 0pt;text-align: left;">&#39; SO&#39; ,</p></td><td style="width:94pt"><p class="s29" style="padding-top: 2pt;padding-left: 25pt;text-indent: 0pt;text-align: left;">&#39;TESTING&#39;,</p></td><td style="width:58pt"><p class="s29" style="padding-top: 2pt;padding-left: 10pt;text-indent: 0pt;text-align: left;">&#39;THAT&#39;,</p></td></tr><tr style="height:15pt"><td style="width:80pt"><p class="s29" style="padding-top: 1pt;padding-left: 15pt;text-indent: 0pt;text-align: left;">&#39;THE&#39;,</p></td><td style="width:94pt"><p class="s29" style="padding-top: 1pt;padding-left: 25pt;text-indent: 0pt;text-align: left;">&#39;THIS&#39;,</p></td><td style="width:58pt"><p class="s29" style="padding-top: 1pt;padding-left: 10pt;text-indent: 0pt;text-align: left;">&#39;TO&#39; ,</p></td></tr><tr style="height:13pt"><td style="width:80pt"><p class="s29" style="padding-top: 2pt;padding-left: 15pt;text-indent: 0pt;line-height: 9pt;text-align: left;">&#39;WAR&#39;,</p></td><td style="width:94pt"><p class="s29" style="padding-top: 2pt;padding-left: 25pt;text-indent: 0pt;line-height: 9pt;text-align: left;">&#39;WE&#39; ,</p></td><td style="width:58pt"><p class="s29" style="padding-top: 2pt;padding-left: 10pt;text-indent: 0pt;line-height: 9pt;text-align: left;">&#39;WHETHER</p></td></tr></table><p style="text-indent: 0pt;text-align: left;"/><p style="padding-top: 2pt;padding-left: 61pt;text-indent: 0pt;line-height: 287%;text-align: left;"><span>endure.&#39;;<br/>console.log(getUniqueWords(GETTYSBURG_1_2));</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s217" style="padding-left: 75pt;text-indent: 0pt;text-align: left;">1 <span class="s218">YEARS&#39;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 396pt;text-indent: 0pt;text-align: left;">Composing  289</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Of course, you could have written getUniqueWords () more succinctly, but the point I’m making<br/>is that by composing your solution out of several shorter steps, your code is clearer and easier to<br/>grasp. However, if you wish to say that a pipelined solution seems better, it’s just a matter of opinion!</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: justify;"><span>We have looked at many examples of function composition at this point, but there’s another way to<br/>manage this—by using higher-order functions.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 43pt;text-indent: 0pt;text-align: justify;"><a name="bookmark362">Composing with higher-order functions</a></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: justify;"><span>Evidently, composing by hand can be done similarly to pipelining. For example, the unique word­<br/>counting function that we wrote previously could be written in simple JavaScript style:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 65pt;text-indent: -12pt;line-height: 144%;text-align: left;"><span>const getUniqueWordsl = (str: string): string[] =&gt; {<br/>const strl = removeNonAlpha(str);</span></p><p style="padding-left: 64pt;text-indent: 0pt;line-height: 10pt;text-align: left;">const    str2 = toUpperCase(strl);</p><p style="padding-top: 4pt;padding-left: 64pt;text-indent: 0pt;text-align: left;">const    arrl = splitlnWords(str2);</p><p style="padding-top: 4pt;padding-left: 64pt;text-indent: 0pt;text-align: left;">const    setl = arrayToSet(arrl);</p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;line-height: 142%;text-align: left;"><span>const   arr2 = setToList(setl);<br/>return arr2;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">console.log(getUniqueWordsl(GETTYSBURG 1_2));</p><p style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// Output: the same 43 words</p><p style="padding-top: 2pt;padding-left: 52pt;text-indent: -9pt;line-height: 23pt;text-align: left;"><span>Alternatively, it could be written more concisely (but more obscurely!) in a one-liner style:<br/>const getUniqueWords2 = (str: string) : string [] =&gt;</span></p><p style="padding-top: 1pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">setToList(</p><p style="padding-top: 4pt;padding-left: 89pt;text-indent: -12pt;line-height: 142%;text-align: left;"><span>arrayToSet (<br/>splitlnWords(toUpperCase(removeNonAlpha(str)))</span></p><p style="padding-top: 1pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">)</p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">console.log(getUniqueWords2(GETTYSBURG 1_2));</p><p style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// Output: the same 43 words</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>This works fine, but as when we studied pipelining, let’s look for a more general solution that won’t<br/>require writing a new particular function every time we want to compose some other functions.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 20pt;text-indent: 0pt;text-align: left;">290  Connecting Functions - Pipelining, Composition, and More</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>Composing two functions is relatively easy and requires making a small change to our pipeTwo ()<br/>function, which we looked at earlier in this chapter. We just have to exchange f and g to get the<br/>new definition!</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// compose.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">const pipeTwo =</p><p style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">&lt;F extends FN, G extends FN&gt;(f: F, g: G) =&gt;</p><p class="s10" style="padding-top: 4pt;padding-left: 85pt;text-indent: -9pt;line-height: 143%;text-align: left;"><span>(...args:    Parameters&lt;F&gt;):    ReturnType&lt;G&gt;    =&gt;<br/>g(f(...args));</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;text-align: left;">const composeTwo =</p><p style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">&lt;F extends FN, G extends FN&gt;(f: F, g: G) =&gt;</p><p class="s10" style="padding-top: 4pt;padding-left: 86pt;text-indent: -10pt;line-height: 143%;text-align: left;"><span>(...args:    Parameters&lt;G&gt;):    ReturnType&lt;F&gt;    =&gt;<br/>f(g(...args));</span></p><p style="padding-top: 8pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>The only difference is that, with piping, you apply the leftmost function first, while with composing,<br/>you start with the rightmost function first. This variation suggests that we could have used the<br/>f lipTwo () higher-order function from the </span><i>Parameter order </i>section of <i>Chapter 7, Transforming</i>Is it clearer? Here is the code:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">const composeTwoByFlipping = flipTwo(pipeTwo);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>In any case, if we want to compose more than two functions, we can take advantage of the associative<br/>property and write something like the following:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 74pt;text-indent: -12pt;line-height: 144%;text-align: left;"><span>const getUniqueWords3 = composeTwo(<br/>setToList,</span></p><p class="s10" style="padding-left: 85pt;text-indent: -12pt;line-height: 143%;text-align: left;"><span>composeTwo(<br/></span><span class="p">arrayToSet,<br/></span>composeTwo(</p><p style="padding-left: 98pt;text-indent: 0pt;text-align: left;">splitlnWords,</p><p class="s10" style="padding-top: 4pt;padding-left: 97pt;text-indent: 0pt;text-align: left;">composeTwo<span class="p">(toUpperCase, removeNonAlpha)</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">)</p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 396pt;text-indent: 0pt;text-align: left;">Composing  291</p><p style="padding-top: 22pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>Even though this works, let’s go for a better solution—we can provide several. We could use a loop<br/>like when we wrote our first pipelining function:</span></p><p style="padding-top: 10pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="padding-top: 19pt;padding-left: 51pt;text-indent: 0pt;text-align: center;">function compose(. fns) {</p><p style="padding-top: 4pt;padding-left: 51pt;text-indent: 0pt;text-align: center;">return (. args) =&gt; {</p><p style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">let result = fns[fns.length - l](. args);</p><p style="padding-top: 4pt;padding-left: 88pt;text-indent: -11pt;line-height: 143%;text-align: left;"><span>for (let i = fns.length - 2; i &gt;= 0; i--) {<br/>result = fns [i] (result);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 76pt;text-indent: 0pt;text-align: left;">return result;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: right;">console.log(</p><p class="s10" style="padding-top: 4pt;text-indent: 0pt;text-align: right;">compose(</p><p style="padding-top: 4pt;padding-left: 76pt;text-indent: 0pt;line-height: 144%;text-align: left;"><a name="bookmark363"><span>setToList,<br/>arrayToSet,<br/>splitlnWords,<br/>toUpperCase,<br/>removeNonAlpha</span></a></p><p class="s10" style="padding-left: 65pt;text-indent: 0pt;line-height: 10pt;text-align: left;">)(GETTYSBURG_1_2)</p><p style="padding-top: 5pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">) ;</p><p style="padding-top: 3pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// same output as earlier</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: left;"><span>We could also note that pipelining and composing work in opposite directions. We apply functions<br/>from left to right when pipelining, and from right to left when composing. Thus, we can achieve the<br/>same result we achieved with composition by reversing the order of the functions and doing pipelining<br/>instead; a very functional solution, which I really like! This is as follows:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s9" style="padding-left: 53pt;text-indent: 0pt;text-align: left;">11 <span class="p">continued...</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">function composel(...fns) {</p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">return pipeline(...fns.reverse());</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 20pt;text-indent: 0pt;text-align: left;">292  Connecting Functions - Pipelining, Composition, and More</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>The only tricky part is the usage of the spread operator before calling pipeline (). After reversing<br/>the f ns array, we must spread its elements to call pipeline () correctly.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>Yet another solution, less declarative, is to use reduceRight () so that instead of reversing the list<br/>of functions, we reverse the order of processing them:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 73pt;text-indent: -11pt;line-height: 143%;text-align: left;"><span>function compose2(...fns) {<br/>return fns.reduceRight(</span></p><p class="s10" style="padding-left: 87pt;text-indent: 0pt;line-height: 10pt;text-align: left;">(f, g) =&gt; (...args) = &gt; g(f(...args))</p><p style="padding-top: 5pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">) ;</p><p style="padding-top: 5pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">console.log(</p><p class="s10" style="padding-top: 4pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">compose2(</p><p style="padding-top: 4pt;padding-left: 85pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>setToList,<br/>arrayToSet,<br/>splitlnWords,<br/>toUpperCase,<br/>removeNonAlpha</span></p><p class="s10" style="padding-left: 74pt;text-indent: 0pt;line-height: 10pt;text-align: left;">)(GETTYSBURG_1_2)</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">// still same output</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">Why and how does this work? Let’s look at the inner workings of this call:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l100"><li data-list-text="•"><p style="padding-left: 79pt;text-indent: -13pt;line-height: 123%;text-align: left;"><span>Since no initial value is provided, f ( ) is removeNonAlpha ( ) and g ( ) is<br/>toUpperCase () , so the first intermediate result is a function, ( . . . args) =&gt;<br/>toUpperCase (removeNonAlpha ( . . . args) ); let’s call it stepl ().</span></p></li><li data-list-text="•"><p style="padding-top: 5pt;padding-left: 79pt;text-indent: -13pt;line-height: 125%;text-align: left;"><span>The second time, f () is stepl () from the previous step, while g () is splitlnWords (),<br/>so the new result is a function, (...args) =&gt; splitlnWords (stepl (... args) )),</span></p><p style="padding-left: 79pt;text-indent: 0pt;line-height: 10pt;text-align: left;">which we can call step2 ().</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 79pt;text-indent: -13pt;line-height: 123%;text-align: left;"><span>The third time around, in the same fashion, we get (. . . args) = &gt; arrayToSet (step2 (. . .<br/>args) ) ) ), which we call step3 ().</span></p></li></ul><p style="padding-top: 5pt;padding-left: 79pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>Finally, the result is ( . . . args) =&gt; setToList (step3 ( . . . args) ), a function; let’s<br/>call it step4 ().</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 396pt;text-indent: 0pt;text-align: left;">Composing  293</p><p style="padding-top: 22pt;padding-left: 43pt;text-indent: 0pt;text-align: left;">The final result turns out to be a function that receives (  args) and starts by applying</p><p style="padding-top: 2pt;padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>removeNonAlpha ( ) to it, then toUpperCase ( ) , and so on, before finishing by<br/>applying setToList ().</span></p><p style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>It may come as a surprise that we can also make this work with reduce () —can you see why? The<br/>reasoning is similar to what we did previously, so we’ll leave this as an exercise for you:</span></p><p style="padding-top: 10pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="padding-top: 19pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">function composes(. fns) {</p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">return <b>fns.reduceRight(pipeTwo);</b></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 56pt;text-indent: 0pt;text-align: left;"><a name="bookmark364">A symmetric challenge!</a></p><p style="padding-top: 4pt;padding-left: 57pt;text-indent: 0pt;line-height: 115%;text-align: left;"><span>After working out how composes () works, you might want to write a version of pipel ine ()<br/>that uses reduceRight (), just for symmetry, to round things out!</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s34" style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;text-align: left;">Data typing for composition</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: left;"><span>Given what we did for pipelining, data typing for composition is very much the same, and we’ll follow<br/>what we did in parallel. First, we’ll have an auxiliary type to check whether our functions’ types can<br/>be composed correctly:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// compose.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 65pt;text-indent: -12pt;line-height: 144%;text-align: left;"><span>type FnsMatchComp&lt;FNS extends FN[]&gt; =<br/>1 extends FNS[&quot;length&quot;]</span></p><p style="padding-left: 77pt;text-indent: 0pt;line-height: 10pt;text-align: left;">? boolean</p><p style="padding-top: 4pt;padding-left: 89pt;text-indent: 0pt;text-align: left;">FNS extends [</p><p style="padding-top: 4pt;padding-left: 101pt;text-indent: 1pt;line-height: 144%;text-align: left;"><span>...infer FNInit extends FN[],<br/>infer FNPrev extends FN,<br/>infer FNLast extends FN</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 77pt;text-indent: 0pt;text-align: left;">? Parameters&lt;FNPrev&gt; extends [ReturnType&lt;FNLast&gt;]</p><p style="padding-top: 4pt;padding-left: 89pt;text-indent: 0pt;text-align: left;">? FnsMatchCompc[. FNInit, FNPrev]&gt;</p><p style="padding-top: 4pt;padding-left: 88pt;text-indent: 12pt;line-height: 144%;text-align: left;"><span>never<br/>never;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 20pt;text-indent: 0pt;text-align: left;">294  Connecting Functions - Pipelining, Composition, and More</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>This is essentially the same as what we wrote for pipelining, except that we process functions from<br/>right to left. With this done, we can now write our Composec &gt; type:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 73pt;text-indent: -11pt;line-height: 143%;text-align: left;"><span>type Compose&lt;FNS extends FN[]&gt; =<br/>boolean extends FnsMatchComp&lt;FNS&gt;</span></p><p style="padding-left: 86pt;text-indent: 0pt;line-height: 10pt;text-align: left;">? 1 extends FNS[&quot;length&quot;]</p><p style="padding-top: 4pt;padding-left: 98pt;text-indent: 0pt;text-align: left;">? FNS[0]</p><p style="padding-top: 4pt;text-indent: 0pt;text-align: right;">: FNS extends [</p><p style="padding-top: 4pt;padding-left: 122pt;text-indent: 0pt;text-align: left;">infer FNFIRST extends FN,</p><p style="padding-top: 4pt;text-indent: 0pt;text-align: right;">. . - FN[] ,</p><p style="padding-top: 4pt;padding-left: 122pt;text-indent: 0pt;text-align: left;"><a name="bookmark365">infer FNLAST extends FN</a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-top: 7pt;padding-left: 109pt;text-indent: -11pt;line-height: 141%;text-align: left;"><span>? (...args: Parameters&lt;FNLAST&gt;) =&gt;<br/>ReturnType&lt;FNFIRST&gt;</span></p><p style="padding-left: 99pt;text-indent: 0pt;text-align: left;">: never</p><p style="padding-top: 4pt;padding-left: 87pt;text-indent: 0pt;text-align: left;">: never;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: left;"><span>This is also what we had for pipelining, except for the type of the result, which is symmetrical. Finally,<br/>we can apply types to our composing functions; let’s see just one example, because (logically!) typing<br/>is the same for all the versions of our code!</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">function compose&lt;FNS <b>extends </b>FN[]&gt;(</p><p style="padding-top: 4pt;padding-left: 75pt;text-indent: 0pt;text-align: left;">...fns: FNS</p><p class="s10" style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">): Compose&lt;FNS&gt;;</p><p style="padding-top: 4pt;padding-left: 73pt;text-indent: -11pt;line-height: 143%;text-align: left;"><span>function compose&lt;FNS extends FN []&gt;(...fns: FNS) : FN {<br/>return (...args: ParameterscFNS[0]&gt;) =&gt; {</span></p><p style="padding-left: 86pt;text-indent: 0pt;line-height: 142%;text-align: left;"><span>let result = fns [fns.length - l](...args);<br/>for (let i = fns.length - 2; i &gt;= 0; i--) {</span></p><p style="padding-left: 97pt;text-indent: 0pt;text-align: left;">result = fns [i] (result) ;</p><p style="padding-top: 6pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">}</p><p style="padding-top: 2pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">return result;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>So far, we have looked at the important methods we can use to connect functions using pipelining,<br/>chaining, and composition. All this works very well, but we’ll see that there’s a particular case in</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 393pt;text-indent: 0pt;text-align: left;">Transducing  295</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>which the performance of your code can be affected and that will require a new way to handle<br/>composition: </span><i>transducing.</i></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-left: 43pt;text-indent: 0pt;text-align: left;"><a name="bookmark366">Transducing</a></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Let’s consider a performance problem in JavaScript that happens when were dealing with large arrays<br/>and applying several map (),filter!), or reduce () operations. If you start with an array and<br/>apply these operations (via chaining, as we saw earlier in this chapter), you get the desired result.<br/>However, many intermediate arrays are created, processed, and discarded—and that causes delays. If<br/>you  are dealing with small arrays, the extra time won’t make an impact, but with larger arrays (as in a<br/>big data process, maybe in Node.js, where you’re working with the results of a large database query),<br/>then you will probably have to need some optimization. We’ll do this by learning about a new tool<br/>for composing functions: </span><i>transducing.</i></p><p style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>First, let’s create some functions and data. We’ll make do with a nonsensical example since we aren’t<br/>focusing on the actual operations but on the general process. We’ll start with some filtering functions<br/>and some mapping:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// transducing.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 287%;text-align: justify;"><span>const testOdd = (x: number): boolean =&gt; x % 2 === 1;<br/>const testUnderFifty = (x: number): boolean =&gt; x &lt; 50;<br/>const duplicate = (x: number): number =&gt; x + x;</span></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">const addThree = (x: number): number =&gt; x + 3;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: justify;"><span>Now, let’s apply those maps and filters to an array. First, we drop the even numbers, duplicate the odd<br/>numbers, drop results over 50, and end by adding 3 to all the results:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="padding-top: 3pt;padding-left: 53pt;text-indent: 0pt;line-height: 30pt;text-align: left;"><span>const myArray = [22, 9, 60, 24, 11, 63];<br/>const aO = myArray</span></p><p style="padding-left: 66pt;text-indent: 0pt;text-align: left;">. filter(testOdd)</p><p style="padding-top: 4pt;padding-left: 66pt;text-indent: 0pt;text-align: left;">.map(duplicate)</p><p style="padding-top: 4pt;padding-left: 66pt;text-indent: 0pt;text-align: left;">.filter(testUnderFifty)</p><p style="padding-top: 4pt;padding-left: 66pt;text-indent: 0pt;text-align: left;">.map(addThree);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 20pt;text-indent: 0pt;text-align: left;">296  Connecting Functions - Pipelining, Composition, and More</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;text-align: left;">console.log(aO);</p><p class="s10" style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">// Output: [ 21, 25 ]</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: justify;">The following diagram shows how this sequence of operations works:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 144pt;text-indent: 0pt;text-align: left;"><span><img width="282" height="324" alt="image" src="Image_038.jpg"/></span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 156pt;text-indent: -9pt;line-height: 134%;text-align: left;"><span>Figure 8.3 - Chaining map/filter/reduce operations causes<br/>intermediate arrays to be created and later discarded</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Here, we can see that chaining together several map (), filter (), and reduce () operations<br/>causes intermediate arrays (three, in this case) to be created and later discarded—and for large arrays,<br/>that can become cumbersome.</span></p><p style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>How can we optimize this? The problem here is that processing applies the first transformation to<br/>the input array; then, the second transformation is applied to the resulting array; then the third, and<br/>so on. An alternative solution would be to take the first element of the input array and apply all the<br/>transformations in sequence to it. Then, you would need to take the second element of the input array<br/>and apply all the transformations to it, then take the third, and so on. In pseudocode, the difference<br/>is between this:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 86pt;text-indent: -24pt;line-height: 146%;text-align: left;"><span>for each transformation to be applied:<br/>for each element in the input list:</span></p><p style="padding-left: 109pt;text-indent: 0pt;line-height: 10pt;text-align: left;">apply the transformation to the element</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 12pt;padding-left: 393pt;text-indent: 0pt;text-align: left;">Transducing  297</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: justify;">And then this approach:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">for each element in the input list:</p><p style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">for each transformation to be applied:</p><p style="padding-top: 4pt;padding-left: 100pt;text-indent: 0pt;text-align: left;">apply the transformation to the element</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>With the first logic, we go transformation by transformation, applying it to each list and generating a<br/>new one. This requires several intermediate lists to be produced. With the second logic, we go element<br/>by element and apply all the transformations to each one in sequence to arrive at the final output list<br/>without any intermediate lists being created.</span></p><p style="text-indent: 0pt;text-align: left;"><span><img width="185" height="325" alt="image" src="Image_039.gif"/></span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Now, the problem is being able to transpose the transformations; how can we do this? We saw this<br/>key concept in </span><i>Chapter 5, Programming Declaratively, </i><span>and we can define map () and f i 1 ter () in<br/>terms of reduce (). Using those definitions, instead of a sequence of different functions, we will<br/>apply the same operation (reduce ()) at each step, and here is the secret! As shown in the following<br/>diagram, we change the order of evaluation by composing all the transformations so that they can be<br/>applied in a single pass with no intermediate arrays whatsoever:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 72pt;text-indent: 0pt;text-align: left;"><span><img width="233" height="303" alt="image" src="Image_040.gif"/></span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 18pt;line-height: 26pt;text-align: left;"><span>Figure 8.4 - By applying transducers, we will change the order of evaluation but get the same result<br/>Instead of applying a first reduce () operation, passing its result to a second, its result to a third,</span></p><p style="padding-top: 2pt;padding-left: 43pt;text-indent: 0pt;text-align: justify;">and so on, we will compose all the reducing functions into a single one! Let’s analyze this.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 20pt;text-indent: 0pt;text-align: left;">298  Connecting Functions - Pipelining, Composition, and More</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-top: 5pt;padding-left: 52pt;text-indent: 0pt;text-align: left;"><a name="bookmark367">Composing reducers</a></p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">Essentially, what we want is to transform each function (testOdd (), duplicate (), and so on)</p><p style="padding-top: 2pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: left;"><span>into a reducing operation that will call the following reducer. A couple of higher-order functions<br/>will help; one for mapping functions and another for filtering ones. With this idea, the result of an<br/>operation will be passed to the next one, avoiding intermediate arrays:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">const mapTR =</p><p style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">&lt;V, W&gt;(fn: (x: V) =&gt; W) =&gt;</p><p style="padding-top: 4pt;padding-left: 76pt;text-indent: -1pt;line-height: 143%;text-align: left;"><span>&lt;A&gt;(reducer: (am: A, wm: W) =&gt; A) =&gt;<br/>(accum: A, value: V): A =&gt;</span></p><p style="padding-left: 85pt;text-indent: 0pt;text-align: left;">reducer(accum, fn(value));</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">const filterTR =</p><p style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">&lt;V&gt;(fn: (x: V)    =&gt; boolean) =&gt;</p><p style="padding-top: 4pt;padding-left: 76pt;text-indent: -1pt;line-height: 143%;text-align: left;"><span>&lt;A&gt;(reducer:    (af: A, wf: V) =&gt; A) =&gt;<br/>(accum: A, value: V): A =&gt;</span></p><p style="padding-left: 86pt;text-indent: 0pt;text-align: left;">fn(value) ? reducer(accum, value) : accum;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;">These two transforming functions are <i>transducers: </i><span>functions that accept a reducing function and return<br/>a new reducing function. (Some trivia: the word </span><i>transduce </i><span>comes from Latin, meaning transform,<br/>transport, convert, change over, and is applied in many different fields, including biology, psychology,<br/>machine learning, physics, electronics, and more.)</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Typing is not too hard. For mapping, we assume a mapping function that gets a value of type V and<br/>produces a result of type W. The generic reducer takes an accumulator of type A and a value of type<br/>W  and produces a new accumulator, also of type A. For filtering, the filtering function gets a value of<br/>type V and produces a Boolean value, and the reducer gets an accumulator of type A and a value<br/>of type V, returning a type A result.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>How do we use these transducers? We can write code such as the following, although we’ll want a<br/>more abstract, generic version later:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">const testOddR = filterTR(testOdd);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">const testUnderFiftyR = filterTR(testUnderFifty);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 393pt;text-indent: 0pt;text-align: left;">Transducing  299</p><p style="padding-top: 3pt;padding-left: 52pt;text-indent: 0pt;line-height: 30pt;text-align: left;"><span>const duplicateR = mapTR(duplicate);<br/>const addThreeR = mapTR(addThree);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Each of our original four functions is transformed, so they will calculate their result and call a reducer<br/>to deal with this further. As an example, addThreeR () will add three to its input and pass the<br/>incremented value to the next reducer, which in this case is addToArray ().</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;text-align: justify;">This will build up the final resulting array. Now, we can write our whole transformation in a single step:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 64pt;text-indent: -12pt;line-height: 143%;text-align: left;"><span>const addToArray = (a: any[], v: any): any[] =&gt; {<br/>a.push(v) ;</span></p><p style="padding-left: 64pt;text-indent: 0pt;line-height: 10pt;text-align: left;">return a;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">const al = myArray.reduce(</p><p class="s10" style="padding-top: 4pt;padding-left: 76pt;text-indent: -11pt;line-height: 143%;text-align: left;"><span>testOddR(<br/>duplicateR(testUnderFiftyR(addThreeR(addToArray)))</span></p><p class="s10" style="padding-left: 65pt;text-indent: 0pt;text-align: left;">) ,</p><p class="s10" style="padding-top: 4pt;padding-left: 67pt;text-indent: 0pt;text-align: left;">[]</p><p style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">console.log(al);</p><p class="s10" style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// Output: [ 21, 25 ], again</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>This is quite a mouthful, but it works! However, we can simplify our code by using the<br/>compose () function:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">const transduce = &lt;A&gt;(arr: A[], fns: FN[]) =&gt;</p><p class="s10" style="padding-top: 4pt;padding-left: 64pt;text-indent: 0pt;text-align: left;">arr.reduce(compose(...fns)(addToArray), []);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 65pt;text-indent: -12pt;line-height: 142%;text-align: left;"><span>console.log(<br/>transduce(myArray, [</span></p><p style="padding-left: 76pt;text-indent: 0pt;line-height: 143%;text-align: left;"><span>testOddR,<br/>duplicateR,</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">300  Connecting Functions - Pipelining, Composition, and More</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 85pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>testUnderFiftyR,<br/>addThreeR,</span></p><p style="padding-left: 74pt;text-indent: 0pt;text-align: left;">] )</p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">) ;</p><p class="s10" style="padding-top: 3pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">// Output: [ 21, 25 ], yet again</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">The code is the same, but pay particular attention to the compose ( . . . fns) (addToArray)</p><p style="padding-top: 2pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: left;"><span>expression: we compose all the mapping and filtering functions—with the last one being addToArray—<br/>to build up the output. However, this is not as general as we may want it to be: why do we have to<br/>create an array? Why can’t we have a different final reducing function? We can go one better by<br/>generalizing a bit more.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 52pt;text-indent: 0pt;text-align: left;"><a name="bookmark368">Generalizing for all reducers</a></p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>To be able to work with all kinds of reducers and produce whatever kind of result they build, we’ll<br/>need to make a small change. The idea is simple: let’s modify our transduce () function so that it<br/>will accept a final reducer and a starting value for the accumulator:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 73pt;text-indent: -12pt;line-height: 144%;text-align: left;"><span>const transduce2 = &lt;A&gt;(<br/>arr : A [] ,</span></p><p style="padding-left: 74pt;text-indent: 0pt;line-height: 10pt;text-align: left;">fns : FN [] ,</p><p class="s10" style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>reducer: FN = addToArray,<br/>initial: any = []</span></p><p style="padding-left: 62pt;text-indent: 0pt;line-height: 10pt;text-align: left;">) =&gt; arr.reduce(compose(...fns)<b>(reducer), initial);</b></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 73pt;text-indent: -12pt;line-height: 142%;text-align: left;"><span>console.log(<br/>transduce2(myArray, [</span></p><p style="padding-left: 85pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>testOddR,<br/>duplicateR,<br/>testUnderFiftyR,<br/>addThreeR,</span></p><p style="padding-left: 74pt;text-indent: 0pt;text-align: left;">] )</p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">) ;</p><p class="s10" style="padding-top: 3pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">// Output: [ 21, 25 ], always</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>To make this function more usable, we specified our array-building function (and an empty array<br/>as a starting accumulator value) so that if you skip those two parameters, you’ll get a reducer that</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 332pt;text-indent: 0pt;text-align: left;">Testing connected functions    301</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>produces an array. Now, let’s look at the other option: instead of an array, let’s calculate the sum of the<br/>resulting numbers after all the mapping and filtering:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 64pt;text-indent: -11pt;line-height: 142%;text-align: left;"><span>console.log(<br/>transduce2(</span></p><p style="padding-left: 76pt;text-indent: 0pt;text-align: left;">myArray,</p><p style="padding-top: 4pt;padding-left: 79pt;text-indent: 0pt;text-align: left;">[testOddR, duplicateR, testUnderFiftyR, addThreeR],</p><p class="s10" style="padding-top: 4pt;padding-left: 78pt;text-indent: 0pt;text-align: left;">(acc, value) =&gt; acc + value,</p><p class="s164" style="padding-top: 5pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">0</p><p class="s164" style="padding-top: 6pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">)</p><p class="s164" style="padding-top: 5pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">) ;</p><p class="s164" style="padding-top: 5pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// 46</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>By using transducers, we have been able to optimize a sequence of map, filter, and reduce<br/>operations so that the input array is processed once and directly produces the output result (whether<br/>an  array or a single value) without creating any intermediate arrays; a good gain!</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: justify;"><a name="bookmark369"><span>We’ve seen several ways of connecting functions; to round this off, let’s see how to write unit tests for<br/>connected functions.</span></a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-left: 43pt;text-indent: 0pt;text-align: justify;">Testing connected functions</p><p style="padding-top: 9pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><a name="bookmark370"><span>Let’s finish by considering testing for functions connected in all the ways we’ve seen in this chapter.<br/>Given that the mechanisms for pipelining and composition are similar, we will look at examples of<br/>both. They won’t differ, other than their logical differences due to the left-to-right or right-to-left<br/>order of function evaluation.</span></a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 43pt;text-indent: 0pt;text-align: justify;">Testing pipelined functions</p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>When it comes to pipelining, we can start by looking at how to test the pipeTwo () function since<br/>the setup will be similar to pipeline (). We need to create some mocks and check whether they<br/>were called the correct number of times and whether they received the correct arguments each time.<br/>We will set them to provide a known answer to a call.</span></p><p style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>By doing this, we can check whether the output of a function becomes the input of the next function<br/>in the pipeline:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 287%;text-align: left;"><span>// pipetwo.test.ts<br/>describe(&quot;pipeTwo&quot;, function () {</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">302  Connecting Functions - Pipelining, Composition, and More</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 85pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>it(&quot;works with single arguments&quot;, () =&gt; {<br/>const fnl = jest.fn().mockReturnValue(1);<br/>const fn2 = jest.fn().mockReturnValue(2);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 85pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>const pipe = pipeTwo(fnl, fn2) ;<br/>const result = pipe (22);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 85pt;text-indent: 0pt;line-height: 143%;text-align: left;"><span>expect(fnl).toHaveBeenCalledTimes(1);<br/>expect(fn2).toHaveBeenCalledTimes(1);<br/>expect(fnl).toHaveBeenCalledWith(22);<br/>expect(fn2).toHaveBeenCalledWith(1);<br/>expect(result).toBe(2);</span></p><p style="padding-top: 2pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">});</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 85pt;text-indent: -11pt;line-height: 143%;text-align: left;"><span>it(&quot;works   with   multiple   arguments&quot;,   ()   =&gt;   {<br/>const     fnl     =     jest.fn().mockReturnValue(11);<br/>const                                  fn2 = jest.fnO .mockReturnValue (22) ;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 85pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>const pipe = pipeTwo(fnl, fn2);<br/>const result = pipe(12, 4, 56);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 85pt;text-indent: 0pt;line-height: 143%;text-align: left;"><span>expect(fnl).toHaveBeenCalledTimes(1);<br/>expect(fn2).toHaveBeenCalledTimes(1);<br/>expect(fnl).toHaveBeenCalledWith(12,                                           4, 56);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: right;">});</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;">});</p><p style="padding-top: 4pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>expect(fn2).toHaveBeenCalledWith(11);<br/>expect(result).toBe(22);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: left;"><span>There is little to test given that our function always receives two functions as parameters. The only<br/>difference between the tests is that one shows a pipeline applied to a single argument, while the other<br/>shows it applied to several arguments.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>Moving on to pipeline (), the tests would be quite similar. However, we can add a test for a single­<br/>function pipeline (a border case!) and another with four functions:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// pipeline.test.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 332pt;text-indent: 0pt;text-align: left;">Testing connected functions    303</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">describe(&quot;pipeline&quot;, function () {</p><p style="padding-top: 4pt;padding-left: 76pt;text-indent: -11pt;line-height: 141%;text-align: left;"><span>it(&quot;works with a single function&quot;, () =&gt; {<br/>const fnl = jest.fn().mockReturnValue(11);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 77pt;text-indent: 0pt;line-height: 142%;text-align: left;"><span>const pipe = pipeline(fnl);<br/>const result = pipe(60);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 76pt;text-indent: 0pt;line-height: 144%;text-align: justify;"><span>expect(fnl).toHaveBeenCalledTimes(1);<br/>expect(fnl).toHaveBeenCalledWith(60);<br/>expect(result)                                  .toBe (11) ;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 6pt;padding-left: 76pt;text-indent: -11pt;line-height: 143%;text-align: left;"><span>it(&quot;works with single arguments&quot;, () =&gt; {<br/>const fnl = jest.fn().mockReturnValue(1);<br/>const fn2 = jest.fn().mockReturnValue(2);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 77pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>const pipe = pipeline(fnl, fn2);<br/>const result = pipe (22);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 76pt;text-indent: 0pt;line-height: 143%;text-align: left;"><span>expect(fnl).toHaveBeenCalledTimes(1);<br/>expect(fn2).toHaveBeenCalledTimes(1);<br/>expect(fnl).toHaveBeenCalledWith(22);<br/>expect(fn2).toHaveBeenCalledWith(1);<br/>expect(result).toBe(2);</span></p><p style="padding-top: 2pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">});</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 77pt;text-indent: -11pt;line-height: 143%;text-align: left;"><span>it(&quot;works with multiple arguments&quot;, () =&gt; {<br/>const fnl = jest.fn().mockReturnValue(11);<br/>const fn2 = jest.fn().mockReturnValue(22);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 77pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>const pipe = pipeline(fnl, fn2);<br/>const result = pipe(12, 4, 56);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 76pt;text-indent: 0pt;line-height: 142%;text-align: left;"><span>expect(fnl).toHaveBeenCalledTimes(1);<br/>expect(fn2).toHaveBeenCalledTimes(1);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">304  Connecting Functions - Pipelining, Composition, and More</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 85pt;text-indent: 0pt;text-align: left;">expect(fnl).toHaveBeenCalledWith(12, 4, 56);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 85pt;text-indent: 0pt;line-height: 143%;text-align: left;"><span>expect(fn2).toHaveBeenCalledWith(11);<br/>expect(result).toBe(22);</span></p><p style="padding-top: 2pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">});</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 85pt;text-indent: -11pt;line-height: 144%;text-align: justify;"><span>it(&quot;works with 4 functions, multiple arguments&quot;, () =&gt; {<br/>const fnl = jest.fn().mockReturnValue(111);</span></p><p style="padding-left: 85pt;text-indent: 0pt;line-height: 144%;text-align: justify;"><span>const fn2 = jest.fn().mockReturnValue(222);<br/>const fn3 = jest.fn().mockReturnValue(333);<br/>const fn4 = jest.fn().mockReturnValue(444);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 85pt;text-indent: 0pt;line-height: 142%;text-align: left;"><span>const pipe = pipeline(fnl, fn2, fn3, fn4);<br/>const result = pipe(24, 11, 63);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 85pt;text-indent: 0pt;line-height: 143%;text-align: left;"><span>expect(fnl).toHaveBeenCalledTimes(1);<br/>expect(fn2).toHaveBeenCalledTimes(1);<br/>expect(fn3).toHaveBeenCalledTimes(1);<br/>expect(fn4).toHaveBeenCalledTimes(1);<br/>expect(fnl)                    .toHaveBeenCalledWith(24 , 11, 63);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 85pt;text-indent: 0pt;line-height: 143%;text-align: justify;"><span>expect(fn2).toHaveBeenCalledWith(111);<br/>expect(fn3).toHaveBeenCalledWith(222);<br/>expect(fn4).toHaveBeenCalledWith(333);<br/>expect(result).toBe(444);</span></p><p style="padding-top: 2pt;padding-left: 74pt;text-indent: 0pt;text-align: left;"><a name="bookmark371">});</a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-top: 5pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">Testing composed functions</p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">For composition, the style is the same (except that the order of function evaluation is reversed), so</p><p style="padding-top: 2pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">let’s take a look at a single test—here, I simply changed the order of the functions in the preceding test:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;line-height: 286%;text-align: left;"><span>// compose.test.ts<br/>describe(&quot;compose&quot;, function () {</span></p><p style="padding-left: 74pt;text-indent: 0pt;text-align: left;">// other tests, omitted here</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 332pt;text-indent: 0pt;text-align: left;">Testing connected functions    305</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 6pt;padding-left: 77pt;text-indent: -11pt;line-height: 144%;text-align: justify;"><span>it(&quot;works   with   4   functions,   multiple   arguments&quot;,   ()   =&gt;   {<br/>const fnl = jest.fn().mockReturnValue(111);</span></p><p style="padding-left: 76pt;text-indent: 0pt;line-height: 144%;text-align: justify;"><span>const fn2 = jest.fn().mockReturnValue(222);<br/>const fn3 = jest.fn().mockReturnValue(333);<br/>const fn4 = jest.fn().mockReturnValue(444);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 77pt;text-indent: 0pt;text-align: justify;"><a name="bookmark372">const comp </a><b>= compose(fn4, fn3, fn2, fnl);</b></p><p style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;text-align: justify;">const result = comp(24, 11, 63);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 76pt;text-indent: 0pt;line-height: 143%;text-align: left;"><span>expect(fnl).toHaveBeenCalledTimes(1);<br/>expect(fn2).toHaveBeenCalledTimes(1);<br/>expect(fn3).toHaveBeenCalledTimes(1);<br/>expect(fn4).toHaveBeenCalledTimes(1);<br/>expect(fnl).toHaveBeenCalledWith(24,                                           11, 63);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: right;"><a name="bookmark373">});</a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 8pt;text-indent: 0pt;text-align: left;">});</p><p style="padding-top: 4pt;text-indent: 0pt;line-height: 144%;text-align: justify;"><span>expect(fn2).toHaveBeenCalledWith(111);<br/>expect(fn3).toHaveBeenCalledWith(222);<br/>expect(fn4).toHaveBeenCalledWith(333);<br/>expect(result).toBe(444);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-top: 5pt;padding-left: 43pt;text-indent: 0pt;text-align: justify;">Testing chained functions</p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>To test the chainify () function, I opted to use the preceding City object I created—I didn’t<br/>want to mess with mocks, stubs, spies, and the like; I wanted to ensure that the code worked under<br/>normal conditions:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// chaining.test.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;text-indent: 0pt;text-align: right;">class</p><p style="padding-top: 4pt;text-indent: 0pt;text-align: right;">//as</p><p style="padding-top: 4pt;padding-left: 16pt;text-indent: 0pt;line-height: 141%;text-align: left;"><span>City {<br/>above</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">let myCity: City;</p><p style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">let myCity2: Chainify&lt;City&gt;;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">306  Connecting Functions - Pipelining, Composition, and More</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 5pt;padding-left: 73pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>describe (&quot;chainify&quot;, function () {<br/>beforeEach(() =&gt; {</span></p><p style="padding-left: 98pt;text-indent: -13pt;line-height: 144%;text-align: left;"><span>myCity = new City(<br/>&quot;Montevideo, Uruguay&quot;,</span></p><p style="padding-left: 98pt;text-indent: 0pt;text-align: left;">-34.9011,</p><p style="padding-top: 4pt;padding-left: 98pt;text-indent: 0pt;text-align: left;">-56.1645</p><p style="padding-top: 5pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">) ;</p><p style="padding-top: 3pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">myCity2 = chainify (tnyCity) ;</p><p style="padding-top: 6pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">});</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 85pt;text-indent: -11pt;line-height: 143%;text-align: left;"><span>it(&quot;doesn&#39;t affect get functions&quot;, () =&gt; {<br/>expect(myCity2.getName()).toBe(&quot;Montevideo, Uruguay&quot;);<br/>expect(myCity2.getCoords()                                                  [0] ) .toBe(-34.9011) ;<br/>expect(myCity2.getCoords() [1] ) .toBe(-56.1645) ;</span></p><p style="padding-top: 2pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">});</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 5pt;padding-left: 85pt;text-indent: -11pt;line-height: 143%;text-align: left;"><span>it(&quot;doesn&#39;t affect getting attributes&quot;, () =&gt; {<br/>expect(myCity2.name).toBe(&quot;Montevideo, Uruguay&quot;);<br/>expect(myCity2.lat).toBe(-34.9011);<br/>expect(myCity2.long).toBe(-56.1645);</span></p><p style="padding-top: 2pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">});</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 5pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">it(&quot;returns itself from setting functions&quot;, () =&gt; {</p><p style="padding-top: 4pt;padding-left: 97pt;text-indent: -11pt;line-height: 143%;text-align: left;"><span>// expect(myCity2.setName(&quot;Other<br/>name&quot;)).toBe(myCity2);</span></p><p style="padding-left: 85pt;text-indent: 0pt;line-height: 142%;text-align: left;"><span>expect(myCity2.setLat(11)).toBe(myCity2);<br/>expect(myCity2.setLong(22)).toBe(myCity2);</span></p><p style="padding-top: 2pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">});</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 85pt;text-indent: -11pt;line-height: 143%;text-align: left;"><span>it(&quot;allows chaining&quot;, () =&gt; {<br/>const newCoords = myCity2</span></p><p style="padding-left: 99pt;text-indent: 0pt;text-align: left;">.setName(&quot;Pune, India&quot;)</p><p style="padding-top: 4pt;padding-left: 99pt;text-indent: 0pt;text-align: left;">.setLat(18.5626)</p><p style="padding-top: 4pt;padding-left: 99pt;text-indent: 0pt;text-align: left;">.setLong(73.8087)</p><p style="padding-top: 4pt;padding-left: 99pt;text-indent: 0pt;text-align: left;">.getCoords () ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 332pt;text-indent: 0pt;text-align: left;">Testing connected functions    307</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;text-indent: 0pt;text-align: right;">});</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;">});</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;line-height: 143%;text-align: justify;"><span>expect(myCity2.name).toBe(&quot;Pune, India&quot;);<br/>expect (newCoords [0] ) . toBe (18.5626) ,-<br/>expect(newCoords[1]).toBe(73.8087);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-top: 5pt;padding-left: 43pt;text-indent: 0pt;text-align: left;"><a name="bookmark374">Testing transduced functions</a></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: left;"><span>We tried several examples earlier in the chapter, and it’s easy to turn them into tests. We’ll also add new<br/>tests for border cases (for instance, just one function, only mapping functions, etc.) for more generality.<br/>For simplicity, I kept using the same data array and mapping and filtering functions I used before:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// transducing.test.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">describe(&quot;transducing&quot;, () =&gt; {</p><p style="padding-top: 4pt;padding-left: 76pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>it(&quot;works with several functions&quot;, () -&gt; {<br/>expect(</span></p><p style="padding-left: 100pt;text-indent: -12pt;line-height: 143%;text-align: left;"><span>transduce(myArray, [<br/>testOddR,<br/>duplicateR,<br/>testUnderFiftyR,<br/>addThreeR,</span></p><p style="padding-top: 1pt;padding-left: 89pt;text-indent: 0pt;text-align: left;">] )</p><p style="padding-top: 3pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">).toEqual([21, 25]);</p><p style="padding-top: 6pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">});</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 76pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>it(&quot;works with just one function at all&quot;, () =&gt; {<br/>expect(transduce(myArray, [testOddR])).toEqual([</span></p><p style="padding-left: 89pt;text-indent: 0pt;line-height: 10pt;text-align: left;">9, 11, 63,</p><p style="padding-top: 5pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">] ) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 6pt;padding-left: 89pt;text-indent: -12pt;line-height: 144%;text-align: left;"><span>expect(transduce(myArray, [addThreeR])).toEqual([<br/>25,                                          12, 63, 27, 14, 66,</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">308  Connecting Functions - Pipelining, Composition, and More</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 85pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>it(&quot;works with just mapping&quot;, () =&gt; {<br/>expect (</span></p><p style="padding-left: 97pt;text-indent: 0pt;text-align: left;">transduce(myArray, [addThreeR, duplicateR])</p><p style="padding-top: 4pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">).toEqual([50, 24, 126, 54, 28, 132]);</p><p style="padding-top: 6pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">});</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 5pt;padding-left: 85pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>it(&quot;works with just filtering&quot;, () =&gt; {<br/>expect(</span></p><p style="padding-left: 97pt;text-indent: 0pt;line-height: 10pt;text-align: left;">transduce(myArray, [testOddR, testUnderFiftyR])</p><p style="padding-top: 4pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">).toEqual([9, 11]);</p><p style="padding-top: 6pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">});</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 5pt;padding-left: 85pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>it(&quot;works with special reducer&quot;, () =&gt; {<br/>expect(</span></p><p style="padding-left: 109pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>transduce2(<br/>myArray,</span></p><p style="padding-left: 112pt;text-indent: 0pt;line-height: 143%;text-align: left;"><span>[testOddR, duplicateR, testUnderFiftyR, addThreeR],<br/>(acc, value) =&gt; acc + value,</span></p><p style="padding-left: 110pt;text-indent: 0pt;line-height: 10pt;text-align: left;">0</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: right;">});</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;">});</p><p style="padding-top: 5pt;padding-left: 11pt;text-indent: 0pt;text-align: left;">)</p><p style="padding-top: 3pt;text-indent: 0pt;text-align: left;">).toBe(46);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">The final result of all of these tests can be seen in the following screenshot:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 403pt;text-indent: 0pt;text-align: left;">Summary   309</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s221" style="padding-top: 1pt;padding-left: 11pt;text-indent: -9pt;text-align: left;"><span class="s219">BlZ-VfiB</span> codeForChapters/chapter 08/t<b>ransduclng.test.ts</b>transducing</p><p class="s223" style="padding-left: 28pt;text-indent: 0pt;text-align: left;">works <span style=" color: #DFE6D0;">with several functions (2 ms)<br/></span>works <span style=" color: #DFE6D0;">with just one function at all (1 ms)<br/></span>works <span style=" color: #DFE6D0;">with just mapping</span></p><p class="s224" style="padding-left: 28pt;text-indent: -8pt;line-height: 107%;text-align: left;">1 <span class="s223">works </span><span class="s221">with just filtering<br/>works with special reducer</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s221" style="padding-left: 33pt;text-indent: 0pt;text-align: left;">codeForChapters/chapter <b>08/coiipose. test. ts</b></p><p class="s221" style="padding-left: 11pt;text-indent: 0pt;text-align: left;">compose</p><p class="s221" style="padding-left: 28pt;text-indent: -8pt;text-align: left;"><span class="s224">J </span>works with a single function <span style=" color: #BAC2AE;">(3 </span><span>ms)<br/>works with single arguments (1 ms)</span></p><p class="s224" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">J <span class="s223">works </span><span class="s221">with multiple arguments (1 ms)</span></p><p class="s221" style="padding-left: 28pt;text-indent: 0pt;text-align: left;">works with 4 functions, multiple arguments <span style=" color: #BAC2AE;">[5 ms)</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s222" style="padding-left: 33pt;text-indent: 0pt;text-align: left;"><span class="s221">codeForChapters/chapter </span>08/pipeline. test<span style=" color: #FFF;">. </span>ts</p><p class="s221" style="padding-left: 11pt;text-indent: 0pt;text-align: left;">pipeline</p><p class="s221" style="padding-left: 28pt;text-indent: 0pt;text-align: left;">works with a single function <span style=" color: #BAC2AE;">(3 </span>ms)</p><p class="s221" style="padding-left: 28pt;text-indent: -8pt;text-align: left;"><span class="s224">J </span><span>works with single arguments (1 ms)<br/></span><span style=" color: #BAC2AE;">works </span>with multiple arguments</p><p class="s223" style="padding-left: 19pt;text-indent: 0pt;text-align: left;"><span class="s224">J </span>works <span style=" color: #DFE6D0;">with 4 functions, multiple arguments (1 </span>ms)</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s221" style="padding-left: 33pt;text-indent: 0pt;text-align: left;">codeForChapters/chapter <b>08/chaining . test. ts</b></p><p class="s221" style="padding-left: 11pt;text-indent: 0pt;text-align: left;">chainify</p><p class="s224" style="padding-left: 29pt;text-indent: -9pt;text-align: left;">J <span class="s221">doesn&#39;t affect get functions (2 ms)<br/>doesn&#39;t affect getting attributes (1 ms)</span></p><p class="s226" style="padding-left: 29pt;text-indent: -8pt;text-align: left;">J <span class="s221">returns itself from setting functions<br/>allows chaining (1 ms)</span></p><p style="padding-left: 113pt;text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 6pt;padding-left: 125pt;text-indent: 0pt;text-align: left;">Figure 8.5 - A successful run of testing for connected functions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 5pt;padding-left: 43pt;text-indent: 0pt;text-align: justify;">As we can see, all our tests passed successfully; good!</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-left: 43pt;text-indent: 0pt;text-align: left;"><a name="bookmark375">Summary</a></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>In this chapter, we learned how to create new functions by joining several other functions in different<br/>ways using pipelining and composition. We also looked at fluent interfaces, which apply chaining,<br/>and transducing, a way to compose reducers to get higher-speed sequences of transformations. With<br/>these methods, you’ll be able to create new functions out of existing ones and keep programming in<br/>the declarative way we favor.</span></p><p style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;">In <i>Chapter 9, Designing Functions, </i><span>we will move on to function design and study the usage of recursion,<br/>which is a basic tool in FP and allows for very clean algorithm designs.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-left: 43pt;text-indent: 0pt;text-align: left;"><a name="bookmark376">Questions</a></p><ol id="l101"><ol id="l102"><li data-list-text="8.1"><p class="s10" style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;">Headline capitalization: <span class="p">Let’s define headline-style capitalization, so ensure that a sentence is<br/>all written in lowercase, except the first letter of each word. (The real definition of this style is more<br/>complicated, so let’s simplify it for this question.) Write a headline (sentence) function that<br/>will receive a string as an argument and return an appropriately capitalized version. Spaces separate<br/>words. Build this function by connecting smaller functions:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">310  Connecting Functions - Pipelining, Composition, and More</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;text-align: left;">console.log(headline(&quot;Alice&#39;s ADVENTURES in WoNdErLaNd&quot;));</p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">// Alice&#39;s Adventures In Wonderland</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="8.2"><p class="s10" style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;">Pending tasks: <span class="p">A web service returns a result such as the following, showing all assigned tasks<br/>person by person. Tasks maybe finished (done===true) or pending (done===false). Your goal<br/>is  to produce an array with the IDs of the pending tasks for a given person, identified by name, which<br/>should match the responsible field. Solve this by using composition or pipelining:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 73pt;text-indent: -11pt;line-height: 143%;text-align: left;"><span>const allTasks = {<br/>date: &quot;2017-09-22&quot;,</span></p><p style="padding-left: 73pt;text-indent: 0pt;line-height: 10pt;text-align: left;">byPerson: [</p><p style="padding-top: 6pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">{</p><p style="padding-top: 2pt;padding-left: 97pt;text-indent: 0pt;line-height: 142%;text-align: left;"><span>responsible: &quot;EG&quot;,<br/>tasks: [</span></p><p style="padding-left: 111pt;text-indent: 0pt;text-align: left;">{ id: 111, desc: &quot;task 111&quot;, done: false },</p><p style="padding-top: 4pt;padding-left: 110pt;text-indent: 0pt;text-align: left;">{ id: 222, desc: &quot;task 222&quot;, done: false },</p><p style="padding-top: 5pt;padding-left: 98pt;text-indent: 0pt;text-align: left;">] ,</p><p class="s227" style="padding-top: 1pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">b</p><p style="padding-top: 1pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">{</p><p style="padding-top: 2pt;padding-left: 97pt;text-indent: 0pt;line-height: 143%;text-align: left;"><span>responsible: &quot;FK&quot;,<br/>tasks: [</span></p><table style="border-collapse:collapse;margin-left:84.13pt" cellspacing="0"><tr style="height:13pt"><td style="width:19pt" rowspan="3"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:23pt"><p class="s29" style="padding-left: 7pt;text-indent: 0pt;line-height: 10pt;text-align: left;">{</p></td><td style="width:24pt"><p class="s29" style="padding-right: 4pt;text-indent: 0pt;line-height: 10pt;text-align: right;">id:</p></td><td style="width:28pt"><p class="s29" style="padding-left: 3pt;text-indent: 0pt;line-height: 10pt;text-align: left;">555,</p></td><td style="width:38pt"><p class="s29" style="padding-left: 7pt;padding-right: 9pt;text-indent: 0pt;line-height: 10pt;text-align: center;">desc:</p></td><td style="width:35pt"><p class="s29" style="padding-right: 7pt;text-indent: 0pt;line-height: 10pt;text-align: right;">&quot;task</p></td><td style="width:35pt"><p class="s29" style="padding-left: 5pt;padding-right: 7pt;text-indent: 0pt;line-height: 10pt;text-align: center;">555&quot;,</p></td><td style="width:59pt"><p class="s29" style="padding-left: 7pt;text-indent: 0pt;line-height: 10pt;text-align: left;">done: false },</p></td></tr><tr style="height:15pt"><td style="width:23pt"><p class="s29" style="padding-top: 1pt;padding-left: 7pt;text-indent: 0pt;text-align: left;">{</p></td><td style="width:24pt"><p class="s29" style="padding-top: 1pt;padding-right: 4pt;text-indent: 0pt;text-align: right;">id:</p></td><td style="width:28pt"><p class="s29" style="padding-top: 1pt;padding-left: 3pt;text-indent: 0pt;text-align: left;">777,</p></td><td style="width:38pt"><p class="s29" style="padding-top: 1pt;padding-left: 7pt;padding-right: 9pt;text-indent: 0pt;text-align: center;">desc:</p></td><td style="width:35pt"><p class="s29" style="padding-top: 1pt;padding-right: 7pt;text-indent: 0pt;text-align: right;">&quot;task</p></td><td style="width:35pt"><p class="s29" style="padding-top: 1pt;padding-left: 5pt;padding-right: 7pt;text-indent: 0pt;text-align: center;">777&quot;,</p></td><td style="width:59pt"><p class="s29" style="padding-top: 1pt;padding-left: 7pt;text-indent: 0pt;text-align: left;">done: true },</p></td></tr><tr style="height:21pt"><td style="width:23pt"><p class="s29" style="padding-top: 2pt;padding-left: 7pt;text-indent: 0pt;text-align: left;">{</p></td><td style="width:24pt"><p class="s29" style="padding-top: 2pt;padding-right: 4pt;text-indent: 0pt;text-align: right;">id:</p></td><td style="width:28pt"><p class="s29" style="padding-top: 2pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">999,</p></td><td style="width:38pt"><p class="s29" style="padding-top: 2pt;padding-left: 7pt;padding-right: 9pt;text-indent: 0pt;text-align: center;">desc:</p></td><td style="width:35pt"><p class="s29" style="padding-top: 2pt;padding-right: 6pt;text-indent: 0pt;text-align: right;">&quot;task</p></td><td style="width:35pt"><p class="s29" style="padding-top: 2pt;padding-left: 5pt;padding-right: 7pt;text-indent: 0pt;text-align: center;">999&quot;,</p></td><td style="width:59pt"><p class="s29" style="padding-top: 2pt;padding-left: 7pt;text-indent: 0pt;text-align: left;">done: false },</p></td></tr><tr style="height:39pt"><td style="width:19pt"><p class="s228" style="padding-top: 8pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">b</p><p class="s29" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;line-height: 9pt;text-align: left;">{</p></td><td style="width:23pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:24pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:28pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:38pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:35pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:35pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:59pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr></table><p style="padding-top: 2pt;padding-left: 97pt;text-indent: 0pt;text-align: left;">responsible: &quot;ST&quot;,</p><p style="padding-top: 4pt;padding-left: 97pt;text-indent: 0pt;text-align: left;">tasks: [{ id: 444, desc: &quot;task 444&quot;, done: true }],</p><p class="s227" style="padding-top: 1pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">b</p><p class="s227" style="padding-top: 11pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">b</p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 126%;text-align: left;"><span>Ensure your code doesn’t throw an exception if, for example, the person you are looking for doesn’t<br/>appear in the web service result!</span></p></li><li data-list-text="8.3"><p class="s10" style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;">Thinking in abstract terms: <span class="p">Suppose you are looking through somewhat old code and find a<br/>function that looks like the following one. (I’m keeping the names vague and abstract so that you can<br/>focus on the structure and not on the actual functionality). Can you transform this into pointfree style?</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 401pt;text-indent: 0pt;text-align: left;">Questions  <span class="s153">311</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">function getSomeResults(things) {</p><p style="padding-top: 4pt;padding-left: 64pt;text-indent: 0pt;text-align: left;">return sort(group(filter(select(things))));</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="8.4"><p class="s10" style="padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: justify;">Reversing types: <span class="p">You can define the Composeo type using the Pipel ine&lt; &gt; type plus a new<br/>Reverseo type. What should that new type be?</span></p></li><li data-list-text="8.5"><p class="s10" style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;line-height: 126%;text-align: justify;">Empty pipeline? <span class="p">Do our pipelining functions work with an empty array of functions? Can you<br/>fix that?</span></p></li><li data-list-text="8.6"><p style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><b>Undetected impurity?: </b><span>Did you notice that the addToArray () function we wrote is actually<br/>impure? (Check out the </span><i>Argument mutation </i>section of <i>Chapter 4, Behaving Properly, </i><span>if you aren’t<br/>convinced!) Would it be better if we wrote it as follows? Should we go for it?</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">const addToArray = (a, v) =&gt; [...a, v] ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="8.7"><p class="s10" style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;">Needless transducing? <span class="p">We used transducers to simplify any sequence of mapping and filtering<br/>operations. Would you have needed this if you only had map () operations? What if you only had<br/>f  ilter () operations?</span></p></li><li data-list-text="8.8"><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: justify;"><b>What type? </b>In the <i>Chaining method calls </i><span>section, I explained that the type of the (chainified)<br/>myCity2 object was not the same as the type of the original myCity one. What is its type exactly?</span></p></li></ol></ol><p style="text-indent: 0pt;text-align: left;"><br/></p><h3 style="padding-top: 10pt;text-indent: 0pt;text-align: right;"><a name="bookmark377">9</a><a name="bookmark378">&zwnj;</a></h3><h2 style="padding-top: 4pt;text-indent: 0pt;text-align: right;">Designing Functions</h2><h2 style="padding-top: 1pt;text-indent: 0pt;text-align: right;">- Recursion</h2><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;">In <i>Chapter 8, Connecting Functions, </i><span>we considered yet more ways to create new functions out of<br/>combining previous existing ones. Here, we will get into a different theme: how to design and write<br/>functions in a typically functional way, by applying recursive techniques.</span></p><p style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;text-align: justify;">We will be covering the following topics:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l103"><li data-list-text="•"><p style="padding-left: 70pt;text-indent: -13pt;text-align: left;">Understanding what recursion is and how to think in order to produce recursive solutions</p></li><li data-list-text="•"><p style="padding-top: 7pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">Applying recursion to some well-known problems, such as making a change or the Tower of Hanoi</p></li><li data-list-text="•"><p class="s33" style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;line-height: 125%;text-align: left;">	<span class="p">Using recursion instead of iteration to re-implement some higher-order functions from<br/>earlier chapters</span></p></li><li data-list-text="•"><p style="padding-top: 5pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">Writing search and backtrack algorithms with ease</p></li><li data-list-text="•"><p class="s33" style="padding-top: 8pt;padding-left: 70pt;text-indent: -12pt;line-height: 123%;text-align: left;">	<span class="p">Traversing data structures, such as trees, to work with filesystem directories or with the<br/>browser DOM</span></p></li><li data-list-text="•"><p class="s33" style="padding-top: 5pt;padding-left: 70pt;text-indent: -13pt;line-height: 125%;text-align: left;">	<span class="p">Understanding mutual recursion and applying it to problems such as correctly evaluating<br/>arithmetical expressions</span></p></li><li data-list-text="•"><p style="padding-top: 5pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">Getting around some limitations caused by browser JavaScript engine considerations</p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-left: 44pt;text-indent: 0pt;text-align: justify;"><a name="bookmark379">Using recursion</a></p><p style="padding-top: 9pt;padding-left: 43pt;text-indent: 0pt;line-height: 115%;text-align: justify;"><span>Recursion is a key technique in FP, to the degree that some languages do not provide for iterations or<br/>loops, and work exclusively with recursion (Haskell, which we already mentioned, is a prime example<br/>of that). A fundamental fact of computer science is that whatever you can do with recursion, you can<br/>do with iteration (loops), and vice versa. The key concept is that there are many algorithms whose<br/>definition is far easier if you work recursively. On the other hand, recursion is not always taught, and<br/>many programmers, even after knowing about it, prefer not to use it. Therefore, in this section, we<br/>shall see several examples of recursive thinking so that you can adapt it for your functional coding.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">314  Designing Functions - Recursion</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-top: 6pt;padding-left: 65pt;text-indent: 0pt;text-align: left;"><a name="bookmark380">A typical, oft-quoted, and very old computer joke!</a></p><p class="s10" style="padding-top: 4pt;padding-left: 66pt;text-indent: 0pt;text-align: left;"><span class="p">Dictionary definition: </span>recursion: <i>(n) see </i>recursion</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>But what is recursion? There are many ways to define what recursion is, but the simplest one I’ve seen<br/>runs along the lines of </span><i>a function calling itself again and again until it doesn’t. </i><span>A more complex case is<br/>mutual recursion, the simplest example of which is when we have two functions, A () and B (), each<br/>of which calls the other, over and over, until they are done.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;text-align: justify;">Recursion is a natural technique for several kinds of problems, such as the following:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l104"><li data-list-text="•"><p style="padding-left: 79pt;text-indent: -13pt;text-align: left;">Mathematical definitions, such as the Fibonacci sequence or the factorial of a number</p></li><li data-list-text="•"><p class="s33" style="padding-top: 8pt;padding-left: 79pt;text-indent: -13pt;line-height: 124%;text-align: justify;">	<span class="p">Data-structure-related algorithms with recursively defined structures, such as lists (a list is<br/>either empty or consists of a head node followed by a list of nodes) or trees (a tree might be<br/>defined as a special node, called the root, linked to zero or more trees)</span></p></li><li data-list-text="•"><p class="s33" style="padding-top: 5pt;padding-left: 79pt;text-indent: -13pt;line-height: 126%;text-align: justify;">	<span class="p">Syntax analysis for compilers based on grammar rules, which themselves depend on other<br/>rules, which also depend on other rules, and so on</span></p></li></ul><p style="padding-top: 8pt;padding-left: 52pt;text-indent: 0pt;text-align: justify;">And many more! It even appears in art and humor, as shown in <i>Figure 9.1:</i></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 69pt;text-indent: 0pt;text-align: left;"><span><img width="481" height="237" alt="image" src="Image_041.jpg"/></span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-left: 58pt;text-indent: 0pt;text-align: left;">Figure 9.1 - Google itself jokes about it: if you ask about recursion, it answers,&quot;Did you mean: recursion&quot;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 5pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Apart from some easy base cases in which no further computation is required, a recursive function<br/>must call itself one or more times to perform part of the required calculations. This concept may not<br/>be very clear at this point, so in the following sections, we will see how we can think recursively and<br/>solve several common problems by applying this technique.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 381pt;text-indent: 0pt;text-align: left;">Using recursion   315</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 43pt;text-indent: 0pt;text-align: justify;"><a name="bookmark381">Thinking recursively</a></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>The key to solving problems recursively is assuming that you already have a function that does<br/>whatever you need and just calling it. (Doesn’t this sound weird? Actually, it is quite appropriate: if<br/>you want to solve a problem with recursion, you must first have solved it before...) On the other hand,<br/>if you attempt to work out in your head how the recursive calls work and try to follow the flow, you’ll<br/>probably just get lost. So, what you need to do is the following:</span></p><ol id="l105"><li data-list-text="1."><p style="padding-top: 8pt;padding-left: 70pt;text-indent: -17pt;text-align: left;">Assume you already have an appropriate function to solve your problem.</p></li><li data-list-text="2."><p style="padding-top: 6pt;padding-left: 70pt;text-indent: -17pt;text-align: left;">See how the big problem can be solved by solving one (or more) smaller problems.</p></li><li data-list-text="3."><p style="padding-top: 6pt;padding-left: 70pt;text-indent: -17pt;text-align: left;">Solve those problems by using the imagined function from <i>step 1.</i></p></li><li data-list-text="4."><p style="padding-top: 6pt;padding-left: 70pt;text-indent: -18pt;line-height: 123%;text-align: left;"><span>Decide what your base cases are. Make sure they are simple enough that they are solved directly,<br/>without requiring more calls.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>With these points in mind, you can solve problems by recursion because you’ll have the basic structure<br/>for                                                                                                    your recursive solution.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;text-align: justify;">There are three usual methods for solving problems by applying recursion:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l106"><li data-list-text="•"><p class="s10" style="padding-left: 70pt;text-indent: -13pt;line-height: 125%;text-align: justify;">Decrease and conquer <span class="p">is the simplest case, in which solving a problem directly depends on<br/>solving a single, simpler case of itself.</span></p></li><li data-list-text="•"><p style="padding-top: 5pt;padding-left: 70pt;text-indent: -12pt;line-height: 124%;text-align: justify;"><span class="s33">	</span><b>Divide and conquer </b><span>is a more general approach. The idea is to try to divide your problem<br/>into two or more smaller versions, solve them recursively, and use these solutions to solve the<br/>original problem. The only difference between this technique and </span><i>decrease and conquer </i><span>is that<br/>you have to solve two or more other problems instead of only one.</span></p></li><li data-list-text="•"><p style="padding-top: 5pt;padding-left: 70pt;text-indent: -12pt;line-height: 124%;text-align: justify;"><b>Dynamic programming </b>can be seen as a variant of <i>divide and conquer: </i><span>basically, you solve a<br/>complex problem by breaking it into a set of somewhat simpler versions of the same problem<br/>and solving each in order; however, a key idea in this strategy is to store previously found<br/>solutions, so that whenever you find yourself needing the solution to a simpler case again,<br/>you won’t directly apply recursion but, instead, use the stored result and avoid unnecessary<br/>repeated calculations.</span></p></li></ul></li></ol><p style="padding-top: 8pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>In this section, we shall look at a few problems and solve them by thinking recursively. Of course, we<br/>shall see more applications of recursion in the rest of the chapter; here, we’ll focus on the key decisions<br/>and questions needed to create such an algorithm.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s34" style="padding-left: 43pt;text-indent: 0pt;text-align: justify;">Decrease and conquer - searching</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>The most usual case of recursion involves just a single, simple case. We have already seen some<br/>examples of this, such as the ubiquitous factorial calculation: to calculate the factorial of </span><i>n, </i><span>you<br/>previously needed to calculate the factorial of </span><i>n-1. </i>(See <i>Chapter 1, Becoming Functional.) </i><span>Let’s turn<br/>now  to a non-mathematical example.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">316  Designing Functions - Recursion</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: left;"><span>You would also use this decrease-and-conquer strategy to search for an element in an array. If the array<br/>is empty, then obviously the searched-for value isn’t there; otherwise, the result is in the array if, and<br/>only if, it’s the array’s first element or if it’s in the rest of the array. The following code does just that:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// search.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 74pt;text-indent: -12pt;line-height: 142%;text-align: left;"><span>const search = &lt;A&gt;(arr: A[], key: A): boolean =&gt; {<br/>if (arr.length === 0) {</span></p><p style="padding-left: 85pt;text-indent: 0pt;text-align: left;">return false;</p><p style="padding-top: 4pt;padding-left: 85pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>} else if (arr[0] === key) {<br/>return true;</span></p><p style="padding-left: 75pt;text-indent: 0pt;line-height: 10pt;text-align: left;">} else {</p><p style="padding-top: 4pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">return search(arr.slice(1), key) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">};</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">This implementation directly mirrors our explanation, and verifying its correctness is easy.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>By the way, just as a precaution, let’s look at two further implementations of the same concept. You<br/>can shorten the search function a bit—is it still clear?</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>We are using a ternary operator to detect whether the array is empty, and a Boolean | | operator to<br/>return true if the first element is the sought one or else return the result of the recursive search:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 73pt;text-indent: -12pt;line-height: 144%;text-align: left;"><span>const search2 = &lt;A&gt;(arr: A[], key: A): boolean =&gt;<br/>arr.length === 0</span></p><p style="padding-left: 86pt;text-indent: 0pt;text-align: left;">? false</p><p style="padding-top: 4pt;padding-left: 87pt;text-indent: 0pt;text-align: left;">: arr[0] === key || search2(arr.slice (1) , key);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">Sparseness can go even further! Using &amp;&amp; as a shortcut is a common idiom:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">const search3 = &lt;A&gt;(arr: A[], key: A): boolean =&gt;</p><p style="padding-top: 4pt;padding-left: 75pt;text-indent: 0pt;text-align: left;">!!arr.length &amp;&amp;</p><p style="padding-top: 4pt;padding-left: 76pt;text-indent: 0pt;text-align: left;">(arr[0] === key || search3(arr.slice(1), key));</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 381pt;text-indent: 0pt;text-align: left;">Using recursion   317</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>I’m not really suggesting that you code the function in this way—instead, consider it a warning against<br/>the tendency that some FP developers have to try to go for the tightest, shortest possible solution and<br/>never mind clarity!</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s34" style="padding-left: 43pt;text-indent: 0pt;text-align: justify;">Decrease and conquer - doing powers</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Another classic example has to do with efficiently calculating powers of numbers. If you want to<br/>calculate, say, 2 to the 13th power (2</span><span class="s162">13</span><span>), then you can do this with 12 multiplications; however, you<br/>can do much better by writing 2</span><span class="s162">13 </span>as the following:</p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;text-align: left;">= 2 times 2<span class="s162">12</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: left;">= 2 times 4<span class="s162">6</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: left;">= 2 times 16<span class="s162">3</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: left;">= 2 times 16 times 16<span class="s162">2</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: left;">= 2 times 16 times 256<span class="s162">1</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: left;">= 8192</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>This reduction in the total number of multiplications may not look very impressive, but in terms of<br/>algorithmic complexity, it allows us to bring down the order of the calculations from O(n) to O(log<br/></span><i>ri). </i><span>In some cryptographic-related methods, which have to raise numbers to really high exponents,<br/>this makes a significant difference. We can implement this recursive algorithm in a few lines of code,<br/>as shown in the following code:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// power.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 65pt;text-indent: -12pt;line-height: 144%;text-align: left;"><span>const powerN = (base: number, power: number): number =&gt; {<br/>if (power === 0) {</span></p><p style="padding-left: 77pt;text-indent: 0pt;line-height: 10pt;text-align: left;">return 1;</p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">} else if (power % 2) {</p><p class="s9" style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">11 <span class="p">odd power?</span></p><p style="padding-top: 4pt;padding-left: 76pt;text-indent: 0pt;text-align: left;">return base * powerN(base, power - 1) ;</p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">} else {</p><p style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">// even power?</p><p style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">return powerN(base * base, power / 2);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">318  Designing Functions - Recursion</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-top: 5pt;padding-left: 65pt;text-indent: 0pt;text-align: justify;"><a name="bookmark382">Extra speed</a></p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;line-height: 115%;text-align: justify;"><span>When implemented for production, bit operations are used instead of modulus and divisions.<br/>Checking whether a number is odd can be written as power &amp; 1, and division by 2 is achieved<br/>with power &gt; &gt; 1. These alternative calculations are way faster than the replaced operations.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Calculating a power is simple when the base case is reached (raising something to the zeroth power)<br/>or based on a previously calculated power for a smaller exponent. (If you wanted to, you could add<br/>another base case for raising something to the power of one.) These observations show that we are<br/>seeing a textbook case for the decrease and conquer recursive strategy.</span></p><p style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Finally, some of our higher-order functions, such as map (), reduce (), and filter (), also apply<br/>this technique; we’ll look into this later on in this chapter.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s34" style="padding-left: 52pt;text-indent: 0pt;text-align: justify;">Divide and conquer - the Tower of Hanoi</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-bottom: 3pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>With the divide-and-conquer strategy, solving a problem requires two or more recursive solutions.<br/>For starters, let’s consider a classic puzzle invented by a French mathematician, Edouard Lucas, in<br/>the 19th century. The puzzle involves a temple in India, with 3 posts, the first of them with 64 golden<br/>disks of decreasing diameter. The priests have to move the disks from the first post to the last one<br/>following two rules: only one disk can be moved at a time, and a larger disk can never be placed on<br/>top  of a smaller disk. According to the legend, when the 64 disks are moved, the world will end. This<br/>puzzle is usually marketed under the </span><i>Tower of Hanoi </i><span>name (yes, they changed countries!) with fewer<br/>than 10 disks. See </span><i>Figure 9.2:</i></p><p style="padding-left: 69pt;text-indent: 0pt;text-align: left;"><span><img width="484" height="240" alt="image" src="Image_042.jpg"/></span></p><p class="s164" style="padding-top: 8pt;padding-left: 108pt;text-indent: 0pt;text-align: left;">Figure 9.2 - The classic Tower of Hanoi puzzle has a simple recursive solution</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 381pt;text-indent: 0pt;text-align: left;">Using recursion   319</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 56pt;text-indent: 0pt;text-align: left;"><a name="bookmark383">A long, long time...</a></p><p style="padding-top: 4pt;padding-left: 57pt;text-indent: 0pt;line-height: 115%;text-align: left;">The solution for <i>n </i>disks requires 2&quot;-l movements. The original puzzle, requiring 2<span class="s162">64</span><span>-l movements,<br/>at one movement per second, would take more than 584 billion years to finish - a very long</span></p><p style="padding-left: 56pt;text-indent: 0pt;text-align: left;">time, considering that the universe’s age is evaluated to only be 13.8 billion years!</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 8pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: left;"><span>Suppose we already have a function that solves the problem of moving any number of disks from a<br/>source post to a destination post using the remaining post as an extra aid. Think about solving the<br/>general problem ifyou already had a function to solve that problem: hanoi (disks, from, to,</span></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>extra). If you wanted to move several disks from one post to another, then you could solve it using<br/>this (still unwritten!) function by carrying out the following steps:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><ol id="l107"><li data-list-text="1."><p style="padding-left: 70pt;text-indent: -17pt;text-align: left;">Moving all of the disks but the last one to the extra post.</p></li><li data-list-text="2."><p style="padding-top: 6pt;padding-left: 69pt;text-indent: -17pt;text-align: left;">Moving the last disk to the destination post.</p></li><li data-list-text="3."><p style="padding-top: 6pt;padding-left: 69pt;text-indent: -17pt;text-align: left;">Moving all the disks from the extra post (where you had placed them earlier) to the destination.</p></li></ol><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>But what about our base cases? We could decide that to move a single disk, you don’t need the function;<br/>you just go ahead and move the disk. When coded, it becomes the following:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// hanoi.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 64pt;text-indent: -11pt;line-height: 143%;text-align: left;"><span>const hanoi = (<br/>disks: number,<br/>from: Post,</span></p><p style="padding-left: 64pt;text-indent: 0pt;line-height: 142%;text-align: left;"><span>to: Post,<br/>extra: Post</span></p><p style="padding-top: 1pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">) =&gt; {</p><p style="padding-top: 3pt;padding-left: 76pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>if (disks === 1) {<br/>console.log(</span></p><p style="padding-left: 89pt;text-indent: 0pt;line-height: 10pt;text-align: left;">&#39;Move disk 1 from post ${from} to post ${to}&#39;</p><p style="padding-top: 5pt;padding-left: 33pt;text-indent: 0pt;text-align: center;">) ;</p><p style="padding-top: 3pt;padding-left: 29pt;text-indent: 0pt;text-align: center;">} else {</p><p style="padding-top: 4pt;padding-left: 76pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>hanoi(disks - 1, from, extra, to);<br/>console.log(</span></p><p style="padding-left: 89pt;text-indent: 0pt;text-align: left;">&#39;Move disk ${disks} from post ${from} to post ${to}&#39;</p><p style="padding-top: 5pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">) ;</p><p style="padding-top: 3pt;padding-left: 76pt;text-indent: 0pt;text-align: left;">hanoi(disks - 1, extra, to, from);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">320  Designing Functions - Recursion</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>Using the Post type is possibly not needed, but good practice anyway. We can quickly verify that<br/>this code works:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 61pt;text-indent: 0pt;text-align: left;"><a name="bookmark384">hanoi (4, &quot;A&quot;, &quot;B&quot;, &quot;C&quot;);</a></p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">// move all disks from A to B</p><p style="text-indent: 0pt;text-align: left;"><br/></p><table style="border-collapse:collapse;margin-left:58.93pt" cellspacing="0"><tr style="height:13pt"><td style="width:57pt"><p class="s29" style="padding-left: 2pt;text-indent: 0pt;line-height: 10pt;text-align: left;">Move disk</p></td><td style="width:24pt"><p class="s29" style="padding-right: 3pt;text-indent: 0pt;line-height: 10pt;text-align: right;">1</p></td><td style="width:28pt"><p class="s29" style="padding-left: 3pt;text-indent: 0pt;line-height: 10pt;text-align: left;">from</p></td><td style="width:26pt"><p class="s29" style="padding-right: 2pt;text-indent: 0pt;line-height: 10pt;text-align: right;">post</p></td><td style="width:14pt"><p class="s29" style="padding-left: 2pt;text-indent: 0pt;line-height: 10pt;text-align: left;">A</p></td><td style="width:20pt"><p class="s29" style="padding-left: 4pt;padding-right: 6pt;text-indent: 0pt;line-height: 10pt;text-align: center;">to</p></td><td style="width:32pt"><p class="s29" style="padding-right: 2pt;text-indent: 0pt;line-height: 10pt;text-align: right;">postC</p></td></tr><tr style="height:15pt"><td style="width:57pt"><p class="s29" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Move disk</p></td><td style="width:24pt"><p class="s29" style="padding-top: 1pt;padding-right: 3pt;text-indent: 0pt;text-align: right;">2</p></td><td style="width:28pt"><p class="s29" style="padding-top: 1pt;padding-left: 3pt;text-indent: 0pt;text-align: left;">from</p></td><td style="width:26pt"><p class="s29" style="padding-top: 1pt;padding-right: 2pt;text-indent: 0pt;text-align: right;">post</p></td><td style="width:14pt"><p class="s29" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">A</p></td><td style="width:20pt"><p class="s29" style="padding-top: 1pt;padding-left: 4pt;padding-right: 6pt;text-indent: 0pt;text-align: center;">to</p></td><td style="width:32pt"><p class="s29" style="padding-top: 1pt;padding-right: 2pt;text-indent: 0pt;text-align: right;">postB</p></td></tr><tr style="height:15pt"><td style="width:57pt"><p class="s29" style="padding-top: 2pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Move disk</p></td><td style="width:24pt"><p class="s29" style="padding-top: 2pt;padding-right: 3pt;text-indent: 0pt;text-align: right;">1</p></td><td style="width:28pt"><p class="s29" style="padding-top: 2pt;padding-left: 3pt;text-indent: 0pt;text-align: left;">from</p></td><td style="width:26pt"><p class="s29" style="padding-top: 2pt;padding-right: 2pt;text-indent: 0pt;text-align: right;">post</p></td><td style="width:14pt"><p class="s29" style="padding-top: 2pt;padding-left: 3pt;text-indent: 0pt;text-align: left;">C</p></td><td style="width:20pt"><p class="s29" style="padding-top: 2pt;padding-left: 4pt;padding-right: 6pt;text-indent: 0pt;text-align: center;">to</p></td><td style="width:32pt"><p class="s29" style="padding-top: 2pt;padding-right: 2pt;text-indent: 0pt;text-align: right;">postB</p></td></tr><tr style="height:15pt"><td style="width:57pt"><p class="s29" style="padding-top: 2pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Move disk</p></td><td style="width:24pt"><p class="s29" style="padding-top: 2pt;padding-right: 3pt;text-indent: 0pt;text-align: right;">3</p></td><td style="width:28pt"><p class="s29" style="padding-top: 2pt;padding-left: 3pt;text-indent: 0pt;text-align: left;">from</p></td><td style="width:26pt"><p class="s29" style="padding-top: 2pt;padding-right: 2pt;text-indent: 0pt;text-align: right;">post</p></td><td style="width:14pt"><p class="s29" style="padding-top: 2pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">A</p></td><td style="width:20pt"><p class="s29" style="padding-top: 2pt;padding-left: 4pt;padding-right: 6pt;text-indent: 0pt;text-align: center;">to</p></td><td style="width:32pt"><p class="s29" style="padding-top: 2pt;padding-right: 2pt;text-indent: 0pt;text-align: right;">postC</p></td></tr><tr style="height:15pt"><td style="width:57pt"><p class="s29" style="padding-top: 2pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Move disk</p></td><td style="width:24pt"><p class="s29" style="padding-top: 2pt;padding-right: 3pt;text-indent: 0pt;text-align: right;">1</p></td><td style="width:28pt"><p class="s29" style="padding-top: 2pt;padding-left: 3pt;text-indent: 0pt;text-align: left;">from</p></td><td style="width:26pt"><p class="s29" style="padding-top: 2pt;padding-right: 2pt;text-indent: 0pt;text-align: right;">post</p></td><td style="width:14pt"><p class="s29" style="padding-top: 2pt;padding-left: 3pt;text-indent: 0pt;text-align: left;">B</p></td><td style="width:20pt"><p class="s29" style="padding-top: 2pt;padding-left: 4pt;padding-right: 6pt;text-indent: 0pt;text-align: center;">to</p></td><td style="width:32pt"><p class="s29" style="padding-top: 2pt;padding-right: 2pt;text-indent: 0pt;text-align: right;">postA</p></td></tr><tr style="height:15pt"><td style="width:57pt"><p class="s29" style="padding-top: 2pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Move disk</p></td><td style="width:24pt"><p class="s29" style="padding-top: 2pt;padding-right: 3pt;text-indent: 0pt;text-align: right;">2</p></td><td style="width:28pt"><p class="s29" style="padding-top: 2pt;padding-left: 3pt;text-indent: 0pt;text-align: left;">from</p></td><td style="width:26pt"><p class="s29" style="padding-top: 2pt;padding-right: 2pt;text-indent: 0pt;text-align: right;">post</p></td><td style="width:14pt"><p class="s29" style="padding-top: 2pt;padding-left: 3pt;text-indent: 0pt;text-align: left;">B</p></td><td style="width:20pt"><p class="s29" style="padding-top: 2pt;padding-left: 4pt;padding-right: 6pt;text-indent: 0pt;text-align: center;">to</p></td><td style="width:32pt"><p class="s29" style="padding-top: 2pt;padding-right: 2pt;text-indent: 0pt;text-align: right;">postC</p></td></tr><tr style="height:15pt"><td style="width:57pt"><p class="s29" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Move disk</p></td><td style="width:24pt"><p class="s29" style="padding-top: 1pt;padding-right: 3pt;text-indent: 0pt;text-align: right;">1</p></td><td style="width:28pt"><p class="s29" style="padding-top: 1pt;padding-left: 3pt;text-indent: 0pt;text-align: left;">from</p></td><td style="width:26pt"><p class="s29" style="padding-top: 1pt;padding-right: 2pt;text-indent: 0pt;text-align: right;">post</p></td><td style="width:14pt"><p class="s29" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">A</p></td><td style="width:20pt"><p class="s29" style="padding-top: 1pt;padding-left: 4pt;padding-right: 6pt;text-indent: 0pt;text-align: center;">to</p></td><td style="width:32pt"><p class="s29" style="padding-top: 1pt;padding-right: 2pt;text-indent: 0pt;text-align: right;">postC</p></td></tr><tr style="height:15pt"><td style="width:57pt"><p class="s29" style="padding-top: 2pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Move disk</p></td><td style="width:24pt"><p class="s29" style="padding-top: 2pt;padding-right: 3pt;text-indent: 0pt;text-align: right;">4</p></td><td style="width:28pt"><p class="s29" style="padding-top: 2pt;padding-left: 3pt;text-indent: 0pt;text-align: left;">from</p></td><td style="width:26pt"><p class="s29" style="padding-top: 2pt;padding-right: 2pt;text-indent: 0pt;text-align: right;">post</p></td><td style="width:14pt"><p class="s29" style="padding-top: 2pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">A</p></td><td style="width:20pt"><p class="s29" style="padding-top: 2pt;padding-left: 4pt;padding-right: 6pt;text-indent: 0pt;text-align: center;">to</p></td><td style="width:32pt"><p class="s29" style="padding-top: 2pt;padding-right: 2pt;text-indent: 0pt;text-align: right;">postB</p></td></tr><tr style="height:15pt"><td style="width:57pt"><p class="s29" style="padding-top: 2pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Move disk</p></td><td style="width:24pt"><p class="s29" style="padding-top: 2pt;padding-right: 3pt;text-indent: 0pt;text-align: right;">1</p></td><td style="width:28pt"><p class="s29" style="padding-top: 2pt;padding-left: 3pt;text-indent: 0pt;text-align: left;">from</p></td><td style="width:26pt"><p class="s29" style="padding-top: 2pt;padding-right: 2pt;text-indent: 0pt;text-align: right;">post</p></td><td style="width:14pt"><p class="s29" style="padding-top: 2pt;padding-left: 3pt;text-indent: 0pt;text-align: left;">C</p></td><td style="width:20pt"><p class="s29" style="padding-top: 2pt;padding-left: 4pt;padding-right: 6pt;text-indent: 0pt;text-align: center;">to</p></td><td style="width:32pt"><p class="s29" style="padding-top: 2pt;padding-right: 2pt;text-indent: 0pt;text-align: right;">postB</p></td></tr><tr style="height:15pt"><td style="width:57pt"><p class="s29" style="padding-top: 2pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Move disk</p></td><td style="width:24pt"><p class="s29" style="padding-top: 2pt;padding-right: 3pt;text-indent: 0pt;text-align: right;">2</p></td><td style="width:28pt"><p class="s29" style="padding-top: 2pt;padding-left: 3pt;text-indent: 0pt;text-align: left;">from</p></td><td style="width:26pt"><p class="s29" style="padding-top: 2pt;padding-right: 2pt;text-indent: 0pt;text-align: right;">post</p></td><td style="width:14pt"><p class="s29" style="padding-top: 2pt;padding-left: 3pt;text-indent: 0pt;text-align: left;">C</p></td><td style="width:20pt"><p class="s29" style="padding-top: 2pt;padding-left: 4pt;padding-right: 6pt;text-indent: 0pt;text-align: center;">to</p></td><td style="width:32pt"><p class="s29" style="padding-top: 2pt;padding-right: 2pt;text-indent: 0pt;text-align: right;">postA</p></td></tr><tr style="height:15pt"><td style="width:57pt"><p class="s29" style="padding-top: 2pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Move disk</p></td><td style="width:24pt"><p class="s29" style="padding-top: 2pt;padding-right: 3pt;text-indent: 0pt;text-align: right;">1</p></td><td style="width:28pt"><p class="s29" style="padding-top: 2pt;padding-left: 3pt;text-indent: 0pt;text-align: left;">from</p></td><td style="width:26pt"><p class="s29" style="padding-top: 2pt;padding-right: 2pt;text-indent: 0pt;text-align: right;">post</p></td><td style="width:14pt"><p class="s29" style="padding-top: 2pt;padding-left: 3pt;text-indent: 0pt;text-align: left;">B</p></td><td style="width:20pt"><p class="s29" style="padding-top: 2pt;padding-left: 4pt;padding-right: 6pt;text-indent: 0pt;text-align: center;">to</p></td><td style="width:32pt"><p class="s29" style="padding-top: 2pt;padding-right: 2pt;text-indent: 0pt;text-align: right;">postA</p></td></tr><tr style="height:15pt"><td style="width:57pt"><p class="s29" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Move disk</p></td><td style="width:24pt"><p class="s29" style="padding-top: 1pt;padding-right: 3pt;text-indent: 0pt;text-align: right;">3</p></td><td style="width:28pt"><p class="s29" style="padding-top: 1pt;padding-left: 3pt;text-indent: 0pt;text-align: left;">from</p></td><td style="width:26pt"><p class="s29" style="padding-top: 1pt;padding-right: 2pt;text-indent: 0pt;text-align: right;">post</p></td><td style="width:14pt"><p class="s29" style="padding-top: 1pt;padding-left: 3pt;text-indent: 0pt;text-align: left;">C</p></td><td style="width:20pt"><p class="s29" style="padding-top: 1pt;padding-left: 4pt;padding-right: 6pt;text-indent: 0pt;text-align: center;">to</p></td><td style="width:32pt"><p class="s29" style="padding-top: 1pt;padding-right: 2pt;text-indent: 0pt;text-align: right;">postB</p></td></tr><tr style="height:15pt"><td style="width:57pt"><p class="s29" style="padding-top: 2pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Move disk</p></td><td style="width:24pt"><p class="s29" style="padding-top: 2pt;padding-right: 3pt;text-indent: 0pt;text-align: right;">1</p></td><td style="width:28pt"><p class="s29" style="padding-top: 2pt;padding-left: 3pt;text-indent: 0pt;text-align: left;">from</p></td><td style="width:26pt"><p class="s29" style="padding-top: 2pt;padding-right: 2pt;text-indent: 0pt;text-align: right;">post</p></td><td style="width:14pt"><p class="s29" style="padding-top: 2pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">A</p></td><td style="width:20pt"><p class="s29" style="padding-top: 2pt;padding-left: 4pt;padding-right: 6pt;text-indent: 0pt;text-align: center;">to</p></td><td style="width:32pt"><p class="s29" style="padding-top: 2pt;padding-right: 2pt;text-indent: 0pt;text-align: right;">postC</p></td></tr><tr style="height:15pt"><td style="width:57pt"><p class="s29" style="padding-top: 2pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Move disk</p></td><td style="width:24pt"><p class="s29" style="padding-top: 2pt;padding-right: 3pt;text-indent: 0pt;text-align: right;">2</p></td><td style="width:28pt"><p class="s29" style="padding-top: 2pt;padding-left: 3pt;text-indent: 0pt;text-align: left;">from</p></td><td style="width:26pt"><p class="s29" style="padding-top: 2pt;padding-right: 2pt;text-indent: 0pt;text-align: right;">post</p></td><td style="width:14pt"><p class="s29" style="padding-top: 2pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">A</p></td><td style="width:20pt"><p class="s29" style="padding-top: 2pt;padding-left: 4pt;padding-right: 6pt;text-indent: 0pt;text-align: center;">to</p></td><td style="width:32pt"><p class="s29" style="padding-top: 2pt;padding-right: 2pt;text-indent: 0pt;text-align: right;">postB</p></td></tr><tr style="height:13pt"><td style="width:57pt"><p class="s29" style="padding-top: 2pt;padding-left: 2pt;text-indent: 0pt;line-height: 9pt;text-align: left;">Move disk</p></td><td style="width:24pt"><p class="s29" style="padding-top: 2pt;padding-right: 3pt;text-indent: 0pt;line-height: 9pt;text-align: right;">1</p></td><td style="width:28pt"><p class="s29" style="padding-top: 2pt;padding-left: 3pt;text-indent: 0pt;line-height: 9pt;text-align: left;">from</p></td><td style="width:26pt"><p class="s29" style="padding-top: 2pt;padding-right: 2pt;text-indent: 0pt;line-height: 9pt;text-align: right;">post</p></td><td style="width:14pt"><p class="s29" style="padding-top: 2pt;padding-left: 3pt;text-indent: 0pt;line-height: 9pt;text-align: left;">C</p></td><td style="width:20pt"><p class="s29" style="padding-top: 2pt;padding-left: 4pt;padding-right: 6pt;text-indent: 0pt;line-height: 9pt;text-align: center;">to</p></td><td style="width:32pt"><p class="s29" style="padding-top: 2pt;padding-right: 2pt;text-indent: 0pt;line-height: 9pt;text-align: right;">postB</p></td></tr></table><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: left;"><span>There’s only a small detail to consider, which can simplify the function further. In this code, our base<br/>case (the one that needs no further recursion) is when disks equals one. You could also solve this<br/>differently by letting the disks go down to zero and simply not doing anything—after all, moving zero<br/>disks  from one post to another is achieved by doing nothing at all! The revised code would be as follows:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 73pt;text-indent: -11pt;line-height: 143%;text-align: left;"><span>const hanoi2 = (<br/>disks: number,<br/>from: Post,</span></p><p style="padding-left: 73pt;text-indent: 0pt;line-height: 141%;text-align: left;"><span>to: Post,<br/>extra: Post</span></p><p style="padding-top: 2pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">) =&gt; {</p><p style="padding-top: 2pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">if (disks &gt; 0) {</p><p style="padding-top: 4pt;padding-left: 85pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>hanoi(disks - 1, from, extra, to);<br/>console.log(</span></p><p style="padding-left: 156pt;text-indent: 0pt;line-height: 10pt;text-align: left;">&#39;Move disk ${disks} from post ${from} to post ${to}&#39;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 381pt;text-indent: 0pt;text-align: left;">Using recursion   321</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 77pt;text-indent: 0pt;text-align: left;">) ;</p><p style="padding-top: 3pt;padding-left: 76pt;text-indent: 0pt;text-align: left;">hanoi(disks - 1, extra, to, from);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>Instead of checking whether there are any disks to move before doing the recursive call, we can just<br/>skip the check and have the function test, at the next level, whether there’s something to be done.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-top: 5pt;padding-left: 57pt;text-indent: 0pt;text-align: justify;"><a name="bookmark385">Hanoi by hand</a></p><p style="padding-top: 4pt;padding-left: 56pt;text-indent: 0pt;line-height: 115%;text-align: justify;"><span>If you are doing the puzzle by hand, there’s a simple solution for that: on odd turns, always<br/>move the smaller disk to the next post (if the total number of disks is odd) or to the previous<br/>post (if the total number of disks is even). On even turns, make the only possible move that<br/>doesn’t involve the smaller disk.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>So, the principle for recursive algorithm design works: assume you already have your desired function<br/>and use it to build itself!</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s34" style="padding-left: 43pt;text-indent: 0pt;text-align: left;">Divide and conquer - sorting</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>We can see another example of the divide-and-conquer strategy with sorting. A way to sort arrays,<br/>called Quicksort, is based upon the following steps:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><ol id="l108"><li data-list-text="1."><p style="padding-left: 71pt;text-indent: -17pt;text-align: justify;">If your array has 0 or 1 element(s), do nothing; it’s already sorted (this is the base case).</p></li><li data-list-text="2."><p style="padding-top: 6pt;padding-left: 70pt;text-indent: -18pt;line-height: 124%;text-align: justify;"><span>Pick an element of the array (called the pivot) and split the rest of the array into two subarrays:<br/>the elements smaller than your chosen element and the elements greater than or equal to your<br/>chosen element.</span></p></li><li data-list-text="3."><p style="padding-top: 4pt;padding-left: 70pt;text-indent: -17pt;text-align: justify;">Recursively sort each subarray.</p></li><li data-list-text="4."><p style="padding-top: 6pt;padding-left: 70pt;text-indent: -18pt;line-height: 123%;text-align: justify;"><span>To produce the sorted version of the original array, concatenate both sorted results, with the<br/>pivot in between.</span></p></li></ol><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Let’s see a simple version of this (there are some better-optimized implementations, but we are interested<br/>in the recursive logic now). Usually, picking a random element of the array is suggested to avoid some<br/>bad performance border cases, but for our example, let’s just take the first one:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: justify;">// quicksort.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 65pt;text-indent: -12pt;line-height: 143%;text-align: left;"><span>const quicksort = &lt;A&gt;(arr: A[] ) : A[] =&gt; {<br/>if (arr.length &lt; 2) {</span></p><p style="padding-left: 77pt;text-indent: 0pt;line-height: 10pt;text-align: left;">return arr;</p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">} else {</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">322  Designing Functions - Recursion</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 85pt;text-indent: 0pt;text-align: left;">const pivot = arr[0];</p><p style="padding-top: 4pt;padding-left: 85pt;text-indent: 0pt;line-height: 142%;text-align: left;"><span>const smaller = arr.slice(1).filter((x) =&gt; x &lt; pivot);<br/>const greaterEqual = arr</span></p><p style="padding-left: 99pt;text-indent: 0pt;text-align: left;">. slice(1)</p><p style="padding-top: 4pt;padding-left: 85pt;text-indent: 13pt;line-height: 144%;text-align: left;"><span>.filter((x) =&gt; x &gt;= pivot);<br/>return [</span></p><p style="padding-left: 97pt;text-indent: 2pt;line-height: 144%;text-align: left;"><span>...quicksort(smaller),<br/>pivot,</span></p><p style="padding-left: 99pt;text-indent: 0pt;line-height: 10pt;text-align: left;">...quicksort(greaterEqual),</p><p style="padding-top: 5pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">] ;</p><p style="padding-top: 5pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">}</p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">};</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">console.log(quicksort([22, 9, 60, 12, 4, 56]));</p><p class="s10" style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">// [4, 9, 12, 22, 56, 60]</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;">We can see how this works in <i>Figure 9.3: </i><span>the pivot for each array and subarray is underlined. Splitting<br/>is shown with dotted arrows and is joined with full lines:</span></p><p class="s17" style="padding-top: 7pt;padding-left: 51pt;text-indent: 0pt;text-align: center;">22, 9, 60,12, 4, 56</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 178pt;text-indent: 0pt;text-align: left;"><span><img width="190" height="165" alt="image" src="Image_043.gif"/></span></p><p class="s164" style="padding-top: 7pt;padding-left: 132pt;text-indent: 0pt;line-height: 154%;text-align: center;"><span>Figure 9.3 - Quicksort sorts an array recursively, applying the divide-and-<br/>conquer strategy to reduce the original problem to smaller ones</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 65pt;text-indent: 0pt;text-align: left;"><a name="bookmark386">Easy-to-get bug!</a></p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;line-height: 115%;text-align: left;">Writing Quicksort correctly is not trivial; see <i>Question 9.8 </i><span>at the end of this chapter for an<br/>alternative version that is </span><i>almost </i>right, but not totally correct!</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 381pt;text-indent: 0pt;text-align: left;">Using recursion   323</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>We have already seen the basic strategies to reduce a problem to simpler versions of itself. Let’s now<br/>look at an important optimization, a key for many algorithms.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s34" style="padding-left: 43pt;text-indent: 0pt;text-align: justify;">Dynamic programming - making change</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;">The third general strategy, <i>dynamic programming, </i><span>assumes that you will have to solve many smaller<br/>problems, but instead of using recursion every time, it depends on you having stored the previously<br/>found solutions - </span><i>memoization, </i>in other words! In <i>Chapter 4, Behaving Properly, </i><span>and later, in a better<br/>fashion, in </span><i>Chapter 6, Producing Functions, </i><span>we already saw how to optimize the calculations of the<br/>usual Fibonacci series, avoiding unnecessary repeated calls. Let’s now consider another problem.</span></p><p style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Given a certain number of dollars and the list of existing bill values, calculate how many different<br/>ways we can pay that amount of dollars with different combinations of bills. It is assumed that you<br/>have access to an unlimited number of each bill. How can we go about solving this? Let’s start by<br/>considering the base cases where no further computation is needed. They are as follows:</span></p><ul id="l109"><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">Paying negative values is not possible, so in such cases, we should return 0</p></li><li data-list-text="•"><p class="s33" style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;line-height: 123%;text-align: left;">	<span class="p">Paying zero dollars is only possible in a single way (by giving no bills), so in this case, we<br/>should return 1</span></p></li><li data-list-text="•"><p class="s33" style="padding-top: 5pt;padding-left: 70pt;text-indent: -13pt;line-height: 123%;text-align: left;">	<span class="p">Paying any positive amount of dollars isn’t possible if no bills are provided, so in this case,<br/>also return 0</span></p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;">Finally, we can answer the question: in how many ways can we pay <i>N </i><span>dollars with a given set of bills?<br/>We can consider two cases: we do not use the larger bill at all and pay the amount using only smaller<br/>denomination bills, or we can take one bill of the larger amount and reconsider the question. (Let’s<br/>forget  the avoidance of repeated calculations for now.)</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: justify;">In the first case, we should invoke our supposedly existing function with the same value of <i>N </i><span>but<br/>prune the largest bill denomination from the list of available bills.</span></p><p style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: justify;">In the second case, we should invoke our function with <i>N </i><span>minus the largest bill denomination, keeping<br/>the list of bills the same, as shown in the following code:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// makeChange.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 65pt;text-indent: -12pt;line-height: 144%;text-align: left;"><span>const makeChange = (n: number, bills: number!]): number =&gt; {<br/>if (n &lt; 0) {</span></p><p style="padding-left: 77pt;text-indent: 0pt;text-align: left;">return 0; // no way of paying negative amounts</p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">} else if (n == 0) {</p><p style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">return 1; // one single way of paying $0: with no bills</p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">} else if (bills.length == 0) {</p><p style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">// here, n&gt;0</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">324  Designing Functions - Recursion</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 85pt;text-indent: 0pt;text-align: left;">return 0; // no bills? no way of paying</p><p style="padding-top: 4pt;padding-left: 75pt;text-indent: 0pt;text-align: left;">} else {</p><p style="padding-top: 4pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">return (</p><p style="padding-top: 4pt;padding-left: 97pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>makeChange(n, bills.slice (1)) +<br/>makeChange(n - bills [0] , bills)</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 75pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 8pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">console.log(makeChange(64, [100, 50, 20, 10, 5, 2, 1])) ;</p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">// 969 ways of paying $64</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Now, lets do some optimization. This algorithm often needs to recalculate the same values over and over.<br/>(To verify this, add console . log (n, bills . length) as the first line in makeChange () —but<br/>be ready for plenty of output!) However, we already have a solution for this: memoization! Since we<br/>are applying this technique to a binary function, we’ll need a version of the memoization algorithm<br/>that deals with more than one parameter. We saw that in </span><i>Chapter 6, Producing Functions:</i></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 74pt;text-indent: -12pt;line-height: 142%;text-align: left;"><span>const memoize4 = &lt;T extends (...x: any[]) =&gt; any&gt;(<br/>fn: T</span></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">): ((...x: Parameters&lt;T&gt;) =&gt; ReturnType&lt;T&gt;) =&gt; {</p><p style="padding-top: 4pt;padding-left: 73pt;text-indent: 0pt;line-height: 146%;text-align: left;"><span>const cache = {} as Record&lt;string, ReturnType&lt;T&gt;&gt;;<br/>return (...args) =&gt; {</span></p><p style="padding-left: 85pt;text-indent: 0pt;line-height: 142%;text-align: left;"><span>const strX = JSON.stringify(args);<br/>return strX in cache</span></p><p style="padding-left: 98pt;text-indent: 0pt;text-align: left;">? cache[strX]</p><p style="padding-top: 4pt;padding-left: 99pt;text-indent: 0pt;text-align: left;">: (cache[strX] = fn(...args));</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;text-align: left;">const   makeChange   =   <b>memoize4(</b>(n,   bills)   =&gt;   {</p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">// ...same as above</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 381pt;text-indent: 0pt;text-align: left;">Using recursion   325</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>The memoized version of make Change () is far more efficient, and you can verify it with logging.<br/>While it is certainly possible to deal with the repetitions by yourself (for example, by keeping an array<br/>of already computed values), the memoization solution is, in my opinion, better because it composes<br/>two functions to produce a better solution for the given problem.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 44pt;text-indent: 0pt;text-align: justify;"><a name="bookmark387">Higher-order functions revisited</a></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Classic FP techniques do not use iteration at all but work exclusively with recursion as the only<br/>way to do some looping. Let’s revisit some of the functions that we have already seen in </span><i>Chapter 5,</i><span>such as map (), reduce (), find (), and f ilter (), to see how we<br/>can make do with just recursion.</span></p><p style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>We are not planning to exchange the basic JavaScript functions for ours, though: it’s likely that<br/>performance will be worse for our recursive polyfills, and we won’t derive any advantages just from<br/>having the functions use recursion. Instead, we want to study how iterations are performed in a<br/>recursive way so that our efforts are more pedagogical than practical, OK?</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s34" style="padding-left: 43pt;text-indent: 0pt;text-align: justify;">Mapping and filtering</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Mapping and filtering are quite similar insofar as both imply going through all the elements in an<br/>array and applying a callback to each to produce output. Lets first work out the mapping logic, which<br/>will have several points to solve, and then we should see that filtering has become almost trivially<br/>easy, requiring just small changes.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>For mapping, given how we are developing recursive functions, we need a base case. Fortunately, that’s<br/>easy: mapping an empty array produces a new empty array. Mapping a non-empty array can be done<br/>by first applying the mapping function to the first element of the array, then recursively mapping the<br/>rest of the array, and finally, producing a single array accumulating both results.</span></p><p style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Based on this idea, we can work out a simple initial version: let’s call it mapR (), just to remember that<br/>we are dealing with our own, recursive version of map (); however, be careful - our polyfill has some<br/>bugs! We’ll deal with them one at a time. Here’s our first attempt at writing our own mapping code:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// map.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 64pt;text-indent: -12pt;line-height: 142%;text-align: left;"><span>const mapR = &lt;A, B&gt;(arr: A[], cb: (x: A) =&gt; B): B[] =&gt;<br/>arr.length === 0</span></p><p class="s17" style="padding-left: 77pt;text-indent: 0pt;line-height: 12pt;text-align: left;">? 11</p><p style="padding-top: 3pt;padding-left: 43pt;text-indent: 47pt;line-height: 223%;text-align: left;"><span>[cb(arr [0])] .concat(mapR(arr.slice(1), cb) ) ;<br/>Let’s test it out:</span></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 10pt;text-align: left;">const aaa = [1, 2, 4, 5, 7];</p><p style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">const timesTen = (x: number): number = &gt; x * 10;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">326  Designing Functions - Recursion</p><p style="text-indent: 0pt;text-align: left;"><br/></p><table style="border-collapse:collapse;margin-left:59.38pt" cellspacing="0"><tr style="height:13pt"><td style="width:169pt"><p class="s29" style="padding-left: 2pt;text-indent: 0pt;line-height: 10pt;text-align: left;">console.log(aaa.map(timesTen));</p></td><td style="width:77pt"><p class="s29" style="padding-right: 6pt;text-indent: 0pt;line-height: 10pt;text-align: right;">// [10,</p></td><td style="width:67pt"><p class="s29" style="padding-left: 6pt;text-indent: 0pt;line-height: 10pt;text-align: left;">20,  40, 50,</p></td><td style="width:26pt"><p class="s29" style="padding-right: 2pt;text-indent: 0pt;line-height: 10pt;text-align: right;">70]</p></td></tr><tr style="height:13pt"><td style="width:169pt"><p class="s29" style="padding-top: 2pt;padding-left: 2pt;text-indent: 0pt;line-height: 9pt;text-align: left;">console.log(mapR(aaa, timesTen));</p></td><td style="width:77pt"><p class="s29" style="padding-top: 2pt;padding-right: 6pt;text-indent: 0pt;line-height: 9pt;text-align: right;">// [10,</p></td><td style="width:67pt"><p class="s29" style="padding-top: 2pt;padding-left: 6pt;text-indent: 0pt;line-height: 9pt;text-align: left;">20,  40, 50,</p></td><td style="width:26pt"><p class="s29" style="padding-top: 2pt;padding-right: 2pt;text-indent: 0pt;line-height: 9pt;text-align: right;">70]</p></td></tr></table><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Great! Our mapR () function seemingly produces the same results as map (). However, shouldn’t<br/>our callback function receive a couple more parameters, specifically the index at the array and the<br/>original array itself? (Check out the definition for the callback function for map () at developer .<br/>mozilia.org/en/docs/Web/JavaScript/Reference/Global_Objects/Array/map.)</span></p><p style="padding-top: 6pt;padding-left: 61pt;text-indent: -9pt;line-height: 220%;text-align: justify;"><span>Our implementation isn’t quite ready yet. Let’s first see how it fails by using a simple example:<br/>const timesTenPlusI = (v: number, i: number) =&gt; 10 * v + i;</span></p><p style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">console.log(aaa.map(timesTenPlusI)); // [10, 21, 42, 53,</p><p style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">74]</p><p style="padding-top: 4pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">console.log(mapR(aaa, timesTenPlusI));</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: justify;">If you were working with JavaScript, the last call would produce [NaN, NaN, NaN, NaN, NaN]</p><p style="padding-top: 2pt;padding-left: 52pt;text-indent: 0pt;text-align: justify;">- TypeScript detects the error because the type of timesTenPlusI () is wrong:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 61pt;text-indent: 0pt;line-height: 115%;text-align: left;"><a name="bookmark388">Argument  of  type  </a><span class="s229">1</span><span>(v:  number,  i:  number)  =&gt;  number&#39;  is  not<br/>assignable to parameter of type </span><span class="s229">1</span>(x: number) =&gt; number&#39;.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Generating the appropriate index position will require an extra parameter for the recursion. Still, it<br/>is basically simple: when we start out, we have index=0, and when we call our function recursively,<br/>it’s with the index+1 position. Accessing the original array requires yet another parameter, which<br/>will never change, and now we have a better mapping function:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 73pt;text-indent: -12pt;line-height: 142%;text-align: left;"><span>const mapR2 = &lt;A, B&gt;(<br/>arr : A [] ,</span></p><p style="padding-left: 74pt;text-indent: 0pt;line-height: 143%;text-align: left;"><span>cb: (x: A, i: number, arr: A[] ) =&gt; B,<br/>i = 0,</span></p><p style="padding-left: 73pt;text-indent: 0pt;text-align: left;">orig = arr</p><p style="padding-top: 5pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">) : B[] =&gt;</p><p style="padding-top: 3pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">arr.length == 0</p><p style="padding-top: 5pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">? []</p><p style="padding-top: 3pt;padding-left: 87pt;text-indent: 0pt;text-align: left;">: [cb(arr[0], i, orig)].concat(</p><p class="s10" style="padding-top: 4pt;padding-left: 109pt;text-indent: 0pt;text-align: left;">mapR2(arr.slice(1), cb, i + 1, orig)</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 381pt;text-indent: 0pt;text-align: left;">Using recursion   327</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 64pt;text-indent: -11pt;line-height: 142%;text-align: left;"><span>const senseless = (<br/>x: number,</span></p><p style="padding-left: 64pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>i: number,<br/>a: number []</span></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">): number = &gt;x*10 + i + a[i] / 10;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">console.log(aaa.map(senseless));</p><p class="s10" style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">//  [10.1,  21.2,   42.4,   53.5,   74.7]</p><p style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">console.log(mapR2(aaa, senseless));</p><p class="s10" style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">//  [10.1,  21.2,   42.4,   53.5,   74.7]</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Great! When you do recursion instead of iteration, you don’t have access to an index, so if you need<br/>it (as in our case), you’ll have to generate it on your own. Uris is an often-used technique, so working<br/>out our map () substitute was a good idea.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>However, having extra arguments in the function is not so good; a developer might accidentally<br/>provide them and the results would be unpredictable. So, using another usual technique, let’s define<br/>an inner function, mapLoop (), to handle looping. This is, in fact, the usual way in which looping<br/>is achieved when you only use recursion; look at the following code, in which the extra function isn’t<br/>accessible from outside:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 64pt;text-indent: -11pt;line-height: 142%;text-align: left;"><span>const mapR3 = &lt;A, B&gt;(<br/>orig : A [] ,</span></p><p style="padding-left: 65pt;text-indent: 0pt;text-align: left;">cb: (x: A, i: number, a: A[]) =&gt; B</p><p style="padding-top: 5pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">) : B [] =&gt; {</p><p class="s10" style="padding-top: 4pt;padding-left: 76pt;text-indent: -12pt;line-height: 143%;text-align: left;">const mapLoop = <span class="p">(arr: A[], i: number): B[] =&gt;<br/>arr.length == 0</span></p><p style="padding-left: 89pt;text-indent: 0pt;text-align: left;">? []</p><p style="padding-top: 3pt;padding-left: 90pt;text-indent: 0pt;text-align: left;">:    [cb(arr[0],    i,    orig)].concat(</p><p class="s10" style="padding-top: 4pt;padding-left: 112pt;text-indent: 0pt;text-align: left;">mapLoop(arr.slice(1),   i   +   1)</p><p style="padding-top: 5pt;padding-left: 101pt;text-indent: 0pt;text-align: left;">) ;</p><p style="padding-top: 3pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">return mapLoop(orig, 0);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">console.log(mapR3(aaa, senseless));</p><p class="s10" style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// [10.1, 21.2, 42.4, 53.5, 74.7], <span class="p">again</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">328  Designing Functions - Recursion</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>There’s only one pending issue: if the original array has some missing elements, they should be skipped<br/>during the loop. Lets look at an example, in plain JavaScript:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 64pt;text-indent: 0pt;text-align: left;">[1, 2, , , 5].map(tenTimes)</p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">// [10, 20, undefined x 2, 50]</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>(Why just JavaScript? TypeScript would object because the array to be processed had number |<br/>undefined types, but timesTen () expects an array with just number types. By the way, I also</span></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 10pt;text-align: left;">had to disable ESLint’s no - sparse - array rule, which catches accidental extra commas in arrays.)</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Fortunately, fixing this is simple—and be glad that all the experience gained here will help us write<br/>the other functions in this section! Can you understand the fix in the following code, apart from the<br/>obvious changes to allow values in arrays to be undefined, for which I used an auxiliary Opto</span></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 10pt;text-align: justify;">type definition?</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 62pt;text-indent: 0pt;text-align: left;"><a name="bookmark389">type Opt&lt;X&gt; = X | undefined;</a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 73pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>const mapR4 = &lt;A, B&gt;(<br/>orig: Opt&lt;A&gt; [] ,</span></p><p style="padding-left: 73pt;text-indent: 0pt;text-align: left;">cb: (x: A, i: number, a: Opt&lt;A&gt;[]) =&gt; B</p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">) : Opt&lt;B&gt; [] =&gt; {</p><p style="padding-top: 4pt;padding-left: 85pt;text-indent: -12pt;line-height: 142%;text-align: left;"><span>const mapLoop = (arr: Opt&lt;A&gt;[] , i: number) : Opt&lt;B&gt; [] =&gt;<br/>arr.length == 0</span></p><p style="padding-top: 1pt;padding-left: 98pt;text-indent: 0pt;text-align: left;">? []</p><p class="s10" style="padding-top: 3pt;padding-left: 99pt;text-indent: 0pt;text-align: left;">: !(0 in arr) || arr[0] === undefined</p><p class="s10" style="padding-top: 4pt;padding-left: 120pt;text-indent: -22pt;line-height: 144%;text-align: left;"><span>? ([,] as Opt&lt;B&gt;[]).concat(<br/>mapLoop(arr.slice(1), i + 1)</span></p><p class="s10" style="padding-left: 110pt;text-indent: 0pt;text-align: left;">)</p><p class="s10" style="padding-top: 3pt;padding-left: 121pt;text-indent: -21pt;line-height: 144%;text-align: left;"><span>: ([cb(arr[0] as A, i, orig)] as Opt&lt;B&gt; []).concat(<br/>mapLoop(arr.slice(1), i + 1)</span></p><p class="s10" style="padding-left: 110pt;text-indent: 0pt;text-align: left;">) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">return mapLoop(orig, 0) ;</p><p style="padding-top: 6pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">};</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;line-height: 126%;text-align: left;"><span>Wow! This was more than we bargained for, but we saw several techniques: how to replace iteration<br/>with recursion, how to accumulate a result across iterations, and how to generate and provide the</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 381pt;text-indent: 0pt;text-align: left;">Using recursion   329</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>index value—good tips! Furthermore, writing filtering code will prove much easier since we’ll be<br/>able to apply very much the same logic as we did for mapping. The main difference is that we use the<br/>callback function to decide whether an element goes into the output array, so the inner loop function<br/>is   a tad longer:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// filter.ts</p><p style="padding-top: 3pt;padding-left: 53pt;text-indent: 0pt;line-height: 30pt;text-align: left;"><span>type Opt&lt;X&gt; = X | undefined;<br/>const filterR = &lt;A&gt;(</span></p><p style="padding-left: 64pt;text-indent: 0pt;text-align: left;">orig : Opt&lt;A&gt; [] ,</p><p style="padding-top: 4pt;padding-left: 64pt;text-indent: 0pt;text-align: left;">cb: (x: A, i: number, a: Opt&lt;A&gt;[]) =&gt; boolean</p><p style="padding-top: 5pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">) : A [] =&gt; {</p><p style="padding-top: 4pt;padding-left: 76pt;text-indent: -12pt;line-height: 144%;text-align: left;"><span>const filterLoop = (arr: Opt&lt;A&gt;[], i: number): A[] =&gt;<br/>arr.length == 0</span></p><p class="s17" style="padding-left: 89pt;text-indent: 0pt;line-height: 12pt;text-align: left;">? 11</p><p class="s10" style="padding-top: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: center;">: !(0 in arr) ||</p><p class="s10" style="padding-top: 4pt;padding-left: 51pt;text-indent: 0pt;text-align: center;">arr[0] === undefined ||</p><p class="s10" style="padding-top: 4pt;padding-left: 51pt;text-indent: 0pt;text-align: center;">!cb(arr[0] as A, i, orig)</p><p class="s10" style="padding-top: 4pt;padding-left: 51pt;text-indent: 0pt;text-align: center;">? filterLoop(arr.slice(1), i + 1)</p><p class="s10" style="padding-top: 4pt;padding-left: 113pt;text-indent: -23pt;line-height: 142%;text-align: left;"><span>: ([arr[0J] as A[]).concat(<br/>filterLoop(arr.slice(1), i + 1) as A[]</span></p><p class="s10" style="padding-top: 1pt;padding-left: 101pt;text-indent: 0pt;text-align: left;">) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 6pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">return filterLoop(orig, 0);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: justify;"><span>Okay, we managed to implement two of our basic higher-order functions with similar recursive<br/>functions. What about the others?</span></p><p class="s34" style="padding-top: 8pt;padding-left: 43pt;text-indent: 0pt;text-align: justify;">Other higher-order functions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Programming reduce () is, from the outset, a bit trickier, since you can decide to omit the initial value<br/>for the accumulator. Since we mentioned earlier that providing that value is generally better, let’s work<br/>here under the assumption that it will be given; dealing with the other possibility won’t be too hard.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>The base case is simple: if the array is empty, the result is the accumulator; otherwise, we must apply<br/>the reduce function to the current element and the accumulator, update the latter, and then continue<br/>working with the rest of the array. This can be a bit confusing because of the ternary operators, but it<br/>should be clear enough after all we’ve seen. Look at the following code for the details:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">330  Designing Functions - Recursion</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// reduce.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 73pt;text-indent: -11pt;line-height: 141%;text-align: left;"><span>const reduceR = &lt;A, B&gt;(<br/>orig: A [] ,</span></p><p style="padding-left: 73pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>cb: (acc: B, x: A, i: number, a: A[]) =&gt; B,<br/>accum: B</span></p><p style="padding-top: 2pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">) =&gt; {</p><p style="padding-top: 2pt;padding-left: 85pt;text-indent: -12pt;line-height: 144%;text-align: left;"><span>const reduceLoop = (arr: A [] , accum: B, i: number) : B =&gt;<br/>arr.length == 0</span></p><p style="padding-left: 98pt;text-indent: 0pt;line-height: 10pt;text-align: left;">? accum</p><p style="padding-top: 4pt;padding-left: 99pt;text-indent: 0pt;text-align: left;">: I(0 in arr) || arr[0] === undefined</p><p style="padding-top: 4pt;padding-left: 98pt;text-indent: 0pt;text-align: left;">? reduceLoop(arr.slice(1), accum, i + 1)</p><p style="padding-top: 4pt;padding-left: 99pt;text-indent: 0pt;text-align: left;">: reduceLoop(</p><p style="padding-top: 4pt;padding-left: 121pt;text-indent: 0pt;text-align: left;">arr.slice (1) ,</p><p style="padding-top: 4pt;padding-left: 122pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>cbfaccum, arr[0], i, orig),<br/>i + 1</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">return reduceLoop(orig, accum, 0) ;</p><p style="padding-top: 6pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">};</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">let bbb = [1, 2, , 5, 7, 8, 10, 21, 40];</p><p style="padding-top: 4pt;padding-left: 61pt;text-indent: 0pt;line-height: 143%;text-align: left;"><span>console.log(bbb.reduce((x, y) =&gt; x + y, 0)); // 94<br/>console.log(reduce2(bbb, (x, y) =&gt; x + y, 0)); // 94</span></p><p style="padding-top: 8pt;padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>On the other hand, find () is particularly apt for recursive logic since the very definition of how<br/>you (attempt to) find something is recursive in itself:</span></p><ul id="l110"><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 79pt;text-indent: -13pt;text-align: left;">You look at the first place you think of, and if you find what you were seeking, you are done</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 79pt;text-indent: -13pt;text-align: left;">Alternatively, you look at the other places to see whether what you seek is there</p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>We are only missing the base case, but that’s simple, and we already saw this earlier in the chapter - if<br/>you have no places left to search, then you know you won’t be successful in your search:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// find.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 73pt;text-indent: -12pt;line-height: 142%;text-align: left;"><span>const findR = &lt;A&gt;(<br/>arr : A [] ,</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 381pt;text-indent: 0pt;text-align: left;">Using recursion   331</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 64pt;text-indent: 0pt;text-align: left;">cb: (x: A) =&gt; boolean</p><p style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">): Opt&lt;A&gt; =&gt;</p><p style="padding-top: 4pt;text-indent: 0pt;text-align: right;">arr.length === 0</p><p style="padding-top: 4pt;text-indent: 0pt;text-align: right;">? undefined</p><p style="padding-top: 4pt;text-indent: 0pt;text-align: right;">: cb(arr [0])</p><p style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">? arr[0]</p><p style="padding-top: 4pt;padding-left: 78pt;text-indent: 0pt;text-align: left;">: findR(arr.slice(1), cb) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: left;">We can quickly verify whether this works:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">let aaa = [1, 12, , , 5, 22, 9, 60] ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 53pt;text-indent: 0pt;line-height: 115%;text-align: left;"><span>const isTwentySomething = x =&gt; 20 &lt;= x &amp;&amp; x &lt;= 29; console,<br/>log(findR(aaa, isTwentySomething)); // 22</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 6pt;padding-left: 53pt;text-indent: 0pt;line-height: 115%;text-align: left;"><span>const isThirtySomething = x =&gt; 30 &lt;= x &amp;&amp; x &lt; = 39; console,<br/>log(findR(aaa, isThirtySomething)); // undefined</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: left;">Lets finish with our pipelining function. The definition of a pipeline lends itself to quick implementation:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l111"><li data-list-text="•"><p style="padding-left: 70pt;text-indent: -13pt;text-align: left;">If we want to pipeline a single function, then that’s the result of the pipeline</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;line-height: 123%;text-align: left;"><span>If we want to pipeline several functions, we must first apply the initial function and then pass<br/>that result as input to the pipeline of the other functions</span></p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: left;">We can directly turn this into code:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 42pt;text-indent: 0pt;text-align: center;">function pipelineR&lt;FNS extends FN[]&gt;(</p><p style="padding-top: 4pt;padding-left: 46pt;text-indent: 0pt;text-align: center;">. . .fns: FNS</p><p style="padding-top: 4pt;padding-left: 43pt;text-indent: 0pt;text-align: center;">): Pipeline&lt;FNS&gt;;</p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: -11pt;line-height: 143%;text-align: left;"><span>function pipelineR&lt;FNS extends FN[]&gt;(...fns: FNS): FN {<br/>return fns.length === 1</span></p><p style="padding-left: 77pt;text-indent: 0pt;text-align: left;">? fns [0]</p><p style="padding-top: 4pt;padding-left: 78pt;text-indent: 0pt;text-align: left;">: (...args) =&gt;</p><p style="padding-top: 4pt;padding-left: 100pt;text-indent: 0pt;text-align: left;">pipelineR(...fns.slice(1))(fns[0](...args));</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>We can verify its correctness with a simple example. Let’s pipeline several calls to a couple of functions,<br/>one of which just adds 1 to its argument and the other of which multiplies by 10:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>const plusl = (x: number): number =&gt; x + 1;<br/>const bylO = (x: number): number =&gt; x * 10;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">332  Designing Functions - Recursion</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 73pt;text-indent: -12pt;line-height: 143%;text-align: left;"><span>pipelineR(<br/>bylO,<br/>plusl,<br/>plusl,<br/>plusl,<br/>bylO,<br/>plusl,<br/>bylO,<br/>bylO,<br/>plusl,<br/>plusl,<br/>plusl</span></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">) (2) ;</p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">// 23103</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>If you follow the math, you’ll be able to check that the pipelining is working fine. We could have a<br/>slightly different recursive call if we take the base case to be when no functions are provided:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 20pt;text-indent: 0pt;text-align: center;">function pipelineR2&lt;FNS extends FN []&gt;(</p><p style="padding-top: 4pt;padding-left: 51pt;text-indent: 0pt;text-align: center;">...fns: FNS</p><p style="padding-top: 4pt;padding-left: 51pt;text-indent: 0pt;text-align: center;">): Pipeline&lt;FNS&gt;;</p><p style="padding-top: 4pt;padding-left: 73pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>function pipelineR2&lt;FNS extends FN []&gt;(... fns : FNS): FN {<br/>return </span><b>fns.length === 0</b></p><p class="s10" style="padding-left: 86pt;text-indent: 0pt;line-height: 10pt;text-align: left;">? (...args) =&gt; args[0]</p><p style="padding-top: 4pt;padding-left: 87pt;text-indent: 0pt;text-align: left;">: ( . . .args) =&gt;</p><p style="padding-top: 4pt;padding-left: 109pt;text-indent: 0pt;text-align: left;">pipelineR2(...fns.slice(1) ) (fns[0] (...args) ) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>In any case, these pipelines won’t work in TypeScript because our Pipelineo type definition won’t<br/>allow for an empty set of functions - can you fix that?</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>Doing the same for composition is easy, except that you cannot use the spread operator to simplify<br/>the function definition, and you’ll have to work with array indices—work it out!</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 381pt;text-indent: 0pt;text-align: left;">Using recursion   333</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 43pt;text-indent: 0pt;text-align: justify;"><a name="bookmark390">Searching and backtracking</a></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Searching for solutions to problems, especially when there is no direct algorithm and you must resort<br/>to trial and error, is particularly appropriate for recursion. Many of these algorithms fall into a scheme<br/>such as the following:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l112"><li data-list-text="•"><p style="padding-left: 71pt;text-indent: -13pt;text-align: left;">Out of many choices available, pick one. If no options are available, you’ve failed.</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 71pt;text-indent: -13pt;text-align: left;">If you could pick one, apply the same algorithm, but find a solution to the rest.</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 71pt;text-indent: -13pt;text-align: left;">If you succeed, you are done. Otherwise, try another choice.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>You can apply similar logic with minor variations to find a good—or possibly, optimum—solution to a<br/>given problem. Each time you find a possible solution, you match it with previous ones that you might<br/>have found and decide which to keep. This may continue until all possible solutions are evaluated or<br/>until a good enough solution has been found.</span></p><p style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;text-align: justify;">There are many problems to which this logic applies. They are as follows:</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="•"><p class="s9" style="padding-left: 70pt;text-indent: -12pt;line-height: 123%;text-align: justify;">Finding a way out of mazes—<span class="p">pick any path, mark it as already followed, and try to find a way<br/>out of the maze that won’t reuse that path: if you succeed, you are done, and if you do not, go<br/>back to pick a different path</span></p></li><li data-list-text="•"><p class="s33" style="padding-top: 5pt;padding-left: 70pt;text-indent: -12pt;line-height: 124%;text-align: justify;">	<span class="s9">Filling out Sudoku puzzles—</span><span class="p">if an empty cell can contain only a single number, then assign it;<br/>otherwise, run through all of the possible assignments, and for each one, recursively try to see<br/>whether the rest of the puzzle can be filled out</span></p></li><li data-list-text="•"><p class="s9" style="padding-top: 5pt;padding-left: 70pt;text-indent: -13pt;line-height: 123%;text-align: justify;">Playing chess—<span class="p">where you aren’t likely to be able to follow through all possible move sequences,<br/>so you opt for the best-estimated position instead</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Let’s apply these techniques to two problems: solving the eight queens puzzle and traversing a complete<br/>file directory.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s34" style="padding-left: 44pt;text-indent: 0pt;text-align: justify;">The eight queens puzzle</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>The eight queens puzzle was invented in the 19th century and involves placing eight chess queens on<br/>a standard chessboard. The restriction is that no queen should be able to attack another—implying<br/>that no pair of queens may share a row, column, or diagonal line. The puzzle may ask for any solution<br/>or the total number of distinct solutions, which we will attempt to find.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 56pt;text-indent: 0pt;text-align: justify;"><a name="bookmark391">The </a><i>n </i>queens variation</p><p style="padding-top: 4pt;padding-left: 56pt;text-indent: 0pt;line-height: 115%;text-align: justify;">The puzzle may also be generalized to <i>n </i><span>queens by working on an nxn square board. It is known<br/>that there are solutions for all values of </span><i>n, </i><span>except n=2 (pretty simple to see why: after placing<br/>one queen, all of the board is threatened) and </span><i>n=3 </i><span>(if you place a queen in the center, all of the<br/>board is threatened, and if you place a queen on a side, only two squares are not threatened,<br/>but they threaten each other, making it impossible to place queens on them).</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">334  Designing Functions - Recursion</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Let’s start our solution with top-level logic. Because of the given rules, there will be a single queen in<br/>each column, so we use a places array to take note of each queens row within the given column. The<br/>SIZE constant could be modified to solve a more general problem. We’ll count each found distribution<br/>of queens in the solutions variable. Finally, the finder () function will perform the recursive<br/>search for solutions. The basic skeleton for the code would be as follows:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// queens.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">const SIZE = 8;</p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;line-height: 143%;text-align: left;"><span>const places = Array(SIZE);<br/>let solutions = 0;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">finder();</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 8pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">console.log(&#39;Solutions found: ${solutions}&#39;);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Let’s get into the required logic. When we want to place a queen in a given row and column, we must<br/>check whether any of the previously placed queens were placed on the same row or in a diagonal<br/>leading from the row. See </span><i>Figure 9.4:</i></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 140pt;text-indent: 0pt;text-align: left;"><span><img width="296" height="327" alt="image" src="Image_044.gif"/></span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-left: 58pt;text-indent: 0pt;text-align: left;">Figure 9.4 - Before placing a queen in a column, we must check the previously placed queens&#39;positions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 381pt;text-indent: 0pt;text-align: left;">Using recursion   335</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: left;">Let’s write a checkPlace (column, row) function to verify whether a queen can be safely placed</p><p style="padding-top: 2pt;padding-left: 43pt;text-indent: 0pt;text-align: left;">in the given square. The most straightforward way is by using every (), as shown in the following code:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 64pt;text-indent: -11pt;line-height: 146%;text-align: left;"><span>const checkPlace = (column: number, row: number): boolean =&gt;<br/>places</span></p><p style="padding-left: 78pt;text-indent: 0pt;line-height: 10pt;text-align: left;">,slice(0, column)</p><p style="padding-top: 4pt;padding-left: 78pt;text-indent: 0pt;text-align: left;">.every(</p><p style="padding-top: 4pt;padding-left: 90pt;text-indent: 0pt;text-align: left;">(v, i) =&gt;</p><p style="padding-top: 4pt;padding-left: 147pt;text-indent: 0pt;text-align: left;">v !== row &amp;&amp; Math.abs(v - row) !== column - i</p><p style="padding-top: 5pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>This declarative fashion seems best: when we place a queen in a position, we want to ensure that every<br/>other previously placed queen is in a different row and diagonal. A recursive solution would have<br/>been possible too, so let’s see that. How do we know that a square is safe?</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="•"><p style="padding-left: 70pt;text-indent: -13pt;text-align: left;">A base case is when there are no more columns to check, the square is safe</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">If the square is in the same row or diagonal as any other queen, it’s not safe</p></li><li data-list-text="•"><p class="s33" style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;line-height: 123%;text-align: left;">	<span class="p">If we have checked a column and found no problem, we can now recursively check the<br/>following one</span></p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>The required alternative code to check whether a position in a column can be occupied by a queen<br/>is, therefore, as follows:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s9" style="padding-left: 53pt;text-indent: 0pt;text-align: left;">I<span class="p">/ continued...</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 64pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>const  checkR  =  (column:  number,  row:  number):  boolean  =&gt;  {<br/>const checkColumn = (i: number): boolean = &gt; {</span></p><p style="padding-left: 89pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>if (i == column) {<br/>return true;</span></p><p style="padding-left: 77pt;text-indent: 0pt;line-height: 10pt;text-align: left;">} else if (</p><p style="padding-top: 4pt;padding-left: 88pt;text-indent: 0pt;text-align: left;">places[i] == row |</p><p style="padding-top: 4pt;padding-left: 88pt;text-indent: 0pt;text-align: left;">Math.abs(places[i] - row) == column - i</p><p style="padding-top: 6pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">) {</p><p style="padding-top: 2pt;padding-left: 89pt;text-indent: 0pt;text-align: left;">return false;</p><p style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">} else {</p><p style="padding-top: 4pt;padding-left: 88pt;text-indent: 0pt;text-align: left;">return checkColumn(i + 1);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">336  Designing Functions - Recursion</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 74pt;text-indent: 0pt;text-align: left;">};</p><p style="padding-top: 2pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">return checkcolumn(0);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>The code works, but I wouldn’t use it since the declarative version is clearer. Anyway, having worked<br/>out this check, we can pay attention to the main f inder () logic, which will do the recursive search.</span></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>The process proceeds as we described at the beginning: try out a possible placement for a queen, and<br/>if that is acceptable, use the same search procedure to try and place the remaining queens. We start<br/>at column 0, and our base case is when we reach the last column, meaning that all queens have been</span></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">successfully placed: we can print out the solution, count it, and go back to search for a new configuration.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-top: 7pt;padding-left: 66pt;text-indent: 0pt;text-align: left;"><a name="bookmark392">Getting nice output</a></p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;line-height: 115%;text-align: left;"><span>Check out how we use map () and a simple arrow function to print the rows of the queens,<br/>column by column, as numbers between 1 and 8, instead of 0 and 7. In chess, rows are numbered<br/>from 1 to 8 (and columns from a to h, but that doesn’t matter here).</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">Check out the following code, which applies the logic that we described previously:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 74pt;text-indent: -12pt;line-height: 142%;text-align: left;"><span>const finder = (column =0) =&gt; {<br/>if (column === SIZE) {</span></p><p style="padding-left: 86pt;text-indent: 0pt;text-align: left;">// all columns tried out?</p><p style="padding-top: 4pt;padding-left: 85pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>// if so, print and count solution<br/>console.log(JSON.stringify(places.map((x) =&gt; x + 1) ) ) ;<br/>solutions++;</span></p><p style="padding-left: 75pt;text-indent: 0pt;line-height: 10pt;text-align: left;">} else {</p><p style="padding-top: 4pt;padding-left: 98pt;text-indent: -12pt;line-height: 144%;text-align: left;"><span>const testRowsInColumn = (j: number) =&gt; {<br/>if (j &lt; SIZE) {</span></p><p style="padding-left: 121pt;text-indent: -11pt;line-height: 143%;text-align: left;"><span>if (checkR(column, j)) {<br/>places [column] = j;<br/>finder(column + 1) ;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 109pt;text-indent: 0pt;text-align: left;">testRowsInColumn(j + 1) ;</p><p style="padding-top: 6pt;padding-left: 98pt;text-indent: 0pt;text-align: left;">}</p><p style="padding-top: 4pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">};</p><p style="padding-top: 2pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">testRowsInColumn(0);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 381pt;text-indent: 0pt;text-align: left;">Using recursion   337</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>The inner testRowsInColumn () function also fulfills an iterative role, but recursively. The idea<br/>is to attempt placing a queen in every possible row, starting at zero: if the square is safe, finder ()</span></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: left;"><span>is called to start searching from the next column onward. No matter whether a solution was or wasn’t<br/>found, all rows in the column are tried out because we are interested in the total number of solutions.<br/>In other search problems, you might be content with finding any solution, and you would stop your<br/>search there.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;text-align: left;">We have come this far, so let’s find the answer to our problem!</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 55pt;text-indent: 0pt;text-align: left;">11,5,8,6,3,7,2,4]</p><p class="s10" style="padding-top: 4pt;padding-left: 55pt;text-indent: 0pt;text-align: left;">11,6,8,3,7,4,2,5]</p><p class="s10" style="padding-top: 4pt;padding-left: 55pt;text-indent: 0pt;text-align: left;">11,7,4,6,8,2,5,3]</p><p class="s10" style="padding-top: 4pt;padding-left: 55pt;text-indent: 0pt;text-align: left;">11,7,5,8,2,4,6,3]</p><p class="s10" style="padding-top: 4pt;padding-left: 55pt;text-indent: 0pt;text-align: left;">12,4,6,8,3,1,7,5]</p><p class="s10" style="padding-top: 4pt;padding-left: 55pt;text-indent: 0pt;text-align: left;">12,5,7,1,3,8,6,4]</p><p class="s10" style="padding-top: 4pt;padding-left: 55pt;text-indent: 0pt;text-align: left;">12,5,7,4,1,8,6,3]</p><p class="s10" style="padding-top: 4pt;padding-left: 55pt;text-indent: 0pt;text-align: left;">12,6,1,7,4,8,3,5]</p><p class="s10" style="padding-top: 3pt;padding-left: 55pt;text-indent: 17pt;line-height: 30pt;text-align: left;"><span>... 70 lines snipped out<br/>18,2,4,1,7,5,3,6]</span></p><p class="s10" style="padding-left: 55pt;text-indent: 0pt;text-align: left;">18,2,5,3,1,7,4,6]</p><p class="s10" style="padding-top: 4pt;padding-left: 55pt;text-indent: 0pt;text-align: left;">18,3,1,6,2,5,7,4]</p><p class="s10" style="padding-top: 4pt;padding-left: 55pt;text-indent: 0pt;text-align: left;">18,4,1,3,6,2,7,5]</p><p class="s10" style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">Solutions found: 92</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>Each solution is given as the row positions for the queens, column by column, and there are 92<br/>solutions in all.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s34" style="padding-left: 44pt;text-indent: 0pt;text-align: left;">Traversing a tree structure</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Data structures, which include recursion in their definition, are naturally appropriate for recursive<br/>techniques. Let’s consider, for example, how to traverse a complete filesystem directory, listing all of<br/>its contents. Where’s the recursion? The answer is straightforward if you consider that each directory<br/>can do either of the following:</span></p><ul id="l113"><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">Be empty—a base case in which there’s nothing to do</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">Include one or more entries, each of which is either a file or a directory itself</p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>Let’s work out a full recursive directory listing—meaning that when we encounter a directory, we also<br/>list its contents, and if those include more directories, we also list them, and so on. We’ll be using</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">338  Designing Functions - Recursion</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;">the same node functions as in getDir () (from the <i>Building pipelines by hand </i>section in <i>Chapter 8,</i><span>plus a few more to test whether a directory entry is a symbolic link (which<br/>we won’t follow to avoid possible infinite loops), a directory (which will require a recursive listing),<br/>or a common file:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// directory.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 62pt;text-indent: 0pt;text-align: left;"><a name="bookmark393">import * as fs from &quot;fs&quot;;</a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-top: 7pt;padding-left: 73pt;text-indent: -12pt;line-height: 144%;text-align: left;"><span>const recursiveDir = (path: string) =&gt; {<br/></span><span class="p">console.log(path);<br/>fs.readdirSync(path).forEach((entry) =&gt; {</span></p><p style="padding-left: 86pt;text-indent: 0pt;line-height: 10pt;text-align: left;">if (entry.startsWith(&quot;.&quot;) ) {</p><p style="padding-top: 4pt;padding-left: 98pt;text-indent: 0pt;text-align: left;">// skip it I</p><p style="padding-top: 4pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">} else {</p><p style="padding-top: 4pt;padding-left: 97pt;text-indent: 0pt;line-height: 143%;text-align: justify;"><span>const full = path + &quot;/&quot; + entry;<br/>const stats = fs.IstatSync(full);<br/>if (stats.isSymbolicLink()) {</span></p><p style="padding-left: 109pt;text-indent: 0pt;text-align: justify;">console.log(&quot;L &quot;, full); // symlink, don&#39;t follow</p><p style="padding-top: 4pt;padding-left: 109pt;text-indent: -11pt;line-height: 143%;text-align: left;"><span>} else if (stats.isDirectory()) {<br/>console.log(&quot;D &quot;, full);<br/></span><b>recursiveDir(full);</b></p><p style="padding-left: 99pt;text-indent: 0pt;text-align: left;">} else {</p><p style="padding-top: 4pt;padding-left: 109pt;text-indent: 0pt;text-align: left;">console.log(&quot;     &quot;, full);</p><p style="padding-top: 6pt;padding-left: 98pt;text-indent: 0pt;text-align: left;">}</p><p style="padding-top: 4pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">}</p><p style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">});</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>The listing is long but correct. I opted to list the /boot directory in my own openSUSE Linux laptop,<br/>and this was produced:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 61pt;text-indent: 0pt;text-align: left;">recursiveDir(&quot;/boot&quot;);</p><p class="s10" style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">/boot</p><p class="s10" style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">/boot/System.map-4.11.8-1-default</p><p class="s10" style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">/boot/boot.readme</p><p class="s10" style="padding-top: 4pt;padding-left: 61pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>/boot/config-4.11.8-1-default D /boot/efi<br/>D   /boot/efi/EFI</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 381pt;text-indent: 0pt;text-align: left;">Using recursion   339</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 52pt;text-indent: 0pt;text-align: left;">D  /boot/efi/EFI/boot</p><p class="s10" style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">/boot/efi/EFI/boot/bootx64.efi</p><p class="s10" style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">/boot/efi/EFI/boot/fallback.efi</p><p class="s10" style="padding-left: 52pt;text-indent: 1pt;line-height: 30pt;text-align: left;"><span>... many omitted lines<br/>L /boot/initrd</span></p><p class="s10" style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">/boot/initrd-4.11.8-1-default</p><p class="s10" style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">/boot/message</p><p class="s10" style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">/boot/symtypes-4.11.8-1-default.gz</p><p class="s10" style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">/boot/symvers-4.11.8-1-default.gz</p><p class="s10" style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">/boot/sysctl.conf-4.11.8-1-default</p><p class="s10" style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">/boot/vmlinux-4.11.8-1-default.gz L /boot/vmlinuz</p><p class="s10" style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">/boot/vmlinuz-4.11.8-1-default</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>We can apply the same structure to a similar problem: traversing a DOM structure. We could list all of<br/>the tags, starting from a given element, using the same approach: we list a node and (by applying the<br/>same algorithm) all of its children. The base case is the same as before: when a node has no children,<br/>no more recursive calls are made. You can see this in the following code:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// dom.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 64pt;text-indent: -11pt;line-height: 141%;text-align: left;"><span>const  traverseDom  =  (node:  Element,  depth  =  0)  =&gt;  {<br/>console.log(</span></p><p style="padding-left: 77pt;text-indent: 0pt;text-align: left;">&#39;${&quot;| &quot;.repeat(depth)}&lt;${node.nodeName.toLowerCase() } &gt;&#39;</p><p style="padding-top: 5pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">) ;</p><p style="padding-top: 3pt;padding-left: 76pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>for   (let   i   =   0;   i   &lt;   node.children.length;   i++)   {<br/>traverseDom(node.children[i], depth + 1) ;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>We are using the depth variable to know how many levels below the original element we are. We<br/>could also use it to make the traversing logic stop at a certain level; in our case, we are using it only<br/>to add some bars and spaces to appropriately indent each element according to its place in the DOM<br/>hierarchy. The result of this function is shown in the following code. It would be easy to list more<br/>information and not just the element tag, but I wanted to focus on the recursive process:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 53pt;text-indent: 0pt;text-align: left;">traverseDom(document.body);</p><p class="s10" style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">&lt;body&gt;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 20pt;text-indent: 0pt;text-align: left;">340  <span class="s153">Designing Functions - Recursion</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 73pt;text-indent: 0pt;text-align: left;">&lt;script&gt;</p><p class="s10" style="padding-top: 4pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">&lt;div&gt;</p><p class="s10" style="padding-top: 4pt;text-indent: 0pt;text-align: right;">&lt;div&gt;</p><p class="s10" style="padding-top: 4pt;text-indent: 0pt;text-align: right;">&lt;a&gt;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><table style="border-collapse:collapse;margin-left:60.83pt" cellspacing="0"><tr style="height:14pt"><td style="width:50pt"><p class="s188" style="padding-left: 3pt;text-indent: 0pt;line-height: 10pt;text-align: left;">| | | &lt;div&gt;</p></td><td style="width:63pt" colspan="3" rowspan="2"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:30pt"><td style="width:50pt"><p class="s29" style="padding-top: 3pt;padding-left: 3pt;text-indent: 0pt;line-height: 10pt;text-align: left;">Illi &lt;<span class="s230">ul&gt;</span></p><p class="s231" style="padding-left: 3pt;text-indent: 0pt;line-height: 16pt;text-align: left;">I <span class="s29">I I I </span>I <span class="s188">&lt;li&gt;</span></p></td></tr><tr style="height:12pt"><td style="width:50pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:7pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:13pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:43pt"><p class="s188" style="padding-left: 3pt;text-indent: 0pt;line-height: 10pt;text-align: left;">&lt;a&gt;</p></td></tr><tr style="height:17pt"><td style="width:50pt"><p class="s29" style="padding-left: 3pt;text-indent: 0pt;line-height: 15pt;text-align: left;">I  I <span class="s231">I I</span></p></td><td style="width:7pt"><p class="s29" style="padding-top: 5pt;text-indent: 0pt;line-height: 10pt;text-align: left;">I</p></td><td style="width:13pt"><p class="s29" style="padding-top: 5pt;text-indent: 0pt;line-height: 10pt;text-align: center;">I</p></td><td style="width:43pt"><p class="s231" style="padding-left: 4pt;text-indent: 0pt;line-height: 15pt;text-align: left;">I <span class="s188">&lt;div&gt;</span></p></td></tr><tr style="height:15pt"><td style="width:50pt"><p class="s29" style="padding-left: 3pt;text-indent: 0pt;line-height: 14pt;text-align: left;">I  I <span class="s231">I </span>I</p></td><td style="width:7pt"><p class="s29" style="padding-top: 4pt;text-indent: 0pt;line-height: 10pt;text-align: left;">I</p></td><td style="width:13pt"><p class="s29" style="padding-top: 4pt;text-indent: 0pt;line-height: 10pt;text-align: center;">I</p></td><td style="width:43pt"><p class="s231" style="padding-left: 4pt;text-indent: 0pt;line-height: 14pt;text-align: left;">I <span class="s29">I </span><span class="s188">&lt;div&gt;</span></p></td></tr><tr style="height:15pt"><td style="width:50pt"><p class="s29" style="padding-left: 3pt;text-indent: 0pt;line-height: 14pt;text-align: left;">I  I <span class="s231">I I</span></p></td><td style="width:7pt"><p class="s29" style="padding-top: 3pt;text-indent: 0pt;line-height: 10pt;text-align: left;">I</p></td><td style="width:13pt"><p class="s29" style="padding-top: 3pt;text-indent: 0pt;line-height: 10pt;text-align: center;">I</p></td><td style="width:43pt"><p class="s231" style="padding-left: 4pt;text-indent: 0pt;line-height: 14pt;text-align: left;">I <span class="s188">&lt;div&gt;</span></p></td></tr><tr style="height:15pt"><td style="width:50pt"><p class="s29" style="padding-left: 3pt;text-indent: 0pt;line-height: 14pt;text-align: left;">I  I <span class="s231">I I</span></p></td><td style="width:7pt"><p class="s29" style="padding-top: 4pt;text-indent: 0pt;line-height: 10pt;text-align: left;">I</p></td><td style="width:13pt"><p class="s29" style="padding-top: 4pt;text-indent: 0pt;line-height: 10pt;text-align: center;">I</p></td><td style="width:43pt"><p class="s29" style="padding-left: 4pt;text-indent: 0pt;line-height: 14pt;text-align: left;"><span class="s231">I </span>I &lt;<span class="s230">br</span>&gt;</p></td></tr><tr style="height:18pt"><td style="width:50pt"><p class="s29" style="padding-left: 3pt;text-indent: 0pt;line-height: 15pt;text-align: left;">I  I <span class="s231">I I</span></p></td><td style="width:7pt"><p class="s29" style="padding-top: 3pt;text-indent: 0pt;text-align: left;">I</p></td><td style="width:13pt"><p class="s29" style="padding-top: 3pt;text-indent: 0pt;text-align: center;">I</p></td><td style="width:43pt"><p class="s231" style="padding-left: 4pt;text-indent: 0pt;line-height: 15pt;text-align: left;">I <span class="s188">&lt;div&gt;</span></p></td></tr><tr style="height:27pt"><td style="width:50pt"><p class="s29" style="padding-top: 1pt;padding-left: 3pt;text-indent: 0pt;line-height: 10pt;text-align: left;">I I I I I I <span class="s230">&lt;ul</span>&gt;</p><p class="s29" style="padding-left: 3pt;text-indent: 0pt;line-height: 14pt;text-align: left;">I  I <span class="s231">I I</span></p></td><td style="width:7pt"><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s29" style="text-indent: 0pt;line-height: 9pt;text-align: left;">I</p></td><td style="width:13pt"><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s29" style="text-indent: 0pt;line-height: 9pt;text-align: center;">I</p></td><td style="width:43pt"><p class="s231" style="padding-top: 12pt;padding-left: 4pt;text-indent: 0pt;line-height: 14pt;text-align: left;">I <span class="s188">&lt;li&gt;</span></p></td></tr><tr style="height:15pt"><td style="width:50pt"><p class="s29" style="padding-left: 2pt;text-indent: 0pt;line-height: 14pt;text-align: left;">|  1 <span class="s231">I I</span></p></td><td style="width:7pt"><p class="s29" style="padding-top: 2pt;text-indent: 0pt;text-align: left;">|</p></td><td style="width:13pt"><p class="s29" style="padding-top: 2pt;text-indent: 0pt;text-align: center;">1</p></td><td style="width:43pt"><p class="s231" style="padding-left: 3pt;text-indent: 0pt;line-height: 14pt;text-align: left;">I I <span class="s188">&lt;a&gt;</span></p></td></tr><tr style="height:17pt"><td style="width:50pt"><p class="s29" style="padding-left: 3pt;text-indent: 0pt;line-height: 16pt;text-align: left;"><a name="bookmark394">I  I </a><span class="s231">I I</span></p></td><td style="width:7pt"><p class="s29" style="padding-top: 4pt;text-indent: 0pt;text-align: left;">I</p></td><td style="width:13pt"><p class="s29" style="padding-top: 4pt;text-indent: 0pt;text-align: center;">I</p></td><td style="width:43pt"><p class="s231" style="padding-left: 4pt;text-indent: 0pt;line-height: 16pt;text-align: left;">I <span class="s188">&lt;H&gt;</span></p></td></tr><tr style="height:11pt"><td style="width:50pt"><p class="s188" style="padding-left: 2pt;text-indent: 0pt;line-height: 9pt;text-align: left;">...etc . !</p></td><td style="width:7pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:13pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:43pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr></table><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>However, there’s an ugly point there: why are we making a loop to go through all of the children?<br/>We should know better! The problem is that the structure we get from the DOM isn’t really an array.</span></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>However, there’s a way out - we can use Array. from () to create a real array out of it and then<br/>write a more declarative solution. The following code solves the problem in a better way:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: right;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 73pt;text-indent: -12pt;line-height: 144%;text-align: left;"><span>const   traverseDom2   =   (node:   Element,   depth   =0)   =&gt;   {<br/>console.log(</span></p><p style="padding-left: 86pt;text-indent: 0pt;line-height: 10pt;text-align: left;">&#39;${&quot;| &quot;.repeat(depth)}&lt;${node.nodeName.toLowerCase()}&gt;&#39;</p><p style="padding-top: 5pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">) ;</p><p style="padding-top: 3pt;padding-left: 85pt;text-indent: -12pt;line-height: 143%;text-align: left;"><span>Array.from(node.children).forEach((child)             =&gt;<br/>traverseDom2(child, depth + 1)</span></p><p style="padding-left: 74pt;text-indent: 0pt;text-align: left;">) ;</p><p style="padding-top: 5pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">};</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">Writing [. . . node . children] . f orEach () would have worked as well but using Array.</p><p style="padding-top: 2pt;padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>f rom () makes it more apparent to any reader that we are trying to make an array out of something<br/>that looks like one, but really isn’t.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 376pt;text-indent: 0pt;text-align: left;">Mutual recursion   341</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>We have now seen many ideas about the usage of recursion, and we’ve seen many applications of it;<br/>however, there are some cases in which you may run into problems, so let’s now consider some tweaks<br/>that may come in handy for specific problems.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-left: 44pt;text-indent: 0pt;text-align: justify;"><a name="bookmark395">Mutual recursion</a></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Recursion need not be as “simple” and “direct” as having a function that calls itself. We can have<br/>more complex situations as a set of functions, each of which calls one or more of the others but not<br/>necessarily calling itself. (However, note that this is also allowed.)</span></p><p style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Thinking in terms of mutual recursion is harder. For simple recursion, you had to imagine you already<br/>had a function to do something, and then you used it (in itself!) to do that. In mutual recursion, you<br/>have to think of a set of functions, each of which does its own part by simultaneously depending on<br/>all the set of functions: the others, and possibly itself as well.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;text-align: justify;">Let’s examine a simple case to get our feet wet, and then go for a “real-life” application.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 43pt;text-indent: 0pt;text-align: justify;"><a name="bookmark396">Odds and evens</a></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>How can you determine whether a (not negative) integer number is odd or even? This a trivial problem,<br/>to be sure (but see </span><i>Question 9.11&#39;) </i>but we can get an interesting solution if we realize the following:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l114"><li data-list-text="•"><p style="padding-left: 70pt;text-indent: -13pt;text-align: left;">Zero is even</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">If a number is even, when you subtract 1 from it, you get an odd number</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">A number is odd if it’s not even:</p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 65pt;text-indent: -12pt;line-height: 137%;text-align: left;"><span>function   isEven(n:   number):   boolean   {<br/>if  (n  ===  o)  {</span></p><p style="padding-top: 1pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">return true;</p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">} else {</p><p style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">return <b>isOdd(n - 1);</b></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 65pt;text-indent: -12pt;line-height: 144%;text-align: left;"><span>function isOdd(n: number): boolean {<br/>return </span><b>lisEven(n);</b></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 6pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">console.log(&quot;22.. isEven?&quot;, isEven(22));</p><p style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">console.log(&quot;9. isOdd?&quot;, isOdd(5));</p><p style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">console.log(&quot;60. isOdd?&quot;, isOdd(lO));</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">342  Designing Functions - Recursion</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>How does this work? Each function (isEven () and is Odd ()) depends on the other to produce<br/>a result. How do we know that 9 is odd? The calculations are as follows:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">is 9 odd?</p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">Is 9 not even?</p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">Is 8 odd?</p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">Is 8 not even?</p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">Is 7 odd?</p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">Is 7 not even?</p><p style="padding-left: 62pt;text-indent: 19pt;line-height: 30pt;text-align: left;"><span>... several lines skipped<br/>Is 1 odd?</span></p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">Is 1 not even?</p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">Is 0 odd?</p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;line-height: 10pt;text-align: left;">Is 0 not even?</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">And after the last call, the whole tower of calls gets resolved; 9 is reported to be odd (fortunately!)</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>You could say that this actually isn’t a great example of mutual recursion, because you could easily<br/>replace the code for isOdd () in isEven () to get single recursion versions:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued-</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 74pt;text-indent: -12pt;line-height: 142%;text-align: left;"><span>function isEven2(n: number): boolean {<br/>if (n === 0) {</span></p><p style="padding-left: 85pt;text-indent: 0pt;text-align: left;">return true;</p><p style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">} else {</p><p style="padding-top: 4pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">return <b>!isEven2(n - 1) ;</b></p><p style="padding-top: 6pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">}</p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 73pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>function is0dd2(n: number): boolean {<br/>return !isEven2(n);</span></p><p style="padding-top: 2pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">However, we can go about this in another way that will also include mutual recursion:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 376pt;text-indent: 0pt;text-align: left;">Mutual recursion   343</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 65pt;text-indent: -12pt;line-height: 141%;text-align: left;"><span>function   isEven3(n:   number):   boolean   {<br/>if  (n  ===  0)  {</span></p><p style="padding-left: 76pt;text-indent: 0pt;text-align: left;">return true;</p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">} else {</p><p style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">return isOdd3(n - 1) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 65pt;text-indent: -11pt;line-height: 143%;text-align: left;"><span>function isOdd3(n: number): boolean {<br/>if (n === 0) {</span></p><p class="s10" style="padding-left: 76pt;text-indent: 0pt;text-align: left;">return false;</p><p class="s10" style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">} else {</p><p class="s10" style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">return isEven3(n - 1);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>So, don’t get to think that mutual recursion can always be simplified away; sometimes, that’s not really<br/>possible or practical.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Going back to the code, it should be evident that no one would implement a parity test this way.<br/>Still, this example paves the way to implementing a more complex function: parsing and evaluating<br/>an arithmetic expression, which will involve multiple mutually recursive functions, as we’ll see next.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 44pt;text-indent: 0pt;text-align: justify;"><a name="bookmark397">Doing arithmetic</a></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Let’s see a more complete problem, which also happens to (frequently!) appear online, with puzzles<br/>as in </span><i>Figure 9.5. </i><span>We’ll implement a set of mutually recursive functions that can correctly evaluate an<br/>arithmetic expression according to standard precedence rules for operators.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s211" style="padding-left: 44pt;text-indent: 0pt;text-align: center;">99% of people fail to answer!</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s232" style="padding-top: 9pt;padding-left: 44pt;text-indent: 0pt;text-align: center;">7+7/7+7*7-7=?</p><p class="s211" style="padding-top: 14pt;padding-left: 172pt;text-indent: 0pt;text-align: center;"><span>Only geniuses can solve this!<br/>Most people will get this wrong!</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 9pt;padding-left: 44pt;text-indent: 0pt;text-align: center;">Figure 9.5 - Common puzzles call for evaluating arithmetic expressions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">344  Designing Functions - Recursion</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="161" height="114" alt="image" src="Image_045.jpg"/></span></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;">To solve this, we’ll first see a tool that lets us correctly process operations: <i>railroad diagrams. </i><span>We want<br/>to evaluate an expression, and we can say that an expression is either one single term, or several terms<br/>added or subtracted. </span><i>Figure 9.6 </i><span>shows this graphically. Imagine the arrows are railroad tracks, and any<br/>path you follow that starts at the left and eventually ends at the right represents a possible expression.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s84" style="padding-top: 6pt;padding-left: 151pt;text-indent: 0pt;text-align: left;">EXPR:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-left: 131pt;text-indent: 0pt;text-align: left;">Figure 9.6 - A railroad syntax diagram for arithmetic expressions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="184" height="159" alt="image" src="Image_046.jpg"/></span></p><p style="padding-top: 5pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Now, what’s a term? A term is either a single factor, or the result of multiplying, dividing, or using<br/>modulus operations on several factors, as shown in </span><i>Figure 9.7. </i>Note that with these two rules, <i>2*3+5</i>is correctly evaluated as <i>(2*3)+5, </i>because <i>2*3 </i>and 5 are terms.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s84" style="padding-top: 7pt;padding-left: 150pt;text-indent: 0pt;text-align: left;">TERM:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 7pt;padding-left: 139pt;text-indent: 0pt;line-height: 154%;text-align: center;"><span>Figure 9.7 - A railroad syntax for terms: multiplication, division, and<br/>modulus are performed before addition or subtraction</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>We need one more diagram, for factors. A factor can be a single number or an expression between<br/>parentheses. We’ll allow an optional minus sign at the beginning, so -3 is accepted. </span><i>Figure 9.8 </i><span>shows<br/>the needed diagram.</span></p><p class="s233" style="padding-top: 4pt;padding-left: 51pt;text-indent: 0pt;text-align: center;">FACTOR: <span><img width="266" height="63" alt="image" src="Image_047.jpg"/></span></p><p class="s164" style="padding-top: 28pt;padding-left: 148pt;text-indent: 0pt;line-height: 154%;text-align: center;"><span>Figure 9.8 - A factor starts with an optional minus sign, and can<br/>be a number or an expression within parentheses</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 376pt;text-indent: 0pt;text-align: left;">Mutual recursion   345</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: left;"><span>We’ll implement the needed evaluation with three functions, one for each diagram. In the usual<br/>compiler or interpreter code, we have a first phase that reads the input and splits it into </span><i>tokens, </i><span>and<br/>a second phase that processes those tokens to do whatever’s needed. In our case, the tokens will be</span></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 10pt;text-align: left;">numbers (single digits, for simplicity), operators, and parentheses. The code we’ll write is as follows:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 65pt;text-indent: -12pt;line-height: 146%;text-align: left;"><span>function evaluate(str: string) {<br/>const PLUS =</span></p><p style="padding-left: 64pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>const MINUS = &quot;-&quot;;<br/>const TIMES =<br/>const DIVIDES =<br/>const MODULUS =</span></p><p style="padding-left: 64pt;text-indent: 0pt;line-height: 142%;text-align: left;"><span>const LPARENS = &quot;(&quot;;<br/>const RPARENS = &quot;)&quot;;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 64pt;text-indent: 0pt;line-height: 146%;text-align: left;"><span>let curr = 0;<br/>const tokens = str</span></p><p class="s10" style="padding-left: 78pt;text-indent: 0pt;line-height: 10pt;text-align: left;">.split(&quot;&quot;)</p><p class="s10" style="padding-top: 4pt;padding-left: 64pt;text-indent: 61pt;line-height: 287%;text-align: left;"><a name="bookmark398"><span>.map((x) =&gt; (Number.isNaN(Number(x)) ? x : Number(x)));<br/>return expression();</span></a></p><p style="padding-left: 65pt;text-indent: 0pt;line-height: 286%;text-align: left;"><span>function expression(): number {<br/>function term(): number { ... }<br/>function factor!): number { ... }</span></p><p style="padding-top: 8pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>We define some constants (PLUS, MINUS, etc.) for clarity. Given a string such as &quot;7 + 7/7 + 7*7-<br/>7&quot;, we split it into the tokens array; we take care to evaluate digits. Finally, we have a curr variable<br/>pointing to the token being processed right now. The evaluation of the input expression will be done<br/>by three functions that will use mutual recursion:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 65pt;text-indent: 0pt;text-align: left;">function expression(): number {</p><p class="s10" style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">let accum = term();</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 64pt;text-indent: 0pt;text-align: left;">while (</p><p style="padding-top: 4pt;padding-left: 76pt;text-indent: 0pt;text-align: left;">tokens[curr] === PLUS |</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">346  Designing Functions - Recursion</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 85pt;text-indent: 0pt;text-align: left;">tokens[curr] === MINUS</p><p style="padding-top: 6pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">) {</p><p style="padding-top: 2pt;padding-left: 97pt;text-indent: -11pt;line-height: 141%;text-align: left;"><span>if  (tokens[curr]  ===  PLUS)  {<br/>curr++;</span></p><p class="s10" style="padding-left: 97pt;text-indent: 0pt;text-align: left;">accum += term() ;</p><p style="padding-top: 4pt;padding-left: 97pt;text-indent: -10pt;line-height: 141%;text-align: left;"><span>}  else  if  (tokens[curr]  ===  MINUS)  {<br/>curr++;</span></p><p class="s10" style="padding-left: 97pt;text-indent: 0pt;text-align: left;">accum -= term();</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-top: 4pt;padding-left: 73pt;text-indent: 0pt;text-align: left;"><a name="bookmark399">return accum;</a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>The expression () function first calls term () to get the value of the first term and then loops<br/>if an addition or subtraction is found. In our case, this means that the function would first evaluate<br/>a 7, then add 7/7, then also add 7*7, and finally subtract the last 7. (And yes, the result is 50.) After a<br/>token is processed, curr is incremented to continue with the rest of the tokens.</span></p><p style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;line-height: 126%;text-align: justify;"><span>The code for term () is similar in style; the only difference is how it works with multiplication, and<br/>so on:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 51pt;text-indent: 0pt;text-align: center;">function term(): number {</p><p class="s10" style="padding-top: 4pt;padding-left: 51pt;text-indent: 0pt;text-align: center;">let accum = factor!);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 8pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">while (</p><p style="padding-top: 4pt;padding-left: 85pt;text-indent: 0pt;line-height: 143%;text-align: left;"><span>tokens[curr] === TIMES |<br/>tokens[curr] === DIVIDES ||<br/>tokens[curr] === MODULUS</span></p><p style="padding-top: 2pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">) {</p><p style="padding-top: 2pt;padding-left: 97pt;text-indent: -11pt;line-height: 141%;text-align: left;"><span>if (tokens[curr] === TIMES) {<br/>curr++;</span></p><p class="s10" style="padding-left: 97pt;text-indent: 0pt;text-align: left;">accum *= factorO;</p><p style="padding-top: 4pt;padding-left: 97pt;text-indent: -10pt;line-height: 143%;text-align: left;"><span>} else if (tokens[curr] === DIVIDES) {<br/>curr++;</span></p><p class="s10" style="padding-left: 97pt;text-indent: 0pt;line-height: 10pt;text-align: left;">accum /= factorO;</p><p style="padding-top: 4pt;padding-left: 97pt;text-indent: -11pt;line-height: 142%;text-align: left;"><span>} else if (tokens[curr] === MODULUS) {<br/>curr++;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 376pt;text-indent: 0pt;text-align: left;">Mutual recursion   347</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 88pt;text-indent: 0pt;text-align: left;">accum %= factor();</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 64pt;text-indent: 0pt;text-align: left;"><a name="bookmark400">return accum;</a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 192%;text-align: left;"><span>This function would be called to evaluate 7, then 7/7, then 7*7, and finally another 7.<br/>Finally, factor () is a tad different:</span></p><p style="padding-top: 3pt;padding-left: 65pt;text-indent: -12pt;line-height: 143%;text-align: left;"><span>function factor!): number {<br/>let mult = 1;</span></p><p style="padding-left: 76pt;text-indent: -11pt;line-height: 146%;text-align: left;"><span>if (tokens[curr] === MINUS) {<br/>mult = -1;</span></p><p style="padding-left: 65pt;text-indent: 11pt;line-height: 288%;text-align: left;"><span>curr++; // skip MINUS<br/>let result = 0;</span></p><p style="padding-left: 77pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>if (tokens [curr] = = = LPARENS) {<br/>curr++; // skip LPARENS</span></p><p style="padding-left: 76pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>result = expression();<br/>curr++; // skip RPARENS</span></p><p style="padding-left: 65pt;text-indent: 0pt;line-height: 10pt;text-align: left;">} else {</p><p style="padding-top: 3pt;padding-left: 76pt;text-indent: 0pt;text-align: left;">result = tokens[curr] as number;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 65pt;text-indent: 0pt;text-align: left;">return mult * result;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>The mult variable will be -1 if an initial minus sign was present, or +1 otherwise. We have no loops<br/>here, and just an alternative: if a left parenthesis is seen, we skip it, recursively evaluate the included<br/>expression, skip the right parenthesis, and return the value of the expression. The alternative is that<br/>we  have a number, which we return. Whatever we return, we’ll multiply by the mult value to produce<br/>the correct result.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>If you analyze the recursive calls, we have expression () calling term (), which calls f actor (),<br/>which calls recursive () - a cycle of three! Mutual recursion is harder to understand and to get</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">348  Designing Functions - Recursion</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>right because to plan such code, you must foresee what several functions will do. However, for the<br/>right problems (as shown here), it’s a very powerful technique.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-left: 53pt;text-indent: 0pt;text-align: justify;"><a name="bookmark401">Recursion techniques</a></p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>While recursion is a very good technique, you may face some problems because of the way it is<br/>internally implemented. Each function call, recursive or not, requires an entry in the internal JavaScript<br/>stack. When you are working with recursion, each recursive call itself counts as another call, and you<br/>might find that there are some situations in which your code will crash and throw an error because<br/>it ran out of memory, just because of multiple calls. On the other hand, with most current JavaScript<br/>engines, you can probably have several thousand pending recursive calls without a problem - but<br/>with earlier browsers and smaller machines, the number could drop into the hundreds and feasibly<br/>go even lower. Thus, it could be argued that, at present, you are not likely to suffer from any particular<br/>memory problems.</span></p><p style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>In any case, let’s review the problem and go over some possible solutions in the following sections.<br/>Even if you don’t get to actually apply them, they represent valid FP ideas for which you may find a<br/>place in yet other problems. We will be looking at the following solutions:</span></p><ul id="l115"><li data-list-text="•"><p class="s10" style="padding-top: 8pt;padding-left: 81pt;text-indent: -15pt;text-align: left;">Tail call optimization, <span class="p">a technique that speeds up recursion </span>continuation-passing style (CPS),</p><p style="padding-top: 2pt;padding-left: 79pt;text-indent: 0pt;text-align: left;">an important FP technique that can help with recursion</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 79pt;text-indent: -13pt;line-height: 123%;text-align: left;"><span class="s33">	</span>A couple of interestingly named techniques, <b>trampolines </b>and <b>thunks, </b><span>which are also standard<br/>FP tools</span></p></li><li data-list-text="•"><p class="s10" style="padding-top: 5pt;padding-left: 79pt;text-indent: -13pt;text-align: left;">Recursion elimination, <span class="p">a technique beyond this book’s scope, but which may still be applied</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 52pt;text-indent: 0pt;text-align: justify;"><a name="bookmark402">Tail call optimization</a></p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>When is a recursive call not a recursive call? Put this way, the question may make little sense, but there’s<br/>a common optimization—for other languages, alas, but not JavaScript!—that explains the answer. If<br/>the recursive call is the very last thing a function will do, then the call could be transformed into a<br/>simple jump to the start of the function without needing to create a new stack entry. (Why? The stack<br/>entry wouldn’t be required: after the recursive call is done, the function would have nothing else to<br/>do, so there is no need to further save any of the elements that have been pushed into the stack upon<br/>entering the function.) The original stack entry would then no longer be needed and could be replaced<br/>by  a new one, corresponding to the recent call.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 66pt;text-indent: 0pt;text-align: left;"><a name="bookmark403">Implementation irony</a></p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;line-height: 115%;text-align: left;"><span>The fact that a recursive call, a quintessential FP technique, is being implemented by a base<br/>imperative GO TO statement can be considered an ultimate irony!</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 359pt;text-indent: 0pt;text-align: left;">Recursion techniques    349</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;">These calls are known as <b>tail calls </b><span>(for obvious reasons) and have higher efficiency, not only because<br/>of the saved stack space but also because a jump is quite a bit faster than any alternative. If the<br/>browser implements this enhancement, it uses </span><b>tail call optimization (TCO); </b><span>however, a glance at<br/>the  compatibility  tables  at  kangax.  github.  io/compat-table/es6/  shows  that  at  the  time<br/>of writing (at the end of 2022), the only browser that provides TCO is Safari.</span></p><p style="text-indent: 0pt;text-align: left;"><span><img width="55" height="183" alt="image" src="Image_048.gif"/></span></p><p class="s234" style="padding-top: 6pt;padding-left: 169pt;text-indent: 0pt;line-height: 112%;text-align: left;"><span>LW DO W LIKE. FUNCiWL<br/>PROGRAMMING 50 MUCH? UHfiT<br/>DOES    IT ACTUALLY #7“ YOU?</span></p><p class="s234" style="padding-top: 7pt;padding-left: 51pt;text-indent: 0pt;text-align: center;">TAIL RECURSION IS</p><p style="padding-left: 221pt;text-indent: 0pt;text-align: left;"><span><img width="118" height="155" alt="image" src="Image_049.gif"/></span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-left: 117pt;text-indent: 0pt;text-align: left;">Figure 9.9 - To understand this joke, you must have previously understood it!</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 5pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>A simple (though non-standard) test lets you verify whether your browser provides TCO. I found<br/>this snippet of code in several places on the web, but I’m sorry to say, I cannot attest to the original<br/>author, although I believe it is Csaba Hellinger from Hungary. Calling detectTCO () lets you know<br/>whether your browser does or does not use TCO:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// tailRecursion.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">function detectTCO() {</p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;line-height: 142%;text-align: left;"><span>const outerStackLen = new Error().stack!.length;<br/>return (function inner() {</span></p><p style="padding-left: 76pt;text-indent: 0pt;line-height: 143%;text-align: left;"><span>const innerStackLen = new Error().stack!.length;<br/>return innerStackLen &lt;= outerStackLen;</span></p><p style="padding-top: 1pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">}) ();</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>The Error () . stack result is not a JavaScript standard, but modern browsers support it, albeit in<br/>somewhat different ways. (I had to add the “! ” symbol so TypeScript would accept that stack would<br/>be present.) In any case, the idea is that when a function with a long name calls another function with<br/>a shorter name, the stack trace should do the following:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">350  Designing Functions - Recursion</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="•"><p style="padding-left: 79pt;text-indent: -13pt;line-height: 123%;text-align: left;"><span>It should get shorter if the browser implements TCO, since the old entry for the longer-named<br/>function would be replaced with the entry for the shorter-named one</span></p></li><li data-list-text="•"><p style="padding-top: 5pt;padding-left: 79pt;text-indent: -13pt;line-height: 123%;text-align: left;"><span>It should get longer without TCO, since a completely new stack entry would be created without<br/>doing away with the original one</span></p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>I’m using Chrome on my Linux laptop, and I added a console . log () statement to show Error () .<br/>stack. You can see that both stack entries (for inner () and detectTCO ()) are </span><i>live, </i>so there’s</p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 10pt;text-align: left;">no TCO:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;text-align: left;">Error</p><p style="padding-top: 4pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">at inner (&lt;anonymous&gt;:6:13)</p><p style="padding-top: 4pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">at detectTCO (&lt;anonymous&gt;:9:6) at &lt;anonymous:*: 1:1</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Of course, there’s another way of learning whether your environment includes TCO: try out the<br/>following function (which does nothing!) with large enough numbers. If you manage to run it with<br/>numbers such as, say, 100,000 or 1,000,000, you can be reasonably sure that your JavaScript engine is<br/>doing TCO! A possible such function could be the following:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">function justLoop(n: number): void {</p><p style="padding-top: 4pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">n &amp;&amp; justLoop(n - 1); // until n is zero</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Let’s finish this section with a very short quiz to ensure we understand what tail calls are. Is the<br/>recursive call in the factorial function we saw in </span><i>Chapter 1, Becoming Functional, </i><span>(but here written<br/>in TypeScript) a tail call?</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 74pt;text-indent: -12pt;line-height: 142%;text-align: left;"><span>function fact(n: number): number {<br/>if (</span><span class="s212">n </span>=== 0) {</p><p style="text-indent: 0pt;line-height: 9pt;text-align: right;">return 1;</p><p style="padding-top: 4pt;text-indent: 0pt;text-align: right;">} else {</p><p class="s10" style="padding-top: 4pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">return n * factfn - 1);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Think about it, because the answer is important! You might be tempted to answer in the affirmative,<br/>but the correct answer is </span><i>no. </i><span>There’s a good reason for this, and it’s a key point: after the recursive<br/>call is done and the value for fact (n-1) has been calculated, the function still has work to do. (So<br/>doing the recursive call wasn’t actually the last thing that the function would do.) You can see it more<br/>clearly if you write the function in this equivalent way:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 359pt;text-indent: 0pt;text-align: left;">Recursion techniques   351</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 65pt;text-indent: -12pt;line-height: 141%;text-align: left;"><span>function fact2(n: number): number {<br/>if (n === 0) {</span></p><p style="padding-left: 76pt;text-indent: 0pt;text-align: left;">return 1;</p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">} else {</p><p class="s10" style="padding-top: 4pt;padding-left: 76pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>const aux = fact2(n - 1);<br/>return n * aux;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>There should be two takeaways from this section: TCO isn’t usually offered by browsers, and even if<br/>it were, you cannot take advantage of it if your calls aren’t actual tail calls. Now that we know what<br/>the problem is, let’s see some FP ways of working around it!</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 43pt;text-indent: 0pt;text-align: justify;"><a name="bookmark404">Continuation-passing style</a></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>We already know that our logic will fail if we have recursive calls stacked too high. On the other hand,<br/>we know that tail calls should alleviate that problem, but they don’t because of browser implementations!<br/>However, there’s a way out of this. Let’s first consider how we can transform recursive calls into tail<br/>calls by using a well-known FP concept—</span><b>continuations—</b><span>and we’ll leave the problem of solving<br/>TCO limitations for the next section. (We mentioned continuations in </span><i>Chapter 3, Starting Out with</i>but we didn’t go into detail.)</p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>In FP parlance, a continuation represents the state of a process and allows processing to continue.<br/>This may be too abstract, so let’s see what this means. The key idea is that when you call a function,<br/>you also provide it with a continuation (in reality, a simple function) that will be called at return time.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Let’s look at a trivial example. Suppose you have a function that returns the time of the day, and you<br/>want to show this on the console. The usual way to do this could be as follows:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">function getTimed : string {</p><p style="padding-top: 4pt;padding-left: 64pt;text-indent: 0pt;text-align: left;">return new Dated . toTimeString () ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">console.log(getTime()); // &quot;21:00:24 GMT+0530 (1ST)&quot;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>If you were doing CPS, you would pass a continuation to the getTime () function. Instead of returning<br/>a calculated value, the function would invoke the continuation, giving it the value as a parameter:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">function getTime2<b>(cont: FN) {</b></p><p style="padding-top: 4pt;padding-left: 52pt;text-indent: 12pt;line-height: 287%;text-align: left;">return <b>cont</b><span>(new Date().toTimeString());<br/>getTime2(console.log); // similar result as above</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">352  Designing Functions - Recursion</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>What’s the difference? The key is that we can apply this mechanism to make a recursive call into a tail<br/>call because all of the code that comes after will be provided in the recursive call itself. To make this<br/>clear, let’s revisit the factorial function in the version that made it explicit that we weren’t doing tail calls:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 74pt;text-indent: -12pt;line-height: 142%;text-align: left;"><span>function fact2(n: number): number {<br/>if (</span><span class="s212">n </span>=== 0) {</p><p style="padding-left: 85pt;text-indent: 0pt;line-height: 9pt;text-align: left;">return 1;</p><p style="padding-top: 4pt;padding-left: 75pt;text-indent: 0pt;text-align: left;">} else {</p><p style="padding-top: 4pt;padding-left: 85pt;text-indent: 0pt;line-height: 143%;text-align: left;"><span>const aux = fact2(n - 1) ;<br/>return n * aux;</span></p><p style="padding-top: 2pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>We will add a new parameter to the function for the continuation. What do we do with the result of<br/>the fact (n-1) call? We multiply it by n, so let’s provide a continuation that will do just that. I’ll<br/>rename the factorial function as f actC () to make it clear that we are working with continuations,<br/>as shown in the following code:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 73pt;text-indent: -11pt;line-height: 142%;text-align: left;"><span>function factC(<br/>n: number,</span></p><p style="padding-left: 73pt;text-indent: 0pt;text-align: left;">cont: (x: number) =&gt; number</p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">): number {</p><p style="padding-top: 4pt;padding-left: 85pt;text-indent: -11pt;line-height: 130%;text-align: left;">if (<span class="s212">n </span><span>=== 0) {<br/>return cont(l);</span></p><p style="padding-top: 1pt;padding-left: 75pt;text-indent: 0pt;text-align: left;">} else {</p><p style="padding-top: 4pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">return factC(n - 1, (x) =&gt; cont(n * x) ) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 63pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>How would we get the final result? Easy - we can call f actC () with a continuation that will return<br/>whatever it’s given:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">console.log(factC(7, x =&gt; x)); //</p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">factC(7, console.log);              //</p><p style="padding-top: 4pt;padding-left: 11pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>5040, correctly<br/>same result</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 359pt;text-indent: 0pt;text-align: left;">Recursion techniques    353</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 57pt;text-indent: 0pt;text-align: left;"><a name="bookmark405">Identity combinator</a></p><p style="padding-top: 4pt;padding-left: 57pt;text-indent: 0pt;line-height: 115%;text-align: left;"><span>In FP, a function that returns its argument as a result is usually called i dent i ty () for obvious<br/>reasons. In combinatory logic (which we won’t be using), we would speak of the </span><b>I combinator.</b></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 126%;text-align: left;"><span>Can you understand how it worked? Then let’s try out a more complex case with the Fibonacci function,<br/>which has two recursive calls in it, as shown in the following highlighted code:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 65pt;text-indent: -12pt;line-height: 142%;text-align: left;"><span>const fibC = (n: number, cont: FN): number =&gt; {<br/>if (n &lt;= 1) {</span></p><p style="padding-left: 76pt;text-indent: 0pt;text-align: left;">return cont(n);</p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">} else {</p><p class="s10" style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">return fibC(n - 2, (p) =&gt;</p><p class="s10" style="padding-top: 4pt;padding-left: 89pt;text-indent: 0pt;text-align: left;">fibC(n - 1, (q) =&gt; cont(p + q))</p><p class="s10" style="padding-top: 5pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>This is trickier: we call f ibC () with n - 2 and a continuation that says that whatever that call returned,<br/>call f ibC () with n-1, and when </span><i>that </i><span>call returns, sum the results of both calls and pass that result<br/>to the original continuation.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Let’s see just one more example, involving a loop with an undefined number of recursive calls. By<br/>then, you should have some idea about how to apply CPS to your code—though I’ll readily admit it<br/>can become really complex!</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: justify;">Earlier in this chapter, we saw this function in the <i>Traversing a tree structure </i><span>section. The idea was to<br/>print out the DOM structure, like this:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 53pt;text-indent: 0pt;text-align: left;">&lt;body&gt;</p><p class="s10" style="padding-top: 4pt;padding-left: 54pt;text-indent: 0pt;text-align: left;">| &lt;script&gt;</p><p class="s10" style="padding-top: 4pt;padding-left: 54pt;text-indent: 0pt;text-align: left;">| &lt;div&gt;</p><p class="s10" style="padding-top: 4pt;text-indent: 0pt;text-align: right;">| &lt;div&gt;</p><p class="s10" style="padding-top: 4pt;text-indent: 0pt;text-align: right;">| &lt;a&gt;</p><p class="s10" style="padding-top: 4pt;padding-left: 54pt;text-indent: 0pt;text-align: left;">|  | | &lt;div&gt;</p><p class="s235" style="padding-top: 1pt;padding-left: 54pt;text-indent: 0pt;line-height: 16pt;text-align: left;">Illi <span class="s10">&lt;ul&gt;</span></p><p class="s235" style="padding-left: 54pt;text-indent: 0pt;line-height: 15pt;text-align: left;">I I I I I <span class="s10">&lt;li&gt;</span></p><p class="s235" style="padding-left: 54pt;text-indent: 0pt;line-height: 14pt;text-align: left;">I I I I I I <span class="s236">&lt;a&gt;</span></p><p class="s235" style="padding-left: 54pt;text-indent: 0pt;line-height: 15pt;text-align: left;">I  I I I I I  I <span class="s10">&lt;div&gt;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">354  Designing Functions - Recursion</p><p style="text-indent: 0pt;text-align: left;"><br/></p><table style="border-collapse:collapse" cellspacing="0"><tr style="height:16pt"><td style="width:12pt"><p class="s29" style="padding-top: 4pt;padding-left: 2pt;text-indent: 0pt;line-height: 10pt;text-align: left;">I</p></td><td style="width:21pt"><p class="s29" style="padding-left: 5pt;text-indent: 0pt;line-height: 14pt;text-align: left;">I <span class="s231">I</span></p></td><td style="width:13pt"><p class="s231" style="padding-left: 1pt;text-indent: 0pt;line-height: 14pt;text-align: center;">I</p></td><td style="width:10pt"><p class="s29" style="padding-top: 4pt;padding-left: 2pt;text-indent: 0pt;line-height: 10pt;text-align: center;">I</p></td><td style="width:11pt"><p class="s29" style="padding-top: 4pt;padding-left: 2pt;text-indent: 0pt;line-height: 10pt;text-align: left;">I</p></td><td style="width:12pt"><p class="s231" style="padding-right: 2pt;text-indent: 0pt;line-height: 14pt;text-align: right;">I</p></td></tr><tr style="height:16pt"><td style="width:12pt"><p class="s29" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;line-height: 10pt;text-align: left;">I</p></td><td style="width:21pt"><p class="s29" style="padding-left: 5pt;text-indent: 0pt;line-height: 14pt;text-align: left;">I <span class="s231">I</span></p></td><td style="width:13pt"><p class="s231" style="padding-left: 1pt;text-indent: 0pt;line-height: 14pt;text-align: center;">I</p></td><td style="width:10pt"><p class="s29" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;line-height: 10pt;text-align: center;">I</p></td><td style="width:11pt"><p class="s29" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;line-height: 10pt;text-align: left;">I</p></td><td style="width:12pt"><p class="s231" style="padding-right: 2pt;text-indent: 0pt;line-height: 14pt;text-align: right;">I</p></td></tr><tr style="height:15pt"><td style="width:12pt"><p class="s231" style="padding-left: 2pt;text-indent: 0pt;line-height: 14pt;text-align: left;">I</p></td><td style="width:21pt"><p class="s29" style="padding-top: 4pt;padding-left: 5pt;text-indent: 0pt;line-height: 10pt;text-align: left;">I I</p></td><td style="width:13pt"><p class="s29" style="padding-top: 4pt;padding-left: 1pt;text-indent: 0pt;line-height: 10pt;text-align: center;">I</p></td><td style="width:10pt"><p class="s231" style="padding-left: 1pt;text-indent: 0pt;line-height: 14pt;text-align: center;">I</p></td><td style="width:11pt"><p class="s29" style="padding-top: 4pt;padding-left: 2pt;text-indent: 0pt;line-height: 10pt;text-align: left;">I</p></td><td style="width:12pt"><p class="s29" style="padding-top: 4pt;padding-right: 3pt;text-indent: 0pt;line-height: 10pt;text-align: right;">I</p></td></tr><tr style="height:15pt"><td style="width:12pt"><p class="s29" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">I</p></td><td style="width:21pt"><p class="s29" style="padding-left: 5pt;text-indent: 0pt;line-height: 14pt;text-align: left;">I <span class="s231">I</span></p></td><td style="width:13pt"><p class="s231" style="padding-left: 1pt;text-indent: 0pt;line-height: 14pt;text-align: center;">I</p></td><td style="width:10pt"><p class="s29" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: center;">I</p></td><td style="width:11pt"><p class="s29" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">I</p></td><td style="width:12pt"><p class="s231" style="padding-right: 2pt;text-indent: 0pt;line-height: 14pt;text-align: right;">I</p></td></tr></table><p style="text-indent: 0pt;text-align: left;"/><p class="s235" style="padding-top: 4pt;padding-left: 152pt;text-indent: 0pt;text-align: left;">I <span class="s10">&lt;div&gt;</span></p><p class="s10" style="padding-top: 3pt;padding-left: 148pt;text-indent: 0pt;text-align: left;">&lt;div&gt;</p><p style="padding-top: 5pt;padding-left: 155pt;text-indent: 0pt;text-align: left;">I &lt;<span class="s162">br</span>&gt;</p><p class="s10" style="padding-top: 3pt;padding-bottom: 1pt;padding-left: 144pt;text-indent: 0pt;text-align: left;">&lt;div&gt;</p><table style="border-collapse:collapse;margin-left:61.33pt" cellspacing="0"><tr style="height:30pt"><td style="width:12pt"><p class="s29" style="padding-left: 2pt;padding-right: 6pt;text-indent: 0pt;line-height: 15pt;text-align: left;"><span>I<br/>I</span></p></td><td style="width:21pt"><p class="s29" style="padding-left: 5pt;text-indent: 0pt;line-height: 15pt;text-align: left;">I <span class="s231">I</span></p><p class="s29" style="padding-left: 5pt;text-indent: 0pt;line-height: 14pt;text-align: left;">I <span class="s231">I</span></p></td><td style="width:13pt"><p class="s231" style="padding-left: 5pt;padding-right: 3pt;text-indent: 0pt;line-height: 15pt;text-align: left;"><span>I<br/>I</span></p></td><td style="width:10pt"><p class="s29" style="padding-left: 4pt;padding-right: 2pt;text-indent: 0pt;line-height: 15pt;text-align: left;"><span>I<br/>I</span></p></td><td style="width:11pt"><p class="s29" style="padding-left: 2pt;padding-right: 5pt;text-indent: 0pt;line-height: 15pt;text-align: left;"><span>I<br/>I</span></p></td><td style="width:34pt"><p class="s237" style="padding-top: 4pt;padding-left: 5pt;text-indent: 0pt;line-height: 10pt;text-align: left;">&lt;<span class="s238">ul</span>&gt;</p><p class="s231" style="padding-left: 5pt;text-indent: 0pt;line-height: 14pt;text-align: left;">I <span class="s188">&lt;li&gt;</span></p></td></tr><tr style="height:15pt"><td style="width:12pt"><p class="s231" style="padding-left: 2pt;text-indent: 0pt;line-height: 14pt;text-align: left;">I</p></td><td style="width:21pt"><p class="s29" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">I I</p></td><td style="width:13pt"><p class="s29" style="padding-top: 3pt;padding-left: 1pt;text-indent: 0pt;text-align: center;">I</p></td><td style="width:10pt"><p class="s231" style="padding-left: 1pt;text-indent: 0pt;line-height: 14pt;text-align: center;">I</p></td><td style="width:11pt"><p class="s29" style="padding-top: 3pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">I</p></td><td style="width:34pt"><p class="s29" style="padding-top: 3pt;padding-right: 2pt;text-indent: 0pt;text-align: right;">I I «&gt;</p></td></tr><tr style="height:16pt"><td style="width:12pt"><p class="s29" style="padding-top: 4pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">I</p></td><td style="width:21pt"><p class="s29" style="padding-left: 5pt;text-indent: 0pt;line-height: 15pt;text-align: left;">I <span class="s231">I</span></p></td><td style="width:13pt"><p class="s231" style="padding-left: 1pt;text-indent: 0pt;line-height: 15pt;text-align: center;">I</p></td><td style="width:10pt"><p class="s29" style="padding-top: 4pt;padding-left: 2pt;text-indent: 0pt;text-align: center;">I</p></td><td style="width:11pt"><p class="s29" style="padding-top: 4pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">I</p></td><td style="width:34pt"><p class="s231" style="padding-right: 2pt;text-indent: 0pt;line-height: 15pt;text-align: right;">I <span class="s188">&lt;li&gt;</span></p></td></tr></table><p class="s10" style="padding-top: 1pt;padding-left: 63pt;text-indent: 0pt;text-align: left;">...etc . !</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">The function we ended up designing back then was the following:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// dom.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 73pt;text-indent: -12pt;line-height: 143%;text-align: left;"><span>const   traverseDom2   =   (node:   Element,   depth   =0)   =&gt;   {<br/>console.log(</span></p><p style="padding-left: 86pt;text-indent: 0pt;text-align: left;">&#39;${&quot;| &quot;.repeat(depth)}&lt;${node.nodeName.toLowerCase()}&gt;&#39;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 85pt;text-indent: -12pt;line-height: 144%;text-align: left;"><span>Array.from(node.children).forEach((child) =&gt;<br/>traverseDom2(child, depth + 1)</span></p><p style="padding-left: 74pt;text-indent: 0pt;text-align: left;">) ;</p><p style="padding-top: 5pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">};</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: left;"><span>Let’s start by making this fully recursive, getting rid of the f orEach () loop. We have seen this<br/>technique before, so we can move on to the following result; note how the following code forms its<br/>loops by using recursion. Also, note we added lots of return statements, even if they are not really<br/>needed; we’ll see the reason for this soon:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 73pt;text-indent: -12pt;line-height: 144%;text-align: left;"><span>const  traverseDom3  =  (node:  Element,  depth  =  0):  void  =&gt;  {<br/>console.log(</span></p><p style="padding-left: 86pt;text-indent: 0pt;line-height: 10pt;text-align: left;">&#39;${&quot;| &quot;.repeat(depth)}&lt;${node.nodeName.toLowerCase()}&gt;&#39;</p><p style="padding-top: 5pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">) ;</p><p style="padding-top: 3pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">const traversechildren = (</p><p style="padding-top: 4pt;padding-left: 86pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>children:     Element!],<br/>i = 0</span></p><p style="padding-left: 74pt;text-indent: 0pt;line-height: 10pt;text-align: left;">): void =&gt; {</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 359pt;text-indent: 0pt;text-align: left;">Recursion techniques    355</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 88pt;text-indent: -11pt;line-height: 143%;text-align: left;"><span>if (i &lt; children.length) {<br/>traverseDom3(children[i], depth + 1) ;</span></p><p style="padding-left: 77pt;text-indent: 12pt;line-height: 287%;text-align: left;"><span>return traversechildren(children, i + 1); // loop<br/>return;</span></p><p style="padding-left: 64pt;text-indent: 0pt;line-height: 10pt;text-align: left;">return traversechildren(Array.from(node.children));</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Now, we have to add a continuation to traverseDom3 (). The only difference from the previous<br/>cases is that the function doesn’t return anything, so we won’t pass any arguments to the continuation.<br/>It’s also important to remember the implicit return at the end of the traversechildren () loop;<br/>we must call the continuation:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s9" style="padding-left: 53pt;text-indent: 0pt;text-align: left;">I/ <span class="p">continued...</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 64pt;text-indent: -11pt;line-height: 143%;text-align: left;"><span>const traverseDom3C = (<br/>node: Element,</span></p><p style="padding-left: 64pt;text-indent: 0pt;line-height: 10pt;text-align: left;">depth = 0,</p><p style="padding-top: 4pt;padding-left: 64pt;text-indent: 0pt;text-align: left;">cont:  FN  =  ()  =&gt;  {</p><p style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">/* nothing */</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 8pt;padding-left: 64pt;text-indent: -11pt;line-height: 141%;text-align: left;"><span>): void =&gt; {<br/>console.log(</span></p><p style="padding-left: 77pt;text-indent: 0pt;text-align: left;">&#39;${&quot;| &quot;.repeat(depth)}&lt;${node.nodeName.toLowerCase()}&gt;&#39;</p><p style="padding-top: 5pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">) ;</p><p style="padding-top: 3pt;padding-left: 64pt;text-indent: 0pt;text-align: left;">const traversechildren = (</p><p style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;line-height: 142%;text-align: left;"><span>children:     Element!],<br/>i = 0</span></p><p style="padding-left: 65pt;text-indent: 0pt;text-align: left;">): void = &gt; {</p><p style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">if (i &lt; children.length) {</p><p style="padding-top: 4pt;padding-left: 100pt;text-indent: -11pt;line-height: 143%;text-align: left;"><span>return traverseDom3C(children[i], depth + 1, () =&gt;<br/>traversechildren(children, i + 1)</span></p><p style="padding-top: 1pt;padding-left: 89pt;text-indent: 0pt;text-align: left;">) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 6pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">return cont();</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">356  Designing Functions - Recursion</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 73pt;text-indent: 0pt;text-align: left;">return traversechildren(Array.from(node.children));</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">We opted to give a default value to cont, so we can call traverseDom3C (document. body)</p><p style="padding-top: 2pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>as before. If we try out this logic, it works, but the problem of the potentially high number of pending<br/>calls hasn’t been solved; let’s look for a solution to this in the following section.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 52pt;text-indent: 0pt;text-align: left;"><a name="bookmark406">Trampolines and thunks</a></p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>For the last solution to our problem, we shall have to think about the cause of the problem. Each pending<br/>recursive call creates a new entry stack. Whenever the stack gets too empty, the program crashes, and<br/>our algorithm is history. So, if we can work out a way to avoid stack growth, we should be free. The<br/>solution, in this case, is quite imposing and requires </span><i>thunks </i>and a <i>trampoline—</i>let’s see what these are!</p><p style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;">First, a <b>thunk </b><span>is really quite simple: it’s just a nullary function (so, with no parameters) that helps<br/>delay a computation, providing a form of </span><b>lazy evaluation. </b><span>If you have a thunk, then you won’t get<br/>its value unless you call the thunk. For example, if you want to get the current date and time in ISO<br/>format, you could get it with new Date () . toISOString (); however, if you provide a thunk<br/>that calculates that, you won’t get the value until you actually invoke it:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// trampoline.ts</p><p style="padding-left: 61pt;text-indent: 0pt;line-height: 30pt;text-align: left;">const getlsoDT = () =&gt; <b>new Date().toISOString(); </b><span>// a thunk<br/>const isoDT </span><b>= getlsoDTO; </b>// getting the thunk&#39;s value</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>What’s the use of this? The problem with recursion is that a function calls itself, and calls itself, and calls<br/>itself, and so on until the stack blows over. Instead of directly calling itself, we will have the function<br/>return a thunk, which, when executed, will actually recursively call the function. So, instead of having<br/>the stack grow more and more, it will actually be quite flat since the function will never get to actually<br/>call itself; the stack will grow by one position when you call the function, and then get back to its size<br/>as soon as the function returns its thunk.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;">But who gets to do the recursion? That’s where the concept of a <b>trampoline </b><span>comes in. A trampoline<br/>is just a loop that calls a function, gets its return, and if it is a thunk, then it calls it so that recursion<br/>will proceed, but in a flat, linear way! The loop is exited when the thunk evaluation returns an actual<br/>value instead of a new function. Look at the following code:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 73pt;text-indent: -11pt;line-height: 142%;text-align: left;"><span>const trampoline = (fn: FN): any =&gt; {<br/>while (typeof fn === &quot;function&quot;) {</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 359pt;text-indent: 0pt;text-align: left;">Recursion techniques    357</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>How can we apply this to an actual function? Let’s start with a simple one that sums all numbers<br/>from 1 to </span><i>n, </i><span>but in a recursive, guaranteed-to-cause-a-stack-crash fashion. Our simple sumAll ()<br/>function could be the following:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s9" style="padding-left: 53pt;text-indent: 0pt;text-align: left;">11 <span class="p">continued...</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 64pt;text-indent: -11pt;line-height: 142%;text-align: left;"><span>const  sumAll  =  (n:  number):  number  =&gt;<br/>n==0?0 : n + sumAll(n - 1) ;</span></p><p style="padding-top: 8pt;padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>However, if we start trying this function out, we’ll eventually stumble and crash, as you can see in the<br/>following examples:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 143%;text-align: left;"><span>console.log(sumAll(10));<br/>console.log(sumAll(100));<br/>console.log(sumAll(l_000));<br/>console.log(sumAll(10_000));<br/>console.log(sumAll(100_000));</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s9" style="padding-left: 53pt;text-indent: 0pt;text-align: left;">I<span class="p">/ Output:</span></p><p style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">55</p><p style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">5050</p><p style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">500500</p><p style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">50005000</p><p class="s10" style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">RangeError: Maximum call stack size exceeded</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>The stack problem will come up sooner or later depending on your machine, its memory size, and so<br/>on - but it will come, no doubt. Let’s rewrite the function in CPS so that it will become tail-recursive.<br/>We will apply the same technique that we saw earlier, as shown in the following code:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s9" style="padding-left: 53pt;text-indent: 0pt;text-align: left;">11 <span class="p">continued...</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">const sumAllC = (n: number, cont: FN): number = &gt;</p><p style="padding-top: 4pt;padding-left: 64pt;text-indent: 0pt;text-align: left;">n === 0 ? cont(0) : sumAllC(n - 1, (v) =&gt; cont(v + n));</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">358  Designing Functions - Recursion</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>This, however, crashes as before; eventually, the stack grows too much. Let’s apply a simple rule to the<br/>code: whenever you are going to return from a call, instead, return a thunk that will, when executed,<br/>do the call that you actually wanted to do. The following code implements that change:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 73pt;text-indent: -11pt;line-height: 142%;text-align: left;"><a name="bookmark407"><span>const sumAllT = (n: number, cont: FN) : (() =&gt; number) =&gt;<br/>n === 0</span></a></p><p class="s10" style="padding-left: 86pt;text-indent: 0pt;text-align: left;"><a name="bookmark408">? () =&gt; cont(O)</a></p><p class="s10" style="padding-top: 4pt;padding-left: 87pt;text-indent: 0pt;text-align: left;">: () =&gt; sumAllT(n      1, (v) =&gt; () =&gt; cont(v + n));</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Whenever there would have been a call to a function, we now return a thunk. How do we get to run<br/>this function? This is the missing detail. You need an initial call that will invoke sumAHT () the first<br/>time, and (unless the function was called with a zero argument) a thunk will be immediately returned.<br/>The trampoline function will call the thunk, and that will cause a new call, and so on until we<br/>eventually get a thunk that just returns a value, and then the calculation will be ended:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s9" style="padding-left: 62pt;text-indent: 0pt;text-align: left;">I<span class="p">/ continued...</span></p><p style="padding-top: 3pt;padding-left: 61pt;text-indent: 0pt;line-height: 30pt;text-align: left;"><span>const sumA112 = n =&gt; trampoline(sumAllT(n, x =&gt; x) ) ;<br/>console.log(sumA112(l_000_000)); // no problem now!</span></p><p style="padding-top: 8pt;padding-left: 52pt;text-indent: 0pt;text-align: justify;">In fact, you probably wouldn’t want a separate sumAllT () function, so you’d go for something like this:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 73pt;text-indent: -12pt;line-height: 143%;text-align: left;"><span>const sumA113 = (n: number): number =&gt; {<br/>const sumAllT = (n: number, cont: FN) = &gt;</span></p><p style="padding-left: 85pt;text-indent: 0pt;text-align: left;">n === 0</p><p style="padding-top: 4pt;padding-left: 98pt;text-indent: 0pt;text-align: left;">? () =&gt; cont (0)</p><p style="padding-top: 4pt;padding-left: 112pt;text-indent: 0pt;text-align: left;">() =&gt; sumAllT(n - 1, (v) =&gt; () =&gt; cont(v + n) ) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">return    trampoline(sumAllT(n,   (x)   =&gt;    x));</p><p style="padding-top: 6pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">};</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">console.log(sumA113(l_000_000)); // no stack crash</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>There’s only one problem left: what would we do if the result of our recursive function wasn’t a value<br/>but rather a function? The problem there would be on the trampoline () code that, as long as<br/>the result of the thunk evaluation is a function, goes back again and again to evaluate it. The simplest<br/>solution would be to return a thunk, but wrapped in an object, as shown in the following code:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 359pt;text-indent: 0pt;text-align: left;">Recursion techniques    359</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 65pt;text-indent: -12pt;line-height: 143%;text-align: left;"><span>class  Thunk  {<br/>fn: FN;</span></p><p style="padding-left: 77pt;text-indent: -12pt;line-height: 144%;text-align: left;"><span>constructor(fn:   FN)   {<br/>this.fn = fn;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 64pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>const  trampoline2  =  (thk:  Thunk)  =&gt;  {<br/>while (</span></p><p style="padding-left: 76pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>typeof thk === &quot;object&quot; &amp;&amp;<br/>thk.constructor.name === &quot;Thunk&quot;</span></p><p style="padding-top: 1pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">) {</p><p style="padding-top: 2pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">thk = thk.fn();</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">return thk;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>The difference now would be that, instead of returning a thunk, youd return a Thunk object, so our<br/>new trampolining function can now distinguish an actual thunk (which is meant to be invoked and<br/>executed) from any other kind of result (which is meant to be returned).</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>So, if you happen to have a recursive algorithm, but it won’t run because of stack limits, you can fix<br/>it reasonably by going through the following steps:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><ol id="l116"><li data-list-text="1."><p style="padding-left: 70pt;text-indent: -17pt;text-align: left;">Change all recursive calls to tail recursion using continuations.</p></li><li data-list-text="2."><p style="padding-top: 6pt;padding-left: 69pt;text-indent: -17pt;text-align: left;">Replace all return statements so that they’ll return thunks.</p></li><li data-list-text="3."><p style="padding-top: 6pt;padding-left: 70pt;text-indent: -17pt;text-align: left;">Replace the call to the original function with a trampoline call to start the calculations.</p></li></ol><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Of course, this doesn’t come for free. You’ll notice that, when using this mechanism, there’s extra work<br/>involving returning thunks, evaluating them, and so on, so you can expect the total time to go up.<br/>Nonetheless, this is a low price to pay if the alternative is having a non-working solution to a problem!</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 44pt;text-indent: 0pt;text-align: justify;"><a name="bookmark409">Recursion elimination</a></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>There’s yet one other possibility that you might want to explore, but that falls beyond the realm of<br/>FP and into algorithm design. It’s a computer science fact that any algorithm implemented using<br/>recursion has an equivalent version that doesn’t use recursion at all, and instead depends on a stack.<br/>There are ways to systematically transform recursive algorithms into iterative ones, so if you run</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">360  Designing Functions - Recursion</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>out of all options (that is, if not even continuations or thunks can help you), then you’d have a final<br/>opportunity to achieve your goals by replacing all recursion with iteration. We won’t be getting into<br/>this—as I said, this elimination has little to do with FP—but it’s important to know that the tool exists<br/>and that you might be able to use it.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-left: 52pt;text-indent: 0pt;text-align: left;"><a name="bookmark410">Summary</a></p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>In this chapter, we saw how we can use recursion, a basic tool in FP, as a powerful technique to create<br/>algorithms for problems that would probably require far more complex solutions otherwise. We<br/>started by considering what recursion is and how to think recursively in order to solve problems,<br/>then moved on to see some recursive solutions to several problems in different areas, and ended by<br/>analyzing potential problems with deep recursion and how to solve them.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;">In <i>Chapter 10, Ensuring Purity, </i><span>we shall get back to a concept we saw earlier in the book, function<br/>purity, and see some techniques that will help us guarantee that a function won’t have any side effects<br/>by ensuring the immutability of arguments and data structures.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-left: 52pt;text-indent: 0pt;text-align: left;"><a name="bookmark411">Questions</a></p><ol id="l117"><ol id="l118"><li data-list-text="9.1"><p class="s10" style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;">Into reverse: <span class="p">Can you program a reverse (str: string) function but implement it in a<br/>recursive fashion? The best way to do this would be using the standard string reverse () method,<br/>as    detailed    in    developer.    mozilla.    org/en-US/docs/Web/JavaScript/Reference/<br/>Global_Ob j ects/Array/reverse, but that wouldn’t do for a question on recursion, would it?</span></p></li><li data-list-text="9.2"><p style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><b>Climbing steps: </b>Suppose you want to climb up a ladder with <i>n </i><span>steps. Each time you raise your<br/>foot, you may climb up one or two rungs. In how many different ways can you climb up that ladder?<br/>For example, you can climb a four-rung ladder in five different ways:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l119"><li data-list-text="•"><p style="padding-left: 79pt;text-indent: -13pt;text-align: left;">Always take one step at a time</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 79pt;text-indent: -13pt;text-align: left;">Always take two steps at a time</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 79pt;text-indent: -13pt;text-align: left;">Take two steps first, then one, and then one</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 79pt;text-indent: -13pt;text-align: left;">Take one step first, then two, and then one</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 79pt;text-indent: -13pt;text-align: left;">Take one step first, then another one, and finish with two</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li></ul></li><li data-list-text="9.3"><p class="s10" style="padding-left: 52pt;text-indent: 0pt;line-height: 126%;text-align: justify;">Sorting recursively: <span class="p">Many sorting algorithms can be described with recursion; can you<br/>implement them?</span></p><ul id="l120"><li data-list-text="•"><p class="s33" style="padding-top: 8pt;padding-left: 79pt;text-indent: -13pt;line-height: 123%;text-align: left;">	<span class="s10">Selection sort: </span><span class="p">Find the maximum element of the array, remove it, recursively sort the rest,<br/>and then push the maximum element to the end of the sorted rest</span></p></li><li data-list-text="•"><p class="s33" style="padding-top: 5pt;padding-left: 79pt;text-indent: -13pt;line-height: 123%;text-align: left;">	<span class="s10">Insertion sort: </span><span class="p">Take the first element of the array, sort the rest, and finish by inserting the<br/>removed element into its correct place in the sorted rest</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 401pt;text-indent: 0pt;text-align: left;">Questions   361</p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l121"><li data-list-text="•"><p class="s10" style="padding-left: 70pt;text-indent: -13pt;line-height: 123%;text-align: left;">Merge sort: <span class="p">Divide the array into two parts, sort each one, and finish by merging the two<br/>sorted parts into a sorted list</span></p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p></li></ul></li><li data-list-text="9.4"><p class="s10" style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: left;">What could go wrong? <span class="p">A developer decided that he could write a shorter version of Quicksort.<br/>He reasoned that the pivot didn’t need special handling since it would be set into its correct place<br/>when sorting greaterEqual. Can you foresee any possible problems with this? The following code<br/>highlights the changes that the developer made with regard to the original version we saw earlier:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 65pt;text-indent: -12pt;line-height: 143%;text-align: left;"><span>const quicksort = &lt;A&gt;(arr: A[]): A[] =&gt; {<br/>if (arr.length &lt; 2) {</span></p><p style="padding-left: 76pt;text-indent: 0pt;text-align: left;">return arr;</p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">} else {</p><p style="padding-top: 4pt;padding-left: 76pt;text-indent: 0pt;text-align: left;">const pivot = arr[0];</p><p style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">const smaller = <b>arr.filter((x) =&gt; x &lt; pivot);</b></p><p style="padding-top: 4pt;padding-left: 76pt;text-indent: 0pt;text-align: left;">const greaterEqual = <b>arr.filter((x) =&gt; x &gt;= pivot);</b></p><p style="padding-top: 4pt;padding-left: 76pt;text-indent: 0pt;text-align: left;">return [</p><p class="s10" style="padding-top: 4pt;padding-left: 90pt;text-indent: 0pt;text-align: left;">...quicksort(smaller),</p><p class="s10" style="padding-top: 4pt;padding-left: 90pt;text-indent: 0pt;text-align: left;">...quicksort(greaterEqual),</p><p style="padding-top: 5pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">] ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="9.5"><p style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: left;"><b>More efficiency: </b><span>Let’s make quicksort () more efficient by avoiding having to call filter ()<br/>twice. Along the lines of what we saw in the </span><i>Calculating several values at once </i>section in <i>Chapter 5,</i></p><p class="s9" style="padding-left: 43pt;text-indent: 0pt;line-height: 10pt;text-align: left;">ProgrammingDeclaratively, <span class="p">write a partition (arr, pr) function that, given an arr array and</span></p><p style="padding-top: 2pt;padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>an f n () predicate, will return two arrays: the values of arr for which f n is true in the first one, and<br/>the rest of the values of arr in the second one:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 64pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>const partition = &lt;A&gt;(<br/>arr : A [] ,</span></p><p style="text-indent: 0pt;line-height: 10pt;text-align: right;">fn: (x: A) =&gt; boolean</p><p style="padding-top: 4pt;text-indent: 0pt;text-align: right;">) : [A [] , A [] ] =&gt;{...} ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 65pt;text-indent: -12pt;line-height: 142%;text-align: left;"><span>const quicksort = &lt;A&gt;(arr: A[] ) : A[] =&gt; {<br/>if (arr.length &lt; 2) {</span></p><p style="padding-left: 77pt;text-indent: 0pt;text-align: left;">return arr;</p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">} else {</p><p style="padding-top: 4pt;padding-left: 76pt;text-indent: 0pt;text-align: left;">const pivot = arr[0];</p><p class="s10" style="padding-top: 4pt;padding-left: 76pt;text-indent: 0pt;text-align: left;">const [smaller, greaterEqual] = partition(</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">362  Designing Functions - Recursion</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 97pt;text-indent: 0pt;text-align: left;"><a name="bookmark412">arr.slice(1),</a><a name="bookmark413">&zwnj;</a></p><p class="s10" style="padding-top: 4pt;padding-left: 99pt;text-indent: 0pt;text-align: left;">(x) =&gt; x &lt; pivot</p><p style="padding-top: 5pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">) ;</p><p style="padding-top: 3pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">return [</p><p style="padding-top: 4pt;padding-left: 97pt;text-indent: 2pt;line-height: 144%;text-align: left;"><span>. . .quicksort(smaller) ,<br/>pivot,</span></p><p style="padding-left: 99pt;text-indent: 0pt;line-height: 10pt;text-align: left;">...quicksort(greaterEqual) ,</p><p style="padding-top: 5pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">] ;</p><p class="s84" style="padding-top: 4pt;padding-left: 75pt;text-indent: 0pt;text-align: left;">}</p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">};</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="9.6"><p class="s10" style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;">Completing callbacks: <span class="p">In our f indR () function, we did not provide all possible parameters<br/>to the cb () callback. Can you fix that? Your solution should be along the lines of what we did for<br/>map () and other functions. (And yes, if you can also allow for empty places in the array, it would<br/>be even better.)</span></p></li><li data-list-text="9.7"><p class="s10" style="padding-top: 7pt;padding-left: 73pt;text-indent: -20pt;text-align: justify;">Recursive logic: <span class="p">We didn’t get to code every () and some () using recursion: can you do that?</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="9.8"><p class="s10" style="padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: justify;">Symmetrical queens: <span class="p">In the eight queens puzzle we previously solved, only one solution shows<br/>symmetry in the placement of the queens. Can you modify your algorithm to find it?</span></p></li><li data-list-text="9.9"><p class="s10" style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;">Longest common subsequence: <span class="p">A classic dynamic programming problem is as follows: given two<br/>strings, find the length of the longest subsequence present in both of them. Be careful: we define a<br/>subsequence as a sequence of characters that appear in the same relative order but not necessarily next<br/>to   each other. For example, the longest common subsequence of INTERNATIONAL and CONTRACTOR<br/>is N. . . T. . . R. . . A. . . T.  0. Try it out with and without memoizing and see the difference!</span></p></li><li data-list-text="9.10"><p class="s10" style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;">At odds with JavaScript: <span class="p">This may not be a functional programming question, but in how many<br/>ways (not necessarily recursive!) can you implement isOdd () ? There are quite a few!</span></p></li><li data-list-text="9.11"><p class="s10" style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: justify;">Odds and evens trampolining: <span class="p">Implement isOdd () and isEven () using a trampoline to<br/>avoid stack overflow problems.</span></p></li><li data-list-text="9.12"><p class="s10" style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: justify;">Mutual problem? <span class="p">One version I coded for isEven () /isOdd () was as follows, but it had a<br/>serious bug; can you find it?</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 74pt;text-indent: -12pt;line-height: 142%;text-align: left;"><span>function isEven(n: number): boolean {<br/>if  (n  ===  0)  {</span></p><p style="padding-left: 85pt;text-indent: 0pt;text-align: left;">return true;</p><p style="padding-top: 4pt;padding-left: 75pt;text-indent: 0pt;text-align: left;">} else {</p><p style="padding-top: 4pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">return isOdd(n - 1);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 401pt;text-indent: 0pt;text-align: left;">Questions  <span class="s153">363</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 65pt;text-indent: -12pt;line-height: 144%;text-align: left;"><span>function isOdd(n: number): boolean {<br/>if (n === 1) {</span></p><p style="padding-left: 77pt;text-indent: 0pt;line-height: 10pt;text-align: left;">return true;</p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">} else {</p><p style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">return isEven(n - 1);</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="9.13"><p class="s10" style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: left;">Say no to whiles? <span class="p">Alternative (shorter) implementations of expression () and term (),<br/>which don’t use while, follow - are they correct?</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 65pt;text-indent: -12pt;line-height: 146%;text-align: left;"><span>function expression(): number {<br/>for (let accum = term(); ; ) {</span></p><p style="padding-left: 88pt;text-indent: -11pt;line-height: 143%;text-align: left;"><span>if (tokens[curr] === PLUS) {<br/>curr++; // skip PLUS<br/>accum += term();</span></p><p style="padding-left: 89pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>} else if (tokens[curr] === MINUS) {<br/>curr++; // skip MINUS</span></p><p style="padding-left: 88pt;text-indent: 0pt;line-height: 10pt;text-align: left;">accum -= term();</p><p style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">} else {</p><p style="padding-top: 4pt;padding-left: 89pt;text-indent: 0pt;text-align: left;">return accum;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 6pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">function term(): number {</p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">for (let accum = factorO; ; ) {</p><p style="padding-top: 4pt;padding-left: 88pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>if (tokens[curr] === TIMES) {<br/>curr++; // skip TIMES<br/>accum *= factorO;</span></p><p style="padding-left: 89pt;text-indent: -11pt;line-height: 142%;text-align: left;"><span>} else if (tokens[curr] === DIVIDES) {<br/>curr++; // skip DIVIDES</span></p><p style="padding-left: 88pt;text-indent: 0pt;text-align: left;">accum /= factorO;</p><p style="padding-top: 4pt;padding-left: 88pt;text-indent: -10pt;line-height: 144%;text-align: left;"><span>} else if (tokens[curr] === MODULUS) {<br/>curr++; // skip MODULUS</span></p><p style="padding-left: 88pt;text-indent: 0pt;line-height: 10pt;text-align: left;">accum %= factorO;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">364  Designing Functions - Recursion</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 97pt;text-indent: -10pt;line-height: 115%;text-align: left;"><span>} else {<br/>return accum;</span></p><p class="s17" style="padding-top: 2pt;padding-left: 87pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="9.14"><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><b>Power, more power! </b><span>Add the exponentiation operator, &quot; * to our arithmetic expression evaluator.<br/>(Yes, the exponentiation operator in JavaScript is &quot; * *&quot;, not &quot; </span><span class="s162">A </span><span>&quot;, but I wanted to have single-character<br/>tokens for simplicity.) Be sure to implement priorities correctly, and also to make the operator right-<br/>associative: 2^3*4 should be evaluated as (2</span><span class="s162">A </span>(3<span class="s162">A</span>4) ) ,not ((2<span class="s239">A</span>3)<span class="s239">A</span>4).</p></li><li data-list-text="9.15"><p class="s10" style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;">Error-prone evaluation: <span class="p">Our evaluation algorithm is prone to errors because it expects expressions<br/>to be syntactically valid. How can you enhance it?</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><h3 style="padding-top: 10pt;text-indent: 0pt;text-align: right;"><a name="bookmark414">10</a><a name="bookmark415">&zwnj;</a></h3><h2 style="padding-top: 4pt;padding-left: 269pt;text-indent: 0pt;text-align: left;">Ensuring Purity</h2><h2 style="padding-top: 2pt;padding-left: 280pt;text-indent: 0pt;text-align: left;">- Immutability</h2><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;">In <i>Chapter 4, Behaving Properly, </i><span>when we considered pure functions and their advantages, we saw<br/>that side effects such as modifying a received argument or a global variable were frequent causes of<br/>impurity. Now, after several chapters dealing with many aspects and tools of FP, let’s talk about the<br/>concept of </span><i>immutability </i><span>- how to work with objects in such a way that accidentally modifying them<br/>will become harder or, even better, impossible.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>We cannot force developers to work in a safe, guarded way. Still, if we find some way to make data<br/>structures immutable (meaning that they cannot be directly changed, except through some interface<br/>that never allows us to modify the original data and produces new objects instead), then we’ll have<br/>an enforceable solution. In this chapter, we will look at two distinct approaches to working with such<br/>immutable objects and data structures:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l122"><li data-list-text="•"><p class="s33" style="padding-left: 70pt;text-indent: -13pt;line-height: 123%;text-align: left;">	<span class="s9">Basic JavaScript ways, </span><span class="p">such as freezing objects, plus cloning to create new ones instead of<br/>modifying existing objects</span></p></li><li data-list-text="•"><p class="s33" style="padding-top: 5pt;padding-left: 70pt;text-indent: -13pt;line-height: 123%;text-align: left;">	<span class="s9">Persistent data structures, </span><span class="p">with methods that allow us to update them without changing the<br/>original and without the need to clone everything either, for higher performance</span></p></li></ul></li></ol></ol><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 56pt;text-indent: 0pt;text-align: left;"><a name="bookmark416">Warning!</a></p><p style="padding-top: 4pt;padding-left: 56pt;text-indent: 0pt;line-height: 115%;text-align: justify;"><span>The code in this chapter isn’t production-ready; I wanted to focus on the main points and not<br/>on all the myriad details concerning properties, getters, setters, lenses, prototypes, and so on<br/>that you should take into account for a full, bulletproof solution. For actual development, I<br/>recommend going with a third-party library, but only after checking that it really applies to<br/>your situation. We’ll be recommending several such libraries, but of course, there are many<br/>more that you could use.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">366  Ensuring Purity - Immutability</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-top: 8pt;padding-left: 52pt;text-indent: 0pt;text-align: justify;"><a name="bookmark417">Going the straightforward JavaScript way</a></p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>One of the biggest causes of side effects was the possibility of a function modifying its arguments or<br/>global objects. All non-primitive objects are passed as references, so if/when you modify them, the<br/>original objects will be changed. If we want to stop this (without just depending on the goodwill and<br/>clean coding of our developers), we may want to consider some straightforward JavaScript techniques<br/>to prohibit those side effects:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l123"><li data-list-text="•"><p style="padding-left: 79pt;text-indent: -13pt;text-align: left;">Avoiding mutator functions that directly modify the object that they are applied to</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 79pt;text-indent: -13pt;text-align: left;">Using const declarations to prevent variables from being changed</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 79pt;text-indent: -13pt;text-align: left;">Freezing objects so that they can’t be modified in any way</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 79pt;text-indent: -13pt;text-align: left;">Creating (changed) clones of objects to avoid modifying the original</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 79pt;text-indent: -13pt;text-align: left;">Using getters and setters to control what is changed and how</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 52pt;text-indent: 13pt;line-height: 209%;text-align: left;">Using a functional concept - <i>lenses - </i><span>to access and set attributes<br/>Let’s take a look at each technique in more detail.</span></p><p class="s12" style="padding-top: 2pt;padding-left: 53pt;text-indent: 0pt;text-align: justify;"><a name="bookmark418">Mutator functions</a></p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>A common source of unexpected problems is that several JavaScript methods are mutators that modify<br/>the  underlying  object.  (Refer  to  developer  .mozilia.  org/en-US/docs/Web/JavaScript/<br/>Ref  erence/Global_  Ob  j  ects/Array#Mutator_  methods  for  more  on  mutators.)  In  this<br/>case, by merely using these methods, you will be causing a side effect that you may not even be aware<br/>of. Arrays are the most basic sources of problems, and the list of troublesome methods isn’t short:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="•"><p style="padding-left: 79pt;text-indent: -13pt;text-align: left;">copyWithinO lets you copy elements within an array</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 79pt;text-indent: -13pt;text-align: left;">f i 11 () fills an array with a given value</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 79pt;text-indent: -13pt;text-align: left;">push () and pop () let you add or delete elements at the end of an array</p></li><li data-list-text="•"><p class="s33" style="padding-top: 8pt;padding-left: 79pt;text-indent: -13pt;line-height: 123%;text-align: left;">	<span class="p">shift () and unshift () work in the same way as push () and pop () but at the beginning<br/>of an array</span></p></li><li data-list-text="•"><p style="padding-top: 5pt;padding-left: 79pt;text-indent: -13pt;text-align: left;">splice () lets you add or delete elements anywhere within an array</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 79pt;text-indent: -13pt;text-align: left;">reversed and sort () modify an array in place, reversing or sorting its elements</p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: justify;">Let’s take a look at an example we saw in the <i>Argument mutation </i>section of <i>Chapter 4, Behaving Properly.</i></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// maxStrings.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">const maxStrings = (a: string[]) =&gt; a.sort().pop();</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 285pt;text-indent: 0pt;text-align: left;">Going the straightforward JavaScript way     367</p><p style="padding-top: 22pt;padding-left: 65pt;text-indent: -13pt;line-height: 143%;text-align: left;"><span>const countries = [<br/>&quot;Argentina&quot;,<br/>&quot;Uruguay&quot;,<br/>&quot;Brasil&quot;,<br/>&quot;Paraguay&quot;,</span></p><p style="padding-top: 1pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">] ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 6pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">console.log(maxStrings(countries)); // &quot;Uruguay&quot;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Our maxStrings () function returns the highest value in an array, but also modifies the original<br/>array; this is a side effect of the sort () and pop () mutator functions. In this case and others, you<br/>might generate a copy of the array and then work with that; both the spread operator and .slice ()<br/>are useful:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">const maxStrings2 = (a: string!])■ string =&gt;</p><p class="s10" style="padding-top: 4pt;padding-left: 67pt;text-indent: 0pt;text-align: left;">[...a] .<span class="p">sort() .pop() as string;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">const maxStrings3 = (a: string!]): string =&gt;</p><p class="s10" style="padding-top: 4pt;padding-left: 64pt;text-indent: 0pt;text-align: left;">a. slice ().<span class="p">sort().pop() as string;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>console.log(maxStrings2(countries)); // &quot;Uruguay&quot;<br/>console.log(maxStrings3(countries)); // &quot;Uruguay&quot;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">console.log(countries);</p><p style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// [&quot;Argentina&quot;, &quot;Uruguay&quot;, &quot;Brasil&quot;, &quot;Paraguay&quot;]</p><p class="s9" style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">/I <span class="p">unchanged</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Both new versions of our maxStrings () functions are now functional, without side effects, because<br/>the mutator methods have been applied to copies of the original argument. By the way, if you are<br/>wondering about the as string part in both new functions, its because TypeScript warns you that<br/>the array might be empty, and I’m telling it that I guarantee the array won’t be so.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Of course, setter methods are also mutators and will logically produce side effects because they can<br/>do just about anything. If this is the case, you’ll have to go for some of the other solutions described<br/>later in this chapter.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 43pt;text-indent: 0pt;text-align: left;"><a name="bookmark419">Constants</a></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>If the mutations don’t happen because of the use of some JavaScript methods, then we might want<br/>to attempt to use const definitions, but unfortunately, that just won’t work. In JavaScript, const</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">368  Ensuring Purity - Immutability</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;">means that the <i>reference </i><span>to the object or array cannot change (you cannot assign a different object to<br/>it), but you can still modify its properties. We can see this in the following code:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;line-height: 143%;text-align: left;"><span>const myObj = { d: 22, m: 9 };<br/>console.log(myObj);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// {d: 22, m: 9}</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">myObj = { d: 12, m: 4 };</p><p class="s10" style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;"><a name="bookmark420">// Uncaught TypeError: Assignment to constant variable.</a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;line-height: 144%;text-align: left;"><a name="bookmark421"><span>myObj.d = 12; // but this is fine!<br/>myObj.m = 4;<br/>console.log(myObj);</span></a></p><p class="s10" style="padding-left: 62pt;text-indent: 0pt;line-height: 10pt;text-align: left;">// {d: 12, m: 4}</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>You cannot modify the value of myObj by assigning it a new value, but you can modify its current<br/>value so that only the reference to an object is constant, not the object’s values themselves. (By the<br/>way, this would have also happened with arrays.) So, if you use const everywhere, you will only be<br/>safe against direct assignments to objects and arrays. More modest side effects, such as changing an<br/>attribute or an array element, will still be possible, so this is not a solution.</span></p><p style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;">Two methods can work <i>-freezing </i>to provide unmodifiable structures, and <i>cloning </i><span>to produce modified<br/>new ones. These are probably not the best ways to go about forbidding objects from being changed,<br/>but they can be used as a makeshift solution. Let’s look at them in more detail, starting with freezing.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 53pt;text-indent: 0pt;text-align: left;"><a name="bookmark422">Freezing</a></p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>If we want to avoid the possibility of a programmer accidentally or willingly modifying an object,<br/>freezing it is a valid solution. After an object has been frozen, any attempts at modifying it will silently<br/>fail                                                                                                       - JavaScript won’t report an error or throw an exception, but it won’t alter the object either.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>In the following example, if we attempt to make the same changes we made in the previous section,<br/>they won’t have any effect, and myObj will be unchanged:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;line-height: 142%;text-align: left;"><span>const myObj2 = { d: 22, m: 9 };<br/>console.log(myObj 2) ;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// {d: 22, m: 9}</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;text-align: left;"><a name="bookmark423">Obj ect.freeze(myObj 2);</a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 285pt;text-indent: 0pt;text-align: left;">Going the straightforward JavaScript way     369</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 144%;text-align: justify;"><span>myObj2.d = 12; // won&#39;t have effect...<br/>myObj 2.m = 4;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: justify;">console.log(myObj 2) ;</p><p class="s10" style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: justify;">// Object {d: 22, m: 9}</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 57pt;text-indent: 0pt;text-align: justify;">Sealing or freezing?</p><p style="padding-top: 4pt;padding-left: 56pt;text-indent: 0pt;line-height: 115%;text-align: justify;"><span>Don’t confuse freezing with sealing - Obj ect. seal (), when applied to an object, prohibits<br/>you from adding or deleting properties to it. This means that the object’s structure is immutable,<br/>but the attributes themselves can be changed. Obj ect. freeze () covers not only sealing<br/>properties but also making them unchangeable. See developer .mozilla. org/en/docs/<br/>Web/JavaScript/Reference/Global_Obj   ects/Obj   ect/seal   and   developer.<br/>mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/</span></p><p style="padding-left: 57pt;text-indent: 0pt;line-height: 10pt;text-align: justify;">Obj ect/f reeze for more on this.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 8pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>There is only one problem with this solution - freezing an object is a shallow operation that freezes<br/>the attributes themselves, similar to what a const declaration does. If any of the attributes are objects<br/>or arrays themselves they can still be modified. We will only be considering data here; you may also<br/>want to freeze, say, functions, but for most use cases, it’s data you want to protect:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 64pt;text-indent: -12pt;line-height: 143%;text-align: left;"><span>const myObj 3 = {<br/>d: 22,</span></p><p style="padding-left: 64pt;text-indent: 0pt;line-height: 10pt;text-align: left;">m: 9,</p><p style="padding-top: 4pt;padding-left: 64pt;text-indent: 0pt;text-align: left;">O: { C: &quot;MVD&quot;, i: &quot;UY&quot;, f: { a: 56 } },</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 30pt;text-align: left;"><span>Obj ect.freeze(myObj 3) ;<br/>console.log(myObj 3) ;</span></p><p class="s10" style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// {d:22, m:9, o:{c:&quot;MVD&quot;, i:&quot;UY&quot;, f:{ a:56}}}</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: -8pt;line-height: 223%;text-align: left;"><span>This is only partially successful, as we can see when we try changing some attributes:<br/>myObj3.d =8888;      // won&#39;t work, as earlier</span></p><p style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">my0bj3.o.f.a = 9999; // oops, does work!!</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">console.log(myObj 3) ;</p><p style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// {d:22, m:9, O:{C:       MVD&quot;, i:&quot;UY&quot;, f:{ <b>a:9999 }}}</b></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">370  Ensuring Purity - Immutability</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Modifying myObj 3 . d doesn’t work because the object is frozen, but that doesn’t extend to objects<br/>within myObj 3, so changing myObj 3 . o . f . a does work.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>If we want to achieve real immutability for our object, we need to write a routine that will freeze all<br/>the levels of an object. Fortunately, it’s easy to achieve this by applying recursion. (We saw similar<br/>applications of recursion in the </span><i>Traversing a tree structure </i><span>section of the previous chapter.) Mainly,<br/>the  idea is to freeze the object itself and then recursively freeze each of its properties. We must ensure<br/>that we only freeze the object’s own properties; we shouldn’t mess with the prototype of the object,<br/>for example:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// deepFreeze.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 74pt;text-indent: -12pt;line-height: 153%;text-align: left;"><span>const  deepFreeze  =  &lt;0  extends  OBJ&gt;(obj:  O)  :  0  =&gt;  {<br/>if (</span></p><p style="padding-left: 85pt;text-indent: 0pt;line-height: 9pt;text-align: left;">obj &amp;&amp;</p><p style="padding-top: 4pt;padding-left: 87pt;text-indent: -1pt;line-height: 142%;text-align: left;"><span>typeof obj === &quot;object&quot; &amp;&amp;<br/>[Object.isFrozen(obj)</span></p><p style="padding-top: 2pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">) {</p><p style="padding-top: 2pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">Obj ect.freeze(obj);</p><p style="padding-top: 4pt;padding-left: 97pt;text-indent: -12pt;line-height: 144%;text-align: left;"><span>Object.getOwnPropertyNames(obj).forEach((prop)            =&gt;<br/>deepFreeze(obj [prop])</span></p><p style="padding-left: 86pt;text-indent: 0pt;text-align: left;">) ;</p><p class="s17" style="padding-top: 3pt;padding-left: 75pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">return obj;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Note that, in the same way that Obj ect. freeze () works, deepFreeze () also freezes the<br/>object in place. I wanted to keep the original semantics of the operation so that the returned object<br/>would always be the original one. If we wanted to work in a purer fashion, we should make a copy<br/>of the original object first (we’ll learn how to do this in the next section) and then freeze that. As<br/>for TypeScript, the returned value is the same type as the input; the object being frozen makes no<br/>difference with regard to types.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>A small possible problem remains, but with a very bad result - what would happen if an object included<br/>a reference to itself? We can avoid this if we skip freezing already frozen objects; backward circular<br/>references would be ignored, since the objects they refer to would already be frozen. So, the logic we<br/>wrote took care of that problem, and there’s nothing more to be done!</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>If we apply deepFreeze () to an object, we can safely pass it to any function, knowing there is no<br/>way in which it can be modified. You can also use this property to test whether a function modifies</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 285pt;text-indent: 0pt;text-align: left;">Going the straightforward JavaScript way     371</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>its arguments - deep-freeze them, call the function, and if the function depends on modifying its<br/>arguments, it wont work because the changes will be silently ignored. So, how can we return a result<br/>from a function if it involves a received object? This can be solved in many ways. A simple one uses<br/>cloning, as we’ll see.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>In this section, we dealt with one of the methods we can use to avoid changes in objects. (Check the<br/></span><i>Questions </i><span>section at the end of this chapter for another way of freezing objects by means of proxies.)<br/>Now, let’s look at an alternative involving cloning.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 43pt;text-indent: 0pt;text-align: justify;"><a name="bookmark424">Cloning and mutating</a></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>If mutating an object isn’t allowed, you must create a new one. For example, if you use Redux, a reducer<br/>is a function that receives the current state and an action (essentially, an object with new data) and<br/>produces the new state. Modifying the current state is totally forbidden, and we could avoid this<br/>error by always working with frozen objects, as we saw in the previous section. To fulfill the reducer’s<br/>requirements, we have to be able to clone the original state, as well as mutate it according to the<br/>received action. The resulting object will become the new state.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>To round things off, we should also freeze the returned object, just like we did with the original state.<br/>But let’s start at the beginning - how do we clone an object? Of course, you can always do this by<br/>hand, but that’s not something you’d want to consider when working with large, complex objects.<br/>(You may want to revisit the </span><i>More general looping </i>section of <i>Chapter 5, Programming Declaratively,</i><span>where we wrote a basic ob j Copy () function that provides a different approach from the one we’ll<br/>show here.) For example, if you wanted to clone oldObj ect to produce newOb j ect, doing it by<br/>hand would imply a lot of code:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 64pt;text-indent: -11pt;line-height: 143%;text-align: left;"><span>const oldObject = {<br/>d: 22,</span></p><p style="padding-left: 64pt;text-indent: 0pt;text-align: left;">m: 9,</p><p style="padding-top: 4pt;padding-left: 64pt;text-indent: 0pt;text-align: left;">O: { C: &quot;MVD&quot;, i: &quot;UY&quot;, f: { a: 56 } },</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 64pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>const  newObject  =  {<br/>d:     oldObject.d,</span></p><p style="padding-left: 64pt;text-indent: 0pt;line-height: 146%;text-align: left;"><span>m:   oldObject.m,<br/>o: {</span></p><p style="padding-left: 77pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>c: oldObject.o.c,<br/>i: oldObject.o.i,</span></p><p style="padding-left: 77pt;text-indent: 0pt;line-height: 10pt;text-align: left;">f: {a: oldObject.o.f.a },</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">372  Ensuring Purity - Immutability</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>This manual solution is obviously a lot of work, and error-prone as well; you could easily forget an<br/>attribute! Going for more automatic solutions, there are a couple of straightforward ways of copying<br/>arrays or objects in JavaScript, but they have the same shallowness problem. You can make a (shallow)<br/>copy of an object with Ob j ect. assign () or by spreading:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;text-align: left;">const myObj = { d: 22, m: 9 };</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">const newObjl = <b>Object.assign({}, myObj);</b></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">const new0bj2 = { <b>...myObj };</b></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: justify;">To create a (shallow) copy of an array, you can either use sliced or spreading, as we saw in the</p><p class="s9" style="padding-top: 2pt;padding-left: 52pt;text-indent: 0pt;text-align: justify;">Mutator functions <span class="p">section earlier in this chapter:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;text-align: left;">const myArray = [1, 2, 3, 4] ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">const newArrayl <b>= myArray.slice();</b></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">const newArray2 = <b>[...myArray];</b></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>What’s the problem with these solutions? If an object or array includes objects (which may themselves<br/>include objects), we get the same problem that we had when freezing - objects are copied by reference,<br/>which means that a change in the new object will also change the old object:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 73pt;text-indent: -11pt;line-height: 143%;text-align: left;"><span>const oldObject = {<br/>d: 22,</span></p><p style="padding-left: 73pt;text-indent: 0pt;line-height: 10pt;text-align: left;">m: 9,</p><p style="padding-top: 4pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">O: { C: &quot;MVD&quot;, i: &quot;UY&quot;, f: { a: 56 } },</p><p style="padding-top: 6pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">};</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 5pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">const new0bject2 = <b>Object.assign({}, oldObject);</b></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">new0bject2.d = 8 888;</p><p style="padding-top: 4pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">newObject2.o.f.a = 9999;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">console.log(newObject2);</p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">// {d:8888, m:9, o: {c:&quot;MVD&quot;, i:&quot;UY&quot;, f: {a:9999}}} -- ok</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">console.log(oldObject);</p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">// {d:22, m:9, O: {c:&quot;MVD&quot;, i:&quot;UY&quot;, f: {a:9999}}} -- oops!!</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 285pt;text-indent: 0pt;text-align: left;">Going the straightforward JavaScript way     373</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>In this case, note what happened when we changed some properties of newOb j ect. Changing<br/>newObj ect. d worked fine, but changing newOb j ect. o. f . a also impacted oldOb j ect, since<br/>newOb j ect. o and oldOb j ect. o actually refer to the very same object.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 56pt;text-indent: 0pt;text-align: left;"><a name="bookmark425">New age, old section</a></p><p style="padding-top: 4pt;padding-left: 56pt;text-indent: 0pt;line-height: 115%;text-align: left;"><span>Since 2022, a new structuredClone () function has been available, so if your browser supports<br/>it, the code on these pages won’t be needed. For more information, check out developer .<br/>mozilla.org/en-US/docs/Web/API/structuredClone.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: justify;"><span>There is a simple solution to this, based on JSON. Ifwe stringify () the original object and then<br/>parse () the result, we’ll get a new object that’s totally separate from the old one:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// deepCopy.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">const jsonCopy = &lt;0 extends OBJ&gt;(obj: O): O =&gt;</p><p class="s10" style="padding-top: 4pt;padding-left: 64pt;text-indent: 0pt;text-align: left;">JSON.parse(JSON.stringify(obj));</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: left;">By using JSON. stringify (), we can convert our object into a string. Then, JSON. parse ()</p><p style="padding-top: 2pt;padding-left: 43pt;text-indent: 0pt;text-align: left;">creates a (new) object out of that string - simple! This works with both arrays and objects, but there’s</p><p style="padding-top: 2pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>a problem. If any object’s properties have a constructor, they won’t be invoked; the result will always be<br/>composed of plain JavaScript objects. (This is not the only problem with j sonCopy (); see </span><i>Question</i>We can see this very simply with Date ():</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">const myDate = new Date();</p><p style="padding-top: 3pt;padding-left: 53pt;text-indent: 0pt;line-height: 30pt;text-align: left;"><span>const newDate = jsonCopy(myDate);<br/>console.log(typeof myDate, typeof newDate);</span></p><p class="s10" style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// object string</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 126%;text-align: left;"><span>While myDate is an object, newDate turns out to be a string with a value, the date and time at the<br/>moment we did the conversion, &quot;2 023-01-15T09:23:55.12 5 Z&quot;.</span></p><p style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>We could do a recursive solution, just like we did with deep freezing, and the logic is quite similar.<br/>Whenever we find a property that is really an object, we invoke the appropriate constructor:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s9" style="padding-left: 53pt;text-indent: 0pt;text-align: left;">I<span class="p">/ continued...</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 65pt;text-indent: -12pt;line-height: 143%;text-align: left;"><span>const deepCopy = &lt;0 extends OBJ&gt;(obj: O): O =&gt; {<br/>let aux: O = obj;</span></p><p style="padding-left: 65pt;text-indent: 0pt;text-align: left;">if (obj &amp;&amp; typeof obj          &quot;object&quot;) {</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">374  Ensuring Purity - Immutability</p><p style="padding-top: 3pt;padding-left: 85pt;text-indent: 0pt;line-height: 30pt;text-align: left;"><span>aux = new (obj as any).constructor(); // TS hack!<br/>Object.getOwnPropertyNames(obj).forEach((prop) =&gt; {</span></p><p style="padding-top: 4pt;padding-left: 97pt;text-indent: 0pt;text-align: left;">aux [prop as keyof 0] = deepCopy(obj [prop]) ;</p><p style="padding-top: 6pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">});</p><p class="s17" style="padding-top: 2pt;padding-left: 75pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">return aux;</p><p style="padding-top: 6pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">};</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Whenever we find that a property of an object is actually another object, we invoke its constructor<br/>before continuing. This solves the problem we found with dates or, in fact, with any object! If we run<br/>the preceding code but use deepCopy () instead of j sonCopy (), we’ll get obj ect obj ect as<br/>output, as it should be. If we check the types and constructors, everything will match.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>There’s a need for a minor hack because TypeScript works better with classes than with constructor<br/>functions - writing obj as any gets type checking to work, but it’s not very nice. Also, we need<br/>to write prop as keyof 0 because, otherwise, TypeScript would protest that prop could be<br/>anything, not necessarily a key of the original type.</span></p><p style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;text-align: justify;">The data-changing experiment will also work fine now:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 73pt;text-indent: -11pt;line-height: 141%;text-align: left;"><span>let oldObject = {<br/>d: 22,</span></p><p style="padding-left: 73pt;text-indent: 0pt;text-align: left;">m: 9,</p><p style="padding-top: 4pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">O: { C: &quot;MVD&quot;, i: &quot;UY&quot;, f: { a: 56 } },</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;line-height: 143%;text-align: left;"><span>let newObject = deepCopy(oldObject);<br/>newObject.d = 8888;</span></p><p style="padding-left: 61pt;text-indent: 0pt;text-align: left;">newObject.o.f.a = 9999;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">console.log(newObject);</p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">// {d:8888, m:9, O:{C:&quot;MVD&quot;, i:&quot;UY&quot;, f:{a:9999}}}</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">console.log(oldObject);</p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">// {d:22, m:9, o:{c:&quot;MVD&quot;, i:&quot;UY&quot;, f:{a:56}}} -- unchanged!</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 285pt;text-indent: 0pt;text-align: left;">Going the straightforward JavaScript way     375</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Let’s check out the last few lines. Modifying newOb j ect had no impact on oldOb j ect, so both<br/>objects are completely separate.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;text-align: justify;">Now that we know how to copy an object, we can follow these steps:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><ol id="l124"><li data-list-text="1."><p style="padding-left: 71pt;text-indent: -18pt;text-align: left;">Receive a (frozen) object as an argument.</p></li><li data-list-text="2."><p style="padding-top: 6pt;padding-left: 71pt;text-indent: -18pt;text-align: left;">Make a copy of it, which won’t be frozen.</p></li><li data-list-text="3."><p style="padding-top: 6pt;padding-left: 71pt;text-indent: -18pt;text-align: left;">Take values from that copy that we can use in our code.</p></li><li data-list-text="4."><p style="padding-top: 6pt;padding-left: 70pt;text-indent: -18pt;text-align: left;">Modify the copy at will.</p></li><li data-list-text="5."><p style="padding-top: 6pt;padding-left: 71pt;text-indent: -18pt;text-align: left;">Freeze it.</p></li><li data-list-text="6."><p style="padding-top: 6pt;padding-left: 71pt;text-indent: -18pt;text-align: left;">Return it as the result of the function.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>All of this is viable, though a bit cumbersome. Also, there are some limitations - we won’t be able to<br/>duplicate private properties or properties that involve symbols, we won’t duplicate getters and setters,<br/>and metadata-related features will also be missing. Let’s accept that, and add a couple of functions<br/>that will help bring everything together.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 43pt;text-indent: 0pt;text-align: justify;"><a name="bookmark426">Getters and setters</a></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>When following the steps provided at the end of the previous section, you may have noticed that every<br/>time you want to update a field, things become troublesome and prone to errors. Let’s use a common<br/>technique to add a pair of functions: getters and setters. They are as follows:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l125"><li data-list-text="•"><p class="s9" style="padding-left: 70pt;text-indent: -13pt;text-align: left;">Getters <span class="p">can be used to get values from a frozen object by unfreezing them so that they can be used.</span></p></li><li data-list-text="•"><p class="s33" style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;line-height: 123%;text-align: left;">	<span class="s9">Setters </span><span class="p">allow you to modify any property of an object. You can do this by creating a new and<br/>updated version, leaving the original untouched.</span></p></li></ul></li></ol><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: justify;">Let’s build our getters and setters.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s34" style="padding-left: 43pt;text-indent: 0pt;text-align: justify;">Getting a property</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;">In the <i>Getting a property from an object </i>section in <i>Chapter 6, Producing Functions, </i><span>we wrote a simple<br/>getField () function that could handle getting a single attribute from an object. (See </span><i>Question</i></p><p class="s9" style="padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: left;">6.13 in <span class="p">that chapter for the missing companion setField() function.) Let’s take a look at how we<br/>can code this. We can have a straightforward version as follows:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// getByPath.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">const getField =</p><p style="padding-top: 4pt;padding-left: 67pt;text-indent: -2pt;line-height: 143%;text-align: left;"><span>&lt; 0 extends OBJ&gt;(f: keyof O) =&gt;<br/>(obj: O) =&gt;</span></p><p style="padding-left: 76pt;text-indent: 0pt;text-align: left;">obj [f] ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">376  Ensuring Purity - Immutability</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: justify;">We can even go one better by applying currying so that we have a more general version:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">const getField2 = curry(getField);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>We could get a deep attribute from an object by composing a series of getField () applications,<br/>but that would be rather cumbersome. Instead, lets create a function that will receive a path - an<br/>array of field names - and return the corresponding part of the object, or be undefined if the path<br/>doesn’t exist. Using recursion is appropriate here and simplifies coding! Observe the following code:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 73pt;text-indent: -12pt;line-height: 143%;text-align: left;"><span>const getByPath = &lt;0 extends 0BJ&gt;(<br/>arr : string [] ,</span></p><p style="padding-left: 40pt;text-indent: 0pt;text-align: center;">obj : 0</p><p style="padding-top: 4pt;padding-left: 37pt;text-indent: 0pt;text-align: center;">) : any =&gt; {</p><p style="padding-top: 4pt;padding-left: 2pt;text-indent: 0pt;text-align: center;">if (arr[0] in obj) {</p><p class="s10" style="padding-top: 4pt;padding-left: 41pt;text-indent: 0pt;text-align: center;">return arr.length &gt; 1</p><p class="s10" style="padding-top: 4pt;padding-left: 98pt;text-indent: 0pt;text-align: left;">? getByPath(arr.slice(1), obj[arr[0]])</p><p class="s10" style="padding-top: 4pt;padding-left: 99pt;text-indent: 0pt;text-align: left;">: deepCopy(obj[arr[0]]);</p><p style="padding-top: 4pt;padding-left: 75pt;text-indent: 0pt;text-align: left;">} else {</p><p style="padding-top: 4pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">return undefined;</p><p style="padding-top: 6pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">}</p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">};</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Basically, we look for the first string in the path to see whether it exists in the object. If it doesn’t, the<br/>operation fails, so we return undefined. If successful, and we still have more strings in the path, we<br/>use recursion to keep digging into the object; otherwise, we return a deep copy of the attribute’s value.</span></p><p style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: justify;"><span>Once an object has been frozen, we cannot defrost it, so we must resort to making a new copy of it;<br/>deepCopy () is appropriate for doing this. Let’s try out our new function:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 73pt;text-indent: -11pt;line-height: 141%;text-align: left;"><span>const myObj4 = deepFreeze({<br/>d: 22,</span></p><p style="padding-left: 73pt;text-indent: 0pt;text-align: left;">m: 9,</p><p style="padding-top: 4pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">O:  {  C:  &quot;MVD&quot;,  i:  &quot;UY&quot;,  f:  {  a:  56  }  },</p><p style="padding-top: 6pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">});</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;text-align: left;">console.log(getByPath([&quot;d&quot;], my0bj4));</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 285pt;text-indent: 0pt;text-align: left;">Going the straightforward JavaScript way     377</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 53pt;text-indent: 0pt;text-align: left;"><a name="bookmark427">// 22</a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">console.log(getByPath([&quot;o&quot;] , myObj4)) ;</p><p class="s10" style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// {c: &quot;MVD&quot;, i: &quot;UY&quot;, f: {a: 56}}</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">console.log(getByPath([&quot;o&quot;, &quot;c&quot;] , myObj4));</p><p class="s10" style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// &quot;MVD&quot;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">console.log(getByPath([&quot;o&quot;, &quot;f&quot;, &quot;a&quot;], myObj4));</p><p class="s10" style="padding-top: 5pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// 56</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: left;">We can also check that returned objects are not frozen:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;line-height: 142%;text-align: left;"><span>const fObj = getByPath([&quot;o&quot;, &quot;f&quot;] , my0bj4);<br/>console.log(fObj);</span></p><p class="s10" style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// {a: 56}</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 53pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>fObj.a = 9999;<br/>console.log(fObj);</span></p><p class="s10" style="padding-left: 53pt;text-indent: 0pt;line-height: 10pt;text-align: left;">// {a: 9999} -- it&#39;s not frozen</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>Here, we can see that we could directly update the f Ob j object, which means it wasn’t frozen. Now<br/>that we’ve written our getter, we can create a setter.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s34" style="padding-left: 43pt;text-indent: 0pt;text-align: left;">Setting a property by path</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: left;">Now, we can code a similar setByPath () function that will take a path, a value, and an object</p><p style="padding-top: 2pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>and update an object. This is not a pure function, but we’ll use it to write a pure one - wait and see!<br/>Here is the code:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// setByPath.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 64pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>const setByPath = &lt;0 extends 0BJ&gt;(<br/>arr : string [] ,</span></p><p style="padding-left: 64pt;text-indent: 0pt;line-height: 143%;text-align: left;"><span>value: any,<br/>obj : 0</span></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">) : 0 =&gt; {</p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">if (!(arr[0] in obj)) {</p><p style="padding-top: 4pt;padding-left: 78pt;text-indent: 0pt;text-align: left;">(obj as any)[arr[0]] =</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">378  Ensuring Purity - Immutability</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 97pt;text-indent: 0pt;text-align: left;">arr.length === 1</p><p style="padding-top: 4pt;padding-left: 110pt;text-indent: 0pt;text-align: left;">? null</p><p style="padding-top: 4pt;padding-left: 111pt;text-indent: 0pt;text-align: left;">: Number.islnteger(arr[1] )</p><p style="padding-top: 5pt;padding-left: 110pt;text-indent: 0pt;text-align: left;">? []</p><p style="padding-top: 5pt;padding-left: 111pt;text-indent: 0pt;text-align: left;">: {};</p><p class="s17" style="padding-top: 2pt;padding-left: 75pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">if (arr.length &gt; 1) {</p><p style="padding-top: 4pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">return setByPath(arr.slice (1) , value, obj [arr [0]]) ;</p><p style="padding-top: 4pt;padding-left: 75pt;text-indent: 0pt;text-align: left;">} else {</p><p style="padding-top: 4pt;padding-left: 85pt;text-indent: 0pt;line-height: 142%;text-align: left;"><span>obj [arr[0] as keyof 0] = value;<br/>return obj;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">};</p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: left;"><span>Here, we are using recursion to get into the object, creating new attributes if needed, until we have<br/>traveled the entire length of the path. One crucial detail when creating attributes is whether we need<br/>an array or an object. (And why the as any cast for obj ? That’s an issue with TypeScript, which<br/>objects to obj [arr [ 0 ] ], so we must “trick” it. Weirdly, using Reflect. set () also works!) We</span></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>can determine that by checking the next element in the path - if it’s a number, then we need an array;<br/>otherwise, an object will do.</span></p><p style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">When we get to the end of the path, we assign the new given value.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-top: 7pt;padding-left: 66pt;text-indent: 0pt;text-align: left;"><a name="bookmark428">Seamless, immutable objects</a></p><p style="padding-top: 4pt;padding-left: 66pt;text-indent: 0pt;text-align: left;">If you like this way of doing things, check out the seamless - immutable library, which</p><p style="padding-top: 1pt;padding-left: 65pt;text-indent: 0pt;line-height: 115%;text-align: left;"><span>works in this fashion. The seamless part of the name alludes to the fact that you still work with<br/>normal objects - albeit frozen - which means you can use map (), reduce (), and so on.</span></p><p style="padding-left: 65pt;text-indent: 0pt;text-align: left;">You can read more about this at github . com/rtf eldman/seamless - immutable.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 8pt;padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>Now, you can write a function that will be able to take a frozen object and update an attribute within<br/>it, returning a new, also frozen, object:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 73pt;text-indent: -12pt;line-height: 142%;text-align: left;"><span>const updateObject = &lt;0 extends 0BJ&gt;(<br/>arr : string [] ,</span></p><p style="padding-left: 73pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>obj : 0,<br/>value: any</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 13pt;padding-left: 285pt;text-indent: 0pt;text-align: left;">Going the straightforward JavaScript way     <span class="s189">379</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">) =&gt; {</p><p style="padding-top: 3pt;padding-left: 65pt;text-indent: 0pt;line-height: 143%;text-align: left;"><span>const newObj = deepCopy(obj);<br/>setByPath(arr, value, newObj);<br/>return deepFreeze(newObj);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>Let’s check out how it works. To do this, we’ll run several updates on the myObj 3 object we have<br/>been using:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 64pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>const myObj3 = {<br/>d: 22,</span></p><p style="padding-left: 64pt;text-indent: 0pt;line-height: 10pt;text-align: left;">m: 9,</p><p style="padding-top: 4pt;padding-left: 64pt;text-indent: 0pt;text-align: left;">O: { c: &quot;MVD&quot;, i: &quot;UY&quot;, f: { a: 56 } },</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>const newl = updateObject([&quot;m&quot;], myObj3, &quot;sep&quot;);<br/>console.log(newl);</span></p><p class="s10" style="padding-left: 53pt;text-indent: 0pt;line-height: 10pt;text-align: left;">// {d: 22, m: &quot;sep&quot;, o: {c: &quot;MVD&quot;, i: &quot;UY&quot;, f: {a: 56}}};</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 53pt;text-indent: 0pt;line-height: 142%;text-align: left;"><span>const new2 = updateObject([&quot;b&quot;], myObj3, 220960);<br/>console.log(new2);</span></p><p class="s10" style="padding-left: 65pt;text-indent: -12pt;line-height: 143%;text-align: left;"><span>// {d: 22, m: 9, o: {c: &quot;MVD&quot;, i: &quot;UY&quot;, f: {a: 56}}, b:<br/>220960};</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;line-height: 143%;text-align: left;"><span>const new3 = updateObject([&quot;o&quot;, &quot;f&quot;, &quot;a&quot;], myObj3, 9999);<br/>console.log(new3);</span></p><p class="s10" style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// {d: 22, m: 9, o: {c: &quot;MVD&quot;, i: &quot;UY&quot;, f: {a: 9999}}};</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">const new4 = updateObject(</p><p style="padding-top: 3pt;padding-left: 64pt;text-indent: 2pt;line-height: 158%;text-align: left;">[ H<span class="s163">Q</span><span>H n f » •• j &quot; &quot;       ” 1 ” ]<br/>myObj 3,</span></p><p style="padding-left: 65pt;text-indent: 0pt;line-height: 9pt;text-align: left;">&quot;deep&quot;</p><p style="padding-top: 5pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">) ;</p><p style="padding-top: 3pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">console.log(new4);</p><p class="s10" style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// {d: 22, m: 9, o: {c: &quot;MVD&quot;, i: &quot;UY&quot;, f: {a: 56, j: {k:</p><p class="s10" style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">&quot;deep&quot;}}}};</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 20pt;text-indent: 0pt;text-align: left;">380  <span class="s153">Ensuring Purity - Immutability</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: justify;">Given this pair of functions, we have finally gotten ourselves a way to keep immutability:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l126"><li data-list-text="•"><p style="padding-left: 79pt;text-indent: -13pt;text-align: left;">Objects must be frozen from the beginning</p></li><li data-list-text="•"><p style="padding-top: 7pt;padding-left: 79pt;text-indent: -13pt;text-align: left;">Getting data from objects is done with getByPath ()</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 79pt;text-indent: -13pt;text-align: left;">Setting data is done with updateObj ect (), which internally uses setByPath ()</p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>In this section, we learned how to get and set values from an object in a way that keeps objects<br/>immutable. Let’s now look at a variation of this concept - </span><b>lenses - </b><span>that will allow us to not only get<br/>and   set values but also apply a function to the data.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 53pt;text-indent: 0pt;text-align: left;"><a name="bookmark429">Lenses</a></p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;">There’s another way to get and set values, which goes by the name of <i>optics, </i>and includes <i>lenses </i><span>(which<br/>we’ll study now) </span><i>and prisms </i><span>(which we’ll look at later in this chapter). What are lenses? They are<br/>functional ways of focusing (another optical term!) on a given spot in an object so that we can access<br/>or modify its value in a non-mutating way. In this section, we’ll look at some examples of the usage<br/>of lenses and consider two implementations - first, a simple one based on objects, and then a more<br/>complete one that’s interesting because of some of the techniques we will be using.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s34" style="padding-left: 53pt;text-indent: 0pt;text-align: left;">Working with lenses</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Both implementations will share basic functionality, so let’s start by skipping what lenses are or how<br/>they are built and look at some examples of their usage instead. First, let’s create a sample object that<br/>we will work with - some data about a writer (his name sounds familiar...) and his books:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 73pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>const author = {<br/>user: &quot;fkereki&quot;,<br/>name: {</span></p><p style="padding-left: 85pt;text-indent: 0pt;line-height: 143%;text-align: left;"><span>first: &quot;Federico&quot;,<br/>middle: &quot;&quot;,</span></p><p style="padding-left: 86pt;text-indent: 0pt;line-height: 10pt;text-align: left;">last: &quot;Kereki&quot;,</p><p class="s17" style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">},</p><p style="padding-top: 1pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">books: [</p><p style="padding-top: 4pt;padding-left: 87pt;text-indent: 0pt;text-align: left;">{ name: &quot;Google Web Toolkit&quot;, year: 2010 },</p><p style="padding-top: 4pt;padding-left: 87pt;text-indent: 0pt;text-align: left;">{ name: &quot;Functional Programming&quot;, year: 2017 },</p><p style="padding-top: 4pt;padding-left: 87pt;text-indent: 0pt;text-align: left;">{ name: &quot;Javascript Cookbook&quot;, year: 2018 },</p><p class="s17" style="padding-top: 3pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">] ,</p><p style="padding-top: 5pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">};</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 285pt;text-indent: 0pt;text-align: left;">Going the straightforward JavaScript way     381</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>We shall assume that several functions exist; we’ll see how they are implemented in upcoming sections.<br/>A lens depends on having a getter and a setter for a given attribute, and we can build one by directly<br/>using lens (), or lensProp () for briefer coding. Let’s create a lens for the user attribute:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">const lensl = lens(getField(&quot;user&quot;), setField(&quot;user&quot;));</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>This defines a lens that focuses on the user attribute. Since this is a common operation, it can also<br/>be written more compactly:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">const lensl = lensProp(&quot;user&quot;);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Both these lenses allow us to focus on the user attribute of whatever object we use them with. With<br/>lenses, there are three basic operations, and we’ll follow tradition by using the names that most (if<br/>not all) libraries follow:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l127"><li data-list-text="•"><p style="padding-left: 70pt;text-indent: -13pt;text-align: left;">view (): Used to access the value of an attribute</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">set (): Used to modify the value of an attribute</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">over (): Used to apply a function to an attribute and change its value</p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Let’s assume the functions are curried, as we saw in the previous chapter. So, to access the user<br/>attribute, we can write the following:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">console.log(view(lensl)(author));</p><p class="s10" style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// fkereki</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>The view () function takes a lens as its first parameter. When applied to an object, it produces the<br/>value of whatever the lens focuses on - in our case, the user attribute. Of course, you could apply<br/>sequences of view () functions to get to deeper parts of the object:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 64pt;text-indent: -11pt;line-height: 143%;text-align: left;"><span>console.log(<br/>view(lensProp(&quot;last&quot;))(view(lensProp(&quot;name&quot;))(author))</span></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">) ;</p><p class="s10" style="padding-top: 3pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// Kereki</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 126%;text-align: left;"><span>In this section on optics, we’ll always go with fully curried functions, not only for variety but because<br/>that’s usually how those functions are applied, as you’ll see in any textbook.</span></p><p style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>Instead of writing such a series of view () calls, we’ll compose lenses so that we can focus more deeply<br/>on an object. Let’s take a look at one final example, which shows how we access an array:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 142%;text-align: left;"><span>const lensBooks = lensProp(&quot;books&quot;);<br/>console.log(</span></p><p style="padding-left: 70pt;text-indent: 0pt;text-align: left;">The author wrote</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">382  Ensuring Purity - Immutability</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 86pt;text-indent: -1pt;line-height: 146%;text-align: left;"><span>view(lensBooks)(author).length         +<br/>&quot; book(s)&quot;</span></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;"><a name="bookmark430">) ;</a></p><p class="s10" style="padding-top: 3pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">// The author wrote 3 book(s)</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>In the future, should there be any change in the author structure, a simple change in the lensBooks<br/>definition would be enough to keep the rest of the code unchanged.</span></p><p class="s10" style="padding-top: 3pt;padding-left: 52pt;text-indent: 0pt;text-align: left;"><a name="bookmark431">Z</a><span class="p">                                                    </span>X<a name="bookmark432">&zwnj;</a></p><p class="s10" style="padding-top: 3pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">Lenses elsewhere?</p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;line-height: 115%;text-align: left;">You can also use lenses to access other structures; refer to <i>Question 10.8 </i><span>for a way to use lenses<br/>with arrays, and </span><i>Question 10.9 </i>for how to use lenses so that they work with maps.</p><p style="padding-top: 6pt;padding-left: 61pt;text-indent: -9pt;line-height: 23pt;text-align: left;"><a name="bookmark433"><span>Moving on, the set () function allows us to set the value of the focus of the lens:<br/>console.log</span></a><b>(set(lensl)(&quot;FEFK&quot;)(author));</b></p><p class="s17" style="padding-top: 3pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">/*</p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;"><a name="bookmark434">{</a></p><p style="padding-top: 2pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">user: <b>&#39;FEFK&#39;,</b></p><p style="padding-top: 4pt;padding-left: 73pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>name: { first: &#39;Federico&#39;, middle: &#39; &#39; , last: &#39;Kereki&#39; },<br/>books: [</span></p><p style="padding-left: 87pt;text-indent: 0pt;line-height: 10pt;text-align: left;">{ name: &#39;Google Web Toolkit&#39;, year: 2010 },</p><p style="padding-top: 4pt;padding-left: 87pt;text-indent: 0pt;text-align: left;">{ name: &#39;Functional Programming&#39;, year: 2017 },</p><p style="padding-top: 4pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">{ name: &#39;Javascript Cookbook&#39;, year: 2018 }</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">}</p><p class="s17" style="padding-top: 1pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">*/</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>The result of set () is a new object with a changed value. Using this function in a fully curried<br/>style maybe surprising, but if we used our curry () or partial Curry () function from earlier<br/>chapters, we could write set (lensl, &quot;FEFK&quot;, author) as well.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Using over () is similar in that a new object is returned, but in this case, the value is changed by<br/>applying a mapping function to it:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;line-height: 143%;text-align: left;"><a name="bookmark435"><span>const triple = (x: string): string =&gt; x + x + x;<br/>const newAuthor = </span></a><b>over(lensl)(triple)(author);</b>console.log(newAuthor);</p><p class="s17" style="padding-left: 62pt;text-indent: 0pt;line-height: 12pt;text-align: left;">/*</p><p style="padding-top: 4pt;padding-left: 63pt;text-indent: 0pt;text-align: left;">{</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 285pt;text-indent: 0pt;text-align: left;">Going the straightforward JavaScript way     383</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 64pt;text-indent: 0pt;text-align: left;"><a name="bookmark436">user: </a><b>&#39;fkerekifkerekifkereki&#39;,</b></p><p style="padding-top: 4pt;padding-left: 64pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>name:   {   first:   &#39;Federico&#39;,   middle:   &#39;   &#39;   ,   last:   &#39;Kereki&#39;   },<br/>books: [</span></p><p style="padding-left: 77pt;text-indent: 0pt;line-height: 10pt;text-align: left;">{ name: &#39;Google Web Toolkit&#39;, year: 2010 },</p><p style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">{ name: &#39;Functional Programming&#39;, year: 2017 },</p><p style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">{   name:   &#39;Javascript   Cookbook&#39;,   year:   2018   }</p><p style="padding-top: 5pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">]</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s158" style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">*/</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>A  fundamental  question  is,  why  is  user  equal  to  &quot;  f  kerekif  kerekif  kereki  &quot;  and not<br/>&quot; FEFKFEFKFEFK&quot; ? Our lens does not modify an object when using the setter but instead provides<br/>a new one, so we’re applying triple () to the original objects user attribute.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>There are more functions you can do with lenses, but we’ll just go with these three for now. (Here’s a<br/>suggestion - take a look at </span><i>Question 10.7 </i><span>for an interesting idea on how to use lenses to access virtual<br/>attributes that don’t actually exist in an object.)</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>To finish this section, I’d recommend looking at some third-party optics libraries (github. com/<br/>stoef  fel/awesome-fp-  j  s#lenses  and  tinyurl.  com/j  slenses  have  several  suggestions)<br/>to get a glimpse into all the available functionality. Now that we have an idea of what to expect when<br/>using lenses, let’s learn how to implement them.</span></p><p class="s34" style="padding-top: 8pt;padding-left: 43pt;text-indent: 0pt;text-align: justify;">Implementing lenses with objects</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>The simplest way to implement a lens is by representing it with an object with just two properties - a<br/>getter and a setter. In this case, we’d have something like this:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// lensesWithObjects.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">const getField =</p><p style="padding-top: 4pt;padding-left: 66pt;text-indent: -1pt;line-height: 144%;text-align: left;"><span>&lt;0 extends 0BJ&gt;(attr: string) =&gt;<br/>(obj: O) =&gt;</span></p><p style="padding-left: 76pt;text-indent: 0pt;text-align: left;">obj [attr];</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">const setField =</p><p style="padding-top: 4pt;padding-left: 66pt;text-indent: -1pt;line-height: 143%;text-align: left;"><span>&lt;0 extends 0BJ&gt;(attr: string) =&gt;<br/>(value: any) =&gt;</span></p><p style="padding-left: 66pt;text-indent: 0pt;text-align: left;">(obj: O): O =&gt; ({ ...obj, [attr]: value });</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">384  Ensuring Purity - Immutability</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>We’ve already seen similar getField () and setField () functions; the former gets a specific<br/>attribute from an object, and the latter returns a new object with a single changed attribute. We can<br/>now define our lens:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">type GET&lt;0 extends OBJ&gt; = ReturnType&lt;typeof getField&lt;O&gt;&gt;;</p><p style="padding-left: 61pt;text-indent: 0pt;line-height: 30pt;text-align: left;"><span>type SET&lt;0 extends OBJ&gt; = ReturnType&lt;typeof setField&lt;0&gt;&gt;;<br/>const lens = &lt;0 extends 0BJ&gt;(</span></p><p style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;line-height: 142%;text-align: left;"><span>getter: GET&lt;0&gt;,<br/>setter: SET&lt;0&gt;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 74pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>getter,<br/>setter,</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 6pt;padding-left: 73pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>const lens = (getter: GET, setter: SET): LENS =&gt; ({<br/>getter,</span></p><p style="padding-left: 74pt;text-indent: 0pt;line-height: 10pt;text-align: left;">setter,</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 74pt;text-indent: -12pt;line-height: 142%;text-align: left;"><span>const lensProp = (attr: string) =&gt;<br/>lens((getField as any)(attr), setField(attr));</span></p><p style="padding-top: 8pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>This is easy to understand - given a getter and a setter, lens () creates an object with those two<br/>attributes,  and  lensProp  ()  creates  a  getter/setter  pair  by  using  getField  ()  and  setField  ()<br/>with lens (), which is very straightforward. Now that we have our lens, how do we implement the<br/>three basic functions we saw in the previous section? Viewing an attribute requires applying the getter;<br/>to maintain a curried style, let’s do currying by hand:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="padding-left: 61pt;text-indent: 0pt;line-height: 30pt;text-align: left;"><span>type LENS&lt;0 extends 0BJ&gt; = ReturnType&lt;typeof lens&lt;0&gt;&gt;;<br/>const view =</span></p><p style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">&lt;0 extends 0BJ&gt;(someLens: LENS&lt;0&gt;)</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 285pt;text-indent: 0pt;text-align: left;">Going the straightforward JavaScript way     385</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 77pt;text-indent: -10pt;line-height: 144%;text-align: left;"><span>(someObj: O) =&gt;<br/>someLens.getter(someObj);</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 192%;text-align: left;"><span>The generic LENS&lt; &gt; type is the type of whatever the lens () function returns.<br/>Similarly, setting an attribute is a matter of applying the setter:</span></p><p class="s9" style="padding-top: 3pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">I/ <span class="p">continued...</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">const set =</p><p style="padding-top: 4pt;padding-left: 67pt;text-indent: -2pt;line-height: 144%;text-align: left;"><span>&lt;0 extends OBJ&gt;(someLens: LENS&lt;0&gt;) =&gt;<br/>(newVal: any) = &gt;</span></p><p style="padding-left: 77pt;text-indent: -9pt;line-height: 144%;text-align: left;"><span>(someObj: O) =&gt;<br/>someLens.setter(newVal)(someObj);</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;">Finally, applying a mapping function to an attribute is a <i>two-for-one </i><span>operation - we use the getter to<br/>get the current value of the attribute, we apply the function to it, and we use the setter to store the<br/>calculated result:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">const over =</p><p style="padding-top: 4pt;padding-left: 67pt;text-indent: -2pt;line-height: 142%;text-align: left;"><span>&lt;0 extends OBJ&gt;(someLens: LENS&lt;0&gt;) =&gt;<br/>(mapFn: (arg: any) =&gt; any) =&gt;</span></p><p style="padding-left: 77pt;text-indent: -9pt;line-height: 143%;text-align: left;"><span>(someObj: O) =&gt;<br/>someLens.setter(mapFn(someLens.getter(someObj)))(</span></p><p style="padding-left: 89pt;text-indent: 0pt;text-align: left;">someObj</p><p style="padding-top: 5pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: left;"><span>This needs to be studied carefully. We use the lens’s getter () function to get some attribute from the<br/>input object, we apply the mapping function to the obtained value, and we use the lens’s setter ()<br/>function to produce a new object with the changed attribute.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: left;"><span>Now that we can do all three operations, we have working lenses! What about composition? Lenses<br/>have a peculiar characteristic - they’re composed backward, left to right, so you start with the most<br/>generic and end with the most specific. That certainly goes against intuition; we’ll learn about this in<br/>more detail in the next section, but for now, we’ll keep with tradition:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">const composeTwoLenses = &lt;0 extends 0BJ&gt;(</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 20pt;text-indent: 0pt;text-align: left;">386  <span class="s153">Ensuring Purity - Immutability</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 74pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>lensl: LENS&lt;0&gt;,<br/>lens2: LENS&lt;0&gt;</span></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">) =&gt; ({</p><p style="padding-top: 3pt;padding-left: 74pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>getter: (obj: 0) =&gt; lens2.getter(lensl.getter(obj)),<br/>setter: (newVal: any) =&gt; (obj: 0) =&gt;</span></p><p style="padding-left: 97pt;text-indent: -11pt;line-height: 143%;text-align: left;"><span>lensl.setter(lens2.setter(newVal)(lensl.getter(obj)))(<br/>obj</span></p><p style="padding-left: 86pt;text-indent: 0pt;text-align: left;">) ,</p><p style="padding-top: 5pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">});</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>The code is sort of impressive but not too hard to understand. The getter for the composition of two<br/>lenses is the result of using the first lens’s getter and then applying the second lens’s getter to that<br/>result. The setter for the composition is a tad more complex, but follows along the same lines; can you<br/>see how it works? Now, we can compose lenses easily; let’s start with an invented nonsensical object:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 73pt;text-indent: -12pt;line-height: 144%;text-align: left;"><span>const deepObject = {<br/>a:  1,</span></p><p style="padding-left: 73pt;text-indent: 0pt;line-height: 10pt;text-align: left;">b:  2,</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s101" style="padding-left: 73pt;text-indent: 0pt;text-align: left;">C: {</p><p style="padding-top: 5pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">d:  3 ,</p><p style="padding-top: 4pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">e:  {</p><p style="padding-top: 4pt;padding-left: 98pt;text-indent: 0pt;text-align: left;">f:  6,</p><p style="padding-top: 5pt;padding-left: 97pt;text-indent: 0pt;line-height: 137%;text-align: left;"><span>g:  { i: 9, j: { k: 11 } },<br/>h:  8,</span></p><p style="padding-top: 2pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">b</p><p style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">b</p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">};</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">Now, we can define a few lenses:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;line-height: 143%;text-align: left;"><span>const IC = lensProp(&quot;c&quot;);<br/>const IE = lensProp (&quot;e&quot;) ;<br/>const 1G = lensProp(&quot;g&quot;);<br/>const 1J = lensProp(&quot;j&quot;);<br/>const IK = lensProp(&quot;k&quot;);</span></p><p style="padding-top: 8pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">We can try composing our new lens in a couple of ways, just for variety, to check that everything works:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>const 1JK = composeTwoLenses(1J, IK);<br/>const 1GJK = composeTwoLenses(1G, 1JK) ;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 285pt;text-indent: 0pt;text-align: left;">Going the straightforward JavaScript way     387</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>const 1EGJK = composeTwoLenses(IE, 1GJK);<br/>const 1CEGJK1 = composeTwoLenses(IC, 1EGJK);<br/>console.log(view(1CEGJK1)(deepObject));</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;line-height: 142%;text-align: left;"><span>const ICE = composeTwoLenses(IC, IE);<br/>const 1CEG = composeTwoLenses(ICE, 1G) ;</span></p><p style="padding-left: 53pt;text-indent: 0pt;line-height: 143%;text-align: left;"><span>const 1CEGJ = composeTwoLenses(1CEG, 1J);<br/>const 1CEGJK2 = composeTwoLenses(1CEGJ, IK);<br/>console.log(view(1CEGJK2)(deepObject));</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 53pt;text-indent: 0pt;text-align: left;">/*</p><p style="padding-top: 2pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">11 both times</p><p class="s17" style="padding-top: 3pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">*/</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>With 1CEGJ1, we composed some lenses, starting with the latter ones. With 1CEGJ2, we started with<br/>the lenses at the beginning, but the results are the same. Now, let’s try setting some values. We want<br/>to get down to the k attribute and set it to 6 0. We can do this by using the same lens we just applied:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">const setTo60 = set(lCEGJKl)(60)(deepObject);</p><p class="s158" style="padding-top: 3pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">/*</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 64pt;text-indent: 0pt;text-align: left;">a : 1,</p><p style="padding-top: 4pt;padding-left: 64pt;text-indent: 0pt;text-align: left;">b:  2,</p><p style="padding-top: 4pt;padding-left: 64pt;text-indent: 0pt;text-align: left;">c:  {</p><p style="padding-top: 4pt;text-indent: 0pt;text-align: right;">d:  3,</p><p style="padding-top: 4pt;text-indent: 0pt;text-align: right;">e:  {</p><p style="padding-top: 4pt;text-indent: 0pt;text-align: right;">f : 6,</p><p style="padding-top: 5pt;padding-left: 88pt;text-indent: 0pt;line-height: 137%;text-align: left;"><span>g:  { i: 9, j: { k: 60 } },<br/>h:  8,</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 53pt;text-indent: 0pt;text-align: left;">*/</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>The composed lens worked perfectly, and the value was changed. (Also, a new object was returned;<br/>the original is unmodified, as we wanted.) To finish, let’s verify that we can use over () with our lens<br/>and try to duplicate the k value so that it becomes 22. Just for variety, let’s use the other composed<br/>lens, even though we know that it works in the same way:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 20pt;text-indent: 0pt;text-align: left;">388  <span class="s153">Ensuring Purity - Immutability</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;text-align: left;">const setToDouble = over(1CEGJK2)((x) =&gt; x * 2)(deepObject);</p><p class="s17" style="padding-top: 3pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">/*</p><p style="padding-top: 4pt;padding-left: 63pt;text-indent: 0pt;text-align: left;">{</p><p style="padding-top: 2pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">a:  1,</p><p style="padding-top: 4pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">b:  2,</p><p style="padding-top: 4pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">c:  {</p><p style="padding-top: 4pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">d:  3,</p><p style="padding-top: 4pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">e:  {</p><p style="padding-top: 4pt;padding-left: 98pt;text-indent: 0pt;text-align: left;">f:  6,</p><p style="padding-top: 4pt;padding-left: 97pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>g:  { i: 9, j: { k: 22 } },<br/>h:  8,</span></p><p style="padding-top: 2pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">b</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">};</p><p class="s17" style="padding-top: 1pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">*/</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Now, we have learned how to implement lenses in a simple fashion. However, let’s consider a different<br/>way of achieving the same objective by using actual functions to represent a lens. This will allow us to<br/>do composition in the standard way, without needing any special lens function.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s34" style="padding-left: 52pt;text-indent: 0pt;text-align: justify;">Implementing lenses with functions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>The previous implementation of lenses with objects works well, but we want to look at a different<br/>way of doing things that will let us work with more advanced functional ideas. This will involve some<br/>concepts we’U be analyzing in more detail in </span><i>Chapter 12, Building Better Containers, </i><span>but here, we’ll use<br/>just what we need so that you don’t have to go and read that chapter now! Our lenses will work the<br/>same way the preceding ones did, except that since they will be functions, we’ll be able to compose<br/>them with no special composing code.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>What’s the key concept here? A lens will be a function, based on a getter and a setter pair, that will<br/>construct a </span><i>container </i><span>(actually an object, but let’s go with the container name) with a value attribute<br/>and a map method (in </span><i>Chapter 12, Building Better Containers, </i>well see that this is a <i>functor, </i><span>but you<br/>don’t need to know that now). By having specific mapping methods, well implement our view (),<br/>set (), and over () functions.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;text-align: justify;">Our lens () function is as follows. Well explain the details of this later:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// lensesWithFunctions.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">const lens =</p><p style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">&lt;0 extends 0BJ&gt;(getter: GET&lt;0&gt;, setter: SET&lt;0&gt;) =&gt;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 285pt;text-indent: 0pt;text-align: left;">Going the straightforward JavaScript way     389</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 66pt;text-indent: 0pt;text-align: left;">(fn: FN) =&gt;</p><p style="padding-top: 4pt;padding-left: 77pt;text-indent: -10pt;line-height: 144%;text-align: left;"><span>(obj: 0) =&gt;<br/>fn(getter(obj)).map((value: any) =&gt;</span></p><p style="padding-left: 43pt;text-indent: 45pt;text-align: left;">setter(value)(obj));</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: left;">Lets consider its parameters:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l128"><li data-list-text="•"><p style="padding-left: 70pt;text-indent: -13pt;line-height: 9pt;text-align: left;">The getter and setter parameters are the same as before.</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;line-height: 123%;text-align: left;"><span>The f n function is the “magic sauce” that makes everything work; depending on what we want<br/>to do with the lens, we’ll provide a specific function. There’ll be more on this later!</span></p></li><li data-list-text="•"><p style="padding-top: 5pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">The obj parameter is the object we want to apply the lens to.</p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>Let’s code our view () function. For this, we’ll need an auxiliary class, Constant, that, given a value,<br/>v, produces a container with that value and a map function that returns the very same container:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 64pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>class Constant&lt;V&gt; {<br/>private value: V;<br/>map: FN;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 76pt;text-indent: -12pt;line-height: 144%;text-align: left;"><span>constructor(v: V) {<br/>this.value = v;<br/>this.map  = () =&gt; this;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: left;">With this, we can now code view ():</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">const view =</p><p style="padding-top: 4pt;padding-left: 66pt;text-indent: -1pt;line-height: 143%;text-align: left;"><span>&lt;0 extends OBJ, V&gt;(someLens: LENS&lt;0&gt;) =&gt;<br/>(obj: 0) =&gt;</span></p><p style="padding-left: 77pt;text-indent: 0pt;line-height: 10pt;text-align: left;">someLens(<b>(x: V) =&gt; new Constant(x))</b>(obj).value;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">const user = view(lensProp(&quot;user&quot;), author);</p><p class="s17" style="padding-top: 3pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">/*</p><p style="padding-top: 2pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">fkereki</p><p class="s17" style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">*/</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">390  Ensuring Purity - Immutability</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">What happens here? Let’s follow this step by step; it’s a bit tricky!</p><p style="text-indent: 0pt;text-align: left;"><br/></p><ol id="l129"><li data-list-text="1."><p style="padding-left: 79pt;text-indent: -17pt;text-align: left;">We use lensProp () to create a lens focusing on the user attribute.</p></li><li data-list-text="2."><p style="padding-top: 6pt;padding-left: 78pt;text-indent: -17pt;text-align: left;">Our view () function passes the constant-building function to lens ().</p></li><li data-list-text="3."><p style="padding-top: 6pt;padding-left: 79pt;text-indent: -17pt;text-align: left;">Our lens () function uses the getter to access the user attribute in the author object.</p></li><li data-list-text="4."><p style="padding-top: 6pt;padding-left: 78pt;text-indent: -17pt;text-align: left;">Then, the value we receive is used to create a constant container.</p></li><li data-list-text="5."><p style="padding-top: 6pt;padding-left: 79pt;text-indent: -17pt;text-align: left;">The map () method is invoked, which returns the very same container.</p></li><li data-list-text="6."><p style="padding-top: 6pt;padding-left: 79pt;text-indent: -18pt;line-height: 123%;text-align: left;"><span>The value attribute of the container is accessed, and that’s the value that the getter retrieved<br/>in </span><i>step 3. </i>Wow!</p></li></ol><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>With that under our belt, let’s move on to set () and over (), which will require a different auxiliary<br/>function to create a container whose value may vary:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 73pt;text-indent: -11pt;line-height: 144%;text-align: justify;"><span>class Variable&lt;V&gt; {<br/>private value: V;<br/>map: FN;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 85pt;text-indent: -12pt;line-height: 144%;text-align: left;"><span>constructor(v: V) {<br/>this.value = v;</span></p><p style="padding-left: 85pt;text-indent: 0pt;text-align: left;">this.map = (fn) =&gt; new Variable(fn(v));</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: left;"><span>In this case (as opposed to Constant objects), the map () method really does something - when<br/>provided with a function, it applies it to the value of the container and returns a new Variable<br/>object, with the resulting value. The set () function can be implemented now:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">const set =</p><p style="padding-top: 4pt;padding-left: 76pt;text-indent: -1pt;line-height: 144%;text-align: left;"><span>&lt;0 extends OBJ, V&gt;(someLens: LENS&lt;0&gt;) =&gt;<br/>(newVal: V) =&gt;</span></p><p style="padding-left: 76pt;text-indent: 0pt;line-height: 10pt;text-align: left;">(obj: 0) =&gt;</p><p style="padding-top: 4pt;padding-left: 61pt;text-indent: 24pt;line-height: 287%;text-align: left;">someLens(() =&gt; <b>new Variable(newVal))</b><span>(obj).value;<br/>const changedUser = set(lensProp(&quot;user&quot;))(&quot;FEFK&quot;)(author);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 285pt;text-indent: 0pt;text-align: left;">Going the straightforward JavaScript way     391</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">/*</p><p class="s17" style="padding-top: 3pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">{</p><p class="s10" style="padding-top: 2pt;padding-left: 64pt;text-indent: 0pt;text-align: left;">user: &#39;FEFK<span class="s229">1</span>,</p><p style="padding-top: 4pt;padding-left: 64pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>name:   {   first:   &#39;Federico&#39;,   middle:   &#39;   &#39;   ,   last:   &#39;Kereki&#39;   },<br/>books: [</span></p><p style="padding-left: 77pt;text-indent: 0pt;text-align: left;">{ name: &#39;Google Web Toolkit&#39;, year: 2010 },</p><p style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">{ name: &#39;Functional Programming&#39;, year: 2017 },</p><p style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">{ name: &#39;Javascript Cookbook&#39;, year: 2018 }</p><p style="padding-top: 5pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">]</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s158" style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">*/</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>In this case, when the lens invokes the container’s map () method, it will produce a new container with<br/>a new value, which makes all the difference. To understand how this works, follow the same six steps<br/>we saw for get () - the only difference will be in </span><i>step </i>5, where a new, different container is produced.</p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Now that we’ve survived this (tricky indeed!) code, the over () function is simple, and the only<br/>difference is that instead of mapping to a given value, you use the mapping mapf n function provided<br/>to compute the new value for the container:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">const over =</p><p style="padding-top: 4pt;padding-left: 67pt;text-indent: -2pt;line-height: 144%;text-align: left;"><span>&lt;0 extends OBJ, V&gt;(someLens: LENS&lt;O&gt;) =&gt;<br/>(mapfn: FN) =&gt;</span></p><p style="padding-left: 66pt;text-indent: 0pt;line-height: 10pt;text-align: left;">(obj: O) =&gt;</p><p style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">someLens((x: <b>V) =&gt; new Variable(mapfn(x)))</b>(obj).value;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">const newAuthor = over(lensProp(&quot;user&quot;))(triple)(author);</p><p style="padding-top: 5pt;padding-left: 53pt;text-indent: 0pt;text-align: left;"><a name="bookmark437">/*</a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-top: 6pt;padding-left: 64pt;text-indent: 0pt;text-align: left;">user: &#39;fkerekifkerekifkereki&#39;,</p><p style="padding-top: 4pt;padding-left: 64pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>name:   {   first:   &#39;Federico&#39;,   middle:   &#39;   &#39;   ,   last:   &#39;Kereki&#39;   },<br/>books: [</span></p><p style="padding-left: 77pt;text-indent: 0pt;line-height: 10pt;text-align: left;">{ name: &#39;Google Web Toolkit&#39;, year: 2010 },</p><p style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">{ name: &#39;Functional Programming&#39;, year: 2017 },</p><p style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">{ name: &#39;Javascript Cookbook&#39;, year: 2018 }</p><p style="padding-top: 5pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">]</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">392  Ensuring Purity - Immutability</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 62pt;text-indent: 0pt;text-align: left;">}</p><p class="s17" style="padding-top: 1pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">*/</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>As you can see, the difference between set () and over () is that, in the former case, you provide a<br/>value to replace the original one, while in the latter case, you provide a function to calculate the new<br/>value. Other than that, both are similar.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;text-align: justify;">To finish, let’s verify that compose () can be applied to our functor-based lenses:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 61pt;text-indent: 0pt;text-align: left;"><a name="bookmark438">const lastName = view)</a></p><p class="s10" style="padding-top: 4pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">compose(lensProp(&quot;name&quot;), lensProp(&quot;last&quot;))</p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">)(author);</p><p class="s17" style="padding-top: 3pt;padding-left: 62pt;text-indent: 0pt;text-align: left;"><a name="bookmark439">/*</a></p><p class="s10" style="padding-top: 2pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">Kereki</p><p class="s17" style="padding-top: 3pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">*/</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Here, we created two individual lenses for name and last, and we composed them with the very<br/>same compose () function that we developed back in </span><i>Chapter 8, Connecting Functions. </i><span>Using this<br/>composite lens, we focused on the authors last name without any problem, so everything worked<br/>as expected.</span></p><p class="s10" style="padding-top: 3pt;padding-left: 52pt;text-indent: 0pt;text-align: justify;"><a name="bookmark440">Z</a><span class="p">                                                    </span>X<a name="bookmark441">&zwnj;</a></p><p class="s10" style="padding-top: 3pt;padding-left: 65pt;text-indent: 0pt;text-align: justify;">Wrong direction?</p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;text-align: justify;">It seems to go against logic that lenses should be composed from left to right; this appears to</p><p class="s240" style="padding-top: 1pt;padding-left: 65pt;text-indent: -12pt;line-height: 118%;text-align: justify;">, be backward This is something that troubles developers, and if you google for an explanation,<span class="p"><br/>you’ll find many. To answer this question on your own, I suggest spelling out how compose ()<br/>works in full - two functions will be enough - and then substitute the definitions of lenses;<br/>you’ll see why and how everything works out.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;text-align: justify;">Now that we’ve looked at lenses, we can move on and look at <b>prisms, </b>another optics tool.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 53pt;text-indent: 0pt;text-align: left;"><a name="bookmark442">Prisms</a></p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>As we saw in the previous section, lenses are useful for working with product types. However, prisms<br/>are useful for working with </span><i>sum </i><span>types. But what are they? (We’ll look at products and unions in more<br/>detail in the last chapter of the book.) Whereas a product type is always built out of the same options,<br/>such as an object from a class, a sum type will likely have different structures - extra or missing<br/>attributes, for example. When you use a lens, you assume that the object you’ll be applying it to has<br/>a known structure with no variations, but what do you use if the object has different structures? The<br/>answer is prisms. Let’s look at how they are used first; then, we’ll examine their implementation.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 285pt;text-indent: 0pt;text-align: left;">Going the straightforward JavaScript way     393</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s34" style="padding-top: 8pt;padding-left: 44pt;text-indent: 0pt;text-align: left;">Working with prisms</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>Working with prisms is similar to using lenses, except for what happens when an attribute is not<br/>present. Lets take a look at an example from the previous section:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 64pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>const author = {<br/>user: &quot;fkereki&quot;,<br/>name: {</span></p><p style="padding-left: 76pt;text-indent: 1pt;line-height: 144%;text-align: left;"><span>first: &quot;Federico&quot;,<br/>middle:</span></p><p style="padding-left: 77pt;text-indent: 0pt;line-height: 10pt;text-align: left;">last: &quot;Kereki&quot;,</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 8pt;padding-left: 64pt;text-indent: 0pt;text-align: left;">books: [</p><p style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">{ name: &quot;Google Web Toolkit&quot;, year: 2010 },</p><p style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">{ name: &quot;Functional Programming&quot;, year: 2017 },</p><p style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">{ name: &quot;Javascript Cookbook&quot;, year: 2018 },</p><p style="padding-top: 5pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">] ,</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>If we wanted to access the user attribute using prisms, we would write something like the following<br/>(and don’t worry about the details now):</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>const pUser = prismProp(&quot;user&quot;);<br/>console.log(preview(pUser, author).toString() ) ;</span></p><p class="s158" style="padding-left: 53pt;text-indent: 0pt;line-height: 12pt;text-align: left;">/*</p><p style="padding-top: 2pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">fkereki</p><p class="s158" style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">*/</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>Here, we define a prism using a prismProp () function, which parallels our previous lensProp ().<br/>Then, we use the prism with the preview () function, which is analogous to get () with lenses,</span></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>and the result is the same as if we had used lenses - no surprises there. What would have happened<br/>if we had asked for a non-existing pseudonym attribute? Let’s see:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">const pPseudonym = prismProp(&quot;pseudonym&quot;);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">console.log(preview(pPseudonym, author).toString());</p><p style="padding-top: 5pt;padding-left: 52pt;text-indent: 0pt;line-height: 130%;text-align: left;"><span>/*<br/>undefined</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">394  Ensuring Purity - Immutability</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>So far, we may not see any differences, but let’s see what happens if we try to compose lenses or prisms<br/>with several missing attributes. Say you wanted to access a (missing!) ps eudonym .usedSince<br/>attribute with lenses, without taking precautions and checking that the attributes exist. Here, you<br/>would get the following output:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;line-height: 146%;text-align: left;"><span>const IPseudonym = lensProp(&quot;pseudonym&quot;);<br/>const lUsedSince = lensProp(&quot;usedSince&quot;);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;text-align: left;">console.log(</p><p style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">&quot;PSEUDONYM, USED SINCE&quot;,</p><p style="padding-top: 4pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">view(compose(IPseudonym, lUsedSince))(author)</p><p style="padding-top: 5pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">) ;</p><p class="s17" style="padding-top: 3pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">/*</p><p class="s10" style="padding-top: 2pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">TypeError: Cannot read property &#39;usedSince&#39; of undefined</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-top: 7pt;padding-left: 63pt;text-indent: 0pt;text-align: left;">. many more error lines, snipped out</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-top: 7pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">*/</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>On the other hand, since prisms already take missing values into account, this would cause no problems,<br/>and we’d get an undefined result; that’s why preview () is sometimes called getOpt ional ():</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>const pUsedSince = prismProp(&quot;usedSince&quot;);<br/>console.log(</span></p><p style="padding-left: 85pt;text-indent: -12pt;line-height: 144%;text-align: left;"><span>preview(compose(pPseudonym, pUsedSince))(<br/>author</span></p><p style="padding-left: 74pt;text-indent: 0pt;text-align: left;">).toString()</p><p style="padding-top: 5pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">) ;</p><p class="s17" style="padding-top: 3pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">/*</p><p class="s10" style="padding-top: 2pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">undefined</p><p class="s17" style="padding-top: 3pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">*/</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>What happens if we want to set a value? The analogous function to set () is review (); let’s look at<br/>how it would work. The idea is that whatever attribute we specify will be set if, and only if, the attribute<br/>already exists. So, if we attempt to change the user. name attribute, this will work:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 73pt;text-indent: -12pt;line-height: 144%;text-align: left;"><span>const fullAuthor2 = review(<br/>compose(prismProp(&quot;name&quot;), prismProp(&quot;first&quot;)),<br/>&quot;FREDERICK&quot;,</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 285pt;text-indent: 0pt;text-align: left;">Going the straightforward JavaScript way     395</p><p style="padding-top: 22pt;padding-left: 64pt;text-indent: 0pt;text-align: left;">author</p><p style="padding-top: 5pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>However, if we try to modify the (non-existent) pseudonym attribute, the original, unchanged<br/>object will be returned:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">const fullAuthor3 = review(pPseudonym, &quot;NEW ALIAS&quot;, author);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// returns author, unchanged</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>So, using prisms takes care of all possible missing or optional fields. How do we implement this new<br/>optics type? New names are used (preview () and review () instead of get () and set ()), but<br/>that difference is minor. Let’s take a look.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s34" style="padding-left: 43pt;text-indent: 0pt;text-align: justify;">Implementing prisms</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>How do we implement prisms? We will take our cue from our lens implementation and make a few<br/>changes. When getting an attribute, we must check whether the object we are processing is not nul 1<br/>or undefined and whether the attribute we want is in the object. We can make do with small changes<br/>to our original get Fie Id () function:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// prisms.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">const getFieldP =</p><p style="padding-top: 4pt;padding-left: 66pt;text-indent: -1pt;line-height: 144%;text-align: left;"><span>&lt;0 extends 0BJ&gt;(attr: string) =&gt;<br/>(obj: 0) =&gt;</span></p><p class="s10" style="padding-left: 76pt;text-indent: 0pt;text-align: left;">obj &amp;&amp; attr in obj ? obj[attr] : undefined;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>Here, were checking for the existence of the object and the attribute - if everything’s okay, we return<br/>obj [attr]; otherwise, we return undefined. The changes for set Fie Id () are very similar:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s9" style="padding-left: 53pt;text-indent: 0pt;text-align: left;">11 <span class="p">continued...</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">const setFieldP =</p><p style="padding-top: 4pt;padding-left: 66pt;text-indent: -1pt;line-height: 143%;text-align: left;"><span>&lt;0 extends 0BJ&gt;(attr: string) =&gt;<br/>(value: any) =&gt;</span></p><p style="padding-left: 66pt;text-indent: 0pt;text-align: left;">(obj : 0) : 0 =&gt;</p><p class="s10" style="padding-top: 4pt;padding-left: 76pt;text-indent: 0pt;text-align: left;">obj &amp;&amp; attr in obj</p><p class="s10" style="padding-top: 4pt;padding-left: 89pt;text-indent: 0pt;text-align: left;">? { ...obj, [attr]: value }</p><p class="s10" style="padding-top: 4pt;padding-left: 90pt;text-indent: 0pt;text-align: left;">: { ...obj };</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">396  Ensuring Purity - Immutability</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>If the object and the attribute both exist, we return a new object by changing the attribute’s value;<br/>otherwise, we return a copy of the object. That’s all there is to it! Defining the other functions is directly<br/>based                                                     on lens (), lensProp (), and so on, so we’ll skip that.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: justify;"><span>Now that we’ve learned how to access objects in functional ways, let’s analyze persistent data structures<br/>that can be modified very efficiently without the need for a full copy of the original object.</span></p><p class="s6" style="padding-top: 8pt;padding-left: 52pt;text-indent: 0pt;text-align: justify;"><a name="bookmark443">Creating persistent data structures</a></p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>If you want to change something in a data structure and you just go and change it, your code will be<br/>full of side effects. On the other hand, copying complete structures every time is a waste of time and<br/>space. There’s a middle ground to this that has to do with persistent data structures, which, if handled<br/>correctly, let you apply changes while creating new structures efficiently.</span></p><p style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;line-height: 126%;text-align: justify;"><span>Given that there are many possible data structures you could work with, let’s just take a look at a<br/>few examples:</span></p><ul id="l130"><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 79pt;text-indent: -13pt;text-align: left;">Working with lists, one of the simplest data structures</p></li><li data-list-text="•"><p style="padding-top: 7pt;padding-left: 79pt;text-indent: -13pt;text-align: left;">Working with objects, a very common necessity in JavaScript programs</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 52pt;text-indent: 13pt;line-height: 211%;text-align: left;"><span>Dealing with arrays, which will prove to be harder to work with<br/>Let’s get started!</span></p></li></ul><p class="s12" style="padding-top: 2pt;padding-left: 52pt;text-indent: 0pt;text-align: justify;"><a name="bookmark444">Working with lists</a></p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Let’s consider a simple procedure - suppose you have a list and want to add a new element to it. How<br/>would you do this? Here, we can assume that each node is a NodeList object:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// lists.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 73pt;text-indent: -11pt;line-height: 146%;text-align: left;"><span>class ListNode&lt;T&gt; {<br/>value: T;</span></p><p style="padding-left: 73pt;text-indent: 0pt;line-height: 10pt;text-align: left;">next: ListNode&lt;T&gt; | null;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 85pt;text-indent: -12pt;line-height: 143%;text-align: left;"><span>constructor(value: any, next = null) {<br/>this.value = value;</span></p><p style="padding-left: 85pt;text-indent: 0pt;text-align: left;">this.next = next;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 310pt;text-indent: 0pt;text-align: left;">Creating persistent data structures     397</p><p style="padding-top: 22pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>A possible list would be as shown in the following figure - a list variable would point to the first<br/>element. Look at the following diagram; can you tell what is missing in the list, and where?</span></p><p class="s10" style="padding-top: 3pt;padding-left: 96pt;text-indent: 0pt;text-align: left;"><span><img width="91" height="29" alt="image" src="Image_050.gif"/></span><span class="s214">    </span>B -------- ► F --------• A      C<span class="p">    </span>► E</p><p class="s164" style="padding-top: 13pt;padding-left: 44pt;text-indent: 0pt;text-align: center;">Figure 10.1 -The initial list</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 5pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>If you wanted to add D between B and F (the sample list represents a concept that musicians will<br/>understand, the </span><i>Circle of Thirds, </i><span>but with the D note missing), the simplest solution would be to add<br/>a new node and change an existing one. This would result in the following:</span></p><p class="s214" style="padding-top: 4pt;padding-left: 96pt;text-indent: 0pt;text-align: left;"><span><img width="130" height="26" alt="image" src="Image_051.gif"/></span>       <span class="s10">► F   * A    -* C   ► E</span></p><p class="s10" style="padding-top: 9pt;text-indent: 0pt;text-align: center;">*i D</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-left: 47pt;text-indent: 0pt;text-align: justify;">Figure 10.2  -The list now has a new element - we had to modify an existing one to perform the addition</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 5pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>However, working in this way is obviously non-functional, and we are clearly modifying data. There is<br/>a different way of working - creating a persistent data structure in which all the alterations (insertions,<br/>deletions, and modifications) are done separately, being careful not to modify existing data. On the<br/>other hand, if some parts of the structure can be reused, this is done to gain performance. Doing a<br/>persistent update would return a new list, with some nodes that are duplicates of some previous ones<br/>but                                                  no changes whatsoever to the original list. This can be seen in the following diagram:</span></p><p class="s186" style="padding-top: 3pt;padding-left: 97pt;text-indent: 0pt;line-height: 9pt;text-align: left;">old</p><p style="text-indent: 0pt;text-align: left;"><span><img width="99" height="24" alt="image" src="Image_052.gif"/></span></p><p class="s186" style="padding-left: 97pt;text-indent: 0pt;line-height: 9pt;text-align: left;">list</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 140pt;text-indent: 0pt;text-align: left;"><span><img width="34" height="25" alt="image" src="Image_053.gif"/></span></p><p class="s186" style="padding-top: 1pt;padding-left: 101pt;text-indent: 0pt;line-height: 94%;text-align: left;"><span>new<br/>list</span></p><p class="s160" style="padding-top: 4pt;padding-left: 28pt;text-indent: 0pt;text-align: left;">F -------- A ------------ -I C<span class="s26">    </span>►! E</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s241" style="padding-left: 28pt;text-indent: 0pt;text-align: left;">D</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 168pt;text-indent: -32pt;line-height: 152%;text-align: left;"><span>Figure 10.3  -The dotted elements show the newly returned list,<br/>which shares some elements with the old one</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: justify;"><span>Updating a structure this way requires duplicating some elements to avoid modifying the original<br/>structure, but part of the list is shared.</span></p><p style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Of course, we will also deal with updates or deletions. Starting again with the list shown in the following<br/>diagram, if we wanted to update its fourth element, the solution would imply creating a new subset<br/>of  the list, up to and including the fourth element, while keeping the rest unchanged:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">398  Ensuring Purity - Immutability</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s186" style="padding-top: 7pt;padding-left: 107pt;text-indent: 0pt;text-align: left;">old</p><p style="padding-left: 125pt;text-indent: 0pt;text-align: left;"><span><img width="357" height="79" alt="image" src="Image_054.gif"/></span></p><p class="s186" style="padding-left: 110pt;text-indent: -1pt;text-align: left;"><span>new<br/>list</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-left: 165pt;text-indent: 0pt;text-align: left;">Figure 10.4 - Our list, with a changed element</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>Removing an element would also be similar. Let’s do away with the third element, F, in the original<br/>list, as follows:</span></p><p style="text-indent: 0pt;text-align: left;"><span><img width="340" height="79" alt="image" src="Image_055.gif"/></span></p><p class="s186" style="padding-top: 3pt;padding-left: 107pt;text-indent: 0pt;text-align: left;"><span>old<br/>list</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s186" style="padding-left: 110pt;text-indent: -1pt;text-align: left;"><span>new<br/>list</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 116pt;text-indent: 0pt;text-align: left;">Figure 10.5 —The original list, after removing the third element in a persistent way</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Working with lists or other structures can always be solved to provide data persistence. For now, focus<br/>on what will probably be the most important kind of work for us - dealing with simple JavaScript<br/>objects. After all, all data structures are JavaScript objects, so if we can work with objects, we can<br/>work with other structures.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 53pt;text-indent: 0pt;text-align: justify;"><a name="bookmark445">Updating objects</a></p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>This method can also be applied to more common requirements, such as modifying an object. This<br/>is a very good idea for, say, Redux users - a reducer can be programmed to receive the old state as a<br/>parameter and produce an updated version with the minimum needed changes, without altering the<br/>original state in any way.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;text-align: justify;">Imagine you had the following object:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;text-align: left;">myObj = {</p><p style="padding-top: 4pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">a:...,</p><p style="padding-top: 4pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">b:  . ..,</p><p class="s101" style="padding-top: 8pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">C :   . . .,</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 85pt;text-indent: 0pt;text-align: left;">d= {</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 310pt;text-indent: 0pt;text-align: left;">Creating persistent data structures     399</p><p style="padding-top: 37pt;padding-left: 31pt;text-indent: 0pt;text-align: center;">f : . . . ,</p><p style="padding-top: 6pt;text-indent: 0pt;text-align: center;">{</p><p style="padding-top: 2pt;padding-left: 124pt;text-indent: 0pt;text-align: left;">h: . . . ,</p><p style="padding-top: 4pt;padding-left: 125pt;text-indent: 0pt;text-align: left;">i : ...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Let’s assume you wanted to modify the value of the myObj . d. f attribute but in a persistent way.<br/>Instead of copying the entire object (with the deepCopy () function we wrote earlier), we could<br/>create a new object, with several attributes in common with the previous object but new ones for the<br/>modified ones. This can be seen in the following diagram:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 114pt;text-indent: 0pt;text-align: left;"><span><img width="337" height="284" alt="image" src="Image_056.gif"/></span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-left: 72pt;text-indent: 0pt;text-align: left;">Figure 10.6 - A persistent way of editing an object - that is, by sharing some attributes and creating others</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 5pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>The old and new objects share most of the attributes, but there are new d and f attributes, so you<br/>managed to minimize the changes when creating the new object.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>If you want to do this by hand, you would have to write, in a very cumbersome way, something like<br/>the following. Most attributes are taken from the original object, but d and d. f are new:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">newObj = {</p><p style="padding-top: 4pt;padding-left: 64pt;text-indent: 0pt;text-align: left;">a: myObj.a,</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">400  Ensuring Purity - Immutability</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 73pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>b:  myObj.b,<br/>c: myObj.c,</span></p><p style="padding-left: 73pt;text-indent: 0pt;text-align: left;">d:  {</p><p style="padding-top: 4pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">e:  myObj.d.e,</p><p class="s10" style="padding-top: 4pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">f:  the new value,</p><p class="s9" style="padding-top: 4pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">g<span class="p">:  myObj. d. g,</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>We saw some similar code earlier in this chapter when we decided to work on a cloning function.<br/>Here, let’s go for a different type of solution. In fact, this kind of update can be automated:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// objects.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 73pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>const setin = &lt;0 extends OBJ&gt;(<br/>arr: (string | number)[],<br/>value: any,</span></p><p style="text-indent: 0pt;line-height: 10pt;text-align: right;">obj : 0</p><p style="padding-top: 4pt;text-indent: 0pt;text-align: right;">) : O =&gt; {</p><p style="padding-top: 4pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">const newObj = Number.islnteger(arr [0]) ? [] : {};</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">Object.keys(obj).forEach((k) =&gt; {</p><p style="padding-top: 4pt;padding-left: 88pt;text-indent: 0pt;text-align: left;">(newObj as any)[k] = k !== arr[0] ? obj [k] : null;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 85pt;text-indent: -9pt;line-height: 142%;text-align: left;"><span>(newObj as any)[arr[0]] =<br/>arr.length &gt; 1</span></p><p style="padding-left: 98pt;text-indent: 0pt;text-align: left;">? setin(arr.slice(1) , value, obj [arr [0]])</p><p style="padding-top: 4pt;padding-left: 73pt;text-indent: 25pt;line-height: 287%;text-align: left;"><span>: value;<br/>return newObj as O;</span></p><p style="padding-top: 8pt;padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>The logic is recursive, but not too complex. First, we figure out, at the current level, what kind of object<br/>we need - an array or an object. Then, we copy all the attributes from the original object to the new</span></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>one, except the property we are changing. Finally, we set that property to the given value (if we have<br/>finished with the path of property names), or we use recursion to go deeper with the copy.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 310pt;text-indent: 0pt;text-align: left;">Creating persistent data structures     401</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 57pt;text-indent: 0pt;text-align: left;"><a name="bookmark446">Ordering parameters</a></p><p style="padding-top: 4pt;padding-left: 57pt;text-indent: 0pt;line-height: 115%;text-align: left;"><span>Note the order of the parameters - first, the path, then the value, and finally, the object. We<br/>are applying the concept of putting the most stable parameters first and the most variable last.<br/>If                                                                                      you curry this function, you can apply the same path to several different values and objects,<br/>and if you fix the path and the value, you can still use the function with different objects.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 126%;text-align: left;"><span>Let’s give this logic a try. We’ll start with a nonsensical object but with several levels, and even an<br/>array of objects for variety:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 64pt;text-indent: -11pt;line-height: 143%;text-align: left;"><span>const myObj1 = {<br/>a:  111,</span></p><p style="padding-left: 64pt;text-indent: 0pt;text-align: left;">b:  222,</p><p style="text-indent: 0pt;text-align: left;"><br/></p><table style="border-collapse:collapse;margin-left:62.28pt" cellspacing="0"><tr style="height:28pt"><td style="width:34pt"><p class="s29" style="padding-left: 2pt;text-indent: 0pt;line-height: 10pt;text-align: left;">C: 333,</p><p class="s29" style="padding-top: 4pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">d:  {</p></td><td style="width:30pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:15pt"><td style="width:34pt"><p class="s29" style="padding-top: 1pt;padding-left: 14pt;text-indent: 0pt;text-align: left;">e:</p></td><td style="width:30pt"><p class="s29" style="padding-top: 1pt;text-indent: 0pt;text-align: left;">444,</p></td></tr><tr style="height:16pt"><td style="width:34pt"><p class="s29" style="padding-top: 2pt;padding-left: 14pt;text-indent: 0pt;text-align: left;">f:</p></td><td style="width:30pt"><p class="s29" style="padding-top: 2pt;text-indent: 0pt;text-align: left;">555,</p></td></tr><tr style="height:30pt"><td style="width:34pt"><p class="s19" style="padding-top: 2pt;padding-left: 14pt;text-indent: 0pt;text-align: left;">g= {</p><p class="s29" style="padding-top: 2pt;text-indent: 0pt;text-align: right;">h:</p></td><td style="width:30pt"><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s29" style="padding-right: 2pt;text-indent: 0pt;text-align: right;">666,</p></td></tr><tr style="height:13pt"><td style="width:34pt"><p class="s29" style="padding-top: 1pt;padding-right: 1pt;text-indent: 0pt;line-height: 9pt;text-align: right;">i:</p></td><td style="width:30pt"><p class="s29" style="padding-top: 1pt;padding-right: 2pt;text-indent: 0pt;line-height: 9pt;text-align: right;">777,</p></td></tr></table><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 8pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">j:  [{ k: 100 }, { k: 200 }, { k: 300 }],</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 53pt;text-indent: -9pt;line-height: 225%;text-align: left;"><span>We can test this by changing myOb j . d. f to a new value:<br/>let myObj2 = setln([&quot;d&quot;, &quot;f &quot;] , 88888, myObjl);</span></p><p class="s158" style="padding-top: 5pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">/*</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 64pt;text-indent: 0pt;text-align: left;">a:  111,</p><p style="padding-top: 4pt;padding-left: 64pt;text-indent: 0pt;text-align: left;">b:  222,</p><p style="padding-top: 4pt;padding-left: 64pt;text-indent: 0pt;text-align: left;">C: 333,</p><p style="padding-top: 4pt;padding-left: 64pt;text-indent: 0pt;text-align: left;">d:  {</p><p style="padding-top: 4pt;padding-left: 76pt;text-indent: 0pt;text-align: left;">e:  444,</p><p style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">f:  <b>88888,</b></p><p style="padding-top: 4pt;padding-left: 76pt;text-indent: 0pt;text-align: left;">g:  { h: 666, i: 777 },</p><p style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">j: [{ k: 100 }, { k: 200 }, { k: 300 }],</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">402  Ensuring Purity - Immutability</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>console.log(myObj1.d === myObj2.d); // false<br/>console.log(myObj1.d.f === myObj2.d.f); // false<br/>console.log(myObj1.d.g === myObj2.d.g); // true</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>The logs at the bottom verify that the algorithm is working correctly - myObj 2 . d is a new object,<br/>but myObj 2 . d . g is reusing the value from myObj 1.</span></p><p style="padding-top: 7pt;padding-left: 61pt;text-indent: -9pt;line-height: 225%;text-align: left;"><span>Updating the array in the second object lets us test how the logic works in those cases:<br/>const myObj 3    setln([&quot;d&quot;, &quot;j&quot;, 1, &quot;k&quot;J, 99999, myObj2);</span></p><p style="padding-top: 7pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">/*</p><p style="padding-top: 5pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">{</p><p style="padding-top: 2pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">a: 111,</p><p style="padding-top: 4pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">b: 222,</p><p style="padding-top: 4pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">C: 333,</p><p style="padding-top: 4pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">d: {</p><p style="padding-top: 4pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">e: 444,</p><p style="padding-top: 4pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">f: 88888,</p><p style="padding-top: 4pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">g: { h: 666, i: 777 },</p><p style="padding-top: 4pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">j: [{ k: 100 }, { k: 99999 }, { k: 300 }],</p><p style="padding-top: 6pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">}</p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">}</p><p style="padding-top: 3pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">*/</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 61pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>console.log(myObj1.d.j === myObj3.d.j);                // false<br/>console.log(myObj1.d.j [0] === myObj3.d.j [0]); // true</span></p><p style="padding-left: 61pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>console.log(myObj1.d.j [1] === myObj3.d.j [1]) ; // false<br/>console.log(myObj1.d.j [2] === myObj3.d.j [2]); // true</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: left;"><span>We can compare the elements in the myObj 1. d. j array with the ones in the newly created object.<br/>You will see that the array is a new one, but two of the elements (the ones that weren’t updated) are<br/>still the same objects that were in myObj 1.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 310pt;text-indent: 0pt;text-align: left;">Creating persistent data structures     403</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: left;"><span>This obviously isn’t enough to get by. Our logic can update an existing field or even add it if it wasn’t<br/>there, but you’d also need to eliminate an old attribute. Libraries usually provide many more functions,<br/>but let’s work on the deletion of an attribute for now so that we can look at some of the other important<br/>structural changes we can make to an object:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 64pt;text-indent: -12pt;line-height: 143%;text-align: left;"><span>const deleteln = &lt;0 extends 0BJ&gt;(<br/>arr: (string | number)[],</span></p><p style="padding-left: 64pt;text-indent: 0pt;text-align: left;">obj : O</p><p style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">): 0 =&gt; {</p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">const newObj = Number.islnteger(arr[0]) ? [] : {};</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 77pt;text-indent: -12pt;line-height: 144%;text-align: left;"><span>Object.keys(obj).forEach((k) =&gt; {<br/>if (k !== arr [0]) {</span></p><p style="padding-left: 90pt;text-indent: 0pt;text-align: left;">(newObj as any)[k] = obj [k];</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 65pt;text-indent: 0pt;text-align: left;">if (arr.length &gt; 1) {</p><p style="padding-top: 4pt;padding-left: 88pt;text-indent: -9pt;line-height: 143%;text-align: left;"><span>(newObj as any)[arr[0]] = deleteln(<br/>arr.slice(1),</span></p><p style="padding-left: 88pt;text-indent: 0pt;line-height: 10pt;text-align: left;">obj [arr [0]]</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 64pt;text-indent: 0pt;text-align: left;">return newObj as O;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: left;"><span>The logic here is similar to that of set in (). The difference is that we don’t always copy all the<br/>attributes from the original object to the new one; we only do that if we haven’t arrived at the end of<br/>the array of path properties. Continuing with the series of tests after the updates, we get the following:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 52pt;text-indent: 0pt;line-height: 143%;text-align: left;"><a name="bookmark447"><span>const myObj4 = deleteln([&quot;d&quot;, &quot;g&quot;] , myObj3);<br/>const myObj5 = deleteln([&quot;d&quot;, &quot;j&quot;], myObj4);</span></a><a name="bookmark448">&zwnj;</a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">console.log(myObj5);</p><p style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// { a: 111, b: 222, C: 333, d: { e: 444, f: 88888 } }</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">404  Ensuring Purity - Immutability</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>With this pair of functions, we can manage to work with persistent objects by making changes,<br/>additions, and deletions in an efficient way that won’t create new objects needlessly.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-top: 5pt;padding-left: 65pt;text-indent: 0pt;text-align: justify;"><a name="bookmark449">A tip</a></p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;line-height: 115%;text-align: justify;"><span>The most well-known library for working with immutable objects is the appropriately named<br/>immutable . j s, which can be found at immutable-j s . com/. The only weak point about<br/>it   is its notoriously obscure documentation. However, there’s an easy solution - check out </span><i>The</i><span>with all the examples you’ll ever need at untangled. io/<br/>the-missing-immutable-j s-manual/, and you won’t have any trouble!</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 52pt;text-indent: 0pt;text-align: left;"><a name="bookmark450">A final caveat</a></p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Working with persistent data structures requires some cloning, but how would you implement a<br/>persistent array? If you think about this, you’ll realize that, in that case, there would be no way out<br/>apart from cloning the whole array after each operation. This would mean that an operation such<br/>as updating an element in an array, which took a constant time, would now take a length of time<br/>proportional to the size of the array.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-top: 5pt;padding-left: 66pt;text-indent: 0pt;text-align: justify;"><a name="bookmark451">Complexity concerns</a></p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;line-height: 115%;text-align: justify;"><span>In algorithm complexity terms, updates went from being 0(1) operations to O(n) ones. Similarly,<br/>access to an element may become an O(/og n) operation, and similar slowdowns might be<br/>observed for other operations, such as mapping and reducing.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>How do we avoid this? There’s no easy solution. For example, you may find that an array is internally<br/>represented as a binary search tree (or even more complex data structures) and that the persistence<br/>library provides the necessary interface so that you’ll still be able to use it as an array, not noticing<br/>the internal difference.</span></p><p style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>When using this kind of library, the advantages of having immutable updates without cloning may<br/>be partially offset by some operations that may become slower. If this becomes a bottleneck in your<br/>application, you might have to go so far as changing the way you implement immutability or even<br/>work  out how to change your basic data structures to avoid the time loss, or at least minimize it.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-left: 52pt;text-indent: 0pt;text-align: left;"><a name="bookmark452">Summary</a></p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>In this chapter, we looked at two different approaches (used by commonly available immutability<br/>libraries) to avoiding side effects by working with immutable objects and data structures - one<br/>based on using JavaScript’s object freezing, plus some special logic for cloning, and the other based<br/>on applying the concept of persistent data structures with methods that allow all kinds of updates,<br/>without changing the original or requiring full cloning.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 401pt;text-indent: 0pt;text-align: left;">Questions   405</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;">In <i>Chapter 11, Implementing Design Patterns, </i><span>we will focus on a question often asked by object-oriented<br/>programmers - how are design patterns used in FP? Are they required, available, or usable? Are they<br/>still practiced but with a new focus on functions rather than on objects? We’ll answer these questions<br/>with several examples, showing where and how they are equivalent or how they differ from the usual<br/>OOP practices.</span></p><p class="s6" style="padding-top: 8pt;padding-left: 43pt;text-indent: 0pt;text-align: left;"><a name="bookmark453">Questions</a></p><ol id="l131"><ol id="l132"><li data-list-text="10.1"><p class="s10" style="padding-top: 9pt;padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: justify;">Not just date problems: <span class="p">We saw that our j sonCopy () function has problems with dates, but that’s<br/>not all. What happens if we try to copy objects that include maps? Sets? Regular expressions? Functions?</span></p></li><li data-list-text="10.2"><p class="s10" style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;">Hie mote in jsonCopy’s eye..<span class="p">The previous question pointed out some problems of j sonCopy ();<br/>how does deepCopy () fare with the same kind of objects? Can it be enhanced?</span></p></li><li data-list-text="10.3"><p class="s10" style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;">Going in circles: <span class="p">Objects may have circular references that point to themselves, and JSON.<br/>stringify () will protest if dealing with such. How could you fix our deepCopy () function to<br/>avoid that problem? We did deal with that issue in the deepFreeze () function, but that solution<br/>cannot be used here; something different is required.</span></p></li><li data-list-text="10.4"><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><b>Freezing by proxying: </b>In the <i>Chaining and fluent interfaces </i>section of <i>Chapter 8, Connecting</i><span>we used a proxy to get operations to provide automatic chaining. By using a proxy for setting<br/>and deleting operations, you can do your own freezing (if, instead of setting an object’s property, you’d<br/>rather throw an exception). Implement a f reezeByProxy (obj ) function that will apply this idea<br/>to forbid all kinds of updates (adding, modifying, or deleting properties) for an object. Remember to<br/>work recursively if an object has other objects as properties!</span></p></li><li data-list-text="10.5"><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><b>Inserting into a list, persistently: </b>In the <i>Working with lists </i><span>section, we described how an<br/>algorithm could add a new node to a list, but in a persistent way, by creating a new list. Implement an<br/>insertAfter(list,  newKey,  oldKey)  function  that  will  create  a  new  list,  but  add  a  new<br/>node with newKey just after the node with oldKey. Here, you’ll need to assume that the nodes in<br/>the list were created by the following logic:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">type MUSICAL_KEY = string;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">class Node {</p><p style="padding-top: 4pt;padding-left: 64pt;text-indent: 0pt;text-align: left;">key: MUSICAL_KEY;</p><p style="padding-top: 4pt;padding-left: 64pt;text-indent: 0pt;text-align: left;">next: Node | null;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 77pt;text-indent: -12pt;line-height: 143%;text-align: left;"><span>constructor(key: MUSICAL_KEY, next: Node | null) {<br/>this.key = key;</span></p><p style="padding-left: 76pt;text-indent: 0pt;text-align: left;">this.next = next;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">406  Ensuring Purity - Immutability</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-left: 62pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">const c3 =</p><p style="padding-top: 4pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">new Node(&quot;G&quot;,</p><p style="padding-top: 4pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">new Node(&quot;B&quot;,</p><p style="padding-top: 4pt;padding-left: 97pt;text-indent: 0pt;text-align: left;">new Node(&quot;F&quot;,</p><p style="padding-top: 4pt;padding-left: 109pt;text-indent: 0pt;text-align: left;">new Node(&quot;A&quot;,</p><p style="padding-top: 4pt;padding-left: 121pt;text-indent: 0pt;text-align: left;">new Node(&quot;C&quot;,</p><p style="padding-top: 4pt;padding-left: 133pt;text-indent: 0pt;text-align: left;">new Node(&quot;E&quot;, null)</p><p class="s164" style="padding-top: 6pt;padding-left: 122pt;text-indent: 0pt;text-align: left;">)</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 98pt;text-indent: 0pt;text-align: left;">)</p><p class="s164" style="padding-top: 5pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">)</p><p class="s164" style="padding-top: 5pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="10.6"><p style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><b>Composing many lenses: </b><span>Write a composeLenses () function that will allow you to compose<br/>as many simple lenses as you want, instead of only two, as in composeTwoLenses (), along the<br/>same lines as what we did in </span><i>Chapter 8, Connecting Functions, </i><span>when we moved from composeTwo ()<br/>to a generic compose () function.</span></p></li><li data-list-text="10.7"><p class="s10" style="padding-top: 6pt;padding-left: 52pt;text-indent: 1pt;line-height: 123%;text-align: justify;">Lenses bypath: <span class="p">In this chapter, we created lenses using getField () and setField (). Then,<br/>we used composition to access deeper attributes. Can you create a lens by giving a path, allowing<br/>shorter code?</span></p></li><li data-list-text="10.8"><p class="s10" style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;">Accessing virtual attributes: <span class="p">By using lenses, you can view (and even set) attributes that don’t<br/>actually exist in an object. Here are some tips to let you develop that. First, can you write a getter<br/>that will access an object such as author and return the authors full name in LAST NAME, FIRST<br/>NAME format? Second, can you write a setter that, given a full name, will split it in half and set its<br/>first and last names? With those two functions, you could write the following:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;text-align: left;">const fullNameLens = lens(</p><p style="padding-top: 4pt;padding-left: 63pt;text-indent: 0pt;text-align: left;">...your getter...,</p><p style="padding-top: 4pt;padding-left: 63pt;text-indent: 0pt;text-align: left;">...your setter...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;text-align: left;">console.log(view(fullNameLens, author));</p><p class="s164" style="padding-top: 6pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">/*</p><p style="padding-top: 3pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">Kereki, Federico</p><p class="s164" style="padding-top: 6pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">*/</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 401pt;text-indent: 0pt;text-align: left;">Questions   407</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">console.log(set(fullNameLens, &quot;Doe, John&quot;, author));</p><p style="padding-top: 5pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">/*</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 6pt;padding-left: 64pt;text-indent: 0pt;text-align: left;">user: &#39;fkereki&#39;,</p><p style="padding-top: 4pt;padding-left: 64pt;text-indent: 0pt;text-align: left;">name: <b>{ first: &#39; John&#39;, </b>middle:              <b>last: &#39;Doe&#39; },</b></p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="10.9"><p class="s10" style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;">Lenses for arrays? <span class="p">What would happen if you created a lens like in the following code and applied<br/>it to an array? If there’s a problem, could you fix it?</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">const getArray = curry((ind, arr) =&gt; arr[ind]);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 64pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>const setArray = curry((ind, value, arr) =&gt; {<br/>arr [ind] = value;</span></p><p style="padding-left: 64pt;text-indent: 0pt;line-height: 10pt;text-align: left;">return arr;</p><p style="padding-top: 6pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">});</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 5pt;padding-left: 65pt;text-indent: -12pt;line-height: 144%;text-align: left;"><span>const lensArray = (ind) =&gt;<br/>lens(getArray(ind), setArray(ind));</span></p></li><li data-list-text="10.10"><p class="s10" style="padding-top: 8pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;">Lenses into maps: <span class="p">Write a lensMap () function to create a lens you can use to access and modify<br/>maps. You may want to look at the following for more information about cloning maps: developer.</span></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: left;">mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Obj                 ects/Map.</p><p style="padding-top: 2pt;padding-left: 43pt;text-indent: 0pt;text-align: left;">Your function should be declared as follows. You’ll have to write a couple of auxiliary functions as well:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">const lensMap = key =&gt; lens(getMap(key), setMap(key));</p><p style="text-indent: 0pt;text-align: left;"><br/></p><h3 style="padding-top: 10pt;text-indent: 0pt;text-align: right;"><a name="bookmark454">11</a><a name="bookmark455">&zwnj;</a></h3><h2 style="padding-top: 4pt;text-indent: 0pt;text-align: right;">Implementing Design Patterns</h2><h2 style="padding-top: 2pt;text-indent: 0pt;text-align: right;">- The Functional Way</h2><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;">In <i>Chapter 10, Ensuring Purity, </i><span>we saw several functional techniques to solve different problems.<br/>However, programmers used to employing OOP may find that we have missed some well-known<br/>formulas and solutions often used in imperative coding. Since design patterns are well known, and<br/>programmers will likely already be aware of how they are applied in other languages, it’s important<br/>to   look at how a functional implementation would be done.</span></p><p style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;">In this chapter, we shall consider the solutions provided by <b>design patterns </b><span>that are common in OOP,<br/>to see their equivalent in FP. This will help you transition from OOP to a more functional approach<br/>and learn more about FP’s power and methods, by seeing alternative solutions to problems.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;text-align: justify;">In particular, we will study the following topics:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l133"><li data-list-text="•"><p style="padding-left: 70pt;text-indent: -13pt;text-align: left;">The concept of <i>design patterns </i>and what they apply to</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">A few OOP standard patterns and what alternatives we have in FP if we need one</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">The <i>Observer </i>pattern, which leads to <i>reactive programming, </i>a declarative way of dealing with events</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">FP design patterns, not related to the OOP ones</p></li></ul></li></ol></ol><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: justify;"><span>In this chapter, we won’t be worrying much about typing and TypeScript because we’ll want to focus<br/>on the patterns, minimizing and abstracting everything else.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-left: 44pt;text-indent: 0pt;text-align: justify;"><a name="bookmark456">Understanding design patterns</a></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;">One of the most relevant books in software engineering is <i>Design Patterns: Elements of Reusable</i>(1994), written by the <b>Gang of Four (GoF) - </b><span>Erich Gamma, Richard Helm,<br/>Ralph Johnson, and John Vlissides. This book presented about two dozen OOP patterns and has been<br/>recognized as highly important in computer science.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">410  Implementing Design Patterns -The Functional Way</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s9" style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;">Patterns <span class="p">are actually a concept in architectural design, originally defined by an architect, Christopher<br/>Alexander. Still, in software terms, a </span>design pattern <span class="p">is a generally applicable, reusable solution to a<br/>commonly-seen problem in software design. Rather than a specific finished and coded design, it’s a<br/>description of a solution (the word </span>template <span class="p">is also used) that can solve a given problem that appears<br/>in  many contexts. Given their advantages, design patterns are best practices that can be used by<br/>developers working with different kinds of systems, programming languages, and environments.</span></p><p style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>The GoF book obviously focused on OOP, and some patterns within cannot be recommended for<br/>or applied in FP. Other patterns are unnecessary or irrelevant because functional languages already<br/>provide standard solutions to the corresponding object-oriented problems. Even given this difficulty,<br/>since most programmers have been exposed to OOP design patterns and usually try to apply them<br/>even in other contexts such as FP, it makes sense to consider the original problems and then take a<br/>look at how a new solution can be produced. The standard object-based solutions may not apply, but<br/>the problems can still stand, so seeing how to solve them is still valid.</span></p><p style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;text-align: justify;">Patterns are often described in terms of four essential, basic elements:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l134"><li data-list-text="•"><p style="padding-left: 79pt;text-indent: -12pt;line-height: 123%;text-align: justify;"><span class="s33">	</span>A simple, short <i>name, </i><span>used to describe the problem, its solutions, and its consequences.<br/>The name helps when talking with colleagues, explaining a design decision, or describing a<br/>specific implementation.</span></p></li><li data-list-text="•"><p style="padding-top: 5pt;padding-left: 79pt;text-indent: -12pt;line-height: 123%;text-align: justify;"><span class="s33">	</span>The <i>context </i><span>to which the pattern applies - specific situations that require a solution, possibly<br/>with additional conditions that must be met.</span></p></li><li data-list-text="•"><p style="padding-top: 5pt;padding-left: 79pt;text-indent: -13pt;line-height: 123%;text-align: justify;">A <i>solution </i><span>that lists the elements (classes, objects, functions, relationships, and so on) that you’ll<br/>need to solve the given situation.</span></p></li><li data-list-text="•"><p style="padding-top: 5pt;padding-left: 79pt;text-indent: -12pt;line-height: 125%;text-align: justify;">The <i>consequences </i><span>(results and trade-off&#39;s) if you apply the pattern. You may derive some gains<br/>from the solution, but it may also imply some losses.</span></p><p style="padding-top: 8pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>In this chapter, we will assume that you are already aware of the design patterns we will describe and<br/>use, so we will only provide a few details about them. Rather, we will focus on how FP either makes<br/>a problem irrelevant (because there is an obvious way of applying functional techniques to solve it)<br/>or solves it in some fashion.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Also, we won’t be going over all of the GoF patterns; we’ll just focus on the ones that are the most<br/>interesting, that is, those that bring out more differences when FP is applied compared to when OOP<br/>is applied.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 53pt;text-indent: 0pt;text-align: justify;"><a name="bookmark457">Design pattern categories</a></p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>According to their focus, design patterns are usually grouped into several distinct categories. The first<br/>three in the following list are the ones that appeared in the original GoF book, but more categories<br/>have since been added. They are as follows:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="•"><p class="s10" style="padding-left: 79pt;text-indent: -13pt;line-height: 123%;text-align: justify;">Behavioral design patterns <span class="p">have to do with interactions and communications between objects.<br/>Rather than focusing on how objects are created or built, the key consideration is how to</span></p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 323pt;text-indent: 0pt;text-align: left;">Understanding design patterns     411</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 70pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>connect them so that they can cooperate when performing a complex task, preferably in a way<br/>that provides well-known advantages, such as diminished coupling or enhanced cohesiveness.</span></p><ul id="l135"><li data-list-text="•"><p class="s10" style="padding-top: 5pt;padding-left: 70pt;text-indent: -12pt;line-height: 124%;text-align: justify;">Creational design patterns <span class="p">deal with ways to create objects in a manner suitable for the current<br/>problem. With them, you can decide between several alternative objects, so the program can<br/>work differently, depending on parameters that may be known at compilation time or runtime.</span></p></li><li data-list-text="•"><p class="s10" style="padding-top: 5pt;padding-left: 70pt;text-indent: -13pt;line-height: 124%;text-align: justify;">Structural design patterns <span class="p">have to do with the composition of objects, forming larger structures<br/>from many individual parts and implementing relationships between objects. Some of the patterns<br/>imply inheritance or implementation of interfaces, whereas others use different mechanisms,<br/>all geared toward being able to dynamically change the way objects are composed at runtime.</span></p></li><li data-list-text="•"><p class="s33" style="padding-top: 5pt;padding-left: 70pt;text-indent: -12pt;line-height: 123%;text-align: justify;">	<span class="s10">Concurrency patterns </span><span class="p">deal with multithreaded programming. Although FP is generally quite<br/>appropriate for this (given, for example, the lack of assignments and side effects), since we are<br/>working with JavaScript, these patterns are not very relevant to us.</span></p></li><li data-list-text="•"><p class="s33" style="padding-top: 5pt;padding-left: 70pt;text-indent: -12pt;line-height: 124%;text-align: justify;">	<span class="s10">Architectural patterns </span><span class="p">are more high-level oriented, with a broader scope than the previous<br/>patterns we’ve listed, and provide general solutions to software architecture problems. As is, we<br/>aren’t considering such problems in this book, so we won’t deal with these either.</span></p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>The categories are not really fixed or set in stone. Fifteen years after the original GoF book, three of<br/>its authors (see the </span><i>Design Patterns 15 Years Later: An Interview with Erich Gamma, Richard Helm,</i><a href="http://www/" class="s11" target="_blank">article  at  </a><span>www.  inf  ormit.  com/articles/article  .  aspx?p=1404056)<br/>suggested a new list of categories - </span><i>Core, Creational </i><span>(similar to the original category, but adding the<br/></span><i>Dependency Injection </i>pattern, which we’ll study later on), <i>Peripheral, </i>and <i>Other.</i></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-top: 5pt;padding-left: 57pt;text-indent: 0pt;text-align: justify;"><a name="bookmark458">Old good practices</a></p><p style="padding-top: 4pt;padding-left: 56pt;text-indent: 0pt;line-height: 115%;text-align: justify;"><span>Coupling and cohesiveness are terms that were in use even before OOP came into vogue; they<br/>date back to the late 1960s when the </span><i>Structured Design </i><span>book by Larry Constantine came out.<br/>Coupling measures the interdependence between any two modules, and cohesiveness has to<br/>do  with the degree to which all module components really belong together. Low coupling and<br/>high cohesiveness are worthy goals for software design because they imply that related things<br/>are nearby and unrelated ones are separate.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;">Following along these lines, you could also classify design patterns as <i>object patterns </i><span>(which concern<br/>the dynamic relationships between objects) and </span><i>class patterns </i><span>that deal with the relationships between<br/>classes and subclasses (which are defined statically at compile time). We won’t be worrying much about<br/>this classification because our point of view has more to do with behaviors and functions, rather than<br/>classes and objects.</span></p><p style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>As mentioned earlier, we can now readily observe that these categories are heavily oriented toward<br/>OOP, and the first three directly mention objects. However, without the loss of generality, we will look<br/>beyond the definitions, remember what problem we were trying to solve, and then look into analogous<br/>solutions with FP, which, if not 100% equivalent to the OOP ones, will in spirit solve the same problem<br/>in   a parallel way. Let’s move on and start by considering why we want to deal with patterns at all!</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">412  Implementing Design Patterns -The Functional Way</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-top: 7pt;padding-left: 53pt;text-indent: 0pt;text-align: justify;"><a name="bookmark459">Do we need design patterns?</a></p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>An interesting point of view says that design patterns are only needed to patch the shortcomings of<br/>programming languages. The rationale is that if you can solve a problem with a given programming<br/>language in a simple, direct, and straightforward way, then you may not need a design pattern at all.<br/>(For example, if your language doesn’t provide recursion, you would have to implement it on your<br/>own; otherwise, you can just use it without further ado.) However, studying patterns lets you think<br/>about different ways of solving problems, so that’s a point in their favor.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>In any case, it’s interesting for OOP developers to understand why FP helps solve some problems<br/>without needing further tools. In the next section, we shall consider several well-known design<br/>patterns and examine why we don’t need them or how we can easily implement them. It’s also a fact<br/>that we have already applied several patterns earlier in the text, so we’ll also point out those examples.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>We won’t try, however, to express or convert all design patterns into FP terms. For example, the<br/>Singleton pattern basically requires a single, global object, which is sort of opposed to everything<br/>that functional programmers are used to. Given our approach to FP (remember </span><i>Sorta Functional</i><span>(SFP), from the first chapter of this book?), we won’t mind either, and if a Singleton is<br/>required, we may consider using it, even though FP doesn’t have an appropriate equivalent. (And, as<br/>we’ll see soon enough, every time you import from a module you’re using a Singleton!)</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Finally, it must be said that our point of view may affect what is considered a pattern and what isn’t.<br/>What may be a pattern to some may be considered a trivial detail for others. We will find some such<br/>situations, given that FP lets us solve some particular problems in easy ways, and we have already<br/>seen examples of that in previous chapters.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-left: 52pt;text-indent: 0pt;text-align: justify;"><a name="bookmark460">Object-oriented design patterns</a></p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>In this section, we’ll review some of the GoF design patterns, check whether they are pertinent to FP,<br/>and study how to implement them. Of course, some design patterns don’t get an FP solution. As an<br/>example, there’s no equivalent for a Singleton, which implies the foreign concept of a globally accessed<br/>object. Additionally, while it’s true that you may no longer need OOP-specific patterns, developers<br/>will still think in terms of those. Also, since we’re not going fully functional, if some OOP pattern fits,<br/>why not use it even if it’s not fully functional?</span></p><p style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;text-align: justify;">We will be considering the following:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l136"><li data-list-text="•"><p class="s10" style="padding-left: 79pt;text-indent: -13pt;text-align: left;">Facade <span class="p">and </span>Adapter <span class="p">to provide new interfaces to other code</span></p></li><li data-list-text="•"><p class="s10" style="padding-top: 8pt;padding-left: 79pt;text-indent: -13pt;text-align: left;">Decorator <span class="p">(also known as </span>Wrapper) <span class="p">to add new functionality to existing code</span></p></li><li data-list-text="•"><p class="s10" style="padding-top: 8pt;padding-left: 79pt;text-indent: -13pt;line-height: 125%;text-align: left;"><span class="s33">	</span>Strategy, Template, <span class="p">and </span>Command <span class="p">to let you fine-tune algorithms by passing functions<br/>as parameters</span></p></li><li data-list-text="•"><p class="s10" style="padding-top: 5pt;padding-left: 79pt;text-indent: -13pt;text-align: left;">Dependency Injection <span class="p">to help in decoupling components and simplify testing</span></p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 319pt;text-indent: 0pt;text-align: left;">Object-oriented design patterns     413</p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l137"><li data-list-text="•"><p class="s10" style="padding-left: 70pt;text-indent: -13pt;text-align: left;">Observer, <span class="p">which leads to reactive programming, a declarative way of dealing with events</span></p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 62pt;text-indent: -5pt;text-align: left;">Other patterns that do not so fully match the corresponding OOP ones</p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Lets begin our study by analyzing a couple of similar patterns that let you use your code in somewhat<br/>different ways.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 44pt;text-indent: 0pt;text-align: justify;"><a name="bookmark461">Facade and Adapter</a></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Out of these two patterns, let’s start with the Facade or, more correctly, Facade. This is meant to solve<br/>the problem of providing a different interface to the methods of a class or to a library. The idea is to<br/>provide a new interface to a system that makes it easier to use. You might say that a Facade provides<br/>a better control panel to access certain functionalities, removing difficulties for the user.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 57pt;text-indent: 0pt;text-align: left;"><a name="bookmark462">Sor K?</a></p><p class="s9" style="padding-top: 4pt;padding-left: 57pt;text-indent: 0pt;line-height: 115%;text-align: left;">Facade or facade? <span class="p">The original word is an architectural term meaning </span>the front of a building <span class="p">and<br/>comes from the French language. According to this source and the usual sound of the cedilla</span></p><p class="s9" style="padding-left: 56pt;text-indent: 0pt;line-height: 115%;text-align: left;">(f) <span class="p">character, its pronunciation is a bit like </span>fuh-sahd. <span class="p">The other spelling probably has to do with<br/>the lack of international characters in keyboards and poses the following problem - shouldn’t<br/>you read it </span>asfah-Kade? <span class="p">You may see this problem as the reverse of </span>Celtic, <span class="p">which is pronounced<br/>as </span>Keltic, <span class="p">changing the s sound to a </span>k <span class="p">sound.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>The main problem we want to solve is using external code more easily. (Of course, if it were your<br/>code, you could handle such problems directly; we must assume you cannot - or shouldn’t - Insert<br/>space try to modify that other code. This would be the case when you use any library available over<br/>the web, for example.) The key is to implement a module that will provide an interface that better<br/>suits your needs. Your code will use your module and won’t directly interact with the original code.</span></p><p style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Suppose that you want to do Ajax calls, and your only possibility is using some hard library with a<br/>really complex interface. With modules, you might write something like the following, working with<br/>an imagined, hard-to-use Ajax library:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// simpleAjax.js</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">import * as hard from &quot;hardajaxlibrary&quot;;</p><p style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// import the other library that does Ajax calls</p><p style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// but in a hard, difficult way, requiring complex code</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 30pt;text-indent: 0pt;text-align: center;">const convertParamsToHardStyle = (params) =&gt; {</p><p style="padding-top: 4pt;padding-left: 27pt;text-indent: 0pt;text-align: center;">// do some internal steps to convert params</p><p style="padding-top: 4pt;padding-left: 33pt;text-indent: 0pt;text-align: center;">// into whatever the hard library may require</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">414  Implementing Design Patterns -The Functional Way</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;">};</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;text-align: left;">const makeStandardUrl = (url) =&gt; {</p><p style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">// make sure the URL is in the standard</p><p style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">// way for the hard library</p><p style="padding-top: 6pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">};</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;text-align: left;">const getUrl = (url, params, callback) =&gt; {</p><p style="padding-top: 4pt;padding-left: 73pt;text-indent: 0pt;line-height: 142%;text-align: left;"><span>const xhr = hard.createAnXmlHttpRequestObjectO;<br/>hard.initializeAjaxCall(xhr);</span></p><p style="padding-left: 73pt;text-indent: 0pt;line-height: 142%;text-align: left;"><span>const standardUrl = makeStandardUrl(url);<br/>hard.setUrl(xhr, standardUrl);</span></p><p style="padding-left: 73pt;text-indent: 0pt;line-height: 143%;text-align: left;"><span>const convertedParams = convertParamsToHardStyle(params);<br/>hard.setAdditionalParameters(params);<br/>hard.setCallback(callback);</span></p><p style="padding-left: 85pt;text-indent: -11pt;line-height: 142%;text-align: left;"><span>if (hard.everythingOk(xhr)) {<br/>hard.doAjaxCall(xhr);</span></p><p style="padding-left: 75pt;text-indent: 0pt;text-align: left;">} else {</p><p style="padding-top: 4pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">throw new Error(&quot;ajax failure&quot;);</p><p style="padding-top: 6pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">}</p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">};</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">const postUri = (url, params, callback) =&gt; {</p><p style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">// some similarly complex code</p><p style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">// to do a POST using the hard library</p><p style="padding-top: 6pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">};</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;text-align: left;">export { getUrl, postUri };</p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">// the only methods that will be seen</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Now, if you need to do GET or POST, instead of having to go through all of the complications of the<br/>provided complex Ajax library, you can use the new facade that provides a simpler way of working.<br/>Developers  would  write  import  {getUrl,  postUri}  from  &quot;  simp  leAj  ax&quot;  and  work<br/>more reasonably.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>Nowadays, with import/export support in browsers, code will work as shown previously. Before<br/>that (or for backward-compatibility reasons) the implementation would require the usage of an</span></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;"><b>Immediately Invoked Function Expression (IIFE), </b>as covered in the <i>Immediate invocation </i>section</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 319pt;text-indent: 0pt;text-align: left;">Object-oriented design patterns     415</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;">of <i>Chapter 3, Starting Out with Functions, </i>using a <b>revealing module </b><span>pattern. The way to implement<br/>the pattern would then be as follows:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">const simpleAjax = (function () {</p><p style="padding-top: 5pt;padding-left: 64pt;text-indent: 0pt;text-align: left;">const hard = require(&quot;hardajaxlibrary&quot;);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">const convertParamsToHardStyle = (params) =&gt; {</p><p class="s17" style="padding-top: 3pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">// ...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 64pt;text-indent: 0pt;text-align: left;">const makeStandardUrl = (url) =&gt; {</p><p style="padding-top: 5pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">// ...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 64pt;text-indent: 0pt;text-align: left;">const getUrl = (url, params, callback) =&gt; {</p><p style="padding-top: 5pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">// ...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 65pt;text-indent: 0pt;text-align: left;">const postUri = (url, params, callback) =&gt; {</p><p style="padding-top: 5pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">// ...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 65pt;text-indent: 0pt;text-align: left;">return { getUrl, postUri };</p><p style="padding-top: 6pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">}) 0;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;">The reason for the <i>revealing module </i><span>name should now be apparent. With the preceding code, because<br/>of the JavaScript scope rules, the only visible attributes of simpleAj ax will be simpleAj ax.</span></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>getUrl and simpleAj ax. postUri; using an IIFE lets us implement the module (and, hence,<br/>the facade) safely, making implementation details private.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 57pt;text-indent: 0pt;text-align: left;"><a name="bookmark463">Of modules and singletons</a></p><p style="padding-top: 4pt;padding-left: 57pt;text-indent: 0pt;line-height: 115%;text-align: left;"><span>In modern JavaScript, modules are a case of the Singleton pattern. (In math, a “singleton”<br/>is a set with just one element.) If you import a module in several different places of your<br/>code, all references will be to the same object, precisely as the Singleton pattern requires in<br/>object-oriented code.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>Now, the Adapter pattern is similar, insofar as it is also meant to define a new interface. However,<br/>while Facade defines a new interface to old code, Adapter is used when you need to implement an</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">416  Implementing Design Patterns -The Functional Way</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>old interface for new code, so it will match what you already have. If you are working with modules,<br/>it’s clear that the same type of solution that worked for Facade will work here, so we don’t have to<br/>study it in detail. Now, let’s continue with a well-known pattern, which we saw earlier in this book!</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 53pt;text-indent: 0pt;text-align: justify;"><a name="bookmark464">Decorator or Wrapper</a></p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>The Decorator pattern (also known as Wrapper) is useful when you want to add additional responsibilities<br/>or functionalities to an object in a dynamic way. Let’s consider a simple example, which we will illustrate<br/>with some React code. (Don’t worry if you do not know this framework; the example will be easy to<br/>understand. The idea of using React is because it can take advantage of this pattern very well. Also,<br/>we  have already seen pure JavaScript higher-order function examples, so it’s good to see something<br/>new.) Suppose we want to show some elements on the screen, and for debugging purposes, we want<br/>to show a thin red border around an object. How can you do it?</span></p><p style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>If you were using OOP, you would have to create a new subclass with the extended functionality. For<br/>this particular example, you might provide some attribute with the name of some CSS class that would<br/>provide the required style, but let’s keep our focus on OOP; using CSS won’t always solve this software<br/>design problem, so we want a more general solution. The new subclass would know how to show<br/>itself with a border, and you’d use this subclass whenever you wanted an object’s border to be visible.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;">With our experience with higher-order functions, we can solve this differently by <i>wrapping </i><span>the original<br/>function within another one, which would provide extra functionality.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;">Note that we have already seen some examples of wrapping in the <i>Wrapping functions - keeping behavior</i>section of <i>Chapter 6, Producing Functions. </i><span>For example, in that section, we saw how to wrap functions<br/>to produce new versions that could log their input and output, provide timing information, or even<br/>memorize calls to avoid future delays. On this occasion, we are applying the concept to decorate a<br/>visual component, but the principle remains the same.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Let’s define a simple React component, ListOf Names, that can display a heading and a list of people,<br/>and for the latter, we will use a FullNameDisplay component. The code for those elements would<br/>be as shown in the following fragment:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 73pt;text-indent: -12pt;line-height: 142%;text-align: left;"><span>const  FullNameDisplay  =  ({  first,  last  })  =&gt;  {<br/>return (</span></p><p style="padding-left: 86pt;text-indent: 0pt;text-align: left;">&lt;div&gt;</p><p style="padding-top: 4pt;padding-left: 97pt;text-indent: 0pt;text-align: left;">First Name: &lt;b&gt;{first}&lt;/b&gt;</p><p style="padding-top: 4pt;padding-left: 98pt;text-indent: 0pt;text-align: left;">&lt;br / &gt;</p><p style="padding-top: 4pt;padding-left: 97pt;text-indent: 0pt;text-align: left;">Last Name: &lt;b&gt;{last}&lt;/b&gt;</p><p style="padding-top: 4pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">&lt;/div&gt;</p><p style="padding-top: 5pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 319pt;text-indent: 0pt;text-align: left;">Object-oriented design patterns     417</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 6pt;padding-left: 64pt;text-indent: -11pt;line-height: 142%;text-align: left;"><span>const ListOfNames = ({ people, heading }) = &gt; {<br/>return (</span></p><p style="padding-left: 77pt;text-indent: 0pt;text-align: left;">&lt;div&gt;</p><p style="padding-top: 4pt;padding-left: 89pt;text-indent: 0pt;text-align: left;">&lt;hl&gt;{heading}&lt;/hl&gt;</p><p style="padding-top: 4pt;padding-left: 89pt;text-indent: 0pt;text-align: left;">&lt;ul&gt;</p><p style="padding-top: 4pt;padding-left: 101pt;text-indent: 0pt;text-align: left;">{people.map((v) =&gt; (</p><p style="padding-top: 4pt;padding-left: 170pt;text-indent: 0pt;text-align: left;">&lt;FullNameDisplay first={v.first} last={v.last} /&gt;</p><p style="padding-top: 6pt;text-indent: 0pt;text-align: right;">))}</p><p style="padding-top: 2pt;text-indent: 0pt;text-align: right;">&lt;/ul&gt;</p><p style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">&lt;/div&gt;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>The ListOfNames component uses mapping to create a FullNameDisplay component to show<br/>data for each person. The logic for our application could then be the following:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">import { createRoot } from &quot;react-dom/client&quot;;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">const GANG_OF_FOUR = [</p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">{ first: &quot;Erich&quot;, last: &quot;Gamma&quot; },</p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">{ first: &quot;Richard&quot;, last: &quot;Helm&quot; },</p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">{ first: &quot;Ralph&quot;, last: &quot;Johnson&quot; },</p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">{ first: &quot;John&quot;, last: &quot;Vlissides&quot; }</p><p class="s164" style="padding-top: 6pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">] ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;line-height: 285%;text-align: left;"><span>const FullNameDisplay = .<br/>const ListOfNames</span></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>const rootElement = document.getElementByld(&quot;root&quot;);<br/>const root = createRoot(rootElement);</span></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 10pt;text-align: left;">root.render(</p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">&lt;ListOfNames people={GANG_OF_FOUR} heading=&quot;G<span class="s163">O</span>F&quot; /&gt;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">418  Implementing Design Patterns -The Functional Way</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-top: 6pt;padding-left: 65pt;text-indent: 0pt;text-align: justify;"><a name="bookmark465">Do as I say...</a></p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;line-height: 115%;text-align: justify;"><span>In real life, you wouldn’t put all the code for every component in the same single source code<br/>file - and you would probably have a few CSS files. However, for our example, having everything<br/>in one place and using inline styles is enough, so bear with me and keep in mind the saying<br/></span><i>“Do as I say, not as I do.”</i></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>We can quickly test the result in the online React sandbox at codesandbox .io/; google react<br/>online sandbox if you want other options. The interface design isn’t much to talk about (so please<br/>don’t criticize my poor web page!) because we are interested in design patterns right now; refer to<br/></span><i>Figure 11.1, </i>given as follows:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 51pt;text-indent: 0pt;text-align: left;"><span><img width="531" height="284" alt="image" src="Image_057.jpg"/></span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-left: 61pt;text-indent: 0pt;text-align: justify;">Figure 11.1 -The original version of our components shows a (not much to speak about) list of names</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 5pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>In React, inline components are written in JSX (inline HTML style) and compiled into objects, which<br/>are later transformed into HTML code to be displayed. Whenever the render () method is called, it<br/>returns a structure of objects. So, we will write a function that will take a component as a parameter<br/>and return a new JSX, a wrapped object. In our case, we’d like to wrap the original component within</span></p><p style="padding-left: 53pt;text-indent: 0pt;line-height: 10pt;text-align: justify;">&lt;div&gt; with the required border:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 319pt;text-indent: 0pt;text-align: left;">Object-oriented design patterns     419</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 64pt;text-indent: -12pt;line-height: 142%;text-align: left;"><span>const makeVisible = (component) =&gt; {<br/>return (</span></p><p class="s10" style="padding-left: 77pt;text-indent: 0pt;text-align: left;">&lt;div style={{ border: &quot;lpx solid red&quot; }}&gt;</p><p style="padding-top: 4pt;padding-left: 89pt;text-indent: 0pt;text-align: left;">{component}</p><p class="s10" style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">&lt;/div&gt;</p><p style="padding-top: 5pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: left;"><span>If you wish, you can make this function aware of whether it’s executing in development mode or<br/>production; in the latter case, it would simply return the original component argument without any<br/>change, but let’s not worry about that now.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>We now have to change ListOf Names to use wrapped components; the new version would be<br/>as follows:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 64pt;text-indent: -12pt;line-height: 142%;text-align: left;"><span>const ListOfNames = ({ people, heading }) =&gt; {<br/>return (</span></p><p style="padding-left: 77pt;text-indent: 0pt;text-align: left;">&lt;div&gt;</p><p style="padding-top: 4pt;padding-left: 89pt;text-indent: 0pt;text-align: left;">&lt;hl&gt;{heading}&lt;/hl&gt;</p><p style="padding-top: 4pt;padding-left: 89pt;text-indent: 0pt;text-align: left;">&lt;ul&gt;</p><p style="padding-top: 4pt;padding-left: 101pt;text-indent: 0pt;text-align: left;">{people.map((v) =&gt;</p><p class="s10" style="padding-top: 4pt;padding-left: 125pt;text-indent: -13pt;line-height: 142%;text-align: left;"><span>makeVisible(&lt;FullNameDisplay<br/>first={v.first}</span></p><p class="s10" style="padding-left: 125pt;text-indent: 0pt;text-align: left;">last={v.last} /&gt;)</p><p style="padding-top: 6pt;text-indent: 0pt;text-align: right;">)}</p><p style="padding-top: 2pt;text-indent: 0pt;text-align: right;">&lt;/ul&gt;</p><p style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">&lt;/div&gt;</p><p style="padding-top: 5pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 43pt;text-indent: 0pt;text-align: left;">The decorated version of the code works as expected: each of the ListOfNames components is</p><p style="padding-top: 2pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;">now wrapped in another component that adds the desired border to them; refer to <i>Figure 11.2, </i><span>given<br/>as follows:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">420  Implementing Design Patterns -The Functional Way</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;"><span><img width="521" height="289" alt="image" src="Image_058.jpg"/></span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-left: 169pt;text-indent: -28pt;line-height: 152%;text-align: left;"><span>Figure 11.2 -The decorated ListOfNames component is still nothing<br/>much to look at, but now it shows an added border</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>In earlier chapters, we saw how to decorate a function, wrapping it inside of another function, so it<br/>would perform extra code and add a few functionalities. Here, we saw how to apply the same solution<br/>style to provide a </span><i>higher-order component </i><span>(as it’s called in React parlance), wrapped in an extra &lt;div&gt;<br/>to provide some visually distinctive details.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 65pt;text-indent: 0pt;text-align: justify;"><a name="bookmark466">A Redux decorator</a></p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;line-height: 115%;text-align: justify;"><span>If you have used Redux and the react - redux package, you may note that the latter’s<br/>connect () method is also a decorator in the same sense; it receives a component class,<br/>and returns a new component class, connected to the store, for usage in your forms. Refer to<br/>github . com/reduxj s/react - redux for more details.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;text-align: justify;">Let’s move to a different set of patterns that will let us change how functions perform.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 52pt;text-indent: 0pt;text-align: justify;"><a name="bookmark467">Strategy, Template, and Command</a></p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>The Strategy pattern applies whenever you want to have the ability to change a class, method, or<br/>function, possibly in a dynamic way, by changing the way it actually does whatever it’s expected to do.<br/>For example, a GPS application might want to find a route between two places by applying different<br/>strategies if the person is on foot, rides a bicycle, or goes by car. In that case, the fastest or the shortest<br/>routes might be desired. The problem is the same, but different algorithms must be applied, depending<br/>on the given condition.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 319pt;text-indent: 0pt;text-align: left;">Object-oriented design patterns     421</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Does this sound familiar? If so, it is because we have already met a similar problem. When we wanted<br/>to sort a set of strings in different ways, in </span><i>Chapter 3, Starting Out with Functions, </i><span>we needed a way<br/>to specify how the ordering was to be applied or, equivalently, how to compare two given strings<br/>and determine which had to go first. Depending on the language, we had to sort applying different<br/>comparison methods.</span></p><p style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Before trying an FP solution, let’s consider more ways of implementing our routing function. You<br/>could make do by having a big enough piece of code, which would receive an argument declaring<br/>which algorithm to use, plus the starting and ending points. With these arguments, the function could<br/>do a switch or something similar to apply the correct path-finding logic. The code would be roughly<br/>equivalent to the following fragment:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 65pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>function findRoute(byMeans, fromPoint, toPoint) {<br/>switch   (byMeans)   {</span></p><p style="padding-left: 77pt;text-indent: 0pt;text-align: left;">case &quot;foot&quot;:</p><p class="s17" style="padding-top: 3pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">/*</p><p style="padding-top: 2pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">find the shortest road for a walking person</p><p class="s17" style="padding-top: 3pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">*/</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 76pt;text-indent: 0pt;text-align: left;">case &quot;bicycle&quot;:</p><p class="s17" style="padding-top: 3pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">/*</p><p style="padding-top: 2pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">find a route apt for a cyclist</p><p class="s17" style="padding-top: 3pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">*/</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 76pt;text-indent: 0pt;text-align: left;">case &quot;car-fastest&quot;:</p><p class="s17" style="padding-top: 3pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">/*</p><p style="padding-top: 2pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">find the fastest route for a car driver</p><p class="s17" style="padding-top: 3pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">*/</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 77pt;text-indent: 0pt;text-align: left;">case      &quot;car-shortest&quot;:</p><p style="padding-top: 5pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">/*</p><p style="padding-top: 3pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">find the shortest route for a car driver</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 76pt;text-indent: 0pt;text-align: left;">default:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 8pt;padding-left: 76pt;text-indent: 0pt;line-height: 141%;text-align: left;"><span>plot a straight line, or throw an error,<br/>or whatever suits you</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">422  Implementing Design Patterns -The Functional Way</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 86pt;text-indent: 0pt;text-align: left;">*/</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>This kind of solution is not desirable, and your function is the sum of many distinct other functions,<br/>which doesn’t offer a high level of cohesion. If your language doesn’t support lambda functions (as<br/>was the case with Java, for example, until Java 8 came out in 2014), the OOP solution for this requires<br/>defining classes that implement the different strategies you may want, creating an appropriate object,<br/>and passing it around.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>With FP in JavaScript, implementing strategies is trivial; instead of using a variable such as byMeans<br/>to switch, you provide a route-finding function (routeAlgorithm () in the following code) that<br/>will implement the desired path logic:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 73pt;text-indent: -11pt;line-height: 146%;text-align: left;"><span>function     findRoute(routeAlgorithm,     fromPoint,     toPoint)     {<br/>return routeAlgorithm(fromPoint, toPoint);</span></p><p class="s17" style="padding-left: 62pt;text-indent: 0pt;line-height: 13pt;text-align: left;">}</p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>You would still have to implement all of the desired strategies (there’s no way around that) and decide<br/>which function to pass to f indRoute (), but now that function is independent of the routing logic,<br/>and if you wanted to add new routing algorithms, you wouldn’t touch f indRoute ().</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>If you consider the Template pattern, the difference is that Strategy allows you to use completely<br/>different ways of achieving an outcome, while Template provides an overarching algorithm (or template)<br/>in which some implementation details are left to methods to be specified. In the same way, you can<br/>provide functions to implement the Strategy pattern; you can also provide them for a Template pattern.</span></p><p style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Finally, the Command pattern also benefits from the ability to be able to pass functions as arguments.<br/>This pattern is meant to be enabled to encapsulate a request as an object, so for different requests,<br/>you have differently parameterized objects. Given that we can pass functions as arguments to other<br/>functions, there’s no need for the enclosing object.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;">We also saw a similar use of this pattern back in the <i>A React-Redux reducer </i>section of <i>Chapter 3,</i><span>There, we defined a table, each of whose entries was a callback that was<br/>called whenever needed. We could directly say that the Command pattern is just an </span><b>object-oriented</b></p><p style="padding-left: 53pt;text-indent: 0pt;line-height: 10pt;text-align: justify;">(00) replacement for plain functions working as callbacks.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Let’s now consider a related pattern, Dependency Injection, that will also let us change how a method<br/>or function works.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 53pt;text-indent: 0pt;text-align: justify;"><a name="bookmark468">Dependency Injection</a></p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: justify;"><span>In basic terms, Dependency Injection is a pattern in which an object or function receives any other<br/>objects or functions that it needs to do its job, leading to less coupling and more flexibility. With this</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 319pt;text-indent: 0pt;text-align: left;">Object-oriented design patterns     423</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>technique, a service can work in multiple environments or with different configurations, and changing<br/>it may be achieved without having to modify its code.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>To make things clearer, let’s consider a service, implemented in Node plus Express, that gets a request,<br/>interacts with other entities (maybe it queries a database, accesses some file buckets, posts a message to<br/>a message queue, calls some other services, etc.) and eventually builds a response to send back. What’s<br/>wrong with this? A quick answer would be </span><i>“Nothing!” </i><span>because it works, and it’s how many services are<br/>implemented. However, digging a bit further, we may decide the answer should be </span><i>“Everythingl” </i>Why?</p><p style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;text-align: justify;">With any piece of code, there always are three primary concerns:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l138"><li data-list-text="•"><p class="s9" style="padding-left: 70pt;text-indent: -13pt;line-height: 124%;text-align: justify;">Is it understandable? <span class="p">Our service’s code may be hard to follow because it mixes business logic<br/>concerns with implementation details, concerning secondary matters such as how to query<br/>the database and access the buckets.</span></p></li><li data-list-text="•"><p class="s9" style="padding-top: 5pt;padding-left: 70pt;text-indent: -13pt;line-height: 123%;text-align: justify;">Is it maintainable? <span class="p">If we wonder how simple it may be to change our service’s code, the question<br/>is how many reasons for change there may be. A change in business logic is always a possibility;<br/>that’s essential. However, other changes (using Redis instead of MySQL or adding records to a<br/>database table instead of sending messages to a queue) that aren’t related to the service’s business<br/>objectives would also require changes in code.</span></p></li><li data-list-text="•"><p class="s9" style="padding-top: 5pt;padding-left: 70pt;text-indent: -13pt;line-height: 124%;text-align: justify;">Is it testable? <span class="p">We may or may not need to maintain the code (and, indeed, if any changes are<br/>needed, that would be in the future), but we have to test our code today. How would we go<br/>about it? Would it be easy?</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>The last item is the one we care about now. All the interactions with other entities are clearly impure<br/>functions, so we could set up our tests in three ways.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="•"><p class="s33" style="padding-left: 70pt;text-indent: -12pt;line-height: 123%;text-align: justify;">	<span class="p">We could work with separate, special environments. Each developer would need to have a<br/>complete environment (with databases, queues, servers, etc.) so code can run as in reality.<br/>To do a test, the developer should first set everything up in a known fashion and then check<br/>whether the database got modified correctly, if the right messages were sent, and so on. All<br/>this is possible but costly, hard to set up, and mainly slow - before each test, you have to reset<br/>everything, and after each test, you have to check everything.</span></p></li><li data-list-text="•"><p class="s33" style="padding-top: 5pt;padding-left: 70pt;text-indent: -12pt;line-height: 124%;text-align: justify;">	<span class="p">We could work with fully mocked external entities. Tools such as Jest or Jasmine allow us to<br/>mock entities, so our code, instead of dealing with actual databases, queues, services, and so<br/>on would (transparently) interact with mocks that mimic the needed behaviors. This is much<br/>more efficient (because no real environments are needed, no actual databases get updated, no<br/>messages are really sent, and so on), but simulating all the required behaviors is still a lot of work.</span></p></li><li data-list-text="•"><p style="padding-top: 5pt;padding-left: 70pt;text-indent: -12pt;line-height: 125%;text-align: justify;">We can make the service less impure first! We saw this approach back in <i>Chapter 4, Behaving</i>which allows us to easily write tests.</p></li></ul><p style="padding-top: 8pt;padding-left: 43pt;text-indent: 0pt;text-align: justify;">Let’s now get to actual details and consider a possible service.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">424  Implementing Design Patterns -The Functional Way</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s34" style="padding-left: 52pt;text-indent: 0pt;text-align: justify;">Implementing a service</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Imagine we have an endpoint that responds to GET /client/ : id requests by searching for the<br/>client in a database and posting a message to a queue after the search.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;">We’ll code our service in terms of <i>ports </i>(interfaces) and <i>adapters </i><span>(interface implementations) that it<br/>will receive. In our case, ports will (abstractly) define how our service is meant to interact with other<br/>entities, and adapters will (concretely) implement the needed functionality. With this in mind, we will<br/>be able to provide different adapters, allowing flexibility for different environments. In a production<br/>environment, we’ll provide adapters that work, access databases, post messages, and so on, but for<br/>testing, we’ll be able to inject mock adapters with trivial “do nothing” fake implementations.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 65pt;text-indent: 0pt;text-align: justify;"><a name="bookmark469">An architecture by any other name</a></p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;line-height: 115%;text-align: justify;"><span>This architectural style is naturally known as “Ports and Adapters,” but it also goes by “Hexagonal<br/>Architecture” - a much catchier name! Don’t try to figure out why the word “hexagonal” is<br/>used;   it just refers to hexagons being used to represent services in diagrams, and nothing else!</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: justify;"><span>Let’s see how this would work. If our service needs to look for a client by its ID in a database, we must<br/>define a suitable interface, a “find client” port. We could define the following:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 61pt;text-indent: 0pt;text-align: left;">type  <b>FindClientPort  =  (</b></p><p style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">id: number</p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">) =&gt; Promise&lt;ClientType | null&gt;;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>This definition says that our port will receive a numerical ID as an argument and return a promise<br/>that will either resolve to a Client Type object or null. (We cannot specify semantic aspects, but<br/>it sounds likely that the returned object will be the client, if found; null would represent a failed<br/>search.) We also require an actual implementation:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 74pt;text-indent: -12pt;line-height: 144%;text-align: left;">const    findClientFromDBAdapter:    <b>FindClientPort    =    </b><span>async    (<br/>id: number</span></p><p style="padding-top: 2pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">) =&gt; {</p><p style="padding-top: 2pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">// access the database, do the search, etc., and</p><p style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">// return a promise to get the client from DB</p><p style="padding-top: 6pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">};</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Naming is important; the port definition does not say where the client will come from, but the adapter<br/>does. We could have different adapters that would look for clients in other places (a key store, a<br/>spreadsheet, or the filesystem), but they would all implement the same interface.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Of course, given our service definition, we’ll also need a port and adapter for sending messages. How<br/>would we now write our service? The code would be as follows:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 319pt;text-indent: 0pt;text-align: left;">Object-oriented design patterns     425</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">function getClientService(id: number,</p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">{ findClient, sendMsg } =</p><p class="s10" style="padding-top: 4pt;padding-left: 77pt;text-indent: -11pt;line-height: 143%;text-align: left;"><span>{ findClient: findClientFromDBAdapter,<br/>sendMsg: sendMsgToMQAdapter }) {</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>What are we doing? Our service receives id and an optional object providing two adapters. If this object<br/>is omitted, our service will use default adapters that work with a database and a message queue. In our<br/>server, the code dealing with the /client/ : id endpoint would use getClientService (req.<br/>params .id) and, thus, work with an actual database and a message queue. But how will we test<br/>our service? That’s what we need to see now.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s34" style="padding-left: 44pt;text-indent: 0pt;text-align: justify;">Testing a service</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: justify;"><span>In the previous section, we saw how to call our service in production. However, for testing, we would<br/>do things differently, such as the following:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;line-height: 143%;text-align: left;"><span>findClientMock = jest.fn().mockResolvedValue(...);<br/>sendMsgMock = jest.fn().mockReturnValue(...);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">result = await getClientService(22,</p><p class="s10" style="padding-top: 4pt;padding-left: 77pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>{ findClient: findClientMock,<br/>sendMsg: sendMsgMock });</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>expect(findClientMock).toHaveBeenCalledWith(22);<br/>expect(sendMsgMock).toHaveBeenCalledWith(...);<br/>expect(result)                                        .toMatchObj ect(...);</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 115%;text-align: justify;"><span>We would first define a couple of mock functions; f indClientMock would simulate a search in<br/>the database, and sendMsgMock would return whatever a successful message-sending operation<br/>would return. We can now call our getClientService () with the mocks, and we would then<br/>verify that the (mock) adapters were used properly and that the service returns the correct answer.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;">Lets now move on to a classic pattern that implies a new term, <i>reactive programming, </i><span>which is being<br/>thrown around a lot these days.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 43pt;text-indent: 0pt;text-align: justify;"><a name="bookmark470">Observers and reactive programming</a></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>The idea of the Observer pattern is to define a link between entities so that when one changes, all<br/>dependent entities are updated automatically. An </span><i>observable </i><span>can publish changes to its state, and its<br/>observer (which subscribed to the observable) will be notified of such changes.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">426  Implementing Design Patterns -The Functional Way</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 65pt;text-indent: 0pt;text-align: justify;"><a name="bookmark471">No observables for now</a></p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;line-height: 115%;text-align: justify;"><span>There is a proposal for adding observables to JavaScript (see github. com/ tc3 9/proposal -<br/>observable), but as of January 2023, it’s still stuck at stage one, with no activity since late<br/>2020. Hence, for the time being, using a library will still be mandatory.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;">There’s an extension to this concept called <b>reactive programming, </b><span>which involves asynchronous<br/>streams of events (such as mouse clicks or keypresses) or data (from APIs or WebSockets), and different<br/>parts of the application subscribing to observe such streams by passing callbacks that will get called<br/>whenever something new appears.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>We won’t be implementing reactive programming on our own; instead, we’ll use RxJS, a JavaScript<br/>implementation of Reactive Extensions </span><i>(ReactiveX), </i><a href="http://www/" class="s11" target="_blank">initially developed by Microsoft. RxJS is widely<br/>used    in the Angular framework and can also be used in other frontend frameworks, such as React<br/>or Vue, or the backend with Node.js. Learn more about RxJS at rxj s-dev. f irebaseapp . com<br/>and </a>www. learnrxj s . io.</p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;">The techniques we will be showing in these sections are, confusingly, called both <b>functional reactive</b>and <b>reactive functional programming (RFP); </b><span>pick whichever you want! There<br/>is    also a suggestion that FRP shouldn’t be applied to discrete streams (so the name is wrong) but the<br/>expression is seen all over the web, which gives it some standing. But what makes this functional,<br/>and  why should we be interested in it? The key is that we will be using similar methods to map (),<br/>f i Iter (), and reduce () to process those streams and pick which events to process and how.<br/>Okay, this may be confusing now, so bear with me and let’s see some concepts first, and after that,<br/>some examples of FRP - or whatever you want to call it! We will be seeing the following:</span></p><ul id="l139"><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 79pt;text-indent: -13pt;text-align: left;">Several basic concepts and terms you’ll need to work with FRP</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 79pt;text-indent: -13pt;text-align: left;">Some of the many available operators you’ll use</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 52pt;text-indent: 13pt;line-height: 212%;text-align: left;"><span>A couple of examples - detecting multi-clicks and providing typeahead searches<br/>Let’s proceed to analyze each item, starting with the basic ideas you need to know.<br/></span><span class="s34">Basic concepts and terms</span></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 9pt;text-align: justify;">Using FRP requires getting used to several new terms, so let’s begin with a short glossary:</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="•"><p class="s10" style="padding-left: 79pt;text-indent: -13pt;line-height: 124%;text-align: justify;">Observable: <span class="p">This represents a stream of (present or future) values and can be connected to an<br/>observer. You can create observables from practically anything, but the most common case<br/>is  from events. By convention, observable variable names end with $; see angular . io/<br/>guide/rx-library#naming-conventions.</span></p></li><li data-list-text="•"><p class="s33" style="padding-top: 5pt;padding-left: 79pt;text-indent: -12pt;line-height: 124%;text-align: justify;">	<span class="s10">Observer: </span><span class="p">This is either a callback that is executed whenever the observable it’s subscribed to<br/>produces a new value, or an object with three methods, next (), error (), and complete (),<br/>which will be called by the observable when a value is available, when there’s an error, and<br/>when the stream is ended respectively.</span></p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 319pt;text-indent: 0pt;text-align: left;">Object-oriented design patterns     427</p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l140"><li data-list-text="•"><p style="padding-left: 70pt;text-indent: -12pt;line-height: 123%;text-align: left;"><span class="s33">	</span><b>Operators: </b>These are pure functions (similar to map (), filter (), and so on, from <i>Chapter 5,</i>that let you apply transformations to a stream in a declarative way.</p></li><li data-list-text="•"><p class="s10" style="padding-top: 5pt;padding-left: 70pt;text-indent: -13pt;line-height: 123%;text-align: left;">Pipe: <span class="p">This is a way to define a pipeline of operators that will be applied to a stream. This is<br/>similar to the pipeline () function we developed in </span><i>Chapter 8, Connecting Functions.</i></p></li><li data-list-text="•"><p class="s10" style="padding-top: 5pt;padding-left: 70pt;text-indent: -12pt;line-height: 126%;text-align: left;">Subscription: <span class="p">This is the connection to an observable. An observable doesn’t do anything until<br/>you call the subscribe () method, providing an observer.</span></p><p style="padding-top: 8pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>An interesting way of looking at observables is that they complete the lower row of this table - check it<br/>out. You will probably be quite familiar with the </span><i>Single </i>column, but maybe not with the <i>Multiple </i>one:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><table style="border-collapse:collapse;margin-left:91.43pt" cellspacing="0"><tr style="height:15pt"><td style="width:100pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:99pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s188" style="padding-top: 3pt;padding-left: 33pt;padding-right: 32pt;text-indent: 0pt;text-align: center;">Single</p></td><td style="width:101pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s188" style="padding-top: 3pt;padding-right: 33pt;text-indent: 0pt;text-align: right;">Multiple</p></td></tr><tr style="height:15pt"><td style="width:100pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s188" style="padding-top: 3pt;padding-left: 40pt;padding-right: 39pt;text-indent: 0pt;text-align: center;">Pull</p></td><td style="width:99pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s29" style="padding-top: 1pt;padding-left: 33pt;padding-right: 32pt;text-indent: 0pt;text-align: center;">Function</p></td><td style="width:101pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s29" style="padding-top: 1pt;padding-left: 36pt;padding-right: 35pt;text-indent: 0pt;text-align: center;">Iterator</p></td></tr><tr style="height:16pt"><td style="width:100pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s188" style="padding-top: 2pt;padding-left: 40pt;padding-right: 39pt;text-indent: 0pt;text-align: center;">Push</p></td><td style="width:99pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s29" style="padding-top: 1pt;padding-left: 33pt;padding-right: 32pt;text-indent: 0pt;text-align: center;">Promise</p></td><td style="width:101pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s29" style="padding-top: 1pt;padding-right: 29pt;text-indent: 0pt;text-align: right;">Observable</p></td></tr></table><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>How do we interpret this table? The rows distinguish between pull (you call something) and push<br/>(you get called), and the columns represent how many values you get - one or many. With these<br/>descriptions, we can see the following:</span></p></li><li data-list-text="•"><p style="padding-top: 9pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">A function is called and returns a single value</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">A promise calls your code (a callback in the then () method), also with a single value</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">An iterator returns a new value each time it’s called - at least until the sequence is over</p></li><li data-list-text="•"><p class="s33" style="padding-top: 8pt;padding-left: 70pt;text-indent: -12pt;line-height: 123%;text-align: left;">	<span class="p">An observable calls your code (provided you subscribe () to the observable) for each<br/>value in the stream</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: justify;">Observables and promises can be compared a bit more:</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="•"><p style="padding-left: 70pt;text-indent: -13pt;text-align: left;">They are both mostly async in nature, and your callback will be called at an indefinite future time</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">Promises cannot be canceled, but you can unsubscribe () from an observable</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;line-height: 123%;text-align: left;"><span>Promises start executing the moment you create them; observables are lazy, and nothing happens<br/>until an observer does subscribe () to them</span></p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: justify;">The real power of observables derives from the variety of operators you can use; let’s see some of them.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s34" style="padding-left: 43pt;text-indent: 0pt;text-align: justify;">Operators for observables</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><a href="http://www/" class="s11" target="_blank">Basically, operators are just functions. Creation operators can be used to create observables out of<br/>many different sources, and pipeable operators can be applied to modify a stream, producing a new<br/>observable; we’ll see many families of these, but for complete lists and descriptions, you should access<br/></a>www. learnrxj s.io/learn-rxj s/operators and rxj s.dev/guide/operators.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">428  Implementing Design Patterns -The Functional Way</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Also, we won’t be covering how to install RxJS; see rxj s . dev/guide/ installation for all the<br/>possibilities. In particular, in our examples, meant for a browser, we’ll be installing RxJS from a CDN,<br/>which creates a global rxj s variable, similar to jQuery’s $ or Lodash’s _ variables.</span></p><p style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: justify;"><span>Let’s begin by creating observables, and then move on to transforming them. For creation, some of<br/>the several operators you can use are explained in the following table:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><table style="border-collapse:collapse;margin-left:52.08pt" cellspacing="0"><tr style="height:16pt"><td style="width:92pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s188" style="padding-top: 3pt;padding-left: 27pt;text-indent: 0pt;text-align: left;">Operator</p></td><td style="width:304pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s188" style="padding-top: 3pt;padding-left: 138pt;padding-right: 139pt;text-indent: 0pt;text-align: center;">Usage</p></td></tr><tr style="height:28pt"><td style="width:92pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s19" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">Aj ax</p></td><td style="width:304pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s29" style="padding-left: 5pt;padding-right: 17pt;text-indent: 0pt;line-height: 13pt;text-align: left;"><span>Creates an observable for an Ajax request, for which we’ll emit the response<br/>that is returned</span></p></td></tr><tr style="height:15pt"><td style="width:92pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s19" style="padding-left: 6pt;text-indent: 0pt;text-align: left;">from</p></td><td style="width:304pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s29" style="padding-top: 2pt;padding-left: 6pt;text-indent: 0pt;text-align: left;">Produces an observable out of an array, an iterable, or a promise</p></td></tr><tr style="height:15pt"><td style="width:92pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s19" style="padding-left: 6pt;text-indent: 0pt;text-align: left;">fromEvent</p></td><td style="width:304pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s29" style="padding-top: 2pt;padding-left: 6pt;text-indent: 0pt;text-align: left;">Turns events (for example, mouse clicks) into an observable sequence</p></td></tr><tr style="height:15pt"><td style="width:92pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s19" style="padding-left: 6pt;text-indent: 0pt;text-align: left;">interval</p></td><td style="width:304pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s29" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">Emits values at periodic intervals</p></td></tr><tr style="height:15pt"><td style="width:92pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s19" style="padding-left: 6pt;text-indent: 0pt;text-align: left;">of</p></td><td style="width:304pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s29" style="padding-top: 2pt;padding-left: 6pt;text-indent: 0pt;text-align: left;">Generates a sequence out of a given set of values</p></td></tr><tr style="height:15pt"><td style="width:92pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s19" style="padding-left: 6pt;text-indent: 0pt;text-align: left;">range</p></td><td style="width:304pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s29" style="padding-top: 2pt;padding-left: 6pt;text-indent: 0pt;text-align: left;">Produces a sequence of values in a range</p></td></tr><tr style="height:16pt"><td style="width:92pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s19" style="padding-left: 6pt;text-indent: 0pt;text-align: left;">timer</p></td><td style="width:304pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s29" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">After an initial delay, emits values periodically</p></td></tr></table><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>To give an elementary example, the following three observables will all produce a sequence of values<br/>from 1 to 10, and we’ll be seeing more practical examples a bit later in this chapter:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 61pt;text-indent: 0pt;line-height: 117%;text-align: justify;"><span>const  obsl$  =  from([l,  2,<br/>const  obs2$  =  of(l,  2,  3,<br/>const obs3$ = range(1, 10</span></p><p class="s17" style="padding-top: 8pt;padding-left: 7pt;text-indent: 0pt;text-align: left;">3, 4, 5, 6, 7, 8, 9, 10]) ;</p><p class="s17" style="padding-top: 1pt;padding-left: 7pt;text-indent: 0pt;text-align: left;">4 , 5, 6, 7, 8, 9, 10);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>The available pipeable operators are way too many for this section, so we’ll just go over some families<br/>and describe their basic idea, with one or two particular mentions. The following table lists the most<br/>common families, with their most often used operators:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><table style="border-collapse:collapse;margin-left:52.08pt" cellspacing="0"><tr style="height:16pt"><td style="width:78pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s188" style="padding-top: 3pt;padding-left: 25pt;text-indent: 0pt;text-align: left;">Family</p></td><td style="width:318pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s188" style="padding-top: 3pt;padding-left: 136pt;padding-right: 136pt;text-indent: 0pt;text-align: center;">Description</p></td></tr><tr style="height:52pt"><td style="width:78pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" rowspan="2"><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s242" style="padding-left: 4pt;text-indent: 0pt;text-align: left;">Combination</p></td><td style="width:318pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s29" style="padding-top: 2pt;padding-left: 4pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>These operators allow us to join information from several distinct observables,<br/>including the following:</span></p><ul id="l141"><li data-list-text="•"><p class="s19" style="padding-top: 7pt;padding-left: 24pt;text-indent: -6pt;text-align: left;">concat () <span class="s243">to put observables in a queue one after the other</span></p></li></ul></td></tr><tr style="height:54pt"><td style="width:318pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><ul id="l142"><li data-list-text="•"><p class="s19" style="padding-top: 2pt;padding-left: 31pt;text-indent: -13pt;text-align: left;">merge () <span class="s243">to create a single observable out of many</span></p></li><li data-list-text="•"><p class="s19" style="padding-top: 5pt;padding-left: 31pt;text-indent: -13pt;text-align: left;">pairWiseO <span class="s243">to emit the previous value and the current one as an array</span></p></li><li data-list-text="•"><p class="s19" style="padding-top: 5pt;padding-left: 31pt;text-indent: -13pt;text-align: left;">startWithO <span class="s243">to inject a value in an observable</span></p></li></ul></td></tr></table><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 319pt;text-indent: 0pt;text-align: left;">Object-oriented design patterns     429</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><table style="border-collapse:collapse;margin-left:43.18pt" cellspacing="0"><tr style="height:16pt"><td style="width:78pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s188" style="padding-top: 3pt;padding-left: 25pt;text-indent: 0pt;text-align: left;">Family</p></td><td style="width:318pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s188" style="padding-top: 3pt;padding-left: 136pt;padding-right: 136pt;text-indent: 0pt;text-align: center;">Description</p></td></tr><tr style="height:100pt"><td style="width:78pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s242" style="padding-left: 4pt;text-indent: 0pt;text-align: left;">Conditional</p></td><td style="width:318pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s29" style="padding-top: 2pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">These produce values depending on conditions and include the following:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l143"><li data-list-text="•"><p class="s244" style="padding-left: 31pt;padding-right: 3pt;text-indent: -13pt;line-height: 123%;text-align: left;">	<span class="s29">def ault If Empty () emits a value if an observable doesn’t emit<br/>anything before completing</span></p></li><li data-list-text="•"><p class="s29" style="padding-top: 5pt;padding-left: 31pt;text-indent: -13pt;text-align: left;">every () emits true if all values satisfy a predicate and emits false otherwise</p></li><li data-list-text="•"><p class="s244" style="padding-top: 6pt;padding-left: 31pt;padding-right: 4pt;text-indent: -13pt;line-height: 13pt;text-align: left;">	<span class="s29">i i f () subscribes to one of two observables, depending on a condition,<br/>such as the ternary ? operator</span></p></li></ul></td></tr><tr style="height:68pt"><td style="width:78pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s242" style="padding-left: 4pt;text-indent: 0pt;text-align: left;">Error handling</p></td><td style="width:318pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s29" style="padding-top: 2pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">These (obviously!) apply to error conditions and include the following:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l144"><li data-list-text="•"><p class="s29" style="padding-left: 31pt;text-indent: -13pt;text-align: left;">catchErrorO to gracefully process an error from an observable</p></li><li data-list-text="•"><p class="s244" style="padding-top: 6pt;padding-left: 31pt;padding-right: 4pt;text-indent: -12pt;line-height: 13pt;text-align: left;">	<span class="s29">retry () and retryWhen () to retry an observable sequence (most<br/>likely, one linked to HTTP requests)</span></p></li></ul></td></tr><tr style="height:244pt"><td style="width:78pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s242" style="padding-left: 4pt;text-indent: 0pt;text-align: left;">Filtering</p></td><td style="width:318pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s29" style="padding-top: 2pt;padding-left: 4pt;padding-right: 3pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Probably the most important family, providing many operators to process<br/>sequences by selecting which elements will get processed or dismissed, by<br/>applying different types of conditions for your selection. Some of the more<br/>common ones include the following:</span></p><ul id="l145"><li data-list-text="•"><p class="s244" style="padding-top: 8pt;padding-left: 31pt;padding-right: 4pt;text-indent: -13pt;line-height: 123%;text-align: left;">	<span class="s29">debounce () and debounceTime () to deal with values too close<br/>together in time</span></p></li><li data-list-text="•"><p class="s244" style="padding-top: 5pt;padding-left: 31pt;padding-right: 4pt;text-indent: -13pt;line-height: 126%;text-align: left;">	<span class="s29">distinctUntilChanged  ()  to  only  emit  when  the  new  value is<br/>different from the last</span></p></li><li data-list-text="•"><p class="s29" style="padding-top: 5pt;padding-left: 31pt;text-indent: -13pt;text-align: left;">filter () to only emit values that satisfy a given predicate</p></li><li data-list-text="•"><p class="s29" style="padding-top: 7pt;padding-left: 31pt;text-indent: -13pt;text-align: left;">f ind () to emit only the first value that satisfies a condition</p></li><li data-list-text="•"><p class="s29" style="padding-top: 8pt;padding-left: 31pt;text-indent: -13pt;text-align: left;">firstO and 1 a s t () to pick only the first or last values of a sequence</p></li><li data-list-text="•"><p class="s29" style="padding-top: 8pt;padding-left: 31pt;text-indent: -13pt;text-align: left;">skip () plus skipUntil () and skipwhile () to discard values</p></li><li data-list-text="•"><p class="s244" style="padding-top: 8pt;padding-left: 31pt;padding-right: 4pt;text-indent: -12pt;line-height: 125%;text-align: left;">	<span class="s29">take() and takeLast () to pick a given number of values from the<br/>beginning or end of a sequence</span></p></li><li data-list-text="•"><p class="s29" style="padding-top: 5pt;padding-left: 31pt;text-indent: -13pt;text-align: left;">takeUntil () and takeWhile () to pick values and more</p></li></ul></td></tr></table><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">430  Implementing Design Patterns -The Functional Way</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><table style="border-collapse:collapse;margin-left:52.08pt" cellspacing="0"><tr style="height:16pt"><td style="width:78pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s188" style="padding-top: 3pt;padding-left: 24pt;text-indent: 0pt;text-align: left;">Family</p></td><td style="width:318pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s188" style="padding-top: 3pt;padding-left: 136pt;padding-right: 136pt;text-indent: 0pt;text-align: center;">Description</p></td></tr><tr style="height:192pt"><td style="width:78pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s242" style="padding-top: 8pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">Transforming</p></td><td style="width:318pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s29" style="padding-top: 2pt;padding-left: 4pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>The other very commonly used family, which includes operators to transform<br/>the values in a sequence. Some of the many possibilities include these:</span></p><ul id="l146"><li data-list-text="•"><p class="s244" style="padding-top: 8pt;padding-left: 31pt;padding-right: 4pt;text-indent: -13pt;line-height: 125%;text-align: left;">	<span class="s29">buffer () and buff erTime () to collect values and emit them as<br/>an array</span></p></li><li data-list-text="•"><p class="s29" style="padding-top: 5pt;padding-left: 31pt;text-indent: -12pt;text-align: left;">groupBy () to group values together based on some property</p></li><li data-list-text="•"><p class="s29" style="padding-top: 8pt;padding-left: 31pt;text-indent: -12pt;text-align: left;">map () to apply a given mapping function to every element in the sequence</p></li><li data-list-text="•"><p class="s29" style="padding-top: 8pt;padding-left: 31pt;text-indent: -12pt;text-align: left;">partition () to split an observable into two, based on a given predicate</p></li><li data-list-text="•"><p class="s29" style="padding-top: 7pt;padding-left: 31pt;text-indent: -12pt;text-align: left;">pluck () to pick only some attributes from each element</p></li><li data-list-text="•"><p class="s29" style="padding-top: 8pt;padding-left: 31pt;text-indent: -12pt;text-align: left;">reduce () to reduce a sequence of values to a single one</p></li><li data-list-text="•"><p class="s29" style="padding-top: 8pt;padding-left: 31pt;text-indent: -12pt;text-align: left;">scan () works like reduce () but emits all intermediate values</p></li><li data-list-text="•"><p class="s29" style="padding-top: 8pt;padding-left: 31pt;text-indent: -12pt;text-align: left;">toArray () collects all values and emits them as a single array</p></li></ul></td></tr><tr style="height:150pt"><td style="width:78pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s188" style="padding-left: 4pt;text-indent: 0pt;text-align: left;">Utilities</p></td><td style="width:318pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s29" style="padding-top: 2pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">A sundry collection of operators with different functions, including the following:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l147"><li data-list-text="•"><p class="s29" style="padding-left: 31pt;padding-right: 3pt;text-indent: -13pt;line-height: 123%;text-align: left;"><span class="s244">	</span>tap () to perform a side effect, similar to what we saw in the <i>Tapping</i>section in <i>Chapter 8, Connecting Functions</i></p></li><li data-list-text="•"><p class="s29" style="padding-top: 5pt;padding-left: 31pt;text-indent: -13pt;text-align: left;">delay () to delay sequence values for some time</p></li><li data-list-text="•"><p class="s244" style="padding-top: 8pt;padding-left: 31pt;padding-right: 3pt;text-indent: -12pt;line-height: 125%;text-align: left;">	<span class="s29">finalize  ()  to  call  a  function  when  an  observable  completes or<br/>produces an error</span></p></li><li data-list-text="•"><p class="s29" style="padding-top: 5pt;padding-left: 31pt;text-indent: -13pt;text-align: left;">repeat () is just like retry () but for normal (that is, non-error) cases</p></li><li data-list-text="•"><p class="s244" style="padding-top: 6pt;padding-left: 31pt;padding-right: 4pt;text-indent: -13pt;line-height: 13pt;text-align: left;">	<span class="s29">timeout () to produce an error if no value is produced before a<br/>given duration</span></p></li></ul></td></tr></table><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>Wow, that’s a lot of operators! We have excluded many, and you could even write your own, so be sure<br/>to look at the documentation. By the way, understanding operators is easier with marble diagrams;</span></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 11pt;text-align: left;">we won’t be using them here, but read <span class="s245">reactivex. io/documentation/observable .</span></p><p class="s17" style="padding-left: 52pt;text-indent: 0pt;line-height: 114%;text-align: left;">html <span class="s246">for a basic explanation, and then check out </span>rxmarbles . com <span class="s246">for many interactive examples<br/>of operators and how they function.</span></p><p style="padding-top: 8pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">Let’s finish this section with a couple of examples of the possibility of application for your own coding.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s34" style="padding-left: 52pt;text-indent: 0pt;text-align: left;">Detecting multi-clicks</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: left;"><span>Suppose you decided, for some reason or another, that users should be able to triple-click or four-click<br/>on something, and the number of clicks would somehow be meaningful and produce some kind of<br/>result. Browsers do very well detecting single- or double-clicks and letting you respond to them, but<br/>triple- (or more) clicks aren’t available so easily.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 319pt;text-indent: 0pt;text-align: left;">Object-oriented design patterns     431</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>However, we can make do with a bit of FRP. Let’s start with a truly basic layout, including a text span<br/>that the user should click. The code is given here:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">&lt;html&gt;</p><p class="s17" style="padding-top: 2pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">&lt;head&gt;</p><p class="s17" style="padding-top: 2pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">&lt;title&gt;Multiple click example&lt;/title&gt;</p><p class="s17" style="padding-top: 2pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">&lt;script</p><p class="s17" style="padding-top: 2pt;padding-left: 89pt;text-indent: 0pt;line-height: 118%;text-align: left;"><span>type=&quot;text/javascript&quot;<br/>src=&quot;rxj s.umd. j s&quot;</span></p><p class="s17" style="padding-left: 77pt;text-indent: 0pt;line-height: 13pt;text-align: left;">&gt;&lt;/script&gt;</p><p class="s17" style="padding-top: 2pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">&lt;/head&gt;</p><p class="s17" style="padding-top: 2pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">&lt;body&gt;</p><p class="s17" style="padding-top: 1pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">&lt;span id=&quot;mySpan&quot;</p><p class="s17" style="padding-top: 2pt;padding-left: 89pt;text-indent: 0pt;text-align: left;">&gt;Click this text many times (quickly)&lt;/span</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 77pt;text-indent: 0pt;text-align: left;">&lt;script&gt;</p><p class="s17" style="padding-top: 2pt;padding-left: 89pt;text-indent: 0pt;text-align: left;">// our code goes here...</p><p class="s17" style="padding-top: 2pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">&lt;/scripts</p><p class="s17" style="padding-top: 2pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">&lt;/body&gt;</p><p class="s17" style="padding-top: 2pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">&lt;/html&gt;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-bottom: 2pt;padding-left: 43pt;text-indent: 0pt;text-align: left;">This is as plain as can be; you just get a text on screen, urging you to multi-click it. See <i>Figure 11.3:</i></p><p style="text-indent: 0pt;line-height: 10pt;text-align: left;"><span style=" color: #E7CA57; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 9pt;">9 </span><span style=" color: #FFF; font-family:Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 9pt;">*</span></p><p class="s273" style="padding-top: 6pt;padding-left: 5pt;text-indent: 0pt;text-align: left;"><span style=" color: #120C39; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 6pt;">© </span>Triple Clicks</p><p class="s137" style="text-indent: 0pt;line-height: 8pt;text-align: center;">Triple Clicks ■ Google Chrome</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: center;"><span style=" color: #FFF; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 6.5pt;">1 </span><span style=" color: #DFE6D0; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 6.5pt;">New Tab</span></p><p style="padding-left: 17pt;text-indent: 0pt;line-height: 19pt;text-align: left;"><span class="s139">v / </span><span style=" background-color: #F3FAFB;">30 </span></p><p class="s355" style="padding-top: 2pt;text-indent: 0pt;text-align: left;"><span style=" color: #DFE6D0; font-family:Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 6pt; vertical-align: 1pt;">X I </span>+</p><p style="padding-left: 114pt;text-indent: 0pt;text-align: left;"/><p class="s248" style="padding-top: 3pt;padding-left: 121pt;text-indent: 0pt;text-align: left;"><span style=" color: #120C39;">&lt;- </span>-&gt; <span style=" color: #120C39;">C </span>© File | <span style=" color: #393953;">/data/fkereki_data/Dropbox/. </span>☆ Q <span style=" color: #120C39;">•</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s250" style="padding-top: 4pt;padding-left: 118pt;text-indent: 0pt;text-align: left;">Click this text many times (quickly)</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-left: 141pt;text-indent: 0pt;text-align: left;">Figure 11.3 - A very plain screen to test detecting triple-clicks</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 5pt;padding-left: 43pt;text-indent: 0pt;text-align: left;">To detect these multi-clicks, we’ll need some RxJS functions, so let’s start with those:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 52pt;text-indent: 0pt;line-height: 117%;text-align: left;"><span>const { fromEvent, pipe } = rxjs;<br/>const { buffer, filter } = rxjs.operators;</span></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>We will use these functions soon enough. How do we detect triple- (or more) clicks? Let’s go straight<br/>on to the code given here:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 64pt;text-indent: -12pt;line-height: 118%;text-align: left;"><span>const spanClick$ = fromEvent(<br/>document.getElementByld(&quot;mySpan&quot;),</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">432  Implementing Design Patterns -The Functional Way</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 74pt;text-indent: 0pt;text-align: left;">&quot;click&quot;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 43pt;text-indent: 0pt;text-align: center;">spanClick$</p><p class="s17" style="padding-top: 2pt;padding-left: 47pt;text-indent: 0pt;text-align: center;">•pipe(</p><p class="s17" style="padding-top: 2pt;padding-left: 85pt;text-indent: 0pt;line-height: 117%;text-align: left;"><span>buffer(spanClick$.pipe(debounceTime(250))),<br/>map((list) =&gt; list.length),</span></p><p class="s17" style="padding-left: 86pt;text-indent: 0pt;line-height: 13pt;text-align: left;">filter((x) =&gt; x &gt;= 3)</p><p class="s17" style="padding-top: 3pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">)</p><p class="s17" style="padding-top: 1pt;padding-left: 75pt;text-indent: 0pt;text-align: left;">.subscribe((e) =&gt; {</p><p class="s17" style="padding-top: 2pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">console.log(&#39;${e} clicks at ${new Dated}&#39;);</p><p class="s17" style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">});</p><p style="text-indent: 0pt;text-align: left;"><br/></p><table style="border-collapse:collapse;margin-left:59.18pt" cellspacing="0"><tr style="height:13pt"><td style="width:53pt"><p class="s19" style="padding-left: 2pt;text-indent: 0pt;line-height: 12pt;text-align: left;">/*</p></td><td style="width:220pt" colspan="5"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:15pt"><td style="width:53pt"><p class="s19" style="padding-left: 2pt;text-indent: 0pt;text-align: left;">5 clicks</p></td><td style="width:46pt"><p class="s19" style="padding-right: 3pt;text-indent: 0pt;text-align: right;">at Fri</p></td><td style="width:24pt"><p class="s19" style="padding-left: 2pt;padding-right: 2pt;text-indent: 0pt;text-align: center;">Feb</p></td><td style="width:18pt"><p class="s19" style="padding-left: 2pt;padding-right: 3pt;text-indent: 0pt;text-align: center;">03</p></td><td style="width:33pt"><p class="s19" style="padding-left: 3pt;text-indent: 0pt;text-align: left;">2023</p></td><td style="width:99pt"><p class="s19" style="padding-right: 2pt;text-indent: 0pt;text-align: right;">18:08:42GMT-0300</p></td></tr><tr style="height:15pt"><td style="width:53pt"><p class="s19" style="padding-left: 2pt;text-indent: 0pt;text-align: left;">3 clicks</p></td><td style="width:46pt"><p class="s19" style="padding-right: 3pt;text-indent: 0pt;text-align: right;">at Fri</p></td><td style="width:24pt"><p class="s19" style="padding-left: 2pt;padding-right: 2pt;text-indent: 0pt;text-align: center;">Feb</p></td><td style="width:18pt"><p class="s19" style="padding-left: 2pt;padding-right: 3pt;text-indent: 0pt;text-align: center;">03</p></td><td style="width:33pt"><p class="s19" style="padding-left: 3pt;text-indent: 0pt;text-align: left;">2023</p></td><td style="width:99pt"><p class="s19" style="padding-right: 2pt;text-indent: 0pt;text-align: right;">18:08:45GMT-0300</p></td></tr><tr style="height:15pt"><td style="width:53pt"><p class="s19" style="padding-left: 2pt;text-indent: 0pt;text-align: left;">6 clicks</p></td><td style="width:46pt"><p class="s19" style="padding-right: 3pt;text-indent: 0pt;text-align: right;">at Fri</p></td><td style="width:24pt"><p class="s19" style="padding-left: 2pt;padding-right: 2pt;text-indent: 0pt;text-align: center;">Feb</p></td><td style="width:18pt"><p class="s19" style="padding-left: 2pt;padding-right: 3pt;text-indent: 0pt;text-align: center;">03</p></td><td style="width:33pt"><p class="s19" style="padding-left: 3pt;text-indent: 0pt;text-align: left;">2023</p></td><td style="width:99pt"><p class="s19" style="padding-right: 2pt;text-indent: 0pt;text-align: right;">18:08:47GMT-0300</p></td></tr><tr style="height:16pt"><td style="width:53pt"><p class="s19" style="padding-left: 2pt;text-indent: 0pt;text-align: left;">4 clicks</p></td><td style="width:46pt"><p class="s19" style="padding-right: 3pt;text-indent: 0pt;text-align: right;">at Fri</p></td><td style="width:24pt"><p class="s19" style="padding-left: 3pt;padding-right: 2pt;text-indent: 0pt;text-align: center;">Feb</p></td><td style="width:18pt"><p class="s19" style="padding-left: 2pt;padding-right: 2pt;text-indent: 0pt;text-align: center;">03</p></td><td style="width:33pt"><p class="s19" style="padding-left: 3pt;text-indent: 0pt;text-align: left;">2023</p></td><td style="width:99pt"><p class="s19" style="padding-right: 2pt;text-indent: 0pt;text-align: right;">18:08:51GMT-0300</p></td></tr><tr style="height:15pt"><td style="width:53pt"><p class="s19" style="padding-top: 1pt;padding-left: 3pt;text-indent: 0pt;line-height: 12pt;text-align: left;">*/</p></td><td style="width:46pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:24pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:18pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:33pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:99pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr></table><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">The logic is simple:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><ol id="l148"><li data-list-text="1."><p style="padding-left: 79pt;text-indent: -17pt;text-align: justify;">We create an observable with f romEvent () to listen to mouse clicks on our span.</p></li><li data-list-text="2."><p class="s33" style="padding-top: 6pt;padding-left: 79pt;text-indent: -17pt;line-height: 124%;text-align: justify;">	<span class="p">Now, a tricky point - we use buffer () to join together many events, which come from<br/>applying debounceTime () to the sequence of clicks, so all clicks that happen within an<br/>interval of 250 milliseconds will get grouped into a single array.</span></p></li><li data-list-text="3."><p style="padding-top: 4pt;padding-left: 79pt;text-indent: -18pt;line-height: 123%;text-align: justify;"><span>We then apply map () to transform each array of clicks into just its length - after all, we care<br/>about how many clicks there were, not their specific details.</span></p></li><li data-list-text="4."><p style="padding-top: 4pt;padding-left: 78pt;text-indent: -17pt;text-align: justify;">We finish by filtering out values under 3, so only longer sequences of clicks will be processed.</p></li><li data-list-text="5."><p style="padding-top: 6pt;padding-left: 79pt;text-indent: -17pt;text-align: left;">The subscription just logs the clicks, but in your application, it should do something more relevant.</p></li></ol><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: left;">If you wanted, you could detect multi-clicks by hand, writing your own code; see <i>Question 11.3 in</i>the <i>Questions </i><span>section. Let’s finish with a longer example and do some typeahead searches, invoking<br/>some external API.</span></p><p class="s34" style="padding-top: 9pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">Providing typeahead searches</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>Let’s do another web example: typeahead searches. The usual setup is that there is some sort of textbox,<br/>the user types in it, and the web page queries an API to provide ways of completing the search. The</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 319pt;text-indent: 0pt;text-align: left;">Object-oriented design patterns     433</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>important thing is when and how to do the search, and try to avoid unnecessary calls to the backend<br/>server whenever possible. A (totally basic) HTML page could be as follows (see </span><i>Figure 11.4 </i><span>later in<br/>this section):</span></p><p class="s17" style="padding-top: 8pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">&lt;html&gt;</p><p class="s17" style="padding-top: 2pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">&lt;head&gt;</p><p class="s17" style="padding-top: 2pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">&lt;title&gt;Cities search&lt;/title&gt;</p><p class="s17" style="padding-top: 2pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">&lt;script</p><p class="s17" style="padding-top: 2pt;padding-left: 89pt;text-indent: 0pt;line-height: 115%;text-align: left;"><span>type=&quot;text/j avascript&quot;<br/>src=&quot;rxj s.umd. j s&quot;</span></p><p class="s17" style="padding-left: 77pt;text-indent: 0pt;text-align: left;">&gt;&lt;/script&gt;</p><p class="s17" style="padding-top: 2pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">&lt;/head&gt;</p><p class="s17" style="padding-top: 2pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">&lt;body&gt;</p><p class="s17" style="padding-top: 2pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">Find cities:</p><p class="s17" style="padding-top: 2pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">&lt;input type=&quot;text&quot; id=&quot;myText&quot; /&gt;</p><p class="s17" style="padding-top: 2pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">&lt;br /&gt;</p><p class="s17" style="padding-top: 2pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">&lt;h4&gt;Some cities &lt;/h4&gt;</p><p class="s17" style="padding-top: 2pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">&lt;div id=&quot;myResults&quot;&gt;&lt;/div&gt;</p><p class="s17" style="padding-top: 2pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">&lt;script&gt;</p><p class="s17" style="padding-top: 2pt;padding-left: 89pt;text-indent: 0pt;text-align: left;">// typeahead code goes here...</p><p class="s17" style="padding-top: 1pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">&lt;/script&gt;</p><p class="s17" style="padding-top: 2pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">&lt;/body&gt;</p><p class="s17" style="padding-top: 2pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">&lt;/html&gt;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: justify;"><span>We now have a single textbox in which the user will type and an area below that in which we’ll<br/>show whatever the API provides. We’ll use the GeoDB Cities API (see </span><span class="s245">geodb-cities-api .<br/>wiref reethought. com), </span><span>which provides many search options, to search for cities starting<br/>with whatever the user has typed. To get it out of our way, let’s look at the </span><span class="s245">getCitiesOrNull ()</span></p><p style="padding-top: 1pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>function, which will return a promise for search results (if something was typed in) or nul 1 (no cities,<br/>if nothing was typed in). The results of this promise will be used to fill the myResults division on<br/>the page. Let’s see how this works out in code:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">const URL = &#39;http://&#39; +</p><p class="s17" style="padding-top: 2pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">&#39;geodb-free-service.wirefreethought.com/vl/geo/cities&#39;;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 65pt;text-indent: -12pt;line-height: 118%;text-align: left;"><span>const getCitiesOrNull = (text) =&gt; {<br/>if (text) {</span></p><p class="s17" style="padding-left: 89pt;text-indent: -12pt;line-height: 118%;text-align: left;"><span>const citySearchUrl =<br/>&#39;${URL}?&#39; +</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">434  Implementing Design Patterns -The Functional Way</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 98pt;text-indent: 0pt;line-height: 115%;text-align: left;"><span>&#39;hateoasMode=false&amp;&#39;   +<br/>&#39;sort=-population&amp;&#39;    +</span></p><p class="s17" style="padding-left: 85pt;text-indent: 13pt;line-height: 114%;text-align: left;"><span>&#39;namePrefix=${encodeURIComponent(text)}&#39;;<br/>return;</span></p><p class="s17" style="padding-left: 86pt;text-indent: 0pt;text-align: left;">fetch(citySearchUrl);</p><p class="s17" style="padding-top: 2pt;padding-left: 75pt;text-indent: 0pt;text-align: left;">} else {</p><p class="s17" style="padding-top: 2pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">return Promise.resolve(null);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 62pt;text-indent: 0pt;text-align: left;">};</p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 111%;text-align: justify;"><span>The code is simple - if some text was provided, we generate the URL for the cities’ search and use<br/></span><span class="s245">fetch () </span><span>to get the API data. With this done, let’s see how to generate the needed observable. We<br/>will need some RxJS functions, so first, let’s have some definitions:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 61pt;text-indent: 0pt;line-height: 115%;text-align: left;"><span>const { fromEvent, pipe } = rxjs;<br/>const {</span></p><p class="s17" style="padding-left: 73pt;text-indent: 0pt;line-height: 117%;text-align: left;"><span>debounceTime,<br/>distinctUntilChanged,<br/>filter,</span></p><p class="s17" style="padding-left: 73pt;text-indent: 0pt;line-height: 117%;text-align: left;"><span>map,<br/>reduce,<br/>switchMap,</span></p><p class="s17" style="padding-left: 62pt;text-indent: 0pt;text-align: left;">} = rxjs.operators;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: justify;">We will be using all of these functions later. Now, we can write the code to do the typeahead:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 73pt;text-indent: -11pt;line-height: 117%;text-align: left;"><span>const textlnput$ = fromEvent(<br/>document.getElementByld(&quot;myText&quot;),<br/>&quot;input&quot;</span></p><p class="s17" style="padding-left: 62pt;text-indent: 0pt;text-align: left;">) .pipe (</p><p class="s17" style="padding-top: 2pt;padding-left: 73pt;text-indent: 0pt;line-height: 118%;text-align: left;"><span>map((e) =&gt; e.target.value),<br/>debounceTime(200),</span></p><p class="s17" style="padding-left: 73pt;text-indent: 0pt;line-height: 117%;text-align: left;"><span>filter((w) =&gt; w.length === 0 || w.length &gt; 3),<br/>distinctUntilChanged() ,</span></p><p class="s17" style="padding-left: 74pt;text-indent: 0pt;text-align: left;">switchMap((w) =&gt; getCitiesOrNull(w))</p><p class="s17" style="padding-top: 2pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 319pt;text-indent: 0pt;text-align: left;">Object-oriented design patterns     435</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: justify;">This requires going step by step:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><ol id="l149"><li data-list-text="1."><p style="padding-left: 70pt;text-indent: -17pt;line-height: 115%;text-align: justify;"><span class="s33">	</span>We use the <span class="s245">f romEvent () </span><span>constructor to observe input events (every time the user types<br/>something) from the myText input field.</span></p></li><li data-list-text="2."><p style="padding-top: 4pt;padding-left: 70pt;text-indent: -17pt;text-align: justify;">We use map () to get the events target value, the complete text of the input field.</p></li><li data-list-text="3."><p style="padding-top: 4pt;padding-left: 70pt;text-indent: -18pt;line-height: 119%;text-align: justify;">We use <span class="s245">debounceTime </span><span>(200) so that the observable won’t emit until the user has been 0.2<br/>seconds (200 milliseconds) without typing - what’s the use of calling the API if the user isn’t<br/>done with their query?</span></p></li><li data-list-text="4."><p style="padding-top: 3pt;padding-left: 70pt;text-indent: -18pt;line-height: 119%;text-align: justify;">We then use <span class="s245">f ilter () </span><span>to discard the input if it was only one, two, or three characters long<br/>because that’s not long enough for our search. We accept empty strings (so we’ll empty the<br/>results area) and strings four or more characters long.</span></p></li><li data-list-text="5."><p class="s33" style="padding-top: 4pt;padding-left: 70pt;text-indent: -17pt;line-height: 123%;text-align: justify;">	<span class="p">Then, we use distinctUntilChanged (), so if the search string is the same as before (the<br/>user possibly added a character but quickly backspaced, deleting it), nothing will be emitted.</span></p></li><li data-list-text="6."><p class="s33" style="padding-top: 4pt;padding-left: 70pt;text-indent: -18pt;text-align: justify;">	<span class="p">Finally, we change switchMap () to cancel the previous subscription to the observable and<br/>create a new one using </span><span class="s245">getCitiesOrNull ().</span></p></li></ol><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 126%;text-align: justify;"><span>How do we use this? We subscribe to the observable, and when we get results, we use them to display<br/>values. A possible sample code follows:</span></p><p class="s17" style="padding-top: 7pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">textlnput$.subscribe(async (fetchResult) =&gt; {</p><p class="s17" style="padding-top: 2pt;padding-left: 64pt;text-indent: 0pt;text-align: left;">domElem = document.getElementByld(&quot;myResults&quot;);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 65pt;text-indent: 0pt;text-align: left;">if (fetchResult !== null) {</p><p class="s17" style="padding-top: 2pt;padding-left: 76pt;text-indent: 0pt;line-height: 118%;text-align: left;"><span>result = await fetchResult.json();<br/>domElem.innerHTML = result.data</span></p><p class="s17" style="padding-left: 128pt;text-indent: 0pt;line-height: 13pt;text-align: left;">,map((x) =&gt; &#39;${x.city}, ${x.region}, ${x.country}&#39;)</p><p class="s17" style="padding-top: 2pt;padding-left: 90pt;text-indent: 0pt;text-align: left;">.j oin(&quot;&lt;br /&gt;&quot;) ;</p><p class="s17" style="padding-top: 2pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">} else {</p><p class="s17" style="padding-top: 1pt;padding-left: 76pt;text-indent: 0pt;text-align: left;">domElem.innerHTML =</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 53pt;text-indent: 0pt;text-align: left;">});</p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 111%;text-align: justify;"><span>An important point - the promise is resolved, and the final value of the sequence is, hence, whatever the<br/>promise produced. If the result isn’t null, we get an array of cities, and we use map () and </span><span class="s245">j oin ()<br/></span>to produce the (very basic!) HTML output; otherwise, we empty the results area.</p><p style="padding-top: 8pt;padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: justify;"><span>Lets try it out. If you start typing, nothing will happen until you reach at least four characters and<br/>pause a bit (see </span><i>Figure 11.4, </i>as follows):</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">436  Implementing Design Patterns -The Functional Way</p><p style="text-indent: 0pt;text-align: left;"><br/></p><table style="border-collapse:collapse;margin-left:67.43pt" cellspacing="0"><tr style="height:13pt"><td style="width:64pt" bgcolor="#2C5679"><p class="s251" style="text-indent: 0pt;line-height: 12pt;text-align: left;">1 <span style=" color: #E7CA57;">9 </span>*</p></td><td style="width:285pt" bgcolor="#2C5578"><p class="s253" style="padding-top: 2pt;padding-left: 67pt;text-indent: 0pt;text-align: left;">Cities search - Google Chrome</p></td><td style="width:14pt" bgcolor="#F4FAFB"><p style="padding-left: 1pt;text-indent: 0pt;line-height: 12pt;text-align: left;"><span class="s254" style=" background-color: #F4FAFB;">E </span></p></td></tr><tr style="height:15pt"><td style="width:64pt" bgcolor="#F5F8FC"><p class="s255" style="padding-top: 4pt;padding-left: 10pt;text-indent: 0pt;text-align: left;">© <span style=" color: #545585;">Cities search</span></p></td><td style="width:299pt" colspan="2" bgcolor="#4691E8"><p class="s257" style="padding-top: 1pt;padding-left: 38pt;text-indent: 0pt;text-align: left;">J +</p></td></tr><tr style="height:18pt"><td style="width:64pt;border-bottom-style:solid;border-bottom-width:1pt" bgcolor="#F5F8FC"><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s258" style="padding-left: 7pt;text-indent: 0pt;text-align: left;">&lt;- <span style=" color: #545585;">-&gt; </span>c <span style=" color: #000;">©</span></p></td><td style="width:299pt;border-bottom-style:solid;border-bottom-width:1pt" colspan="2" bgcolor="#F6F7F9"><p class="s260" style="padding-top: 4pt;padding-left: 2pt;text-indent: 0pt;text-align: left;"><span style=" color: #545585;">File I </span>/data/fkereki_data/Dropbox/FP_BOOK_2ndEd/CODE_.. <span class="s261">ir </span>© <span style=" color: #A9353E;">O’^ </span>(3 O</p></td></tr></table><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s201" style="padding-top: 4pt;padding-left: 72pt;text-indent: 0pt;text-align: left;">Find cities: <span class="s263">mo|</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s264" style="padding-left: 72pt;text-indent: 0pt;text-align: left;">Some cities...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 121pt;text-indent: 0pt;text-align: left;">Figure 11.4  - Our search for cities doesn&#39;t trigger for less than four characters</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 5pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>When you reach four characters and pause for a moment, the observable will emit an event, and we’ll<br/>do a first search - in this case, for cities with names starting with MONT (see </span><i>Figure 11.5):</i></p><p style="text-indent: 0pt;text-align: left;"><br/></p><table style="border-collapse:collapse;margin-left:69.08pt" cellspacing="0"><tr style="height:14pt"><td style="width:79pt" bgcolor="#2B587A"><p class="s265" style="text-indent: 0pt;line-height: 12pt;text-align: left;">1 <span class="s266">&lt;9 </span><span class="s267">•*</span></p></td><td style="width:214pt" bgcolor="#2B577A"><p class="s253" style="padding-top: 3pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">Cities search - Google Chrome</p></td><td style="width:70pt" bgcolor="#2B577A"><p style="text-indent: 0pt;line-height: 12pt;text-align: left;"><span class="s268" style=" background-color: #2B577A;">    </span><span class="s269" style=" background-color: #2B577A;">- - </span><span class="s270" style=" background-color: #2B577A;">© </span></p></td></tr><tr style="height:17pt"><td style="width:79pt" bgcolor="#F5F8FC"><p class="s255" style="padding-top: 4pt;padding-left: 9pt;text-indent: 0pt;text-align: left;">© <span style=" color: #545585;">Cities search</span></p></td><td style="width:214pt"><p style="text-indent: 0pt;line-height: 13pt;text-align: left;"><span class="s271" style=" background-color: #4691E7;">                       </span><span class="s272" style=" background-color: #4691E7;">+                    </span></p></td><td style="width:70pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr></table><p class="s28" style="padding-top: 4pt;padding-left: 51pt;text-indent: 0pt;text-align: center;">® <span style=" color: #545585;">File I </span>/data/fkereki_data/Dropbox/FP_BOOK_2ndEd/CODE_... *      4$ <span style=" color: #B80409;">O </span><span style=" color: #792E80;">&gt; </span><span style=" color: #63204B;">&gt;3      </span>@ :</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s201" style="padding-top: 4pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">Find cities: <span class="s263">mont</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s264" style="padding-left: 73pt;text-indent: 0pt;text-align: left;">Some cities...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s201" style="padding-left: 73pt;text-indent: 0pt;text-align: left;">Montreal, Quebec, Canada</p><p class="s201" style="padding-left: 74pt;text-indent: 0pt;text-align: left;"><span>Montevideo, Montevideo Department, Uruguay<br/>Monterrey, Nuevo Leon, Mexico</span></p><p class="s201" style="padding-left: 74pt;text-indent: 0pt;text-align: left;"><span>Montgomery County, Maryland, United States of America<br/>Montgomery County, Pennsylvania, United States of America</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 5pt;padding-left: 138pt;text-indent: 0pt;text-align: left;">Figure 11.5  - After reaching four characters, searches will be fired</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 5pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">Finally, as you add more characters, new API calls will be made, refining the search (see <i>Figure 11.6).</i></p><table style="border-collapse:collapse" cellspacing="0"><tr style="height:14pt"><td style="width:64pt" bgcolor="#2B587D"><p class="s251" style="text-indent: 0pt;line-height: 12pt;text-align: left;">1 <span style=" color: #E7CA57;">&gt; </span>*</p></td><td style="width:285pt" bgcolor="#2B587C"><p class="s253" style="padding-top: 2pt;padding-left: 68pt;text-indent: 0pt;text-align: left;">Cities search - Google Chrome<span class="s276">                 </span><span style=" color: #99C7DA;">v</span></p></td><td style="width:14pt" bgcolor="#F3FAFA"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:15pt"><td style="width:64pt" bgcolor="#F5F8FB"><p class="s255" style="padding-top: 4pt;padding-left: 10pt;text-indent: 0pt;text-align: left;">© <span style=" color: #393953;">Cities search</span></p></td><td style="width:299pt" colspan="2" bgcolor="#4691E7"><p class="s279" style="padding-top: 4pt;text-indent: 0pt;text-align: left;">■’ » 1 +</p></td></tr><tr style="height:19pt"><td style="width:64pt;border-bottom-style:solid;border-bottom-width:1pt" bgcolor="#F7F8FC"><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s258" style="padding-left: 7pt;text-indent: 0pt;text-align: left;">&lt;- <span style=" color: #000;">-&gt; </span>C <span style=" color: #000;">®</span></p></td><td style="width:299pt;border-bottom-style:solid;border-bottom-width:1pt" colspan="2" bgcolor="#F6F7F9"><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s280" style="padding-left: 2pt;text-indent: 0pt;text-align: left;"><span class="s260">File | /data/fkereki_data/Dropbox/FP_BOOK_2ndEd/CODE_ </span>-fir ® <span style=" color: #B80409;">O          </span><span style=" color: #63204B;">H </span>O</p></td></tr></table><p style="text-indent: 0pt;text-align: left;"/><p style="padding-top: 1pt;text-indent: 0pt;text-align: right;"><span class="s283" style=" background-color: #F3FAFA;">E </span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s201" style="padding-left: 73pt;text-indent: 0pt;text-align: left;">Find cities: <span class="s263">monie|</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s264" style="padding-top: 4pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">Some cities...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s201" style="padding-left: 74pt;text-indent: 0pt;text-align: left;"><span>Montevideo, Montevideo Department, Uruguay<br/>Monterrey, Nuevo Leon, Mexico</span></p><p class="s201" style="padding-left: 74pt;text-indent: 0pt;text-align: left;"><span>Monterey County, California, United States of America<br/>Montes Claros, Minas Gerais, Brazil</span></p><p class="s201" style="padding-left: 74pt;text-indent: 0pt;text-align: left;">Monten&#39;a, Cordoba Department, Colombia</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-left: 147pt;text-indent: 0pt;text-align: left;">Figure 11.6  - Further characters are used to refine the search</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 5pt;padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>What can we learn from these examples? Using observables for events lets us achieve a good separation<br/>of concerns regarding event production and event consumption, and the declarative style of the stream</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 339pt;text-indent: 0pt;text-align: left;">Functional design patterns    437</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>process makes the data flow clearer. Note that even the HTML code has no reference to click methods<br/>or anything like that; the complete code is separate from that.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>We have now seen most of the interesting patterns; let’s finish with some other ones, which may or<br/>may not be exactly equivalent to their classic OOP partners.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 43pt;text-indent: 0pt;text-align: justify;"><a name="bookmark472">Other patterns</a></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Let’s end this section by glancing at some other patterns where the equivalence may or may not be<br/>so good:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l150"><li data-list-text="•"><p style="padding-left: 70pt;text-indent: -12pt;line-height: 124%;text-align: justify;"><span class="s33">	</span><b>Currying and partial application </b>(which we saw in <i>Chapter 7, Transforming Functions: </i><span>This<br/>can be seen as approximately equivalent to a </span><i>Factory </i><span>for functions. Given a general function,<br/>you can produce specialized cases by fixing one or more arguments, which is, in essence, what<br/>a Factory does - speak about functions and not objects.</span></p></li><li data-list-text="•"><p class="s33" style="padding-top: 5pt;padding-left: 70pt;text-indent: -13pt;line-height: 124%;text-align: justify;">	<span class="s10">Declarative functions </span><span class="p">(such as map () or reduce ()): These can be considered an application<br/>of the Iterator pattern. The traversal of the container’s elements is decoupled from the container<br/>itself. You can also provide different map () methods for different objects to traverse all kinds<br/>of data structures.</span></p></li><li data-list-text="•"><p style="padding-top: 5pt;padding-left: 70pt;text-indent: -12pt;line-height: 124%;text-align: justify;"><span class="s33">	</span><b>Persistent data structures: </b>As mentioned in <i>Chapter 10, Ensuring Purity, </i><span>these allow for the<br/>implementation of the Memento pattern. The central idea is, given an object, to be able to go<br/>back to a previous state. As we saw, each updated version of a data structure doesn’t affect the<br/>previous one(s), so you could easily add a mechanism to provide an earlier state and </span><i>roll back </i>to it.</p></li><li data-list-text="•"><p style="padding-top: 5pt;padding-left: 70pt;text-indent: -13pt;line-height: 124%;text-align: justify;"><span class="s33">	</span>A <b>Chain of Responsibility </b><span>pattern: In this pattern, there is a potentially variable number of<br/>request processors and a stream of requests to be handled, which may be implemented using<br/>f  ind () to determine which processor will handle the request (the desired one is the first in<br/>the list that accepts the request) and then simply doing the required process.</span></p></li></ul><p style="padding-top: 8pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Remember the warning at the beginning - with these patterns, the match with FP techniques may<br/>not be as perfect as with others that we have previously seen. However, the idea is to show that some<br/>common FP patterns can be applied and will produce the same results as the OOP solutions, despite<br/>having different implementations.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;text-align: justify;">Now, after having seen several OOP equivalent patterns, let’s move on to more specific FP ones.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-left: 44pt;text-indent: 0pt;text-align: justify;"><a name="bookmark473">Functional design patterns</a></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Having seen several OOP design patterns, it may seem a cheat to say that there’s no approved, official,<br/>or even remotely generally accepted similar list of patterns for FP. There are, however, several problems<br/>for which there are standard FP solutions, which can be considered design patterns on their own, and<br/>we have already covered most of them in this book.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">438  Implementing Design Patterns -The Functional Way</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>What are the candidates for a possible list of patterns? Let’s attempt to prepare one - but remember<br/>that it’s just a personal view. Also, I’ll admit that I’m not trying to mimic the usual style of pattern<br/>definition; I’ll just be mentioning a general problem and refer to the way FP in JavaScript can solve it,<br/>and                                                                                                       I won’t be aiming for nice, short, and memorable names for the patterns either:</span></p><ul id="l151"><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 79pt;text-indent: -12pt;line-height: 124%;text-align: justify;"><b>Processing collections using filter/map/reduce: </b><span>Whenever you have to process a data collection,<br/>using declarative higher-order functions such as filter (), map (), and reduce (), as we<br/>saw in this chapter and previously in </span><i>Chapter </i>5, <i>Programming Declaratively, </i><span>is a way to remove<br/>complexity from the problem. (The usual MapReduce web framework is an extension of this<br/>concept, which allows for distributed processing among several servers, even if the implementation<br/>and details aren’t exactly the same.) Instead of performing looping and processing as a single<br/>step, you should think about the problem as a sequence of steps, applied in order, and doing<br/>transformations until obtaining the final, desired result.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 65pt;text-indent: 0pt;text-align: left;"><a name="bookmark474">Looping in other ways</a></p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;line-height: 107%;text-align: left;">JavaScript also includes <i>iterators, </i><span>another way of looping through a collection. Using iterators<br/>isn’t particularly functional, but you may want to look at them, since they may be able to<br/>simplify some situations. Read more at </span><span class="s245">developer .mozilla. org/en-US/docs/Web/</span></p><p class="s17" style="padding-left: 66pt;text-indent: 0pt;line-height: 11pt;text-align: left;">JavaScript/Reference/Iteration_protocols.</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="•"><p style="padding-left: 78pt;text-indent: -12pt;line-height: 124%;text-align: justify;"><span class="s33">	</span><b>Lazy evaluation with thunks: </b><span>The idea of lazy evaluation is not doing any calculations until they<br/>are actually needed. In some programming languages, this is built in. However, in JavaScript<br/>(and most imperative languages), </span><i>eager evaluation </i><span>is applied, in which an expression is evaluated<br/>as soon as it is bound to some variable. (Another way of saying this is that JavaScript is a </span><i>strict</i>with a <i>strict paradigm, </i><span>which only allows calling a function if all of<br/>its parameters have been completely evaluated.) This sort of evaluation is required when you<br/>need to specify the order of evaluation with precision, mainly because such evaluations may<br/>have side effects.</span></p></li></ul><p style="padding-top: 5pt;padding-left: 79pt;text-indent: 0pt;line-height: 124%;text-align: justify;">In FP, which is more declarative and pure, you can delay such evaluation with <i>thunks </i><span>(which<br/>we used in the </span><i>Trampolines and thunks </i>section of <i>Chapter 9, Designing Functions) </i><span>by passing a<br/>thunk that will calculate the needed value only when it’s needed, but not earlier.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 66pt;text-indent: 0pt;text-align: justify;"><a name="bookmark475">Generating more results</a></p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;text-align: justify;"><span>You may also want to look at JavaScript generators, another way of delaying evaluation, though<br/>not particularly related to FP. Read more about them at </span><span class="s245">developer .mozilla . org/<br/>en-US/docs/Web/JavaScript/Reference/Global_Objects/Generator.</span></p><p style="padding-top: 1pt;padding-left: 65pt;text-indent: 0pt;text-align: justify;"><span>The combination of generators and promises is called an async function, which may be of<br/>interest  to  you;  refer  to  </span><span class="s245">developer  .mozilla.  org/en-US/docs/Web/JavaScript/<br/>Reference/Statements/async_function.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 403pt;text-indent: 0pt;text-align: left;">Summary   439</p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l152"><li data-list-text="•"><p style="padding-left: 70pt;text-indent: -13pt;line-height: 124%;text-align: justify;"><span class="s33">	</span><b>Persistent data structures for immutability: </b><span>Having immutable data structures, as we saw<br/>in </span><i>Chapter 10, Ensuring Purity, </i><span>is mandatory when working with certain frameworks, and in<br/>general, it is recommended because it helps to reason about a program or to debug it. (Earlier<br/>in this chapter, we also mentioned how the </span><i>Memento </i><span>OOP pattern can be implemented in this<br/>fashion.) Whenever you have to represent structured data, the FP solution of using a persistent<br/>data structure helps in many ways.</span></p></li><li data-list-text="•"><p class="s10" style="padding-top: 5pt;padding-left: 70pt;text-indent: -12pt;line-height: 124%;text-align: justify;">Wrapped values for checks and operations: <span class="p">If you directly work with variables or data structures,<br/>you can modify them at will (possibly violating any restrictions), or you may need to do many<br/>checks before using them (such as verifying that a value is not null before trying to access<br/>the corresponding object). This pattern aims to wrap a value within an object or function, so<br/>direct manipulation won’t be possible, and checks can be managed more functionally. We’ll<br/>refer to more of this in </span><i>Chapter 12, Building Better Containers.</i></p></li></ul><p style="padding-top: 8pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>As we have said, the power of FP is such that, instead of having a couple of dozen standard design<br/>patterns (and that’s only in the GoF book; if you read other texts, the list grows!), there isn’t yet a<br/>standard or acknowledged list of functional patterns.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-left: 43pt;text-indent: 0pt;text-align: left;"><a name="bookmark476">Summary</a></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>In this chapter, we have made a bridge from the OO way of thinking and the usual patterns we use<br/>when coding that way to the FP style, by showing how we can solve the same basic problems but<br/>relatively more easily than with classes and objects. We have seen several common design patterns,<br/>and we’ve seen that the same concepts apply in FP, even if implementations may vary, so now you<br/>have a way to apply those well-known solution structures to your JavaScript coding.</span></p><p style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;">In <i>Chapter 12, Building Better Containers, </i><span>we will be working with a potpourri of FP concepts, giving<br/>you even more ideas about tools you can use. I promised that this book wouldn’t be deeply theoretical<br/>but, rather, more practical, and we’ll try to keep it this way, even if some of the presented concepts<br/>may seem abstruse or remote.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-left: 43pt;text-indent: 0pt;text-align: left;"><a name="bookmark477">Questions</a></p><ol id="l153"><ol id="l154"><li data-list-text="11.1"><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 114%;text-align: justify;"><b>Decorating methods, the future way: </b>In <i>Chapter 6, Producing Functions, </i><span>we wrote a decorator<br/>to enable logging for any function. Currently, method decorators are being considered for upcoming<br/>versions of JavaScript: refer to </span><span class="s245">tc3 9 . github. io/proposal-decorators </span><span>for more information<br/>on that. (A Stage 2 Draft means that inclusion of this feature in the standard is likely, although there may<br/>be some additions or small changes. TypeScript provides decorators today, but warns that </span><i>“Decorators</i><a href="http://www/" class="s11" target="_blank">see more at </a><span class="s245">www. typescriptlang.</span></p><p class="s17" style="padding-left: 43pt;text-indent: 0pt;line-height: 11pt;text-align: justify;">org/docs/handbook/decorators . html.) <span class="s246">Study the following code and take a look at what</span></p><p style="padding-top: 1pt;padding-left: 43pt;text-indent: 0pt;text-align: justify;">makes the next code tick:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 52pt;text-indent: 0pt;text-align: left;">const logging = (target, name, descriptor)</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 20pt;text-indent: 0pt;text-align: left;">440  <span class="s285">Implementing Design Patterns -The Functional Way</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 73pt;text-indent: 0pt;line-height: 118%;text-align: left;"><span>const savedMethod = descriptor.value;<br/>descriptor.value = function (...args) {</span></p><p class="s17" style="padding-left: 85pt;text-indent: 0pt;line-height: 119%;text-align: left;"><span>console.log(&#39;entering ${name}: ${args}&#39;);<br/>try {</span></p><p class="s17" style="padding-left: 97pt;text-indent: 0pt;line-height: 117%;text-align: left;"><span>const valueToReturn = savedMethod.bind(this)(...args);<br/>console.log(&#39;exiting ${name}: ${valueToReturn}&#39;);<br/>return valueToReturn;</span></p><p class="s17" style="padding-left: 87pt;text-indent: 0pt;text-align: left;">} catch (thrownError) {</p><p class="s17" style="padding-top: 1pt;padding-left: 97pt;text-indent: 0pt;line-height: 117%;text-align: left;"><span>console.log(&#39;exiting ${name}: threw ${thrownError}&#39;);<br/>throw thrownError;</span></p><p class="s17" style="padding-top: 2pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">}</p><p class="s17" style="padding-top: 2pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">};</p><p class="s17" style="padding-left: 73pt;text-indent: 0pt;line-height: 12pt;text-align: left;">return descriptor;</p><p class="s17" style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">};</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">A working example would be as follows:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 73pt;text-indent: -12pt;line-height: 115%;text-align: left;"><span>class SumThree {<br/>constructor(z) {</span></p><p class="s17" style="padding-left: 85pt;text-indent: 0pt;text-align: left;">this.z = z;</p><p style="padding-top: 6pt;padding-left: 75pt;text-indent: 0pt;text-align: left;">}</p><p class="s10" style="padding-top: 2pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">©logging</p><p class="s17" style="padding-top: 2pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">sum(x, y) {</p><p class="s17" style="padding-top: 1pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">return x + y + this.z;</p><p class="s17" style="padding-top: 4pt;padding-left: 75pt;text-indent: 0pt;text-align: left;">}</p><p class="s17" style="padding-top: 2pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-top: 4pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">new SumThree(100).sum(20, 8);</p><p class="s17" style="padding-top: 2pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">// entering sum: 20,8</p><p class="s17" style="padding-top: 2pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">// exiting sum: 128</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">The following are some questions about the code for logging ():</p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l155"><li data-list-text="•"><p style="padding-left: 79pt;text-indent: -13pt;text-align: left;">What’s the need for the savedMethod variable?</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 79pt;text-indent: -13pt;line-height: 123%;text-align: left;"><span>Why do we use function () when assigning a new descriptor. value, instead of an<br/>arrow function?</span></p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 401pt;text-indent: 0pt;text-align: left;">Questions   441</p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l156"><li data-list-text="•"><p style="padding-left: 69pt;text-indent: -12pt;text-align: left;">Why is . bind() used?</p></li><li data-list-text="•"><p style="padding-top: 7pt;padding-left: 69pt;text-indent: -12pt;text-align: left;">What is descriptor?</p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="11.2"><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><b>Decorator with mixins: </b>In the <i>Questions </i>section of <i>Chapter 1, Becoming Functional, </i><span>we saw that<br/>classes are first-class objects. Taking advantage of this, complete the following addBar () function,</span></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 11pt;text-align: left;">which will add some mixins to the <span class="s245">Foo </span>class so that the code will run as shown. The created f <span class="s245">ooBar</span></p><p style="padding-top: 2pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>object should have two attributes (f ooValue and barValue) and two methods (doSomething ()<br/>and doSomethingElse ()) that simply show some text and properties, as shown here:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 65pt;text-indent: -12pt;line-height: 118%;text-align: left;"><span>class Foo {<br/>constructor(fooValue) {</span></p><p class="s17" style="padding-left: 76pt;text-indent: 0pt;line-height: 12pt;text-align: left;">this.fooValue = fooValue;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 64pt;text-indent: 0pt;text-align: left;">doSomething() {</p><p class="s17" style="padding-top: 2pt;padding-left: 76pt;text-indent: 0pt;text-align: left;">console.log(&quot;something: foo... &quot;, this.fooValue);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">const addBar = (BaseClass) =&gt; {</p><p class="s10" style="padding-top: 5pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">/*</p><p class="s10" style="padding-top: 3pt;padding-left: 64pt;text-indent: 0pt;text-align: left;">your code goes here</p><p class="s10" style="padding-top: 5pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">*/</p><p class="s10" style="padding-top: 5pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">};</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 53pt;text-indent: 0pt;line-height: 114%;text-align: left;"><span>const fooBar = new (addBar(Foo))(22, 9);<br/>fooBar.doSomething();</span></p><p class="s17" style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// something: foo... 22</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 53pt;text-indent: 0pt;text-align: left;">fooBar.somethingElse();</p><p class="s17" style="padding-top: 2pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// something else: bar... 9</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 52pt;text-indent: 0pt;text-align: left;">console.log(Obj ect.keys(fooBar));</p><p class="s17" style="padding-top: 2pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// [&quot;fooValue&quot;, &quot;barValue&quot;]</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>Could you include a third mixin, addBazAndQux (), so that addBazAndQux (addBar (Foo) )<br/>would add even more attributes and methods to Foo?</span></p></li><li data-list-text="11.3"><p class="s10" style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;line-height: 126%;text-align: left;">Multi-clicking by hand: <span class="p">Can you write your own multi-click detection code, which should work<br/>exactly as in our example?</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">442 Implementing Design Patterns -The Functional Way</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="11.4"><p style="padding-left: 52pt;text-indent: 1pt;line-height: 124%;text-align: justify;"><b>Sorting logically: </b>In <i>Chapter 3, Starting Out with Functions, </i><span>we saw how to sort numbers and<br/>strings by injecting a sorting function, an application of the Strategy pattern. What comparison function<br/>would you use to sort an array with Boolean values, with false values first and true values last?</span></p></li><li data-list-text="11.5"><p class="s10" style="padding-top: 6pt;padding-left: 52pt;text-indent: 1pt;line-height: 124%;text-align: justify;">Finding routes, objectively: <span class="p">Working in an object-oriented fashion, the route-finding problem<br/>would have been solved in another way, involving classes and subclasses. How? (Tip: the answer to<br/>this question is a pattern we have mentioned in this chapter.)</span></p></li></ol></ol><p style="text-indent: 0pt;text-align: left;"><br/></p><h3 style="padding-top: 10pt;text-indent: 0pt;text-align: right;"><a name="bookmark478">12</a><a name="bookmark479">&zwnj;</a></h3><h2 style="padding-top: 4pt;text-indent: 0pt;text-align: right;">Building Better Containers</h2><h2 style="padding-top: 2pt;text-indent: 0pt;text-align: right;">- Functional Data Types</h2><p style="padding-top: 29pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;">In <i>Chapter 11, Implementing Design Patterns, </i><span>we went over how to use functions to achieve different<br/>results. In this chapter, we will look at data types from a functional point of view. We’ll be considering<br/>how we can implement our own data types, along with several features that can help us compose<br/>operations or ensure their purity so that our FP coding will become simpler and shorter.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;text-align: justify;">We’ll be touching on several topics:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l157"><li data-list-text="•"><p class="s10" style="padding-left: 70pt;text-indent: -12pt;line-height: 123%;text-align: left;">Data types <span class="p">from a functional point of view. Even though JavaScript is not a typed language, a<br/>better understanding of types and functions is needed, to complement our usage of TypeScript.</span></p></li><li data-list-text="•"><p class="s10" style="padding-top: 5pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">Containers, <span class="p">including functors and the mystifying monads, to structure a data flow.</span></p></li><li data-list-text="•"><p class="s33" style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;line-height: 125%;text-align: left;">	<span class="s10">Functions as structures, </span><span class="p">in which we’ll see yet another way of using functions to represent<br/>data types, with immutability thrown in as an extra.</span></p></li></ul><p style="padding-top: 8pt;padding-left: 43pt;text-indent: 0pt;text-align: justify;">With that, let’s get started!</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-left: 43pt;text-indent: 0pt;text-align: justify;"><a name="bookmark480">Specifying data types</a></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Even though JavaScript is a dynamic language, without static or explicit typing declarations and controls,<br/>it doesn’t mean you can simply ignore types. Even if the language doesn’t allow you to specify the<br/>types of your variables or functions, you still work—even if only in your head—with types. Specifying<br/>types has advantages, as follows:</span></p><p style="padding-top: 8pt;padding-left: 70pt;text-indent: 0pt;text-align: left;">TypeScript can detect compile-time errors, avoiding many bugs.</p><p style="padding-top: 8pt;padding-left: 70pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>It will help if you move from JavaScript to a more functional language, such as Elm (see elm- lang.<br/>org).</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">444   Building Better Containers - Functional Data Types</p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l158"><li data-list-text="•"><p class="s33" style="padding-left: 79pt;text-indent: -13pt;line-height: 123%;text-align: justify;">	<span class="p">It serves as documentation that lets future developers understand what type of arguments they<br/>must pass to the function and what type it will return. All the functions in the Ramda library<br/>are documented in this way.</span></p></li><li data-list-text="•"><p style="padding-top: 5pt;padding-left: 79pt;text-indent: -13pt;line-height: 124%;text-align: justify;"><span>It will also help us with the functional data structures we will cover later in this section, where<br/>we will examine a way of dealing with structures, similar to what you do in fully functional<br/>languages such as Haskell.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><a name="bookmark481"><span>Why are we discussing types again, after using TypeScript throughout the whole book? The reason<br/>is that in most FP texts, a different style is used. TypeScript definitions are just, well, TypeScript, but<br/>the definitions we’ll see here can be applied to any other language. Let’s forget TypeScript for a minute<br/>and start thinking about a new type system. We’ll start with functions, the most relevant type, and<br/>then consider other definitions.</span></a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 52pt;text-indent: 0pt;text-align: justify;">Signatures for functions</p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>The specification of a function’s arguments and the result are given by a signature. Type signatures are<br/>based on a type system called </span><b>Hindley-Milner (HM), </b><span>which influenced several (mostly functional)<br/>languages, including Haskell, though the notation has changed from that of the original paper. This<br/>system can even deduce types that are not directly given, in the same way that TypeScript or Flow<br/>does. Instead of providing a dry, formal explanation about the rules for writing correct signatures,<br/>let’s work with examples. We only need to know the following:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="•"><p style="padding-left: 79pt;text-indent: -13pt;text-align: left;">We will be writing the type declaration as a comment</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 79pt;text-indent: -13pt;text-align: left;">The function name is written first, and then : :, which can be read as <i>is of type </i>or <i>has type</i></p></li><li data-list-text="•"><p class="s33" style="padding-top: 8pt;padding-left: 79pt;text-indent: -12pt;line-height: 126%;text-align: justify;">	<span class="p">Optional constraints may follow, with a double (fat) arrow =&gt; (or = &gt; in basic ASCII fashion,<br/>if you cannot type in the arrow) afterward</span></p></li><li data-list-text="•"><p style="padding-top: 5pt;padding-left: 79pt;text-indent: -13pt;text-align: left;">The input type of the function follows, with a (or - &gt;, depending on your keyboard)</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 79pt;text-indent: -13pt;text-align: left;">The result type of the function comes last</p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s154" style="padding-left: 52pt;text-indent: 0pt;text-align: left;">/<span class="s155">                                                                       </span>X</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 66pt;text-indent: 0pt;text-align: justify;">Careful with arrows!</p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;line-height: 115%;text-align: justify;"><span>An advance warning: check out the arrow styles we’ll use; they are not what TypeScript uses!<br/>A “thin” arrow will be used instead of = &gt;, and a “fat” arrow will be used to specify a generic<br/>constraint; be careful!</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><a name="bookmark482"><span>Now, we can begin with some examples. Let’s define the type for a simple function that capitalizes a<br/>word, and do the same for the Math. random function:</span></a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 62pt;text-indent: 0pt;text-align: justify;">// firstToUpper : : String -» String</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-top: 6pt;padding-left: 61pt;text-indent: 0pt;text-align: justify;">const firstToUpper = (s: string): string =&gt;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 359pt;text-indent: 0pt;text-align: left;">Specifying data types   445</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 65pt;text-indent: 0pt;text-align: left;"><a name="bookmark483">s[0].toUpperCase() + s.substring(1).toLowerCase();</a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// Math, random :: () -» Number</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: left;"><span>These are simple cases—only take the signatures into account here; we are not interested in the actual<br/>functions. The arrows denote functions. The first function receives a string as an argument and returns a<br/>new string. The second one receives no arguments (as indicated by the empty parentheses) and returns<br/>a floating-point number. So, we can read the first signature as f irstToUpper () </span><i>is a function of the</i><span>We can speak similarly about the maligned (impurity­<br/>wise) Math . random () function, the only difference being that it doesn’t receive arguments.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 110%;text-align: justify;"><span>Comparing the new type definition with TypeScript, it’s clear that they are very much alike. However,<br/>the new style is clearer. You could have also defined </span><span class="s245">f irstToUpper () </span><span>in the following way, without<br/>specifying the result type (because TypeScript can work it out), but with HM types, you have to provide</span></p><p style="padding-top: 1pt;padding-left: 43pt;text-indent: 0pt;text-align: justify;">all the details, providing more clarity:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 53pt;text-indent: 0pt;text-align: left;"><a name="bookmark484">// firstToUpper :: String -» String</a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">const firstToUpper = (s: string) =&gt;</p><p class="s17" style="padding-top: 2pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">s[0].toUpperCase() + s.substring(1).toLowerCase();</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Another detail is that in this new way of specifying types, the type descriptions stand on their own,<br/>without being mixed with the details of the programming language—you don’t need to understand<br/>JavaScript, TypeScript, or any other language to figure out what types are involved in a function.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>We’ve already looked at functions with zero or one parameter, but what about functions with more<br/>than one? There are two answers to this. If we are working in a strict functional style, we would always<br/>be currying (as we saw in </span><i>Chapter </i>7, <i>Transforming Functions), </i><span>so all the functions would be unary. The<br/>other solution is enclosing a list of argument types in parentheses. We can see both of these solutions<br/>in the following code:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 53pt;text-indent: 0pt;text-align: left;"><a name="bookmark485">// sum3C :: Number -» Number -» Number -» Number</a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">const sum3C = curry(</p><p class="s17" style="padding-top: 2pt;padding-left: 66pt;text-indent: 0pt;text-align: left;">(a: number, b: number, c: number): number =&gt; a + b + c</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 53pt;text-indent: 0pt;text-align: left;"><a name="bookmark486">// sum3 :: (Number, Number       Number) -» Number</a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-top: 6pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">const sum3 = (a: number, b:     number, c: number) =&gt; a + b +</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">446  Building Better Containers - Functional Data Types</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>Remember that sum3 c () is actually (a) = &gt; (b)<br/>first signature, which can also be read as follows:</span></p><p class="s17" style="padding-top: 4pt;padding-left: 35pt;text-indent: 0pt;text-align: left;">= &gt; (c) =&gt;a + b + c; <span class="s246">this explains the</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;"><a name="bookmark487">// sum3C :: Number -» (Number -» (Number -» (Number)))</a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-top: 6pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">const sum3C = curry(</p><p class="s17" style="padding-top: 2pt;padding-left: 76pt;text-indent: 0pt;text-align: left;">(a: number, b: number, c: number): number =&gt; a + b + c</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>After you provide the first argument to the function, you are left with a new function, which also<br/>expects an argument and returns a third function, which, when given an argument, will produce the<br/>final result. We won’t be using parentheses because we’ll always assume this grouping from right to left.</span></p><p style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Now, what about higher-order functions, which receive functions as arguments? The map () function<br/>poses a problem: it works with arrays of any type. Also, the mapping function can produce any type of<br/>result. For these cases, we can specify generic types, identified by lowercase letters. These generic types<br/>can stand for any possible type. For arrays themselves, we use brackets. So, we would have the following:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 62pt;text-indent: 0pt;text-align: left;"><a name="bookmark488">// map : : [a] -» (a -» b) -» [b]</a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-top: 5pt;padding-left: 73pt;text-indent: -12pt;line-height: 120%;text-align: left;"><span>const map = curry(&lt;A, B&gt;(arr: A[], fn: (x: A) =&gt; B) =&gt;<br/>arr.map(fn)</span></p><p class="s17" style="padding-left: 62pt;text-indent: 0pt;text-align: left;">) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>It’s perfectly valid to have a and b represent the same type, as in a mapping that’s applied to an array<br/>of numbers, which produces another array of numbers. The point is that, in principle, a and b may<br/>stand for different types, which we described previously. This definition requires using generic types<br/>in TypeScript, A and B in our case.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Note that if we weren’t currying, the signature would have been ( [a] , (a -» b) ) -» [b], showing<br/>a function that receives two arguments (an array of elements of type a and a function that maps from<br/>type a to type b) and produces an array of elements of type b as its result.</span></p><p style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;text-align: justify;">We can similarly write the following:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 62pt;text-indent: 0pt;text-align: left;"><a name="bookmark489">// filter : : [a] -» (a -» Boolean) -» [a]</a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-top: 6pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">const filter = curry(&lt;A&gt;(arr: A[], fn: (x: A) =&gt; B) =&gt;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 359pt;text-indent: 0pt;text-align: left;">Specifying data types   447</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: left;"><span>And now the big one: what’s the signature for reduce () ? Be sure to read it carefully and see whether<br/>you can work out why it’s written that way. You may prefer thinking about the second part of the<br/>signature as if it were ( (b, a) -» b):</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 53pt;text-indent: 0pt;text-align: left;"><a name="bookmark490">// reduce : : [a] -» (b -* a -» b) -»b-»b</a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-top: 6pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">const reduce = curry(</p><p class="s17" style="padding-top: 2pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">&lt;A, B&gt;(arr: A[], fn: (a: B, v: A) =&gt; B, acc: B) =&gt;</p><p class="s17" style="padding-top: 2pt;padding-left: 76pt;text-indent: 0pt;text-align: left;">arr.reduce(fn, acc)</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: left;">Finally, if you are defining a method instead of a function, you use a squiggly arrow such as ~ &gt;:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 53pt;text-indent: 0pt;text-align: left;"><a name="bookmark491">// String. repeat :: String Number -» String</a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>So far, we have defined data types for functions, but we aren’t done with this subject. Let’s consider<br/>some other cases.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 43pt;text-indent: 0pt;text-align: left;"><a name="bookmark492">Other data type options</a></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: left;">What else are we missing? Let’s look at some other options that you might use. <i>Product types </i><span>are a sets<br/>of values that are always together and are commonly used with objects. For </span><i>tuples </i><span>(that is, arrays with<br/>a fixed number of elements of (probably) different types), we can write something like the following:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 53pt;text-indent: 0pt;text-align: left;"><a name="bookmark493">// getWeekAndDay :: String -» (Number x String)</a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-top: 6pt;padding-left: 64pt;text-indent: -11pt;line-height: 115%;text-align: left;"><span>const getWeekAndDay = (<br/>yyyy_mm_dd: string</span></p><p class="s17" style="padding-left: 53pt;text-indent: 0pt;text-align: left;">): [number, string] =&gt; {</p><p class="s17" style="padding-top: 2pt;padding-left: 65pt;text-indent: 0pt;line-height: 117%;text-align: left;"><span>let weekNumber: number;<br/>let dayOfWeekName: string;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 65pt;text-indent: 0pt;text-align: left;">return [weekNumber, dayOfWeekName];</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>For objects, we can go with a definition very similar to what JavaScript already uses. Let’s imagine we<br/>have a getPerson () function that receives an ID and returns an object with data about a person:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// getPerson :: Number -» { id:Number x name:String }</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">448  Building Better Containers - Functional Data Types</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 73pt;text-indent: -11pt;line-height: 120%;text-align: left;"><span>const  getPerson  =  (<br/>personld: number</span></p><p class="s17" style="padding-left: 62pt;text-indent: 0pt;line-height: 12pt;text-align: left;">): { id: number; name: string } =&gt; {</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 73pt;text-indent: 0pt;text-align: left;">return { id: personld, name: personName };</p><p class="s17" style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">};</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;line-height: 111%;text-align: justify;"><i>Sum types </i>(also known as <i>union types&#39;) </i><span>are defined as a list of possible values. For example, our<br/></span><span class="s245">getField () </span>function from <i>Chapter 6, Producing Functions, </i><span>returns either the value of an attribute<br/>or undefined. For this, we can write the following signature:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 62pt;text-indent: 0pt;text-align: left;"><a name="bookmark494">// getField : : String -» Object -» a | undefined</a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-top: 6pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">const getField =</p><p class="s17" style="padding-top: 2pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">&lt;A&gt;(attr: string) =&gt;</p><p class="s17" style="padding-top: 2pt;padding-left: 85pt;text-indent: -9pt;line-height: 115%;text-align: left;"><span>(obj:  {  [key:  string]:  A  })  =&gt;<br/>obj [attr];</span></p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>We could also define a type (union or otherwise) and use it in further definitions. For instance, the<br/>data types that can be directly compared and sorted are numbers, strings, and Booleans, so we could<br/>write the following definitions:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 62pt;text-indent: 0pt;text-align: left;"><a name="bookmark495">// Sortable :: Number | String | Boolean</a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: justify;">Afterward, we could specify that a comparison function can be defined in terms of the <span class="s245">Sortable</span></p><p style="padding-top: 2pt;padding-left: 52pt;text-indent: 0pt;text-align: justify;">type, but be careful: there’s a hidden problem here!</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 62pt;text-indent: 0pt;text-align: left;"><a name="bookmark496">// compareFunction :: (Sortable, Sortable) -» Number</a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>The previous definition would allow us to write a function that received, say, a number and a<br/>Boolean. It doesn’t say that both types should be the same. However, there’s a way out. If you have<br/>constraints for some data types, you can express them before the actual signature, using a fat arrow,<br/>as shown in the following code:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 62pt;text-indent: 0pt;text-align: left;"><a name="bookmark497">// compareFunction : : Sortable a =&gt; (a, a) -» Number</a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>The definition is now correct because all occurrences of the same type (denoted by the same letter, in<br/>this case, a) must be exactly the same. An alternative, but one that requires much more typing, would<br/>have been to write all three possibilities with a union:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 367pt;text-indent: 0pt;text-align: left;">Building containers   449</p><p class="s10" style="padding-top: 22pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// compareFunction ::</p><p class="s286" style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">//   <span class="s10">((Number, Number) |</span></p><p class="s286" style="padding-top: 1pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">//   <span class="s10">(String, String) |</span></p><p class="s286" style="padding-top: 2pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">//   <span class="s10">(Boolean, Boolean) ) -&gt; Number</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 43pt;text-indent: 0pt;line-height: 114%;text-align: justify;"><span>Actually, this definition isn’t very precise because you can compare any type, even if it doesn’t make<br/>much sense. However, bear with me for the sake of this example! If you want to refresh your memory<br/>about  sorting  and  comparison  functions,  see  </span><span class="s245">developer  .mozilla  .  org/en/docs/Web/</span></p><p class="s17" style="padding-left: 43pt;text-indent: 0pt;line-height: 11pt;text-align: left;">JavaScript/Reference/Global_Objects/Array/sort.</p><p style="padding-top: 9pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>So far, we have been using the standard type definitions. However, when working with JavaScript,<br/>we have to consider other possibilities, such as functions with optional parameters, or even with an<br/>undetermined number of parameters. We can use ... to stand for any number of arguments and<br/>add    ? to represent an optional type, as follows:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 53pt;text-indent: 0pt;text-align: left;"><a name="bookmark498">// unary :: ((b, ...) -» a) -» (b -» a)</a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><a name="bookmark499"><span>The unary () higher-order function we defined in the same chapter we cited previously took any<br/>function as a parameter and returned a unary function as its result. We can show that the original<br/>function can receive any number of arguments but that the result used only the first. The data type<br/>definition for this would be as follows:</span></a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// parselnt :: (String, Number?) -» Number</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>The standard parselnt () function provides an example of optional arguments, though it’s highly<br/>recommended that you don’t omit the second parameter (the base radix); you can, in fact, skip it.</span></p><p style="text-indent: 0pt;text-align: left;"/><p style="padding-top: 3pt;padding-left: 43pt;text-indent: 0pt;text-align: left;">Z                                                    X</p><p class="s10" style="padding-top: 3pt;padding-left: 57pt;text-indent: 0pt;text-align: left;">Fantastic definitions?</p><p style="padding-top: 2pt;padding-left: 57pt;text-indent: 0pt;line-height: 12pt;text-align: left;">Check out <span class="s245">github.com/fantasyland/fantasy-land/</span>and <span class="s245">sanctuary.</span></p><p class="s17" style="padding-left: 44pt;text-indent: 0pt;line-height: 12pt;text-align: justify;">,_ <u>j s . org/#types </u><span class="s288">for a more formal definition and description of types, as applied to JavaScript. &nbsp;&nbsp; </span><span class="s246"> .</span></p><p style="text-indent: 0pt;text-align: left;"/><p style="padding-top: 1pt;padding-left: 44pt;text-indent: 0pt;text-align: left;">k.                                                   <i>J</i></p><p style="padding-top: 8pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>From now on, throughout this chapter, we’ll not only be using TypeScript, but we will also be adding<br/>HM signatures to methods and functions, so you can get used to them. Let’s now change track and<br/>cover a highly important topic: </span><i>containers.</i></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-left: 44pt;text-indent: 0pt;text-align: justify;"><a name="bookmark500">Building containers</a></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;">Back in <i>Chapter 5, Programming Declaratively, </i>and later, in <i>Chapter 8, Connecting Functions, we </i><span>saw<br/>that the ability to apply a mapping to all the elements of an array—and even better, being able to chain<br/>a sequence of similar operations—was an excellent way to produce better, more understandable code.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">450  Building Better Containers - Functional Data Types</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>However, there is a problem: the map () method (or the equivalent, demethodized one, which we<br/>looked at in </span><i>Chapter 6, Producing Functions) </i><span>is only available for arrays, and we might want to be able<br/>to apply mappings and chaining to other data types. So, what can we do?</span></p><p style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Let’s consider different ways of doing this, which will give us several new tools for better functional<br/>coding. Basically, there are only two possible ways of solving this: we can either add new methods to<br/>existing types (though that will be limited because we can only apply that to basic JavaScript types)<br/>or wrap types in some type of container, which will allow mapping and chaining.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: justify;"><span>Let’s start by extending current types before moving on to using wrappers, which will lead us into the<br/>deep functional territory with entities such as functors and monads.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 53pt;text-indent: 0pt;text-align: justify;"><a name="bookmark501">Extending current data types</a></p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;text-align: justify;">If we want to add mapping to basic JavaScript data types, we need to start by considering our options:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l159"><li data-list-text="•"><p style="padding-left: 79pt;text-indent: -13pt;text-align: left;">With null, undefined, and Symbol, applying maps doesn’t sound too interesting</p></li><li data-list-text="•"><p class="s33" style="padding-top: 8pt;padding-left: 79pt;text-indent: -12pt;line-height: 123%;text-align: left;">	<span class="p">We have some interesting possibilities with Boolean, Number, and String data types, so<br/>we can examine some of those</span></p></li><li data-list-text="•"><p class="s33" style="padding-top: 5pt;padding-left: 79pt;text-indent: -12pt;line-height: 125%;text-align: left;">	<span class="p">Applying mapping to an object is trivial: we just have to add a map () method, which must<br/>return a new object</span></p></li><li data-list-text="•"><p style="padding-top: 5pt;padding-left: 79pt;text-indent: -13pt;line-height: 125%;text-align: left;"><span>Finally, despite not being basic data types, we could also consider special cases, such as dates<br/>or functions, to which we could also add map () methods</span></p></li></ul><p style="padding-top: 8pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>As in the rest of this book, we are sticking to plain JavaScript and TypeScript, but you should look<br/>into libraries such as Lodash, Underscore, or Ramda, which already provide functionalities similar<br/>to the ones we are developing here.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>A key point to consider in all these mapping operations should be that the returned value is of the<br/>same type as the original one. When we use Array. map (), the result is also an array, and similar<br/>considerations must apply to any other map () method implementations (you could observe that the<br/>resulting array may have different element types to the original one, but it is still an array).</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>What could we do with a Boolean? First, let’s accept that Booleans are not containers, so they don’t<br/>really behave in the same way as an array. Trivially, a Boolean can only have a Boolean value, while an<br/>array may contain any type of element. However, accepting that difference, we can extend Boolean.<br/>prototype (though, as I’ve already mentioned, that’s not usually recommended) by adding a new<br/>map  () method to it and making sure that whatever the mapping function returns is turned into a<br/>new Boolean value. For the latter, the solution will be similar to the following:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 62pt;text-indent: 0pt;text-align: left;"><a name="bookmark502">// Boolean.map : : Boolean (Boolean -» a) -» Boolean</a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-top: 6pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">Boolean.prototype.map  =  function  (</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 367pt;text-indent: 0pt;text-align: left;">Building containers   451</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 65pt;text-indent: 0pt;text-align: left;">this: boolean,</p><p class="s17" style="padding-top: 2pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">fn: (x: boolean) =&gt; any</p><p class="s17" style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">) {</p><p class="s17" style="padding-left: 65pt;text-indent: 0pt;text-align: left;">return !!fn(this);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 114%;text-align: left;"><span>We already saw examples of adding a (fake) this parameter to a method, to let TypeScript know<br/>what type this will be—in this case, a Boolean. The 1 1 operator forces the result to be a Boolean.<br/></span><span class="s245">Boolean (f n (thi </span><span>s) ) could also have been used. This kind of solution can also be applied to<br/>numbers and strings, as shown in the following code:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 53pt;text-indent: 0pt;text-align: left;"><a name="bookmark503">// Number.map :: Number (Number -» a) -» Number</a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-top: 6pt;padding-left: 65pt;text-indent: -12pt;line-height: 118%;text-align: left;"><span>Number.prototype.map = function (<br/>this: number,</span></p><p class="s17" style="padding-left: 65pt;text-indent: 0pt;line-height: 12pt;text-align: left;">fn: (x: number) =&gt; number</p><p class="s17" style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">) {</p><p class="s17" style="padding-left: 64pt;text-indent: 0pt;text-align: left;">return Number(fn(this));</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 53pt;text-indent: 0pt;text-align: left;"><a name="bookmark504">// String.map :: String (String -» a) -» String</a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-top: 5pt;padding-left: 65pt;text-indent: -12pt;line-height: 117%;text-align: left;"><span>String.prototype.map = function (<br/>this: string,</span></p><p class="s17" style="padding-left: 65pt;text-indent: 0pt;text-align: left;">fn: (x: string) =&gt; string</p><p class="s17" style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">) {</p><p class="s17" style="padding-left: 64pt;text-indent: 0pt;text-align: left;">return String(fn(this));</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: left;"><span>As with Boolean values, we are forcing the results of the mapping operations to the correct data types.<br/>By the way, TypeScript won’t directly accept any of these new map () definitions; see </span><i>Question 12.1</i>to fix this.</p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 113%;text-align: left;"><span>Finally, if we wanted to apply mappings to a function, what would that mean? Mapping a function<br/>should produce a function. The logical interpretation for f . map (g) would be applying f (), and<br/>then applying </span><span class="s245">g () </span>to the result. So, <span class="s245">f . map (g) </span>should be the same as writing x = &gt; <span class="s245">g (f (x) )</span></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 11pt;text-align: left;">or, equivalently, <span class="s245">pipe (f, g). </span>The definition is more complex than it was for the previous examples</p><p style="padding-top: 1pt;padding-left: 43pt;text-indent: 0pt;text-align: left;">(but, in my opinion, simpler in HM than with TypeScript), so study it carefully:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// Function.map :: (a -* b) (b -» c) -» (a -» c)</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 20pt;text-indent: 0pt;text-align: left;">452  <span class="s285">Building Better Containers - Functional Data Types</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-top: 7pt;padding-left: 73pt;text-indent: -12pt;line-height: 115%;text-align: left;"><span>Function.prototype.map = function &lt;A, B, C&gt;(<br/>this: (x: A) =&gt; B,</span></p><p class="s17" style="padding-left: 74pt;text-indent: 0pt;text-align: left;">fn: (y: B) =&gt; C</p><p class="s17" style="padding-top: 2pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">): (x: A) =&gt; C {</p><p class="s17" style="padding-top: 2pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">return (x: A) =&gt; fn(this(x));</p><p style="padding-top: 6pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">};</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>Verifying that this works is simple, and the following code is an easy example of how to do this. The<br/>timeslO () mapping function is applied to the result of calculating plusl (3), so the result is 40:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 61pt;text-indent: 0pt;line-height: 115%;text-align: left;"><span>const plusl = (x) =&gt; x + 1;<br/>const timeslO = (y) =&gt; 10 * y;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 61pt;text-indent: 0pt;text-align: left;">console.log(plusl.map(bylO)(3) ) ;</p><p class="s17" style="padding-top: 2pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">// 40: first add 1 to 3, then multiply by 10</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>With this, we are done talking about what we can achieve with basic JavaScript types, but we need a<br/>more general solution if we want to apply this to other data types. We’d like to be able to apply mapping<br/>to any kind of value, and for that, we’ll need to create a container. We’ll do this in the next section.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 52pt;text-indent: 0pt;text-align: left;"><a name="bookmark505">Containers and functors</a></p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>What we did in the previous section works and can be used without problems. However, we would<br/>like to consider a more general solution that we can apply to any data type. Since not all things in<br/>JavaScript provide the desired map () method, we will have to either extend the type (as we did in</span></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;">the previous section) or apply a design pattern that we considered in <i>Chapter 11, Implementing Design</i>wrapping our data types with a wrapper that will provide the required map () operations.</p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">In particular, we will do the following:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l160"><li data-list-text="•"><p style="padding-left: 79pt;text-indent: -13pt;text-align: left;">Start by seeing how to build a basic container, wrapping a value</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 79pt;text-indent: -13pt;text-align: left;">Convert the container into something more powerful—a functor</p></li><li data-list-text="•"><p style="padding-top: 6pt;padding-left: 79pt;text-indent: -13pt;text-align: left;">Study how to deal with missing values using a special functor, <span class="s245">Maybe</span></p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 367pt;text-indent: 0pt;text-align: left;">Building containers   453</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s34" style="padding-top: 8pt;padding-left: 44pt;text-indent: 0pt;text-align: left;">Wrapping a value - a basic container</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: left;">Lets pause for a minute and consider what we need from this wrapper. There are two basic requirements:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l161"><li data-list-text="•"><p style="padding-left: 70pt;text-indent: -13pt;text-align: left;">We must have a map () method</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">We need a simple way to wrap a value</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>To get started, let’s create a basic container. Any object containing just a value would do, but we want<br/>some additions, so our object won’t be that trivial; we’ll explain the differences after the code:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// container.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 64pt;text-indent: -11pt;line-height: 118%;text-align: left;"><span>class Container&lt;A&gt; {<br/>protected x: A;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 76pt;text-indent: -11pt;line-height: 118%;text-align: left;"><span>constructor(x: A) {<br/>this.x = x;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 76pt;text-indent: -12pt;line-height: 119%;text-align: left;"><span>map(fn: (_: A) =&gt; any) {<br/>return fn(this.x);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: left;">Some primary considerations that we need to keep in mind are as follows:</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="•"><p style="padding-left: 70pt;text-indent: -13pt;text-align: left;">We want to be able to store some value in a container, so the constructor takes care of that.</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;line-height: 123%;text-align: left;"><span class="s33">	</span><span>Using a protected attribute avoids “tinkering” from the outside, but allows access to<br/>subclasses. (See </span><i>Question 12.2 </i>for some JavaScript considerations.)</p></li><li data-list-text="•"><p style="padding-top: 5pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">We need to be able to map (), so a method is provided for that.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: left;">Our barebones container is ready, but we can also add some other methods for convenience, as follows:</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="•"><p style="padding-left: 70pt;text-indent: -13pt;line-height: 115%;text-align: left;">To get the value of a container, we could use <span class="s245">map ( (x) = &gt; x), </span><span>but that won’t work with more<br/>complex containers, so we’ll add a valueOf () method to get the contained value.</span></p></li><li data-list-text="•"><p class="s33" style="padding-top: 6pt;padding-left: 70pt;text-indent: -12pt;line-height: 123%;text-align: left;">	<span class="p">Being able to list a container can undoubtedly help with debugging. The toString () method<br/>will come in handy for this.</span></p></li><li data-list-text="•"><p style="padding-top: 3pt;padding-left: 72pt;text-indent: -15pt;text-align: left;">Because we don’t need to write <span class="s245">new Container () </span>all the time, we can add a static <span class="s245">of ()</span></p></li></ul><p style="padding-top: 2pt;padding-left: 70pt;text-indent: 0pt;text-align: left;">method to do the same job.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">454   Building Better Containers - Functional Data Types</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 65pt;text-indent: 0pt;text-align: left;"><a name="bookmark506">A functional sin?</a></p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;line-height: 115%;text-align: left;"><span>Working with classes to represent containers (and later, functors and monads) when living in<br/>a FP world may seem like heresy or sin... but remember that we don’t want to be dogmatic,<br/>and using classes simplifies our coding. Similarly, it could be argued that you must never take<br/>a value out of the container—but using a valueOf () method is sometimes too handy, so we<br/>won’t be that restrictive.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">By taking all of this into account, our container is as follows:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 73pt;text-indent: -11pt;line-height: 117%;text-align: left;"><span>class Container&lt;A&gt; {<br/>protected x: A;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 85pt;text-indent: -12pt;line-height: 115%;text-align: left;"><span>constructor(x: A) {<br/>this.x = x;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 85pt;text-indent: -11pt;line-height: 118%;text-align: left;"><span>static of&lt;B&gt;(x: B): Container&lt;B&gt; {<br/>return new Container(x) ;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 85pt;text-indent: -12pt;line-height: 119%;text-align: left;"><span>map(fn: (_: A) =&gt; any) {<br/>return fn(this.x);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 73pt;text-indent: 0pt;text-align: left;">toStringO {</p><p class="s17" style="padding-top: 2pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">return &#39;${this.constructor.name}(${this.x})</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 85pt;text-indent: -12pt;line-height: 114%;text-align: left;"><span>valueOf() {<br/>return this.x;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 126%;text-align: left;"><span>Now, we can use this container to store a value, and map () to apply any function to that value, but<br/>this isn’t very different from what we could do with a variable! Lets enhance this a bit.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 367pt;text-indent: 0pt;text-align: left;">Building containers   455</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s34" style="padding-top: 8pt;padding-left: 43pt;text-indent: 0pt;text-align: justify;">Enhancing our container - functors</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>We want to have wrapped values, so what exactly should map () return? If we want to be able to chain<br/>operations, the only logical answer is that it should return a new wrapped object. In true functional<br/>style, when we apply a mapping to a wrapped value, the result will be another wrapped value that we<br/>can keep working on.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-top: 5pt;padding-left: 56pt;text-indent: 0pt;text-align: justify;"><a name="bookmark507">A map by any other name</a></p><p style="padding-top: 4pt;padding-left: 57pt;text-indent: 0pt;line-height: 115%;text-align: justify;">Instead of map (), this operation is sometimes called f map (), standing for <i>functorial map.</i><span>The rationale for the name change was to avoid expanding the meaning of map (). However,<br/>since we are working in a language that supports reusing the name, we can keep it.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>We can extend our Container class to implement this change and get ourselves an enhanced<br/>container: </span><i>a functor. </i><span>The of () and map () methods will require a small change. For this, we’ll be<br/>creating a new class, as shown in the following code:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 53pt;text-indent: 0pt;text-align: justify;">// functor.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 65pt;text-indent: -12pt;line-height: 118%;text-align: left;"><span>class  Functor&lt;A&gt;  extends  Container&lt;A&gt;  {<br/>static of&lt;B&gt;(x: B) {</span></p><p class="s17" style="padding-left: 77pt;text-indent: 0pt;line-height: 13pt;text-align: left;">return new Functor(x) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 77pt;text-indent: -12pt;line-height: 118%;text-align: left;"><span>map&lt;B&gt;(fn:    A) =&gt; B): Functor&lt;B&gt; {<br/>return Functor.of(fn(this.x));</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Here, the of () method produces a Functor object, and so does the map () method. With these<br/>changes, we have just defined what </span><i>a functor </i><span>is in category theory! (Or, if you want to get really<br/>technical, a </span><i>pointed functor </i><span>because of the of () method—but let’s keep it simple.) We won’t go<br/>into  the theoretical details, but roughly speaking, a functor is some container that allows us to apply<br/>map () to its contents, producing a new container of the same type. If this sounds familiar, it’s because<br/>you already know a functor: arrays! When you apply map () to an array, the result is a new array<br/>containing transformed (mapped) values.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">456  Building Better Containers - Functional Data Types</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 65pt;text-indent: 0pt;text-align: left;"><a name="bookmark508">Extra requirements</a></p><p style="padding-top: 3pt;padding-left: 65pt;text-indent: 0pt;line-height: 12pt;text-align: left;"><span>There are more requirements for functors. First, the contained values may be polymorphic (of<br/>any type), just like arrays. Second, a function must exist whose mapping produces the same<br/>contained value— (x) =&gt; x does this for us. Finally, applying two consecutive mappings<br/>must produce the same result as applying their composition. This means that </span><span class="s245">container.<br/>map(f) .map(g) </span>must be the same as <span class="s245">container. map (compose (g, f)).</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: justify;">Let’s pause for a moment and consider the signatures for our function and methods:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 62pt;text-indent: 0pt;text-align: left;">//of : : Functor f =&gt; a ■+ f a</p><p class="s17" style="padding-top: 2pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">// Functor.toString :: Functor f =&gt; f a String</p><p class="s17" style="padding-top: 2pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">// Functor .valueOf : : Functor f =&gt; f a a</p><p class="s17" style="padding-top: 2pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">// Functor.map : : Functor f f a (a -» b) -» f b</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>The first function, of (), is the simplest: given a value of any type, it produces a functor of that type. The<br/>following two are also relatively simple to understand: given a functor, toString () always returns a<br/>string (no surprise there!), and if the functor-contained value is of a given type, valueOf () produces<br/>a result of that same type. The third one, map (), is more interesting. Given a function that takes an<br/>argument of type a and produces a result of type b, applying it to a functor that contains a value of<br/>type a produces a functor containing a value of type b. This is precisely what we described previously.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 66pt;text-indent: 0pt;text-align: left;"><a name="bookmark509">Promises and Functors</a></p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;line-height: 115%;text-align: left;"><span>You could compare functors to promises, at least in one aspect. With functors, instead of acting<br/>on its value directly, you have to apply a function with map (). In promises, you do exactly</span></p><p style="padding-left: 65pt;text-indent: 0pt;text-align: left;">the same, but using then () instead! In fact, there are more analogies, as we’ll be seeing soon.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 8pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>As is, functors are not allowed or expected to produce side effects, throw exceptions, or exhibit any<br/>other behavior outside of producing a container-ed result. Their main usage is to provide us with a<br/>way to manipulate a value, apply operations to it, compose results, and so on, without changing the<br/>original value—in this sense, we are once again coming back to immutability.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>However, you could reasonably say that this isn’t enough since, in everyday programming, it’s pretty<br/>common to have to deal with exceptions, undefined or null values, and so on. So, let’s start by looking<br/>at more examples of functors. After that, we’ll enter the realm of monads to look at even more<br/>sophisticated processing. Let’s experiment a bit!</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s34" style="padding-left: 52pt;text-indent: 0pt;text-align: justify;">Dealing with missing values with Maybe</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>A common problem in programming is dealing with missing values. There are many possible causes<br/>for this situation: a web service Ajax call may have returned an empty result, a dataset could be empty,<br/>an optional attribute might be missing from an object, and so on. In a normal imperative fashion,<br/>dealing with this kind of situation requires adding i f statements or ternary operators everywhere to</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 367pt;text-indent: 0pt;text-align: left;">Building containers   457</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>catch the possible missing value to avoid a certain runtime error. We can do better by implementing<br/>a Maybe functor to represent a value that may (or may not) be present! We will use two classes,<br/>Just (as in </span><i>just some value) </i><span>and Nothing, both of which are functors. The Nothing functor is<br/>particularly simple, with trivial methods:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// maybe.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 65pt;text-indent: -12pt;line-height: 117%;text-align: left;"><span>class  Nothing  extends  Maybe&lt;any&gt;  {<br/>constructor() {</span></p><p class="s17" style="padding-left: 77pt;text-indent: 0pt;text-align: left;">super(null);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 77pt;text-indent: -11pt;line-height: 117%;text-align: left;"><span>isNothingt)  {<br/>return true;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 64pt;text-indent: 0pt;text-align: left;">toString() {</p><p class="s17" style="padding-top: 2pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">return &quot;Nothing()</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 76pt;text-indent: -12pt;line-height: 118%;text-align: left;"><span>map(_fn: FN) {<br/>return this;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>The isNothing () method returns true, toString () returns constant text, and map () always<br/>returns itself, no matter what function it’s given.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Moving forward, the Just functor is also a basic one, with the added isNothing () method<br/>(which always returns false, since a Just object isn’t Nothing), and a map () method that now<br/>returns Maybe:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 65pt;text-indent: -12pt;line-height: 118%;text-align: left;"><span>class Just&lt;A&gt; extends Maybe&lt;A&gt; {<br/>static of&lt;B&gt;(x: B): Maybe&lt;B&gt; {</span></p><p class="s17" style="padding-left: 88pt;text-indent: -11pt;line-height: 119%;text-align: left;"><span>if  (x  ===  null  ||  x  ===  undefined)  {<br/>throw new Error(&quot;Just should have a value&quot;);</span></p><p class="s17" style="padding-left: 77pt;text-indent: 0pt;line-height: 13pt;text-align: left;">} else {</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">458  Building Better Containers - Functional Data Types</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 97pt;text-indent: 0pt;text-align: left;">return new Just(x);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 85pt;text-indent: -11pt;line-height: 118%;text-align: left;"><span>isNothingO  {<br/>return false;</span></p><p class="s17" style="padding-top: 2pt;padding-left: 75pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 85pt;text-indent: -12pt;line-height: 119%;text-align: left;"><span>map&lt;B&gt;(fn: (_: A) =&gt; B): Just&lt;B&gt; {<br/>return new Just(fn(this.x));</span></p><p class="s17" style="padding-top: 1pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">}</p><p class="s17" style="padding-top: 2pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Finally, our Maybe class packs the logic needed to construct either Nothing or Just. If it receives<br/>an undefined or null value, Nothing will be constructed; in other cases, Just will be the result.<br/>The of () method has exactly the same behavior:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 74pt;text-indent: -12pt;line-height: 115%;text-align: left;"><span>abstract  class  Maybe&lt;A&gt;  extends  Functor&lt;A&gt;  {<br/>static of&lt;B&gt;(x: B): Maybe&lt;B&gt; {</span></p><p class="s17" style="padding-left: 85pt;text-indent: 0pt;text-align: left;">return x === null || x === undefined</p><p class="s17" style="padding-top: 2pt;padding-left: 98pt;text-indent: 0pt;text-align: left;">? new Nothing()</p><p class="s17" style="padding-top: 2pt;padding-left: 99pt;text-indent: 0pt;text-align: left;">: new Just(x);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 74pt;text-indent: 0pt;text-align: left;">isNothingO {</p><p class="s17" style="padding-top: 2pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">/*  abstract  */</p><p class="s17" style="padding-top: 4pt;padding-left: 75pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 85pt;text-indent: -12pt;line-height: 118%;text-align: left;"><span>map&lt;B&gt;(fn: (_: A) =&gt; B): Maybe&lt;B&gt; {<br/>return Maybe.of(fn(this.x));</span></p><p class="s17" style="padding-top: 2pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">}</p><p class="s17" style="padding-top: 2pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>We are using an abstract class because you shouldn’t directly write new Maybe (...); you should<br/>use Maybe . of () or directly build Just or Nothing. (If you are wondering how to do this in<br/>JavaScript, see </span><i>Question 12.3.) </i><span>We can quickly verify that this works by trying to apply an operation<br/>to either a valid value or a missing one. Let’s look at two examples of this:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 367pt;text-indent: 0pt;text-align: left;">Building containers   459</p><p class="s17" style="padding-top: 3pt;padding-left: 52pt;text-indent: 0pt;line-height: 30pt;text-align: left;"><span>const plusl = x =&gt; x + 1;<br/>Maybe.of(2209).map(plusl).map(plusl).toString();</span></p><p class="s17" style="padding-top: 2pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// &quot;Just(2211)&quot;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 52pt;text-indent: 0pt;text-align: left;">Maybe.of(null).map(plusl).map(plusl).toString();</p><p class="s17" style="padding-top: 1pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// &quot;Nothing()&quot;</p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;text-align: justify;">When we applied <span class="s245">plus 1 () </span>(twice) to <span class="s245">Maybe .of (2209), </span><span>everything worked fine, and we ended<br/>up with a </span><span class="s245">Just (2 011) </span>value. On the other hand, when we applied the same sequence of operations</p><p style="padding-top: 1pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>to a Maybe . of (null) value, the end result was Nothing, but there were no errors, even if we<br/>tried to do math with a nul 1 value. A Maybe functor can deal with mapping a missing value by just<br/>skipping the operation and returning a wrapped null value instead. This means that this functor<br/>includes an abstracted check, which won’t let an error happen.</span></p><p style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>(Later in this chapter, we’ll see that Maybe can actually be a monad instead of a functor, and we’ll<br/>also examine more examples of monads.)</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;text-align: justify;">Let’s look at a more realistic example of its usage.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 43pt;text-indent: 0pt;text-align: justify;">Dealing with varying API results</p><p style="padding-top: 9pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Suppose we are writing a small server-side service in Node.js to get the weather alerts for a city<br/>and produce a not-very-fashionable HTML &lt;table&gt; with them, to be part of some server-side-<br/>produced web page. (Yes, I know you should try to avoid tables in your pages, but I want a short<br/>example of HTML generation, and the actual results aren’t significant.) If we used the </span><i>Dark Sky </i><span>API<br/>(see darksky. net for more on this API and how to register with it) to get the alarms, our code<br/>would be something like the following, all quite normal. Note the callback in case of an error; you’ll<br/>see why in the following code:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">import request from &quot;superagent&quot;;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 64pt;text-indent: -11pt;line-height: 117%;text-align: left;"><span>const getAlerts = (<br/>lat: number,<br/>long: number,<br/>callback: FN</span></p><p class="s17" style="padding-top: 1pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">) =&gt; {</p><p class="s17" style="padding-top: 1pt;padding-left: 64pt;text-indent: 0pt;line-height: 115%;text-align: left;"><a href="https://api.darksky.net/forecast" class="s14" target="_blank">const SERVER = &quot;</a><span>https://api.darksky.net/forecast&quot;;<br/>const UNITS = &quot;units=si&quot;;</span></p><p class="s17" style="padding-left: 64pt;text-indent: 0pt;line-height: 117%;text-align: left;"><span>const EXCLUSIONS = &quot;exclude=minutely,hourly,daily,flags&quot;;<br/>const API_KEY = &quot;you.need.to.get.your.own.api.key&quot;;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">460  Building Better Containers - Functional Data Types</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 73pt;text-indent: 0pt;text-align: left;">request</p><p class="s17" style="padding-top: 2pt;padding-left: 87pt;text-indent: 0pt;text-align: left;">. get (</p><p class="s289" style="padding-top: 2pt;padding-left: 98pt;text-indent: 0pt;text-align: left;">~${<span class="s290">SERVER</span>}/${<span class="s290">API</span>_</p><p class="s17" style="padding-top: 1pt;padding-left: 109pt;text-indent: 0pt;text-align: left;">KEY}/${lat},${long}?${UNITS}&amp;${EXCLUSIONS}&#39;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 98pt;text-indent: -10pt;line-height: 114%;text-align: left;"><span>.end(function (err, res) {<br/>if (err) {</span></p><p class="s17" style="padding-left: 109pt;text-indent: 0pt;text-align: left;">callback({});</p><p class="s17" style="padding-top: 2pt;padding-left: 98pt;text-indent: 0pt;text-align: left;">} else {</p><p class="s17" style="padding-top: 2pt;padding-left: 109pt;text-indent: 0pt;text-align: left;">callback(JSON.parse(res.text));</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 86pt;text-indent: 0pt;text-align: left;">});</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">The (heavily edited and reduced in size) output of such a call might be something like this:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">{</p><p class="s10" style="padding-top: 2pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">latitude: 29.76,</p><p class="s10" style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">longitude: -95.37,</p><p class="s10" style="padding-top: 4pt;padding-left: 73pt;text-indent: 0pt;line-height: 143%;text-align: left;"><span>timezone: &quot;America/Chicago&quot;,<br/>offset: -5,</span></p><p class="s10" style="padding-left: 73pt;text-indent: 0pt;text-align: left;">currently: {</p><p class="s10" style="padding-top: 4pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">time: 1503660334,</p><p class="s10" style="padding-top: 4pt;padding-left: 86pt;text-indent: 0pt;line-height: 143%;text-align: left;"><span>summary: &quot;Drizzle&quot;,<br/>icon: &quot;rain&quot;,<br/>temperature: 24.97,</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-top: 4pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">uvlndex: 0,</p><p class="s10" style="padding-top: 6pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">b</p><p class="s10" style="padding-top: 2pt;padding-left: 47pt;text-indent: 0pt;text-align: center;">alerts: [</p><p class="s10" style="padding-top: 6pt;text-indent: 0pt;text-align: center;">{</p><p class="s10" style="padding-top: 2pt;padding-left: 97pt;text-indent: 0pt;line-height: 143%;text-align: left;"><span>title: &quot;Tropical Storm Warning&quot;,<br/>regions: [&quot;Harris&quot;],</span></p><p class="s10" style="padding-left: 98pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>severity: &quot;warning&quot;.<br/>time: 1503653400</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 367pt;text-indent: 0pt;text-align: left;">Building containers   461</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 88pt;text-indent: 0pt;line-height: 142%;text-align: left;"><span>expires: 1503682200,<br/>description:</span></p><p class="s10" style="padding-left: 101pt;text-indent: 0pt;text-align: left;">&quot;TROPICAL STORM WARNING REMAINS IN EFFECT... WIND -</p><p class="s10" style="padding-top: 1pt;padding-left: 100pt;text-indent: 0pt;text-align: left;">LATEST LOCAL FORECAST: Below tropical storm force wind</p><p class="s10" style="padding-top: 1pt;padding-left: 102pt;text-indent: 0pt;text-align: left;">... CURRENT THREAT TO LIFE AND PROPERTY: Moderate ...</p><p class="s10" style="padding-top: 1pt;padding-left: 100pt;text-indent: 0pt;line-height: 115%;text-align: left;"><span>Locations could realize roofs peeled off buildings,<br/>chimneys toppled, mobile homes pushed off foundations<br/>or overturned ...&quot;,</span></p><p class="s10" style="padding-top: 2pt;padding-left: 88pt;text-indent: 0pt;line-height: 115%;text-align: left;"><a href="https://alerts.weather.gov/cap/wwacapget.php?x" class="s291" target="_blank">uri: &quot;</a><span>https://alerts.weather.gov/cap/wwacapget.php?x=<br/>TX125862DD4F88.TropicalStormWarning.125862DE8808TX.<br/>HGXTCVHGX.73ee697556fc6f3af764981239la38b3&quot;,</span></p><p class="s10" style="padding-top: 5pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">b</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">{</p><p class="s10" style="padding-top: 2pt;padding-left: 89pt;text-indent: 0pt;line-height: 143%;text-align: justify;"><span>title: &quot;Hurricane Local Statement&quot;,<br/>regions: [&quot;Austin&quot;, ... , &quot;Wharton&quot;],<br/>severity: &quot;advisory&quot;,</span></p><p class="s10" style="padding-left: 89pt;text-indent: 0pt;text-align: justify;">time: 1503748800,</p><p class="s10" style="padding-top: 4pt;padding-left: 88pt;text-indent: 0pt;line-height: 143%;text-align: justify;"><span>expires: 1503683100,<br/>description:</span></p><p class="s10" style="padding-left: 101pt;text-indent: 0pt;text-align: justify;">&quot;This product covers Southeast Texas **HURRICANE</p><p class="s10" style="padding-top: 1pt;padding-left: 100pt;text-indent: 0pt;text-align: justify;">HARVEY DANGEROUSLY APPROACHING THE TEXAS COAST** ...</p><p class="s10" style="padding-top: 1pt;padding-left: 100pt;text-indent: 0pt;line-height: 115%;text-align: left;"><span>The next local statement will be issued by the National<br/>Weather Service in Houston/Galveston TX around 1030 AM<br/>CDT, or sooner if conditions warrant.\n&quot;,</span></p><p class="s10" style="padding-top: 2pt;padding-left: 88pt;text-indent: 0pt;text-align: left;"><a href="https://alerts.weather.gov/" class="s291" target="_blank">uri: &quot;</a>https://alerts.weather.gov/...&quot;,</p><p class="s10" style="padding-top: 6pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">b</p><p class="s10" style="padding-top: 3pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">] ,</p><p class="s10" style="padding-top: 5pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">b</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>I got this information for Houston, TX, US, on a day when Hurricane Harvey was approaching the<br/>state. If you called the API on a normal day, the data would not include the alerts: [. . . ] part.</span></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>Here, we can use a Maybe functor to process the received data without any problems, with or without<br/>any alerts:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">import os from &quot;os&quot;;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 52pt;text-indent: 0pt;text-align: left;">const produceAlertsTable = (weatherObj: typeof resp)</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">462   Building Better Containers - Functional Data Types</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 73pt;text-indent: 0pt;text-align: left;">Maybe.of(weatherObj)</p><p class="s17" style="padding-top: 2pt;padding-left: 87pt;text-indent: 0pt;text-align: left;">.map((w: typeof resp) =&gt; w.alerts)</p><p class="s17" style="padding-top: 2pt;padding-left: 97pt;text-indent: -10pt;line-height: 114%;text-align: left;"><span>.map((a) = &gt;<br/>a.map(</span></p><p class="s17" style="padding-left: 112pt;text-indent: 0pt;text-align: left;">(x) =&gt;</p><p class="s17" style="padding-top: 2pt;padding-left: 122pt;text-indent: 0pt;line-height: 113%;text-align: left;"><span>&#39;&lt;trxtd&gt;${x. title} &lt;/td&gt;&#39; +<br/>&#39;&lt;td&gt;${x.description.substr(0 ,</span></p><p class="s17" style="padding-left: 134pt;text-indent: 0pt;text-align: left;">500) } . . .&lt;/tdx/tr&gt;&#39;</p><p class="s17" style="padding-top: 2pt;padding-left: 98pt;text-indent: 0pt;text-align: left;">)</p><p class="s17" style="padding-top: 2pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">)</p><p class="s17" style="padding-top: 1pt;padding-left: 87pt;text-indent: 0pt;text-align: left;">,map((a) =&gt; a.join(os.EOL))</p><p class="s17" style="padding-top: 2pt;padding-left: 87pt;text-indent: 0pt;text-align: left;">,map((s) =&gt; &#39;&lt;table&gt;${s}&lt;/table&gt;&#39;) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 73pt;text-indent: -12pt;line-height: 117%;text-align: left;"><span>getAlerts(29.76, -95.37, (x) =&gt;<br/>console.log(produceAlertsTable(x).valueOf())</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>Of course, you would probably do something more interesting than just logging the value of the<br/>contained result of produceAlertsTable ()! The most likely option would be to use map ()</span></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>again with a function that would output the table, send it to a client, or do whatever you needed to<br/>do.                                               In any case, the resulting output would look something like this:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 61pt;text-indent: 0pt;text-align: left;">&lt;tablextrxtd&gt;Tropical Storm Warning&lt;/tdxtd&gt; ... TROPICAL STORM</p><p class="s10" style="padding-top: 1pt;padding-left: 61pt;text-indent: 0pt;line-height: 115%;text-align: justify;"><span>WARNING REMAINS IN EFFECT..................... STORM SURGE WATCH REMAINS IN<br/>EFFECT... * WIND -</span></p><p class="s10" style="padding-top: 2pt;padding-left: 61pt;text-indent: 0pt;line-height: 115%;text-align: justify;"><span>LATEST LOCAL FORECAST: Below tropical storm force wind - Peak<br/>Wind Forecast: 25-35 mph with gusts to 45 mph - CURRENT THREAT<br/>TO LIFE AND PROPERTY: Moderate - The wind threat has remained<br/>nearly steady from the previous assessment. - Emergency plans</span></p><p class="s10" style="padding-left: 62pt;text-indent: 0pt;line-height: 115%;text-align: left;"><span>should include a reasonable threat for strong tropical storm<br/>force wind of 58 to 73 mph. - To be safe, earnestly prepare for<br/>the potential of significant... &lt;/tdx/tr&gt;</span></p><p class="s10" style="padding-top: 2pt;padding-left: 62pt;text-indent: 0pt;line-height: 118%;text-align: left;"><span>&lt;trxtd&gt;Flash Flood Watch&lt;/tdxtd&gt;... FLASH FLOOD WATCH REMAINS<br/>IN EFFECT</span></p><p class="s10" style="padding-top: 2pt;padding-left: 61pt;text-indent: 0pt;line-height: 115%;text-align: left;"><span>THROUGH MONDAY MORNING... The Flash Flood Watch continues<br/>for * Portions of Southeast Texas... including the following<br/>counties...Austin...Brazoria...Brazos...Burleson...</span></p><p class="s10" style="padding-top: 2pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">Chambers...Colorado...Fort Bend...Galveston...Grimes...</p><p class="s10" style="padding-top: 4pt;padding-left: 61pt;text-indent: 0pt;line-height: 115%;text-align: left;"><span>Harris...Jackson...Liberty...Matagorda...Montgomery...Waller...<br/>Washington and Wharton. * Through Monday morning * Rainfall</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 367pt;text-indent: 0pt;text-align: left;">Building containers   463</p><p class="s10" style="padding-top: 22pt;padding-left: 53pt;text-indent: 0pt;line-height: 118%;text-align: left;"><span>from Harvey will cause devastating and life threatening<br/>flooding as a prolonged heavy rain and flash flood thre.</span><span class="p"> </span>&lt;/</p><p class="s10" style="padding-left: 53pt;text-indent: 0pt;line-height: 10pt;text-align: left;">tdx/tr&gt;</p><p class="s10" style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;line-height: 115%;text-align: left;"><span>&lt;trxtd&gt;Hurricane Local Statement&lt;/tdxtd&gt;This product covers<br/>Southeast</span></p><p class="s10" style="padding-top: 2pt;padding-left: 52pt;text-indent: 0pt;line-height: 115%;text-align: left;"><span>Texas *‘PREPARATIONS FOR HARVEY SHOULD BE RUSHED TO COMPLETION<br/>THIS MORNING** NEW INFORMATION</span><span class="p">           </span>* CHANGES TO</p><p class="s10" style="padding-left: 52pt;text-indent: 0pt;text-align: left;">WATCHES AND</p><p class="s10" style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">WARNINGS: - None * CURRENT WATCHES AND WARNINGS: - A Tropical</p><p class="s10" style="padding-top: 1pt;padding-left: 52pt;text-indent: 0pt;line-height: 115%;text-align: left;"><span>Storm Warning and Storm Surge Watch are in effect for Chambers<br/>and Harris - A Tropical Storm Warning is in effect for Austin,<br/>Colorado, Fort Bend, Liberty, Waller, and Wharton - A Storm<br/>Surge Warning and Hurricane Warning are in effect for Jackson<br/>and Matagorda - A Storm S.</span><span class="p">  </span>&lt;/tdx/trx/table&gt;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><table style="border-collapse:collapse" cellspacing="0"><tr style="height:59pt"><td style="width:37pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s20" style="padding-left: 2pt;padding-right: 1pt;text-indent: 0pt;line-height: 83%;text-align: left;"><span>Tropical<br/>Storm<br/>Warning</span></p></td><td style="width:355pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s20" style="padding-left: 2pt;text-indent: 0pt;line-height: 10pt;text-align: justify;">...TROPICAL STORM WARNING REMAINS IN EFFECT...STORM SURGE WATCH REMAINS IN</p><p class="s20" style="padding-left: 2pt;text-indent: 0pt;line-height: 84%;text-align: justify;"><span>EFFECT... * WIND - LATEST LOCAL FORECAST: Below tropical storm force wind - Peak Wind<br/>Forecast: 25-35 mph with gusts to 45 mph - CURRENT THREAT TO LIFE AND PROPERTY: Moder</span></p><p class="s20" style="padding-left: 1pt;text-indent: 0pt;line-height: 82%;text-align: justify;"><span>- The wind threat has remained nearly steady from the previous assessment. - Emergency plans shou<br/>include a reasonable threat for strong tropical storm force wind of 58 to 73 mph. - To be safe, earnes<br/>prepare for the potential of significant...</span></p></td></tr><tr style="height:59pt"><td style="width:37pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s20" style="padding-left: 2pt;padding-right: 9pt;text-indent: 0pt;line-height: 83%;text-align: justify;"><span>Flash<br/>Flood<br/>Watch</span></p></td><td style="width:355pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s20" style="padding-left: 2pt;text-indent: 0pt;line-height: 10pt;text-align: left;">...FLASH FLOOD WATCH REMAINS IN EFFECT THROUGH MONDAY MORNING... The Flash</p><p class="s20" style="padding-left: 2pt;text-indent: 0pt;line-height: 83%;text-align: left;"><span>Flood Watch continues for * Portions of Southeast Texas...Including the following<br/>counties...Austin...Brazoria...Brazos...Burleson... Chambers...Colorado...Fort Bend...Galveston...Grim<br/>Harris...Jackson...Liberty...Matagorda...Montgomery ..Waller...    Washington    and    Wharton.    *    Through<br/>Monday morning * Rainfall from Harvey will cause devastating and life threatening flooding as a</span></p><p class="s20" style="padding-left: 1pt;text-indent: 0pt;line-height: 9pt;text-align: left;">prolonged heavy rain and flash flood thre...</p></td></tr><tr style="height:60pt"><td style="width:37pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s20" style="padding-left: 3pt;text-indent: 0pt;line-height: 83%;text-align: left;"><span>Hurricane<br/>Local<br/>Statement</span></p></td><td style="width:355pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s20" style="padding-top: 1pt;padding-left: 2pt;padding-right: 2pt;text-indent: 0pt;line-height: 84%;text-align: justify;"><span>This product covers Southeast Texas ^PREPARATIONS FOR HARVEY SHOULD BE RUSHED TO<br/>COMPLETION THIS MORNING** NEW INFORMATION</span><span class="s292">    </span>* CH .ANGES TO WATCHES</p><p class="s20" style="padding-left: 1pt;text-indent: 0pt;line-height: 83%;text-align: justify;"><span>AND WARNINGS: - None * CURRENT WATCHES AND WARNINGS: - A Tropical Storm Warning<br/>and Storm Surge Watch are in effect for Chambers and Harris - A Tropical Storm Warning is in effec<br/>Austin, Colorado, Fort Bend, Liberty, Waller, and Wharton - A Storm Surge Warning and Hurricane<br/>Warning are in effect for Jackson and Matagorda - A Storm S...</span></p></td></tr></table><p style="text-indent: 0pt;text-align: left;"/><p style="padding-left: 43pt;text-indent: 0pt;text-align: justify;">The output of the preceding code can be seen in the following screenshot:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s24" style="padding-top: 8pt;padding-left: 439pt;text-indent: 2pt;line-height: 83%;text-align: left;"><span>ate<br/>ld<br/>tly</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s24" style="padding-left: 439pt;text-indent: 0pt;text-align: left;">es...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s24" style="padding-left: 441pt;text-indent: 0pt;text-align: left;">t for</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-left: 139pt;text-indent: 0pt;line-height: 154%;text-align: center;"><span>Figure 12.1 -The output table is not much to look at, but the logic<br/>that produced it didn&#39;t require a single if statement</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: center;">If we had called <span class="s245">getAlerts ( - 34.9 , -54.60, </span><span>. ..) with the coordinates for Montevideo,<br/>Uruguay, instead, since there were no alerts for that city, the </span><span class="s245">getField (&quot;alerts&quot; ) </span>function</p><p style="padding-top: 1pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>would have returned undefined—and since that value is recognized by the Maybe functor, and<br/>even though all the following map () operations would still be executed, no one would actually do<br/>anything, and a null value would be the final result.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">464   Building Better Containers - Functional Data Types</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>We took advantage of this behavior when we coded the error logic. If an error occurs when calling<br/>the service, we would still call the original callback to produce a table but provide an empty object.<br/>Even if this result is unexpected, we would be safe because the same guards would avoid causing a<br/>runtime error.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>As a final enhancement, we can add an orElse () method to provide a default value when no value<br/>is provided. The added method will return the default value if Maybe is Nothing, or the Maybe<br/>value itself otherwise:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 61pt;text-indent: 0pt;text-align: left;">class Maybe&lt;A&gt; extends Functor&lt;A&gt; {</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-top: 7pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">orElse(v:  any)  {</p><p class="s10" style="padding-top: 4pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">/* abstract */</p><p class="s10" style="padding-top: 6pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">class Nothing extends Functor&lt;any&gt; {</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-top: 7pt;padding-left: 85pt;text-indent: -12pt;line-height: 144%;text-align: left;"><span>orElse(v: any) {<br/>return v;</span></p><p class="s10" style="padding-top: 2pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">class Just&lt;A&gt; extends Functor&lt;A&gt; {</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-top: 7pt;padding-left: 85pt;text-indent: -12pt;line-height: 143%;text-align: left;"><span>orElse(v:  any)  {<br/>return this.x;</span></p><p class="s10" style="padding-top: 2pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 367pt;text-indent: 0pt;text-align: left;">Building containers   465</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: left;"><span>Using this new method instead of valueOf (), trying to get the alerts for someplace without weather<br/>warnings would just return a default result. In the case we mentioned previously, attempting to get<br/>the alerts for Montevideo, instead of a null value, we would get the following appropriate result:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 65pt;text-indent: -12pt;line-height: 118%;text-align: left;"><span>getAlerts(-34.9, -54.6, (x) =&gt;<br/>console.log(</span></p><p class="s17" style="padding-left: 76pt;text-indent: 0pt;line-height: 13pt;text-align: left;">produceAlertsTable(x)<span class="s10">.orElsef</span></p><p class="s10" style="padding-top: 4pt;padding-left: 89pt;text-indent: 0pt;text-align: left;">&quot;&lt;span&gt;No    alerts    today.&lt;/span&gt;&quot;</p><p class="s10" style="padding-top: 5pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">)</p><p class="s17" style="padding-top: 2pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">)</p><p class="s17" style="padding-top: 2pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>With this, we have looked at an example of dealing with different situations when working with an<br/>API. Let’s quickly revisit another topic from a previous chapter and look at a better implementation<br/>of prisms.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 43pt;text-indent: 0pt;text-align: justify;">Implementing prisms</p><p style="padding-top: 9pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;">The more common implementations of prisms (which we first met in the <i>Prisms </i>section of <i>Chapter 10,</i><span>instead of returning either some value or unde f ined and leaving it up to the<br/>caller to check what happened, opt to return Maybe, which already provides us with easy ways to<br/>deal with missing values. In our new implementation (which we’ll look at soon), our example from<br/>the aforementioned chapter would look like this:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 64pt;text-indent: -11pt;line-height: 118%;text-align: left;"><span>const author = {<br/>user: &quot;fkereki&quot;,<br/>name: {</span></p><p class="s17" style="padding-left: 76pt;text-indent: 1pt;line-height: 117%;text-align: left;"><span>first: &quot;Federico&quot;,<br/>middle: &quot;&quot;,</span></p><p class="s17" style="padding-left: 77pt;text-indent: 0pt;line-height: 13pt;text-align: left;">last: &quot;Kereki&quot;,</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 64pt;text-indent: 0pt;text-align: left;">books: [</p><p class="s17" style="padding-top: 2pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">{ name: &quot;Google Web Toolkit&quot;, year: 2010 },</p><p class="s17" style="padding-top: 2pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">{ name: &quot;Functional Programming&quot;, year: 2017 },</p><p class="s17" style="padding-top: 2pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">{ name: &quot;Javascript Cookbook&quot;, year: 2018 },</p><p class="s17" style="padding-top: 2pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">] ,</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;text-align: left;">If we wanted to access the <span class="s245">author. user </span>attribute, the result would be different:</p><p class="s17" style="padding-top: 10pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">const pUser = prismProp(&quot;user&quot;);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">466  Building Better Containers - Functional Data Types</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 61pt;text-indent: 0pt;text-align: left;">console.log(review(pUser, author).toString());</p><p class="s17" style="padding-top: 3pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">/*</p><p class="s10" style="padding-top: 2pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">Just(&quot;fkereki&quot;)</p><p class="s17" style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">*/</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>Similarly, if we asked for a non-existent pseudonym attribute, instead of undefined (as in our<br/>previous version of Prism), we would get Nothing:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 62pt;text-indent: 0pt;text-align: left;"><span>const pPseudonym = prismProp(&quot;pseudonym&quot;); console.<br/>log(review(pPseudonym, author).toString());</span></p><p class="s17" style="padding-top: 3pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">/*</p><p class="s10" style="padding-top: 2pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">Nothing()</p><p class="s17" style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">*/</p><p style="padding-top: 8pt;padding-left: 52pt;text-indent: 0pt;text-align: justify;">So, this new version of <span class="s245">Prism </span>is better to work with if you are already used to dealing with <span class="s245">Maybe<br/></span>values. What do we need to implement this? We need just a single change; our <span class="s245">Constant </span><span>class now<br/>needs to return </span><span class="s245">Maybe </span>instead of a value, so we’ll have a new <span class="s245">Constant? (P </span>for <span class="s245">Prism) </span>class:</p><p class="s17" style="padding-top: 9pt;padding-left: 73pt;text-indent: -11pt;line-height: 129%;text-align: left;"><span>class ConstantP&lt;V&gt; {<br/></span><span class="s10">private value: Maybe&lt;V&gt;;<br/></span>map: FN;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 85pt;text-indent: -12pt;line-height: 129%;text-align: left;"><span>constructor(v: V) {<br/></span><span class="s10">this.value = Maybe.of(v);<br/></span>this.map = () =&gt; this;</p><p class="s17" style="padding-left: 74pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: justify;">We will have to rewrite preview () to use the new class, and that finishes the change:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 76pt;text-indent: -14pt;line-height: 117%;text-align: left;"><span>const preview = curry(<br/>(prismAttr, obj) =&gt;</span></p><p class="s10" style="padding-top: 2pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">prismAttr((x) =&gt; new Constant?(x))(obj).value</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>So, getting Prism to work with Maybe wasn’t that hard, and now we have a consistent way of dealing<br/>with possibly missing attributes. Working in this fashion, we can simplify our coding and avoid many<br/>tests for nulls and other similar situations. However, we may want to go beyond this; for instance, we<br/>may want to know why there were no alerts: was it a service error? Or just a normal situation? Just<br/>getting null at the end isn’t enough, and to work with these new requirements, we will need to add some<br/>extra functionality to our functors (as we’ll see in the next section) and enter the domain of </span><i>monads.</i></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 367pt;text-indent: 0pt;text-align: left;">Building containers   467</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 43pt;text-indent: 0pt;text-align: left;"><a name="bookmark510">Monads</a></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Monads have weird fame among programmers. Well-known developer Douglas Crockford has<br/>famously spoken of a curse, maintaining that </span><i>“Once you happen to finally understand monads, you</i><span>” On a different note, if you decide to go<br/>back   to the basics and read </span><i>Categories for the Working Mathematician </i><span>by Saunders Mac Lane (one of<br/>the creators of category theory), you may find a somewhat disconcerting explanation—which is not<br/>too illuminating!</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s9" style="padding-left: 43pt;text-indent: 0pt;text-align: center;">A monad in X is just a monoid in the category of endofunctors ofX, with product</p><p style="padding-top: 1pt;padding-left: 43pt;text-indent: 0pt;text-align: center;">x <i>replaced by composition of endofunctors and unit set by the identity endofunctor.</i></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>The difference between monads and functors is that the former adds some extra functionality; we’ll<br/>see what functionality they add soon. Let’s start by looking at the new requirements before moving on<br/>and considering some common, useful monads. As with functors, we will have a basic monad, which<br/>you could consider an </span><i>abstract </i>version, and specific <i>monadic types, </i>which are <i>concrete </i><span>implementations<br/>geared to solve specific cases.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 56pt;text-indent: 0pt;text-align: justify;"><a name="bookmark511">All you could want to read</a></p><p style="padding-top: 4pt;padding-left: 56pt;text-indent: 0pt;line-height: 108%;text-align: justify;"><span>To read a precise and careful description of functors, monads, and their family (but leaning<br/>heavily to the theoretical side, with plenty of algebraic definitions to go around), try the </span><i>Fantasy</i>at <span class="s245">github . com/ fantasyland/fantasy-land/. </span><span>Please don’t say<br/>we didn’t warn you: the alternative name for that page is </span><i>Algebraic JavaScript Specification&#39;:</i></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s34" style="padding-top: 8pt;padding-left: 43pt;text-indent: 0pt;text-align: justify;">Adding operations</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Let’s consider a simple problem. Suppose you have the following pair of functions, working with<br/>Maybe functors: the first function tries to search for something (say, a client or a product) given its<br/>key, and the second attempts to extract some attribute from whatever we found (I’m being purposefully<br/>vague because the problem does not have anything to do with whatever objects or things we may be<br/>working with). Both functions produce Maybe results to avoid possible errors. We are using a mocked<br/>search function just to help us see the problem. For even keys, it returns fake data, and for odd keys,<br/>it throws an exception. The code for this search is very simple:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 65pt;text-indent: -12pt;line-height: 118%;text-align: left;"><span>const fakeSearchForSomething = (key: number) =&gt; {<br/>if (key % 2 === 0) {</span></p><p class="s17" style="padding-left: 76pt;text-indent: 0pt;line-height: 12pt;text-align: left;">return { key, some: &quot;whatever&quot;, other: &quot;more data&quot; };</p><p class="s17" style="padding-top: 2pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">} else {</p><p class="s17" style="padding-top: 2pt;padding-left: 76pt;text-indent: 0pt;text-align: left;">throw new Error(&quot;Not found&quot;);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">468  Building Better Containers - Functional Data Types</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: justify;"><span>Using this search, our findSomething () function will try to do a search and return Maybe .<br/>of () (a Just) for a successful call, or Maybe . of (null) (a Nothing) in case of an error:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 73pt;text-indent: -12pt;line-height: 117%;text-align: left;"><span>const  findSomething  =  (key:  number)  =&gt;  {<br/>try {</span></p><p class="s17" style="padding-left: 85pt;text-indent: 0pt;text-align: left;">const something = fakeSearchForSomething(key);</p><p class="s10" style="padding-top: 3pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">return Maybe.of(something);</p><p class="s17" style="padding-top: 2pt;padding-left: 75pt;text-indent: 0pt;text-align: left;">} catch (e) {</p><p class="s10" style="padding-top: 4pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">return Maybe.of(null);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: justify;"><span>With this, we could think of writing these two functions to do some searching, but not everything<br/>would be fine; can you see the problem here?</span></p><p class="s17" style="padding-top: 8pt;padding-left: 73pt;text-indent: -11pt;line-height: 118%;text-align: left;"><span>const getSome = (something: any) =&gt;<br/>Maybe.of(something.map((x: any) =&gt; x.some));</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 73pt;text-indent: -11pt;line-height: 120%;text-align: left;"><span>const getSomeFromSomething = (key: number) =&gt;<br/>getSome(findSomething(key));</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 121%;text-align: justify;">The problem in this sequence is that the output from <span class="s245">getSome 0 </span>is a <span class="s245">Maybe </span><span>value, which itself<br/>contains a Maybe value, so the result we want is double-wrapped, as we can see by executing a couple<br/>of calls, for an even number (which will return &quot;whatever&quot;) and for an odd number (which will<br/>be an error), as follows:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">const xxx = getSomeFromSomething(2222).valueOf().valueOf();</p><p class="s10" style="padding-top: 3pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">// &quot;whatever&quot;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-top: 6pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">const yyy = getSomeFromSomething(9999).valueOf().valueOf();</p><p class="s10" style="padding-top: 3pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">// undefined</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 121%;text-align: justify;">This problem can be easily solved in this toy problem if we avoid using <span class="s245">Maybe . of () </span>in <span class="s245">getSome (),<br/></span><span>but this kind of issue can arise in many more complex ways. For instance, you could be building a<br/>Maybe out of an object, one of whose attributes happened to be a Maybe, and you’d end up in the<br/>same situation when accessing that attribute: you would end up with a double-wrapped value.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;text-align: justify;">Now, we are going to look into monads. A monad should provide the following operations:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l162"><li data-list-text="•"><p style="padding-left: 79pt;text-indent: -13pt;text-align: left;">A constructor.</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 79pt;text-indent: -13pt;text-align: left;">A function that inserts a value into a monad: our of () method.</p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 367pt;text-indent: 0pt;text-align: left;">Building containers   469</p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l163"><li data-list-text="•"><p style="padding-left: 70pt;text-indent: -13pt;text-align: left;">A function that allows us to chain operations: our map () method.</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;text-align: left;"><span>A function that can remove extra wrappers: we will call it unwrap (). It will solve our preceding<br/>multiple wrapper problems. Sometimes, this function is called </span><span class="s245">flatten ().</span></p></li></ul><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>To simplify our coding, we will also have a function to chain calls and another function to apply<br/>functions, but we’ll get to those later. Lets see what a monad looks like in actual JavaScript code. Data<br/>type specifications are very much like those for functors, so we won’t repeat them here:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// monad.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 65pt;text-indent: -12pt;line-height: 115%;text-align: left;"><span>class Monad&lt;A&gt; extends Functor&lt;A&gt; {<br/>static of&lt;B&gt;(x: B): Monad&lt;B&gt; {</span></p><p class="s17" style="padding-left: 76pt;text-indent: 0pt;text-align: left;">return new Monad(x);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 77pt;text-indent: -12pt;line-height: 118%;text-align: left;"><span>map&lt;B&gt;(fn: (_: A) =&gt; B): Monad&lt;B&gt; {<br/>return new Monad(fn(this.x) ) ;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 64pt;text-indent: 0pt;text-align: left;">unwrap(): any {</p><p class="s17" style="padding-top: 2pt;padding-left: 76pt;text-indent: 0pt;text-align: left;">const myValue = this.x;</p><p class="s17" style="padding-top: 2pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">return myValue instanceof Monad</p><p class="s17" style="padding-top: 2pt;padding-left: 89pt;text-indent: 0pt;text-align: left;">? myValue.unwrap()</p><p class="s17" style="padding-top: 2pt;padding-left: 90pt;text-indent: 0pt;text-align: left;">: this;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>We use recursion to successively remove wrappers until the wrapped value isn’t a container anymore.<br/>Using this method, we could avoid double wrapping easily, and we could rewrite our previous<br/>troublesome function like this:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 52pt;text-indent: 0pt;text-align: left;"><span>const getSomeFromSomething = key =&gt;<br/>getSome(findSomething(key)).unwrap();</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>However, this sort of problem could reoccur at different levels. For example, if we were doing a series<br/>of map () operations, any intermediate results may end up double-wrapped. You could solve this<br/>by remembering to call unwrap () after each map () —note that you could do this even if it is not<br/>actually needed since the result of unwrap () would be the very same object (can you see why?).<br/>But we can do better! Let’s define a chain () operation (sometimes named f latMap () instead,</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">470  Building Better Containers - Functional Data Types</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;">which is a bit confusing since we already have another meaning for that; see <i>Chapter 5, Programming</i>for more on this) that will do both things for us:</p><p class="s17" style="padding-top: 8pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 61pt;text-indent: 0pt;text-align: left;">class Monad&lt;A&gt; extends Functor&lt;A&gt; {</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 85pt;text-indent: -12pt;line-height: 117%;text-align: left;"><span>chain&lt;B&gt;(fn: (_: A) =&gt; B) {<br/>return this.map(fn).unwrap();</span></p><p class="s17" style="padding-top: 2pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">}</p><p class="s17" style="padding-top: 2pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>There’s only one operation left. Suppose you have a curried function with two parameters—nothing<br/>outlandish! What would happen if you provided that function to a map () operation?</span></p><p class="s17" style="padding-top: 8pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">const add = (x: number) =&gt; (y: number) =&gt; x + y;</p><p class="s17" style="padding-top: 2pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">// or curry((x,y) =&gt; x+y)</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 61pt;text-indent: 0pt;text-align: left;">const something = Monad.of(2)<span class="s10">.map(add);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>What would something be? Given that we have only provided one argument to add, the result of<br/>that application will be a function—not just any function, though, but a wrapped one! (Since functions<br/>are first-class objects, there’s no logical obstacle to wrapping a function in a monad, is there?) What<br/>would we want to do with such a function? To be able to apply this wrapped function to a value, we’ll<br/>need a new method: ap (). What could its value be? In this case, it could either be a plain number<br/>or a number wrapped in a monad as a result of other operations. Since we can always map a plain<br/>number into a wrapped one with Map .of (), let’s have ap () work with a monad as its parameter;<br/>the new method would be as follows:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 61pt;text-indent: 0pt;text-align: left;">class Monad&lt;A&gt; extends Functor&lt;A&gt; {</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 85pt;text-indent: -12pt;line-height: 118%;text-align: left;"><span>ap&lt;B, C extends FN&gt;(this: Monad&lt;C&gt;, m: Monad&lt;B&gt;) {<br/>return m.map(this.x);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 367pt;text-indent: 0pt;text-align: left;">Building containers   471</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: justify;">With this, you could then do the following:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 52pt;text-indent: 0pt;line-height: 115%;text-align: left;"><span>const monad5 = something.ap(Monad.of(3));<br/>console.log(monads.toString())</span></p><p class="s10" style="padding-top: 2pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// Monad(5)</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>You can use monads to hold values or functions and to interact with other monads and chaining<br/>operations as you wish. So, as you can see, there’s no big trick to monads, which are just functors with<br/>some extra methods. Now, let’s look at how we can apply them to our original problem and handle<br/>errors in a better way.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s34" style="padding-left: 43pt;text-indent: 0pt;text-align: justify;">Handling alternatives - the Either monad</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Knowing that a value was missing may be enough in some cases, but in others, you’ll want to be able<br/>to provide an explanation. We can get such an explanation if we use a different functor, which will take<br/>one of two possible values—one associated with a problem, error, or failure, and another associated<br/>with normal execution, or success:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l164"><li data-list-text="•"><p style="padding-left: 70pt;text-indent: -13pt;line-height: 125%;text-align: left;"><span class="s33">	</span>A <i>left </i><span>value, which should be null, but if present, then it represents some special value (for<br/>example, an error message or a thrown exception) that cannot be mapped over</span></p></li><li data-list-text="•"><p style="padding-top: 5pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">A <i>right </i>value, which represents the normal value of the functor and can be mapped over</p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>We can construct this monad similarly to what we did for Maybe (actually, the added operations make<br/>it better for Maybe to extend Monad as well). The constructor will receive a left and a right value. If<br/>the left value is present, it will become the value of the Either monad; otherwise, the right value</span></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 11pt;text-align: justify;">will be used. Since we have provided <span class="s245">of () </span>methods for all our functors, we need one for <span class="s245">Either</span></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: justify;">too. The Left monad is very similar to our previous <span class="s245">Nothing:</span></p><p class="s17" style="padding-top: 10pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// either.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 65pt;text-indent: -12pt;line-height: 118%;text-align: left;"><span>class  Left  extends  Monad&lt;any&gt;  {<br/>isLeft() {</span></p><p class="s17" style="padding-left: 77pt;text-indent: 0pt;line-height: 13pt;text-align: left;">return true;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 77pt;text-indent: -12pt;line-height: 118%;text-align: left;"><span>map(_: any) {<br/>return this;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">472   Building Better Containers - Functional Data Types</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: justify;">Similarly, <span class="s245">Right </span>resembles our previous <span class="s245">Just:</span></p><p class="s17" style="padding-top: 10pt;padding-left: 51pt;text-indent: 0pt;text-align: center;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 74pt;text-indent: -12pt;line-height: 117%;text-align: left;"><span>class Right&lt;A&gt; extends Monad&lt;A&gt; {<br/>isLeft() {</span></p><p class="s17" style="padding-left: 85pt;text-indent: 0pt;line-height: 13pt;text-align: left;">return false;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 73pt;text-indent: 0pt;text-align: left;">map(fn: (_: A) =&gt; any) {</p><p class="s17" style="padding-top: 2pt;padding-left: 51pt;text-indent: 0pt;text-align: center;">return Either.of(null, fn(this.x));</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 117%;text-align: justify;">And with these two monads under our belt, we can write our <span class="s245">Either </span><span>monad. It shouldn’t be surprising<br/>that this resembles our previous Maybe, should it?</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 51pt;text-indent: 0pt;text-align: center;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 74pt;text-indent: -12pt;line-height: 118%;text-align: left;"><span>abstract class Either&lt;A, B&gt; extends Monad&lt;A | B&gt; {<br/>static of&lt;C, D&gt;(left: C, right?: D): Left | Right&lt;D&gt; {</span></p><p class="s17" style="padding-left: 85pt;text-indent: 0pt;line-height: 13pt;text-align: left;">return right === undefined || right === null</p><p class="s17" style="padding-top: 2pt;padding-left: 98pt;text-indent: 0pt;text-align: left;">? new Left(left)</p><p class="s17" style="padding-top: 2pt;padding-left: 99pt;text-indent: 0pt;text-align: left;">: new Right(right);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 51pt;text-indent: 0pt;line-height: 13pt;text-align: center;">isLeft() {</p><p class="s17" style="padding-left: 51pt;text-indent: 0pt;line-height: 13pt;text-align: center;">/* */</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 114%;text-align: justify;"><span>The map () method is key. If this functor has got a left value, it won’t be processed any further; in<br/>other cases, the mapping will be applied to the right value, and the result will be wrapped. Now, how<br/>can we enhance our code with this? The key idea is for every involved method to return an </span><span class="s245">Either<br/></span>monad; chain () will be used to execute operations one after another. Getting the alerts would be</p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 12pt;text-align: justify;">the first step—we invoke the callback either with an <span class="s245">AJAX FAILURE </span>message or with the result</p><p style="padding-top: 2pt;padding-left: 52pt;text-indent: 0pt;text-align: justify;">from the API call, as follows:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 51pt;text-indent: 0pt;text-align: center;">const getAlerts2 = (lat, long, callback) =&gt; {</p><p class="s17" style="padding-top: 2pt;padding-left: 73pt;text-indent: 0pt;text-align: left;"><a href="https://api.darksky.net/forecast" class="s14" target="_blank">const SERVER = &quot;</a>https://api.darksky.net/forecast&quot;;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 367pt;text-indent: 0pt;text-align: left;">Building containers   473</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 64pt;text-indent: 0pt;text-align: left;">const UNITS = &quot;units=si&quot;;</p><p class="s17" style="padding-top: 2pt;padding-left: 65pt;text-indent: 0pt;line-height: 118%;text-align: left;"><span>const EXCLUSIONS = &quot;exclude=minutely,hourly,daily,flags&quot;;<br/>const API_KEY = &quot;you.have.to.get.your.own.key&quot;;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="text-indent: 0pt;text-align: right;">request</p><p class="s17" style="padding-top: 2pt;text-indent: 0pt;text-align: right;">.get (</p><p class="s17" style="padding-top: 2pt;padding-left: 101pt;text-indent: -12pt;line-height: 118%;text-align: left;"><span>&#39;${SERVER}/${API_KEY}/${lat},${long}&#39; +<br/>&#39;?${UNITS}&amp;${EXCLUSIONS}&#39;</span></p><p class="s17" style="padding-left: 77pt;text-indent: 0pt;text-align: left;">)</p><p class="s17" style="padding-top: 1pt;padding-left: 89pt;text-indent: -10pt;line-height: 118%;text-align: left;"><span>,end((err, res) =&gt;<br/>callback(</span></p><p class="s17" style="padding-left: 100pt;text-indent: 0pt;line-height: 12pt;text-align: left;">err</p><p class="s17" style="padding-top: 2pt;padding-left: 113pt;text-indent: 0pt;text-align: left;">? Either.of(&quot;AJAX FAILURE&quot;, null)</p><p class="s17" style="padding-top: 2pt;padding-left: 114pt;text-indent: 0pt;text-align: left;">: Either.of(null, JSON.parse(res.text))</p><p class="s17" style="padding-top: 3pt;padding-left: 89pt;text-indent: 0pt;text-align: left;">)</p><p class="s17" style="padding-top: 2pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 43pt;text-indent: 0pt;text-align: left;"><span>Then, the general process would be as follows. We use an Either monad again. If there are no alerts,<br/>instead of an array, we will return a </span><span class="s245">&quot; NO ALERTS&quot; </span>message:</p><p class="s17" style="padding-top: 9pt;padding-left: 64pt;text-indent: -12pt;line-height: 117%;text-align: left;"><span>const produceAlertsTable2 = (weatherObj: typeof resp) =&gt; {<br/>return weatherObj</span></p><p class="s17" style="padding-left: 78pt;text-indent: 0pt;line-height: 13pt;text-align: left;">.chain((obj: typeof resp) =&gt; {</p><p class="s17" style="padding-top: 2pt;padding-left: 89pt;text-indent: 0pt;line-height: 117%;text-align: left;"><span>const alerts = getField(&quot;alerts&quot;)(obj);<br/>return alerts</span></p><p class="s17" style="padding-left: 101pt;text-indent: 0pt;text-align: left;">? Either.of(null, alerts)</p><p class="s17" style="padding-top: 2pt;padding-left: 102pt;text-indent: 0pt;text-align: left;">: Either.of(&quot;NO ALERTS&quot;, null);</p><p class="s17" style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">})</p><p class="s17" style="padding-left: 88pt;text-indent: -10pt;line-height: 117%;text-align: left;"><span>.chain((a) =&gt;<br/>a.map(</span></p><p class="s17" style="padding-left: 102pt;text-indent: 0pt;line-height: 13pt;text-align: left;">(x) =&gt;</p><p class="s17" style="padding-top: 2pt;padding-left: 113pt;text-indent: 0pt;line-height: 113%;text-align: left;"><span>&#39;&lt;trxtd&gt;${x. title}&lt;/td&gt;&#39; +<br/>&#39;&lt;td&gt;${x.description.substr(0,</span></p><p class="s17" style="padding-left: 125pt;text-indent: 0pt;text-align: left;">500) } . . . &lt;/tdx/tr&gt;&#39;</p><p class="s17" style="padding-top: 3pt;padding-left: 89pt;text-indent: 0pt;text-align: left;">)</p><p class="s17" style="padding-top: 2pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">)</p><p class="s17" style="padding-top: 1pt;padding-left: 78pt;text-indent: 0pt;text-align: left;">,chain((a) =&gt; a.join(os.EOL))</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">474   Building Better Containers - Functional Data Types</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 87pt;text-indent: 0pt;text-align: left;">,chain((s) =&gt; &#39;&lt;table&gt;${s}&lt;/table&gt;&#39;);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>Note how we used chain () so that multiple wrappers would be no problem. Now, we can test multiple<br/>situations and get appropriate results—or at least, for the current weather situation around the world!</span></p><ul id="l165"><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 79pt;text-indent: -13pt;text-align: left;">For Houston, TX, we still get an HTML table</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 79pt;text-indent: -13pt;text-align: left;">For Montevideo, UY, we get a text saying there were no alerts</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 79pt;text-indent: -13pt;text-align: left;">For a point with wrong coordinates, we learn that the AJAX call failed: nice!</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 61pt;text-indent: 0pt;line-height: 118%;text-align: left;"><span>// Houston, TX, US:<br/>getAlerts2(29.76, -95.37, (x) =&gt;</span></p><p class="s17" style="padding-left: 73pt;text-indent: 0pt;line-height: 12pt;text-align: left;">console.log(produceAlertsTable2(x).toString())</p><p class="s17" style="padding-top: 3pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">) ;</p><p class="s17" style="padding-top: 1pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">// Right(&quot;...a table with alerts: lots of HTML code...&quot;);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 61pt;text-indent: 0pt;line-height: 118%;text-align: left;"><span>// Montevideo, UY<br/>getAlerts2(-34.9, -54.6, (x) =&gt;</span></p><p class="s17" style="padding-left: 73pt;text-indent: 0pt;line-height: 12pt;text-align: left;">console.log(produceAlertsTable2(x).toString())</p><p class="s17" style="padding-top: 3pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">) ;</p><p class="s17" style="padding-top: 1pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">// LeftP&#39;NO ALERTS&quot;);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 61pt;text-indent: 0pt;line-height: 115%;text-align: left;"><span>//A point with wrong coordinates<br/>getAlerts2(444, 555, (x) =&gt;</span></p><p class="s17" style="padding-left: 73pt;text-indent: 0pt;text-align: left;">console.log(produceAlertsTable2(x).toString())</p><p class="s17" style="padding-top: 3pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">) ;</p><p class="s17" style="padding-top: 1pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">// Left(&quot;AJAX FAILURE&quot;);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>We are not done with the Either monad. It’s likely that much of your code will involve calling<br/>functions. Let’s look at a better way of achieving this by using a variant of this monad.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s34" style="padding-left: 52pt;text-indent: 0pt;text-align: justify;">Calling a function - the Try monad</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>If we are calling functions that may throw exceptions and we want to do so in a functional way, we<br/>could use the Try monad to encapsulate the function result or the exception. The idea is basically<br/>the same as the Either monad. The only difference is in the constructor, which receives a function<br/>and calls it:</span></p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 79pt;text-indent: -13pt;text-align: left;">If there are no problems, the returned value becomes the right value for the monad</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 79pt;text-indent: -13pt;text-align: left;">If there’s an exception, it will become the left value</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 367pt;text-indent: 0pt;text-align: left;">Building containers   475</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: left;">This can be seen in the following code:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// try.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 52pt;text-indent: 0pt;text-align: left;">class Try&lt;A&gt; extends Either&lt;A, string&gt; {</p><p class="s17" style="padding-top: 2pt;padding-left: 65pt;text-indent: 0pt;line-height: 115%;text-align: left;"><span>// @ts-expect-error Call to super() not needed<br/>constructor(fn: () =&gt; A, msg?: string) {</span></p><p class="s17" style="padding-left: 76pt;text-indent: 0pt;text-align: left;">try {</p><p class="s17" style="padding-top: 2pt;padding-left: 88pt;text-indent: 0pt;text-align: left;">return Either.of(null, fn()) as Either&lt;A, strings;</p><p class="s17" style="padding-top: 2pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">} catch (e: any) {</p><p class="s17" style="padding-top: 2pt;padding-left: 101pt;text-indent: -12pt;line-height: 118%;text-align: left;"><span>return Either.of(msg || e.message, null) as Either&lt;<br/>string,</span></p><p class="s17" style="padding-left: 101pt;text-indent: 0pt;line-height: 12pt;text-align: left;">string</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: left;">Why the @ts-expect-error notation? A constructor should either call super () or return a</p><p style="padding-top: 2pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>fully constructed method, but TypeScript always expects the former, so we have to tell it that we know<br/>what were doing here.</span></p><p style="padding-top: 5pt;padding-left: 43pt;text-indent: 0pt;text-align: left;">Now, we can invoke any function, catching exceptions in a good way. For example, the <span class="s245">getField ()</span></p><p style="padding-top: 2pt;padding-left: 43pt;text-indent: 0pt;text-align: left;">function that we have been using would crash if it were called with a null argument:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 52pt;text-indent: 0pt;text-align: left;">const getField = attr =&gt; obj =&gt; obj [attr];</p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 115%;text-align: left;">In the <i>Implementing prisms </i>section of <i>Chapter 10, Ensuring Purity, </i>we wrote a <span class="s245">getField? () </span><span>function<br/>that could deal with null values, but here, we will rewrite it using the Try monad, so, in addition,</span></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>it will play nice with other composed functions. The alternative implementation of our getter would<br/>be as follows:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 64pt;text-indent: -11pt;line-height: 118%;text-align: left;"><span>const getField2 = (attr: string) =&gt; (obj: OBJ | null) =&gt;<br/>new Try(() =&gt; obj1[attr], &quot;NULL OBJECT&quot;);</span></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;text-align: left;">We can check that this works by trying to apply our new function to a null value:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 52pt;text-indent: 0pt;text-align: left;">const x = getField2(&quot;somefield&quot;)(null);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 53pt;text-indent: 0pt;line-height: 114%;text-align: left;"><span>console.log(x.isLeft()); // true<br/>console.log(x.toString()); // Left(NULL OBJECT)</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">476  Building Better Containers - Functional Data Types</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>There are many more monads, and, of course, you can even define your own, so we couldn’t possibly<br/>go over all of them. However, let’s visit just one more—one you have been using already, without<br/>being aware of its monad-ness!</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s34" style="padding-left: 53pt;text-indent: 0pt;text-align: justify;">Unexpected monads - promises</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Let’s finish this section on monads by mentioning yet another one that you may have used, though<br/>under a different name: promises! Previously, we mentioned that functors (and, remember, monads<br/>are functors) had at least something in common with promises: using a method to access the value.<br/>However, the similarities are greater than that!</span></p></li><li data-list-text="•"><p class="s17" style="padding-top: 7pt;padding-left: 79pt;text-indent: -12pt;line-height: 114%;text-align: justify;">Promise . resolve () <span class="s246">corresponds with </span>Monad, of ()—<span class="s246">if you pass a value to </span><span>.resolved,<br/></span><span class="s246">you’ll</span><span class="p"> get a promise resolved to that value, and if you provide a promise, you will get a new<br/>promise, the value of which will be that of the original one (see developer . mozilla .<br/></span><span class="s245">org/en-US/docs/Web/JavaScript/Reference/Global_Obj</span>       ects/Promise/</p><p class="s17" style="padding-left: 79pt;text-indent: 0pt;line-height: 11pt;text-align: justify;">resolve <span class="s246">for more on this). This is an unwrapping behavior!</span></p></li><li data-list-text="•"><p class="s17" style="padding-top: 5pt;padding-left: 79pt;text-indent: -12pt;line-height: 114%;text-align: justify;"><span class="s33">	</span>Promise . then () <span class="s246">stands for </span>Monad. map () <span class="s246">as well as </span>Monad. chain (), <span class="s246">given </span><span class="p">the<br/>mentioned unwrapping.</span></p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>We don’t have a direct match to Monad. ap (), but we could add something like the following code<br/>(this will be rejected by TypeScript, but we’ve seen how to solve this):</span></p><p class="s17" style="padding-top: 8pt;padding-left: 73pt;text-indent: -12pt;line-height: 115%;text-align: left;"><span>Promise.prototype.ap = function (promise2) {<br/>return this.then((x) =&gt; promise2.map(x));</span></p><p class="s17" style="padding-top: 2pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">};</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 65pt;text-indent: 0pt;text-align: left;"><a name="bookmark512">Promises - never gone</a></p><p style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;text-align: left;"><span>Even if you opt for the modern async and await features, internally, they are based on<br/>promises. Furthermore, in some situations, you may still need </span><span class="s245">Promise . race () </span><span>and<br/></span><span class="s245">Promise </span>.all (), so you will likely keep using promises, even if you opt for full ES8 coding.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 115%;text-align: justify;"><span>This is an appropriate ending for this section. Earlier, you found that ordinary arrays were, in fact,<br/>functors. Now, in the same way that Monsieur Jourdain (a character in Moliere’s play </span><i>Le Bourgeois</i><span>discovered that all his life he had been speaking in prose, you<br/>now  know you had already been using monads without even knowing it! So far, we have learned how<br/>to build different types of containers. Now, let’s learn how functions can also make do as containers,<br/>as well as for all kinds of data structures!</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-left: 53pt;text-indent: 0pt;text-align: justify;"><a name="bookmark513">Functions as data structures</a></p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: justify;"><span>So far, we have learned how to use functions to work with or transform other functions to process<br/>data structures or to create data types. Now, we’ll finish this chapter by showing you how a function</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 335pt;text-indent: 0pt;text-align: left;">Functions as data structures    477</p><p style="padding-top: 22pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><a name="bookmark514"><span>can implement a data type, becoming a container of its own. In fact, this is a fundamental theoretical<br/>point of lambda calculus (if you want to learn more, look up </span></a><i>Church encoding </i>and <i>Scott encoding),</i><span>so we may very well say that we have come back to where we began this book, to the origins of FP!<br/>We will start with a detour that considers binary trees in a different functional language, Haskell, and<br/>then move on to implementing trees as functions, but in JavaScript. This experience will help you<br/>work out how to deal with other data structures.</span></p><p class="s12" style="padding-top: 11pt;padding-left: 44pt;text-indent: 0pt;text-align: justify;">Binary trees in Haskell</p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;">Consider a binary tree. Such a tree may either be empty or consist of a node (the tree <i>root) </i><span>with two<br/>children: a </span><i>left </i>binary tree and a <i>right </i>one. A node that has no children is called a <i>leaf.</i></p><p class="s154" style="padding-top: 8pt;padding-left: 42pt;text-indent: 0pt;text-align: justify;">Z<span class="s155">                                                                       </span>X</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 57pt;text-indent: 0pt;text-align: justify;">Of many types of trees</p><p style="padding-top: 4pt;padding-left: 56pt;text-indent: 0pt;line-height: 115%;text-align: justify;">In <i>Chapter 9, Designing Functions, </i><span>we worked with more general tree structures, such as a<br/>filesystem or the browser DOM itself, which allow a node to have any number of children. In<br/>the case of the trees in this section, each node always has two children, although each of them<br/>may be empty. The difference may seem minor, but allowing for empty subtrees lets you define<br/>that all nodes are binary.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Let’s make a digression with the Haskell language. In it, we might write something like the following;<br/>a would be the type of whatever value we hold in the nodes:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">data Tree a = Nil | Node a (Tree a) (Tree a)</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>In the Haskell language, pattern matching is often used for coding. For example, we could define an<br/>empty function as follows:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 52pt;text-indent: 0pt;line-height: 117%;text-align: left;"><span>empty :: Tree a -&gt; Bool empty Nil = True<br/>empty (Node root left right) = False</span></p><p style="padding-top: 9pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>What does this mean? Apart from the data type definition, the logic is simple: if the tree is Nil (the<br/>first possibility in the definition of the type), then the tree is certainly empty; otherwise, the tree isn’t<br/>empty. The last line would probably be written as empty _ = False, using _ as a placeholder<br/>because you don’t actually care about the components of the tree; the mere fact that it’s not Nil suffices.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: justify;"><span>Searching for a value in a binary search tree (in which the root is greater than all the values of its left<br/>subtree and less than all the values of its right subtree) would be written similarly:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">contains :: (Ord a) = &gt; (Tree a)</p><p class="s17" style="padding-top: 2pt;padding-left: 53pt;text-indent: 30pt;line-height: 235%;text-align: left;"><span>-&gt; a -&gt; Bool contains Nil = False<br/>contains (Node root left right) x</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">478  Building Better Containers - Functional Data Types</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 64pt;text-indent: 0pt;text-align: left;">| x == root = True</p><p class="s17" style="padding-top: 2pt;padding-left: 73pt;text-indent: -9pt;line-height: 118%;text-align: left;"><span>| x   &lt; root = contains left x<br/>x  &gt; root = contains right x</span></p><p style="padding-top: 9pt;padding-left: 52pt;text-indent: 0pt;text-align: justify;">What patterns are matched here? We have four patterns now, which must be considered in order:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><ol id="l166"><li data-list-text="1."><p style="padding-left: 79pt;text-indent: -17pt;line-height: 123%;text-align: left;"><span>An empty tree (Nil —it doesn’t matter what we are looking for, so just write _) doesn’t contain<br/>the searched value.</span></p></li><li data-list-text="2."><p style="padding-top: 2pt;padding-left: 78pt;text-indent: -17pt;text-align: left;">If the tree isn’t empty, and the root matches the searched value <span class="s245">(x), </span>we are done.</p></li><li data-list-text="3."><p style="padding-top: 6pt;padding-left: 79pt;text-indent: -18pt;line-height: 126%;text-align: left;"><span>If the root doesn’t match and is greater than the searched value, the answer is found while<br/>searching in the left subtree.</span></p></li><li data-list-text="4."><p style="padding-top: 3pt;padding-left: 78pt;text-indent: -17pt;text-align: left;">Otherwise, the answer is found by searching in the right subtree.</p></li></ol><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>There’s an important point to remember: for this data type, which is a union of two possible types,<br/>we have to provide two conditions, and pattern matching will be used to decide which one will be<br/>applied. Keep this in mind!</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s12" style="padding-left: 53pt;text-indent: 0pt;text-align: justify;"><a name="bookmark515">Functions as binary trees</a></p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Can we do something similar with functions? The answer is yes: we will represent a tree (or any other<br/>structure) with a function itself—not with a data structure that is processed by a set of functions, nor<br/>with  an object with some methods, but by just a function. Furthermore, we will get a functional data<br/>structure that’s 100% immutable, which, if updated, produces a new copy of itself. We will do all this<br/>without using objects; here, closures will provide the desired results.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>How can this work? We shall be applying similar concepts to the ones we looked at earlier in this<br/>chapter, so the function will act as a container and produce, as its result, a mapping of its contained<br/>values. Let’s walk backward and start by looking at how we’ll use the new data type. Then, we’ll go<br/>through the implementation details.</span></p><p style="text-indent: 0pt;text-align: left;"><span><img width="204" height="163" alt="image" src="Image_059.png"/></span></p><p style="padding-top: 5pt;padding-left: 52pt;text-indent: 0pt;line-height: 108%;text-align: justify;">Creating a tree can be done by using two functions: <span class="s245">EmptyTree () </span>and <span class="s245">Tree (value, lef tTree,<br/>r ightTree). </span><span>For example, let’s say we wish to create a tree similar to the one shown in the<br/>following diagram:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-left: 51pt;text-indent: 0pt;text-align: center;">Figure 12.2 - A binary search tree</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 335pt;text-indent: 0pt;text-align: left;">Functions as data structures    479</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: left;">We can create this using the following code:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// functionAsTree.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 64pt;text-indent: -11pt;line-height: 117%;text-align: left;"><span>const rnyTree: TREE = NewTree (<br/>22,</span></p><p class="s17" style="padding-left: 64pt;text-indent: 0pt;text-align: left;">NewTree(</p><p class="s9" style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">9,</p><p class="s17" style="padding-top: 2pt;padding-left: 76pt;text-indent: 0pt;line-height: 115%;text-align: left;"><span>NewTree (4, EmptyTreeO, EmptyTree () ) ,<br/>NewTree(12,   EmptyTree(),   EmptyTree())</span></p><p class="s17" style="padding-top: 1pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">) ,</p><p class="s17" style="padding-top: 1pt;padding-left: 77pt;text-indent: -13pt;line-height: 118%;text-align: left;"><span>NewTree(<br/>60,</span></p><p class="s17" style="padding-left: 76pt;text-indent: 0pt;line-height: 115%;text-align: left;"><span>NewTree  (56,  EmptyTreeO,  EmptyTreeO),<br/>EmptyTree()</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 114%;text-align: justify;"><span>How do you work with this structure? According to the data type description, whenever you work<br/>with a tree, you must consider two cases: a non-empty tree and an empty one. In the preceding code,<br/></span><span class="s245">rnyTree 0 </span><span>is a function that receives two functions as arguments, one for each of the two data type<br/>cases. The first function will be called with the node value and left and right trees as arguments, while</span></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: justify;">the second function will receive none:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 52pt;text-indent: 0pt;text-align: left;">type TREE&lt;A&gt; = (</p><p class="s17" style="padding-top: 2pt;padding-left: 64pt;text-indent: 0pt;text-align: left;">_nonEmptyTree: (</p><p class="s17" style="padding-top: 2pt;padding-left: 76pt;text-indent: 0pt;text-align: left;">_X: A,</p><p class="s17" style="padding-top: 2pt;padding-left: 76pt;text-indent: 0pt;text-align: left;">_left:  TREE&lt;A&gt;,</p><p class="s17" style="padding-top: 2pt;padding-left: 76pt;text-indent: 0pt;text-align: left;">_right: TREE&lt;A&gt;</p><p class="s17" style="padding-top: 2pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">) =&gt; any,</p><p class="s17" style="padding-top: 2pt;padding-left: 82pt;text-indent: -18pt;line-height: 118%;text-align: left;"><span>_emptyTree: () = &gt; any<br/>any ;</span></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;text-align: justify;">To get the root of a tree, we could write something similar to the following:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 52pt;text-indent: 0pt;text-align: left;">const myRoot = rnyTree(</p><p class="s10" style="padding-top: 3pt;padding-left: 66pt;text-indent: 0pt;text-align: left;">(value) =&gt; value.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">480  Building Better Containers - Functional Data Types</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 75pt;text-indent: 0pt;text-align: left;"><a name="bookmark516">() =&gt; null</a></p><p class="s17" style="padding-top: 3pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>If we were dealing with a non-empty tree, we would expect the first function to be called and return<br/>the value of the root. With an empty tree, the second function should be called, and then a null<br/>value would be returned.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;text-align: justify;">Similarly, if we wanted to count how many nodes there are in a tree, we would write the following:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 73pt;text-indent: -12pt;line-height: 118%;text-align: left;"><span>const  treeCount  =  &lt;A&gt;(tree:  TREE&lt;A&gt;):  number  =&gt;<br/>tree (</span></p><p class="s10" style="padding-top: 1pt;padding-left: 87pt;text-indent: 0pt;text-align: left;">(value, left, right) =&gt;</p><p class="s10" style="padding-top: 4pt;padding-left: 87pt;text-indent: 10pt;line-height: 148%;text-align: left;"><span>1   +   treeCount(left)   +   treeCount(right),<br/>0 =&gt; 0</span></p><p class="s17" style="padding-left: 74pt;text-indent: 0pt;line-height: 11pt;text-align: left;">) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 61pt;text-indent: 0pt;text-align: left;">console.log(treeCount(myTree) ) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>For non-empty trees, the first function would return 1 (for the root), plus the node count from both<br/>the root’s subtrees. For empty trees, the count is simply 0. Get the idea?</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;text-align: justify;">Now, we can show the NewTree () and EmptyTree () functions. They are as follows:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 61pt;text-indent: 0pt;text-align: left;">const NewTree =</p><p class="s17" style="padding-top: 2pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">&lt;A&gt;(value: A, left: TREE&lt;A&gt;, right: TREE&lt;A&gt;): TREE&lt;A&gt; =&gt;</p><p class="s17" style="padding-top: 2pt;padding-left: 85pt;text-indent: -9pt;line-height: 117%;text-align: left;"><span>(destructure, _) =&gt;<br/>destructure(value, left, right);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 61pt;text-indent: 0pt;text-align: left;">const EmptyTree =</p><p class="s17" style="padding-top: 2pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">&lt;A&gt;(): TREE&lt;A&gt; =&gt;</p><p class="s17" style="padding-top: 2pt;padding-left: 85pt;text-indent: -9pt;line-height: 117%;text-align: left;"><span>(_,  destructure)  =&gt;<br/>destructure();</span></p><p style="padding-top: 8pt;padding-left: 52pt;text-indent: 0pt;line-height: 121%;text-align: justify;">The <span class="s245">de structure () </span><span>function is what you will pass as an argument (the name comes from the<br/>destructuring statement in JavaScript, which lets you separate an object attribute into distinct variables).<br/>You will have to provide two versions of this function. If the tree is non-empty, the first function will be<br/>executed; for an empty tree, the second one will be run (this mimics the case selection in the Haskell</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 335pt;text-indent: 0pt;text-align: left;">Functions as data structures    481</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: left;"><span>code, except we are placing the non-empty tree case first and the empty tree last). The underscore-<br/>named variable is used as a placeholder that stands for an otherwise-ignored argument but shows that<br/>two arguments are assumed; an initial underscore is usually meant to imply some parameter isn’t used.</span></p><p style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>This can be hard to understand, so let’s look at more examples. If we need to access specific elements<br/>of a tree, we have the following three functions:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 64pt;text-indent: -12pt;line-height: 118%;text-align: left;"><span>const treeRoot = &lt;A&gt;(tree: TREE&lt;A&gt;): A | null =&gt;<br/>tree (</span></p><p class="s17" style="padding-left: 78pt;text-indent: 0pt;line-height: 118%;text-align: left;"><span>(value, _left, right) =&gt; value,<br/>() =&gt; null</span></p><p class="s17" style="padding-left: 65pt;text-indent: 0pt;text-align: left;">) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>How can we decide whether a tree is empty? See whether you can figure out why the following short<br/>line of code works:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 65pt;text-indent: -12pt;line-height: 117%;text-align: left;"><span>const treelsEmpty = &lt;A&gt;(tree: TREE&lt;A&gt;): boolean =&gt;<br/>tree (</span></p><p class="s17" style="padding-left: 78pt;text-indent: 0pt;line-height: 115%;text-align: left;"><span>() =&gt; false,<br/>() =&gt; true</span></p><p class="s17" style="padding-top: 1pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>Let’s go over a few more examples of this. For example, we can build an object out of a tree, which would<br/>help with debugging. I added logic to avoid including left or right empty subtrees, so the produced</span></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: left;">object would be more compact; check out the two if statements in the following code:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 64pt;text-indent: -12pt;line-height: 118%;text-align: left;"><span>const treeToObject = &lt;A&gt;(tree: TREE&lt;A&gt;): OBJ =&gt;<br/>tree (</span></p><p class="s17" style="padding-left: 78pt;text-indent: 0pt;line-height: 12pt;text-align: left;">(value, left, right) =&gt; {</p><p class="s17" style="padding-top: 2pt;padding-left: 88pt;text-indent: 0pt;line-height: 118%;text-align: left;"><span>const leftBranch = treeToObject (left);<br/>const rightBranch = treeToObject(right);<br/>const result: OBJ = { value };</span></p><p class="s17" style="padding-left: 100pt;text-indent: -11pt;line-height: 119%;text-align: left;"><span>if (leftBranch) {<br/>result.left = leftBranch;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">482   Building Better Containers - Functional Data Types</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 98pt;text-indent: 0pt;line-height: 13pt;text-align: left;">}</p><p class="s17" style="padding-left: 109pt;text-indent: -11pt;line-height: 120%;text-align: left;"><span>if (rightBranch) {<br/>result.right = rightBranch;</span></p><p class="s17" style="padding-top: 1pt;padding-left: 98pt;text-indent: 0pt;text-align: left;">}</p><p class="s17" style="padding-left: 97pt;text-indent: 0pt;text-align: left;">return result;</p><p class="s227" style="padding-top: 1pt;padding-left: 86pt;text-indent: 0pt;line-height: 16pt;text-align: left;">b</p><p class="s17" style="padding-left: 88pt;text-indent: 0pt;line-height: 12pt;text-align: left;">() =&gt; null</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: left;">Note the usage of recursion, as in the <i>Traversing a tree structure </i>section of <i>Chapter 9, Designing</i><span>to produce the object equivalents of the left and right subtrees. An example of this function<br/>is   as follows; I edited the output to make it clearer:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">console.log(treeToObj ect(myTree));</p><p class="s17" style="padding-top: 3pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">/*</p><p class="s17" style="padding-top: 2pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">{</p><p class="s17" style="padding-left: 74pt;text-indent: 0pt;line-height: 118%;text-align: left;"><span>value: 22,<br/>left: {</span></p><p class="s17" style="padding-left: 86pt;text-indent: 0pt;line-height: 118%;text-align: left;"><span>value: 9,<br/>left: {</span></p><p class="s17" style="padding-left: 97pt;text-indent: 0pt;line-height: 12pt;text-align: left;">value: 4,</p><p class="s227" style="padding-top: 1pt;padding-left: 86pt;text-indent: 0pt;line-height: 17pt;text-align: left;">b</p><p class="s17" style="padding-left: 85pt;text-indent: 0pt;line-height: 11pt;text-align: left;">right: { value: 12 },</p><p class="s227" style="padding-top: 1pt;padding-left: 74pt;text-indent: 0pt;line-height: 16pt;text-align: left;">b</p><p class="s17" style="padding-left: 73pt;text-indent: 0pt;line-height: 12pt;text-align: left;">right: {</p><p class="s17" style="padding-top: 2pt;padding-left: 86pt;text-indent: 0pt;line-height: 115%;text-align: left;"><span>value: 60,<br/>left: {</span></p><p class="s17" style="padding-left: 97pt;text-indent: 0pt;text-align: left;">value: 56,</p><p class="s227" style="padding-top: 1pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">b</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s158" style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">*/</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>Can we search for a node? Of course, and the logic closely follows the definition we saw in the previous<br/>section. (We could have shortened the code a bit, but I wanted to parallel the Haskell version; for a<br/>leaner version, see </span><i>Question 12.6.) </i>Our treeSearch () function could be as follows:</p><p class="s17" style="padding-top: 8pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 13pt;padding-left: 335pt;text-indent: 0pt;text-align: left;">Functions as data structures   <span class="s153">483</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 65pt;text-indent: -12pt;line-height: 119%;text-align: left;"><span>const treeSearch = &lt;A&gt;(<br/>findValue: A,</span></p><p class="s17" style="padding-left: 64pt;text-indent: 0pt;line-height: 12pt;text-align: left;">tree: TREE&lt;A&gt;</p><p class="s17" style="padding-top: 2pt;padding-left: 65pt;text-indent: -11pt;line-height: 118%;text-align: left;"><span>): boolean =&gt;<br/>tree (</span></p><p class="s17" style="padding-left: 89pt;text-indent: -10pt;line-height: 117%;text-align: left;"><span>(value, left, right) =&gt;<br/>findValue === value</span></p><p class="s17" style="padding-left: 101pt;text-indent: 0pt;text-align: left;">? true</p><p class="s17" style="padding-top: 2pt;padding-left: 102pt;text-indent: 0pt;text-align: left;">: findValue &lt; value</p><p class="s17" style="padding-top: 2pt;padding-left: 101pt;text-indent: 0pt;text-align: left;">? treeSearch(findValue, left)</p><p class="s17" style="padding-top: 2pt;padding-left: 78pt;text-indent: 23pt;line-height: 117%;text-align: left;"><span>: treeSearch(findValue, right),<br/>() =&gt; false</span></p><p class="s17" style="padding-left: 65pt;text-indent: 0pt;text-align: left;">) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: justify;"><span>If the value we want is the root, we found it; if it’s smaller than the root, we recursively search the left<br/>subtree, and if greater, the right subtree.</span></p><p style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>To round off this section, let’s also look at how to add new nodes to a tree. Study the code carefully;<br/>you’ll notice how the current tree isn’t modified and that a new one is produced instead. Of course,<br/>given that we are using functions to represent our tree data type, it should be evident that we wouldn’t<br/>have been able to modify the old structure: it’s immutable by default. The tree insertion function<br/>would be as follows:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 64pt;text-indent: -11pt;line-height: 118%;text-align: left;"><span>const treeinsert = &lt;A&gt;(<br/>newValue: A,</span></p><p class="s17" style="padding-left: 64pt;text-indent: 0pt;line-height: 12pt;text-align: left;">tree: TREE&lt;A&gt;</p><p class="s17" style="padding-top: 2pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">): TREE&lt;A&gt; =&gt;</p><p class="s17" style="padding-top: 2pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">tree (</p><p class="s17" style="padding-top: 1pt;padding-left: 88pt;text-indent: -9pt;line-height: 118%;text-align: left;"><span>(value, left, right) =&gt;<br/>newValue &lt;= value</span></p><p class="s17" style="padding-left: 101pt;text-indent: 0pt;line-height: 13pt;text-align: left;">? NewTree(value, treeinsert(newValue, left), right)</p><p class="s17" style="padding-top: 2pt;padding-left: 112pt;text-indent: -10pt;line-height: 118%;text-align: left;"><span>: NewTree(value, left, treeinsert(newValue,<br/>right)),</span></p><p class="s17" style="padding-left: 78pt;text-indent: 0pt;line-height: 12pt;text-align: left;">() =&gt; NewTree(newValue, EmptyTree(), EmptyTree())</p><p class="s17" style="padding-top: 3pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">484   Building Better Containers - Functional Data Types</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>When trying to insert a new key, if its value is less than or equal to the root of the tree, we produce<br/>a new tree that has the current root as its own root, maintains the old right subtree, but changes its<br/>left subtree to incorporate the new value (which will be done recursively). If the key was greater than<br/>the root, the changes wouldn’t have been symmetrical; they would have been analogous. If we try to<br/>insert a new key and find ourselves with an empty tree, we replace that empty structure with a new<br/>tree having the new value at its root, and empty left and right subtrees.</span></p><p style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: justify;"><span>We can test out this logic easily, but the simplest way is to verify that the binary tree that we showed<br/>earlier </span><i>(Figure 12.2) </i>is generated by the following sequence of operations:</p><p class="s17" style="padding-top: 8pt;padding-left: 61pt;text-indent: 0pt;line-height: 117%;text-align: left;"><span>let myTree = EmptyTreeO;<br/>myTree = treeinsert(22, myTree);<br/>myTree = treeinsert(9, myTree);<br/>myTree = treeinsert(60, myTree);<br/>myTree = treeinsert(12, myTree);<br/>myTree = treeinsert(4, myTree);<br/>myTree = treeinsert(56, myTree);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// The resulting tree is:</p><p class="s17" style="padding-top: 4pt;padding-left: 63pt;text-indent: 0pt;text-align: left;">{</p><p class="s17" style="padding-left: 74pt;text-indent: 0pt;line-height: 118%;text-align: left;"><span>value: 22,<br/>left: {</span></p><p class="s17" style="padding-left: 85pt;text-indent: 0pt;line-height: 12pt;text-align: left;">value: 9,</p><p class="s17" style="padding-top: 2pt;padding-left: 85pt;text-indent: 0pt;line-height: 118%;text-align: left;"><span>left: { value: 4 },<br/>right: { value: 12 },</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-top: 4pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">right: { value: 60, left: { value: 56 } },</p><p class="s17" style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;line-height: 114%;text-align: justify;"><span>We could make this insertion function even more general by providing the comparator function that<br/>would be used to compare values. In this fashion, we could easily adapt a binary tree to represent a<br/>generic map. The value of a node would actually be an object such as {</span><span class="s245">key: . . . , data : . . . }</span></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 11pt;text-align: justify;">and the provided function would compare <span class="s245">newValue . key </span>and <span class="s245">value . key </span>to decide where to</p><p style="padding-top: 1pt;padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: justify;"><span>add the new node. Of course, if the two keys were equal, we would change the root of the current tree.<br/>The new tree insertion code would be as follows. Let’s start with types and comparisons:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 61pt;text-indent: 0pt;text-align: left;">type N0DE&lt;K, D&gt; = { key: K; data: D };</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 335pt;text-indent: 0pt;text-align: left;">Functions as data structures    485</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 64pt;text-indent: -11pt;line-height: 117%;text-align: left;"><span>const compare = &lt;K, D&gt;(<br/>objl: NODEcK, D&gt;,<br/>obj2: NODEcK, D&gt;</span></p><p class="s17" style="padding-top: 1pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">) =&gt;</p><p class="s17" style="padding-top: 1pt;padding-left: 64pt;text-indent: 0pt;text-align: left;">objl.key === obj2.key ? 0 : objl.key &lt; obj2.key ? -1 : 1;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: left;">The tree insertion code is now the following:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s293" style="padding-left: 53pt;text-indent: 0pt;text-align: left;">11 <span class="s17">continued...</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 64pt;text-indent: -11pt;line-height: 117%;text-align: left;"><span>const treelnsert2 = &lt;K, D&gt;(<br/>comparator: typeof comparecK, D&gt;,<br/>newValue: NODE&lt;K, D&gt;,</span></p><p class="s17" style="padding-left: 65pt;text-indent: 0pt;text-align: left;">tree: TREEcNODEcK, D&gt;&gt;</p><p class="s17" style="padding-top: 2pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">): TREEcNODEcK, D&gt;&gt; =&gt;</p><p class="s17" style="padding-top: 2pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">tree (</p><p class="s17" style="padding-top: 2pt;padding-left: 88pt;text-indent: -9pt;line-height: 117%;text-align: left;"><span>(value,  left,  right)  =&gt;<br/>comparator(newValue, value) === 0</span></p><p class="s17" style="padding-left: 101pt;text-indent: 0pt;text-align: left;">? NewTree(newValue, left, right)</p><p class="s17" style="padding-top: 2pt;padding-left: 102pt;text-indent: 0pt;text-align: left;">: comparator(newValue, value) &lt; 0</p><p class="s17" style="padding-top: 1pt;padding-left: 101pt;text-indent: 0pt;text-align: left;">? NewTree(</p><p class="s17" style="padding-top: 2pt;padding-left: 124pt;text-indent: 0pt;text-align: left;">value,</p><p class="s17" style="padding-top: 2pt;padding-left: 124pt;text-indent: 0pt;line-height: 117%;text-align: left;"><span>treelnsert2(comparator, newValue, left),<br/>right</span></p><p class="s164" style="padding-top: 3pt;padding-left: 113pt;text-indent: 0pt;text-align: left;">)</p><p class="s17" style="padding-top: 1pt;padding-left: 102pt;text-indent: 0pt;text-align: left;">: NewTree(</p><p class="s17" style="padding-top: 2pt;padding-left: 125pt;text-indent: -1pt;line-height: 118%;text-align: left;"><span>value,<br/>left,</span></p><p class="s17" style="padding-left: 124pt;text-indent: 0pt;line-height: 12pt;text-align: left;">treelnsert2(comparator, newValue, right)</p><p class="s17" style="padding-top: 3pt;padding-left: 113pt;text-indent: 0pt;text-align: left;">) ,</p><p class="s17" style="padding-top: 1pt;padding-left: 78pt;text-indent: 0pt;text-align: left;">() =&gt; NewTree (newValue, EmptyTreeO, EmptyTree () )</p><p class="s17" style="padding-top: 2pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: left;"><span>What else do we need? Of course, we can program diverse functions: deleting a node, counting nodes,<br/>determining a trees height, comparing two trees, and so on. However, in order to gain more usability,<br/>we should really turn the structure into a functor by implementing a map () function. Fortunately,<br/>using recursion, this proves to be easy—we apply the mapping function to the tree root and use map ()<br/>recursively on the left and right subtrees, as follows:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">486  Building Better Containers - Functional Data Types</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 74pt;text-indent: -12pt;line-height: 117%;text-align: left;"><span>const treeMap = &lt;A, B&gt;(<br/>fn: (_x: A) =&gt; B,</span></p><p class="s17" style="padding-left: 73pt;text-indent: 0pt;text-align: left;">tree: TREE&lt;A&gt;</p><p class="s17" style="padding-top: 2pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">): TREE&lt;B&gt; =&gt;</p><p class="s17" style="padding-top: 2pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">tree (</p><p class="s17" style="padding-top: 2pt;padding-left: 97pt;text-indent: -9pt;line-height: 115%;text-align: left;"><span>(value, left, right) =&gt;<br/>NewTree(</span></p><p class="s17" style="padding-left: 109pt;text-indent: 0pt;line-height: 117%;text-align: left;"><span>fn(value),<br/>treeMap(fn, left),<br/>treeMap(fn, right)</span></p><p class="s17" style="padding-left: 98pt;text-indent: 0pt;text-align: left;">) ,</p><p class="s17" style="padding-top: 1pt;padding-left: 88pt;text-indent: 0pt;text-align: left;">() =&gt; EmptyTreeO</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>We could go on with more examples, but that wouldn’t change the important conclusions we can<br/>derive from this work:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l167"><li data-list-text="•"><p style="padding-left: 79pt;text-indent: -13pt;text-align: left;">We are handling a data structure (a recursive one, at that) and representing it with a function</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 79pt;text-indent: -13pt;text-align: left;">We aren’t using external variables or objects for the data: closures are used instead</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 79pt;text-indent: -13pt;text-align: left;">The data structure satisfies all the requirements we analyzed in <i>Chapter 10, Ensuring Purity,</i></p><p style="padding-top: 2pt;padding-left: 79pt;text-indent: 0pt;text-align: left;">insofar that it is immutable and all the changes always produce new structures</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 79pt;text-indent: -13pt;text-align: left;">The tree is a functor, providing all the corresponding advantages</p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 126%;text-align: left;"><span>In this section, we have looked at one more application of FP as well as how a function can actually<br/>become a structure by itself, which isn’t what we are usually accustomed to!</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-left: 52pt;text-indent: 0pt;text-align: left;"><a name="bookmark517">Summary</a></p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>In this chapter, we looked at the theory of data types and learned how to use and implement them<br/>from a functional point of view. We started with defining function signatures to help us understand<br/>the transformations implied by the multiple operations we looked at later, with a syntax independent<br/>from TypeScript’s. Then, we went on to define several containers, including functors and monads,<br/>and saw how they can be used to enhance function composition. Finally, we learned how functions<br/>can be directly used by themselves, with no extra baggage, to implement functional data structures<br/>to simplify dealing with errors.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 12pt;padding-left: 401pt;text-indent: 0pt;text-align: left;">Questions  <span class="s153">487</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>In this book, we have looked at several features of FP for JavaScript and TypeScript. We started with<br/>some definitions, and a practical example, then moved on to important considerations such as pure<br/>functions, avoiding side effects, immutability, testability, building new functions out of other ones,<br/>and implementing a data flow based upon function connections and data containers. We have looked<br/>at a lot of concepts, but I’m confident that you’ll be able to put them to practice and start writing even<br/>higher-quality code—give it a try, and thank you very much for reading this book!</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-left: 43pt;text-indent: 0pt;text-align: left;"><a name="bookmark518">Questions</a></p><ol id="l168"><ol id="l169"><li data-list-text="12.1"><p class="s10" style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;">Extending prototypes: <span class="p">Whenever we added to a prototype, TypeScript would object because of<br/>a missing global declaration; can you add that declaration?</span></p></li><li data-list-text="12.2"><p class="s10" style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;">No protection? <span class="p">For all our containers, we use classes with a (TypeScript-only) protected attribute<br/>that didn’t allow accessing it from the “outside.” However, in the previous editions, we worked with<br/>plain JavaScript; how could we manage hiding the attribute from outsiders? A hint may help: think</span></p><p class="s17" style="padding-left: 43pt;text-indent: 0pt;line-height: 11pt;text-align: left;">of a Symbol!</p></li><li data-list-text="12.3"><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 120%;text-align: justify;"><b>No abstract classes? </b>We used abstract classes for the <span class="s245">Maybe </span>and <span class="s245">Either </span><span>monads, but those<br/>types of classes are only available in TypeScript. Can you figure out an alternative way of working,<br/>but in JavaScript?</span></p></li><li data-list-text="12.4"><p style="padding-top: 7pt;padding-left: 67pt;text-indent: -23pt;text-align: justify;"><b>Maybe tasks? </b>In the <i>Questions </i>section of <i>Chapter 8, Connecting Functions, </i>a question <i>{Question</i></p><p style="padding-top: 2pt;padding-left: 43pt;text-indent: 0pt;line-height: 113%;text-align: justify;"><i>8.2) </i><span>had to do with getting the pending tasks for a person while taking errors or border situations<br/>into account, such as the possibility that the selected person might not even exist. Redo that exercise<br/>but using a </span><span class="s245">Maybe </span>or <span class="s245">Either </span>monad to simplify that code.</p></li><li data-list-text="12.5"><p class="s10" style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: justify;">Extending your trees: <span class="p">To get a more complete implementation of our functional binary search<br/>trees, implement the following functions:</span></p><ul id="l170"><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">Calculate the tree’s height or, equivalently, the maximum distance from the root to any other node</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">List all the tree’s keys, in ascending order</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">Delete a key from a tree</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li></ul></li><li data-list-text="12.6"><p style="padding-left: 43pt;text-indent: 1pt;line-height: 121%;text-align: justify;"><b>Code shortening: </b>We mentioned that the <span class="s245">treeSearch () </span><span>function could be shortened—can<br/>you do that? Yes, this is more of a JavaScript problem than a functional one, and I’m not saying that<br/>shorter code is necessarily better, but many programmers act as if it were, so it’s good to be aware of<br/>such a style if only because you’re likely to find it.</span></p></li><li data-list-text="12.7"><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 1pt;line-height: 123%;text-align: justify;"><b>Functional lists: </b><span>In the same spirit as binary trees, implement functional lists. Since a list is<br/>defined to be either empty or a node </span><i>{head), </i>followed by another list <i>{tail), </i><span>you might want to start<br/>with the following, quite similar to our binary search tree:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">type LIST&lt;A&gt; = (</p><p class="s17" style="padding-top: 2pt;padding-left: 64pt;text-indent: 0pt;text-align: left;">_nonEmptyList: (_head: A, _tail: LIST&lt;A&gt;) =&gt; any,</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">488  Building Better Containers - Functional Data Types</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 91pt;text-indent: -12pt;line-height: 115%;text-align: left;"><span>emptyList: LIST&lt;A&gt;<br/>any;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 61pt;text-indent: 0pt;text-align: left;">const NewList =</p><p class="s17" style="padding-top: 2pt;padding-left: 76pt;text-indent: -1pt;line-height: 118%;text-align: left;"><span>&lt;A&gt;(head: A, tail: LIST&lt;A&gt;): LIST&lt;A&gt; =&gt;<br/>(f: FN, _g: FN) =&gt;</span></p><p class="s17" style="padding-left: 86pt;text-indent: 0pt;line-height: 13pt;text-align: left;">f(head, tail);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 61pt;text-indent: 0pt;text-align: left;">const EmptyList =</p><p class="s17" style="padding-top: 2pt;padding-left: 76pt;text-indent: -1pt;line-height: 118%;text-align: left;"><span>&lt;A&gt;(): LIST&lt;A&gt; =&gt;<br/>(f: FN, g: FN) =&gt;</span></p><p style="padding-top: 2pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">9() ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>Here are some easy one-line operations to get you started; note they are very similar in style to what<br/>we wrote for binary trees:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 74pt;text-indent: -12pt;line-height: 118%;text-align: left;"><span>const listHead = &lt;A&gt;(list: LIST&lt;A&gt;): A | null =&gt;<br/>list (</span></p><p class="s17" style="padding-left: 88pt;text-indent: 0pt;line-height: 117%;text-align: left;"><span>(head: A, _tail: LIST&lt;A&gt;) =&gt; head,<br/>() =&gt; null</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 74pt;text-indent: -12pt;line-height: 115%;text-align: left;"><span>const listTail = &lt;A&gt;(list: LIST): LIST&lt;A&gt; | null =&gt;<br/>list (</span></p><p class="s17" style="padding-left: 121pt;text-indent: -33pt;line-height: 117%;text-align: left;"><span>(head: A, tail: LIST&lt;A&gt;) =&gt; tail,<br/>null</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 74pt;text-indent: -12pt;line-height: 118%;text-align: left;"><span>const listlsEmpty = &lt;A&gt;(list: LIST&lt;A&gt;): boolean =&gt;<br/>list (</span></p><p class="s17" style="padding-left: 88pt;text-indent: 0pt;line-height: 118%;text-align: left;"><span>(_head: A, tail: LIST&lt;A&gt;) =&gt; false,<br/>() =&gt; true</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 74pt;text-indent: -12pt;line-height: 118%;text-align: left;"><span>const listsize = &lt;A&gt;(list: LIST&lt;A&gt;): number =&gt;<br/>list (</span></p><p class="s17" style="padding-left: 88pt;text-indent: 0pt;line-height: 13pt;text-align: left;">(head: A, tail: LIST&lt;A&gt;) =&gt; 1 + listsize (tail) ,</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 401pt;text-indent: 0pt;text-align: left;">Questions   489</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: left;">You could consider having these operations:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l171"><li data-list-text="•"><p style="padding-left: 70pt;text-indent: -13pt;text-align: left;">Transforming a list into an array and vice versa</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">Reversing a list</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">Appending one list to the end of another list</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">Concatenating two lists</p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>Don’t forget a listMap () function! Also, the listReduce () and listFilter () functions<br/>will come in handy.</span></p></li><li data-list-text="12.8"><p class="s10" style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;">No Boolean operators? <span class="p">Imagine we had the true and false Boolean values, but we didn’t have<br/>any operators such as &amp;&amp;, | |, or !. While we could make up for their absence with some (possibly<br/>repetitive) coding, we can have functions produce the same results; can you see how? Think along the<br/>same lines as for binary trees. We could represent a Boolean value by a function that takes a pair of<br/>functions as arguments and applies the first if the Boolean is true, and the second otherwise.</span></p></li></ol></ol><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-top: 13pt;padding-left: 193pt;text-indent: 0pt;text-align: left;"><a name="bookmark519">Answers to Questions</a></h2><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Here are the solutions (partial, or worked out in full) to the questions that were contained within<br/>the chapters in this book. In many cases, there are extra questions so that you can do further work<br/>if you choose to.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-left: 43pt;text-indent: 0pt;text-align: justify;"><a name="bookmark520">Chapter 1,  Becoming Functional - Several Questions</a></p><ol id="l172"><ol id="l173"><li data-list-text="1.1"><p class="s10" style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: left;">TypeScript, please! <span class="p">The following are the fully annotated versions of the code in the chapter. This<br/>is the code for the factorial functions:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// question_01_typescript_please.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 53pt;text-indent: 0pt;text-align: left;">function  fact<span class="s10">(n:  number):  number  {</span></p><p class="s17" style="padding-top: 1pt;padding-left: 76pt;text-indent: -11pt;line-height: 119%;text-align: left;"><span>if (n === 0) {<br/>return 1;</span></p><p class="s17" style="padding-left: 65pt;text-indent: 0pt;line-height: 13pt;text-align: left;">} else {</p><p class="s17" style="padding-top: 2pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">return n * fact(n - 1);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 53pt;text-indent: 0pt;text-align: left;">const  fact2  =  <span class="s10">(n:  number):  number  =&gt;  {</span></p><p class="s17" style="padding-top: 2pt;padding-left: 77pt;text-indent: -11pt;line-height: 119%;text-align: left;"><span>if (n === 0) {<br/>return 1;</span></p><p class="s17" style="padding-left: 65pt;text-indent: 0pt;line-height: 13pt;text-align: left;">} else {</p><p class="s17" style="padding-top: 2pt;padding-left: 76pt;text-indent: 0pt;text-align: left;">return n * fact2(n - 1);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 50pt;text-indent: 0pt;text-align: center;">const fact3 = <span class="s10">(n: number): number =&gt;</span></p><p class="s17" style="padding-top: 2pt;padding-left: 47pt;text-indent: 0pt;text-align: center;">n === 0 ? 1 : n * fact3(n - 1);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: justify;">This is the code for the spreading examples:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">492  Answers to Questions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><table style="border-collapse:collapse;margin-left:59.38pt" cellspacing="0"><tr style="height:52pt"><td style="width:50pt"><p class="s19" style="padding-right: 10pt;text-indent: 0pt;line-height: 12pt;text-align: right;">function</p><p class="s19" style="padding-top: 2pt;padding-right: 8pt;text-indent: 0pt;text-align: right;">return</p><p class="s19" style="padding-top: 4pt;padding-left: 3pt;text-indent: 0pt;text-align: left;">}</p></td><td style="width:91pt"><p class="s19" style="padding-left: 7pt;text-indent: 0pt;line-height: 12pt;text-align: left;">sum3(a: <span class="s188">number,</span></p><p class="s19" style="padding-top: 2pt;padding-left: 6pt;text-indent: 0pt;text-align: left;">a + b + c;</p></td><td style="width:74pt"><p class="s188" style="padding-top: 1pt;padding-left: 11pt;text-indent: 0pt;text-align: left;">b: number.</p></td><td style="width:90pt"><p class="s188" style="padding-top: 1pt;padding-left: 3pt;text-indent: 0pt;text-align: left;">c: number): number {</p></td></tr><tr style="height:22pt"><td style="width:50pt"><p class="s19" style="padding-top: 7pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">const x:</p></td><td style="width:91pt"><p class="s188" style="padding-top: 8pt;padding-left: 9pt;text-indent: 0pt;text-align: left;">[number, number.</p></td><td style="width:74pt"><p class="s188" style="padding-top: 8pt;padding-left: 29pt;text-indent: 0pt;text-align: left;">number] =</p></td><td style="width:90pt"><p class="s19" style="padding-top: 7pt;padding-left: 6pt;text-indent: 0pt;text-align: left;">[1, 2, 3] ;</p></td></tr><tr style="height:23pt"><td style="width:50pt"><p class="s19" style="padding-left: 2pt;text-indent: 0pt;text-align: left;">const y =</p></td><td style="width:91pt"><p class="s19" style="padding-left: 13pt;text-indent: 0pt;text-align: left;">sum3(...x); //</p></td><td style="width:74pt"><p class="s19" style="padding-left: 18pt;text-indent: 0pt;text-align: left;">equivalent</p></td><td style="width:90pt"><p class="s19" style="padding-left: 3pt;text-indent: 0pt;text-align: left;">to sum3(1,2,3)</p></td></tr><tr style="height:23pt"><td style="width:50pt"><p class="s19" style="padding-top: 8pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">const f =</p></td><td style="width:91pt"><p class="s19" style="padding-top: 8pt;padding-left: 15pt;text-indent: 0pt;text-align: left;">[1, 2, 3] ;</p></td><td style="width:74pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:90pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:15pt"><td style="width:50pt"><p class="s19" style="padding-left: 2pt;text-indent: 0pt;text-align: left;">const g =</p></td><td style="width:91pt"><p class="s19" style="padding-left: 15pt;text-indent: 0pt;text-align: left;">[4, . . .f , 5];</p></td><td style="width:74pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:90pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:15pt"><td style="width:50pt"><p class="s19" style="padding-left: 2pt;text-indent: 0pt;line-height: 13pt;text-align: left;">const h =</p></td><td style="width:91pt"><p class="s19" style="padding-top: 1pt;padding-left: 15pt;text-indent: 0pt;line-height: 12pt;text-align: left;">[. . . f, • • • g] ;</p></td><td style="width:74pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:90pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr></table><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-top: 4pt;padding-left: 61pt;text-indent: 0pt;line-height: 118%;text-align: left;"><span>const p = { some: 3, data: 5 };<br/>const q = { more: 8, ...p };</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 61pt;text-indent: 0pt;line-height: 118%;text-align: left;"><span>const numbers = [2, 2, 9, 6, 0, 1, 2, 4, 5, 6] ;<br/>const minA = Math.min(...numbers); // 0</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 61pt;text-indent: 0pt;line-height: 118%;text-align: left;">const maxArray = (arr: <span class="s10">number!]) =&gt; </span><span>Math.max(...arr);<br/>const maxA = maxArray(numbers); // 9</span></p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Why do we need to specify the type of x, but not those of f, g, h, p, and q? The issue is that TypeScript<br/>checks the call to sum3 (), and for that, it needs to be sure that x is defined to be an array with<br/>three numbers.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>TypeScript would be able to deduce that sum3 () returns a number, but it’s best if you specify it, to<br/>prevent possible future bugs where you would return something that isn’t a number.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">The newCounter () function needs no type definitions; TypeScript is able to work types out. (See</p><p class="s9" style="padding-top: 2pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">Question 1.7 <span class="p">further on.)</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="1.2"><p class="s10" style="padding-top: 6pt;padding-left: 52pt;text-indent: 1pt;line-height: 124%;text-align: justify;">Classes as first-class objects: <span class="p">As you may recall, a class is basically a function that can be used<br/>with new. Therefore, it stands to reason that we should be able to pass classes as parameters to other<br/>functions. makeSaluteClass () creates a class (that is, a special function) that uses a closure<br/>to remember the value of term. We have looked at more examples like this throughout this book.</span></p><p style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">The TypeScript code for the class is as follows:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// question_01_classes_as_lst_class.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 61pt;text-indent: 0pt;text-align: left;">const makeSaluteClass     (term: string)</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 244pt;text-indent: 0pt;text-align: left;">Chapter 1, Becoming Functional - Several Questions      493</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 64pt;text-indent: 0pt;text-align: left;">class {</p><p class="s17" style="padding-top: 2pt;padding-left: 76pt;text-indent: 0pt;text-align: left;">x: string;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 89pt;text-indent: -12pt;line-height: 118%;text-align: left;"><span>constructor(x: string) {<br/>this.x = x;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 77pt;text-indent: 0pt;text-align: left;">salute(y: string) {</p><p class="s17" style="padding-top: 2pt;padding-left: 89pt;text-indent: 0pt;text-align: left;">console.log(&#39;${this.x} says &quot;${term}&quot; to ${y}&#39;);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 52pt;text-indent: 0pt;line-height: 115%;text-align: left;"><span>const Spanish = makeSaluteClass(&quot;HOLA&quot;);<br/>new Spanish(&quot;ALFA&quot;).salute(&quot;BETA&quot;);</span></p><p class="s17" style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// ALFA says &quot;HOLA&quot; to BETA</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 52pt;text-indent: 0pt;text-align: left;">new (makeSaluteClass(&quot;HELLO&quot;))(&quot;GAMMA&quot;).salute(&quot;DELTA&quot;);</p><p class="s17" style="padding-top: 2pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// GAMMA says &quot;HELLO&quot; to DELTA</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 53pt;text-indent: 0pt;text-align: left;">const fullSalute = (</p><p class="s17" style="padding-top: 2pt;padding-left: 64pt;text-indent: 0pt;line-height: 118%;text-align: left;"><span>c: ReturnType&lt;typeof makeSaluteClass&gt;,<br/>x: string,</span></p><p class="s17" style="padding-left: 64pt;text-indent: 0pt;line-height: 12pt;text-align: left;">y: string</p><p class="s17" style="padding-top: 2pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">) =&gt; new c(x).salute(y) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 53pt;text-indent: 0pt;line-height: 118%;text-align: left;"><span>const French = makeSaluteClass(&quot;BON JOUR&quot;);<br/>fullSalute(French, &quot;EPSILON&quot;, &quot;ZETA&quot;);</span></p><p class="s17" style="padding-left: 53pt;text-indent: 0pt;line-height: 12pt;text-align: left;">// EPSILON says &quot;BON JOUR&quot; to ZETA</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 107%;text-align: left;"><span>Note the usage of TypeScript’s ReturnType&lt; &gt; utility type to specify that c will be something created<br/>by calling </span><span class="s245">makeSaluteClass ().</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="1.3"><p class="s10" style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;">Climbing factorial: <span class="p">The following code does the trick. We add an auxiliary variable, f, and we<br/>make it climb from 1 to n. We must be careful so that fact Up (0) = = = 1:</span></p><p class="s293" style="padding-top: 8pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">11 <span class="s17">question_01_climbing_factorial.ts</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 20pt;text-indent: 0pt;text-align: left;">494  <span class="s164">Answers to Questions</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-top: 8pt;padding-left: 73pt;text-indent: -11pt;line-height: 117%;text-align: left;">const factUp = (n: number, <span class="s10">f = 1): </span><span>number =&gt;<br/>n &lt;= f ? f : f * factUp(n, </span><span class="s10">f + 1) ;</span></p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;text-align: justify;">You don’t need to specify that f is of type number; TypeScript automatically works that out.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>This solution may worry you because nobody prevents calling factUp () with two arguments - but<br/>we need the second parameter to be omitted, so it will be initialized to 1. We can solve this defect<br/>as follows:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 73pt;text-indent: -12pt;line-height: 118%;text-align: left;"><span>const  factUp2  =  (n:  number):  number  =&gt;  {<br/>const  factAux  =  (f:  number):  number  =&gt;</span></p><p class="s17" style="padding-left: 73pt;text-indent: 11pt;line-height: 118%;text-align: left;"><span>n &lt;= f ? f : f * factAux(f + 1) ;<br/>return factAux(l);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: justify;"><span>The internal factAux () function is basically our previous factUp () function, except that it<br/>doesn’t need the n parameter, because it’s available in its scope. Our new factUp2 () function calls</span></p><p class="s17" style="padding-left: 53pt;text-indent: 0pt;line-height: 11pt;text-align: justify;">factAux (), <span class="s246">providing its needed default value of </span>1.</p><p style="padding-top: 9pt;padding-left: 52pt;text-indent: 0pt;text-align: justify;">If you like having a default value, you can go with the following code:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// continued...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 73pt;text-indent: -12pt;line-height: 117%;text-align: left;"><span>const factUp3 = (n: number): number =&gt; {<br/>const factAux = (f = 1): number =&gt;</span></p><p class="s17" style="padding-left: 73pt;text-indent: 11pt;line-height: 118%;text-align: left;"><span>n &lt;= f ? f : f * factAux(f + 1);<br/>return factAux();</span></p><p class="s17" style="padding-top: 2pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">};</p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">To test these functions, the tests (for correct values) in <i>Question 1.5 </i>will do.</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="1.4"><p class="s10" style="padding-top: 6pt;padding-left: 52pt;text-indent: 1pt;line-height: 123%;text-align: justify;">Factorial errors: <span class="p">The key to avoiding repeating tests is to write a function that will check the value<br/>of the argument to ensure it’s valid, and if so, call an inner function to do the factorial itself, without<br/>worrying about erroneous arguments:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">// question_01_factorial_errors.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 61pt;text-indent: 0pt;text-align: left;">const carefulFact = (n: number): number | never =&gt; {</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 244pt;text-indent: 0pt;text-align: left;">Chapter 1, Becoming Functional - Several Questions      495</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-top: 7pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">if (</p><p class="s10" style="padding-top: 2pt;padding-left: 76pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>typeof  n  ===  &quot;number&quot;  &amp;&amp;<br/>n &gt;= 0 &amp;&amp;</span></p><p class="s10" style="padding-left: 76pt;text-indent: 0pt;line-height: 10pt;text-align: left;">n  ===  Math.floor(n)</p><p class="s10" style="padding-top: 6pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">) {</p><p class="s17" style="padding-left: 88pt;text-indent: -11pt;line-height: 114%;text-align: left;"><span>const  innerFact  =  (n:  number):  number  =&gt;<br/>n === 0 ? 1 : n * innerFact(n - 1);</span></p><p class="s17" style="padding-left: 76pt;text-indent: 0pt;text-align: left;">return innerFact(n);</p><p class="s17" style="padding-top: 2pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">} else {</p><p class="s17" style="padding-top: 2pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">throw new Error(&quot;Wrong parameter for carefulFact2&quot;);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>In order, we check that n must be a number, not negative, and an integer. When an incorrect argument<br/>is recognized, we throw an error. By the way, that’s the reason for the number | never type<br/>specification; the user of this function directly recognizes that sometimes (namely, when an exception<br/>is  thrown) no value will be returned.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="1.5"><p class="s10" style="padding-left: 64pt;text-indent: -20pt;text-align: left;">Factorial testing: <span class="p">The following tests do the trick:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// question_01_factorial_testing.test.ts</p><p class="s17" style="padding-left: 52pt;text-indent: 0pt;line-height: 30pt;text-align: left;"><span>import { carefulFact } from &quot;./question_l.4&quot;;<br/>describe(&quot;Correct cases&quot;, () =&gt; {</span></p><p class="s17" style="padding-top: 2pt;padding-left: 64pt;text-indent: 0pt;text-align: left;">test(&quot;5! = 120&quot;, () =&gt; expect(carefulFact(5)).toBe(120));</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 64pt;text-indent: 0pt;text-align: left;">test(&quot;0! = 1&quot;, () =&gt; expect(carefulFact(0)).toBe(1));</p><p class="s17" style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">});</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 65pt;text-indent: -12pt;line-height: 118%;text-align: left;"><span>describe(&quot;Errors&quot;, () =&gt; {<br/>test(&quot;Should reject 3.1&quot;, () =&gt; {</span></p><p class="s17" style="padding-left: 76pt;text-indent: 0pt;line-height: 12pt;text-align: left;">expect(() =&gt; carefulFact(3.1)).toThrow();</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 65pt;text-indent: 0pt;text-align: left;">test(&quot;Should reject -4&quot;, () =&gt; {</p><p class="s17" style="padding-top: 2pt;padding-left: 76pt;text-indent: 0pt;text-align: left;">expect(() =&gt; carefulFact(-3)).toThrow();</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">496  Answers to Questions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 73pt;text-indent: 0pt;text-align: left;">testU&#39;Should reject -5.2&quot;, () =&gt; {</p><p class="s17" style="padding-top: 1pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">expect(() =&gt; caretulFact(-3)) .toThrow() ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">Running the suite shows we achieved 100% coverage.</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="1.6"><p class="s10" style="padding-top: 6pt;padding-left: 74pt;text-indent: -21pt;text-align: left;">Code squeezing: <span class="p">Using arrow functions, as suggested, as well as the prefix ++ operator (for more</span></p><p style="padding-top: 2pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">information,   see</p><p class="s17" style="padding-left: 30pt;text-indent: 0pt;text-align: left;">developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/</p><p class="s17" style="padding-left: 52pt;text-indent: 0pt;text-align: left;">Operators/Increment), <span class="s246">you can condense </span>newCounter () <span class="s246">down to the following:</span></p><p class="s17" style="padding-top: 10pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">// question_01_code_squeezing.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 74pt;text-indent: -12pt;line-height: 118%;text-align: left;"><span>const  shorterCounter  =  ()  =&gt;  {<br/>let count = 0;</span></p><p class="s17" style="padding-left: 73pt;text-indent: 0pt;line-height: 13pt;text-align: left;">return () =&gt; ++count;</p><p class="s17" style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">};</p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Using arrow functions isn’t hard to understand, but be aware that many developers may have questions<br/>or doubts about using + + as a prefix operator, so this version could prove to be harder to understand.</span></p><p style="padding-top: 5pt;padding-left: 52pt;text-indent: 0pt;text-align: justify;">ESLint has <span class="s245">a no-plusplus </span><span>rule that disallows both ++ and - -. Since I do approve of using them,<br/>I  had  to  disable  the  rule;  see  </span><span class="s245">eslint.  org/docs/latest/user-guide/configuring/<br/>rules </span>for more on this.</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="1.7"><p class="s10" style="padding-left: 73pt;text-indent: -19pt;text-align: left;">What type is it? <span class="p">As newCounter () takes no arguments and returns a number, the answer is</span></p><p class="s17" style="padding-left: 54pt;text-indent: 0pt;text-align: justify;">() =&gt; number.</p><p style="padding-top: 9pt;padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: justify;"><span>If you are working with Visual Studio Code, there’s a quicker way of doing this: hovering will provide<br/>the answer, as in </span><i>Figure 1.</i></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 252pt;text-indent: 0pt;text-align: left;">Chapter 2, Thinking Functionally - A First Example     497</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="26" height="25" alt="image" src="Image_060.jpg"/></span></p><p class="s201" style="padding-top: 4pt;padding-left: 92pt;text-indent: -28pt;line-height: 199%;text-align: left;"><span>File Edit Selection View Go Run Terminal Help<br/></span><span style=" color: #164DA9;">fi </span><span style=" color: #866B45;">question_1.1.ts 5. M </span>•</p><p class="s201" style="padding-left: 95pt;text-indent: 0pt;text-align: left;">codeForChapters &gt; chapter 01 &gt; <span style=" color: #164DA9;">E </span>quest!on_1.1.ts &gt; ...</p><p class="s296" style="padding-left: 98pt;text-indent: 0pt;line-height: 8pt;text-align: left;">21</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s84" style="padding-left: 37pt;text-indent: 0pt;text-align: left;">9 <span class="s297">V</span><span class="s298">J </span>o &lt;&gt;$□■■■</p><ol id="l174"><li data-list-text="22"><p class="s141" style="padding-left: 121pt;text-indent: -22pt;line-height: 9pt;text-align: left;">// <span style=" color: #227335;">newCounter needs no type definitions;</span></p></li><li data-list-text="23"><p class="s141" style="padding-left: 120pt;text-indent: -22pt;line-height: 9pt;text-align: left;">// <span style=" color: #227335;">TypeScript is able to work types out</span></p></li></ol></li></ol></ol><p class="s296" style="padding-left: 98pt;text-indent: 0pt;line-height: 9pt;text-align: left;">24</p><ol id="l175"><li data-list-text="25"><p class="s191" style="padding-left: 121pt;text-indent: -22pt;line-height: 9pt;text-align: left;">function <span style=" color: #000;">newCounter() </span><span style=" color: #6861D5;">{</span></p></li><li data-list-text="26"><p class="s191" style="padding-left: 129pt;text-indent: -30pt;line-height: 9pt;text-align: left;">let <span style=" color: #000;">count = </span><span style=" color: #545585;">0;</span></p></li><li data-list-text="27"><p class="s191" style="padding-left: 129pt;text-indent: -30pt;line-height: 9pt;text-align: left;">return function <span style=" color: #527945;">() </span><span style=" color: #277EB3;">{</span></p></li><li data-list-text="28"><p class="s192" style="padding-left: 137pt;text-indent: -38pt;text-align: left;">count++;</p><p style="text-indent: 0pt;text-align: left;"><span><img width="23" height="23" alt="image" src="Image_061.jpg"/></span></p></li><li data-list-text="29"><p class="s191" style="padding-left: 137pt;text-indent: -38pt;line-height: 8pt;text-align: left;">return <span style=" color: #000;">count;</span></p></li></ol><p class="s302" style="padding-left: 99pt;text-indent: 0pt;line-height: 9pt;text-align: left;">30  <span class="s303">};</span></p><p class="s304" style="padding-left: 99pt;text-indent: 0pt;line-height: 9pt;text-align: left;">31 <span class="s300">}</span></p><p style="text-indent: 0pt;text-align: left;"><span><img width="26" height="26" alt="image" src="Image_062.jpg"/></span></p><p class="s296" style="padding-left: 99pt;text-indent: 0pt;line-height: 8pt;text-align: left;">32</p><p class="s191" style="padding-top: 5pt;padding-left: 42pt;text-indent: 0pt;text-align: left;">function <span style=" color: #000;">newCounterf): </span><span style=" color: #120C39;">() </span>=&gt; <span style=" color: #120C39;">number</span></p><p class="s191" style="padding-left: 99pt;text-indent: 0pt;text-align: left;"><span style=" color: #277EB3;">33 </span>const <span style=" color: #393953;">nc </span><span style=" color: #000;">r newCountert</span>)<span style=" color: #000;">;<br/></span><span style=" color: #545585;">34</span></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: center;"><span class="s306" style=" background-color: #047AD1;">&gt;&lt; </span><span class="s307" style=" background-color: #047AD1;">J? main-  </span><span class="s308">  </span><span class="s309" style=" background-color: #0479CC;"> </span><span class="s310" style=" background-color: #0479CC;">®0AS Git Graph UTF-3 LF {} TypeScript ESLint •/ Prettier </span><span class="s311" style=" background-color: #0479CC;">fP </span><span class="s310" style=" background-color: #0479CC;">Q        </span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-left: 44pt;text-indent: 0pt;text-align: center;">Figure 1 - Visual Studio Code helps with typing</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-left: 43pt;text-indent: 0pt;text-align: justify;"><a name="bookmark521">Chapter 2,  Thinking Functionally - A First Example</a></p><ol id="l176"><ol id="l177"><li data-list-text="2.1"><p class="s10" style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;">No extra variables: <span class="p">We can make do by using the f n variable itself as a flag. After calling f n (),<br/>we set the variable to nu 11. Before calling f n (), we check that it’s not nu 11 by using the short-<br/>circuit &amp; &amp; operator:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// question_02_no_extra_variabl.es. ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 65pt;text-indent: -12pt;line-height: 117%;text-align: left;"><span>const  once  =  &lt;FNType  extends  (...args:  any[])  =&gt;  any&gt;(<br/>fn: FNType | null</span></p><p class="s17" style="padding-left: 53pt;text-indent: 0pt;text-align: left;">) =&gt;</p><p class="s17" style="padding-top: 1pt;padding-left: 66pt;text-indent: 0pt;text-align: left;">((...args:  Parameters&lt;FNType&gt;)  =&gt;  {</p><p class="s10" style="padding-top: 2pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">fn &amp;&amp; <span class="s17">fn(...args);</span></p><p class="s10" style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">fn = null;</p><p class="s17" style="padding-top: 2pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">}) as FNType;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: justify;"><span>We need a small change to let TypeScript know that f n could be null; otherwise, it would object<br/>tothefn = null assignment.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="2.2"><p class="s10" style="padding-left: 43pt;text-indent: 0pt;text-align: justify;">Alternating functions: <span class="p">Like what we did in the previous question, we swap functions, and then</span></p><p style="padding-top: 2pt;padding-left: 43pt;text-indent: 0pt;text-align: justify;"><span>we do the call. Here, we use a destructuring assignment to write the swap more compactly. For<br/>more  information,  refer  to  </span><span class="s245">developer  .  mozilla  .  org/en-US/docs/Web/JavaScript/<br/>Reference/Operators/Destrueturing_assignment#swapping_variables:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-left: 20pt;text-indent: 0pt;text-align: left;">498  <span class="s189">Answers to Questions</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-top: 8pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">// question_02_alternating_fns.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 73pt;text-indent: -12pt;line-height: 114%;text-align: left;"><span>const alternator = &lt;FNType extends (...args: any[]) =&gt;<br/>any&gt; (</span></p><p class="s17" style="padding-left: 74pt;text-indent: 0pt;line-height: 118%;text-align: left;"><span>fnl: FNType,<br/>fn2: FNType</span></p><p class="s17" style="padding-left: 62pt;text-indent: 0pt;text-align: left;">) =&gt;</p><p class="s17" style="padding-top: 1pt;padding-left: 76pt;text-indent: 0pt;text-align: left;">((...args: Parameters&lt;FNType&gt;) =&gt; {</p><p class="s10" style="padding-top: 3pt;text-indent: 0pt;text-align: right;">[fnl, fn2] = [fn2, fnl];</p><p class="s17" style="padding-top: 2pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">return fn2(...args);</p><p class="s17" style="padding-top: 2pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">}) as FNType;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: right;">We can write a test as follows:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// question_02_alternating_fns.test.ts</p><p class="s17" style="padding-left: 61pt;text-indent: 0pt;line-height: 30pt;text-align: left;"><span>import { alternator } from &quot;./question_2.2&quot;;<br/>describe(&quot;alternator&quot;,                                              () =&gt; {</span></p><p class="s17" style="padding-top: 2pt;padding-left: 85pt;text-indent: -11pt;line-height: 117%;text-align: left;"><span>it(&quot;calls the two functions alternatively&quot;, () =&gt; {<br/>const funcA = jest.fn().mockReturnValue(&quot;A&quot;);<br/>const funcB = jest.fn().mockReturnValue(&quot;B&quot;);<br/>const testFn = jest.fn(alternator(funcA, funcB));</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 85pt;text-indent: 0pt;text-align: left;">expect(testFn()).toEqual(&quot;A&quot;);</p><p class="s17" style="padding-top: 2pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">expect(testFn()).toEqual(&quot;B&quot;);</p><p class="s17" style="padding-top: 2pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">expect(testFn()).toEqual(&quot;A&quot;);</p><p class="s17" style="padding-top: 2pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">expect(testFn()).toEqual(&quot;B&quot;);</p><p class="s17" style="padding-top: 2pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">expect(testFn()).toEqual(&quot;A&quot;);</p><p class="s17" style="padding-top: 2pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">expect(testFn()).toEqual(&quot;B&quot;);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-top: 4pt;padding-left: 85pt;text-indent: 0pt;line-height: 118%;text-align: justify;"><span>expect(testFn).toHaveBeenCalledTimes(6);<br/>expect(funcA).toHaveBeenCalledTimes(3);<br/>expect(funcB).toHaveBeenCalledTimes(3);</span></p><p class="s17" style="padding-top: 2pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">});</p><p class="s17" style="padding-top: 2pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">});</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 252pt;text-indent: 0pt;text-align: left;">Chapter 2, Thinking Functionally - A First Example     499</p><p style="padding-top: 22pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;">We set up two mock functions, one will return <span class="s162">11 </span><span>A&quot; and the other &quot;B&quot;, and then we test that successive<br/>calls alternate between those two values.</span></p></li><li data-list-text="2.3"><p style="padding-top: 25pt;padding-left: 43pt;text-indent: 0pt;line-height: 114%;text-align: left;"><b>Everything has a limit! </b>We simply check whether <span class="s245">1 imit </span>is greater than <span class="s245">0. </span><span>If so, we decrement<br/>it by 1 and call the original function; otherwise, we do nothing:</span></p><p class="s17" style="padding-top: 9pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// question_02_everything_has_a_limit.ts</p><p class="s17" style="padding-top: 17pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">const thisManyTimes =</p><p class="s17" style="padding-top: 2pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">&lt;FNType extends (. args: any[]) =&gt; any&gt;(</p><p class="s17" style="padding-top: 1pt;padding-left: 77pt;text-indent: 0pt;line-height: 118%;text-align: left;"><span>fn: FNType,<br/>limit: number</span></p><p class="s17" style="padding-top: 14pt;padding-left: 66pt;text-indent: 0pt;text-align: left;">( args: Parameters&lt;FNType&gt;) =&gt; {</p><p class="s10" style="padding-top: 3pt;padding-left: 89pt;text-indent: -12pt;line-height: 144%;text-align: left;"><span>if (limit &gt;0) {<br/>limit--;</span></p><p class="s10" style="padding-left: 88pt;text-indent: 0pt;line-height: 10pt;text-align: left;">return fn(.<span class="p"> </span>args);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;text-align: left;">We can write a test for it as follows:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 53pt;text-indent: 0pt;line-height: 235%;text-align: left;"><span>// question_02_everything_has_a_limit.test.ts<br/>import { thisManyTimes } from &quot;,/question_2.3&quot;;</span></p><p class="s17" style="padding-left: 52pt;text-indent: 0pt;text-align: left;">describe(&quot;thisManyTimes&quot;, () = &gt; {</p><p class="s17" style="padding-top: 1pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">it (&quot;calls the function 2 times, nothing after&quot;, () =&gt; {</p><p class="s10" style="padding-top: 4pt;padding-left: 76pt;text-indent: 0pt;text-align: left;">const fn = jest.fnO;</p><p class="s10" style="padding-top: 4pt;padding-left: 76pt;text-indent: 0pt;text-align: left;">const testFn = jest.fn(thisManyTimes(fn, 2));</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-top: 5pt;padding-left: 76pt;text-indent: 0pt;line-height: 117%;text-align: left;"><span>testFnO; // works<br/>testFnO; // works<br/>testFnO;  // nothing now<br/>testFnO; // nothing now<br/>testFnO; // nothing now<br/>testFnO; // nothing now</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">500  Answers to Questions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 85pt;text-indent: 0pt;line-height: 115%;text-align: left;"><span>expect(testFn).toHaveBeenCalledTimes(6);<br/>expect(fn).toHaveBeenCalledTimes(2);</span></p><p class="s17" style="padding-top: 2pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">});</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">Our testFn () function is set to call fn () twice, no more; the tests confirm that behavior.</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="2.4"><p class="s10" style="padding-top: 6pt;padding-left: 74pt;text-indent: -21pt;text-align: left;">Allow for crashing: <span class="p">We just have to modify once (), so if f n () crashes, we’ll reset done to</span></p><p class="s17" style="padding-left: 53pt;text-indent: 0pt;text-align: left;">false <span class="s246">to allow a new attempt:</span></p><p class="s17" style="padding-top: 10pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">// question_02_allow_for_crashing.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 61pt;text-indent: 0pt;text-align: left;">const oncelfSuccess = &lt;</p><p class="s17" style="padding-top: 2pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">FNType extends (...args: any[]) =&gt; any</p><p class="s17" style="padding-top: 3pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">&gt;(</p><p class="s17" style="padding-top: 1pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">fn: FNType</p><p class="s17" style="padding-top: 2pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">) =&gt; {</p><p class="s17" style="padding-top: 1pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">let done = false;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 86pt;text-indent: -12pt;line-height: 117%;text-align: left;"><span>return ((...args: Parameters&lt;FNType&gt;) =&gt; {<br/>if (1 done) {</span></p><p class="s17" style="padding-left: 97pt;text-indent: 0pt;text-align: left;">done = true;</p><p class="s10" style="padding-top: 3pt;padding-left: 98pt;text-indent: 0pt;text-align: left;">try {</p><p class="s10" style="padding-top: 4pt;padding-left: 109pt;text-indent: 0pt;text-align: left;">return fn(...args);</p><p class="s10" style="padding-top: 4pt;padding-left: 98pt;text-indent: 0pt;text-align: left;">} catch {</p><p class="s10" style="padding-top: 4pt;padding-left: 109pt;text-indent: 0pt;text-align: left;">done = false;</p><p class="s10" style="padding-top: 6pt;padding-left: 98pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">}) as FNType;</p><p style="padding-top: 6pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">};</p><p style="padding-top: 8pt;padding-left: 52pt;text-indent: 0pt;line-height: 114%;text-align: left;">We can see this works with a simple example; our <span class="s245">crashTwice () </span><span>function will throw an error<br/>twice and work fine afterward:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 62pt;text-indent: 0pt;line-height: 237%;text-align: left;"><span>// question_02_allow_for_crashing.manual.ts<br/>import { oncelfSuccess } from &quot;./question_2.4&quot;;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 252pt;text-indent: 0pt;text-align: left;">Chapter 2, Thinking Functionally - A First Example     501</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-top: 7pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">let count = 0;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 65pt;text-indent: -12pt;line-height: 118%;text-align: left;"><span>const crashTwice = () =&gt; {<br/>count++;</span></p><p class="s17" style="padding-left: 76pt;text-indent: -11pt;line-height: 114%;text-align: left;"><span>if (count &lt;= 2) {<br/>console.log(&quot;CRASH!&quot;);</span></p><p class="s17" style="padding-left: 76pt;text-indent: 0pt;text-align: left;">throw new Error(&quot;Crashing.. . &quot;) ;</p><p class="s17" style="padding-top: 2pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">} else {</p><p class="s17" style="padding-top: 2pt;padding-left: 76pt;text-indent: 0pt;text-align: left;">console.log(&quot;OK NOW&quot;);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 52pt;text-indent: 0pt;line-height: 30pt;text-align: left;"><span>const dolt = oncelfSuccess(crashTwice);<br/>dolt(); // CRASH!</span></p><p class="s17" style="padding-top: 2pt;padding-left: 52pt;text-indent: 0pt;line-height: 117%;text-align: left;"><span>dolt(); // CRASH!<br/>dolt(); // OK NOW<br/>dolt(); // nothing<br/>dolt(); // nothing<br/>dolt(); // nothing</span></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;text-align: left;">We can write tests as follows:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s293" style="padding-left: 53pt;text-indent: 0pt;line-height: 235%;text-align: left;">11 <span class="s17">question_02_allow_for_crashing.test.ts<br/>import { oncelfSuccess } from &quot;./question_2.4&quot;;</span></p><p class="s17" style="padding-left: 65pt;text-indent: -12pt;line-height: 118%;text-align: left;"><span>describe(&quot;oncelfSuccess&quot;, () =&gt; {<br/>it(&quot;should run once if no errors&quot;, () =&gt; {</span></p><p class="s10" style="padding-top: 1pt;padding-left: 76pt;text-indent: 0pt;text-align: left;">const myFn = jest.fnO;</p><p class="s10" style="padding-top: 4pt;padding-left: 76pt;text-indent: 0pt;text-align: left;">const onceFn = jest.fn(oncelfSuccess(myFn));</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-top: 5pt;padding-left: 76pt;text-indent: 0pt;text-align: left;">onceFn();</p><p class="s17" style="padding-top: 2pt;padding-left: 76pt;text-indent: 0pt;text-align: left;">onceFn();</p><p class="s17" style="padding-top: 2pt;padding-left: 76pt;text-indent: 0pt;text-align: left;">onceFn();</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-left: 20pt;text-indent: 0pt;text-align: left;">502  <span class="s189">Answers to Questions</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-top: 8pt;padding-left: 85pt;text-indent: 0pt;line-height: 118%;text-align: left;"><span>expect(onceFn).toHaveBeenCalledTimes(3);<br/>expect(myFn).toHaveBeenCalledTimes(1);</span></p><p class="s17" style="padding-top: 2pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">});</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 74pt;text-indent: 0pt;text-align: left;">it(&quot;should run again if an exception&quot;, () =&gt; {</p><p class="s10" style="padding-top: 3pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">const myFn = jest.fnO</p><p class="s10" style="padding-top: 4pt;padding-left: 110pt;text-indent: -10pt;line-height: 142%;text-align: left;"><span>.mocklmplementationOnce(() =&gt; {<br/>throw new Error(&quot;ERROR 1&quot;);</span></p><p class="s10" style="padding-top: 2pt;padding-left: 98pt;text-indent: 0pt;text-align: left;">})</p><p class="s10" style="padding-top: 2pt;padding-left: 110pt;text-indent: -10pt;line-height: 144%;text-align: left;"><span>.mocklmplementationOnce(() =&gt; {<br/>throw new Error(&quot;ERROR 2&quot;);</span></p><p class="s10" style="padding-top: 2pt;padding-left: 98pt;text-indent: 0pt;text-align: left;">})</p><p class="s10" style="padding-top: 2pt;padding-left: 99pt;text-indent: 0pt;text-align: left;">.mockReturnValue(22) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-top: 6pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">const onceFn = jest.fn(oncelfSuccess(myFn));</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 85pt;text-indent: 0pt;line-height: 118%;text-align: left;"><span>expect(onceFn).toThrow();<br/>expect(onceFn).toThrow();<br/>expect(onceFn()).toBe(22);                                                      // OK now (returns 22)<br/>onceFn();   //   nothing</span></p><p class="s17" style="padding-left: 85pt;text-indent: 0pt;line-height: 118%;text-align: left;"><span>onceFn();  //  nothing<br/>onceFn(); // nothing</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 85pt;text-indent: 0pt;line-height: 118%;text-align: left;"><span>expect(onceFn).toHaveBeenCalledTimes(6);<br/>expect(myFn).toHaveBeenCalledTimes(3);</span></p><p class="s17" style="padding-top: 2pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">});</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>We need to check two cases: when the called function works normally and when it crashes at least once.<br/>The first case is just like the test we wrote for once (), so nothing is new here. For the second case,</span></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>we set up a mock myFn () function that throws errors twice and returns a regular value afterward;<br/>the test verifies the expected behavior.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="2.5"><p class="s10" style="padding-left: 73pt;text-indent: -21pt;text-align: left;">Say no to arrows: <span class="p">The code is essentially the same, but the placement of type information varies:</span></p></li></ol></ol><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s293" style="padding-left: 62pt;text-indent: 0pt;text-align: left;">I<span class="s17">/ question_02_say_no_to_arrows.ts</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 229pt;text-indent: 0pt;text-align: left;">Chapter 3, Starting Out with Functions - A Core Concept      503</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 53pt;text-indent: 0pt;text-align: left;">function   once&lt;FNType   <span class="s10">extends   (...args:   any[])   =&gt;   any&gt;(</span></p><p class="s17" style="padding-top: 2pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">fn: <span class="s10">FNType</span></p><p class="s10" style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">): FNType {</p><p class="s17" style="padding-top: 2pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">let done = false;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 65pt;text-indent: 0pt;text-align: left;">return   function   (...args:   <span class="s10">Parameters&lt;FNType&gt;)   {</span></p><p class="s17" style="padding-top: 2pt;padding-left: 88pt;text-indent: -11pt;line-height: 118%;text-align: left;"><span>if (1 done) {<br/>done = true;</span></p><p class="s17" style="padding-left: 89pt;text-indent: 0pt;line-height: 12pt;text-align: left;">return fn(. args);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 65pt;text-indent: 0pt;text-align: left;">} as FNType;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-left: 43pt;text-indent: 0pt;text-align: left;"><a name="bookmark522">Chapter 3,  Starting Out with Functions - A Core Concept</a></p><ol id="l178"><ol id="l179"><li data-list-text="3.1"><p class="s10" style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;">Uninitialized object? <span class="p">The key is that we didn’t wrap the returned object in parentheses, so<br/>JavaScript thinks the braces enclose the code to be executed. In this case, type is considered to be<br/>labeling a statement, which doesn’t really do anything: it’s a (t) expression that isn’t used. Due to<br/>this, the code is considered valid, and since it doesn’t have an explicit return statement, the implicit<br/>returned value is undefined.</span></p><p style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;text-align: left;">The corrected code is as follows:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 64pt;text-indent: -11pt;line-height: 118%;text-align: left;"><span>const  simpleAction  =  (t:string)  =&gt;  ({<br/>type: t;</span></p><p style="padding-top: 3pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">});</p><p style="padding-top: 8pt;padding-left: 43pt;text-indent: 0pt;line-height: 106%;text-align: justify;">See       <span class="s245">developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/<br/>label  </span>for  more  on  labels,  and  <span class="s245">developer.  mozilla.  org/en-US/docs/Web/JavaScript/<br/>Reference/Functions/Arrow_functions#Returning_obj   ect_literals   </span><span>for    more<br/>on                           returning objects.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="3.2"><p class="s10" style="padding-top: 5pt;padding-left: 69pt;text-indent: -25pt;text-align: left;">Are arrows allowed? <span class="p">There would be no problems with useArguments2 (), but with</span></p><p class="s17" style="padding-left: 43pt;text-indent: 0pt;text-align: justify;">useArguments (), <span class="s246">you would get an error since arguments are not defined for arrow functions:</span></p><p class="s17" style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">useArguments(22,9,60);</p><p class="s17" style="padding-top: 2pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">Uncaught ReferenceError: arguments is not defined</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">504  Answers to Questions</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="3.3"><p class="s10" style="padding-left: 73pt;text-indent: -20pt;text-align: left;">Three more types: <span class="p">We have the following:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l180"><li data-list-text="•"><p class="s17" style="padding-left: 80pt;text-indent: -13pt;text-align: left;">fnl is (y: number) =&gt; (z: number) =&gt; number</p></li><li data-list-text="•"><p class="s17" style="padding-top: 5pt;padding-left: 80pt;text-indent: -13pt;text-align: left;">fn2 is (z: number) =&gt; number</p></li><li data-list-text="•"><p class="s17" style="padding-top: 5pt;padding-left: 79pt;text-indent: -13pt;text-align: left;">fn3 is just number</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li></ul></li><li data-list-text="3.4"><p class="s10" style="padding-left: 73pt;text-indent: -21pt;text-align: left;">One-liner: <span class="p">It works! (Yes, a one-line answer is appropriate in this case!)</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="3.5"><p class="s10" style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;">Reducing types: <span class="p">Lets see all the types that we’ll need. For State, we’d have an object with all the<br/>fields needed for your application. For a generic version, we could write the following, but a specific<br/>description would be much better:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">type State = Record&lt;string, unknowns;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">We would define all the possible action types with something like the following:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 61pt;text-indent: 0pt;text-align: left;">type ActionType = &quot;CREATE&quot; | &quot;DELETE&quot; | &quot;UPDATE&quot;;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">We’d have an object with type and an optional payload for actions:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 73pt;text-indent: -12pt;line-height: 117%;text-align: left;"><span>type Action = {<br/>type: ActionType;</span></p><p class="s17" style="padding-left: 73pt;text-indent: 0pt;text-align: left;">payload: Record&lt;string, unknowns | null;</p><p style="padding-top: 6pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">};</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 121%;text-align: left;"><span>(It would be much better if you defined in detail what possible payloads you could have, instead of<br/>going with a generic definition as in the preceding code.)</span></p><p style="padding-top: 5pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">Our <span class="s245">doAct ion () </span>function would be as follows:</p><p class="s17" style="padding-top: 10pt;padding-left: 73pt;text-indent: -11pt;line-height: 118%;text-align: left;"><span>function doAction(state: State, action: Action) {<br/>const newState: State = {};</span></p><p class="s17" style="padding-left: 74pt;text-indent: 0pt;line-height: 13pt;text-align: left;">switch (action?.type) {</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 74pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 9pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">For <span class="s245">dispatchTable, </span>we’d have the following:</p><p class="s17" style="padding-top: 10pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">const dispatchTable: Record&lt;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 229pt;text-indent: 0pt;text-align: left;">Chapter 3, Starting Out with Functions - A Core Concept      505</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 64pt;text-indent: 0pt;text-align: left;">ActionType,</p><p class="s17" style="padding-top: 2pt;padding-left: 66pt;text-indent: 0pt;text-align: left;">(state: State, action: Action) =&gt; State</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 64pt;text-indent: 0pt;text-align: left;">CREATE: (state, action) =&gt; {</p><p class="s17" style="padding-top: 2pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">// update state, generating newState,</p><p class="s17" style="padding-top: 2pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">// depending on the action data</p><p class="s17" style="padding-top: 2pt;padding-left: 77pt;text-indent: 0pt;line-height: 118%;text-align: left;"><span>// to create a new item<br/>const NewState: State = {</span></p><p class="s17" style="padding-left: 77pt;text-indent: 12pt;line-height: 235%;text-align: left;"><span>/* updated State */<br/>return NewState;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: left;">Finally, we would write the following:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 64pt;text-indent: -11pt;line-height: 119%;text-align: left;"><span>function doAction2(state: State, action: Action) {<br/>return dispatchTable[action.type]</span></p><p class="s17" style="padding-left: 77pt;text-indent: 0pt;line-height: 13pt;text-align: left;">? dispatchTable[action.type](state, action)</p><p class="s17" style="padding-top: 1pt;padding-left: 78pt;text-indent: 0pt;text-align: left;">: state;</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="3.6"><p class="s10" style="padding-left: 63pt;text-indent: -20pt;text-align: left;">Spot the bug! <span class="p">Initially, many people look at the weird </span><span class="s245">(console (. ), window. store .</span></p><p class="s17" style="padding-left: 44pt;text-indent: 0pt;text-align: left;">set (  )) <span class="s246">code, but the bug isn’t there: because of how the comma operator works, JavaScript</span></p><p style="padding-top: 1pt;padding-left: 43pt;text-indent: 0pt;text-align: left;">does the logging first, and then the setting. The real problem is that oldSet () is not bound to the</p><p class="s17" style="padding-left: 43pt;text-indent: 0pt;text-align: left;">window. store <span class="s246">object, so the second line should be as follows instead:</span></p><p class="s17" style="padding-top: 10pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">const oldSet = window.store.set.bind(window.store);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;">Reread the <i>Working with methods </i>section for more on this, and see <i>Question 11.1 </i><span>for another way of<br/>doing logging - that is, with decorators.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="3.7"><p style="padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: left;"><b>Bindless binding: </b><span>If bind () wasn’t available, you could use a closure, the that trick (which we<br/>saw in the </span><i>Handling the this value </i>section), and the apply () method, as follows:</p><p class="s17" style="padding-top: 8pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// question_03_bindless_binding.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">506  Answers to Questions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 73pt;text-indent: -11pt;line-height: 118%;text-align: left;"><a name="bookmark523"><span>function bind(context) {<br/>var </span></a><span class="s10">that = this;</span></p><p class="s17" style="padding-left: 73pt;text-indent: 0pt;line-height: 12pt;text-align: left;">return function() {</p><p class="s17" style="padding-top: 2pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">return <span class="s10">that.apply</span>(context, arguments);</p><p style="padding-top: 6pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">};</p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">We could do something similar to what we did in the <i>Adding missing functions </i>section.</p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;line-height: 108%;text-align: left;">Alternatively, just for variety, we could use a common idiom based on the | | operator: if <span class="s245">Function.<br/>prototype . bind </span><span>exists, evaluation stops right there, and the existing bind () method is used;<br/>otherwise,                                                                                               our new function is applied:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 73pt;text-indent: -11pt;line-height: 118%;text-align: left;"><span>Function.prototype.bind =<br/></span><span class="s10">Function.prototype.bind || </span><span>function(context) {<br/>var     that = this;</span></p><p class="s17" style="padding-left: 73pt;text-indent: 0pt;line-height: 12pt;text-align: left;">return function() {</p><p class="s17" style="padding-top: 2pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">return that.apply(context, arguments);</p><p style="padding-top: 6pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">};</p><p style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">};</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="3.8"><p style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;line-height: 120%;text-align: justify;"><b>Mystery sort: </b>The <span class="s245">compare (a, b) </span><span>comparison function must return a positive number if<br/>a&gt;b, a negative number if a&lt;b, or 0 if a equals b. When you subtract ab, you get that result, so<br/>it works. (Of course, this assumes that no number is either Infinity or NaN.) For more on this,</span></p><p style="text-indent: 0pt;text-align: right;">check</p><p class="s17" style="padding-left: 52pt;text-indent: 0pt;line-height: 11pt;text-align: left;">developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/</p><p class="s17" style="padding-left: 52pt;text-indent: 0pt;text-align: left;">Global_Obj ects/Array/sort#description.</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="3.9"><p class="s10" style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;">Negative sort: <span class="p">All negative numbers get sorted first because of the initial “ - ”, so that’s kind of right,<br/>but the numbers themselves are still sorted as strings, so the result is wrong anyway. In the following<br/>example, the lowest number is - 6 6 6, which should have been the first element after sorting:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">let someNumbers = [3, 20, 100, -44, -5, -666];</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 62pt;text-indent: 0pt;text-align: left;">someNumbers.sort() ;   // [-44, -5, -666, 100, 20, 3]</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="3.10"><p class="s10" style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;">Lexicographic sorting: <span class="p">Let’s suppose we have an array of strings. To sort it lexicographically in<br/>an efficient way, a solution would be as follows:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 266pt;text-indent: 0pt;text-align: left;">Chapter 4, Behaving Properly - Pure Functions     507</p><ol id="l181"><li data-list-text="1."><p style="padding-top: 20pt;padding-left: 69pt;text-indent: -15pt;text-align: left;">Transform the array of strings into an array of objects with an added <span class="s245">sortBy </span>field.</p></li><li data-list-text="2."><p style="padding-top: 4pt;padding-left: 68pt;text-indent: -16pt;text-align: left;">For each string, generate the corresponding string to sort by, and put the value in the <span class="s245">sortBy </span>field.</p></li><li data-list-text="3."><p style="padding-top: 4pt;padding-left: 68pt;text-indent: -16pt;text-align: left;">Sort the array by <span class="s245">sortBy.</span></p></li><li data-list-text="4."><p style="padding-top: 6pt;padding-left: 68pt;text-indent: -16pt;text-align: left;">Drop the added field to convert the sorted array into an array of strings as originally.</p></li></ol></li><li data-list-text="3.11"><p style="padding-top: 29pt;padding-left: 43pt;text-indent: 0pt;text-align: justify;"><b>Stubbed logging: </b>The <span class="s245">console . log () </span><span>method can accept any number of arguments of any<br/>type, and won’t return anything, so its type is (   </span><span class="s245">args : any [] ) : void.</span></p></li></ol></ol><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-left: 43pt;text-indent: 0pt;text-align: left;"><a name="bookmark524">Chapter 4,  Behaving Properly - Pure Functions</a></p><ol id="l182"><ol id="l183"><li data-list-text="4.1"><p class="s10" style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: justify;">Must return? <span class="p">If a pure function doesn’t return anything, it means that the function doesn’t do<br/>anything since it can’t modify its inputs and doesn’t have any other side effect.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="4.2"><p class="s10" style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;">Well-specified return: <span class="p">TypeScript would have objected because the result of the function would<br/>be string | undefined, because the . pop () method returns undefined if the input array<br/>is empty.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="4.3"><p style="padding-left: 43pt;text-indent: 0pt;text-align: justify;"><b>Go for a closure: </b>We just have to wrap the definition of <span class="s245">f ib2 () </span>in an IIFE; <span class="s245">f ibC () </span><span>is equivalent<br/>to </span><span class="s245">f </span>ib2 () but with an internal <span class="s245">cache:</span></p><p class="s293" style="padding-top: 10pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">11 <span class="s17">question_04_go_for_a_closure.ts</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 53pt;text-indent: 0pt;text-align: left;">const fibC = (() =&gt; {</p><p class="s17" style="padding-top: 1pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">const cache: number [] = [] ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 77pt;text-indent: -12pt;line-height: 117%;text-align: left;"><span>const fib2 = (n: number): number = &gt; {<br/>if (cache[n] === undefined) {</span></p><p class="s17" style="padding-left: 100pt;text-indent: -11pt;line-height: 120%;text-align: left;"><span>if (n === 0) {<br/>cache [0] = 0 ;</span></p><p class="s17" style="padding-left: 101pt;text-indent: -11pt;line-height: 118%;text-align: left;"><span>} else if (n === 1) {<br/>cache [1] = 1;</span></p><p class="s17" style="padding-left: 89pt;text-indent: 0pt;line-height: 13pt;text-align: left;">} else {</p><p class="s17" style="padding-top: 1pt;padding-left: 101pt;text-indent: 0pt;text-align: left;">cache [n] = f ib2 (n - 2) + f ib2 (n - 1) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-left: 20pt;text-indent: 0pt;text-align: left;">508  <span class="s189">Answers to Questions</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 87pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-top: 4pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">return cache [n] ;</p><p class="s17" style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">};</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-top: 4pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">return fib2;</p><p class="s17" style="padding-top: 3pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">}) ();</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="4.4"><p class="s10" style="padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: justify;">Minimalistic function: <span class="p">It works because fib(0)=0 and fib(l)=l, so it’s true that for n&lt;2, fib(n)<br/>equals </span><i>n.</i></p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="4.5"><p class="s10" style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;">A cheap way: <span class="p">This algorithm works the same way as you’d calculate a Fibonacci number by hand.<br/>You’d start by writing down fib(0)=0 and fib(l)=l, adding them to get fib(2)=l, adding the last two to<br/>get fib(3)=2, and so on. In this version of the algorithm, a and b stand for two consecutive Fibonacci<br/>numbers. This implementation is quite efficient!</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="4.6"><p class="s10" style="padding-left: 73pt;text-indent: -21pt;text-align: justify;">Rounding type: <span class="p">The full definition, including the result type, would be as follows:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 73pt;text-indent: -11pt;line-height: 118%;text-align: left;"><span>const roundFix2 = (<br/>accum: number,<br/>n: number</span></p><p class="s164" style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">): {</p><p class="s10" style="padding-top: 2pt;padding-left: 73pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>accum: number;<br/>nRounded: number;</span></p><p class="s17" style="padding-left: 62pt;text-indent: 0pt;line-height: 11pt;text-align: left;">}=&gt;...</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="4.7"><p class="s10" style="padding-left: 73pt;text-indent: -21pt;text-align: left;">Tuples to go: <span class="p">In this case, we would return an array with two numbers, so we may write the following:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// question_04_tuples_to_go.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 62pt;text-indent: 0pt;text-align: left;"><a name="bookmark525">type AccumRoundedType = [number, number];</a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-top: 6pt;padding-left: 73pt;text-indent: -12pt;line-height: 118%;text-align: left;"><span>const roundFix2a = (<br/>accum: number,</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 266pt;text-indent: 0pt;text-align: left;">Chapter 4, Behaving Properly - Pure Functions     509</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 64pt;text-indent: 0pt;text-align: left;">n: number</p><p class="s10" style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">): AccumRoundedType =&gt; {</p><p class="s17" style="padding-top: 2pt;padding-left: 76pt;text-indent: -11pt;line-height: 114%;text-align: left;"><span>const nRounded = accum &gt; 0 ? Math.ceil(n) :<br/>Math.floor(n);</span></p><p class="s17" style="padding-left: 65pt;text-indent: 0pt;line-height: 118%;text-align: left;"><span>accum += n - nRounded;<br/>return [accum, nRounded];</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 52pt;text-indent: 0pt;text-align: left;">const roundFix2b = ( [</p><p class="s10" style="padding-top: 4pt;padding-left: 64pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>accum,<br/>n,</span></p><p class="s10" style="padding-left: 53pt;text-indent: 0pt;line-height: 10pt;text-align: left;">]: AccumRoundedType): AccumRoundedType = &gt; {</p><p class="s17" style="padding-top: 2pt;padding-left: 76pt;text-indent: -11pt;line-height: 115%;text-align: left;"><span>const nRounded = accum &gt; 0 ? Math.ceil(n) :<br/>Math.floor(n);</span></p><p class="s17" style="padding-left: 65pt;text-indent: 0pt;line-height: 118%;text-align: left;"><span>accum += n - nRounded;<br/>return [accum, nRounded];</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>The tests are very similar to what we already wrote; here, we have abridged versions of our previous<br/>code, highlighting the needed changes:</span></p><p class="s293" style="padding-top: 8pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">I<span class="s17">/ question_04_tuples_to_go.test.ts</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 52pt;text-indent: 0pt;text-align: left;">describe(&quot;roundFix2a&quot;, function () {</p><p class="s17" style="padding-top: 2pt;padding-bottom: 1pt;padding-left: 76pt;text-indent: -11pt;line-height: 118%;text-align: left;"><span>it(&quot;rounds 3.14159-&gt;3 if differences are 0&quot;, () =&gt; {<br/>const </span><span class="s10">[accum, nRounded] = </span><span>roundFix2a(0.0, 3.14159);<br/>expect(accum).toBeCloseTo(0.14159);<br/>expect(nRounded).toBe(3);</span></p><p style="padding-left: 65pt;text-indent: 0pt;line-height: 11pt;text-align: left;"><span><img width="20" height="15" alt="image" src="Image_063.gif"/></span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 65pt;text-indent: 0pt;text-align: left;">it(&quot;rounds 2.71828-&gt;3 if differences are 0.14159&quot;, () =&gt;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 76pt;text-indent: 0pt;line-height: 117%;text-align: left;">const <span class="s10">[accum, nRounded] = </span><span>roundFix2a(0.14159, 2.71828);<br/>expect(accum).toBeCloseTo(-0.14013);<br/>expect(nRounded).toBe(3);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 21pt;text-indent: 0pt;text-align: left;">510  Answers to Questions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 61pt;text-indent: 0pt;text-align: left;">describe(&quot;roundFix2b&quot;, function () {</p><p class="s17" style="padding-top: 2pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">it(&quot;rounds  2.71828-&gt;2  if  differences  are  -0.14013&quot;,  ()  =&gt;</p><p class="s17" style="padding-top: 4pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">{</p><p class="s17" style="padding-left: 85pt;text-indent: 0pt;text-align: left;"><a name="bookmark526">const </a><span class="s10">[accum, nRounded] = </span>roundFix2b([</p><p class="s10" style="padding-top: 4pt;padding-left: 98pt;text-indent: 0pt;text-align: left;">-0.14013, 2.71828,</p><p class="s17" style="padding-top: 3pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">] ) ;</p><p class="s17" style="padding-top: 1pt;padding-left: 85pt;text-indent: 0pt;line-height: 115%;text-align: left;"><span>expect(accum).toBeCloseTo(0.57815);<br/>expect(nRounded).toBe(2);</span></p><p class="s17" style="padding-top: 2pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">});</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 74pt;text-indent: 0pt;text-align: left;">it(&quot;rounds  3.14159-&gt;4  if  differences  are  0.57815&quot;,  ()  =&gt;</p><p class="s17" style="padding-top: 4pt;padding-left: 86pt;text-indent: 0pt;line-height: 13pt;text-align: left;">{</p><p class="s17" style="padding-left: 85pt;text-indent: 0pt;line-height: 13pt;text-align: left;"><a name="bookmark527">const </a><span class="s10">[accum, nRounded] = </span>roundFix2b([</p><p class="s10" style="padding-top: 4pt;padding-left: 98pt;text-indent: 0pt;text-align: left;">0.57815, 3.14159,</p><p class="s17" style="padding-top: 3pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">] ) ;</p><p class="s17" style="padding-top: 1pt;padding-bottom: 2pt;padding-left: 85pt;text-indent: 0pt;line-height: 117%;text-align: left;"><span>expect(accum).toBeCloseTo(-0.28026);<br/>expect(nRounded).toBe(4);</span></p><p style="padding-left: 62pt;text-indent: 0pt;text-align: left;"><span><img width="36" height="35" alt="image" src="Image_064.gif"/></span></p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="4.8"><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><b>One injection or two? </b><span>Having two optional injected functions would allow specifying one but<br/>omitting the other, and then calculateDeb2 () would still attempt to call the API. Providing an<br/>object with the dependencies makes injection an </span><i>all-or-nothing </i>option.</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="4.9"><p class="s10" style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: left;">JavaScript does math? <span class="p">If you run the code, you’ll (unexpectedly) get the &quot;Math failure? &quot;<br/>message. The problem has to do with the fact that JavaScript internally uses binary instead of decimal,<br/>and floating-point precision is limited. In decimal, 0.1, 0.2, and 0.3 have a fixed, short representation,<br/>but in binary, they have infinite representation, much like 1/3=0.33333... has in decimal. If you write<br/>out the value of a+b after the test, you’ll get 0.30000000000000004 - and that’s why you must be very<br/>careful when testing for equality in JavaScript.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="4.10"><p class="s10" style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;">Breaking laws: <span class="p">Some of the properties are no longer always valid. To simplify our examples, let’s<br/>assume two numbers are close to each other if they differ by no more than 0.1. If this is the case, then</span></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">we have the following:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 266pt;text-indent: 0pt;text-align: left;">Chapter 4, Behaving Properly - Pure Functions     511</p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l184"><li data-list-text="•"><p style="padding-left: 68pt;text-indent: -11pt;text-align: left;">0.5 is close to 0.6, and 0.6 is close to 0.7, but 0.5 is not close to 0.7</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 71pt;text-indent: -13pt;text-align: left;">0.5 is close to 0.6, and 0.7 is close to 0.8, but <i>0.5+0.7=1.2 </i>is not close to <i>0.6+0.8=1.4, </i>and</p><p class="s9" style="padding-top: 2pt;padding-left: 70pt;text-indent: 0pt;text-align: left;">0.5*0.7=0.35 <span class="p">is not close to </span>0.6*0.8=0.48 <span class="p">either</span></p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 69pt;text-indent: -11pt;text-align: left;">0.5 is close to 0.4, and 0.2 is close to 0.3, but <i>0.5-0.2=0.3 </i>is not close to <i>0.4-0.3=0.1, </i>and <i>0.5/0.2=2.5</i></p><p style="padding-top: 2pt;padding-left: 70pt;text-indent: 0pt;text-align: left;">is not close to <i>0.4/0.3=1.333</i></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: justify;">The other cited properties are always valid.</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li></ul></li><li data-list-text="4.11"><p class="s10" style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;">Shuffling kinds: <span class="p">This type definition allows our function to work with arrays of any type (strings,<br/>numbers, objects, etc.) and says that the type of the output array will be the same as the type of the<br/>input array.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="4.12"><p style="padding-left: 70pt;text-indent: -27pt;text-align: justify;"><b>No return needed: </b>If no data is returned, we then write <span class="s245">&lt;T&gt; </span>(arr : <span class="s245">T [ ] ) = &gt; void. </span>See</p><p class="s17" style="padding-left: 43pt;text-indent: 0pt;text-align: justify;">www. typescriptlang . org/docs/handbook/2/functions . html <span class="s246">for more.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="4.13"><p style="padding-left: 43pt;text-indent: 0pt;text-align: justify;"><b>A shuffle test: </b>Before shuffling the array, sort a copy of it, use <span class="s245">JSON. stringif y () </span><span>on it,<br/>and save the result. After shuffling, sort a copy of the shuffled array and use </span><span class="s245">JSON. stringif y ()</span></p><p style="padding-top: 1pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>on it too. Those two JSON strings should be equal. This does away with all the other tests since it<br/>ensures that the array doesn’t change its length or elements, and it would also work for arrays with<br/>repeated elements:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// question_04_a_shuffle_test.test.ts</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 52pt;text-indent: 0pt;text-align: left;">describe(&quot;shuffleTest&quot;, function () {</p><p class="s17" style="padding-top: 2pt;padding-left: 76pt;text-indent: -11pt;line-height: 117%;text-align: left;"><span>it(&quot;doesn&#39;t  change  the  array  length  or  elements&quot;,  ()  =&gt;  {<br/>const a = [22, 9, 60, 22, 12, 4, 56, 22, 60] ;</span></p><p class="s10" style="padding-left: 77pt;text-indent: 0pt;text-align: left;"><span class="s17">const </span>oldA = JSON.stringify([.<span class="p"> </span>a].sort());</p><p class="s17" style="padding-top: 2pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">shuffle(a);</p><p class="s10" style="padding-top: 1pt;padding-left: 76pt;text-indent: 0pt;text-align: left;"><span class="s17">const </span>newA = JSON.stringify([.<span class="p"> </span>a].sort());</p><p class="s10" style="padding-top: 3pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">expect(oldA).toBe(newA);</p><p class="s17" style="padding-top: 5pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">});</p><p class="s17" style="padding-top: 2pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">});</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="4.14"><p class="s10" style="padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: left;">Popular, but wrong! <span class="p">To test that a shuffle function works well, an idea is to shuffle a small array<br/>many times, and count how many possible outputs come up; the final counts should be similar, though</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 21pt;text-indent: 0pt;text-align: left;">512  Answers to Questions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">not necessarily (because of the random aspects) equal. In my article at blog. openreplay. com/</p><p class="s17" style="padding-left: 53pt;text-indent: 0pt;text-align: left;">forever-functional-shuffling-an-array-not-as-trivial-as-it-sounds/,</p><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><table style="border-collapse:collapse" cellspacing="0"><tr style="height:11pt"><td style="width:52pt" bgcolor="#FBFCFB"><p class="s312" style="padding-left: 2pt;text-indent: 0pt;line-height: 8pt;text-align: left;">A-B-C-D:</p></td><td style="width:420pt" bgcolor="#F9FBFA"><p class="s314" style="padding-left: 9pt;text-indent: 0pt;line-height: 9pt;text-align: left;"><span class="s313">983 </span>fl fl fl fl fl fl IJ fl IJ IJ fl fl.11IJ.11JJ J) IJ <i>ll </i>JJ fl fl IJ.11JJ J) IJ <i>ll </i>JJfl flIJJJ JJ11 IJ JJ JJ fl flIJJJIJ fl IJ<span class="s316"> </span><span class="s317">W</span></p></td></tr><tr style="height:147pt"><td style="width:52pt" bgcolor="#FBFCFB"><p class="s312" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">A-B-D-C:</p><p class="s312" style="padding-top: 2pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">A-C-B-D:</p><p class="s312" style="padding-top: 2pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">A-G-O-Bt</p><p class="s312" style="padding-top: 2pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">A-D-B-C:</p><p class="s312" style="padding-top: 2pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">A-D-C-B:</p><p class="s312" style="padding-top: 2pt;padding-left: 3pt;text-indent: 0pt;text-align: left;">B-A-C-D:</p><p class="s312" style="padding-top: 2pt;padding-left: 3pt;text-indent: 0pt;text-align: left;">B-A-D-C:</p><p class="s312" style="padding-top: 2pt;padding-left: 3pt;text-indent: 0pt;text-align: left;">B-C-A-D:</p><p class="s312" style="padding-top: 2pt;padding-left: 3pt;text-indent: 0pt;text-align: left;">B-C-D-A:</p><p class="s312" style="padding-top: 3pt;padding-left: 3pt;text-indent: 0pt;text-align: left;">B-D-A-Cl</p><p class="s312" style="padding-top: 1pt;padding-left: 3pt;text-indent: 0pt;text-align: left;">B-D-C-A:</p><p class="s312" style="padding-top: 2pt;padding-left: 3pt;text-indent: 0pt;text-align: left;">C-A-B-D:</p><p class="s312" style="padding-top: 2pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">C-A-D-B:</p></td><td style="width:420pt"><p class="s318" style="padding-top: 1pt;padding-left: 9pt;text-indent: -5pt;line-height: 120%;text-align: justify;">1026  1<span class="s319">1 fl1!</span><span class="s320">    </span>l<span class="s319">l     fl I! fl fl11J! fl fl fl  fl fl fl flfl flfl fl fl  J</span><s>i</s><span class="s319">fl fl J!fl flfl fl flJ</span>i <span class="s319">11    fl fl fl11  flfl fl</span><span class="s320"><br/></span>977 <span style=" color: #1F0D64;">1</span><span class="s323">1 IJ</span><span style=" color: #1F0D64;">1</span><span class="s323">1</span><span class="s324">    </span>1<span class="s319">1</span><span class="s320">    </span><span style=" color: #1F0D64;">1</span><span class="s323">1</span><span class="s324"> </span>1<span class="s319">1 fl flflfl fl fl fl  fl fl fl flfl flfl fl fl  flfl fl flfl  flfl fl flfl  fl     fl fl flfl  11fl</span><span class="s320"><br/></span>993 <span style=" color: #1F0D64;">fl 1!I!     </span>I<span class="s319">J</span><span class="s320">    </span>1<span class="s319">1</span>1<span class="s319">111 flflfl 11 fl fl</span><span class="s320">  </span>1<span class="s319">111</span>1<span class="s319">1 flflfl11 fl fl</span><span class="s320">  </span>1.1<span class="s319">11</span>1<span class="s319">111fl     fl11 fl flfl 11    fl 1!</span></p><p class="s320" style="padding-left: 9pt;text-indent: 0pt;text-align: left;"><span class="s318">983  </span>IJ fl fl JJ   <i>II tl tl tlIIII11 tl tl   tl tl ll tl tl II11 </i>JI <i>tl IItl ll tl II  IIII </i>Jf JJ II <i>tl     ll tl tl II  II</i>II JJ <i>II tlII!l tl</i></p><p class="s318" style="padding-top: 2pt;padding-left: 9pt;text-indent: 0pt;text-align: left;">984  <span style=" color: #1F0D64;">l</span><span class="s323">l fl</span><span class="s324"> </span><span style=" color: #1F0D64;">1</span><span class="s324">1    </span><span class="s320">fl     fl </span><span class="s324">fl </span>1<span class="s320">1 fl11     </span><span class="s324">fl 11 fl </span><span class="s320">fl fl U </span>1<span class="s319">1</span>1<span class="s319">1fl </span><span class="s323">fl 11 fl</span><span class="s324"> </span><span class="s319">fl flfl</span><span class="s320"> </span>1<span class="s319">1</span>1<span class="s319">1  fl</span><span class="s323">flfl fl</span><span class="s324"> </span><span class="s319">flfl</span><span class="s320"> </span><span class="s323">11</span>1<span class="s319">1</span>1<span class="s319">1 fl </span><span class="s323">flflf</span><span class="s324">l</span></p><p class="s318" style="padding-top: 2pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">1028  <span class="s320">JJ JJ JJ JJ JJ JJ JJ IJJJ    IJ JJ JJ JJ JJ JJ JJ JJ JJ   IJ JJ JJ JJ JJJJ JJ JJ JJIJJJ JJ JJ JJ  JJ</span></p><p class="s320" style="padding-top: 1pt;padding-left: 9pt;text-indent: 0pt;text-align: left;"><span class="s318">986  </span>U11 ll    111111111111   jljl 1111)1111.1 ll11 Jill 1111111111111111111111fl<span class="s326">     </span>111111111111</p><p class="s318" style="padding-top: 2pt;padding-left: 4pt;text-indent: 0pt;line-height: 122%;text-align: left;">1033  <span class="s323">11</span>1<span class="s319">1</span>1!   1<span class="s319">1</span><span class="s320">    </span>1<span class="s319">1 !1</span><span class="s320"> </span>l<span class="s320">l </span>l<span class="s319">l11</span><span class="s320">     </span><span style=" color: #1F0D64;">l</span><span class="s323">l</span><span class="s324"> </span><span class="s319">fl</span><span class="s320"> </span><span style=" color: #1F0D64;">1</span><span class="s323">!</span><span class="s324"> </span><span class="s319">11</span>1<span class="s319">1</span>1<span class="s319">1</span><span class="s320"> </span>l<span class="s319">l 1111</span><span class="s320"> </span>l<span class="s320">l </span>l<span class="s320">l </span><span style=" color: #1F0D64;">1</span><span class="s323">!</span><span class="s324"> </span><span class="s319">11</span>1<span class="s319">1</span>1<span class="s319">1</span><span class="s320"> </span>l<span class="s319">l I!  ll</span><span style=" color: #1F0D64;">l</span><span class="s324">l</span>l<span class="s319">l</span><span class="s320"> </span><span class="s323">11</span><span class="s319">11</span>1<span class="s319">1</span><span class="s320">     </span>l<span class="s320">l<br/></span>1016 <span class="s325">ll </span><span class="s320">JI JJ JJ  JJJJ JJ JJJJ    JJ JJ JJ JJJJJJ JJ JJ JJ   JJJJ JJ JJ JJ    JJ JJ JJ JJ     JJ JJ</span></p><p class="s318" style="padding-left: 9pt;text-indent: 0pt;text-align: left;">957  <span class="s319">fl llI</span>I <span class="s319">fl    IJ</span>I<span class="s320">J .fl flfl IJ JJ fl flflIJ .fl flfl  11JJ fl fl fl     JJ .fl flfl  11 JJ fl flfl     IJ    JJ f</span></p><p class="s318" style="padding-top: 1pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">1022  <span class="s320">fl IJll    fl     11</span>l<span class="s320">l 1111l.i     JJ JJ 11 fl11JJ 1111.ll     JJJJ 1111 fl     JJ 1111</span>I<span class="s319">J IJ 11</span></p><p class="s318" style="padding-top: 2pt;padding-left: 9pt;text-indent: 0pt;text-align: left;">989  1<span class="s319">1</span>1<span class="s319">1</span>1<span class="s319">1</span><span class="s320">    </span>l<span class="s320">l    </span>1<span class="s319">1</span>1<span class="s319">1 JI 11fl    fl JI fl fl11fl JI 11fl  fl11 fl fl  11    fl 1111fl  fl 11 fl fl11  </span></p><p class="s318" style="padding-top: 1pt;padding-left: 9pt;text-indent: 0pt;text-align: left;">962  <span style=" color: #1F0D64;">l</span><span class="s324">l </span><span class="s320">&#39;IU &#39;I     flfl fl 11</span>l<span class="s320">l fl </span>l<span class="s320">l </span>l<span class="s319">l 11</span><s>l</s><span class="s319">l&#39;I 11 IJ</span><s>l</s><span class="s319">l  fl</span>I<span class="s319">J fl 11</span><span class="s320">  </span>l<span class="s319">l     fl U flfl  11 fl 11 Ufl     fl     fl IJ</span></p></td></tr><tr style="height:110pt"><td style="width:52pt" bgcolor="#FCFCFB"><p class="s312" style="padding-top: 1pt;padding-left: 3pt;text-indent: 0pt;text-align: left;">C-B-A-D:</p><p class="s312" style="padding-top: 2pt;padding-left: 3pt;text-indent: 0pt;text-align: left;">C-B-D-A:</p><p class="s312" style="padding-top: 2pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">C-D-A-B:</p><p class="s312" style="padding-top: 2pt;padding-left: 3pt;text-indent: 0pt;text-align: left;">C-D-B-A:</p><p class="s312" style="padding-top: 2pt;padding-left: 3pt;text-indent: 0pt;text-align: left;">D-A-B-C:</p><p class="s312" style="padding-top: 2pt;padding-left: 3pt;text-indent: 0pt;text-align: left;">D-A-C-B:</p><p class="s312" style="padding-top: 2pt;padding-left: 3pt;text-indent: 0pt;text-align: left;">D-B-A-C:</p><p class="s312" style="padding-top: 2pt;padding-left: 3pt;text-indent: 0pt;text-align: left;">D-B-C-A:</p><p class="s312" style="padding-top: 2pt;padding-left: 3pt;text-indent: 0pt;text-align: left;">D-C-A-B:</p><p class="s312" style="padding-top: 2pt;padding-left: 3pt;text-indent: 0pt;line-height: 7pt;text-align: left;">D-C-B-A:</p></td><td style="width:420pt"><p class="s320" style="text-indent: 0pt;text-align: right;"><span class="s318">993  </span><s>fl IJ</s> <span class="s322">I</span><span class="s323">&#39;J</span> <span class="s318">1</span><s>1 IJ</s> <span class="s318">I</span>&#39;J JJfl   flflfl fl fl IJ fl fl flflfl<span style=" color: #1F0D64;">fl</span>fl     flfl fl fl fl flfl flfl   fl     flfl fl fl fl fl <span style=" color: #1F0D64;">IJ </span>fl   flflfl</p><p class="s320" style="padding-top: 1pt;padding-left: 4pt;text-indent: 0pt;text-align: left;"><span class="s318">1028  I</span><s>J</s> <span class="s322">I</span><span class="s323">J</span> <span class="s322">I</span><span class="s323">J</span> <span class="s318">1</span><s>1</s> <span class="s318">I</span><s>J</s> <span class="s318">I</span>J flfl   II<span style=" color: #1F0D64;">IJ</span>JJ <span style=" color: #1F0D64;">fl </span>IJ fl fl U flflIJ<span style=" color: #1F0D64;">flfl    </span>flfl JJ IJ fl fl<span style=" color: #1F0D64;">fl </span>IJfl  fl     flIJ IJ fl fl fl <span style=" color: #1F0D64;">fl </span>fl   flflIJI</p><p class="s318" style="padding-top: 2pt;padding-left: 9pt;text-indent: 0pt;text-align: left;">955 <span class="s319">flIJJJ 11 JJJJJJJJJiJJJJJJJiIJJJJJJJllJJJJJJ 11 IJJJJJJJ 11 JJJJ 1J11 JJJJJJJJllJJJJJJ 11 IJJJJJfl 11</span></p><p class="s324" style="padding-top: 2pt;padding-right: 1pt;text-indent: 0pt;text-align: right;"><span class="s318">1004 </span><span class="s322">1</span>1 fl fl <span style=" color: #000;">11 </span>fl <span style=" color: #000;">fl flfl    fl</span>flfl fl <span style=" color: #000;">fl </span>fl <span style=" color: #000;">fl fl flfl</span>flflfl     <span style=" color: #000;">fl</span>fl <span style=" color: #000;">fl fl fl 11</span>fl flfl   <span style=" color: #000;">IJ    </span>fl<span style=" color: #000;">fl fl fl fl </span>fl fl fl    <span style=" color: #000;">JJ</span>fl<span style=" color: #000;">fl</span></p><p class="s318" style="padding-top: 2pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">1023  <span class="s319">fl U JJ 11Jl JJ 1111  flJJJJ 1111 JJ fl J.I flflIJ1111 JIU Jl 11 fl</span><span class="s320"> </span>l<span class="s319">lJJ IJJJ fl    1JJl JJ fl 11Jl U fl  11UJ</span></p><p class="s327" style="padding-top: 2pt;padding-left: 4pt;text-indent: 0pt;text-align: left;"><span class="s312">1051 </span>II ll IIII <span class="s319">JJ If II 11 II JJ II JJ </span>IIII IJ IJ II<span class="s319">II JJ II JJ II JJ </span>tl tl II tl tl U tl IIII tl II tl <span class="s319">IIIIII Jf </span>IIII tl tl tlII tl ll IIII<span class="s319">II</span></p><p class="s319" style="padding-top: 2pt;padding-left: 9pt;text-indent: 0pt;text-align: left;"><span class="s318">985</span><span style=" color: #1F0D64;">U U 11</span><span class="s324"> </span><span class="s318">l</span><span class="s320">l </span><span class="s322">l</span><span style=" color: #1F0D64;">l</span><span class="s324"> </span>11 Ufl fl<span style=" color: #1F0D64;">flIJ fl</span><span class="s324"> </span>fl<span class="s320"> </span><span class="s318">I</span>J U<span class="s318">I</span>J flfl<span style=" color: #1F0D64;">11</span><span class="s322">I</span><span style=" color: #1F0D64;">JIJ</span><span class="s324">   </span><span class="s318">1</span>1<span class="s322">1</span><span style=" color: #1F0D64;">1</span><span class="s324"> </span>U<span class="s320"> </span><span class="s318">I</span>J fl fl<span style=" color: #1F0D64;">IJ</span><span class="s324"> </span><span class="s322">I</span><span style=" color: #1F0D64;">JIJ</span><span class="s324"> </span><span class="s318">1</span>1<span class="s322">1</span><span style=" color: #1F0D64;">1</span>U<span class="s320"> </span><span class="s318">I</span>J fl fl<span class="s320"> </span><span style=" color: #1F0D64;">11</span><span class="s324"> </span><span class="s322">I</span><span style=" color: #1F0D64;">J IJ</span><span class="s324"> </span><span class="s318">1</span>1<span class="s322">1</span><span style=" color: #1F0D64;">1</span>U<span class="s318">I</span>J<span class="s320"> </span><span class="s318">1</span>111<span class="s322">SS</span></p><p class="s318" style="padding-top: 2pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">1020<span class="s320">11 JJ fl 11 IJ 1J JJfl   fl11fl fl Jl 11 flfl flflfl11fl    Jl    fl fl fl fl flfl 11JJ   JI    11fl JJ fl fl fl JJ</span></p><p class="s320" style="padding-top: 2pt;padding-left: 9pt;text-indent: 0pt;text-align: left;"><span class="s318">990</span>IJ <span style=" color: #1F0D64;">fl fl </span>fl 11 fl flfl flflfl JJ fl fl flfl flflflflfl     fl     fl fl JJ fl flfl flJJ   fl     flfl fl JJ fl fl fl fl   fl</p><p class="s323" style="padding-top: 1pt;padding-left: 4pt;text-indent: 0pt;line-height: 8pt;text-align: left;"><span class="s318">1012</span><span class="s322">I</span>J<span class="s324"> </span><span class="s322">I</span>J<span class="s324"> </span><span class="s322">1</span>1<span class="s324"> </span><span class="s318">l</span><span style=" color: #000;">l U U</span><span class="s320"> </span><span class="s318">I</span><span style=" color: #000;">JIJ    11</span><span class="s322">1</span>1<span class="s322">I</span>J<span class="s324"> </span><span class="s322">1</span>1<span class="s324"> </span><span style=" color: #000;">fl U IJU IJ11IJ</span><span class="s318">I</span><span style=" color: #000;">J</span>IJ<span class="s324">  </span><span class="s318">l</span><span class="s320">l     U U U IJ 11</span><span class="s324">IJ </span><span class="s318">I</span><span style=" color: #000;">J</span>U<span class="s324">  </span><span class="s318">l</span><span style=" color: #000;">l     UU IJ</span><span class="s320"> </span><span class="s318">l</span><span style=" color: #000;">l 11</span><span class="s320"> </span>U<span class="s324"> </span><span style=" color: #000;">U</span></p></td></tr></table><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="padding-top: 2pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">I tested the Fisher-Yates algorithm by shuffling a four-letter (A to D) array 24,000 times, and got this:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 124pt;text-indent: 0pt;line-height: 1pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 124pt;text-indent: 0pt;line-height: 1pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s328" style="padding-left: 155pt;text-indent: 0pt;line-height: 1pt;text-align: left;">		 			</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s328" style="padding-left: 172pt;text-indent: 0pt;line-height: 1pt;text-align: left;">		 	</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s328" style="padding-left: 155pt;text-indent: 0pt;line-height: 1pt;text-align: left;"> 			</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s328" style="padding-left: 155pt;text-indent: 0pt;line-height: 1pt;text-align: left;">		 </p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s328" style="padding-left: 155pt;text-indent: 0pt;line-height: 1pt;text-align: left;">				</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s328" style="padding-left: 215pt;text-indent: 0pt;line-height: 1pt;text-align: left;">	 	 	</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s328" style="padding-left: 155pt;text-indent: 0pt;line-height: 1pt;text-align: left;">		 			</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s328" style="padding-left: 162pt;text-indent: 0pt;line-height: 1pt;text-align: left;">	 </p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;">All 24 possible orderings were produced (see the <i>Recursion </i>section in <i>Chapter 1, Becoming Functional),</i><span>and the results were all pretty close to 1,000; the difference between the highest and lowest counts is<br/>only around 10%. This is not a thorough statistical confirmation - for that, wed have to apply statistical<br/>frequency tests such as (Chi-squared), Kolmogorov-Smirnov, or Anderson-Darling - but at least<br/>we  get a notion that shuffling is not working very badly.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">When I applied the (supposedly good!) algorithm, the counts were more lopsided:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p class="s164" style="padding-top: 4pt;padding-left: 266pt;text-indent: 0pt;text-align: left;">Chapter 4, Behaving Properly - Pure Functions     513</p><p style="text-indent: 0pt;text-align: left;"><br/></p><table style="border-collapse:collapse;margin-left:41.98pt" cellspacing="0"><tr style="height:9pt"><td style="width:89pt" bgcolor="#FCFCFC"><p class="s312" style="padding-left: 45pt;text-indent: 0pt;line-height: 8pt;text-align: left;">A-B-C-D:</p></td><td style="width:382pt;border-top-style:solid;border-top-width:1pt" colspan="2"><p class="s329" style="padding-left: 4pt;text-indent: 0pt;line-height: 8pt;text-align: left;">1B86 <span class="s330">l.</span>l <span class="s331">fl II fl 0</span>1.1 <span class="s331">fl fl 1</span><span class="s330">.</span>1 <span class="s330">fl </span>1<span class="s330">1 </span>1<span class="s331">1 fl fl 1</span><span class="s330">.</span>1<span class="s331">1.1</span><span class="s330"> </span>l<span class="s330">.l </span>1<span class="s330">1 </span>I<span class="s330">I</span>1<span class="s331">1l</span><span class="s330">l</span>I<span class="s330">I</span>I<span class="s331">Il</span><span class="s330">l </span>l<span class="s330">l </span>l<span class="s332"> </span><span class="s330">l </span><span class="s331">lll</span><span class="s330">l </span>l<span class="s330">l </span>1.11,1 l.l <span class="s331">lll</span><span class="s330">l</span>I<span class="s330">I</span>l<span class="s330">l </span>1.11<span class="s331">) U</span><span class="s330"> </span>1.1 I<span class="s330">I </span>1.1 <span class="s331">U</span><span class="s330"> </span>l<span class="s331">.l</span><span class="s330"> </span><span class="s333">U U</span><span class="s334"> </span>l.l <span class="s331">U</span><span class="s330"> </span>1.1 ll</p></td></tr><tr style="height:21pt"><td style="width:89pt" bgcolor="#FCFCFC"><p class="s312" style="padding-left: 45pt;text-indent: 0pt;text-align: left;">A-B-D-C:</p><p class="s312" style="padding-top: 1pt;padding-left: 45pt;text-indent: 0pt;line-height: 8pt;text-align: left;">A-C-B-D:</p></td><td style="width:310pt;border-top-style:solid;border-top-width:1pt"><p class="s331" style="padding-left: 9pt;text-indent: 0pt;text-align: left;"><span class="s329">671 </span>fl IJ IJ fl IJ II fl JI<span class="s330"> </span><span style=" color: #000;">IJ</span><span class="s334"> </span>fl fl II fl II fl f<span class="s329">l </span>JI J<span class="s330">I</span></p><p class="s329" style="padding-left: 9pt;text-indent: 0pt;text-align: left;">165 ft###</p></td><td style="width:72pt" rowspan="4"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:30pt"><td style="width:89pt" bgcolor="#FCFDFC"><p class="s312" style="padding-left: 45pt;text-indent: 0pt;text-align: left;">A-C-D-B:</p><p class="s312" style="padding-left: 45pt;text-indent: 0pt;text-align: left;">A-D-B-C:</p><p class="s312" style="padding-top: 1pt;padding-left: 45pt;text-indent: 0pt;line-height: 8pt;text-align: left;">A-D-C-B:</p></td><td style="width:310pt;border-bottom-style:solid;border-bottom-width:1pt"><p class="s329" style="padding-left: 9pt;text-indent: 0pt;text-align: left;">150 ####</p><p class="s331" style="padding-left: 9pt;text-indent: 0pt;text-align: left;"><span class="s329">627 </span>fl JI IJ.IIJ<span class="s330">I </span><span class="s329">I</span><span class="s330">I</span><span class="s329">I</span><span class="s330">I</span><span class="s332"> </span>J<span class="s330">I </span><span class="s329">I</span>J JI J<span class="s335">l</span>UJlJl .<span class="s335">l</span>l II<span class="s330"> </span><span style=" color: #000;">J</span><span class="s334">I</span></p><p class="s329" style="padding-top: 1pt;padding-left: 9pt;text-indent: 0pt;line-height: 8pt;text-align: left;">169 «##</p></td></tr><tr style="height:89pt"><td style="width:89pt" bgcolor="#FCFDFC"><p class="s312" style="padding-left: 46pt;text-indent: 0pt;text-align: left;">B-A-C-D:</p><p class="s312" style="padding-top: 1pt;padding-left: 46pt;text-indent: 0pt;text-align: left;">B-A-D-C:</p><p class="s312" style="padding-left: 46pt;text-indent: 0pt;text-align: left;">B-C-A-D:</p><p class="s312" style="padding-top: 1pt;padding-left: 46pt;text-indent: 0pt;text-align: left;">B-C-D-A:</p><p class="s312" style="padding-top: 1pt;padding-left: 46pt;text-indent: 0pt;text-align: left;">B-D-A-C:</p><p class="s312" style="padding-top: 1pt;padding-left: 46pt;text-indent: 0pt;text-align: left;">B-D-C-A:</p><p class="s312" style="padding-left: 46pt;text-indent: 0pt;text-align: left;">C-A-B-D:</p><p class="s312" style="padding-top: 1pt;padding-left: 46pt;text-indent: 0pt;text-align: left;">C-A-D-B:</p><p class="s312" style="padding-top: 1pt;padding-left: 46pt;text-indent: 0pt;line-height: 8pt;text-align: left;">C-B-A-D:</p></td><td style="width:310pt;border-top-style:solid;border-top-width:1pt;border-bottom-style:solid;border-bottom-width:1pt"><p class="s312" style="padding-left: 9pt;text-indent: 0pt;text-align: left;">306 1<span class="s333">1JJ Jj JI J! IJ ll 11</span></p><p class="s334" style="padding-top: 1pt;padding-left: 9pt;text-indent: 0pt;text-align: left;"><span class="s312">320 </span><s>UI!</s> <span class="s312">I</span>I<span class="s336"> </span><s>l</s>.<span class="s312">l </span><s>IIIIIII</s>I</p><p class="s312" style="padding-left: 9pt;text-indent: 0pt;text-align: left;">162 re##</p><p class="s312" style="padding-top: 1pt;padding-left: 9pt;text-indent: 0pt;text-align: left;">157 WW</p><p class="s312" style="padding-left: 9pt;text-indent: 0pt;text-align: left;">311 <span class="s333">fl fl fl ll f!</span><span class="s334"> </span>I<span class="s333">J fl f</span><span class="s334">l</span></p><p class="s312" style="padding-top: 1pt;padding-left: 9pt;text-indent: 0pt;text-align: left;">149 ####</p><p class="s312" style="padding-left: 9pt;text-indent: 0pt;text-align: left;">162 ####</p><p class="s312" style="padding-top: 1pt;padding-left: 9pt;text-indent: 0pt;text-align: left;">132 re#</p><p class="s333" style="padding-top: 1pt;padding-left: 9pt;text-indent: 0pt;line-height: 8pt;text-align: left;"><span class="s312">429 </span>fljJlJ.<span class="s337">i</span>JjliJlJ<span class="s334">j</span><span class="s312">ll.ire</span></p></td></tr><tr style="height:69pt"><td style="width:89pt" bgcolor="#FCFDFC"><p class="s312" style="padding-left: 46pt;text-indent: 0pt;text-align: left;">C-B-D-A:</p><p class="s312" style="padding-left: 46pt;text-indent: 0pt;text-align: left;">C-D-A-B:</p><p class="s312" style="padding-top: 1pt;padding-left: 46pt;text-indent: 0pt;text-align: left;">C-D-B-A:</p><p class="s312" style="padding-top: 1pt;padding-left: 46pt;text-indent: 0pt;text-align: left;">D-A-B-C:</p><p class="s312" style="padding-top: 1pt;padding-left: 45pt;text-indent: 0pt;text-align: left;">D-A-C-B:</p><p class="s312" style="padding-top: 1pt;padding-left: 46pt;text-indent: 0pt;text-align: left;">D-B-A-C:</p><p class="s312" style="padding-top: 1pt;padding-left: 46pt;text-indent: 0pt;line-height: 8pt;text-align: left;">D-B-C-A:</p></td><td style="width:310pt;border-top-style:solid;border-top-width:1pt"><p class="s333" style="padding-left: 9pt;text-indent: 0pt;text-align: left;"><span class="s312">452 </span>U<span class="s334">.</span><span class="s312">II I</span>J<span class="s337">I</span>J I!<span class="s334"> </span><span class="s338">I</span><span class="s339">I </span>IJJJ<span class="s334"> </span><span class="s338">l</span><span style=" color: #1F0D64;">ire#</span></p><p class="s312" style="padding-left: 9pt;text-indent: 0pt;text-align: left;">156 rew</p><p class="s333" style="padding-top: 1pt;padding-left: 9pt;text-indent: 0pt;text-align: left;"><span class="s338">474 </span>fj J! 1!<span class="s334"> </span><span style=" color: #1F0D64;">1J Jl 1!</span><span class="s339"> </span>1J jJUrere</p><p class="s340" style="padding-top: 1pt;padding-left: 9pt;text-indent: 0pt;text-align: left;"><span class="s312">653 </span>fJ fJ<span class="s339"> </span><span style=" color: #000;">IJ</span><span class="s334"> </span><span class="s341">f</span><span class="s342">l </span>fl IJ f<span class="s338">l </span><span style=" color: #000;">Jl</span><span class="s334"> </span>U<span class="s339"> </span><span class="s342">I</span><span style=" color: #3A2888;">J IJ</span><span class="s341"> </span>IJ IJ<span class="s339"> </span><span style=" color: #000;">JJ</span><span class="s334"> </span>U IJ<span class="s339"> </span><span style=" color: #000;">IJ</span></p><p class="s312" style="padding-top: 1pt;padding-left: 9pt;text-indent: 0pt;text-align: left;">161 re##</p><p class="s334" style="padding-left: 9pt;text-indent: 0pt;text-align: left;"><span class="s338">338 </span><s>11 JJ IJ JJ J! JJ IJ JJ</s> <span class="s312">I</span>J</p><p class="s312" style="padding-top: 1pt;padding-left: 9pt;text-indent: 0pt;line-height: 8pt;text-align: left;">152 rere</p></td></tr><tr style="height:19pt"><td style="width:89pt" bgcolor="#FCFDFC"><p class="s312" style="padding-left: 46pt;text-indent: 0pt;text-align: left;">D-C-A-B:</p><p class="s312" style="padding-top: 1pt;padding-left: 46pt;text-indent: 0pt;line-height: 7pt;text-align: left;">D-C-B-A:</p></td><td style="width:338pt;border-bottom-style:solid;border-bottom-width:1pt" colspan="2"><p class="s329" style="padding-left: 9pt;text-indent: 0pt;text-align: left;">141 re##</p><p class="s329" style="padding-top: 1pt;padding-left: 4pt;text-indent: 0pt;line-height: 7pt;text-align: left;">1677 <span class="s330">l.</span>l I<span class="s331">! IJ 11 fl .</span><s>I</s><span class="s331">J</span><span class="s330"> </span>I<span class="s331">J 11 i</span><span class="s330">,</span>l I<span class="s330">J </span>l<span class="s330">l </span>I<span class="s331">J l</span><span class="s330">l </span>I<span class="s330">J </span>I<span class="s330">J </span>I<span class="s330">J </span>l<span class="s330">l </span>I<span class="s330">J </span>I<span class="s331">J ll U l</span><span class="s330">l </span>l<span class="s330">l </span>I<span class="s330">J </span>l<span class="s330">l ll </span>I<span class="s330">J </span>I<span class="s330">J </span>l<span class="s330">l </span>I<span class="s331">J IJ</span><span class="s330"> </span>I<span class="s331">J IJ U</span><span class="s330"> </span>l<span class="s330">l </span>1<span class="s331">1 IJ</span><span class="s330"> </span>l<span class="s330">l </span>I<span class="s330">J </span>I<span class="s330">J </span>I<span class="s330">J </span>I<span class="s331">J IJ IJ</span></p></td><td style="width:44pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr></table><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"/><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>The highest count is more than 14 times the lowest; we can definitely conclude that not all arrangements<br/>are equally likely, so the popular shuffling algorithm is simply not good enough.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="4.15"><p class="s10" style="padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: left;">Shuffling by sorting: <span class="p">To get a random sequence, we can assign to each array element a random<br/>number and sort by that number; the result will be a totally random shuffling:</span></p></li></ol></ol><table style="border-collapse:collapse" cellspacing="0"><tr style="height:56pt"><td style="width:90pt" bgcolor="#F4F4F4"><p class="s19" style="padding-left: 22pt;text-indent: 0pt;line-height: 10pt;text-align: left;">arr</p><p class="s19" style="padding-top: 2pt;padding-left: 36pt;text-indent: 0pt;text-align: left;">.map((v) :</p><p class="s19" style="padding-top: 2pt;padding-left: 36pt;text-indent: 0pt;text-align: left;">.sort((a,</p><p class="s19" style="padding-top: 2pt;padding-left: 36pt;text-indent: 0pt;line-height: 12pt;text-align: left;">.map((o) :</p></td><td style="width:309pt" bgcolor="#F3F3F3"><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s19" style="text-indent: 0pt;text-align: left;">=&gt; ({ val: v, key: Math.random() }))</p><p class="s19" style="padding-top: 2pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">b) =&gt; a.key - b.key)</p><p class="s19" style="padding-top: 2pt;text-indent: 0pt;line-height: 13pt;text-align: left;">=&gt; o.val);</p></td></tr></table><p style="text-indent: 0pt;text-align: left;"/><p class="s17" style="padding-top: 8pt;padding-left: 52pt;text-indent: 0pt;line-height: 235%;text-align: left;"><span>// question_04_shuffling_by_sorting.ts<br/>const sortingShuffle = &lt;T&gt;(arr: T[]): T[] =&gt;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: left;"><span>The first . map () transforms each array element into an object, with the original value at val and a<br/>random value at </span><span class="s245">key. </span>We then sort the array by the <span class="s245">key </span>value, using the technique shown in <i>Question</i></p><p class="s9" style="padding-top: 1pt;padding-left: 43pt;text-indent: 0pt;text-align: left;">3.8. <span class="p">Finally, we undo the first mapping to get just the original values.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>A final comment: this code is truly functional, and returns a new array instead of modifying the<br/>original argument in place.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 21pt;text-indent: 0pt;text-align: left;">514  Answers to Questions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;text-align: left;"><a name="bookmark528">Chapter 5,  Programming Declaratively - A Better Style</a></p><ol id="l185"><ol id="l186"><li data-list-text="5.1"><p class="s10" style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;">Generating HTML code, with restrictions: <span class="p">In real life, you wouldn’t limit yourself to using only<br/>filter (), map (), and reduce (), but the objective of this question was to make you think<br/>about how to manage with only those. Using j oin () or other extra string functions would make the<br/>problem easier. For instance, finding out a way to add the enclosing &lt;divxul &gt; ... &lt;/ul&gt;&lt;/<br/>div&gt; tags is tricky, so we had to make the first reduce () operation produce an array so that we<br/>could keep on working on it:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">const characters = [</p><p class="s17" style="padding-top: 2pt;padding-left: 75pt;text-indent: 0pt;text-align: left;">{ name: &quot;Fred&quot;, plays: &quot;bowling&quot; },</p><p class="s17" style="padding-top: 2pt;padding-left: 75pt;text-indent: 0pt;text-align: left;">{ name: &quot;Barney&quot;, plays: &quot;chess&quot; },</p><p class="s17" style="padding-top: 2pt;padding-left: 75pt;text-indent: 0pt;text-align: left;">{ name: &quot;Wilma&quot;, plays: &quot;bridge&quot; },</p><p class="s17" style="padding-top: 2pt;padding-left: 75pt;text-indent: 0pt;text-align: left;">{ name: &quot;Betty&quot;, plays: &quot;checkers&quot; },</p><p class="s17" style="padding-top: 2pt;padding-left: 75pt;text-indent: 0pt;text-align: left;">{ name: &quot;Pebbles&quot;, plays: &quot;chess&quot; },</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 61pt;text-indent: 0pt;text-align: left;">const list = characters</p><p class="s17" style="padding-top: 2pt;padding-left: 75pt;text-indent: 0pt;text-align: left;">.filter(</p><p class="s17" style="padding-top: 2pt;padding-left: 88pt;text-indent: 0pt;text-align: left;">(x) =&gt; x.plays === &quot;chess&quot; || x.plays == &quot;checkers&quot;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 75pt;text-indent: 0pt;text-align: left;">.map((x) = &gt; &#39;&lt;li&gt;${x.name} &lt; /1 i &gt; &#39;)</p><p class="s17" style="padding-top: 2pt;padding-left: 75pt;text-indent: 0pt;text-align: left;">.reduce((a, x) =&gt; [a[0] + x], [&quot;&quot;])</p><p class="s17" style="padding-top: 1pt;padding-left: 75pt;text-indent: 0pt;text-align: left;">.map((x) =&gt; &#39; &lt;divxul&gt;$ {x} &lt;/ulx/div&gt; &#39; )</p><p class="s17" style="padding-top: 2pt;padding-left: 75pt;text-indent: 0pt;text-align: left;">.reduce((a, x) =&gt; x);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 61pt;text-indent: 0pt;text-align: left;">console.log(list);</p><p class="s17" style="padding-top: 2pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">/* Output is a single line; here output is wrapped</p><p class="s10" style="padding-top: 3pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">&lt;divxulxli&gt;Barney&lt;/lixli&gt;Betty&lt;/lixli&gt;Pebbles&lt;/li&gt;</p><p class="s10" style="padding-top: 4pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">&lt;/ulx/div&gt;</p><p class="s17" style="padding-top: 3pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">*/</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>Accessing the array and index arguments for the map () or reduce () callbacks would also<br/>provide solutions:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">const list2 = characters</p><p class="s17" style="padding-top: 2pt;padding-left: 75pt;text-indent: 0pt;text-align: left;">.filter(</p><p class="s17" style="padding-top: 2pt;padding-left: 88pt;text-indent: 0pt;text-align: left;">(x) =&gt; x.plays === &quot;chess&quot; || x.plays == &quot;checkers&quot;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 238pt;text-indent: 0pt;text-align: left;">Chapter 5, Programming Declaratively - A Better Style      515</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 66pt;text-indent: 0pt;text-align: left;">. map (</p><p class="s17" style="padding-top: 2pt;padding-left: 78pt;text-indent: 0pt;text-align: left;">(x, i, t) =&gt;</p><p class="s17" style="padding-top: 1pt;padding-left: 89pt;text-indent: 0pt;line-height: 119%;text-align: left;"><span>&#39;${i = = = 0 ? &quot;&lt;divxul&gt;&quot; :         +<br/>&#39;&lt;1i &gt; ${x.name}&lt;/1i &gt;&#39; +</span></p><p class="s17" style="padding-left: 89pt;text-indent: 0pt;line-height: 13pt;text-align: left;">&#39;${i == t.length - 1 ? &quot;&lt;/ulx/div&gt;</p><p class="s17" style="padding-top: 3pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">)</p><p class="s17" style="padding-top: 1pt;padding-left: 66pt;text-indent: 0pt;text-align: left;">.reduce((a, x) =&gt; a + x,</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// exact same result</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: left;">We could also do the following:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 53pt;text-indent: 0pt;text-align: left;">const list3 = characters</p><p class="s17" style="padding-top: 2pt;padding-left: 66pt;text-indent: 0pt;text-align: left;">. filter(</p><p class="s17" style="padding-top: 2pt;padding-left: 78pt;text-indent: 0pt;text-align: left;">(x) =&gt; x.plays === &quot;chess&quot; || x.plays == &quot;checkers&quot;</p><p class="s17" style="padding-top: 2pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">)</p><p class="s17" style="padding-top: 1pt;padding-left: 66pt;text-indent: 0pt;text-align: left;">.map((x) = &gt; &#39;&lt;1i &gt; ${x.name}&lt;/1i&gt;&#39;)</p><p class="s17" style="padding-top: 2pt;padding-left: 66pt;text-indent: 0pt;text-align: left;">.reduce(</p><p class="s17" style="padding-top: 2pt;padding-left: 78pt;text-indent: 0pt;text-align: left;">(a, x, i, t) =&gt;</p><p class="s17" style="padding-top: 2pt;padding-left: 77pt;text-indent: 11pt;line-height: 117%;text-align: left;"><span>a + x + (i = = = t.length - 1 ? &quot;&lt;/ulx/div&gt;&quot; :<br/>&quot;&lt;divxul&gt;&quot;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 53pt;text-indent: 0pt;text-align: left;">// again, the same result</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>Study the three examples: they will help you gain insight into these higher-order functions and provide<br/>you with ideas so that you can do independent work.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="5.2"><p style="padding-left: 43pt;text-indent: 0pt;line-height: 126%;text-align: left;"><b>More formal testing: </b>Use an idea from <i>Question 4.13; </i><span>select an array and a function, find the result<br/>of mapping using both the standard map () method and the new myMap () function, but instead of</span></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>using JSON. stringify (), use Jests toEqual () method to compare the results. See the answer<br/>to </span><i>Question 5.5 </i>for more.</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="5.3"><p class="s10" style="padding-left: 43pt;text-indent: 0pt;line-height: 114%;text-align: left;">Reverse by summing: <span class="p">This works, but we need to define an overloaded sum () function so<br/>TypeScript won’t object. Overloading isn’t available for arrow functions, so we have to change how<br/>we define </span><span class="s245">sum ():</span></p><p class="s17" style="padding-top: 8pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">function sum(x: number, y: number): number;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 21pt;text-indent: 0pt;text-align: left;">516  Answers to Questions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 62pt;text-indent: 0pt;line-height: 117%;text-align: left;"><span>function sum(x: string, y: string): string;<br/>function sum(x: any, y: any): string | number {</span></p><p class="s17" style="padding-left: 73pt;text-indent: 0pt;text-align: left;">return x + y;</p><p class="s17" style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">}</p><p style="padding-top: 10pt;text-indent: 0pt;text-align: right;">Now reverseString2 () works and summing an array of numbers also works:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 74pt;text-indent: -12pt;line-height: 120%;text-align: left;"><span>const reverseString2 = (str: string): string =&gt;<br/>str.split(&quot;&quot;) .reduceRight</span><span class="s10">(sum, &quot;&quot;) ;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 61pt;text-indent: 0pt;text-align: left;">console.log(reverseString2(&quot;MONTEVIDEO&quot;));</p><p class="s17" style="padding-top: 2pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">// OEDIVETNOM</p><p class="s17" style="padding-left: 61pt;text-indent: 0pt;line-height: 30pt;text-align: left;"><span>const myArray = [22, 9, 60, 12, 4, 56];<br/>console.log(myArray.reduce(</span><span class="s10">sum, </span>0) ) ;</p><p class="s17" style="padding-top: 2pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">// 163</p><p style="padding-top: 9pt;padding-left: 52pt;text-indent: 0pt;line-height: 114%;text-align: left;">If you try to do something as <span class="s245">sum (22 , &quot;X&quot;) </span>or <span class="s245">sum </span><span>(false, {a: 1}), TypeScript will reject it<br/>because it won’t match the defined overloads:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 61pt;text-indent: 0pt;text-align: left;">describe(&quot;myMap&quot;, () =&gt; {</p><p class="s17" style="padding-top: 2pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">const myArray = [22, 9, 60, 12, 4, 56] ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 74pt;text-indent: 0pt;text-align: left;">it(&quot;duplicates values&quot;, () =&gt; {</p><p class="s17" style="padding-top: 2pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">const dup = (x: number): number =&gt; 2 * x;</p><p class="s10" style="padding-top: 4pt;text-indent: 0pt;text-align: right;">expect(myArray.map(dup)).toEqual(myMap(myArray, dup));</p><p class="s17" style="padding-top: 4pt;padding-left: 75pt;text-indent: 0pt;text-align: left;">});</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 74pt;text-indent: 0pt;text-align: left;">it(&quot;add dashes&quot;, () =&gt; {</p><p class="s17" style="padding-top: 2pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">const addDashes = (x: number): string =&gt; &#39;-${x}-&#39;;</p><p class="s10" style="padding-top: 4pt;padding-left: 96pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>expect(myArray.map(addDashes)).toEqual(<br/>myMap(myArray, addDashes)</span></p><p class="s10" style="padding-left: 86pt;text-indent: 0pt;text-align: left;">) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 238pt;text-indent: 0pt;text-align: left;">Chapter 5, Programming Declaratively - A Better Style      517</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="5.4"><p class="s10" style="padding-left: 61pt;text-indent: -18pt;text-align: left;">Reversed reverse? <span class="p">In this case, it would return the same input string as the output; check it out!</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="5.5"><p class="s10" style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;">Ranging far and wide: <span class="p">This requires a bit of careful arithmetic, but shouldn’t be much trouble.<br/>Here, we need to distinguish two cases: upward and downward ranges. The default step is 1 for the<br/>former and -1 for the latter. We used Math.sign() for this:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 65pt;text-indent: -12pt;line-height: 117%;text-align: left;"><span>const range2 = (<br/>from: number,<br/>to: number,</span></p><p class="s17" style="padding-left: 65pt;text-indent: 0pt;text-align: left;">step = Math.sign(to - from)</p><p class="s17" style="padding-top: 2pt;padding-left: 64pt;text-indent: -11pt;line-height: 118%;text-align: left;"><span>) : number [] =&gt; {<br/>const arr = [] ;<br/>do {</span></p><p class="s17" style="padding-left: 77pt;text-indent: 0pt;line-height: 118%;text-align: left;"><span>arr.push(from);<br/>from += step;</span></p><p class="s17" style="padding-left: 65pt;text-indent: 0pt;line-height: 13pt;text-align: left;">} while (</p><p class="s17" style="padding-top: 1pt;padding-left: 78pt;text-indent: 0pt;line-height: 118%;text-align: left;"><span>(step &gt; 0 &amp;&amp; to &gt; from)<br/>(step &lt; 0 &amp;&amp; to &lt; from)</span></p><p class="s17" style="padding-left: 65pt;text-indent: 0pt;text-align: left;">) ;</p><p class="s17" style="padding-top: 1pt;padding-left: 64pt;text-indent: 0pt;text-align: left;">return arr;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 44pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>A different implementation starts by calculating how big an array is needed and then filling it using<br/>fill () and map (). We must be careful if start and stop are equal to avoid a division by zero:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 65pt;text-indent: -12pt;line-height: 117%;text-align: left;"><span>const range2b = (<br/>start: number,<br/>stop: number,</span></p><p class="s17" style="padding-left: 65pt;text-indent: 0pt;text-align: left;">step: number = Math.sign(stop - start)</p><p class="s17" style="padding-top: 1pt;padding-left: 64pt;text-indent: -10pt;line-height: 118%;text-align: left;"><span>) : number [] = &gt;<br/>new Array(</span></p><p class="s17" style="padding-left: 77pt;text-indent: 0pt;line-height: 13pt;text-align: left;">step === 0 ? 1 : Math.ceil((stop - start) / step)</p><p class="s17" style="padding-top: 3pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">)</p><p class="s17" style="padding-top: 1pt;padding-left: 78pt;text-indent: 0pt;text-align: left;">.fill (0)</p><p class="s17" style="padding-top: 2pt;padding-left: 78pt;text-indent: 0pt;text-align: left;">.map((v, i) =&gt; start + i * step);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 21pt;text-indent: 0pt;text-align: left;">518  Answers to Questions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">A few examples of calculated ranges show the diversity in terms of the options we have:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><table style="border-collapse:collapse;margin-left:59.38pt" cellspacing="0"><tr style="height:15pt"><td style="width:56pt"><p class="s19" style="padding-left: 1pt;padding-right: 8pt;text-indent: 0pt;line-height: 12pt;text-align: center;">range2 (1,</p></td><td style="width:66pt"><p class="s19" style="padding-left: 6pt;text-indent: 0pt;line-height: 12pt;text-align: left;">10) ;</p></td><td style="width:26pt"><p class="s344" style="padding-right: 7pt;text-indent: 0pt;line-height: 12pt;text-align: right;">//</p></td><td style="width:27pt"><p class="s19" style="padding-left: 6pt;text-indent: 0pt;line-height: 12pt;text-align: left;">[1,</p></td><td style="width:48pt"><p class="s19" style="padding-left: 1pt;text-indent: 0pt;line-height: 12pt;text-align: left;">2 , 3 , 4 ,</p></td><td style="width:32pt"><p class="s19" style="padding-left: 7pt;text-indent: 0pt;line-height: 12pt;text-align: left;">5,</p></td><td style="width:43pt"><p class="s19" style="padding-right: 4pt;text-indent: 0pt;line-height: 12pt;text-align: right;">6, 7, 8,</p></td><td style="width:22pt"><p class="s19" style="padding-left: 3pt;text-indent: 0pt;text-align: left;">9]</p></td></tr><tr style="height:15pt"><td style="width:56pt"><p class="s19" style="padding-left: 1pt;padding-right: 10pt;text-indent: 0pt;text-align: center;">range2(1,</p></td><td style="width:66pt"><p class="s19" style="padding-left: 6pt;text-indent: 0pt;text-align: left;">10, 2) ;</p></td><td style="width:26pt"><p class="s344" style="padding-top: 1pt;padding-right: 7pt;text-indent: 0pt;line-height: 12pt;text-align: right;">//</p></td><td style="width:27pt"><p class="s19" style="padding-top: 1pt;padding-left: 6pt;text-indent: 0pt;line-height: 13pt;text-align: left;">[1,</p></td><td style="width:48pt"><p class="s19" style="padding-left: 1pt;text-indent: 0pt;text-align: left;">3, 5, 7,</p></td><td style="width:32pt"><p class="s19" style="padding-left: 7pt;text-indent: 0pt;text-align: left;">9]</p></td><td style="width:43pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:22pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:15pt"><td style="width:56pt"><p class="s19" style="padding-left: 1pt;padding-right: 10pt;text-indent: 0pt;text-align: center;">range2(1,</p></td><td style="width:66pt"><p class="s19" style="padding-left: 6pt;text-indent: 0pt;text-align: left;">10, 3) ;</p></td><td style="width:26pt"><p class="s344" style="padding-top: 1pt;padding-right: 7pt;text-indent: 0pt;line-height: 12pt;text-align: right;">//</p></td><td style="width:27pt"><p class="s19" style="padding-top: 1pt;padding-left: 6pt;text-indent: 0pt;line-height: 12pt;text-align: left;">[1,</p></td><td style="width:48pt"><p class="s19" style="padding-left: 1pt;text-indent: 0pt;text-align: left;">4, 7]</p></td><td style="width:32pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:43pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:22pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:15pt"><td style="width:56pt"><p class="s19" style="padding-left: 1pt;padding-right: 10pt;text-indent: 0pt;text-align: center;">range2(1,</p></td><td style="width:66pt"><p class="s19" style="padding-left: 6pt;text-indent: 0pt;text-align: left;">10, 6) ;</p></td><td style="width:26pt"><p class="s344" style="padding-top: 1pt;padding-right: 7pt;text-indent: 0pt;line-height: 12pt;text-align: right;">//</p></td><td style="width:27pt"><p class="s19" style="padding-top: 1pt;padding-left: 6pt;text-indent: 0pt;line-height: 12pt;text-align: left;">[1,</p></td><td style="width:48pt"><p class="s19" style="padding-left: 1pt;text-indent: 0pt;text-align: left;">7]</p></td><td style="width:32pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:43pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:22pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:15pt"><td style="width:56pt"><p class="s19" style="padding-left: 1pt;padding-right: 10pt;text-indent: 0pt;text-align: center;">range2(1,</p></td><td style="width:66pt"><p class="s19" style="padding-left: 6pt;text-indent: 0pt;text-align: left;">10, 11) ;</p></td><td style="width:26pt"><p class="s344" style="padding-top: 1pt;padding-right: 7pt;text-indent: 0pt;line-height: 12pt;text-align: right;">//</p></td><td style="width:27pt"><p class="s19" style="padding-top: 1pt;padding-left: 6pt;text-indent: 0pt;line-height: 13pt;text-align: left;">[1]</p></td><td style="width:48pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:32pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:43pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:22pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:15pt"><td style="width:56pt"><p class="s19" style="padding-left: 1pt;padding-right: 5pt;text-indent: 0pt;text-align: center;">range2(21,</p></td><td style="width:66pt"><p class="s19" style="padding-left: 12pt;text-indent: 0pt;text-align: left;">10) ;</p></td><td style="width:26pt"><p class="s344" style="padding-top: 1pt;padding-right: 7pt;text-indent: 0pt;line-height: 12pt;text-align: right;">//</p></td><td style="width:27pt"><p class="s19" style="padding-left: 6pt;text-indent: 0pt;text-align: left;">[21,</p></td><td style="width:48pt"><p class="s19" style="padding-right: 10pt;text-indent: 0pt;text-align: right;">20, 19,</p></td><td style="width:32pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:43pt"><p class="s19" style="padding-right: 4pt;text-indent: 0pt;text-align: right;">13, 12,</p></td><td style="width:22pt"><p class="s19" style="padding-top: 1pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">11]</p></td></tr><tr style="height:15pt"><td style="width:56pt"><p class="s19" style="padding-left: 1pt;padding-right: 5pt;text-indent: 0pt;text-align: center;">range2(21,</p></td><td style="width:66pt"><p class="s19" style="padding-right: 15pt;text-indent: 0pt;text-align: right;">10, - 3) ;</p></td><td style="width:26pt"><p class="s344" style="padding-top: 1pt;padding-right: 7pt;text-indent: 0pt;line-height: 12pt;text-align: right;">//</p></td><td style="width:27pt"><p class="s19" style="padding-left: 6pt;text-indent: 0pt;text-align: left;">[21,</p></td><td style="width:48pt"><p class="s19" style="padding-right: 10pt;text-indent: 0pt;text-align: right;">18, 15,</p></td><td style="width:75pt" colspan="2"><p class="s19" style="padding-left: 7pt;text-indent: 0pt;text-align: left;">12]</p></td><td style="width:22pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:15pt"><td style="width:56pt"><p class="s19" style="padding-left: 1pt;padding-right: 5pt;text-indent: 0pt;text-align: center;">range2(21,</p></td><td style="width:66pt"><p class="s19" style="padding-right: 15pt;text-indent: 0pt;text-align: right;">10, - 4) ;</p></td><td style="width:26pt"><p class="s344" style="padding-top: 1pt;padding-right: 7pt;text-indent: 0pt;line-height: 12pt;text-align: right;">//</p></td><td style="width:27pt"><p class="s19" style="padding-left: 6pt;text-indent: 0pt;text-align: left;">[21,</p></td><td style="width:48pt"><p class="s19" style="padding-right: 9pt;text-indent: 0pt;text-align: right;">17, 13]</p></td><td style="width:75pt" colspan="2"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:22pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:15pt"><td style="width:56pt"><p class="s19" style="padding-left: 1pt;padding-right: 5pt;text-indent: 0pt;text-align: center;">range2(21,</p></td><td style="width:66pt"><p class="s19" style="padding-right: 15pt;text-indent: 0pt;text-align: right;">10, - 7) ;</p></td><td style="width:26pt"><p class="s344" style="padding-top: 1pt;padding-right: 7pt;text-indent: 0pt;line-height: 12pt;text-align: right;">//</p></td><td style="width:27pt"><p class="s19" style="padding-left: 6pt;text-indent: 0pt;text-align: left;">[21,</p></td><td style="width:48pt"><p class="s19" style="padding-left: 7pt;text-indent: 0pt;text-align: left;">14]</p></td><td style="width:75pt" colspan="2"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:22pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:14pt"><td style="width:56pt"><p class="s19" style="padding-left: 1pt;padding-right: 5pt;text-indent: 0pt;text-align: center;">range2(21,</p></td><td style="width:66pt"><p class="s19" style="padding-right: 12pt;text-indent: 0pt;text-align: right;">10, -12) ;</p></td><td style="width:26pt"><p class="s344" style="padding-top: 1pt;padding-right: 7pt;text-indent: 0pt;line-height: 12pt;text-align: right;">//</p></td><td style="width:27pt"><p class="s19" style="padding-left: 6pt;text-indent: 0pt;text-align: left;">[21]</p></td><td style="width:48pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:75pt" colspan="2"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:22pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr></table><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">Writing Jest tests is straightforward; the following code shows just three cases of the preceding code:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 74pt;text-indent: -12pt;line-height: 114%;text-align: left;"><span>describe(&quot;range2()&quot;, () =&gt; {<br/>it(&quot;works from 1 to 10&quot;, () =&gt;</span></p><p class="s17" style="padding-left: 98pt;text-indent: -12pt;line-height: 118%;text-align: left;"><span>expect(range2(1, 10)).toEqual([<br/>1,                           2, 3, 4, 5, 6, 7, 8, 9,</span></p><p class="s17" style="padding-left: 86pt;text-indent: 0pt;text-align: left;">] ) ) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 74pt;text-indent: 0pt;text-align: left;">it(&quot;works from 1 to 10 by 2&quot;, () -&gt;</p><p class="s17" style="padding-top: 2pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">expect(range2(1, 10, 2)).toEqual([1, 3, 5, 7, 9] ) ) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 85pt;text-indent: -11pt;line-height: 115%;text-align: left;"><span>it(&quot;works from 21 down to 10 by -4&quot;, () =&gt;<br/>expect(range2(21, 10, -4)).toEqual( [21, 17, 13]));</span></p><p class="s17" style="padding-top: 2pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">});</p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>Using this new range2 () function means you can write a greater variety of loops in a functional<br/>way, with no need for for (. . . ) statements.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="5.6"><p class="s10" style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: left;">Range generators: <span class="p">The following does the job and works for all sorts of ranges, ascending or<br/>descending. The first time it is called, it returns the initial value (from) and then updates it (by<br/>summing the step value) until the resulting value is outside the range:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 73pt;text-indent: -11pt;line-height: 118%;text-align: justify;"><span>function* range4(<br/>from: number,<br/>to: number,</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 238pt;text-indent: 0pt;text-align: left;">Chapter 5, Programming Declaratively - A Better Style      519</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 65pt;text-indent: 0pt;text-align: left;">step: number = Math.sign(to - from)</p><p class="s17" style="padding-top: 2pt;padding-left: 64pt;text-indent: -11pt;line-height: 120%;text-align: left;"><span>): Generator&lt;number&gt; {<br/>do {</span></p><p class="s10" style="padding-top: 1pt;padding-left: 77pt;text-indent: -1pt;line-height: 142%;text-align: left;"><span>yield from;<br/>from += step;</span></p><p class="s17" style="padding-left: 65pt;text-indent: 0pt;line-height: 11pt;text-align: left;">} while (</p><p class="s10" style="padding-top: 4pt;padding-left: 78pt;text-indent: 0pt;line-height: 142%;text-align: left;"><span>(step &gt; 0 &amp;&amp; to &gt;= from) ||<br/>(step &lt; 0 &amp;&amp; to &lt;= from)</span></p><p class="s10" style="padding-top: 1pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>We can write tests for this function in several different ways: manually calling the generator several<br/>times, using the spread operator to get all the values at once, or using the for . . of construct:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">describe(&quot;range4&quot;, () =&gt; {</p><p class="s17" style="padding-top: 2pt;padding-left: 77pt;text-indent: -11pt;line-height: 117%;text-align: left;"><span>it(&quot;generates 2.. 5&quot;, () =&gt; {<br/>const range = range4(2, 5);</span></p><p class="s10" style="padding-top: 1pt;padding-left: 77pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>expect(range.next().value).toBe(2);<br/>expect(range.next().value).toBe(3);<br/>expect(range.next().value).toBe(4);<br/>expect(range.next().value).toBe(5);<br/>expect(range.next().value).toBe(undefined);</span></p><p class="s17" style="padding-left: 65pt;text-indent: 0pt;text-align: left;">});</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 77pt;text-indent: -11pt;line-height: 117%;text-align: left;"><span>it(&quot;generates 5.. 2&quot;, () =&gt; {<br/>const range = range4(5, 2);</span></p><p class="s10" style="padding-top: 2pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">expect([...range]).toEqual([5, 4, 3, 2]);</p><p class="s17" style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">});</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 76pt;text-indent: -11pt;line-height: 117%;text-align: left;"><span>it(&quot;generates  1..10  by  2&quot;,  ()  =&gt;  {<br/>const numbers = [];</span></p><p class="s17" style="padding-left: 77pt;text-indent: 0pt;line-height: 13pt;text-align: left;">for  <span class="s10">(const  i  of  range4(1,  10,  2))  {</span></p><p class="s17" style="padding-top: 2pt;padding-left: 76pt;text-indent: 11pt;line-height: 233%;text-align: left;"><span>numbers.push(i) ;<br/>expect(numbers).toEqual([1, 3, 5, 7, 9]);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">520  Answers to Questions</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="5.7"><p style="padding-left: 52pt;text-indent: 0pt;line-height: 108%;text-align: justify;"><b>Doing the alphabet: </b>The problem is that <span class="s245">String. f romCharCode () </span><span>is not unary; it may receive<br/>any number of arguments. When you write </span><span class="s245">map (String . f romCharCode), </span><span>the callback gets<br/>called with three parameters (the current value, the index, and the array) and that causes unexpected</span></p><p style="padding-top: 1pt;padding-left: 52pt;text-indent: 0pt;text-align: justify;">results. Using unary () from the <i>Arity changing section </i>of <i>Chapter 6, Producing Functions, </i><span>would also<br/>work. To find out more, go to </span><span class="s245">developer. mozilla. org/en-US/docs/Web/JavaScript/<br/>Reference/Global_Obj ects/String/fromCharCode.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="5.8"><p class="s10" style="padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: justify;">Producing a CSV: <span class="p">A first solution, along with some auxiliary functions, is as follows; can you<br/>understand what each function does?</span></p><p class="s17" style="padding-top: 8pt;padding-left: 76pt;text-indent: -14pt;line-height: 120%;text-align: left;"><span>const myData =<br/>[1, 2, 3, 4] ,</span></p><p class="s17" style="padding-left: 76pt;text-indent: 0pt;line-height: 12pt;text-align: left;">[5, 6, 7, 8],</p><p class="s17" style="padding-top: 2pt;padding-left: 76pt;text-indent: 0pt;text-align: left;">[9, 10, 11, 12] ,</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 75pt;text-indent: -13pt;line-height: 118%;text-align: left;"><span>const concatNumbers = (a: string, b: number): string =&gt;<br/>la ? ~${b}&#39; : &#39;${a},${b}&#39;</span><span class="s345">;</span></p><p class="s17" style="padding-top: 12pt;padding-left: 73pt;text-indent: -12pt;line-height: 115%;text-align: left;"><span>const concatLines = (c: string, d: string): string =&gt;<br/>c + &quot;\n&quot; + d;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 73pt;text-indent: -11pt;line-height: 114%;text-align: left;"><span>const makeCSV = (data: number!] [] ) =&gt;<br/>data</span></p><p class="s10" style="padding-top: 2pt;padding-left: 87pt;text-indent: 0pt;text-align: left;">.map((x) =&gt; x.reduce(concatNumbers, &quot;&quot;))</p><p class="s10" style="padding-top: 4pt;padding-left: 87pt;text-indent: 0pt;text-align: left;">.reduce(concatLines,</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-top: 6pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">console.log(makeCSV(myData));</p><p class="s158" style="padding-top: 3pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">/*</p><p class="s17" style="padding-left: 62pt;text-indent: 0pt;text-align: left;">1,2,3,4</p><p class="s17" style="padding-top: 2pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">5,6,7,8</p><p class="s17" style="padding-top: 2pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">9,10,11,12</p><p class="s158" style="padding-top: 3pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">*/</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: justify;">An alternative one-liner is possible, but not as clear - do you agree?</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 73pt;text-indent: -11pt;line-height: 119%;text-align: left;"><span>const makeCSV2 = (data: number!] [] ) =&gt;<br/>data</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 238pt;text-indent: 0pt;text-align: left;">Chapter 5, Programming Declaratively - A Better Style      521</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 88pt;text-indent: -9pt;line-height: 119%;text-align: left;"><span>,map((x: number []) = &gt;<br/>x.reduce(</span></p><p class="s17" style="padding-left: 102pt;text-indent: 0pt;line-height: 12pt;text-align: left;">(a: string, b: number): string =&gt;</p><p class="s17" style="padding-top: 2pt;padding-left: 114pt;text-indent: 0pt;text-align: left;">!a ? &quot;${b}&#39; : &#39;${a},${b}\</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 77pt;text-indent: 0pt;text-align: left;">)</p><p class="s17" style="padding-top: 1pt;padding-left: 78pt;text-indent: 0pt;text-align: left;">.reduce((c: string, d: string) =&gt; c + &quot;\n&quot; + d, &quot;&quot;);</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="5.9"><p class="s10" style="padding-left: 64pt;text-indent: -21pt;text-align: left;">An empty question? <span class="p">Both f latl () and f lat2 () depend on f latOne (). If that function</span></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: left;">(in any of its two provided implementations) finds an empty array position, it doesn’t <span class="s245">concat ()</span></p><p style="padding-top: 2pt;padding-left: 43pt;text-indent: 0pt;text-align: left;">anything to its output.</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="5.10"><p class="s10" style="padding-top: 6pt;padding-left: 69pt;text-indent: -25pt;text-align: left;">Producing better output: <span class="p">For this, you’ll have to do some extra mapping, as follows:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 52pt;text-indent: 0pt;text-align: left;">const better = apiAnswer</p><p class="s17" style="padding-top: 2pt;padding-left: 66pt;text-indent: 0pt;text-align: left;">.flatMap((c) =&gt;</p><p class="s17" style="padding-top: 2pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">c.states.map((s) =&gt; ({ s, country: c.name }))</p><p class="s17" style="padding-top: 2pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">)</p><p class="s17" style="padding-top: 1pt;padding-left: 77pt;text-indent: -10pt;line-height: 118%;text-align: left;"><span>.flatMap((s) =&gt;<br/>s.cities.map((t) =&gt; ({</span></p><p class="s17" style="padding-left: 90pt;text-indent: 0pt;line-height: 13pt;text-align: left;">. . . t,</p><p class="s17" style="padding-top: 2pt;padding-left: 89pt;text-indent: 0pt;line-height: 115%;text-align: left;"><span>state: s.name,<br/>country: s.country,</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 53pt;text-indent: 13pt;line-height: 233%;text-align: left;"><span>.map((t) =&gt; &#39;${t.name}, ${t.state}, ${t.country}&#39;);<br/>console.log(better);</span></p><p class="s158" style="padding-top: 1pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">/*</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-top: 4pt;padding-left: 66pt;text-indent: 0pt;text-align: left;">’Lincoln,</p><p class="s346" style="padding-top: 2pt;padding-left: 66pt;text-indent: 0pt;text-align: left;">1 <span class="s347">Lincoln,</span></p><p class="s346" style="padding-top: 2pt;padding-left: 66pt;text-indent: 0pt;text-align: left;">1 <span class="s347">Lincoln,</span></p><p class="s346" style="padding-top: 2pt;padding-left: 66pt;text-indent: 0pt;text-align: left;">1 <span class="s347">Lincoln,</span></p><p class="s17" style="padding-top: 4pt;padding-left: 12pt;text-indent: 0pt;line-height: 118%;text-align: left;"><span>Buenos Aires, Argentine’,<br/>England, Great Britain’,</span></p><p class="s17" style="padding-left: 12pt;text-indent: 0pt;line-height: 117%;text-align: left;"><span>California, United States of America’,<br/>Rhode Island, United States of America’,</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">522  Answers to Questions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 75pt;text-indent: 0pt;line-height: 117%;text-align: left;">&#39;Lincolnia, Virginia, United States of America<span class="s348">1</span><span>,<br/>&#39;Lincoln Park, Michigan, United States of America&#39;,<br/>&#39;Lincoln, Nebraska, United States of America&#39;,<br/>&#39;Lincoln Park, Illinois, United States of America&#39;,<br/>&#39;Lincoln Square, Illinois, United States of America&#39;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s158" style="padding-left: 62pt;text-indent: 0pt;text-align: left;">*/</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="5.11"><p class="s10" style="padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: left;">Old-style code only! <span class="p">One way of doing this is by using j oin () to build a single long string out<br/>of the individual sentences, using split () to separate that string into words, and finally, looking</span></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 10pt;text-align: left;">at the length of the resulting array:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 61pt;text-indent: 0pt;text-align: left;">const words = gettysburg.join(&quot; &quot;).split!&quot; &quot;).length; // 270</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="5.12"><p class="s10" style="padding-left: 52pt;text-indent: 0pt;line-height: 118%;text-align: left;">Filtering...but what? <span class="s17">Boolean (x) </span><span class="s246">is the same as ! !x, turning an expression from truthy<br/>or</span><span class="p">                                                                                            f alsy into true or false, respectively. Thus, the filter () operation removes all f alsy</span></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">elements from the array.</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="5.13"><p style="padding-left: 52pt;text-indent: 0pt;line-height: 108%;text-align: left;"><b>Yet another factorial question: </b>Yes, it works, and <span class="s245">f act4 </span><span>( 0 ) returns 1 as expected. The<br/></span><span class="s245">range</span><span class="s17"> (1,1) </span><span class="s246">call produces an empty array, so the original value of </span><span class="s17">result (1) </span><span class="s246">is returned without<br/>further</span> change.</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="5.14"><p class="s10" style="padding-left: 53pt;text-indent: 0pt;text-align: left;">Async chaining: <span class="p">An article by Valeri Karpov, which can be found at </span><span class="s17">thecodebarbarian.<br/>com/basic-functional - programming-with-async-await. html, </span><span class="s246">provides polyfills</span></p><p style="padding-top: 1pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>for methods such as f orEach (), map (), and so on, and also develops a class for async arrays<br/>that allows chaining.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="5.15"><p class="s10" style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;">Missing equivalents: <span class="p">Start by using mapAsync () to get the async values and apply the original<br/>function to the returned array. An example for some () would be as follows:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 73pt;text-indent: -12pt;line-height: 115%;text-align: left;"><span>const someAsync = &lt;T&gt;(<br/>arr : T [] ,</span></p><p class="s17" style="padding-left: 74pt;text-indent: 0pt;text-align: left;">fn: (x: T) =&gt; Promise&lt;boolean&gt;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 72pt;text-indent: 0pt;text-align: left;">mapAsync(arr, fn).then((mapped) =&gt; mapped.some(Boolean));</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 238pt;text-indent: 0pt;text-align: left;">Chapter 5, Programming Declaratively - A Better Style      523</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: left;">We can write tests for this in two different fashions: awaiting the result of a call, or using Jest’s</p><p class="s17" style="padding-left: 45pt;text-indent: 0pt;text-align: left;">. resolves <span class="s246">for shorter code:</span></p><p class="s17" style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">describe(&quot;someAsync&quot;, () =&gt; {</p><p class="s17" style="padding-top: 2pt;padding-left: 77pt;text-indent: -11pt;line-height: 115%;text-align: left;"><span>it(&quot;succeeds if sometimes OK&quot;, async () = &gt; {<br/>const someEven = </span><span class="s10">await someAsync(</span></p><p class="s17" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">[1, 2, 3, 4] ,</p><p class="s17" style="padding-top: 2pt;padding-left: 89pt;text-indent: 0pt;text-align: left;">fakeFilter</p><p class="s17" style="padding-top: 3pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">) ;</p><p class="s10" style="padding-top: 2pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">expect(someEven).toBeTruthy();</p><p class="s17" style="padding-top: 5pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">});</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 76pt;text-indent: -11pt;line-height: 118%;text-align: left;"><span>it(&quot;fails if never OK&quot;, () = &gt; {<br/>expect(</span></p><p class="s17" style="padding-left: 89pt;text-indent: 0pt;line-height: 13pt;text-align: left;">someAsync([1, 3, 5, 7, 9], fakeFilter)</p><p class="s10" style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">).resolves.toBeFalsy();</p><p class="s17" style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">});</p><p class="s17" style="padding-top: 2pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">});</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="5.16"><p class="s17" style="padding-left: 43pt;text-indent: 0pt;line-height: 109%;text-align: justify;"><span class="s10">Emptying the pool: </span><span class="p">The provided suggestion is good: we could do the check either at the top of<br/></span><span class="s245">workerCall</span> () <span class="s246">or when we reset a worker to be not in use. Let’s go with the second solution, to<br/>make the call as fast as possible. We will add a MAX_NOT_IN_USE constant with the threshold of<br/>number of workers not in use and a </span>not InUse () <span class="s246">predicate as a refactor:</span></p><p class="s17" style="padding-top: 9pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">const notlnUse = (p: PoolEntry): boolean = &gt; !p.inUse;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 52pt;text-indent: 0pt;text-align: left;">const MAX_NOT_IN_USE = 10;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: left;">Then, we’ll change the last part of the workerCall () function as follows:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 76pt;text-indent: -12pt;line-height: 117%;text-align: left;"><span>return new Promise((resolve) =&gt; {<br/>available!.inUse = true;<br/>available!.worker.on(&quot;message&quot;, (x) =&gt; {</span></p><p class="s17" style="padding-left: 88pt;text-indent: 0pt;line-height: 117%;text-align: left;"><span>resolve(x);<br/>available!.inUse = false;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 88pt;text-indent: 0pt;text-align: left;">while (</p><p class="s10" style="padding-top: 4pt;padding-left: 100pt;text-indent: 0pt;text-align: left;">pool.filter(notlnUse).length &gt; MAX NOTINUSE</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">524  Answers to Questions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 110pt;text-indent: 0pt;text-align: left;">{</p><p class="s10" style="padding-top: 2pt;padding-left: 109pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>const notUsed = pool.findindex(notlnUse) ;<br/>pool[notUsed].worker.terminate();<br/>pool.splice(notUsed, 1);</span></p><p class="s10" style="padding-top: 2pt;padding-left: 98pt;text-indent: 0pt;text-align: left;">}</p><p class="s17" style="padding-top: 2pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">});</p><p class="s17" style="text-indent: 0pt;text-align: right;">available!.worker.postMessage(value);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">While the count of workers not in use is higher than our limit, we find one worker to remove,</p><p class="s17" style="text-indent: 0pt;text-align: right;">terminate () <span class="s246">it, and remove it from the pool of workers.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="5.17"><p class="s10" style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;">Queueing for the pool: <span class="p">This question has an interesting way of handling a promise to act as a<br/>barrier, initially denying but eventually allowing procedures to go through. The idea is to check that<br/>there are not too many running workers before adding a worker to the pool. If so, proceed as before,<br/>but if not, add something to the queue (we’ll see what), so we can run the worker later. Whenever a<br/>worker responds, we’ll check whether there’s anything in the queue to allow it to run.</span></p><p style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">We’ll first add three things:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 62pt;text-indent: 0pt;line-height: 117%;text-align: left;"><span>const queue: ( (v? : any) = &gt; void) [] = [] ;<br/>let running = 0;</span></p><p class="s17" style="padding-left: 61pt;text-indent: 0pt;line-height: 13pt;text-align: left;">const MAX_T0_USE = 5;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>The way we’ll handle waiting is by creating a promise, which we’ll eventually resolve at a later time. That<br/>explains the weird queue data type, which contains resolving functions. The running variable will<br/>count how many workers are running, and MAX_TO_USE is the maximum possible value for running.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">To work with the queue, we’ll have two functions:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 74pt;text-indent: -12pt;line-height: 114%;text-align: left;"><span>const enqueue = (resolve2: (v?: any) =&gt; void) =&gt; {<br/>if (running &lt; MAX TO_USE) {</span></p><p class="s17" style="padding-left: 85pt;text-indent: 0pt;line-height: 118%;text-align: left;"><span>running++;<br/>resolve2();</span></p><p class="s17" style="padding-left: 74pt;text-indent: 0pt;line-height: 13pt;text-align: left;">} else {</p><p class="s17" style="padding-top: 2pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">queue.push(resolve2);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 61pt;text-indent: 0pt;text-align: left;">const dequeue = ()</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 238pt;text-indent: 0pt;text-align: left;">Chapter 5, Programming Declaratively - A Better Style      525</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 64pt;text-indent: 0pt;line-height: 115%;text-align: left;"><span>const resolve2 = queue.shift();<br/>resolve2 &amp;&amp; resolve2();</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>The enqueue () function checks how many workers are running; if there are less than MAX_TO_<br/>USE, it increments running (because a worker will run) and then calls resolve2 () to allow the<br/>corresponding request to go forward. If there are too many running workers, the function to call is</span></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 11pt;text-align: justify;">instead pushed into the queue. The <span class="s245">dequeue () </span>function just tries to get the front element from</p><p style="padding-top: 2pt;padding-left: 43pt;text-indent: 0pt;line-height: 190%;text-align: left;"><span>the queue, and if there’s something, it calls the dequeued value to allow a queued request to proceed.<br/>The modified workerCall () function is now as follows:</span></p><p class="s17" style="padding-top: 1pt;padding-left: 65pt;text-indent: -12pt;line-height: 118%;text-align: left;"><span>export const workerCall = (<br/>filename: string,</span></p><p class="s17" style="padding-left: 64pt;text-indent: 0pt;line-height: 13pt;text-align: left;">value: any</p><p class="s17" style="padding-top: 2pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">): Promise&lt;any&gt; =&gt; {</p><p class="s17" style="padding-top: 2pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">return new Promise((resolve) =&gt; {</p><p class="s10" style="padding-top: 3pt;padding-left: 76pt;text-indent: 0pt;text-align: left;">new Promise((resolve2) =&gt; enqueue(resolve2)).then(</p><p class="s17" style="padding-top: 3pt;padding-left: 90pt;text-indent: 0pt;text-align: left;">0 =&gt; {</p><p class="s17" style="padding-top: 1pt;text-indent: 0pt;text-align: right;">let available = pool</p><p class="s17" style="padding-top: 2pt;text-indent: 0pt;text-align: right;">.filter(notlnUse)</p><p class="s17" style="padding-top: 2pt;padding-left: 114pt;text-indent: 0pt;text-align: left;">.find((x) =&gt; x.filename === filename);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 112pt;text-indent: -11pt;line-height: 118%;text-align: left;"><span>if (available === undefined) {<br/>available = {</span></p><p class="s17" style="padding-left: 125pt;text-indent: 0pt;line-height: 118%;text-align: left;"><span>worker: new Worker(filename),<br/>filename,</span></p><p class="s17" style="padding-left: 125pt;text-indent: -1pt;line-height: 117%;text-align: left;"><span>value,<br/>inUse: true,</span></p><p class="s17" style="padding-left: 112pt;text-indent: 1pt;line-height: 235%;text-align: left;"><span>} as PoolEntry;<br/>pool.push(available);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 100pt;text-indent: 0pt;text-align: left;">available!.inUse = true;</p><p class="s17" style="padding-top: 2pt;padding-left: 112pt;text-indent: -12pt;line-height: 117%;text-align: left;"><span>available 1.worker.on(&quot;message&quot;, (x) =&gt; {<br/>resolve(x);</span></p><p class="s17" style="padding-left: 112pt;text-indent: 0pt;text-align: left;">available!.inUse = false;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">526  Answers to Questions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 121pt;text-indent: 0pt;text-align: left;"><a name="bookmark529">dequeue();</a></p><p class="s17" style="padding-top: 4pt;padding-left: 110pt;text-indent: 0pt;text-align: left;">});</p><p class="s17" style="padding-left: 109pt;text-indent: 0pt;text-align: left;">available!.worker.postMessage(value);</p><p class="s17" style="padding-top: 4pt;padding-left: 98pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">});</p><p class="s17" style="padding-top: 2pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">};</p><p style="padding-top: 8pt;padding-left: 52pt;text-indent: 0pt;line-height: 121%;text-align: justify;">The <span class="s245">new Promise ( (resolve2 ) =&gt; </span><span>...) line is the barrier we mentioned; it will allow work<br/>to go on (at then ()) only when its resolve2 () function is called - which will be done either by<br/>enqueue () (if there were few running workers) or dequeue () (when some previously running<br/>worker ends).</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="5.18"><p class="s10" style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;">Showing results: <span class="p">Basically, given a string, it returns a logging function that expects a single<br/>parameter and lists both the string and the argument. We’ll see other ways of achieving similar results<br/>in </span><i>Chapter 6, Producing Functions.</i></p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="5.19"><p class="s10" style="padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: justify;">Double filtering? <span class="p">This is not optimal; filter () goes through all the workers, and then find ()<br/>goes through the filtered ones. This could be achieved in a single pass as follows:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">let available = pool</p><p class="s17" style="padding-top: 1pt;padding-left: 87pt;text-indent: 0pt;text-align: left;"><a name="bookmark530">.find((v) =&gt; </a><span class="s10">!v.inUse &amp;&amp; v.filename === filename);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="5.20"><p class="s10" style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;">Wishful thinking: <span class="p">At the very least, you should listen to the &quot;error&quot; event, which fires if an<br/>error occurs in the worker. In this case, the worker should be marked as not in use (because it has<br/>ended its job) and the promise should be rejected. The final part of the workerCall () function<br/>should look something like this:</span></p></li></ol></ol><p class="s17" style="padding-top: 8pt;padding-left: 85pt;text-indent: -12pt;line-height: 118%;text-align: left;"><span>return new Promise((resolve, reject) =&gt; {<br/>available!.inUse = true;<br/>available!.worker.on(&quot;message&quot;, (x) =&gt; {</span></p><p class="s17" style="padding-left: 97pt;text-indent: 0pt;line-height: 118%;text-align: left;"><span>resolve(x);<br/>available!.inUse = false;</span></p><p class="s17" style="padding-top: 1pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">});</p><p class="s10" style="padding-top: 1pt;padding-left: 97pt;text-indent: -12pt;line-height: 144%;text-align: left;"><span>available!.worker.on(&quot;error&quot;, (x) =&gt; {<br/>reject(x);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 224pt;text-indent: 0pt;text-align: left;">Chapter 6, Producing Functions - Higher-Order Functions      527</p><p class="s10" style="padding-top: 22pt;padding-left: 88pt;text-indent: 0pt;text-align: left;"><a name="bookmark531">available I.inUse = false;</a><a name="bookmark532">&zwnj;</a></p><p class="s10" style="padding-top: 6pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">});</p><p class="s17" style="padding-left: 51pt;text-indent: 0pt;text-align: center;">available! .worker.postMessage (value) ;</p><p class="s17" style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">});</p><p style="padding-top: 8pt;padding-left: 43pt;text-indent: 0pt;text-align: left;">For an “industrial-strength” level library, you should deal with all possible events; check <span class="s245">developer.<br/>mozilla.org/en-US/docs/Web/API/Worker#events </span>and <span class="s245">nodej s.org/api/<br/>workerthreads . html#class-worker </span>for more on this.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-left: 43pt;text-indent: 0pt;text-align: left;"><a name="bookmark533">Chapter 6,  Producing Functions - Higher-Order Functions</a></p><ol id="l187"><ol id="l188"><li data-list-text="6.1"><p class="s10" style="padding-top: 10pt;padding-left: 63pt;text-indent: -19pt;text-align: left;">Go with arrows: <span class="p">Just minor changes are needed:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 51pt;text-indent: 0pt;text-align: center;">const addLogging = <span class="s10">&lt;T extends (...args: any[]) =&gt; any&gt;(</span></p><p class="s17" style="padding-top: 2pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">fn: T</p><p class="s10" style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">): ((...args: Parameters&lt;T&gt;) =&gt; ReturnType&lt;T&gt;) =&gt; {</p><p class="s17" style="padding-top: 2pt;padding-left: 77pt;text-indent: -12pt;line-height: 118%;text-align: left;"><span>return (...args: Parameters&lt;T&gt;): ReturnType&lt;T&gt; =&gt; {<br/>console.log(&#39;entering ${fn.name}(${args})&#39;);</span></p><p class="s17" style="padding-left: 77pt;text-indent: 0pt;line-height: 13pt;text-align: left;">const valueToReturn = fn(...args);</p><p class="s17" style="padding-top: 2pt;padding-left: 77pt;text-indent: 0pt;line-height: 118%;text-align: left;"><span>console.log(&#39;exiting ${fn.name}=&gt;${valueToReturn}&#39;);<br/>return valueToReturn;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="6.2"><p class="s10" style="padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: left;">Mapping for memory: <span class="p">Let’s do this for the most complete memoizing function we wrote,<br/>memoize4 (). Instead of using an object for cache, we create a map. We check whether the map</span></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 111%;text-align: left;"><span>has the searched strX key, we set new values after calling the original function, and we get the return<br/>value from the cache. The </span><span class="s245">as </span>part in <span class="s245">return </span>is to let TypeScript know that <span class="s245">get () </span><span>will succeed<br/>because the search won’t fail:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 65pt;text-indent: -12pt;line-height: 115%;text-align: left;"><span>const memoize4 = &lt;T extends (...x: any[]) =&gt; any&gt;(<br/>fn: T</span></p><p class="s17" style="padding-left: 64pt;text-indent: -11pt;line-height: 129%;text-align: left;"><span>): ((...x: Parameters&lt;T&gt;) =&gt; ReturnType&lt;T&gt;) =&gt; {<br/></span><span class="s10">const cache = new Map() as Map&lt;string, ReturnType&lt;T&gt;&gt;;<br/></span>return (...args) =&gt; {</p><p class="s17" style="padding-left: 76pt;text-indent: 0pt;line-height: 11pt;text-align: left;">const strX = JSON.stringify(args);</p><p class="s10" style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">if (Icache.has(strX)) {</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">528  Answers to Questions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 97pt;text-indent: 0pt;text-align: left;">cache.set(strX, fn(...args));</p><p class="s10" style="padding-top: 6pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">}</p><p class="s10" style="padding-top: 2pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">return cache.get(strX) as ReturnType&lt;T&gt;;</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="6.3"><p class="s10" style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;">How many? <span class="p">Let’s call calc (n) the number of calls needed to evaluate f ib (n). Analyzing the<br/>tree that shows all the needed calculations, we get the following:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l189"><li data-list-text="•"><p style="padding-left: 79pt;text-indent: -13pt;text-align: left;">calc(0)=l</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 79pt;text-indent: -13pt;text-align: left;">calc(l)=l</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 79pt;text-indent: -13pt;text-align: left;">For <i>n&gt;l, </i>calc(n)=l + calc(n-l) + calc(«-2)</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: justify;">The last line follows from the fact that when we call <span class="s245">f ib (n), </span>we have one call, plus calls to <span class="s245">f ib (n -1)</span></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: justify;">and <span class="s245">f ib </span>(n-2). A spreadsheet shows that <span class="s245">calc (50) </span>is 40,730,022,147 - rather high!</p><p style="padding-top: 9pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;">If you care for some algebra, it can be shown that calc(n)=5fib(n-l)+fib(n-4)-l, or that as <i>n </i><span>grows,<br/>calc(n) becomes approximately (l+v5)=3.236 times the value of fib(w) - but since this is not a math<br/>book, I won’t even mention those results!</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p></li></ul></li><li data-list-text="6.4"><p style="padding-left: 52pt;text-indent: 0pt;line-height: 120%;text-align: justify;"><b>A randomizing balancer: </b>Using our <span class="s245">shuffle () </span>function from <i>Chapter 4, Behaving Properly,</i><span>we can write the following code. We remove the first function from the list before shuffling the rest,<br/>and we add it back at the end of the array to avoid repeating any calls:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">const randomizer =</p><p class="s17" style="padding-top: 2pt;padding-left: 76pt;text-indent: -1pt;line-height: 123%;text-align: left;"><span>&lt;T extends (...x: any[]) =&gt; any&gt; ( . . . f ns : T [] ) =&gt;<br/>(</span></p><p class="s17" style="padding-left: 87pt;text-indent: 0pt;line-height: 11pt;text-align: left;">...args: Parameters&lt;T&gt;</p><p class="s17" style="padding-top: 2pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">): ((...args: Parameters&lt;T&gt;) =&gt; ReturnType&lt;T&gt;) =&gt; {</p><p class="s10" style="padding-top: 4pt;padding-left: 86pt;text-indent: 0pt;line-height: 143%;text-align: left;"><span>const first: T = fns.shiftO as T;<br/>fns = shuffie(fns);<br/>fns.push(first);</span></p><p class="s10" style="padding-left: 85pt;text-indent: 0pt;text-align: left;">return fns[0](...args);</p><p class="s17" style="padding-top: 4pt;padding-left: 75pt;text-indent: 0pt;text-align: left;">};</p><p style="padding-top: 9pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>We need to add as T when assigning a value to first; otherwise, TypeScript will object because<br/>fns . shift () returns undefined if fns is empty. It wouldn’t be a bad idea to check that fns<br/>is not empty; can you add it?</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 224pt;text-indent: 0pt;text-align: left;">Chapter 6, Producing Functions - Higher-Order Functions      529</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: left;">A quick verification shows it fulfills all our requirements:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 53pt;text-indent: 0pt;line-height: 117%;text-align: left;"><span>const sayl = () =&gt; console.log(1);<br/>const say22 = () =&gt; console.log(22);<br/>const say333 = () =&gt; console.log(333);</span></p><p class="s17" style="padding-left: 53pt;text-indent: 0pt;text-align: left;">const say4444 = () =&gt; console.log(4444);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 53pt;text-indent: 0pt;line-height: 115%;text-align: justify;"><span>const rrr = randomizer(sayl, say22, say333, say4444);<br/>rrr(); // 333</span></p><p class="s17" style="padding-left: 52pt;text-indent: 0pt;line-height: 117%;text-align: justify;"><span>rrr(); // 4444<br/>rrr() ; // 333<br/>rrr(); // 22</span></p><p class="s17" style="padding-left: 52pt;text-indent: 0pt;text-align: justify;">rrr(); // 333</p><p class="s17" style="padding-top: 2pt;padding-left: 53pt;text-indent: 0pt;text-align: justify;">rrr(); // 22</p><p class="s17" style="padding-top: 2pt;padding-left: 52pt;text-indent: 0pt;line-height: 117%;text-align: left;"><span>rrr(); // 333<br/>rrr() ; // 4444<br/>rrr(); // 1</span></p><p class="s17" style="padding-left: 52pt;text-indent: 0pt;text-align: left;">rrr(); // 4444</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: left;"><span>A minor consideration: the first function in the list can never be called the first time around because<br/>of the way randomizer () is written. Can you provide a better version that won’t have this slight<br/>defect so that all the functions in the list have the same chance of being called the first time?</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="6.5"><p class="s10" style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;">Not in TypeScript: <span class="p">The following code does the job. The only difference between the functions is<br/>that one works with Boolean-returning functions and the other with number-returning ones:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 53pt;text-indent: 0pt;text-align: justify;">const not =</p><p class="s10" style="padding-top: 3pt;padding-left: 65pt;text-indent: 0pt;text-align: left;"><a name="bookmark534">&lt;T extends (.</a><span class="p"> </span>args: any[]) =&gt; boolean&gt;(fn: T) =&gt;</p><p class="s10" style="padding-top: 4pt;padding-left: 66pt;text-indent: 0pt;text-align: left;">(<span class="p"> </span>args: Parameters&lt;T&gt;): boolean =&gt;</p><p class="s17" style="padding-top: 2pt;padding-left: 78pt;text-indent: 0pt;text-align: left;">!fn(. args);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 53pt;text-indent: 0pt;text-align: left;">const invert =</p><p class="s10" style="padding-top: 3pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">&lt;T extends (.<span class="p"> </span>args: any[]) =&gt; number&gt;(fn: T) =&gt;</p><p class="s10" style="padding-top: 4pt;padding-left: 66pt;text-indent: 0pt;text-align: left;">(<span class="p"> </span>args: Parameters&lt;T&gt;): number =&gt;</p><p class="s17" style="padding-top: 2pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">-fn(. args);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-left: 20pt;text-indent: 0pt;text-align: left;">530  <span class="s189">Answers to Questions</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="6.6"><p class="s10" style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;">Just say no! <span class="p">Call the original function and then use typeof to check whether the returned value<br/>is numeric or Boolean before deciding what to return. We must declare that the input function is<br/>either a Boolean-returning or a numb er-returning function:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">const opposite =</p><p class="s17" style="padding-top: 2pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">&lt;T extends (...args: any[]) =&gt; number | boolean&gt;(fn: T)</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 76pt;text-indent: 0pt;text-align: left;">(...args: Parameters&lt;T&gt;) : ReturnType&lt;T&gt; = &gt; {</p><p class="s10" style="padding-top: 4pt;padding-left: 85pt;text-indent: 0pt;line-height: 143%;text-align: left;"><span>const result = fn(...args);<br/>return (</span></p><p class="s10" style="padding-left: 98pt;text-indent: 0pt;text-align: left;">typeof result === &quot;boolean&quot; ? !result : -result</p><p class="s17" style="padding-top: 2pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">) as any;</p><p class="s17" style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">};</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="6.7"><p class="s10" style="padding-left: 52pt;text-indent: 0pt;line-height: 126%;text-align: left;">Invert tests: <span class="p">We can quickly transform the example shown in the text into a real test; we’ll leave<br/>it up to you to write more tests:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">import { invert } from      ./invert&quot;;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 61pt;text-indent: 0pt;text-align: left;">describe(&quot;invert&quot;, () =&gt; {</p><p class="s17" style="padding-top: 2pt;padding-left: 85pt;text-indent: -11pt;line-height: 115%;text-align: left;"><span>it(&quot;can be used to sort Spanish words&quot;, () =&gt; {<br/>const spanishComparison = (</span></p><p class="s17" style="padding-left: 97pt;text-indent: 0pt;text-align: left;">a: string,</p><p class="s17" style="padding-top: 2pt;padding-left: 97pt;text-indent: 0pt;text-align: left;">b: string</p><p class="s17" style="padding-top: 2pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">): number =&gt; a.localeCompare(b, &quot;es&quot;);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 80pt;text-indent: 5pt;line-height: 118%;text-align: left;"><span>const palabras = [<br/>&quot; &quot;nandu&quot;,</span></p><p class="s17" style="padding-left: 80pt;text-indent: 0pt;line-height: 12pt;text-align: left;">&quot; &quot;oasis&quot;,</p><p class="s17" style="padding-top: 2pt;padding-left: 80pt;text-indent: 0pt;text-align: left;">&quot; &quot;mano&quot;,</p><p class="s17" style="padding-top: 2pt;padding-left: 80pt;text-indent: 0pt;text-align: left;">&quot; &quot;natural&quot;,</p><p class="s17" style="padding-top: 2pt;padding-left: 80pt;text-indent: 0pt;text-align: left;">&quot; &quot;mftico&quot;,</p><p class="s17" style="padding-top: 2pt;padding-left: 86pt;text-indent: -5pt;line-height: 125%;text-align: left;"><span>&quot; &quot;musical&quot;,<br/>1 ;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 85pt;text-indent: 0pt;text-align: left;">expect (</p><p class="s10" style="padding-top: 4pt;padding-left: 97pt;text-indent: 0pt;text-align: left;">palabras.sort(invert(spanishComparison))</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 224pt;text-indent: 0pt;text-align: left;">Chapter 6, Producing Functions - Higher-Order Functions      531</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 77pt;text-indent: 0pt;text-align: left;">).toEqual([</p><p class="s17" style="padding-top: 2pt;padding-left: 71pt;text-indent: 0pt;text-align: left;">&quot; &quot;oasis&quot;,</p><p class="s17" style="padding-top: 2pt;padding-left: 71pt;text-indent: 0pt;text-align: left;">&quot; &quot;nandu&quot;,</p><p class="s17" style="padding-top: 1pt;padding-left: 71pt;text-indent: 0pt;text-align: left;">&quot; &quot;natural&quot;,</p><p class="s17" style="padding-top: 2pt;padding-left: 71pt;text-indent: 0pt;text-align: left;">&quot; &quot;musical&quot;,</p><p class="s17" style="padding-top: 2pt;padding-left: 71pt;text-indent: 0pt;text-align: left;">&quot; &quot;mitico&quot;,</p><p class="s17" style="padding-top: 2pt;padding-left: 71pt;text-indent: 0pt;text-align: left;">&quot; &quot;mano&quot;,</p><p class="s17" style="padding-top: 3pt;padding-bottom: 2pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">] ) ;</p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;"><span><img width="36" height="35" alt="image" src="Image_065.jpg"/></span></p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="6.8"><p style="padding-left: 43pt;text-indent: 0pt;line-height: 115%;text-align: left;"><b>Why not shorter? </b>The reason is that <span class="s245">f ilter () </span><span>expects to receive a function with three parameters<br/>(the A, number, and A [ ] types), and the type of not (f n) doesn’t match that.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="6.9"><p class="s10" style="padding-left: 65pt;text-indent: -22pt;text-align: left;">Wrong function length: <span class="p">We can solve this problem by using eval () - which, in general, isn’t</span></p><p style="padding-top: 2pt;padding-left: 43pt;text-indent: 0pt;text-align: left;"><span>such a good idea! If you persist and insist, though, we can write a function. length preserving<br/>version of </span><span class="s245">arity () </span>as follows; let’scall it <span class="s245">arityL ():</span></p><p class="s17" style="padding-top: 9pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">import { range } from        /chapter 05/range&quot;;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 64pt;text-indent: -11pt;line-height: 118%;text-align: left;"><span>function arityL&lt;T extends (...args: any[]) =&gt; any&gt;(<br/>n: number,</span></p><p class="s17" style="padding-left: 65pt;text-indent: 0pt;line-height: 12pt;text-align: left;">fn: T</p><p class="s17" style="padding-top: 2pt;padding-left: 65pt;text-indent: -11pt;line-height: 118%;text-align: left;"><span>): (,..x: Parameters&lt;T&gt;) =&gt; ReturnType&lt;T&gt; {<br/>const argsln = range(0, n)</span></p><p class="s17" style="padding-left: 78pt;text-indent: 0pt;line-height: 13pt;text-align: left;">.map((i) =&gt; &#39;x${i}&#39;)</p><p class="s17" style="padding-top: 2pt;padding-left: 78pt;text-indent: 0pt;text-align: left;">.j oin(&quot;,&quot;) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 65pt;text-indent: 0pt;text-align: left;"><a name="bookmark535">return </a><span class="s10">eval(&#39;(${argsln}) =&gt; ${fn.name}(${argsln})&#39;);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>If you were to apply arityL () to Number. parselnt, the results would be as follows. The produced<br/>functions have the right length property, and their actual implementation is given in the comments:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">const parselntl = arityL(parselnt, 1);</p><p class="s10" style="padding-top: 2pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// (xO) =&gt; parselnt(xO,xl) <span class="s17">parselntl.length === 1</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">532  Answers to Questions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 61pt;text-indent: 0pt;text-align: left;">const parselnt2 = arity(Number.parselnt,2)</p><p class="s10" style="padding-top: 2pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">// (xO,xl) =&gt; parselnt(xO,xl) <span class="s17">parselnt2.length === 2</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>Do note, however, that TypeScript cannot determine the type of the resulting functions because that<br/>will be known at runtime.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="6.10"><p class="s10" style="padding-left: 77pt;text-indent: -25pt;text-align: left;">Many arities! <span class="p">If we were working just with JavaScript, the following would do:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 61pt;text-indent: 0pt;text-align: left;">const binary = (fn) =&gt; (...a) =&gt; fn(a[0], a[1] ) ;</p><p class="s17" style="padding-top: 2pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">const ternary = (fn) =&gt; (...a) =&gt; fn(a[0], a[l], a [2]) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">Adding data types, we get the following:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 61pt;text-indent: 0pt;text-align: left;">const binary =</p><p class="s17" style="padding-top: 2pt;padding-left: 86pt;text-indent: -12pt;line-height: 118%;text-align: justify;"><span>&lt;T extends (...x: any[]) =&gt; any&gt;(<br/>fn: T</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 85pt;text-indent: 0pt;line-height: 115%;text-align: left;"><span>argO: Parameters&lt;T&gt;[0],<br/>argl: Parameters&lt;T&gt; [1]</span></p><p class="s17" style="padding-left: 76pt;text-indent: -1pt;line-height: 118%;text-align: left;"><span>) =&gt; ReturnType&lt;T&gt;) =&gt;<br/>(x,             y) =&gt;</span></p><p class="s17" style="padding-left: 86pt;text-indent: 0pt;line-height: 13pt;text-align: left;">fn(x, y) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 61pt;text-indent: 0pt;text-align: justify;">const ternary =</p><p class="s17" style="padding-top: 2pt;padding-left: 86pt;text-indent: -12pt;line-height: 118%;text-align: justify;"><span>&lt;T extends (...x: any[]) =&gt; any&gt;(<br/>fn: T</span></p><p class="s17" style="padding-left: 74pt;text-indent: 0pt;text-align: justify;">) : ( (</p><p class="s17" style="padding-top: 1pt;padding-left: 85pt;text-indent: 0pt;line-height: 117%;text-align: justify;"><span>argO: Parameters&lt;T&gt;[0],<br/>argl: Parameters&lt;T&gt; [1] ,<br/>arg2: Parameters&lt;T&gt; [2]</span></p><p class="s17" style="padding-left: 76pt;text-indent: -1pt;line-height: 118%;text-align: justify;"><span>) =&gt; ReturnType&lt;T&gt;) =&gt;<br/>(x,             y, z) =&gt;</span></p><p class="s17" style="padding-left: 86pt;text-indent: 0pt;line-height: 13pt;text-align: justify;">fn (x, y, z) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="6.11"><p class="s10" style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;">Throttling promises: <span class="p">Every time we actually do a call, we’ll set up a timer that will, in time,<br/>remove the promise from the cache. By default, let’s have a delay of 5 minutes. We’ll have a pool of</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 224pt;text-indent: 0pt;text-align: left;">Chapter 6, Producing Functions - Higher-Order Functions      533</p><p style="padding-top: 22pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>timers, one per promise. In case of an error when calling the API, we’ll remove both the rejected<br/>promise and its corresponding timer:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 64pt;text-indent: -11pt;line-height: 119%;text-align: left;"><span>const promiseThrottle = &lt;<br/>A,</span></p><p class="s17" style="padding-left: 64pt;text-indent: 0pt;line-height: 12pt;text-align: left;">T extends (. x: any[]) =&gt; Promise&lt;A&gt;</p><p class="s17" style="padding-top: 2pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">&gt;(</p><p class="s17" style="padding-top: 1pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">fn: T,</p><p class="s10" style="padding-top: 4pt;padding-left: 64pt;text-indent: 0pt;text-align: left;">delay = 300_000     /* 5 minutes */</p><p class="s17" style="padding-top: 2pt;padding-left: 64pt;text-indent: -11pt;line-height: 125%;text-align: left;"><span>): ((..,x: Parameters&lt;T&gt;) =&gt; Promise&lt;A&gt;) =&gt; {<br/>const cache = {} as Record&lt;string, Promise&lt;A&gt;&gt;;<br/></span><span class="s10">const timers = {} as Record&lt;</span></p><p class="s10" style="padding-top: 1pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">string,</p><p class="s10" style="padding-top: 4pt;padding-left: 76pt;text-indent: 0pt;text-align: left;">ReturnType&lt;typeof setTimeout&gt;</p><p class="s10" style="padding-top: 4pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">&gt;;</p><p class="s17" style="padding-top: 2pt;padding-left: 64pt;text-indent: 0pt;text-align: left;">return (...args) =&gt; {</p><p class="s17" style="padding-top: 2pt;padding-left: 77pt;text-indent: 0pt;line-height: 115%;text-align: left;"><span>const strX = JSON.stringify(args);<br/>if (!(strX in timers)) {</span></p><p class="s10" style="padding-top: 2pt;padding-left: 100pt;text-indent: -11pt;line-height: 144%;text-align: left;"><span>timers[strX] = setTimeout(() =&gt; {<br/>delete cache[strX];</span></p><p class="s10" style="padding-left: 100pt;text-indent: 0pt;line-height: 10pt;text-align: left;">delete timers[strX];</p><p class="s10" style="padding-top: 4pt;padding-left: 89pt;text-indent: 0pt;text-align: left;">}, delay);</p><p class="s17" style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">}</p><p class="s17" style="padding-left: 77pt;text-indent: 0pt;text-align: left;">return strX in cache</p><p class="s17" style="padding-top: 2pt;padding-left: 89pt;text-indent: 0pt;text-align: left;">? cache[strX]</p><p class="s17" style="padding-top: 2pt;padding-left: 112pt;text-indent: -22pt;line-height: 117%;text-align: left;"><span>: (cache[strX] = fn(...args).catch((x) =&gt; {<br/>delete cache[strX];</span></p><p class="s10" style="padding-top: 2pt;padding-left: 112pt;text-indent: 0pt;text-align: left;">delete timers[strX];</p><p class="s17" style="padding-top: 2pt;padding-left: 113pt;text-indent: 0pt;text-align: left;">return x;</p><p class="s17" style="padding-top: 4pt;padding-left: 101pt;text-indent: 0pt;text-align: left;">}));</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="6.12"><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><b>All operators called: </b><span>You would have all math operators (+, -, *, /, **, and %), all bitwise<br/>operators (&amp;, |, and </span><span class="s162">A</span><span>), all logical operators (&amp;&amp; and | |), all shift operators (&lt;&lt;, &gt;&gt;, and &gt;&gt;&gt;), all<br/>comparisons (&gt;, &gt;=, &lt;, &lt;=, ==, = ==, 1 =, and 1 ==), and the new nullish coalescing operator (??).</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">534  Answers to Questions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: justify;">The comma operator could be included as well. Checkout <span class="s245">developer. mozilla. org/en-US/<br/>docs/Web/JavaScript/Guide/Expressions_and_Operators for </span>more on this topic.</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="6.13"><p class="s10" style="padding-left: 52pt;text-indent: 0pt;line-height: 114%;text-align: justify;">Missing companion: <span class="p">A simple one-line version could be as follows. Here, we use spreading to<br/>get a shallow copy of the original object and then set the specified attribute to its new value by using a<br/>computed  property  name.  See  </span><span class="s245">developer  .mozilla.  org/en-US/docs/Web/JavaScript  /</span></p><p class="s17" style="padding-left: 52pt;text-indent: 0pt;line-height: 11pt;text-align: justify;">Ref erence/Operators/Obj ect_initializer <span class="s246">for more details:</span></p><p class="s17" style="padding-top: 10pt;padding-left: 73pt;text-indent: -11pt;line-height: 117%;text-align: left;"><span>const setField = &lt;D&gt;(<br/>attr: keyof D,<br/>value: any,</span></p><p class="s17" style="padding-left: 73pt;text-indent: 0pt;text-align: left;">obj : D</p><p class="s17" style="padding-top: 3pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">) =&gt; ({</p><p class="s17" style="padding-top: 1pt;padding-left: 75pt;text-indent: 0pt;text-align: left;">...obj,</p><p class="s17" style="padding-top: 1pt;padding-left: 76pt;text-indent: 0pt;text-align: left;">[attr]: value,</p><p class="s17" style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">});</p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;">In <i>Chapter 10, Ensuring Purity, </i><span>we wrote deepCopy (), which would be better than spreading<br/>when it comes to creating a totally new object instead of a shallow copy. By using this, we would have<br/>the following:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 73pt;text-indent: -12pt;line-height: 118%;text-align: left;"><span>const setField2 = &lt;D&gt;(<br/>attr: keyof D,</span></p><p class="s17" style="padding-left: 73pt;text-indent: 0pt;line-height: 117%;text-align: left;"><span>value: any,<br/>obj : D</span></p><p class="s17" style="padding-top: 1pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">) =&gt; ({</p><p class="s10" style="padding-top: 2pt;padding-left: 76pt;text-indent: 0pt;line-height: 143%;text-align: left;"><span>...deepCopy(obj),<br/>[attr]: value,</span></p><p class="s10" style="padding-top: 2pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">});</p><p style="padding-top: 8pt;padding-left: 52pt;text-indent: 0pt;line-height: 114%;text-align: left;">Finally, you could also look into modifying the <span class="s245">updateOb j ect () </span>function, also from <i>Chapter 10,</i>by removing the freezing code; I’ll leave it up to you.</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="6.14"><p style="padding-left: 74pt;text-indent: -22pt;text-align: left;"><b>A border case: </b>With plain JavaScript, applying the function to a <span class="s245">nul 1 </span>object would throw an error:</p><p class="s17" style="padding-top: 10pt;padding-left: 61pt;text-indent: 0pt;line-height: 117%;text-align: left;"><span>const getField = attr =&gt; obj =&gt; obj [attr] ;<br/>getField (&quot;someField&quot;) (null) ;</span></p><p class="s10" style="padding-top: 1pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">// Uncaught TypeError: Cannot read property &#39;a&#39; of null</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 224pt;text-indent: 0pt;text-align: left;">Chapter 6, Producing Functions - Higher-Order Functions      535</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>With TypeScript, the code won’t compile because first, &quot; someField&quot; isn’t the name of an attribute,<br/>and second, null is not a valid object:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">const getField =</p><p class="s17" style="padding-top: 2pt;padding-left: 66pt;text-indent: -1pt;line-height: 118%;text-align: left;"><span>&lt;D&gt;(f: keyof D) =&gt;<br/>(obj: D) =&gt;</span></p><p class="s17" style="padding-left: 76pt;text-indent: 0pt;line-height: 12pt;text-align: left;">Obj [f] ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>However, it’s still possible to do things “behind TypeScript’s back” and get the code accepted and the<br/>exception thrown. Having functions throw exceptions is not usually good in FP. You may opt to produce<br/>undefined instead, or work with monads, just like in </span><i>Chapter 12, Building Better Containers. </i><span>A safer<br/>version of getField () would add a safeguard and return obj &amp;&amp; obj [f] instead.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="6.15"><p class="s10" style="padding-left: 69pt;text-indent: -25pt;text-align: left;">Typed demethodizing: <span class="p">The three full definitions are as follows:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 52pt;text-indent: 0pt;text-align: left;">const demethodizel =</p><p class="s17" style="padding-top: 2pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">&lt; T extends (argO: any,  args: any[]) =&gt; any&gt;(fn: T) =&gt;</p><p class="s17" style="padding-top: 2pt;padding-left: 67pt;text-indent: 0pt;text-align: left;">(argO: any, args: Parameters&lt;T&gt;) =&gt;</p><p class="s17" style="padding-top: 2pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">fn.apply(argO, args);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 52pt;text-indent: 0pt;text-align: left;">const demethodize2 =</p><p class="s17" style="padding-top: 2pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">&lt; T extends (argO: any,  args: any[]) =&gt; any&gt;(fn: T) =&gt;</p><p class="s17" style="padding-top: 2pt;padding-left: 77pt;text-indent: -10pt;line-height: 117%;text-align: left;"><span>(argO:  any,  ...args:  Parameters&lt;T&gt;):  ReturnType&lt;T&gt;  =&gt;<br/>fn.call(argO,  args);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 52pt;text-indent: 0pt;text-align: left;">const demethodize3 =</p><p class="s17" style="padding-top: 2pt;padding-left: 67pt;text-indent: -2pt;line-height: 118%;text-align: left;"><span>&lt;  T  extends  (argO:  any,  ...args:  any[])  =&gt;  any&gt;(fn:  T)  =&gt;<br/>(argO: any,  args: Parameters&lt;T&gt;): ReturnType&lt;T&gt; = &gt;</span></p><p class="s17" style="padding-left: 77pt;text-indent: 0pt;line-height: 13pt;text-align: left;">fn.bind(argO, args)();</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="6.16"><p class="s10" style="padding-left: 69pt;text-indent: -25pt;text-align: left;">Not reinventing the wheel: <span class="p">We can use Math. max () and Math. min () as follows:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 64pt;text-indent: -11pt;line-height: 142%;text-align: left;">const findMaximum2 = findOptimum2((x, y) <span class="s10">=&gt; Math.max(x,<br/>y))                                                                 ;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 64pt;text-indent: -11pt;line-height: 148%;text-align: left;">const findMinimum2 = findOptimum2((x, y) <span class="s10">=&gt; Math.min(x,<br/>y));</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">536  Answers to Questions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">Another way of writing this could be achieved by defining the following first:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 61pt;text-indent: 0pt;text-align: left;">const max = (...arr: number[]): number =&gt; Math.max(...arr);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 61pt;text-indent: 0pt;text-align: left;">const min = (...arr: number[]): number =&gt; Math.min(...arr);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">Then, we could write in a pointfree style:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 61pt;text-indent: 0pt;line-height: 234%;text-align: left;"><span>const findMaximum3 = findOptimum2(max);<br/>const findMinimum3 = find0ptimum2(min);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="6.17"><p class="s10" style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;">Comparing heroes: <span class="p">The first suggested change wouldn’t allow for ties in some features, where<br/>no hero beats the other. And, in fact, this points out a problem in our logic; if the first hero doesn’t<br/>beat the second one, we assume that the latter beat the former, not allowing for ties between heroes.</span></p></li></ol></ol><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-top: 8pt;padding-left: 52pt;text-indent: 0pt;line-height: 122%;text-align: left;"><a name="bookmark536"><span>Chapter 7,  Transforming Functions - Currying and Partial<br/>Application</span></a><a name="bookmark537">&zwnj;</a></p><ol id="l190"><ol id="l191"><li data-list-text="7.1"><p class="s10" style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;">Hard by hand: <span class="p">It would work; sum (3 ) returns a function with 3 already bound; sum (3 ) ()<br/>returns the same, and sum (3 ) () (5) produces the result.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="7.2"><p class="s10" style="padding-left: 73pt;text-indent: -20pt;text-align: justify;">Sum as you will: <span class="p">The following sumMany () function does the job:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 73pt;text-indent: -11pt;line-height: 133%;text-align: left;"><a name="bookmark538">const sumMany = </a><span class="s10">(total: number) =&gt; (value?: number) =&gt;<br/>value === undefined ? total : sumMany(total + value);</span><a name="bookmark539">&zwnj;</a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 62pt;text-indent: 0pt;text-align: left;">sumMany(2)(2)(9)(6)(0)(-3)(); // 16</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>In JavaScript, the function poses no problem; with TypeScript, we’ll get an objection because it cannot<br/>determine that sumMany (2) is a function, not a number.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">A small detail: can you fix the function so sumMany () will return 0?</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="7.3"><p class="s10" style="padding-top: 6pt;padding-left: 73pt;text-indent: -20pt;text-align: justify;">Curry with eval? <span class="p">Let’s see this in JavaScript first:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// curryByEval.j s</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 183pt;text-indent: 0pt;text-align: left;">Chapter 7,Transforming Functions - Currying and Partial Application       537</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 53pt;text-indent: 0pt;text-align: left;">function curryByEval(fn) {</p><p class="s17" style="padding-top: 2pt;padding-left: 64pt;text-indent: 0pt;text-align: left;">return eval(&#39;${range(0, fn.length)</p><p class="s17" style="padding-top: 2pt;padding-left: 78pt;text-indent: 0pt;text-align: left;">,map((i) =&gt; ~x${i}~)</p><p class="s17" style="padding-top: 2pt;padding-left: 78pt;text-indent: 0pt;text-align: left;">.join(&quot;=&gt;&quot;)} =&gt; ${fn.name}(${range(0, fn.length)</p><p class="s17" style="padding-top: 2pt;padding-left: 78pt;text-indent: 0pt;text-align: left;">.map((i) =&gt; ~x${i}&#39;)</p><p class="s17" style="padding-top: 2pt;padding-left: 78pt;text-indent: 0pt;text-align: left;">.join (&quot;,&quot;)})&#39;);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>This is quite a chunk of code to digest, and, in fact, it should instead be coded in several separate lines<br/>to make it more understandable. Let’s see how this works when applied to the make 3 () function<br/>as input:</span></p><ol id="l192"><li data-list-text="1."><p style="padding-top: 7pt;padding-left: 71pt;text-indent: -18pt;text-align: left;">The <span class="s245">range () </span>function produces an array with the <span class="s245">[0,1,2] </span>values.</p></li><li data-list-text="2."><p style="padding-top: 6pt;padding-left: 70pt;text-indent: -18pt;text-align: left;">We use map () to generate a new array with the [&quot; xO&quot;, &quot; xl&quot;, &quot; x2 &quot; ] values.</p></li><li data-list-text="3."><p style="padding-top: 4pt;padding-left: 70pt;text-indent: -17pt;line-height: 114%;text-align: left;">We use <span class="s245">j oin () </span>on the values in that array to produce <span class="s245">x0 = &gt;xl = &gt;x2, </span><span>which will be the<br/>beginning of the code that we will evaluate.</span></p></li><li data-list-text="4."><p class="s9" style="padding-top: 5pt;padding-left: 70pt;text-indent: -18pt;line-height: 107%;text-align: left;">We <span class="p">then add an arrow, the function’s name, and an opening parenthesis, to make the middle<br/>part of our newly generated code: = &gt; </span><span class="s245">make 3 (.</span></p></li><li data-list-text="5."><p class="s33" style="padding-top: 5pt;padding-left: 70pt;text-indent: -17pt;line-height: 123%;text-align: left;">	<span class="p">We use range () , map () , and j oin () again, but this time, to generate a list of<br/>arguments: xO , xl, x2.</span></p></li><li data-list-text="6."><p style="padding-top: 4pt;padding-left: 70pt;text-indent: -18pt;line-height: 123%;text-align: left;"><span>We finally add a closing parenthesis, and after applying eval (), we get the curried version<br/>of make3 ().</span></p></li></ol><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: justify;">After following all these steps, in our case, the resulting function would be as follows:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 52pt;text-indent: 0pt;text-align: left;">curryByEval(make3); <span class="s10">// x0=&gt;xl=&gt;x2 =&gt; make3(x0,xl,x2)</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Typing is essentially the same as for our curry () function since we are getting the same parameter<br/>and producing the same output. Note, however, that we’re definitely “lying” to TypeScript because it<br/>wouldn’t be able to deduce what eval () was returning; it’s really up to us not to mess up! Without<br/>further ado, we can write the following:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 65pt;text-indent: -12pt;line-height: 144%;text-align: left;"><span>function curryByEval&lt;A extends any[], R&gt;(<br/>fn: (.</span><span class="p"> </span>args: A) =&gt; R</p><p class="s10" style="padding-left: 53pt;text-indent: 0pt;line-height: 10pt;text-align: left;">): Curry&lt;A, R&gt;;</p><p class="s10" style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">function curryByEval(fn: (.<span class="p"> </span>args: any) =&gt; any) {</p><p class="s17" style="padding-top: 2pt;padding-left: 64pt;text-indent: 0pt;text-align: left;">const pp = &#39;${range(0, fn.length)</p><p class="s17" style="padding-top: 2pt;padding-left: 78pt;text-indent: 0pt;text-align: left;">.map((i) =&gt; &#39;x${i}&#39;)</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-left: 20pt;text-indent: 0pt;text-align: left;">538  <span class="s189">Answers to Questions</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-top: 4pt;padding-left: 87pt;text-indent: 0pt;text-align: left;">.join(&quot;=&gt;&quot;)} =&gt; ${fn.name}(${range(0, fn.length)</p><p class="s17" style="padding-top: 2pt;padding-left: 87pt;text-indent: 0pt;text-align: left;">.map((i) =&gt; &#39;x${i}&#39;)</p><p class="s17" style="padding-top: 2pt;padding-left: 87pt;text-indent: 0pt;text-align: left;">.join(&quot;,&quot;)})&#39;;</p><p class="s17" style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>We see we can do currying by using eval () - but there’s one remaining problem: if the original<br/>function didn’t have a name, the transformation wouldn’t work. We can work around the function<br/>name problem by including the actual code of the function to be curried:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 74pt;text-indent: -12pt;line-height: 117%;text-align: left;"><span>function curryByEval2&lt;A extends any[], R&gt;(<br/>fn: (...args: A) =&gt; R</span></p><p class="s17" style="padding-left: 62pt;text-indent: 0pt;text-align: left;">): Curry&lt;A, R&gt;;</p><p class="s17" style="padding-top: 2pt;padding-left: 73pt;text-indent: -11pt;line-height: 119%;text-align: left;"><span>function curryByEval2(fn: (...args: any) =&gt; any) {<br/>return eval(&#39;${range(0, fn.length)</span></p><p class="s17" style="padding-left: 87pt;text-indent: 0pt;line-height: 12pt;text-align: left;">.map((i) =&gt; &#39;x${i}&#39;)</p><p class="s17" style="padding-top: 2pt;padding-left: 87pt;text-indent: 0pt;text-align: left;">.join(&quot;=&gt;&quot;)} =&gt;</p><p class="s10" style="padding-top: 4pt;padding-left: 87pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>(${fn.toSbring()})<br/>(${range(0, fn.length)</span></p><p class="s10" style="padding-left: 99pt;text-indent: 0pt;line-height: 10pt;text-align: left;">.map((i)   =&gt;   &#39;x${i}&#39;)</p><p class="s10" style="padding-top: 4pt;padding-left: 99pt;text-indent: 0pt;text-align: left;">.joint&quot;, &quot;)})&#39;);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: justify;">The only change is that instead of including the original function name, we substitute its actual code:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 61pt;text-indent: 0pt;text-align: left;">curryByEval2(make3);</p><p class="s17" style="padding-top: 2pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">// x0=&gt;xl=&gt;x2=&gt; <span class="s10">((a, b, c) =&gt; &#39;${a}:${b}:${c}&#39;) </span>(xO,xl,x2)</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="7.4"><p class="s10" style="padding-left: 73pt;text-indent: -21pt;text-align: left;">Uncurrying the curried: <span class="p">We can work similarly to what we did in the previous question:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 73pt;text-indent: -12pt;line-height: 118%;text-align: left;"><span>const  uncurry  =  (fn,  len)  =&gt;<br/>eval (</span></p><p class="s17" style="padding-left: 86pt;text-indent: 0pt;line-height: 13pt;text-align: left;">&#39;(${range(0, len)</p><p class="s17" style="padding-top: 2pt;padding-left: 99pt;text-indent: 0pt;text-align: left;">.map((i) =&gt; &#39;x${i}&#39;)</p><p class="s17" style="padding-top: 2pt;padding-left: 99pt;text-indent: 0pt;text-align: left;">.joint&quot;,&quot;)})   =&gt;   ${fn.name}${range(0,   len)</p><p class="s17" style="padding-top: 2pt;padding-left: 99pt;text-indent: 0pt;text-align: left;">.map((i) =&gt; &#39;(x${i})&#39;)</p><p class="s17" style="padding-top: 2pt;padding-left: 99pt;text-indent: 0pt;text-align: left;">.j oin(&quot;&quot;)}&#39;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 183pt;text-indent: 0pt;text-align: left;">Chapter 7,Transforming Functions - Currying and Partial Application       539</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: left;">Earlier, when currying, given an f n () function with an arity of 3, we would have generated the following:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 52pt;text-indent: 0pt;text-align: left;">x0=&gt;xl=&gt;x2=&gt; make3(xO,xl,x2)</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>Now, to uncurry a function (say, curriedFn ()), we want to do something very similar: the only<br/>difference is the placement of the parentheses:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 54pt;text-indent: 0pt;text-align: left;">(x0,xl,x2) =&gt; curriedFn(xO)(xl)(x2)</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: left;">The expected behavior is as follows - and let’s use the last result from the previous question:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 66pt;text-indent: -14pt;line-height: 115%;text-align: left;"><span>const curriedMake3 = (xO) =&gt; (xl) =&gt; (x2) =&gt;<br/>((a, b, c) =&gt; &#39;$ {a}:${b}:${c}&#39;) (xO, xl, x2) ;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 53pt;text-indent: 0pt;text-align: left;">console.log(uncurry(curriedMake3, 3).toString() ) ;</p><p class="s10" style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// (x0,xl,x2) =&gt; curriedMake3(xO)(xl)(x2)</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>If you want to consider a case in which the function to “uncurry” has no name, you can apply the same<br/>change we did in the previous question and include f n. toString () in the output.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="7.5"><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><b>Let me count the ways: </b>If the function has <i>n </i>parameters, there are 2<span class="s162">n l </span><span>ways of calling it. This<br/>means that our three-parameter function could be called in 2</span><span class="s162">2</span><span>=4 ways (correct!), a function with two<br/>parameters would allow 2‘=2 ways, and a function with just one parameter would allow only 2°=1 way.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="7.6"><p class="s10" style="padding-left: 64pt;text-indent: -20pt;text-align: left;">Currying by prototype: <span class="p">Basically, we are just transforming the curry () version so that it uses this:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 64pt;text-indent: -11pt;line-height: 115%;text-align: left;"><span>Function.prototype.curry = function () {<br/>return this.length === 0</span></p><p class="s17" style="padding-left: 77pt;text-indent: 0pt;text-align: left;">? this()</p><p class="s17" style="padding-top: 2pt;padding-left: 78pt;text-indent: 0pt;text-align: left;">: (p) =&gt; this.bind(this, p).curry();</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="7.7"><p class="s10" style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;">Shorter typing: <span class="p">The suggested earlier test shortens the code. We are essentially saying </span><i>“if there’s</i></p><p class="s17" style="padding-top: 8pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">type Curry2&lt;P, R&gt; = P extends [infer H, infer T]</p><p class="s17" style="padding-top: 2pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">? (arg: H) =&gt; Curry2&lt;[. T] , R&gt;</p><p class="s17" style="padding-top: 3pt;padding-left: 66pt;text-indent: 0pt;text-align: left;">: R;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 20pt;text-indent: 0pt;text-align: left;">540  <span class="s164">Answers to Questions</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="7.8"><p class="s10" style="padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: left;">Counting arguments: <span class="p">We can check whether P has a single type by checking P [&quot; 1 ength&quot; ] as<br/>follows - and to access that single type, we’ll have to write P [ 0 ]:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">type Curry&lt;P extends any[], R&gt; = <span class="s10">1 extends P[&quot;length&quot;]</span></p><p class="s10" style="padding-top: 1pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">? (arg: P[0]) =&gt; <span class="s17">R // only 1 arg</span></p><p class="s17" style="padding-top: 2pt;padding-left: 75pt;text-indent: 0pt;text-align: left;">: P extends [infer H, ...infer T] // 2 or more args</p><p class="s17" style="padding-top: 2pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">? (arg: H) =&gt; Curry&lt; [...T] , R&gt;</p><p class="s17" style="padding-top: 2pt;padding-left: 75pt;text-indent: 0pt;text-align: left;">: never;</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="7.9"><p class="s10" style="padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: left;">Working stylishly: <span class="p">We can do currying by hand for applyStyle () or by using our curry ()<br/>function - let’s see both ways:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 76pt;text-indent: -14pt;line-height: 114%;text-align: left;"><span>const applyStyle =<br/>(style: string) =&gt;</span></p><p class="s17" style="padding-left: 86pt;text-indent: -10pt;line-height: 118%;text-align: left;"><span>(text: string): string =&gt;<br/>&#39;&lt;${style}&gt;${text}&lt;/${style}&gt;&#39; ;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 61pt;text-indent: 0pt;text-align: left;"><a name="bookmark540">const makeBold </a><span class="s10">= applyStyle(&quot;b&quot;);</span></p><p class="s17" style="padding-top: 2pt;padding-left: 61pt;text-indent: 0pt;text-align: left;"><a name="bookmark541">console.log(makeBold(&quot;Montevideo&quot;));</a></p><p class="s10" style="padding-top: 3pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">// &lt;b&gt;Montevideo&lt;/b&gt;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-top: 6pt;padding-left: 74pt;text-indent: -13pt;line-height: 237%;text-align: left;"><span>const applyStyle2 = (style: string, text: string): string<br/>&#39;&lt;${style}&gt;${text}&lt;/${style}&gt;&#39; ;</span></p><p class="s17" style="padding-left: 61pt;text-indent: 0pt;line-height: 12pt;text-align: left;"><a name="bookmark542">const makeUnderline = </a><span class="s10">curry(applyStyle2)(&quot;u&quot;);</span></p><p class="s17" style="padding-top: 2pt;padding-left: 61pt;text-indent: 0pt;text-align: left;"><a name="bookmark543">console.log(makeUnderline(&quot;Uruguay&quot;));</a></p><p class="s10" style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">// &lt;u&gt;Uruguay&lt;/u&gt;</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="7.10"><p class="s10" style="padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: left;">Mystery questions function: <span class="p">It implements partial currying; a more understandable and better-<br/>named version of the what () function is as follows:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 76pt;text-indent: -14pt;line-height: 114%;text-align: left;"><span>const partial =<br/>(fn) =&gt;</span></p><p class="s17" style="padding-left: 76pt;text-indent: 0pt;text-align: left;">( . . .params) =&gt;</p><p class="s17" style="padding-top: 2pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">fn.length &lt;= params.length</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 179pt;text-indent: 0pt;text-align: left;">Chapter 8, Connecting Functions - Pipelining, Composition, and More       541</p><p class="s17" style="padding-top: 20pt;padding-left: 89pt;text-indent: 0pt;text-align: left;">? fn(. params)</p><p class="s17" style="padding-top: 2pt;padding-left: 90pt;text-indent: 0pt;text-align: left;">: (. otherParams) =&gt;</p><p class="s17" style="padding-top: 2pt;padding-left: 112pt;text-indent: 0pt;text-align: left;">partial(fn)(...params, otherParams);</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="7.11"><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><b>Partial transformations: </b>Just apply the same transformation as in <i>Question 7.6 - </i><span>take the original<br/>code we wrote, and replace all references to the function with references to this.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="7.12"><p class="s10" style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;">Yet more curry! <span class="p">The curryN () function is an alternative version of our partialCurry ().<br/>The only difference is that if you provide all the arguments to a function, this new curryN () function<br/>directly calls the curried function, while partialCurry () would first bind the function to all its<br/>arguments and then recursively call it to return the final result - but the result would be precisely<br/>the same.</span></p></li></ol></ol><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 121%;text-align: left;"><a name="bookmark544"><span>Chapter 8,  Connecting Functions - Pipelining,<br/>Composition, and More</span></a></p><ol id="l193"><ol id="l194"><li data-list-text="8.1"><p style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;line-height: 111%;text-align: justify;"><b>Headline capitalization: </b><span>We can make use of several functional equivalents of different methods,<br/>such as </span><span class="s245">split (), map (), </span>and <span class="s245">j oin (). </span>Using <span class="s245">demethodize () </span>from <i>Chapter </i>6, <i>Producing</i>and f lipTwo () from <i>Chapter </i>7, <i>Transforming Functions, </i>would have also been possible:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 64pt;text-indent: -12pt;line-height: 118%;text-align: left;"><span>const  split  =  (str:  string)  =&gt;  (text:  string)  =&gt;<br/>text.split(str);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 52pt;text-indent: 0pt;text-align: left;">const map =</p><p class="s17" style="padding-top: 2pt;padding-left: 76pt;text-indent: -9pt;line-height: 117%;text-align: left;"><span>(fn:  (x:  string)  =&gt;  string)  =&gt;  (arr:  string!])  =&gt;<br/>arr.map(fn);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 64pt;text-indent: -11pt;line-height: 117%;text-align: left;"><span>const firstToUpper = (word: string): string =&gt;<br/>word[0].toUpperCase() + word.substring(1).toLowerCase();</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 64pt;text-indent: -12pt;line-height: 114%;text-align: left;"><span>const  join  =  (str:  string)  =&gt;  (arr:  string!])  =&gt;<br/>arr.j oin(str) ;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 65pt;text-indent: -12pt;line-height: 132%;text-align: left;">const headline <span class="s10">= pipeline(<br/>split(&quot; &quot;),</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">542  Answers to Questions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 73pt;text-indent: 0pt;line-height: 146%;text-align: left;"><a name="bookmark545"><span>map(firstToUpper),<br/>join(&quot; &quot;)</span></a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>The pipeline works as expected: we split the string into words, we map each word to make its first letter<br/>uppercase, and we join the array elements to form a string again. We could have used reduce () for</span></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 10pt;text-align: left;">the last step, but j oin () already does what we need, so why reinvent the wheel?</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 61pt;text-indent: 0pt;text-align: justify;">console.log(headline(&quot;Alice&#39;s ADVENTURES in WoNdErLaNd&quot;));</p><p class="s17" style="padding-top: 2pt;padding-left: 62pt;text-indent: 0pt;text-align: justify;">// Alice&#39;s Adventures In Wonderland</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="8.2"><p class="s10" style="padding-left: 70pt;text-indent: -17pt;text-align: left;">Pending tasks: <span class="p">The following pipeline does the job:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 73pt;text-indent: -12pt;line-height: 117%;text-align: justify;"><span>const getField = attr =&gt; obj =&gt; obj [attr] ; const filter =<br/>fn =&gt; arr =&gt; arr.filter(fn); const map = fn =&gt; arr =&gt;<br/>arr.map(fn);</span></p><p class="s17" style="padding-left: 61pt;text-indent: 0pt;text-align: justify;">const reduce = (fn, init) =&gt; arr =&gt; arr.reduce(fn, init);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 61pt;text-indent: 0pt;line-height: 115%;text-align: left;"><span>const pending = (listOfTasks, name) =&gt; pipeline(<br/>getField(&quot;byPerson&quot;),</span></p><p class="s17" style="padding-left: 61pt;text-indent: 0pt;line-height: 115%;text-align: left;"><span>filter(t =&gt; t.responsible === name), map(t =&gt; t.tasks),<br/>reduce((y, x) =&gt; x, []), filter(t =&gt; t &amp;&amp; It.done),</span></p><p class="s17" style="padding-left: 73pt;text-indent: 0pt;text-align: left;">map(getField(&quot;id&quot;))</p><p class="s17" style="padding-top: 2pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">)(allTasks || {byPerson: []}); //</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: justify;">The reduce () call may be mystifying. By that time, we are handling an array with a single element</p><p style="padding-top: 2pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>- an object - and we want the object in the pipeline, not the array. This code works even if the<br/>responsible person doesn’t exist, or if all the tasks have been completed; can you see why? Also, note<br/>that if allTasks is null, an object must be provided with the byPerson property so that future<br/>functions won’t crash! For an even better solution, I think monads are better: see </span><i>Question 12.1 </i>for more.</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="8.3"><p class="s10" style="padding-left: 52pt;text-indent: 0pt;line-height: 126%;text-align: left;">Thinking in abstract terms: <span class="p">The simple solution implies composing. I preferred it to pipelining<br/>in order to keep the list of functions in the same order:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">const getSomeResults2 = compose(sort, group, filter, select);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 179pt;text-indent: 0pt;text-align: left;">Chapter 8, Connecting Functions - Pipelining, Composition, and More       543</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="8.4"><p class="s10" style="padding-left: 61pt;text-indent: -18pt;text-align: left;">Reversing types: <span class="p">We can apply recursion to reverse a list of types:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 52pt;text-indent: 0pt;text-align: left;">type Reverse&lt;FNS extends FN[]&gt; = 1 extends FNS[&quot;length&quot;]</p><p class="s17" style="padding-top: 2pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">? [FNS [0]]</p><p class="s17" style="padding-top: 2pt;padding-left: 66pt;text-indent: 0pt;text-align: left;">: FNS extends [</p><p class="s17" style="padding-top: 2pt;padding-left: 89pt;text-indent: 0pt;text-align: left;">infer FNlst extends FN,</p><p class="s17" style="padding-top: 2pt;padding-left: 90pt;text-indent: 0pt;text-align: left;">...infer FNRest extends FN[]</p><p class="s17" style="padding-top: 2pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">]</p><p class="s17" style="padding-top: 1pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">? [...Reverse&lt;FNRest&gt;, FNlst]</p><p class="s17" style="padding-top: 2pt;padding-left: 66pt;text-indent: 0pt;text-align: left;">: never;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: left;">With this, we can define Compose&lt; &gt; in terms of Pipeline&lt; &gt;:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 52pt;text-indent: 0pt;text-align: left;">type Compose&lt;FNS extends FN[]&gt; = <span class="s10">Pipeline&lt;Reverse&lt;FNS&gt;&gt;;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 53pt;text-indent: 0pt;text-align: left;">function composel&lt;FNS extends FN[]&gt;(</p><p class="s17" style="padding-top: 2pt;padding-left: 66pt;text-indent: 0pt;text-align: left;">. . .fns: FNS</p><p class="s17" style="padding-top: 2pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">) : Compose&lt;FNS&gt; {</p><p class="s10" style="padding-top: 4pt;padding-left: 64pt;text-indent: 0pt;text-align: left;">return pipeline(...fns.reverse()) as Compose&lt;FNS&gt;;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: left;">Instead of an overload, we’re using a cast here to let TypeScript know what types we are working with.</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="8.5"><p class="s10" style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;">Empty pipeline? <span class="p">The pipeline () function we wrote accesses fns [0] without checking whether<br/>the fns array is empty, so it won’t work. The pipelinel () and pipeline2 () functions use<br/>reduce () without an initial value, so they will also fail. We must add an initial test, so if no functions<br/>are provided (fns . length= = = 0), we’ll simply return the input value as the result.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="8.6"><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><b>Undetected impurity? </b><span>Yes, the function is impure, but using it as-is would fall squarely under<br/>the </span><b>Sorta Functional Programming (SFP) </b>style we mentioned back in the <i>Theory versus practice</i>section of <i>Chapter 1, Becoming Functional. </i><span>The version we used is not pure, but in the way we use it,<br/>the final results are pure: we modify an array in place, but it’s a new array that we are creating. The<br/>alternate implementation is pure and also works, but will be slower since it creates a completely new<br/>array every time we call it. So, accepting this bit of impurity helps us get a function that performs<br/>better; we can accept that!</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">544  Answers to Questions</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="8.7"><p class="s10" style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;">Needless transducing? <span class="p">If you only had a sequence of map () operations, you could apply a<br/>single map () by pipelining all the mapping functions into a single one. For filter () operations,</span></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>it becomes a bit harder, but here’s a tip: use reduce () to apply all the filters in sequence with a<br/>carefully thought-out accumulating function.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="8.8"><p style="padding-left: 71pt;text-indent: -18pt;text-align: left;"><b>What type? </b>According to the definition of <span class="s245">chainify (), </span>the type of <span class="s245">myCity2 </span>is <span class="s245">Chainif y&lt;City&gt;.</span></p></li></ol></ol><p style="padding-top: 2pt;padding-left: 52pt;text-indent: 0pt;text-align: left;"><span>Attributes have the same types as before, but the void-returning methods now return an object of<br/>the same </span><span class="s245">Chainify&lt;City&gt; </span>type:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-top: 4pt;padding-left: 63pt;text-indent: 0pt;line-height: 13pt;text-align: left;">{</p><p class="s17" style="padding-left: 85pt;text-indent: 0pt;line-height: 118%;text-align: left;"><span>name: string;<br/>lat: number;<br/>long: number;<br/>extra: boolean;</span></p><p class="s17" style="padding-left: 85pt;text-indent: 0pt;line-height: 12pt;text-align: left;">getName: () =&gt; string;</p><p class="s10" style="padding-top: 4pt;padding-left: 86pt;text-indent: 0pt;line-height: 143%;text-align: left;"><span>setName: (newName: string) =&gt; Chainify&lt;City&gt;;<br/>setLat: (newLat: number) =&gt; Chainify&lt;City&gt;;<br/>setLong: (newLong: number) =&gt; Chainify&lt;City&gt;;</span></p><p class="s17" style="padding-left: 85pt;text-indent: 0pt;line-height: 11pt;text-align: left;">getCoords: () =&gt; number!];</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-top: 5pt;padding-left: 52pt;text-indent: 0pt;text-align: left;"><a name="bookmark546">Chapter 9,  Designing Functions - Recursion</a></p><ol id="l195"><ol id="l196"><li data-list-text="9.1"><p class="s10" style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: left;">Into reverse: <span class="p">An empty string is reversed by simply doing nothing. To reverse a non-empty string,<br/>remove its first character, reverse the rest, and append the removed character at the end. For example,</span></p><p class="s17" style="padding-left: 53pt;text-indent: 0pt;line-height: 11pt;text-align: left;">reverse (&quot;MONTEVIDEO&quot;) <span class="s246">can be found by doing </span>reverse (&quot;ONTEVIDEO&quot;) + <span class="s246">&quot;M&quot;. In the same</span></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">way, <span class="s245">reverse (&quot;ONTEVIDEO&quot; ) </span>would be equal to <span class="s245">reverse (&quot;NTEVIDEO&quot;) + &quot;O&quot;, </span>and so on:</p><p class="s17" style="padding-top: 10pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">const reverse = (str: string): string =&gt;</p><p class="s17" style="padding-top: 2pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">str.length === 0 ? &quot;&quot; : <span class="s10">reverse(str.slice(1)) + str[0];</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="9.2"><p style="padding-left: 72pt;text-indent: -19pt;text-align: left;"><b>Climbing steps: </b>To climb a ladder with <i>n </i>steps, we can act in two ways:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l197"><li data-list-text="•"><p style="padding-left: 79pt;text-indent: -13pt;text-align: left;">Climb one single step and then climb an (n-1) steps ladder</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 79pt;text-indent: -13pt;text-align: left;">Climb two steps at once and then climb an (»-2) steps ladder</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 276pt;text-indent: 0pt;text-align: left;">Chapter 9, Designing Functions - Recursion     545</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: justify;">So, if we call ladder(n) the number of ways to climb a steps ladder, we know that ladder(n)= ladder(n-l)</p><p style="padding-top: 2pt;padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>+ ladder(n-2). Adding the fact that ladder(0)=l (there’s only one way to climb a ladder with no steps:<br/>do nothing) and ladder(l)=l, the solution is that ladder(n) equals the (n-1 )</span><span class="s162">th </span><span>Fibonacci number! Check<br/>it out: ladder(2)=2, ladder(3)=3, ladder(4)=5, and so on.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p></li></ul></li><li data-list-text="9.3"><p class="s10" style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;">Sorting recursively: <span class="p">Let’s look at the first of these algorithms; many of the techniques here will help<br/>you write the other sorts. If the array is empty, sorting it produces a (new) empty array. Otherwise, we<br/>find the maximum value of the array (max), create a new copy of the array but without that element,<br/>sort the copy, and then return the sorted copy with max added at the end. Take a look at how we dealt<br/>with the mutator functions to avoid modifying the original array and note that this sorting code only<br/>works with numbers because of the way we find max:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 65pt;text-indent: -12pt;line-height: 115%;text-align: left;"><span>const  selectionSort  =  (arr:  number!]):  number!]  =&gt;  {<br/>if (arr.length === 0) {</span></p><p class="s10" style="padding-top: 2pt;padding-left: 76pt;text-indent: 0pt;text-align: left;">return [] ;</p><p class="s17" style="padding-top: 2pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">} else {</p><p class="s17" style="padding-top: 1pt;padding-left: 76pt;text-indent: 0pt;text-align: left;">const max = Math.max(. arr);</p><p class="s17" style="padding-top: 2pt;padding-left: 76pt;text-indent: 0pt;text-align: left;">const rest = [. arr];</p><p class="s17" style="padding-top: 2pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">rest.splice(arr.indexOf(max), 1) ;</p><p class="s10" style="padding-top: 4pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">return [.<span class="p"> </span>selectionSort(rest), max];</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 53pt;text-indent: 0pt;text-align: left;">selectionSort( [2, 2, 0, 9, 1, 9, 6, 0] ) ;</p><p class="s10" style="padding-top: 3pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// [0, 0, 1, 2, 2, 6, 9, 9]</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="9.4"><p class="s10" style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;">What could go wrong? <span class="p">This would fail if, at any time, the array (or subarray) to be sorted consisted<br/>of all equal values. In that case, smaller would be an empty array, and greaterEqual would be<br/>equal to the whole array to sort, so the logic would enter an infinite loop.</span></p><p style="padding-top: 7pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>The original code can never enter a loop because every pass removes one element (the pivot) so you’re<br/>guaranteed to reach a state with nothing left to sort.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="9.5"><p class="s10" style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;">More efficiency: <span class="p">The following code does the work for us. Here, we use a ternary operator to<br/>decide where to push the new item:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">const partition = &lt;A&gt;(</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">546  Answers to Questions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 73pt;text-indent: 0pt;text-align: left;">arr : A [] ,</p><p class="s17" style="padding-top: 2pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">fn: (x: A) =&gt; boolean</p><p class="s17" style="padding-top: 2pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">) : [A[] , A [] ] =&gt;</p><p class="s17" style="padding-top: 1pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">arr.reduce(</p><p class="s17" style="padding-top: 2pt;padding-left: 88pt;text-indent: 0pt;text-align: left;">(result: [A[] , A[] ] , elem: A) =&gt; {</p><p class="s17" style="padding-top: 2pt;padding-left: 97pt;text-indent: 0pt;line-height: 117%;text-align: left;"><span>result[fn(elem) ? 0 : 1].push(elem);<br/>return result;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 88pt;text-indent: 0pt;text-align: left;">[[], []]</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="9.6"><p class="s10" style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;">Completing callbacks: <span class="p">Code is very much along the same lines as mapR (), so I’ll skip repeating<br/>explanations - the only difference is in the return value, which is now a value from the array</span></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">(ar r [ 0 ] in f indLoop ()) instead of a mapped whole array as in mapR ():</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 61pt;text-indent: 0pt;text-align: left;">type Opt&lt;X&gt; = X | undefined;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 73pt;text-indent: -11pt;line-height: 115%;text-align: left;"><span>const findR = &lt;A&gt;(<br/>orig: Opt&lt;A&gt; [] ,</span></p><p class="s17" style="padding-left: 73pt;text-indent: 0pt;text-align: left;">cb: (x: A, i: number, a: Opt&lt;A&gt;[]) =&gt; boolean</p><p class="s17" style="padding-top: 2pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">): Opt&lt;A&gt; =&gt; {</p><p class="s17" style="padding-top: 2pt;padding-left: 85pt;text-indent: -12pt;line-height: 115%;text-align: left;"><span>const findLoop = (arr: Opt&lt;A&gt;[], i: number): Opt&lt;A&gt; =&gt;<br/>arr.length === 0</span></p><p class="s17" style="padding-left: 98pt;text-indent: 0pt;text-align: left;">? undefined</p><p class="s17" style="padding-top: 2pt;padding-left: 99pt;text-indent: 0pt;text-align: left;">: !(0 in arr) || arr[0] === undefined</p><p class="s17" style="padding-top: 2pt;padding-left: 98pt;text-indent: 0pt;text-align: left;">? findLoop(arr.slice(1), I + 1)</p><p class="s17" style="padding-top: 2pt;padding-left: 99pt;text-indent: 0pt;text-align: left;">: cb(arr[0], i, orig)</p><p class="s17" style="padding-top: 2pt;padding-left: 98pt;text-indent: 0pt;text-align: left;">? arr [0]</p><p class="s17" style="padding-top: 2pt;padding-left: 73pt;text-indent: 25pt;line-height: 234%;text-align: left;"><span>: findLoop(arr.slice(1), i + 1);<br/>return findLoop(orig, 0) ;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="9.7"><p class="s10" style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;">Recursive logic: <span class="p">Again, we can take inspiration from our mapR () example, so I won’t comment<br/>on the looping, types, and so on. When programming everyR (), we must be careful what to do</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 276pt;text-indent: 0pt;text-align: left;">Chapter 9, Designing Functions - Recursion     547</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>with empty arrays or missing places; the standard every () method considers them to return true,<br/>so we’ll do the same:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">type Opt&lt;X&gt; = X | undefined;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 64pt;text-indent: -11pt;line-height: 118%;text-align: left;"><span>const everyR = &lt;A&gt;(<br/>orig: Opt&lt;A&gt; [] ,</span></p><p class="s17" style="padding-left: 64pt;text-indent: 0pt;line-height: 13pt;text-align: left;">cb: (x: A, i: number, a: Opt&lt;A&gt;[]) =&gt; boolean</p><p class="s17" style="padding-top: 2pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">): boolean =&gt; {</p><p class="s17" style="padding-top: 2pt;padding-left: 76pt;text-indent: -12pt;line-height: 117%;text-align: left;"><span>const everyLoop = (arr: Opt&lt;A&gt;[], i: number): boolean =&gt;<br/>arr.length === 0</span></p><p class="s17" style="padding-left: 89pt;text-indent: 0pt;text-align: left;">? true</p><p class="s17" style="padding-top: 1pt;padding-left: 90pt;text-indent: 0pt;text-align: left;">: ! (0 in arr) | | arr[0] = = = undefined</p><p class="s17" style="padding-top: 2pt;padding-left: 89pt;text-indent: 0pt;text-align: left;">? true</p><p class="s17" style="padding-top: 2pt;padding-left: 90pt;text-indent: 0pt;text-align: left;">: !cb(arr[0], i, orig)</p><p class="s17" style="padding-top: 2pt;padding-left: 89pt;text-indent: 0pt;text-align: left;">? false</p><p class="s17" style="padding-top: 2pt;padding-left: 65pt;text-indent: 25pt;line-height: 233%;text-align: left;"><span>: everyLoop(arr.slice(1), i + 1) ;<br/>return everyLoop(orig, 0);</span></p><p style="padding-top: 10pt;padding-left: 43pt;text-indent: 0pt;text-align: left;">When programming someR (), an empty array means a false result, but empty places are skipped:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 52pt;text-indent: 0pt;text-align: left;">type Opt&lt;X&gt; = X | undefined;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 64pt;text-indent: -11pt;line-height: 115%;text-align: left;"><span>const someR = &lt;A&gt;(<br/>orig: Opt&lt;A&gt;[],</span></p><p class="s17" style="padding-left: 64pt;text-indent: 0pt;text-align: left;">cb: (x: A, i: number, a: Opt&lt;A&gt;[]) =&gt; boolean</p><p class="s17" style="padding-top: 2pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">): boolean =&gt; {</p><p class="s17" style="padding-top: 2pt;padding-left: 76pt;text-indent: -12pt;line-height: 118%;text-align: left;"><span>const someLoop = (arr: Opt&lt;A&gt;[], i: number): boolean =&gt;<br/>arr.length === 0</span></p><p class="s17" style="padding-left: 89pt;text-indent: 0pt;line-height: 13pt;text-align: left;">? false</p><p class="s17" style="padding-top: 2pt;padding-left: 90pt;text-indent: 0pt;text-align: left;">: 1(0 in arr) || arr[0] === undefined</p><p class="s17" style="padding-top: 2pt;padding-left: 89pt;text-indent: 0pt;text-align: left;">? someLoop(arr.slice(1) , i + 1)</p><p class="s17" style="padding-top: 2pt;padding-left: 90pt;text-indent: 0pt;text-align: left;">: cb(arr[0], i, orig)</p><p class="s17" style="padding-top: 2pt;padding-left: 89pt;text-indent: 0pt;text-align: left;">? true</p><p class="s17" style="padding-top: 2pt;padding-left: 64pt;text-indent: 25pt;line-height: 233%;text-align: left;"><span>: someLoop(arr.slice(1), i + 1) ;<br/>return someLoop(orig, 0);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">548  Answers to Questions</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="9.8"><p class="s10" style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;">Symmetrical queens: <span class="p">The key to finding only symmetric solutions is as follows. After the first<br/>four queens have been (tentatively) placed on the first half of the board, we don’t have to try all the<br/>possible positions for the other queens; they are automatically determined with regard to the first ones:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">const SIZE = 8;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 61pt;text-indent: 0pt;text-align: left;">const places = Array(SIZE);</p><p class="s17" style="padding-top: 3pt;padding-left: 73pt;text-indent: -11pt;line-height: 30pt;text-align: left;"><span>const checkPlace = (column: number, row: number): boolean<br/>places</span></p><p class="s17" style="padding-left: 87pt;text-indent: 0pt;line-height: 11pt;text-align: left;">.slice(0, column)</p><p class="s17" style="padding-top: 2pt;padding-left: 87pt;text-indent: 0pt;text-align: left;">.every(</p><p class="s17" style="padding-top: 2pt;padding-left: 100pt;text-indent: 0pt;text-align: left;">(v, i) =&gt;</p><p class="s17" style="padding-top: 2pt;padding-left: 109pt;text-indent: 0pt;text-align: left;">v !== row &amp;&amp; Math.abs(v - row) !== column - i</p><p class="s17" style="padding-top: 3pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 74pt;text-indent: -12pt;line-height: 118%;text-align: left;"><span>const symmetricFinder = (column = 0): void =&gt; {<br/>if (column === SIZE) {</span></p><p class="s17" style="padding-left: 85pt;text-indent: 0pt;line-height: 13pt;text-align: left;">console.log(JSON.stringify(places.map((x) =&gt; x + 1) ) ) ;</p><p class="s17" style="padding-top: 2pt;padding-left: 75pt;text-indent: 0pt;text-align: left;">} else if (column &lt;= SIZE / 2) {</p><p class="s17" style="padding-top: 2pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">// first half of the board?</p><p class="s17" style="padding-top: 2pt;padding-left: 98pt;text-indent: -12pt;line-height: 118%;text-align: left;"><span>const testRowsInColumn = (j: number): void =&gt; {<br/>if (j &lt; SIZE) {</span></p><p class="s17" style="padding-left: 121pt;text-indent: -11pt;line-height: 118%;text-align: left;"><span>if (checkPlace(column, j)) {<br/>places[column] = j;<br/>symmetricFinder(column + 1) ;</span></p><p class="s17" style="padding-top: 1pt;padding-left: 110pt;text-indent: 0pt;line-height: 13pt;text-align: left;">}</p><p class="s17" style="padding-left: 109pt;text-indent: 0pt;line-height: 13pt;text-align: left;">testRowsInColumn(j + 1);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 86pt;text-indent: 0pt;text-align: left;">};</p><p class="s17" style="padding-left: 85pt;text-indent: 0pt;text-align: left;">testRowsInColumn(0);</p><p class="s17" style="padding-top: 2pt;padding-left: 75pt;text-indent: 0pt;text-align: left;">} else {</p><p class="s10" style="padding-top: 4pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">// second half of the board</p><p class="s10" style="padding-top: 4pt;padding-left: 86pt;text-indent: 0pt;line-height: 144%;text-align: left;"><span>const symmetric = SIZE - 1 - places[SIZE - 1 - column];<br/>if (checkPlace(column, symmetric)) {</span></p><p class="s10" style="padding-left: 97pt;text-indent: 0pt;line-height: 10pt;text-align: left;">places[column] = symmetric;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 276pt;text-indent: 0pt;text-align: left;">Chapter 9, Designing Functions - Recursion     549</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 89pt;text-indent: 0pt;text-align: left;"><a name="bookmark547">symmetricFinder(column + 1);</a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>Calling  symmetricFinder  ()  produces  four  solutions,  which  are  essentially  the  same.  Make<br/>drawings and check them to make sure the solution is correct!</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 55pt;text-indent: 0pt;text-align: left;">[3,5,2,8,1,7,4,61</p><p class="s10" style="padding-top: 4pt;padding-left: 55pt;text-indent: 0pt;text-align: left;">[4,6,8,2,7,1,3,51</p><p class="s10" style="padding-top: 4pt;padding-left: 55pt;text-indent: 0pt;text-align: left;">[5,3,1,7,2,8,6,41</p><p class="s10" style="padding-top: 4pt;padding-left: 55pt;text-indent: 0pt;text-align: left;">[6,4,7,1,8,2,5,31</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="9.9"><p class="s10" style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;">Longest common subsequence: <span class="p">The length of the </span>longest common sequence (LCS) <span class="p">of two strings,<br/>a and b, can be found with recursion as follows:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l198"><li data-list-text="•"><p style="padding-left: 70pt;text-indent: -13pt;text-align: left;">If the length of a is zero, or if the length of b is zero, return zero</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;line-height: 123%;text-align: left;"><span>If the first characters of a and b match, the answer is 1 plus the LCS of a and b, both minus<br/>their initial characters</span></p></li><li data-list-text="•"><p style="padding-top: 5pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">If the first characters of a and b do not match, the answer is the largest of the following two results:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l199"><li data-list-text="■"><p style="padding-left: 83pt;text-indent: -13pt;text-align: left;">The LCS of a minus its initial character, and b</p></li><li data-list-text="■"><p style="padding-top: 8pt;padding-left: 83pt;text-indent: -13pt;text-align: left;">The LCS of a, and b minus its initial character</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>We can implement this as follows. We do memoization “by hand” to avoid repeating calculations; we<br/>could have also used our memoization function:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">const LCS = (strA: string, strB: string): number =&gt; {</p><p class="s17" style="padding-top: 2pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">// memoization &quot;by hand&quot;</p><p class="s17" style="padding-top: 2pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">const cache: { [k: string]: number } = {};</p><p class="s17" style="padding-left: 77pt;text-indent: -12pt;line-height: 30pt;text-align: left;"><span>const innerLCS = (strA: string, strB: string): number =&gt;<br/>const key = strA + &quot;/&quot; + strB;</span></p><p class="s17" style="padding-top: 2pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">let ret: number;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 77pt;text-indent: 0pt;text-align: left;">if (!(key in cache)) {</p><p class="s17" style="padding-top: 2pt;padding-left: 89pt;text-indent: 0pt;text-align: left;">if (strA.length === 0 || strB.length === 0) {</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">550  Answers to Questions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 109pt;text-indent: 0pt;text-align: left;">ret = 0;</p><p class="s17" style="padding-top: 2pt;padding-left: 98pt;text-indent: 0pt;text-align: left;">} else if (strA[0] === strB[0]) {</p><p class="s17" style="padding-top: 1pt;padding-left: 109pt;text-indent: 0pt;text-align: left;">ret = 1 + innerLCS(strA.substr(1), strB.substr(1));</p><p class="s17" style="padding-top: 2pt;padding-left: 98pt;text-indent: 0pt;text-align: left;">} else {</p><p class="s17" style="padding-top: 2pt;padding-left: 109pt;text-indent: 0pt;text-align: left;">ret = Math.max(</p><p class="s17" style="padding-top: 2pt;padding-left: 122pt;text-indent: 0pt;line-height: 114%;text-align: left;"><span>innerLCS(strA, strB.substr(1)),<br/>innerLCS(strA.substr(1), strB)</span></p><p class="s17" style="padding-top: 1pt;padding-left: 110pt;text-indent: 0pt;text-align: left;">) ;</p><p class="s84" style="padding-top: 4pt;padding-left: 98pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-top: 4pt;padding-left: 97pt;text-indent: 0pt;text-align: left;">cache[key] = ret;</p><p class="s84" style="padding-top: 5pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-top: 4pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">return cache[key];</p><p class="s17" style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">};</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-top: 4pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">return innerLCS(strA, strB);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 61pt;text-indent: 0pt;text-align: left;">console.log(LCS(&quot;INTERNATIONAL&quot;, &quot;CONTRACTOR&quot;));</p><p class="s17" style="padding-top: 2pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">// 6, as in the text</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>As an extra exercise, you could produce not only the length of the LCS but also the characters that<br/>are involved.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p></li></ul></li></ul></li><li data-list-text="9.10"><p class="s10" style="padding-left: 52pt;text-indent: 0pt;text-align: left;">At odds with JavaScript: <span class="p">I’ll show over a dozen solutions, but I’m certain there are even more.<br/>The first solution is the obvious one: divide by 2 and check whether the remainder is </span><span class="s245">1:</span></p><p class="s17" style="padding-top: 9pt;padding-left: 73pt;text-indent: -11pt;line-height: 115%;text-align: left;"><span>function isOddl(n: number): boolean {<br/>return n % 2 === 1;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 9pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">You could have another solution by doing <span class="s245">return Boolean (n % 2) </span>instead:</p><p class="s17" style="padding-top: 10pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">function isOdd2(n: number): boolean {</p><p class="s17" style="padding-top: 2pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">return Boolean(n % 2); //or !I(n % 2) instead</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 276pt;text-indent: 0pt;text-align: left;">Chapter 9, Designing Functions - Recursion     551</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: left;">Another way is to divide the number by 2 and check whether it has a fractional part:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 64pt;text-indent: -11pt;line-height: 118%;text-align: left;"><span>function  is0dd3(n:  number):  boolean  {<br/>return Math.floor(n / 2) !== n / 2;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>If a number is odd, dividing it by 2 and dividing its predecessor by 2, both results have the same integer<br/>part (for instance, 9/2 and 8/2 both have integer part 4):</span></p><p class="s17" style="padding-top: 8pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">function is0dd4(n: number): boolean {</p><p class="s17" style="padding-top: 1pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">return Math.floor(n <i>I </i>2) === Math.floor((n - 1) / 2);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: -9pt;line-height: 23pt;text-align: left;">Using bit operations is fast; an odd number will have its least significant bit set to <span class="s245">1:<br/>function  is0dd5(n:  number):  boolean  {</span></p><p class="s17" style="padding-top: 2pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">return (n &amp; 1) === 1;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: left;">As in <span class="s245">isOddl (), </span>you get another variation by doing <span class="s245">return Boolean (n &amp; 1) </span>instead:</p><p class="s17" style="padding-top: 10pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">function is0dd6(n: number): boolean {</p><p class="s17" style="padding-top: 2pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">return Boolean(n &amp; 1) ; // or !!(n &amp; 1) instead</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>Shifting in binary also works; if we shift the number one bit to the right (dropping its least significant<br/>bit) and then shift the number back one bit to the left, for an odd number, we don’t get the same result:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 64pt;text-indent: -11pt;line-height: 118%;text-align: left;"><span>function  is0dd7(n:  number):  boolean  {<br/>return (n &gt;&gt; 1) &lt;&lt; 1 !== n;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>Shifting to the right is the same as dividing by 2 and keeping the integer part, so this solution is<br/>basically the same as the third one:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 65pt;text-indent: -11pt;line-height: 115%;text-align: left;"><span>function  is0dd8(n:  number):  boolean  {<br/>return n &gt;&gt; 1 === (n - 1) &gt;&gt; 1;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 126%;text-align: left;"><span>Odd numbers end in 1,3, 5, 7, or 9, so we can also look at the string representation of the number<br/>and check its value:</span></p><p class="s17" style="padding-top: 7pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">function is0dd9(n: number): boolean {</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-left: 20pt;text-indent: 0pt;text-align: left;">552  <span class="s189">Answers to Questions</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-top: 8pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">return &quot;13579&quot;.includes(String(n).at(-1)!);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">We could work with the string by using f ind () or indexOf (); I’ll leave these versions to you.</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="9.11"><p class="s10" style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">Odds and evens trampolining: <span class="p">We must first change our mutually recursive functions to work<br/>with continuations, and return calls to </span><span class="s245">trampoline ():</span></p><p class="s17" style="padding-top: 9pt;padding-left: 74pt;text-indent: -12pt;line-height: 115%;text-align: left;"><span>function isEven(n: number, cont: FN): () =&gt; boolean {<br/>if (</span><span class="s345">n </span>=== 0) {</p><p class="s17" style="padding-left: 85pt;text-indent: 0pt;line-height: 10pt;text-align: left;">return <span class="s10">trampoline(() =&gt; cont(true));</span></p><p class="s17" style="padding-top: 2pt;padding-left: 75pt;text-indent: 0pt;text-align: left;">} else {</p><p class="s17" style="padding-top: 2pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">return <span class="s10">trampoline(() =&gt; isOdd(n - 1, (v) =&gt; cont(v)));</span></p><p class="s17" style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">}</p><p class="s17" style="padding-top: 2pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-top: 4pt;padding-left: 73pt;text-indent: -11pt;line-height: 118%;text-align: left;"><span>function isOdd(n: number, cont: FN): () =&gt; boolean {<br/>return </span><span class="s10">trampoline(() =&gt; isEven(n, (v) =&gt; cont(!v)));</span></p><p class="s17" style="padding-top: 2pt;padding-left: 63pt;text-indent: 0pt;text-align: left;">}</p><p style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">For instance, the first return in isEven () used to be return true; now we trampoline a</p><p style="padding-top: 2pt;padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>thunk that will call a continuation with true. We can now finish the job by providing an appropriate<br/>continuation that just returns the calculated value:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 73pt;text-indent: -11pt;line-height: 117%;text-align: left;"><span>function isEvenT(n: number): boolean {<br/>return </span><span class="s10">trampoline(isEven(n, (x) =&gt; x)) ;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 73pt;text-indent: -11pt;line-height: 118%;text-align: left;"><span>function isOddT(n: number): boolean {<br/>return </span><span class="s10">trampoline(isOdd(n, (x) =&gt; x));</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 61pt;text-indent: 0pt;line-height: 117%;text-align: left;"><span>console.log(&quot;22.. isEven?&quot;, isEvenT(22));         // true<br/>console.log(&quot;9... isOdd?&quot;, isOddT(5)); // true</span></p><p class="s17" style="padding-left: 61pt;text-indent: 0pt;line-height: 115%;text-align: left;"><span>console.log(&quot;63... isEven?&quot;, isEvenT(63)) ; // false<br/>console.log(&quot;60... isOdd?&quot;, isOddT(60));       // false</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 276pt;text-indent: 0pt;text-align: left;">Chapter 9, Designing Functions - Recursion     553</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="9.12"><p class="s10" style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: justify;">Mutual problem? <span class="p">If you do isEven (1) or isOdd (2), you get an infinite loop; can you see<br/>why? (The same will happen if you replace 1 and 2 with any odd or even number, respectively.) A<br/>hint: the problem is with the base cases for recursion.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="9.13"><p class="s10" style="padding-left: 43pt;text-indent: 0pt;text-align: justify;">Say no to whiles? <span class="p">Yes, the code is equivalent. We are replacing while () with a for (; ;) loop<br/>and breaking out with a </span><span class="s245">return.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="9.14"><p class="s10" style="padding-left: 44pt;text-indent: 0pt;line-height: 125%;text-align: justify;">Power, more power! <span class="p">We’ll need to add a new power () function, sitting between term () and<br/>f actor (), so its priority will be correctly placed.</span></p><p class="s84" style="padding-top: 2pt;padding-left: 48pt;text-indent: 0pt;text-align: center;">POWER: <span><img width="214" height="67" alt="image" src="Image_066.jpg"/></span></p><p class="s164" style="padding-top: 42pt;padding-left: 131pt;text-indent: 0pt;text-align: left;">Figure 2 - Power represents a sequence of exponentiations</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 5pt;padding-left: 43pt;text-indent: 0pt;text-align: left;">We’ll change term () to call power () instead of factor ():</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 65pt;text-indent: -12pt;line-height: 119%;text-align: left;"><span>function term)): number {<br/>let accum = power ();</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 64pt;text-indent: 0pt;text-align: left;">while (</p><p class="s17" style="padding-top: 2pt;padding-left: 76pt;text-indent: 0pt;line-height: 117%;text-align: left;"><span>tokens[curr] === TIMES |<br/>tokens[curr] === DIVIDES |<br/>tokens[curr] === MODULUS</span></p><p class="s17" style="padding-top: 2pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">) {</p><p class="s17" style="padding-left: 88pt;text-indent: -11pt;line-height: 117%;text-align: left;"><span>if (tokens [curr] = = = TIMES) {<br/>curr++;</span></p><p class="s10" style="padding-top: 1pt;padding-left: 88pt;text-indent: 0pt;text-align: left;">accum *= power();</p><p class="s17" style="padding-top: 2pt;padding-left: 89pt;text-indent: -11pt;line-height: 114%;text-align: left;"><span>} else if (tokens [curr] = = = DIVIDES) {<br/>curr++;</span></p><p class="s10" style="padding-top: 2pt;padding-left: 88pt;text-indent: 0pt;text-align: left;">accum /= power();</p><p class="s17" style="padding-top: 2pt;padding-left: 89pt;text-indent: -11pt;line-height: 117%;text-align: left;"><span>} else if (tokens [curr] = = = MODULUS) {<br/>curr++;</span></p><p class="s10" style="padding-top: 1pt;padding-left: 88pt;text-indent: 0pt;text-align: left;">accum %= power();</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">554  Answers to Questions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 73pt;text-indent: 0pt;text-align: left;">return accum;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;">To properly calculate “towers” such as 2<span class="s162">A</span>3<span class="s162">A</span><span>4, we’ll store 2, 3, and 4 in an array, and then reduce it<br/>from right to left: we’ll first calculate 3</span><span class="s162">A</span>4, and then 2<span class="s162">A</span>(the calculated result for 3<span class="s162">A</span>4):</p><p class="s17" style="padding-top: 8pt;padding-left: 73pt;text-indent: -11pt;line-height: 115%;text-align: left;"><span>function power)): number {<br/>const tower = [factor))] ;</span></p><p class="s17" style="padding-left: 85pt;text-indent: -12pt;line-height: 118%;text-align: left;"><span>while (tokens[curr] === POWER) {<br/>curr++;</span></p><p class="s17" style="padding-left: 85pt;text-indent: 0pt;line-height: 13pt;text-align: left;">tower.push(factor());</p><p class="s84" style="padding-top: 5pt;padding-left: 75pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 73pt;text-indent: 0pt;text-align: left;">while (tower.length &gt; 1) {</p><p class="s17" style="padding-top: 2pt;padding-left: 85pt;text-indent: 0pt;line-height: 118%;text-align: left;"><span>tower[tower.length - 2] **= tower[tower.length - 1];<br/>tower.pop();</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 73pt;text-indent: 0pt;text-align: left;">return tower[0];</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="9.15"><p class="s10" style="padding-left: 78pt;text-indent: -25pt;text-align: left;">Error-prone evaluation: <span class="p">Here are some ideas:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l200"><li data-list-text="•"><p style="padding-left: 79pt;text-indent: -12pt;line-height: 119%;text-align: justify;">When skipping a token, check if it’s correct anyway; for instance, <span class="s245">f actor () </span><span>skips the second<br/>parenthesis without actually checking whether it is, so it would evaluate “(1+2]” as 3, even<br/>though it’s wrong.</span></p></li><li data-list-text="•"><p style="padding-top: 6pt;padding-left: 78pt;text-indent: -12pt;text-align: justify;">Add a special end-of-string (EOS) token, to check whether the evaluation finishes at that token.</p></li><li data-list-text="•"><p class="s33" style="padding-top: 8pt;padding-left: 79pt;text-indent: -13pt;line-height: 123%;text-align: justify;">	<span class="p">Check you do not go beyond the end of the tokens array whenever you advance to the<br/>next token.</span></p></li></ul></li></ol></ol><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-left: 52pt;text-indent: 0pt;text-align: left;"><a name="bookmark548">Chapter 10,  Ensuring Purity - Immutability</a></p><ol id="l201"><ol id="l202"><li data-list-text="10.1"><p class="s10" style="padding-top: 10pt;padding-left: 52pt;text-indent: 1pt;line-height: 125%;text-align: left;">Not just date problems: <span class="p">We can see more limitations of j sonCopy () in the following example,<br/>but don’t assume there aren’t any more problems:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 281pt;text-indent: 0pt;text-align: left;">Chapter 10, Ensuring Purity - Immutability     555</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 53pt;text-indent: 0pt;text-align: left;">const agent = {</p><p class="s17" style="padding-top: 2pt;padding-left: 64pt;text-indent: 0pt;line-height: 118%;text-align: left;"><span>error: new Error(&quot;It&#39;s stirred; I ordered it shaken&quot;),<br/>map: new Map([[&quot;James&quot;, &quot;Bond&quot;]]),</span></p><p class="s17" style="padding-left: 64pt;text-indent: 0pt;line-height: 118%;text-align: left;"><span>set: new Set([0, 0, 7]),<br/>regex: /007/,<br/>useLicense() {</span></p><p class="s17" style="padding-left: 76pt;text-indent: 0pt;line-height: 13pt;text-align: left;">console.log(&quot;Bang! Bang!&quot;);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 52pt;text-indent: 0pt;text-align: left;">console.log(jsonCopy(agent));</p><p class="s17" style="padding-top: 3pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">/*</p><p class="s10" style="padding-top: 2pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">{ error: {}, map: {}, set: {}, regex: {} }</p><p class="s17" style="padding-top: 3pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">*/</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: left;">Four of the properties got transformed into an empty object, and the function was ignored.</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="10.2"><p class="s10" style="padding-top: 6pt;padding-left: 67pt;text-indent: -23pt;text-align: left;">The mote in jsonCopy’s eye.<span class="p"> Our deepCopy () function does marginally better; with the</span></p><p style="padding-top: 2pt;padding-left: 43pt;text-indent: 0pt;text-align: left;">same agent object as in the previous question, copying produces the following:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">/*</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 64pt;text-indent: 0pt;text-align: left;">error: Error: It&#39;s stirred; I ordered it shaken</p><p class="s17" style="padding-top: 2pt;padding-left: 64pt;text-indent: 14pt;line-height: 117%;text-align: left;"><span>...many lines snipped out<br/>map: Map(0) {},</span></p><p class="s17" style="padding-left: 65pt;text-indent: 0pt;text-align: left;">set: Set (0) {},</p><p class="s17" style="padding-top: 2pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">regex: /(?:)/,</p><p class="s17" style="padding-top: 2pt;padding-left: 64pt;text-indent: 0pt;text-align: left;">useLicense: [Function: useLicense]</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 53pt;text-indent: 0pt;text-align: left;">*/</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: left;"><span>The error and the function got converted OK. The map and the set were converted into the right types,<br/>but they are empty; this could be fixed by adding logic that would scan the original objects and insert<br/>copies of them into the new ones. </span><i>{Question 10.10 </i><span>may help.) Finally, cloning a regular expression is<br/>a tad harder, but google </span><i>“clone regexp in JavaScript” </i>and you’ll find several implementations for this.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">556  Answers to Questions</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="10.3"><p style="padding-left: 52pt;text-indent: 1pt;line-height: 124%;text-align: left;"><b>Going in circles: </b>We may fix this by using a memoizing-style solution, as in <i>Chapter 4, Behaving</i><span>After we copy an object, we’ll store a reference in a map. Before we try to copy any object,<br/>we’ll  first see whether we copied it earlier (by looking for it in the map) and if so, we won’t do any new<br/>copying and will just use what we found in the map. Our new deepCopy2 () function is as follows:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">const deepCopy2 = &lt;0 extends OBJ&gt;(obj: O): O =&gt; {</p><p class="s10" style="padding-top: 3pt;padding-left: 51pt;text-indent: 0pt;text-align: center;">const mapped = new Map&lt;0, 0&gt;();</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-top: 6pt;padding-left: 86pt;text-indent: -12pt;line-height: 115%;text-align: left;"><span>const deepCopy = (obj: 0): 0 =&gt; {<br/>let aux: 0 = obj;</span></p><p class="s17" style="padding-left: 86pt;text-indent: 0pt;text-align: left;">if (obj &amp;&amp; typeof obj === &quot;object&quot;) {</p><p class="s10" style="padding-top: 3pt;padding-left: 51pt;text-indent: 0pt;text-align: center;">if (mapped.has(obj)) {</p><p class="s10" style="padding-top: 4pt;padding-left: 109pt;text-indent: 0pt;text-align: left;">return mapped.get(obj) as 0;</p><p class="s84" style="padding-top: 5pt;padding-left: 98pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 97pt;text-indent: 0pt;text-align: left;">aux = new (obj as any).constructor();</p><p class="s10" style="padding-top: 4pt;padding-left: 96pt;text-indent: 0pt;text-align: left;">mapped.set(obj, aux);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-top: 6pt;padding-left: 112pt;text-indent: -14pt;line-height: 117%;text-align: left;"><span>Object.getOwnPropertyNames(obj).forEach((prop) =&gt; {<br/>(aux as any) [prop as keyof 0] =</span></p><p class="s17" style="padding-left: 121pt;text-indent: 0pt;text-align: left;">deepCopy(obj [prop]);</p><p class="s17" style="padding-top: 4pt;padding-left: 98pt;text-indent: 0pt;text-align: left;">});</p><p class="s84" style="padding-top: 3pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-top: 4pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">return aux;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-top: 4pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">return deepCopy(obj);</p><p class="s17" style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">};</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>We’ll use the mapped variable for our map. When we find that we have to clone an obj object, we first<br/>check (mapped. has (obj )) whether we have already done that, and if so, we return the value from</span></p><p style="padding-left: 53pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>the map. If this was a new, not yet copied object, we add it and its aux copy to the map (mapped.<br/>set (obj , aux)) for future reference.</span></p><p style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">We can verify how this work with a simple example:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 73pt;text-indent: -12pt;line-height: 118%;text-align: left;"><span>const circular = {<br/>a: 1,</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 281pt;text-indent: 0pt;text-align: left;">Chapter 10, Ensuring Purity - Immutability     557</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-top: 7pt;padding-left: 52pt;text-indent: 11pt;line-height: 234%;text-align: left;"><span>b:  { C: 3, d: { e: 5, f: null } }<br/>circular.b.d.f = circular.b as any;<br/>console.log(deepCopy2(circular));</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 109%;text-align: justify;">If we use <span class="s245">deepCopy () on circular, </span>we’ll get a <span class="s245">RangeError : Maximum call stack<br/>size exceeded </span>exception. However, with our new <span class="s245">deepCopy2 () </span><span>function, the circular reference<br/>is tackled with no problem.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="10.4"><p class="s10" style="padding-left: 69pt;text-indent: -25pt;text-align: left;">Freezing by proxying: <span class="p">As requested, a proxy allows you to intercept changes on an object. (See</span></p><p class="s17" style="padding-left: 43pt;text-indent: 0pt;text-align: left;">developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_</p><p class="s17" style="padding-left: 43pt;text-indent: 0pt;line-height: 115%;text-align: left;">Obj ects/Proxy <span class="s246">for more on this.) We use recursion to apply the proxy all the way down in case<br/>some attributes are objects themselves:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 64pt;text-indent: -11pt;line-height: 117%;text-align: left;"><span>const  proxySetAll  =  (obj:  OBJ):  OBJ  =&gt;  {<br/>Object.keys(obj).forEach((v) =&gt; {</span></p><p class="s17" style="padding-left: 106pt;text-indent: -4pt;line-height: 118%;text-align: left;"><span>if (typeof obj [v] === &quot;object&quot;) {<br/>obj [v] = proxySetAll(obj [v]);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 65pt;text-indent: 0pt;text-align: left;">});</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 77pt;text-indent: -12pt;line-height: 118%;text-align: left;"><span>return  new  Proxy(obj,  {<br/>set() {</span></p><p class="s17" style="padding-left: 89pt;text-indent: 0pt;line-height: 13pt;text-align: left;">throw new Errorp&#39;DON&#39;T MODIFY ANYTHING IN ME&quot;);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 76pt;text-indent: 0pt;text-align: left;">deleteProperty() {</p><p class="s17" style="padding-top: 1pt;padding-left: 89pt;text-indent: 0pt;text-align: left;">throw new Errorp&#39;DON&#39;T DELETE ANYTHING IN ME&quot;);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 65pt;text-indent: 0pt;text-align: left;">}) as OBJ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">558  Answers to Questions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;"><span>The following is the output of the preceding code. For real-life implementations, youd probably require<br/>something other than a </span><span class="s245">DON &#39; T MODIFY ANYTHING IN ME </span>message, of course!</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 73pt;text-indent: -12pt;line-height: 143%;text-align: left;"><a name="bookmark549"><span>const myObj = proxySetAll({<br/>a:  5,</span></a><a name="bookmark550">&zwnj;</a></p><p class="s10" style="padding-left: 73pt;text-indent: 0pt;line-height: 10pt;text-align: left;">b:  <span class="s186">6,</span></p><p class="s10" style="padding-top: 4pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">c:  { d: 7, e: 8 },</p><p class="s10" style="padding-top: 5pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">});</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-top: 6pt;padding-left: 60pt;text-indent: 0pt;text-align: left;">myObj.a = 777 ;</p><p class="s10" style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">// Uncaught Error: DON&#39;T MODIFY ANYTHING IN ME</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-top: 7pt;padding-left: 60pt;text-indent: 0pt;text-align: left;">myObj.f = 888 ;</p><p class="s10" style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;"><a name="bookmark551">// Uncaught Error: DON&#39;T MODIFY ANYTHING IN ME</a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-top: 7pt;padding-left: 61pt;text-indent: 0pt;text-align: left;"><a name="bookmark552">delete myObj.b;</a></p><p class="s10" style="padding-top: 4pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">// Uncaught Error: DON&#39;T DELETE ANYTHING IN ME</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="10.5"><p class="s10" style="padding-left: 78pt;text-indent: -25pt;text-align: left;">Inserting into a list, persistently: <span class="p">Using recursion helps out as follows:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l203"><li data-list-text="•"><p style="padding-left: 78pt;text-indent: -12pt;text-align: left;">If the list is empty, we cannot insert the new key.</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 79pt;text-indent: -12pt;line-height: 124%;text-align: left;"><span>If we are at a node whose key is oldKey, we create a clone of that node that points at a list<br/>that starts with a new node with newKey as its value and a pointer to the rest of the original<br/>node’s list.</span></p></li><li data-list-text="•"><p style="padding-top: 5pt;padding-left: 79pt;text-indent: -13pt;line-height: 123%;text-align: left;"><span>If we are at a node whose key isn’t oldKey, we create a clone of the node and (recursively)<br/>insert the new key somewhere in the rest of the original node’s list:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">type NODE_PTR = Node | null;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 73pt;text-indent: -11pt;line-height: 118%;text-align: left;"><span>const insertAfter = (<br/>list: NODE_PTR,<br/>newKey: string,<br/>oldKey: string</span></p><p class="s17" style="padding-left: 62pt;text-indent: 0pt;line-height: 12pt;text-align: left;">): NODE_PTR =&gt; {</p><p class="s17" style="padding-top: 2pt;padding-left: 85pt;text-indent: -11pt;line-height: 117%;text-align: left;"><span>if  (list  ===  null)  {<br/>return null;</span></p><p class="s17" style="padding-left: 75pt;text-indent: 0pt;text-align: left;">} else if (list.key === oldKey) {</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 281pt;text-indent: 0pt;text-align: left;">Chapter 10, Ensuring Purity - Immutability     559</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 77pt;text-indent: 0pt;text-align: left;">return new Node(list.key, new Node(newKey, list.next));</p><p class="s17" style="padding-top: 2pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">} else {</p><p class="s17" style="padding-top: 2pt;padding-left: 89pt;text-indent: -12pt;line-height: 117%;text-align: left;"><span>return new Node(<br/>list.key,</span></p><p class="s17" style="padding-left: 89pt;text-indent: 0pt;text-align: left;">insertAfter(list.next, newKey, oldKey)</p><p class="s17" style="padding-top: 3pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 124%;text-align: left;">In the following code, we can see this working. The new list is similar to the one shown in <i>Figure 10.2.</i><span>However, printing out the lists (c3 and newList) wouldn’t be enough; you wouldn’t be able to<br/>distinguish new or old nodes, so I’ve included several comparisons:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">const c3 =</p><p class="s17" style="padding-top: 2pt;padding-left: 64pt;text-indent: 0pt;text-align: left;">new Node(&quot;G&quot;,</p><p class="s17" style="padding-top: 2pt;padding-left: 76pt;text-indent: 0pt;text-align: left;">new Node(&quot;B&quot;,</p><p class="s17" style="padding-top: 2pt;padding-left: 88pt;text-indent: 0pt;text-align: left;">new Node(&quot;F&quot;,</p><p class="s17" style="padding-top: 2pt;padding-left: 100pt;text-indent: 0pt;text-align: left;">new Node(&quot;A&quot;,</p><p class="s17" style="padding-top: 2pt;padding-left: 112pt;text-indent: 0pt;text-align: left;">new Node(&quot;C&quot;,</p><p class="s17" style="padding-top: 2pt;padding-left: 52pt;text-indent: 71pt;line-height: 233%;text-align: left;"><span>new Node(&quot;E&quot;, null))))));<br/>const newList = insertAfter(c3, &quot;D&quot;, &quot;B&quot;);</span></p><p class="s17" style="padding-left: 52pt;text-indent: 0pt;text-align: left;">console.log(c3 === newList);</p><p class="s17" style="padding-top: 2pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// false</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 52pt;text-indent: 0pt;text-align: left;">console.log(c3!.key === newList1.key);</p><p class="s17" style="padding-top: 2pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// true (both are &quot;G&quot;)</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 52pt;text-indent: 0pt;text-align: left;">console.log(c31.next === newList1.next);</p><p class="s17" style="padding-top: 2pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// false</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 52pt;text-indent: 0pt;text-align: left;">console.log(c3!.next!.key === newList!.next!.key);</p><p class="s17" style="padding-top: 2pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// true (both are &quot;B&quot;)</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 53pt;text-indent: 0pt;text-align: left;">console.log(c31.next!.next === newList1.next!.next);</p><p class="s17" style="padding-top: 2pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// false</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">560  Answers to Questions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 61pt;text-indent: 0pt;text-align: left;">console.log(c31.next 1.next!.key = = = &quot;F&quot;);</p><p class="s17" style="padding-top: 2pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">// true</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 61pt;text-indent: 0pt;text-align: left;">console.log(newList!.next I.next 1.key = = = &quot;D&quot;);</p><p class="s17" style="padding-top: 2pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">// true</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 61pt;text-indent: 0pt;text-align: left;">console.log(</p><p class="s17" style="padding-top: 2pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">c3!.next!.next!.next === newList!.next!.next!.next!.next</p><p class="s17" style="padding-top: 3pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">) ;</p><p class="s17" style="padding-top: 1pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">// true - after F, the list is the old one</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">A lot of ! non-null assertions were needed to inform TypeScript that no null values were around.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>A new question: In the preceding logic, nothing is inserted if oldKey isn’t found. Can you change<br/>the logic so, in that case, the new node is added at the end of the list?</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p></li></ul></li><li data-list-text="10.6"><p class="s10" style="padding-left: 53pt;text-indent: 0pt;line-height: 123%;text-align: left;">Composing many lenses: <span class="p">We want to compose lenses from left to right so we can directly use<br/>reduce (). Let’s write the composeManyLenses () function and apply it to the same example</span></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">that was shown in the text:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 61pt;text-indent: 0pt;text-align: left;">const composeManyLenses = &lt;0 extends 0BJ&gt;(</p><p class="s17" style="padding-top: 2pt;padding-left: 75pt;text-indent: 0pt;text-align: left;">. . . lenses : LENS&lt;0&gt; []</p><p class="s17" style="padding-top: 2pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">) =&gt;</p><p class="s17" style="padding-top: 1pt;padding-left: 86pt;text-indent: -12pt;line-height: 114%;text-align: left;"><span>lenses.reduce((acc, lens) =&gt; composeTwoLenses(acc,<br/>lens));</span></p><p style="padding-top: 8pt;padding-left: 52pt;text-indent: 0pt;line-height: 115%;text-align: left;">With the <span class="s245">deepOb j ect </span>example seen earlier, plus all the lenses to get c, <span class="s245">e, g, </span><span>and so on, we get<br/>the following:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 73pt;text-indent: -12pt;line-height: 118%;text-align: left;"><span>const deepObject = {<br/>a: 1,</span></p><p class="s17" style="padding-left: 73pt;text-indent: 0pt;line-height: 13pt;text-align: left;">b: 2,</p><p style="padding-top: 4pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">C: {</p><p class="s17" style="padding-top: 2pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">d: 3,</p><p class="s17" style="padding-top: 2pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">e: {</p><p class="s17" style="padding-top: 2pt;padding-left: 98pt;text-indent: 0pt;text-align: left;">f: 6,</p><p class="s17" style="padding-top: 2pt;padding-left: 97pt;text-indent: 0pt;text-align: left;">g: { i: 9, j: <span class="s246">{ k: 11 } },</span></p><p class="s17" style="padding-top: 1pt;padding-left: 97pt;text-indent: 0pt;text-align: left;">h: 8,</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 281pt;text-indent: 0pt;text-align: left;">Chapter 10, Ensuring Purity - Immutability     561</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-top: 7pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">console.log(</p><p class="s17" style="padding-top: 2pt;padding-left: 64pt;text-indent: 0pt;text-align: left;">view(composeManyLenses(IC, IE, 1G, IJ, IK), deepObject)</p><p class="s17" style="padding-top: 2pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 53pt;text-indent: 0pt;text-align: left;"><a name="bookmark553">// 11, same as earlier</a></p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="10.7"><p class="s10" style="padding-left: 67pt;text-indent: -23pt;text-align: left;">Lenses by path: <span class="p">Hint - the needed changes would be similar to what we did when we went from</span></p><p class="s17" style="padding-left: 43pt;text-indent: 0pt;text-align: left;">getFieldO <span class="s246">to </span>getByPath ().</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="10.8"><p class="s10" style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;">Accessing virtual attributes: <span class="p">Using a getter is always viable, and for this question, youd write<br/>something like the following, and youd have a getter for the virtual fullName attribute:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 65pt;text-indent: -12pt;line-height: 118%;text-align: left;"><span>const lastNameLens = composeTwoLenses(<br/>lensProp(&quot;name&quot;),</span></p><p class="s17" style="padding-left: 65pt;text-indent: 0pt;line-height: 13pt;text-align: left;">lensProp(&quot;last&quot;)</p><p class="s17" style="padding-top: 2pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 65pt;text-indent: -12pt;line-height: 118%;text-align: left;"><span>const firstNameLens = composeTwoLenses(<br/>lensProp(&quot;name&quot;),</span></p><p class="s17" style="padding-left: 65pt;text-indent: 0pt;line-height: 13pt;text-align: left;">lensProp(&quot;first&quot;)</p><p class="s17" style="padding-top: 2pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 65pt;text-indent: -12pt;line-height: 117%;text-align: left;"><span>const fullNameGetter = &lt;0 extends OBJ&gt;(obj: O): string =&gt;<br/>&#39;${view(lastNameLens)(obj)},</span></p><p class="s17" style="padding-left: 77pt;text-indent: 0pt;text-align: left;">${view(firstNameLens)(obj)}&#39;;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Being able to set several attributes based on a single value isn’t always possible, but if we assume the<br/>incoming name is in the LAST, FIRST format, we can split it by the comma and assign the two parts<br/>to the first and last names, respectively:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">const fullNameSetter =</p><p class="s17" style="padding-top: 2pt;padding-left: 66pt;text-indent: -1pt;line-height: 117%;text-align: left;"><span>&lt;0 extends OBJ&gt;(fullName: string) =&gt;<br/>(obj : O) : O =&gt; {</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">562  Answers to Questions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 85pt;text-indent: 0pt;line-height: 139%;text-align: left;"><span>const parts = fullName.split(&quot;,&quot;) ;<br/>return set(firstNameLens) (parts [1]) (</span></p><p class="s10" style="padding-left: 98pt;text-indent: 0pt;text-align: left;">set(lastNameLens)(parts[0])(obj)</p><p class="s10" style="padding-top: 4pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">) as 0;</p><p class="s17" style="padding-top: 4pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">};</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-top: 4pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">const fullNameLens = lens(fullNameGetter, fullNameSetter);</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="10.9"><p style="padding-left: 52pt;text-indent: 1pt;line-height: 120%;text-align: justify;"><b>Lenses for arrays? </b>The <span class="s245">view () </span>function would work well, but <span class="s245">set () </span>and <span class="s245">over () </span><span>wouldn’t<br/>work in a pure way since set Array () doesn’t return a new array; instead, it modifies the current<br/>one in place. Take a look at the following question for a related problem.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="10.10"><p class="s10" style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: justify;">Lenses into maps: <span class="p">Getting a value from the map poses no problem, but for setting, we need<br/>to clone the map:</span></p></li></ol></ol><p class="s17" style="padding-top: 8pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">const getMap =</p><p class="s17" style="padding-top: 2pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">&lt;K, V&gt;(key: K) =&gt;</p><p class="s17" style="padding-top: 2pt;padding-left: 76pt;text-indent: 0pt;text-align: left;">(map: Map&lt;K, V&gt;) =&gt;</p><p class="s10" style="padding-top: 4pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">map.get(key);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-top: 6pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">const setMap =</p><p class="s17" style="padding-top: 2pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">&lt;K, V&gt;(key: K) =&gt;</p><p class="s17" style="padding-top: 2pt;padding-left: 76pt;text-indent: 0pt;text-align: left;">(value: V) =&gt;</p><p class="s17" style="padding-top: 1pt;padding-left: 76pt;text-indent: 0pt;text-align: left;">(map: Map&lt;K, V&gt;) =&gt;</p><p class="s10" style="padding-top: 4pt;padding-left: 85pt;text-indent: 0pt;text-align: left;">new Map(map).set(key, value);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-top: 6pt;padding-left: 74pt;text-indent: -12pt;line-height: 115%;text-align: left;"><span>const lensMap = &lt;K, V&gt;(key: K) =&gt;<br/>lens(getMap&lt;K, V&gt;(key), setMap&lt;K, V&gt;(key));</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-left: 53pt;text-indent: 0pt;line-height: 122%;text-align: left;"><a name="bookmark554"><span>Chapter 11,  Implementing Design Patterns - The<br/>Functional Way</span></a><a name="bookmark555">&zwnj;</a></p><ol id="l204"><ol id="l205"><li data-list-text="11.1"><p class="s10" style="padding-top: 5pt;padding-left: 52pt;text-indent: 1pt;line-height: 118%;text-align: left;">Decorating methods, the future way: <span class="p">As we’ve already mentioned, decorators aren’t a fixed, definitive<br/>feature at the moment. However, by following tc3 9 . github . io/proposal - decorators/,<br/>we can write the following:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 199pt;text-indent: 0pt;text-align: left;">Chapter 11, Implementing Design Patterns -The Functional Way       563</p><p class="s17" style="padding-top: 20pt;padding-left: 64pt;text-indent: -11pt;line-height: 119%;text-align: left;"><span>const logging = (target, name, descriptor) =&gt; {<br/>const savedMethod = descriptor.value;<br/>descriptor.value = function (. args) {</span></p><p class="s17" style="padding-left: 76pt;text-indent: 0pt;line-height: 12pt;text-align: left;">console.log(&#39;entering ${name}: ${args}&#39;);</p><p class="s17" style="padding-top: 17pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">try {</p><p class="s17" style="padding-top: 1pt;padding-left: 101pt;text-indent: -12pt;line-height: 120%;text-align: left;"><span>const valueToReturn =<br/>savedMethod.bind(this)(. args);</span></p><p class="s17" style="padding-left: 89pt;text-indent: 0pt;line-height: 117%;text-align: left;"><span>console.log(&#39;exiting ${name}: ${valueToReturn}&#39;);<br/>return valueToReturn;</span></p><p class="s17" style="padding-left: 77pt;text-indent: 0pt;text-align: left;">} catch (thrownError) {</p><p class="s17" style="padding-top: 1pt;padding-left: 88pt;text-indent: 0pt;line-height: 117%;text-align: left;"><span>console.log(&#39;exiting ${name}: threw ${thrownError}&#39;);<br/>throw thrownError;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 65pt;text-indent: 0pt;text-align: left;">return descriptor;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>We want to add a ©logging decoration to a method. We save the original method in savedMethod<br/>and substitute a new method that will log the received arguments, call the original method to save its</span></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>return value, log that, and finally return it. If the original method throws an exception, we catch it, report<br/>it, and throw it again so that it can be processed as expected. A simple example of this is as follows:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 64pt;text-indent: -11pt;line-height: 118%;text-align: left;"><span>class SumThree {<br/>constructor(z) {</span></p><p class="s17" style="padding-left: 76pt;text-indent: 0pt;line-height: 12pt;text-align: left;">this.z = z;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 64pt;text-indent: 0pt;text-align: left;">©logging</p><p class="s17" style="padding-top: 2pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">sum(x, y) {</p><p class="s17" style="padding-top: 2pt;padding-left: 77pt;text-indent: 0pt;text-align: left;">return x + y + this.z;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 52pt;text-indent: 0pt;text-align: left;">new SumThree(100).sum(20, 8);</p><p class="s17" style="padding-top: 2pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// entering sum: 20,8</p><p class="s17" style="padding-top: 2pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// exiting sum: 128</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">564  Answers to Questions</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="11.2"><p class="s10" style="padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: justify;">Decorator with mixins: <span class="p">We write an addBar () function that receives a Base class and extends<br/>it. In this case, I decided to add a new attribute and a new method. The constructor for the extended<br/>class calls the original constructor and creates the barValue attribute. The new class has both the<br/>original’s doSomething () method and the new somethingElse () method:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 73pt;text-indent: -12pt;line-height: 118%;text-align: left;"><span>const addBar = (Base) =&gt;<br/>class extends Base {</span></p><p class="s17" style="padding-left: 98pt;text-indent: -12pt;line-height: 117%;text-align: left;"><span>constructor(fooValue, barValue) {<br/>super(fooValue);</span></p><p class="s17" style="padding-left: 97pt;text-indent: 0pt;text-align: left;">this.barValue = barValue;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 97pt;text-indent: -11pt;line-height: 117%;text-align: left;"><span>somethingElse () {<br/>console.log(</span></p><p class="s17" style="padding-left: 109pt;text-indent: 1pt;line-height: 118%;text-align: left;"><span>&quot;something added: bar... &quot;,<br/>this.barValue</span></p><p class="s17" style="padding-left: 98pt;text-indent: 0pt;text-align: left;">) ;</p><p class="s17" style="padding-top: 3pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">}</p><p class="s17" style="padding-top: 2pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">};</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="11.3"><p style="padding-top: 4pt;padding-left: 52pt;text-indent: 1pt;line-height: 113%;text-align: justify;"><b>Multi-clicking by hand: </b><span>There are various ways to achieve this with timers and counting, but<br/>make sure that you don’t interfere with single- or double-click detection! You can also use a common<br/>listener and look at </span><span class="s245">event. detail; </span>you can find out more at <span class="s245">developer . mozilla . org/</span></p><p class="s17" style="padding-left: 52pt;text-indent: 0pt;line-height: 11pt;text-align: left;">en-US/docs/Web/API/UIEvent/detail.</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="11.4"><p style="padding-left: 52pt;text-indent: 0pt;line-height: 111%;text-align: justify;"><b>Sorting logically: </b><span>If you have, say, a flags array with Boolean values, you don’t need any<br/>special comparison function; </span><span class="s245">flags . sort () </span>works “out of the box” and will place <span class="s245">false </span><span>values<br/>first and true values last. This is because the standard sort works by converting values into strings,</span></p><p style="padding-top: 1pt;padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: justify;"><span>and then comparing them; when you do this, Boolean values become &quot;false&quot; and &quot; t rue&quot;, and<br/>as &quot;false&quot; &lt; &quot;true&quot;, everything turns out well!</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="11.5"><p style="padding-left: 52pt;text-indent: 0pt;text-align: justify;"><b>Finding routes, objectively: </b>The standard solution would be to have an abstract <span class="s17">RouteFinder<br/></span><span class="s246">class</span> with several subclasses, such as <span class="s245">ByFootRouteFinder, BicycleRouteFinder, </span><span>and so<br/>on, each implementing a </span><span class="s245">f indRouteAlgorithm () </span>method in a different way, and a factory that</p></li></ol></ol><p style="padding-top: 1pt;padding-left: 52pt;text-indent: 0pt;text-align: justify;">chooses what subclass to instantiate.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 205pt;text-indent: 0pt;text-align: left;">Chapter 12, Building Better Containers - Functional Data Types      565</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-left: 43pt;text-indent: 0pt;line-height: 121%;text-align: left;"><a name="bookmark556"><span>Chapter 12,  Building Better Containers - Functional Data<br/>Types</span></a></p><ol id="l206"><ol id="l207"><li data-list-text="12.1"><p class="s10" style="padding-top: 6pt;padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;">Extending prototypes: <span class="p">Here are the needed definitions to add a map () method to Booleans,<br/>numbers, and strings:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 65pt;text-indent: -12pt;line-height: 117%;text-align: left;"><span>declare  global  {<br/>interface  Boolean  {</span></p><p class="s17" style="padding-left: 76pt;text-indent: 0pt;line-height: 13pt;text-align: left;">map(_f: (_x: boolean) =&gt; boolean): boolean;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 65pt;text-indent: -12pt;line-height: 118%;text-align: left;"><span>declare global {<br/>interface Number {</span></p><p class="s17" style="padding-left: 76pt;text-indent: 0pt;line-height: 12pt;text-align: left;">map(_f: (_x: number) =&gt; number): number;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 65pt;text-indent: -12pt;line-height: 118%;text-align: left;"><span>declare global {<br/>interface String {</span></p><p class="s17" style="padding-left: 76pt;text-indent: 0pt;line-height: 12pt;text-align: left;">map(_f: (_x: string) =&gt; string): string;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: left;">Some examples are as follows:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 64pt;text-indent: -12pt;line-height: 115%;text-align: left;"><span>Boolean.prototype.map = function (<br/>this: boolean,</span></p><p class="s17" style="padding-left: 65pt;text-indent: 0pt;text-align: left;">fn: (_x: boolean) =&gt; any</p><p class="s17" style="padding-top: 4pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">) {</p><p class="s17" style="padding-left: 65pt;text-indent: 0pt;text-align: left;">return !Ifn(this);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 52pt;text-indent: 0pt;line-height: 118%;text-align: left;"><span>const t = true;<br/>const f = false;</span></p><p class="s17" style="padding-left: 53pt;text-indent: 0pt;line-height: 235%;text-align: left;"><span>const negate = (x: boolean) =&gt; lx;<br/>console.log(t.map(negate), f.map(negate));</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-left: 20pt;text-indent: 0pt;text-align: left;">566  <span class="s189">Answers to Questions</span></p><p class="s17" style="padding-top: 3pt;padding-left: 61pt;text-indent: 0pt;line-height: 30pt;text-align: left;"><span>// false true<br/>Number.prototype.map = function</span></p><p class="s17" style="padding-top: 2pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">this: number,</p><p class="s17" style="padding-top: 2pt;padding-left: 73pt;text-indent: 0pt;line-height: 235%;text-align: left;"><span>fn: ( x: number) =&gt; number<br/>return Number(fn(this));</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 61pt;text-indent: 0pt;text-align: left;">const n = 22;</p><p class="s17" style="padding-top: 2pt;padding-left: 61pt;text-indent: 0pt;line-height: 117%;text-align: left;"><span>const addl = (n: number) =&gt; n + 1;<br/>console.log(n.map(addl));</span></p><p class="s17" style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// 23</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 73pt;text-indent: -12pt;line-height: 118%;text-align: left;"><span>String.prototype.map = function (<br/>this: string,</span></p><p class="s17" style="padding-left: 74pt;text-indent: 0pt;line-height: 12pt;text-align: left;">fn: (_x: string) =&gt; string</p><p class="s17" style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;line-height: 13pt;text-align: left;">) {</p><p class="s17" style="padding-left: 73pt;text-indent: 0pt;line-height: 13pt;text-align: left;">return String(fn(this));</p><p class="s17" style="padding-top: 4pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">};</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 61pt;text-indent: 0pt;text-align: left;">const s = &quot;Montevideo&quot;;</p><p class="s17" style="padding-top: 2pt;padding-left: 61pt;text-indent: 0pt;text-align: left;">const addBangs = (s: string): string =&gt; s + &quot;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 61pt;text-indent: 0pt;text-align: left;">console.log(s.map(addBangs));</p><p class="s17" style="padding-top: 2pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">// Montevideo!!!</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="12.2"><p class="s10" style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;">No protection? <span class="p">In previous editions of the book, I used a Symbol, whose value was defined<br/>inside a module and not exported, so nobody could access the corresponding attribute:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 61pt;text-indent: 0pt;text-align: left;">const VALUE = Symbol(&quot;Value&quot;);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-top: 5pt;padding-left: 73pt;text-indent: -12pt;line-height: 118%;text-align: left;"><span>class Container {<br/>constructor(x) {</span></p><p class="s10" style="padding-top: 1pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">this[VALUE] = x;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 205pt;text-indent: 0pt;text-align: left;">Chapter 12, Building Better Containers - Functional Data Types      567</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-top: 7pt;padding-left: 64pt;text-indent: 0pt;text-align: left;">map(fn) {</p><p class="s17" style="padding-top: 2pt;padding-left: 76pt;text-indent: 0pt;text-align: left;">return <span class="s10">fn(this[VALUE]);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 66pt;text-indent: 0pt;text-align: left;">. other methods</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 108%;text-align: justify;">Using a <span class="s245">Symbol </span>helps hide the field: the property key won’t show up in <span class="s245">Obj ect. keys () </span><span>or in<br/></span><span class="s245">for... </span>in or <span class="s245">for... of </span><span>loops, making them more meddle-proof. (If you haven’t worked with<br/>JavaScript symbols, possibly the least known of its primitive data types, you might want to check<br/>out </span><span class="s245">developer . mozilla . org/en-US/docs/Glossary/symbol.)</span></p><p style="padding-top: 8pt;padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: justify;"><span>The map () method could access the “protected” attribute because it had access to the VALUE symbol,<br/>but without that, you cannot get at the attribute.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="12.3"><p class="s10" style="padding-left: 43pt;text-indent: 0pt;line-height: 126%;text-align: left;">No abstract classes? <span class="p">You have to add a check at the constructor. If you want the XXX class to be<br/>abstract, it should start like this:</span></p><p class="s17" style="padding-top: 7pt;padding-left: 64pt;text-indent: -11pt;line-height: 117%;text-align: left;"><a name="bookmark557"><span>class XXX {<br/>constructor (...) {</span></a></p><p class="s10" style="padding-top: 2pt;padding-left: 89pt;text-indent: -12pt;line-height: 143%;text-align: left;"><a name="bookmark558"><span>if (this.constructor         XXX) {<br/>throw new Error(&quot;Cannot initialize XXX class&quot;)</span></a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 78pt;text-indent: 0pt;text-align: left;">. rest of the constructor</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 66pt;text-indent: 0pt;text-align: left;">. other methods</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">568  Answers to Questions</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="12.4"><p class="s10" style="padding-left: 78pt;text-indent: -25pt;text-align: left;">Maybe tasks? <span class="p">The following code shows a simpler solution than the one we looked at earlier:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 61pt;text-indent: 0pt;text-align: left;">const pending = Maybe.of(listOfTasks)</p><p class="s17" style="padding-top: 2pt;padding-left: 75pt;text-indent: 0pt;text-align: left;">.map(getField(&quot;byPerson&quot;))</p><p class="s17" style="padding-top: 2pt;padding-left: 75pt;text-indent: 0pt;text-align: left;">.map(filter((t) = &gt; t.responsible === name))</p><p class="s17" style="padding-top: 2pt;padding-left: 75pt;text-indent: 0pt;text-align: left;">.map((t) =&gt; tasks)</p><p class="s17" style="padding-top: 2pt;padding-left: 75pt;text-indent: 0pt;text-align: left;">.map((t) =&gt; t[0] )</p><p class="s17" style="padding-top: 2pt;padding-left: 75pt;text-indent: 0pt;text-align: left;">.map(filter((t) =&gt; It.done))</p><p class="s17" style="padding-top: 2pt;padding-left: 75pt;text-indent: 0pt;text-align: left;">.map(getField(&quot;id&quot;) )</p><p class="s17" style="padding-top: 2pt;padding-left: 75pt;text-indent: 0pt;text-align: left;">.valueOf();</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>Here, we apply one function after the other, secure in the knowledge that if any of these functions<br/>produces an empty result (or even if the original listOfTasks is null), the sequence of calls will</span></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">go on. In the end, you will either get an array of task IDs or a nul 1 value.</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="12.5"><p class="s10" style="padding-top: 6pt;padding-left: 52pt;text-indent: 0pt;line-height: 124%;text-align: left;">Extending your trees: <span class="p">Calculating the tree’s height is simple if you do this in a recursive fashion.<br/>The height of an empty tree is zero, while the height of a non-empty tree is one (for the root) plus the<br/>maximum height of its left and right subtrees:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 73pt;text-indent: -12pt;line-height: 117%;text-align: left;"><span>const treeHeight = &lt;A&gt;(tree: TREE&lt;A&gt;): number =&gt;<br/>tree (</span></p><p class="s17" style="padding-left: 88pt;text-indent: 0pt;text-align: left;">(val, left, right) =&gt;</p><p class="s17" style="padding-top: 2pt;padding-left: 88pt;text-indent: 10pt;line-height: 123%;text-align: left;"><span>1 + Math.max(treeHeight(left), treeHeight(right)),<br/>0 =&gt; 0</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 9pt;padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>Listing the keys in order is a well-known requirement. Because of the way that the tree is built, you list<br/>the left subtrees keys first, then the root, and finally the right subtrees keys, all in a recursive fashion:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 73pt;text-indent: -12pt;line-height: 117%;text-align: left;"><span>const treeList = &lt;A&gt;(tree: TREE&lt;A&gt;): void =&gt;<br/>tree (</span></p><p class="s17" style="padding-left: 97pt;text-indent: -9pt;line-height: 118%;text-align: left;"><span>(value, left, right) =&gt; {<br/>treeList(left);<br/>console.log(value);<br/>treeList(right);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 88pt;text-indent: 0pt;text-align: left;">() =&gt; {</p><p class="s17" style="padding-top: 1pt;padding-left: 98pt;text-indent: 0pt;text-align: left;">// nothing</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 205pt;text-indent: 0pt;text-align: left;">Chapter 12, Building Better Containers - Functional Data Types      569</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-top: 7pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>Finally, deleting a key from a binary search tree is a bit more complex. First, you must locate the node<br/>that is going to be removed, and then there are several cases:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l208"><li data-list-text="•"><p style="padding-left: 70pt;text-indent: -13pt;text-align: left;">If the node has no subtrees, deletion is simple.</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">If the node has only one subtree, you just replace the node with its subtree</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">If the node has two subtrees, then you have to do the following:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l209"><li data-list-text="■"><p style="padding-left: 81pt;text-indent: -11pt;text-align: left;">Find the minimum key in the tree with a greater key</p></li><li data-list-text="■"><p style="padding-top: 8pt;padding-left: 81pt;text-indent: -11pt;text-align: left;">Place it in the node’s place</p></li></ul></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>Since this algorithm is well covered in all computer science textbooks, I won’t go into more detail<br/>about this here:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 65pt;text-indent: -12pt;line-height: 115%;text-align: left;"><span>const treeRemove = &lt;A&gt;(<br/>t©Remove: A,</span></p><p class="s17" style="padding-left: 65pt;text-indent: 0pt;text-align: left;">tree: TREE&lt;A&gt;</p><p class="s17" style="padding-top: 2pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">): TREE&lt;A&gt; =&gt;</p><p class="s17" style="padding-top: 2pt;padding-left: 64pt;text-indent: 0pt;text-align: left;">tree (</p><p class="s17" style="padding-top: 2pt;padding-left: 78pt;text-indent: 0pt;text-align: left;">(val, left, right) =&gt; {</p><p class="s17" style="padding-top: 2pt;padding-left: 101pt;text-indent: -12pt;line-height: 118%;text-align: left;"><span>const findMinimumAndRemove = (<br/>tree: TREE&lt;A&gt; /* never empty */</span></p><p class="s17" style="padding-left: 89pt;text-indent: 0pt;line-height: 13pt;text-align: left;">): { min: A; tree: TREE&lt;A&gt; } =&gt;</p><p class="s17" style="padding-top: 2pt;padding-left: 100pt;text-indent: 0pt;text-align: left;">tree (</p><p class="s17" style="padding-top: 2pt;padding-left: 114pt;text-indent: 0pt;text-align: left;">(value, left, right) =&gt; {</p><p class="s17" style="padding-top: 2pt;padding-left: 125pt;text-indent: 0pt;text-align: left;">if (treelsEmpty(left)) {</p><p class="s17" style="padding-top: 2pt;padding-left: 137pt;text-indent: 0pt;text-align: left;">return { min: value, tree: right };</p><p class="s17" style="padding-top: 2pt;padding-left: 125pt;text-indent: 0pt;text-align: left;">} else {</p><p class="s17" style="padding-top: 2pt;padding-left: 136pt;text-indent: 0pt;line-height: 115%;text-align: left;"><span>const result = findMinimumAndRemove(left);<br/>return {</span></p><p class="s17" style="padding-left: 148pt;text-indent: 0pt;text-align: left;">min: result.min,</p><p class="s17" style="padding-top: 2pt;padding-left: 148pt;text-indent: 0pt;text-align: left;">tree: Tree(value, result.tree, right),</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 114pt;text-indent: 0pt;text-align: left;">0 =&gt; {</p><p class="s17" style="padding-top: 1pt;padding-left: 125pt;text-indent: 0pt;text-align: left;">/* not needed */</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-left: 20pt;text-indent: 0pt;text-align: left;">570  <span class="s189">Answers to Questions</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 122pt;text-indent: 0pt;text-align: left;">}</p><p class="s17" style="padding-left: 110pt;text-indent: 0pt;text-align: left;">) ;</p><p class="s17" style="padding-top: 1pt;padding-left: 98pt;text-indent: 0pt;text-align: left;">if (toRemove &lt; val) {</p><p class="s17" style="padding-top: 1pt;padding-left: 121pt;text-indent: -12pt;line-height: 118%;text-align: left;"><span>return Tree(val, treeRemove(toRemove, left),<br/>right);</span></p><p class="s17" style="padding-left: 98pt;text-indent: 0pt;line-height: 13pt;text-align: left;">} else if (toRemove &gt; val) {</p><p class="s17" style="padding-top: 2pt;padding-left: 121pt;text-indent: -12pt;line-height: 118%;text-align: left;"><span>return Tree(val, left, treeRemove(toRemove,<br/>right));</span></p><p class="s17" style="padding-left: 109pt;text-indent: -11pt;line-height: 117%;text-align: left;"><span>} else if (treelsEmpty(left) &amp;&amp; treelsEmpty(right)) {<br/>return EmptyTree();</span></p><p class="s17" style="padding-left: 98pt;text-indent: 0pt;text-align: left;">} else if (treelsEmpty(left) !== treelsEmpty(right))</p><p class="s17" style="padding-top: 4pt;padding-left: 111pt;text-indent: 0pt;line-height: 13pt;text-align: left;">{</p><p class="s17" style="padding-left: 109pt;text-indent: 0pt;line-height: 13pt;text-align: left;">return tree(</p><p class="s17" style="padding-top: 2pt;padding-left: 134pt;text-indent: -10pt;line-height: 114%;text-align: left;"><span>(val, left, right) =&gt;<br/>left (</span></p><p class="s17" style="padding-left: 148pt;text-indent: 0pt;line-height: 115%;text-align: left;"><span>() =&gt; left,<br/>() =&gt; right</span></p><p class="s17" style="padding-top: 1pt;padding-left: 51pt;text-indent: 0pt;text-align: center;">) ,</p><p class="s17" style="padding-top: 2pt;padding-left: 51pt;text-indent: 0pt;text-align: center;">0 =&gt; {</p><p class="s17" style="padding-top: 1pt;padding-left: 51pt;text-indent: 0pt;text-align: center;">/* not needed */</p><p class="s17" style="padding-top: 4pt;padding-left: 122pt;text-indent: 0pt;text-align: left;">}</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 98pt;text-indent: 0pt;text-align: left;">} else {</p><p class="s17" style="padding-top: 2pt;padding-left: 109pt;text-indent: 0pt;line-height: 115%;text-align: left;"><span>const result = findMinimumAndRemove(right);<br/>return Tree(result.min, left, result.tree);</span></p><p class="s17" style="padding-top: 2pt;padding-left: 98pt;text-indent: 0pt;text-align: left;">}</p><p class="s17" style="padding-top: 2pt;padding-left: 86pt;text-indent: 0pt;text-align: left;">b</p><p class="s17" style="padding-left: 7pt;text-indent: 0pt;text-align: center;">() =&gt; tree</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="12.6"><p class="s10" style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;">Code shortening: <span class="p">The first thing you would do is get rid of the first ternary operator by taking<br/>advantage of the short-circuit evaluation of the | | operator:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 74pt;text-indent: -12pt;line-height: 117%;text-align: left;"><span>const treeSearch2 = &lt;A&gt;(<br/>findValue: A,</span></p><p class="s17" style="padding-left: 7pt;text-indent: 0pt;line-height: 13pt;text-align: center;">tree: TREE&lt;A&gt;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 205pt;text-indent: 0pt;text-align: left;">Chapter 12, Building Better Containers - Functional Data Types      571</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 65pt;text-indent: -11pt;line-height: 119%;text-align: left;"><span>): boolean =&gt;<br/>tree (</span></p><p class="s17" style="padding-left: 89pt;text-indent: -10pt;line-height: 117%;text-align: left;"><span>(value, left, right) =&gt;<br/>findValue === value |<br/>(findValue &lt; value</span></p><p class="s17" style="padding-left: 101pt;text-indent: 0pt;text-align: left;">? treeSearch2(findValue, left)</p><p class="s17" style="padding-top: 2pt;padding-left: 78pt;text-indent: 23pt;line-height: 118%;text-align: left;"><span>: treeSearch2(findValue, right)),<br/>() =&gt; false</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>Also, seeing that both alternatives in the second ternary operator are very similar, you could also do<br/>some shortening there:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 65pt;text-indent: -12pt;line-height: 117%;text-align: left;"><span>const treeSearch3 = &lt;A&gt;(<br/>findValue: A,</span></p><p class="s17" style="padding-left: 65pt;text-indent: 0pt;line-height: 13pt;text-align: left;">tree: TREE&lt;A&gt;</p><p class="s17" style="padding-top: 2pt;padding-left: 65pt;text-indent: -11pt;line-height: 119%;text-align: left;"><span>): boolean =&gt;<br/>tree (</span></p><p class="s17" style="padding-left: 88pt;text-indent: -9pt;line-height: 118%;text-align: left;"><span>(value, left, right) =&gt;<br/>findValue === value |<br/>treeSearch3(</span></p><p class="s17" style="padding-left: 101pt;text-indent: 0pt;line-height: 13pt;text-align: left;">findValue,</p><p class="s17" style="padding-top: 1pt;padding-left: 101pt;text-indent: 0pt;text-align: left;">findValue &lt; value ? left : right</p><p class="s17" style="padding-top: 2pt;padding-left: 89pt;text-indent: 0pt;text-align: left;">) ,</p><p class="s17" style="padding-top: 1pt;padding-left: 78pt;text-indent: 0pt;text-align: left;">() =&gt; false</p><p class="s17" style="padding-top: 3pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 43pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>Remember: shorter doesn’t imply better! However, I’ve found many examples of this kind of code<br/>tightening, and it’s better if you have been exposed to it, too.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="12.7"><p class="s10" style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;">Functional lists: <span class="p">Let’s add to the samples that have already been provided. We can simplify<br/>working with lists if we can transform a list into an array, and vice versa:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 65pt;text-indent: -12pt;line-height: 118%;text-align: left;"><span>const listToArray = &lt;A&gt;(list: LIST&lt;A&gt;): A[] =&gt;<br/>list (</span></p><p class="s17" style="padding-left: 78pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>(head, tail) =&gt; [head, ...listToArray(tail)],<br/>0 =&gt; []</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-left: 20pt;text-indent: 0pt;text-align: left;">572  <span class="s189">Answers to Questions</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 73pt;text-indent: -12pt;line-height: 115%;text-align: left;"><span>const listFromArray = &lt;A&gt;(arr: A[] ) : LIST&lt;A&gt; =&gt;<br/>arr.length</span></p><p class="s17" style="padding-left: 86pt;text-indent: 0pt;text-align: left;">? NewList(arr[0], listFromArray(arr.slice(1)))</p><p class="s17" style="padding-top: 2pt;padding-left: 87pt;text-indent: 0pt;text-align: left;">: EmptyList();</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>Concatenating two lists together and appending a value to a list have simple recursive implementations.<br/>We can also reverse a list by using the appending function:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 74pt;text-indent: -12pt;line-height: 118%;text-align: left;"><span>const listConcat = &lt;A&gt;(listl: LIST&lt;A&gt;, list2: LIST&lt;A&gt;) =&gt;<br/>listl (</span></p><p class="s17" style="padding-left: 88pt;text-indent: 0pt;line-height: 115%;text-align: left;"><span>(head, tail) =&gt; NewList(head, listConcat(tail, list2)),<br/>() =&gt; list2</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 74pt;text-indent: -12pt;line-height: 117%;text-align: left;"><span>const listAppend = &lt;A&gt;(list: LIST&lt;A&gt;, value: A): LIST&lt;A&gt; =&gt;<br/>list (</span></p><p class="s17" style="padding-left: 88pt;text-indent: 0pt;line-height: 118%;text-align: left;"><span>(head, tail) =&gt; NewList(head, listAppend(tail, value)),<br/>() =&gt; NewList(value, EmptyList())</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 74pt;text-indent: -12pt;line-height: 117%;text-align: left;"><span>const listReverse = &lt;A&gt;(list: LIST&lt;A&gt;): LIST&lt;A&gt; =&gt;<br/>list (</span></p><p class="s17" style="padding-left: 88pt;text-indent: 0pt;line-height: 118%;text-align: left;"><span>(head, tail) =&gt; listAppend(listReverse(tail), head),<br/>() =&gt; EmptyList()</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 9pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">Finally, the basic <span class="s245">map (), filter (), </span>and <span class="s245">reduce () </span>operations are good to have:</p><p class="s17" style="padding-top: 10pt;padding-left: 74pt;text-indent: -12pt;line-height: 118%;text-align: left;"><span>const listMap = &lt;A, B&gt;(<br/>list: LIST&lt;A&gt;,</span></p><p class="s17" style="padding-left: 74pt;text-indent: 0pt;line-height: 13pt;text-align: left;">fn: (_X: A) =&gt; B</p><p class="s17" style="padding-top: 2pt;padding-left: 62pt;text-indent: 0pt;text-align: left;">) : LIST&lt;B&gt; =&gt;</p><p class="s17" style="padding-top: 2pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">list (</p><p class="s17" style="padding-top: 2pt;padding-left: 85pt;text-indent: 2pt;line-height: 118%;text-align: left;"><span>(head, tail) =&gt; NewList(fn(head), listMap(tail, fn)),<br/>EmptyList</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 205pt;text-indent: 0pt;text-align: left;">Chapter 12, Building Better Containers - Functional Data Types      573</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 65pt;text-indent: -12pt;line-height: 115%;text-align: left;"><span>const listFilter = &lt;A&gt;(<br/>list: LIST&lt;A&gt;,</span></p><p class="s17" style="padding-left: 65pt;text-indent: 0pt;text-align: left;">fn: (_x: A) =&gt; boolean</p><p class="s17" style="padding-top: 2pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">): LIST&lt;A&gt; =&gt;</p><p class="s17" style="padding-top: 2pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">list (</p><p class="s17" style="padding-top: 2pt;padding-left: 89pt;text-indent: -10pt;line-height: 117%;text-align: left;"><span>(head, tail) =&gt;<br/>fn(head)</span></p><p class="s17" style="padding-left: 101pt;text-indent: 0pt;text-align: left;">? NewList(head, listFilter(tail, fn))</p><p class="s17" style="padding-top: 2pt;padding-left: 76pt;text-indent: 25pt;line-height: 117%;text-align: left;"><span>: listFilter(tail, fn),<br/>EmptyList</span></p><p class="s17" style="padding-top: 1pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 65pt;text-indent: -12pt;line-height: 115%;text-align: left;"><span>const listReduce = &lt;A, B&gt;(<br/>list: LIST&lt;A&gt;,</span></p><p class="s17" style="padding-left: 64pt;text-indent: 0pt;line-height: 118%;text-align: left;"><span>fn: (_acc: B, _val: A) =&gt; B,<br/>accum: B</span></p><p class="s17" style="text-indent: 0pt;line-height: 12pt;text-align: right;">) : B =&gt;</p><p class="s17" style="padding-top: 2pt;text-indent: 0pt;text-align: right;">list (</p><p class="s17" style="padding-top: 2pt;padding-left: 78pt;text-indent: 0pt;line-height: 115%;text-align: left;"><span>(head, tail) =&gt; listReduce(tail, fn, fnfaccum, head)),<br/>() =&gt; accum</span></p><p class="s17" style="padding-top: 1pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">) ;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>The following are some exercises that have been left for you to tackle. Generate a printable version<br/>of a list:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l210"><li data-list-text="•"><p style="padding-left: 70pt;text-indent: -13pt;text-align: left;">Compare two lists to see whether they have the same values, in the same order</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">Search a list for a value</p></li><li data-list-text="•"><p style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">Get, update, or remove the value at the /7th position of a list</p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="12.8"><p style="padding-top: 6pt;padding-left: 62pt;text-indent: -18pt;text-align: left;"><b>No Boolean operators? </b>Let’s start by defining a <span class="s245">BOOLEAN </span>type and two special functions, <span class="s245">TRUE</span></p></li></ol></ol><p style="padding-left: 43pt;text-indent: 0pt;text-align: left;">and <span class="s245">FALSE, </span>which will stand for the usual <span class="s245">true </span>and <span class="s245">false </span>values:</p><p class="s17" style="padding-top: 10pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">type BOOLEAN = (_true: any, _false: any) =&gt; any;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 64pt;text-indent: -11pt;line-height: 118%;text-align: left;">const TRUE: BOOLEAN = (trueValue: any, <u>&nbsp;&nbsp;&nbsp;&nbsp; </u><span>: any) =&gt;<br/>trueValue;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 21pt;text-indent: 0pt;text-align: left;">574  Answers to Questions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 74pt;text-indent: -12pt;line-height: 119%;text-align: left;">const FALSE: BOOLEAN = (<u> &nbsp; </u><span>: any, falseValue: any) =&gt;<br/>falseValue;</span></p><p style="padding-top: 9pt;padding-left: 52pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>The BOOLEAN type receives two values and returns one of those. A TRUE Boolean returns the first of<br/>those two values; a FALSE Boolean returns the second. We can construct and check variables like this:</span></p><p class="s17" style="padding-top: 8pt;padding-left: 73pt;text-indent: -12pt;line-height: 115%;text-align: left;"><span>const MakeBool = (value: boolean) =&gt; (value ? TRUE :<br/>FALSE);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 73pt;text-indent: -11pt;line-height: 118%;text-align: left;"><span>const valueOf = (boolValue: BOOLEAN): boolean =&gt;<br/>boolValue(true, false);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-top: 4pt;padding-left: 61pt;text-indent: 0pt;line-height: 117%;text-align: left;"><span>console.log(&quot;LOG T &quot;<br/>console.log(&quot;LOG F &quot;</span></p><p class="s17" style="padding-left: 62pt;text-indent: 0pt;text-align: left;">// true false</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 61pt;text-indent: 0pt;line-height: 118%;text-align: left;"><span>console.log(&quot;VAL T &quot;<br/>console.log(&quot;VAL F &quot;</span></p><p class="s17" style="padding-left: 62pt;text-indent: 0pt;line-height: 13pt;text-align: left;">// true false</p><p class="s17" style="padding-top: 4pt;padding-left: 27pt;text-indent: 0pt;text-align: left;">, valueOf(TRUE));</p><p class="s17" style="padding-top: 2pt;padding-left: 27pt;text-indent: 0pt;text-align: left;">, valueOf(FALSE));</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 37pt;text-indent: 0pt;line-height: 115%;text-align: left;"><span>valueOf(MakeBool(true)));<br/>valueOf(MakeBool(false)));</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">We can now define operators:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 73pt;text-indent: -11pt;line-height: 118%;text-align: left;"><span>const NOT = (boolValue: BOOLEAN): BOOLEAN =&gt;<br/>boolValue(FALSE, TRUE);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 61pt;text-indent: 0pt;text-align: left;">const AND = (</p><p class="s17" style="padding-top: 2pt;padding-left: 73pt;text-indent: 0pt;line-height: 117%;text-align: left;"><span>boolLeft: BOOLEAN,<br/>boolRight: BOOLEAN</span></p><p class="s17" style="padding-left: 62pt;text-indent: 0pt;line-height: 13pt;text-align: left;">): BOOLEAN =&gt; boolLeft(boolRight, FALSE);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 61pt;text-indent: 0pt;text-align: left;">const OR = (</p><p class="s17" style="padding-top: 2pt;padding-left: 73pt;text-indent: 0pt;line-height: 117%;text-align: left;"><span>boolLeft: BOOLEAN,<br/>boolRight: BOOLEAN</span></p><p class="s17" style="padding-left: 62pt;text-indent: 0pt;line-height: 13pt;text-align: left;">): BOOLEAN =&gt; boolLeft(TRUE, boolRight);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 61pt;text-indent: 0pt;text-align: left;">const XOR = (</p><p class="s17" style="padding-top: 2pt;padding-left: 73pt;text-indent: 0pt;text-align: left;">boolLeft: BOOLEAN,</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 205pt;text-indent: 0pt;text-align: left;">Chapter 12, Building Better Containers - Functional Data Types      575</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 64pt;text-indent: 0pt;text-align: left;">boolRight: BOOLEAN</p><p class="s17" style="padding-top: 2pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">): BOOLEAN =&gt; boolLeft(NOT(boolRight), boolRight);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 53pt;text-indent: 0pt;text-align: left;">const EQU = (</p><p class="s17" style="padding-top: 2pt;padding-left: 64pt;text-indent: 0pt;line-height: 118%;text-align: left;"><span>boolLeft: BOOLEAN,<br/>boolRight: BOOLEAN</span></p><p class="s17" style="padding-left: 53pt;text-indent: 0pt;line-height: 13pt;text-align: left;">): BOOLEAN =&gt; boolLeft(boolRight, NOT(boolRight));</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 52pt;text-indent: 0pt;text-align: left;">const IMP = (</p><p class="s17" style="padding-top: 2pt;padding-left: 64pt;text-indent: 0pt;line-height: 118%;text-align: left;"><span>boolLeft: BOOLEAN,<br/>boolRight: BOOLEAN</span></p><p class="s17" style="padding-left: 53pt;text-indent: 0pt;line-height: 13pt;text-align: left;">): BOOLEAN =&gt; boolLeft(boolRight, TRUE);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: left;"><span>These are not the only possibilities, but I’ll leave you to discover alternatives. Finally, we could have<br/>an </span><span class="s245">if Else () </span>function to work with these <span class="s245">BOOLEAN </span>values and thunks:</p><p class="s17" style="padding-top: 9pt;padding-left: 64pt;text-indent: -11pt;line-height: 117%;text-align: left;"><span>const ifElse = (<br/>boolValue: BOOLEAN,<br/>fnTRUE: FN,<br/>fnFALSE:  FN</span></p><p class="s17" style="padding-left: 53pt;text-indent: 0pt;line-height: 13pt;text-align: left;">) =&gt; boolValue(fnTRUE, fnFALSE)();</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 53pt;text-indent: 0pt;text-align: left;">ifElse(</p><p class="s17" style="padding-top: 2pt;padding-left: 64pt;text-indent: 0pt;text-align: left;">TRUE,</p><p class="s17" style="padding-top: 2pt;padding-left: 66pt;text-indent: 0pt;line-height: 117%;text-align: left;"><span>() =&gt; console.log(&quot;I&#39;m true&quot;),<br/>() =&gt; console.log(&quot;I&#39;m false&quot;)</span></p><p class="s17" style="padding-left: 53pt;text-indent: 0pt;text-align: left;">) ;</p><p class="s17" style="padding-top: 1pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// true</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="padding-left: 53pt;text-indent: 0pt;text-align: left;">ifElse(</p><p class="s17" style="padding-top: 2pt;padding-left: 65pt;text-indent: 0pt;text-align: left;">FALSE,</p><p class="s17" style="padding-top: 2pt;padding-left: 66pt;text-indent: 0pt;line-height: 115%;text-align: left;"><span>() =&gt; console.log(&quot;I&#39;m true&quot;),<br/>() =&gt; console.log(&quot;I&#39;m false&quot;)</span></p><p class="s17" style="padding-top: 1pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">) ;</p><p class="s17" style="padding-top: 1pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">// false</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">576 Answers to Questions</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">A final comment: this code goes to show more things that you <i>could </i><span>do with functions, but it doesn’t<br/>mean you </span><i>should </i><a href="http://www/" class="s11" target="_blank">do them this way! You can read the following at www</a><span class="s245">. usrsb . in/Building-<br/>Data-Structures-from-Functions.html:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s9" style="padding-left: 106pt;text-indent: 0pt;line-height: 115%;text-align: center;"><span>In the end, this might strike you as nothing more than a useless programming<br/>trick. In a sense that’s right. I’d never use this in my own code. What makes this<br/>technique so valuable is that it actually fits into the broader context of lambda<br/>calculus, which is a mathematical abstraction of computation.</span></p><p style="padding-top: 5pt;padding-left: 1pt;text-indent: 0pt;text-align: center;">Couldn’t say it better myself!</p><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-top: 13pt;padding-left: 297pt;text-indent: 0pt;text-align: left;"><a name="bookmark559">Bibliography</a></h2><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 43pt;text-indent: 0pt;text-align: left;">The following texts are freely available online:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l211"><li data-list-text="•"><p class="s33" style="padding-left: 70pt;text-indent: -13pt;line-height: 110%;text-align: justify;">	<span class="s9">ECMA-262: ECMAScript 2022 Language Specification, </span><span class="p">latest edition (currently the 13</span><span class="s162">th</span><a href="http://www/" class="s11" target="_blank">) at<br/></a><a href="http://www/" class="s284" target="_blank">www</a><span class="s17">. ecma- international. org/ecma-262/. </span><span class="s246">This provides the official standard for<br/>the current version of JavaScript.</span></p></li><li data-list-text="•"><p class="s9" style="padding-top: 5pt;padding-left: 70pt;text-indent: -13pt;text-align: justify;">Eloquent JavaScript, <span class="p">Second Edition, </span>by Marijn Haverbeke, <span class="p">at </span><span class="s245">eloquent j avascript. net/</span></p></li><li data-list-text="•"><p class="s9" style="padding-top: 7pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">JavaScript for Impatient Programmers (ES2022 edition), <span class="p">by </span>Dr. Axel Rauschmayer, <span class="p">at</span></p><p class="s17" style="padding-left: 70pt;text-indent: 0pt;text-align: left;">exploringj s.com/impatient-j s/</p></li><li data-list-text="•"><p class="s9" style="padding-top: 5pt;padding-left: 70pt;text-indent: -13pt;text-align: justify;"><span class="s33">	</span>Functional-Light JavaScript, <span class="p">by </span>Kyle Simpson, <span class="s17">at github. com/getify/Functional-<br/>Light-JS</span></p></li><li data-list-text="•"><p class="s9" style="padding-top: 5pt;padding-left: 71pt;text-indent: -13pt;text-align: justify;"><span class="s33">	</span>JavaScript Allonge (the “six” edition), <span class="s17">by </span>Reginald Braithwaite, <span class="s17">at leanpub . com/<br/>j avascriptallongesix/read</span></p></li><li data-list-text="•"><p class="s9" style="padding-top: 7pt;padding-left: 70pt;text-indent: -12pt;line-height: 107%;text-align: justify;"><span class="s33">	</span>Professor Frisby’s Mostly Adequate Guide to Functional Programming, <span class="p">by </span><span>Dr. Boolean (Brian<br/>Lonsdorfi, </span><span class="p">at </span><span class="s245">github.com/MostlyAdequate/mostly-adequate-guide</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: left;">If you prefer printed books, you can go with this list:</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="•"><p class="s9" style="padding-left: 70pt;text-indent: -13pt;text-align: left;">Beginning Functional JavaScript, <span class="p">by </span>Anto Aravinth, Apress, <span class="p">2017</span></p></li><li data-list-text="•"><p class="s9" style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">Discover Functional JavaScript, <span class="p">by </span>Cristian Salcescu, <span class="p">(independently published), 2019</span></p></li><li data-list-text="•"><p class="s9" style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">Functional JavaScript, <span class="p">by </span>Michael Fogus, O’Reilly Media, <span class="p">2013</span></p></li><li data-list-text="•"><p class="s9" style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">Functional Programming in JavaScript, <span class="p">by </span>Dan Mantyla, Packt Publishing, <span class="p">2015</span></p></li><li data-list-text="•"><p class="s9" style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">Functional Programming in JavaScript, <span class="p">by </span>Luis Atencio, Manning Publications, <span class="p">2016</span></p></li><li data-list-text="•"><p class="s9" style="padding-top: 8pt;padding-left: 70pt;text-indent: -12pt;line-height: 123%;text-align: justify;"><span class="s33">	</span>Grokking Simplicity - Taming complex software with functional thinking, <span class="p">by </span><span>Eric Normand,<br/>Manning Publications, </span><span class="p">2021</span></p></li><li data-list-text="•"><p class="s9" style="padding-top: 5pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">Hands-on Functional Programming with TypeScript, <span class="p">by </span>Remo Jansen, Packt Publishing, <span class="p">2019</span></p></li><li data-list-text="•"><p class="s9" style="padding-top: 8pt;padding-left: 70pt;text-indent: -12pt;line-height: 125%;text-align: justify;"><span class="s33">	</span>Introduction to Functional Programming, <span class="p">by </span><span>Richard Bird and Philip Wadler, Prentice Hall<br/>International, </span><span class="p">1988. A more theoretical point of view, not dealing specifically with JavaScript</span></p></li><li data-list-text="•"><p class="s9" style="padding-top: 5pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">Pro JavaScript Design Patterns, <span class="p">by </span>Ross Harmes and Dustin Diaz, Apress, <span class="p">2008</span></p></li><li data-list-text="•"><p class="s9" style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">Secrets of the JavaScript Ninja, <span class="p">by John Resig and Bear Bibeault, </span>Manning Publications, <span class="p">2012</span></p></li><li data-list-text="•"><p class="s9" style="padding-top: 8pt;padding-left: 70pt;text-indent: -13pt;text-align: left;">TypeScript 4 Design Patterns and Best Practices, <span class="p">by </span>Theo Despoudis, Packt Publishing, <span class="p">2021</span></p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">578  Bibliography</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 52pt;text-indent: 0pt;text-align: left;">Also interesting, though with a lesser focus on functional programming, are the following:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l212"><li data-list-text="•"><p class="s9" style="padding-left: 79pt;text-indent: -13pt;text-align: left;">High-Performance JavaScript, <span class="p">by </span>Nicholas Zakas, O’Reilly Media, <span class="p">2010</span></p></li><li data-list-text="•"><p class="s9" style="padding-top: 8pt;padding-left: 79pt;text-indent: -13pt;text-align: left;">JavaScript Patterns, <span class="p">by </span>Stoyan Stefanov, O’Reilly Media, <span class="p">2010</span></p></li><li data-list-text="•"><p class="s9" style="padding-top: 8pt;padding-left: 79pt;text-indent: -13pt;text-align: left;">JavaScript: The Good Parts, <span class="p">by </span>Douglas Crockford, O’Reilly Media, <span class="p">2008</span></p></li><li data-list-text="•"><p class="s9" style="padding-top: 8pt;padding-left: 79pt;text-indent: -13pt;text-align: left;">JavaScript with Promises, <span class="p">by </span>Daniel Parker, O’Reilly Media, <span class="p">2015</span></p></li><li data-list-text="•"><p class="s9" style="padding-top: 8pt;padding-left: 79pt;text-indent: -13pt;text-align: left;">Learning JavaScript Design Patterns, <span class="p">by </span>Addy Osmani, O’Reilly Media, <span class="p">2012</span></p></li><li data-list-text="•"><p class="s9" style="padding-top: 7pt;padding-left: 79pt;text-indent: -13pt;text-align: left;">Mastering JavaScript Design Patterns, Second Edition, <span class="p">by </span>Simon Timms, Packt Publishing, <span class="p">2016</span></p></li><li data-list-text="•"><p class="s9" style="padding-top: 8pt;padding-left: 79pt;text-indent: -13pt;text-align: left;">Mastering JavaScript High Performance, <span class="p">by </span>Chad Adams, Packt Publishing, <span class="p">2015</span></p></li><li data-list-text="•"><p class="s9" style="padding-top: 8pt;padding-left: 79pt;text-indent: -13pt;text-align: left;">Pro JavaScript Performance, <span class="p">by </span>Tom Barker, Apress, <span class="p">2012</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 8pt;padding-left: 52pt;text-indent: 0pt;text-align: left;">These titles are on the subject of reactive functional programming:</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="•"><p class="s9" style="padding-left: 79pt;text-indent: -13pt;text-align: left;">Mastering Reactive JavaScript, <span class="p">by </span>Erich de Souza Oliveira, Packt Publishing, <span class="p">2017</span></p></li><li data-list-text="•"><p class="s9" style="padding-top: 8pt;padding-left: 79pt;text-indent: -13pt;text-align: left;">Reactive Programming with Node.js, <span class="p">by </span>Fernando Doglio, Apress, <span class="p">2016</span></p></li><li data-list-text="•"><p class="s9" style="padding-top: 8pt;padding-left: 79pt;text-indent: -13pt;text-align: left;">Reactive Programming with RxJS, <span class="p">by </span>Sergi Mansilla, The Pragmatic Programmers, <span class="p">2015</span></p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s349" style="padding-top: 9pt;text-indent: 0pt;text-align: right;">Index</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s350" style="padding-top: 12pt;padding-left: 12pt;text-indent: 0pt;text-align: left;"><a name="bookmark560">A</a></p><p class="s10" style="padding-top: 9pt;padding-left: 13pt;text-indent: 0pt;text-align: left;">Adapter pattern 413-415</p><p class="s10" style="padding-top: 3pt;padding-left: 13pt;text-indent: 0pt;text-align: left;">addTiming() function 180-182</p><p class="s10" style="padding-top: 3pt;padding-left: 13pt;text-indent: 0pt;text-align: left;">altered functions 169</p><p class="s10" style="padding-top: 3pt;padding-left: 13pt;text-indent: 0pt;line-height: 137%;text-align: left;"><span>anonymous functions 13<br/>applyO method</span></p><p style="padding-left: 20pt;text-indent: 0pt;line-height: 10pt;text-align: left;">reference link 15</p><p class="s10" style="padding-top: 3pt;padding-left: 13pt;text-indent: 0pt;line-height: 135%;text-align: left;"><span>architectural patterns 411<br/>arguments</span></p><p style="padding-left: 20pt;text-indent: 0pt;line-height: 10pt;text-align: left;">working with 47-49</p><p class="s10" style="padding-top: 3pt;padding-left: 13pt;text-indent: 0pt;line-height: 135%;text-align: left;"><span>arity() function 201<br/>array</span></p><p style="padding-left: 20pt;text-indent: 0pt;text-align: left;">averaging 218,219</p><p style="padding-top: 3pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">flattening 127-130</p><p style="padding-top: 3pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">searching 140</p><p style="padding-top: 3pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">special search case 141, 142</p><p style="padding-top: 3pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">summing 113-115</p><p class="s10" style="padding-top: 3pt;padding-left: 12pt;text-indent: 0pt;text-align: left;">arrow functions 12,13,45</p><p style="padding-top: 3pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">partial application with 237, 238</p><p style="padding-top: 3pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">reference link 45</p><p class="s10" style="padding-top: 3pt;padding-left: 12pt;text-indent: 0pt;text-align: left;">async/await</p><p style="padding-top: 3pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">reference link 60</p><p class="s10" style="padding-top: 3pt;padding-left: 12pt;text-indent: 0pt;text-align: left;">async calls</p><p style="padding-top: 3pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">mapping 149, 150</p><p style="padding-top: 3pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">reducing 151-153</p><p style="padding-top: 3pt;padding-left: 20pt;text-indent: 0pt;text-align: left;">used, for filtering 150,151</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 14pt;text-indent: 0pt;text-align: left;"><a name="bookmark561">async functions</a></p><p style="padding-top: 3pt;padding-left: 21pt;text-indent: 0pt;text-align: left;">async-ready looping 148</p><p style="padding-top: 3pt;padding-left: 21pt;text-indent: 0pt;text-align: left;">issues 146-148</p><p style="padding-top: 3pt;padding-left: 21pt;text-indent: 0pt;text-align: left;">reference link 43</p><p style="padding-top: 3pt;padding-left: 21pt;text-indent: 0pt;text-align: left;">working with 145, 146</p><p class="s10" style="padding-top: 3pt;padding-left: 13pt;text-indent: 0pt;text-align: left;">async-ready looping 148</p><p style="padding-top: 3pt;padding-left: 21pt;text-indent: 0pt;text-align: left;">over async calls 148, 149</p><p class="s10" style="padding-top: 3pt;padding-left: 13pt;text-indent: 0pt;text-align: left;">attribute</p><p style="padding-top: 3pt;padding-left: 21pt;text-indent: 0pt;text-align: left;">extracting, from object 210, 211</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s350" style="padding-left: 13pt;text-indent: 0pt;text-align: left;"><a name="bookmark562">B</a></p><p class="s10" style="padding-top: 9pt;padding-left: 13pt;text-indent: 0pt;line-height: 136%;text-align: left;"><span>backend worker 159,160<br/>behavioral design patterns 410<br/>beta reduction 75</span></p><p class="s10" style="padding-left: 13pt;text-indent: 0pt;line-height: 137%;text-align: left;"><span>binary 113<br/>bind()</span></p><p style="padding-left: 21pt;text-indent: 0pt;text-align: left;">currying with 232</p><p style="padding-top: 3pt;padding-left: 21pt;text-indent: 0pt;line-height: 137%;text-align: left;"><span>partial currying with 249-251<br/>reference link 56</span></p><p class="s10" style="padding-left: 13pt;text-indent: 0pt;line-height: 10pt;text-align: left;">black-box testing 103</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s350" style="padding-left: 12pt;text-indent: 0pt;text-align: left;"><a name="bookmark563">c</a><a name="bookmark564">&zwnj;</a></p><p class="s10" style="padding-top: 9pt;padding-left: 13pt;text-indent: 0pt;line-height: 135%;text-align: left;"><a name="bookmark565"><span>callback function 10, 60<br/>call() method</span></a></p><p style="padding-left: 20pt;text-indent: 0pt;text-align: left;">reference link 15</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">580  Index</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 38pt;text-indent: 0pt;line-height: 134%;text-align: left;"><span>catamorphisms 112<br/>chained functions</span></p><p style="text-indent: 0pt;text-align: right;">testing 305</p><p class="s10" style="padding-top: 3pt;text-indent: 0pt;text-align: right;">chaining 261</p><p style="padding-top: 3pt;padding-left: 46pt;text-indent: 0pt;text-align: left;">and fluent interfaces 279</p><p class="s10" style="padding-top: 3pt;padding-left: 38pt;text-indent: 0pt;line-height: 137%;text-align: left;"><span>Chain of Responsibility pattern 437<br/>class patterns 411</span></p><p class="s10" style="padding-left: 38pt;text-indent: 0pt;line-height: 10pt;text-align: left;">closures 12</p><p style="padding-top: 3pt;padding-left: 46pt;text-indent: 0pt;text-align: left;">partial currying with 252, 253</p><p class="s10" style="padding-top: 3pt;padding-left: 39pt;text-indent: 0pt;text-align: left;">CodePen</p><p style="padding-top: 3pt;text-indent: 0pt;text-align: right;">reference link 19</p><p class="s10" style="padding-top: 3pt;text-indent: 0pt;text-align: right;">cohesiveness 411</p><p class="s10" style="padding-top: 3pt;padding-left: 39pt;text-indent: 0pt;text-align: left;">Command pattern 420-422</p><p class="s10" style="padding-top: 3pt;padding-left: 38pt;text-indent: 0pt;line-height: 135%;text-align: left;"><span>complex memoization 185-189<br/>composed functions</span></p><p style="padding-left: 46pt;text-indent: 0pt;line-height: 10pt;text-align: left;">testing 304</p><p class="s10" style="padding-top: 3pt;padding-left: 91pt;text-indent: 0pt;text-align: center;">composing 261, 284, 285</p><p style="padding-top: 3pt;padding-left: 91pt;text-indent: 0pt;text-align: center;">data typing 293, 294</p><p style="padding-top: 3pt;padding-left: 46pt;text-indent: 0pt;text-align: left;">examples 285</p><p style="padding-top: 3pt;padding-left: 46pt;text-indent: 0pt;text-align: left;">with higher-order functions 289-292</p><p class="s10" style="padding-top: 3pt;text-indent: 0pt;text-align: right;">composing examples</p><p style="padding-top: 3pt;text-indent: 0pt;text-align: right;">files, counting 286</p><p style="padding-top: 3pt;text-indent: 0pt;text-align: right;">unary operators 285</p><p style="padding-top: 3pt;padding-left: 38pt;text-indent: 7pt;line-height: 136%;text-align: left;"><span>unique words, finding 287-289<br/></span><b>concurrency patterns 411</b></p><p style="padding-left: 46pt;text-indent: 0pt;line-height: 10pt;text-align: left;">testing 301</p><p class="s10" style="padding-top: 3pt;padding-left: 38pt;text-indent: 0pt;text-align: left;">console.time() 182</p><p class="s10" style="padding-top: 3pt;padding-left: 38pt;text-indent: 0pt;text-align: left;">console.timeEnd() 182</p><p class="s10" style="padding-top: 3pt;padding-left: 38pt;text-indent: 0pt;line-height: 137%;text-align: left;"><span>constant folding 74<br/>containers</span></p><p style="padding-left: 46pt;text-indent: 0pt;line-height: 135%;text-align: left;"><span>building 449, 450<br/>using, with functors 452</span></p><p style="padding-left: 46pt;text-indent: 0pt;text-align: left;">value, wrapping 453, 454</p><p class="s10" style="padding-top: 3pt;padding-left: 60pt;text-indent: -21pt;line-height: 125%;text-align: left;"><span>continuation-passing style<br/>(CPS) 61,62,348,351-355</span></p><p class="s10" style="padding-top: 2pt;padding-left: 38pt;text-indent: 0pt;text-align: left;">continuations 351</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 39pt;text-indent: 0pt;text-align: left;">core-js package</p><p style="padding-top: 3pt;padding-left: 47pt;text-indent: 0pt;text-align: left;">reference link 65</p><p class="s10" style="padding-top: 3pt;padding-left: 39pt;text-indent: 0pt;text-align: left;">coupling 411</p><p class="s10" style="padding-top: 3pt;padding-left: 39pt;text-indent: 0pt;line-height: 134%;text-align: left;"><span>creational design patterns 411<br/>current data types</span></p><p style="padding-left: 47pt;text-indent: 0pt;text-align: left;">extending 450-452</p><p class="s10" style="padding-top: 3pt;padding-left: 39pt;text-indent: 0pt;text-align: left;">currying 49, 50, 225, 226</p><p style="padding-top: 3pt;padding-left: 47pt;text-indent: 0pt;line-height: 135%;text-align: left;"><span>dealing, with multiple parameters 227-230<br/>function by hand 230-232</span></p><p style="padding-left: 46pt;text-indent: 0pt;line-height: 10pt;text-align: left;">versus uncurrying 228</p><p class="s10" style="padding-top: 3pt;padding-left: 39pt;text-indent: 0pt;line-height: 135%;text-align: left;"><span>currying and partial application 437<br/>currying with bind() 232</span></p><p style="padding-left: 47pt;text-indent: 0pt;line-height: 137%;text-align: left;"><span>plain JavaScript version 232-234<br/>testing 235</span></p><p style="padding-left: 47pt;text-indent: 0pt;line-height: 10pt;text-align: left;">TypeScript version 234, 235</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s350" style="padding-left: 38pt;text-indent: 0pt;text-align: left;"><a name="bookmark566">D</a></p><p class="s10" style="padding-top: 9pt;padding-left: 39pt;text-indent: 0pt;text-align: left;">datatypes 443</p><p style="padding-top: 3pt;padding-left: 47pt;text-indent: 0pt;text-align: left;">options 447-449</p><p style="padding-top: 3pt;padding-left: 47pt;text-indent: 0pt;line-height: 134%;text-align: left;"><span>signatures, for functions 444-447<br/>specifying 443, 444</span></p><p class="s10" style="padding-left: 39pt;text-indent: 0pt;text-align: left;">Date.now() 182</p><p class="s10" style="padding-top: 3pt;padding-left: 39pt;text-indent: 0pt;text-align: left;">debouncing functions 202, 203</p><p class="s10" style="padding-top: 3pt;padding-left: 39pt;text-indent: 0pt;text-align: left;">declarative functions 437</p><p class="s10" style="padding-top: 3pt;padding-left: 39pt;text-indent: 0pt;line-height: 135%;text-align: left;"><span>Decorator pattern 169,170 416-419<br/>decrease and conquer methods 315</span></p><p style="padding-left: 60pt;text-indent: -13pt;line-height: 123%;text-align: left;"><span>powers of numbers, calculating<br/>with 317, 318</span></p><p style="padding-top: 2pt;padding-left: 47pt;text-indent: 0pt;text-align: left;">used, for searching element 315-317</p><p class="s10" style="padding-top: 3pt;padding-left: 39pt;text-indent: 0pt;text-align: left;">Dependency Injection 422,423</p><p style="padding-top: 3pt;padding-left: 47pt;text-indent: 0pt;text-align: left;">services, implementing 424, 425</p><p style="padding-top: 3pt;padding-left: 47pt;text-indent: 0pt;text-align: left;">services, testing 425</p><p class="s10" style="padding-top: 3pt;padding-left: 39pt;text-indent: 0pt;text-align: left;">design patterns 409</p><p style="padding-top: 3pt;padding-left: 47pt;text-indent: 0pt;text-align: left;">categories 410</p><p style="padding-top: 3pt;padding-left: 47pt;text-indent: 0pt;text-align: left;">consequences 410</p><p style="padding-top: 3pt;padding-left: 47pt;text-indent: 0pt;text-align: left;">context 410</p><p style="padding-top: 3pt;padding-left: 47pt;text-indent: 0pt;text-align: left;">name 410</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 403pt;text-indent: 0pt;text-align: left;">Index  581</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 37pt;text-indent: 0pt;text-align: left;">need for 412</p><p style="padding-top: 3pt;padding-left: 37pt;text-indent: 0pt;text-align: left;">solution 410</p><p class="s10" style="padding-top: 3pt;text-indent: 0pt;text-align: right;">design patterns categories</p><p style="padding-top: 3pt;text-indent: 0pt;text-align: right;">architectural patterns 411</p><p style="padding-top: 3pt;padding-left: 37pt;text-indent: 0pt;line-height: 136%;text-align: left;"><span>concurrency patterns 411<br/>creational design patterns 411<br/>structural design patterns 411</span></p><p class="s10" style="padding-left: 30pt;text-indent: 0pt;line-height: 10pt;text-align: left;">dispatch table 52</p><p class="s10" style="padding-top: 3pt;padding-left: 37pt;text-indent: -7pt;line-height: 136%;text-align: left;"><span>divide and conquer methods 315<br/></span><span class="p">applying, to Tower of Hanoi 318-320<br/>using, with sorting 321, 322</span></p><p class="s10" style="padding-left: 30pt;text-indent: 0pt;line-height: 134%;text-align: left;"><span>Don’t Repeat Yourself (DRY) 31<br/>dyadic function 113</span></p><p class="s10" style="padding-left: 30pt;text-indent: 0pt;text-align: left;">dynamic programming 315,323-325</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s350" style="padding-left: 29pt;text-indent: 0pt;text-align: left;"><a name="bookmark567">E</a></p><p class="s10" style="padding-top: 8pt;padding-left: 30pt;text-indent: 0pt;line-height: 137%;text-align: left;"><span>e-commerce-related problem example 25, 26<br/>e-commerce-related problem</span></p><p class="s10" style="padding-left: 50pt;text-indent: 0pt;line-height: 9pt;text-align: left;">example, solutions 26, 27</p><p style="padding-top: 4pt;padding-left: 37pt;text-indent: 0pt;line-height: 134%;text-align: left;"><span>better solution, providing 37-39<br/>button, disabling 29</span></p><p style="padding-left: 37pt;text-indent: 0pt;line-height: 135%;text-align: left;"><span>functional solution 31<br/>global flag, using 27<br/>handler, modifying 29</span></p><p style="padding-left: 37pt;text-indent: 0pt;text-align: left;">handler, redefining 30</p><p style="padding-top: 3pt;padding-left: 37pt;text-indent: 0pt;text-align: left;">handler, removing 28, 29</p><p style="padding-top: 3pt;padding-left: 37pt;text-indent: 0pt;line-height: 137%;text-align: left;"><span>higher-order solution 32-34<br/>local flag, using 30,31</span></p><p style="padding-left: 37pt;text-indent: 0pt;line-height: 132%;text-align: left;"><span>solution, testing automatically 35-37<br/>solution, testing manually 35</span></p><p class="s10" style="padding-left: 29pt;text-indent: 0pt;line-height: 135%;text-align: left;"><span>eight queens puzzle 333-337<br/>Either monad</span></p><p style="padding-left: 37pt;text-indent: 0pt;line-height: 10pt;text-align: left;">alternatives, handling with 471-474</p><p class="s10" style="padding-top: 3pt;padding-left: 30pt;text-indent: 0pt;text-align: left;"><a name="bookmark568">Elm</a></p><p style="padding-top: 3pt;padding-left: 37pt;text-indent: 0pt;text-align: left;">URL 443</p><p class="s10" style="padding-top: 3pt;padding-left: 30pt;text-indent: 0pt;text-align: left;">eta abstraction 54</p><p class="s10" style="padding-top: 3pt;padding-left: 30pt;text-indent: 0pt;text-align: left;">eta conversion 54</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 30pt;text-indent: 0pt;text-align: left;">etareduction 54</p><p class="s10" style="padding-top: 3pt;padding-left: 50pt;text-indent: -20pt;line-height: 125%;text-align: left;"><span>European Computer Manufacturers<br/>Association (ECMA) 9</span></p><p style="padding-top: 2pt;padding-left: 37pt;text-indent: 0pt;text-align: left;"><a name="bookmark569">reference link 9</a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s350" style="padding-left: 29pt;text-indent: 0pt;text-align: left;"><a name="bookmark570">F</a></p><p class="s10" style="padding-top: 8pt;padding-left: 30pt;text-indent: 0pt;line-height: 137%;text-align: left;"><a name="bookmark571"><span>Facade pattern 413-415<br/>Fibonacci</span></a></p><p style="padding-left: 37pt;text-indent: 0pt;line-height: 10pt;text-align: left;">reference link 85</p><p class="s10" style="padding-top: 3pt;padding-left: 30pt;text-indent: 0pt;text-align: left;">filter ()</p><p style="padding-top: 3pt;padding-left: 37pt;text-indent: 0pt;text-align: left;">emulating, with reduce() 140, 142</p><p style="padding-top: 3pt;padding-left: 37pt;text-indent: 0pt;text-align: left;">example 139, 140</p><p class="s10" style="padding-top: 3pt;padding-left: 30pt;text-indent: 0pt;line-height: 137%;text-align: left;"><span>filtering 325-329<br/>findlndex()</span></p><p style="padding-left: 37pt;text-indent: 0pt;line-height: 10pt;text-align: left;">emulating, with reduceQ 142</p><p class="s10" style="padding-top: 3pt;padding-left: 30pt;text-indent: 0pt;text-align: left;">first-class citizens 10</p><p class="s10" style="padding-top: 3pt;padding-left: 30pt;text-indent: 0pt;text-align: left;">first-class entities 10</p><p class="s10" style="padding-top: 3pt;padding-left: 30pt;text-indent: 0pt;line-height: 137%;text-align: left;"><span>first-class objects 10<br/>flat()</span></p><p style="padding-left: 37pt;text-indent: 0pt;text-align: left;">emulating, with flatMapQ 133-135</p><p class="s10" style="padding-top: 3pt;padding-left: 30pt;text-indent: 0pt;text-align: left;">flatMapO</p><p style="padding-top: 3pt;padding-left: 37pt;text-indent: 0pt;line-height: 137%;text-align: left;"><span>emulating, with flat() 133-135<br/>using 130-133</span></p><p class="s10" style="padding-left: 30pt;text-indent: 0pt;line-height: 10pt;text-align: left;">fluent APIs</p><p style="padding-top: 3pt;padding-left: 37pt;text-indent: 0pt;text-align: left;">example 279, 280</p><p class="s10" style="padding-top: 3pt;padding-left: 30pt;text-indent: 0pt;text-align: left;">folding operations 112</p><p class="s10" style="padding-top: 3pt;padding-left: 30pt;text-indent: 0pt;text-align: left;">foldr 112</p><p class="s10" style="padding-top: 3pt;padding-left: 30pt;text-indent: 0pt;text-align: left;">FP techniques</p><p style="padding-top: 3pt;padding-left: 37pt;text-indent: 0pt;text-align: left;">callback 60</p><p style="padding-top: 3pt;padding-left: 37pt;text-indent: 0pt;line-height: 137%;text-align: left;"><span>continuation passing style (CPS) 61, 62<br/>immediately invoked function</span></p><p style="padding-left: 51pt;text-indent: 0pt;line-height: 9pt;text-align: left;">expression (IIFE) 67-70</p><p style="padding-top: 4pt;padding-left: 37pt;text-indent: 0pt;text-align: left;">injection 56-59</p><p style="padding-top: 3pt;padding-left: 37pt;text-indent: 0pt;text-align: left;">polyfills 62</p><p style="padding-top: 3pt;padding-left: 37pt;text-indent: 0pt;text-align: left;">promises 60</p><p style="padding-top: 3pt;padding-left: 37pt;text-indent: 0pt;text-align: left;">stubbing 66, 67</p><p class="s10" style="padding-top: 3pt;padding-left: 30pt;text-indent: 0pt;text-align: left;">frontend worker 156-159</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">582  Index</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 91pt;text-indent: 0pt;line-height: 130%;text-align: center;"><a name="bookmark572"><span>functional design patterns 437<br/></span></a><span class="p">collections, processing with<br/>filter/map/reduce 438</span></p><p style="padding-top: 1pt;padding-left: 46pt;text-indent: 0pt;line-height: 137%;text-align: left;"><span>lazy evaluation, with thunks 438<br/>persistent data structures, for</span></p><p style="padding-left: 60pt;text-indent: 0pt;line-height: 9pt;text-align: left;">immutability 439</p><p style="padding-top: 5pt;padding-left: 60pt;text-indent: -13pt;line-height: 123%;text-align: left;"><span>wrapped values, for checks<br/>and operations 439</span></p><p class="s10" style="padding-top: 2pt;padding-left: 38pt;text-indent: 0pt;text-align: left;">functional programming (FP) 1, 2</p><p style="padding-top: 3pt;padding-left: 46pt;text-indent: 0pt;text-align: left;">characteristics 6</p><p style="padding-top: 3pt;padding-left: 46pt;text-indent: 0pt;text-align: left;">features 3, 4</p><p style="padding-top: 3pt;padding-left: 46pt;text-indent: 0pt;text-align: left;">implementing 2</p><p style="padding-top: 3pt;padding-left: 46pt;text-indent: 0pt;text-align: left;">need for 5</p><p style="padding-top: 3pt;padding-left: 46pt;text-indent: 0pt;text-align: left;">problem solution 4, 5</p><p style="padding-top: 3pt;padding-left: 46pt;text-indent: 0pt;text-align: left;">qualities 5</p><p style="padding-top: 3pt;padding-left: 46pt;text-indent: 0pt;text-align: left;">solutions 6, 7</p><p style="padding-top: 3pt;padding-left: 46pt;text-indent: 0pt;text-align: left;">theory, versus practice 2</p><p class="s10" style="padding-top: 3pt;padding-left: 38pt;text-indent: 0pt;line-height: 137%;text-align: left;"><span>functional reactive programming (FRP) 426<br/>functions 41, 256, 257</span></p><p style="padding-left: 46pt;text-indent: 0pt;line-height: 10pt;text-align: left;">arrow functions 45</p><p style="padding-top: 3pt;padding-left: 46pt;text-indent: 0pt;text-align: left;">as objects 50,51</p><p style="padding-top: 3pt;padding-left: 46pt;text-indent: 0pt;text-align: left;">attribute, extracting from object 210, 211</p><p style="padding-top: 3pt;padding-left: 46pt;text-indent: 0pt;line-height: 135%;text-align: left;"><span>behavior, altering 193-202<br/>defining, in JavaScript 42-45<br/>demethodizing 212-215</span></p><p style="padding-left: 46pt;text-indent: 0pt;text-align: left;">lambdas 42</p><p style="padding-top: 3pt;padding-left: 46pt;text-indent: 0pt;text-align: left;">methodizing 215</p><p style="padding-top: 3pt;padding-left: 46pt;text-indent: 0pt;text-align: left;">modifying 204</p><p style="padding-top: 3pt;padding-left: 46pt;text-indent: 0pt;line-height: 136%;text-align: left;"><span>operations, turning into 205<br/>optimum value, finding 219-221<br/>pure functions 75</span></p><p style="padding-left: 46pt;text-indent: 0pt;line-height: 137%;text-align: left;"><span>purity, checking 95, 96<br/>side effects only 75</span></p><p style="padding-left: 46pt;text-indent: 0pt;line-height: 134%;text-align: left;"><span>turning, into promises 208-210<br/>using, as binary trees 478-486<br/>using, as data structures 476<br/>using, in FP ways 56</span></p><p style="padding-left: 46pt;text-indent: 0pt;text-align: left;">with side effects 75</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 57pt;text-indent: -20pt;line-height: 123%;text-align: left;"><a name="bookmark573"><span>functions, with variable number<br/>of parameters</span></a></p><p style="padding-top: 2pt;padding-left: 43pt;text-indent: 0pt;text-align: left;">working with 254</p><p class="s10" style="padding-top: 3pt;padding-left: 36pt;text-indent: 0pt;text-align: left;">functor 120,455</p><p class="s10" style="padding-top: 3pt;padding-left: 36pt;text-indent: 0pt;line-height: 135%;text-align: left;"><span>functorial map (fmap()) 455<br/>functors</span></p><p style="padding-left: 43pt;text-indent: 0pt;line-height: 137%;text-align: left;"><span>containers, using with 452<br/>enhancing 455, 456</span></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: left;">versus promises 456</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s350" style="padding-left: 34pt;text-indent: 0pt;text-align: left;"><a name="bookmark574">G</a><a name="bookmark575">&zwnj;</a></p><p class="s10" style="padding-top: 8pt;padding-left: 36pt;text-indent: 0pt;line-height: 137%;text-align: left;"><a name="bookmark576"><span>Gang of Four (GOF) 409<br/>generator functions 43</span></a></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: left;"><a name="bookmark577">reference link 43</a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s350" style="padding-left: 35pt;text-indent: 0pt;text-align: left;"><a name="bookmark578">H</a></p><p class="s10" style="padding-top: 8pt;padding-left: 36pt;text-indent: 0pt;line-height: 137%;text-align: left;"><a name="bookmark579"><span>handier implementation 207, 208<br/>Haskell</span></a></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: left;">binary trees 477, 478</p><p class="s10" style="padding-top: 3pt;padding-left: 35pt;text-indent: 0pt;text-align: left;">high cohesion 6</p><p class="s10" style="padding-top: 3pt;padding-left: 35pt;text-indent: 0pt;text-align: left;">higher-order functions (HOFs) 137,169, 325</p><p style="padding-top: 3pt;padding-left: 43pt;text-indent: 0pt;text-align: left;">array, filtering 137, 138</p><p style="padding-top: 3pt;padding-left: 43pt;text-indent: 0pt;text-align: left;">array, searching 140, 141</p><p style="padding-top: 3pt;padding-left: 43pt;text-indent: 0pt;line-height: 135%;text-align: left;"><span>every() function 143<br/>find () function 330-332<br/>none() function 144</span></p><p style="padding-left: 43pt;text-indent: 0pt;text-align: left;">reduce function 329</p><p style="padding-top: 3pt;padding-left: 43pt;text-indent: 0pt;text-align: left;">some() function 143</p><p class="s10" style="padding-top: 3pt;padding-left: 36pt;text-indent: 0pt;text-align: left;">Hindley-Milner (HM) 444</p><p class="s10" style="padding-top: 3pt;padding-left: 35pt;text-indent: 0pt;text-align: left;">hoisting 43</p><p style="padding-top: 4pt;padding-left: 43pt;text-indent: 0pt;text-align: left;">reference link 43</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 36pt;text-indent: 0pt;text-align: left;">idempotency 74</p><p class="s10" style="padding-top: 3pt;padding-left: 36pt;text-indent: 0pt;text-align: left;">identity combinator 353</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 403pt;text-indent: 0pt;text-align: left;">Index  583</p><p style="text-indent: 0pt;text-align: left;"><br/></p><table style="border-collapse:collapse;margin-left:25.68pt" cellspacing="0"><tr style="height:152pt"><td style="width:186pt"><p class="s188" style="padding-left: 25pt;padding-right: 24pt;text-indent: -21pt;line-height: 123%;text-align: left;"><span>immediately invoked function expression<br/>(IIFE) 30,63,67-70,414</span></p><p class="s188" style="padding-top: 2pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">impure functions 88</p><p class="s29" style="padding-top: 3pt;padding-left: 11pt;text-indent: 0pt;text-align: left;">avoiding 89</p><p class="s29" style="padding-top: 3pt;padding-left: 11pt;text-indent: 0pt;text-align: left;">injecting 91-95</p><p class="s29" style="padding-top: 3pt;padding-left: 11pt;text-indent: 0pt;text-align: left;">testing 103-107</p><p class="s29" style="padding-top: 3pt;padding-left: 11pt;text-indent: 0pt;text-align: left;">usage of state, avoiding 89-91</p><p class="s188" style="padding-top: 3pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">information hiding 6</p><p class="s188" style="padding-top: 3pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">injection 56-59</p><p class="s188" style="padding-top: 3pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">invert() function 199, 200</p></td><td style="width:174pt"><p class="s188" style="padding-left: 24pt;padding-right: 113pt;text-indent: 0pt;line-height: 10pt;text-align: center;">JSFiddle</p><p class="s29" style="padding-top: 3pt;padding-left: 24pt;padding-right: 71pt;text-indent: 0pt;text-align: center;">reference link 19</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s188" style="padding-left: 22pt;padding-right: 113pt;text-indent: 0pt;text-align: center;">lambdas</p><p class="s29" style="padding-top: 3pt;padding-left: 24pt;padding-right: 71pt;text-indent: 0pt;text-align: center;">and functions 42</p><p class="s188" style="padding-top: 3pt;padding-left: 24pt;padding-right: 74pt;text-indent: 0pt;text-align: center;">lazy evaluation 356</p><p class="s188" style="padding-top: 3pt;padding-left: 24pt;text-indent: 0pt;text-align: left;">leaf 477</p><p class="s188" style="padding-top: 3pt;padding-left: 24pt;text-indent: 0pt;text-align: left;">lenses 380</p><p class="s29" style="padding-top: 3pt;padding-left: 32pt;text-indent: 0pt;text-align: left;">implementing, with functions 388-392</p></td></tr><tr style="height:28pt"><td style="width:186pt"><p class="s351" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">J</p></td><td style="width:174pt"><p class="s29" style="padding-top: 1pt;padding-left: 32pt;text-indent: 0pt;text-align: left;">implementing, with objects 383-388</p><p class="s29" style="padding-top: 3pt;padding-left: 32pt;text-indent: 0pt;text-align: left;">working with 380-383</p></td></tr><tr style="height:349pt"><td style="width:186pt"><p class="s188" style="padding-top: 1pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">JavaScript (JS) 1, 7</p><p class="s29" style="padding-top: 3pt;padding-left: 11pt;text-indent: 0pt;text-align: left;">arrow functions 12-14</p><p class="s29" style="padding-top: 3pt;padding-left: 11pt;text-indent: 0pt;text-align: left;">closure 12</p><p class="s29" style="padding-top: 3pt;padding-left: 11pt;padding-right: 50pt;text-indent: 0pt;line-height: 136%;text-align: left;"><span>functional language 8, 9<br/>functions as first-class objects 10<br/>key features 9</span></p><p class="s29" style="padding-left: 11pt;padding-right: 69pt;text-indent: 0pt;line-height: 135%;text-align: left;"><span>online tools, working with 19<br/>recursion 11</span></p><p class="s29" style="padding-left: 11pt;text-indent: 0pt;line-height: 10pt;text-align: left;">spread operator 14, 15</p><p class="s29" style="padding-top: 3pt;padding-left: 11pt;text-indent: 0pt;text-align: left;">testing 22</p><p class="s29" style="padding-top: 3pt;padding-left: 11pt;text-indent: 0pt;text-align: left;">tool 7, 8</p><p class="s29" style="padding-top: 3pt;padding-left: 11pt;text-indent: 0pt;text-align: left;">transpilers, using 17, 18</p><p class="s29" style="padding-top: 3pt;padding-left: 11pt;text-indent: 0pt;text-align: left;">working with 15-17</p><p class="s188" style="padding-top: 3pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">JavaScript techniques 366</p><p class="s29" style="padding-top: 3pt;padding-left: 11pt;text-indent: 0pt;text-align: left;">constants 367, 368</p><p class="s29" style="padding-top: 3pt;padding-left: 11pt;text-indent: 0pt;text-align: left;">freezing 368-371</p><p class="s29" style="padding-top: 3pt;padding-left: 11pt;text-indent: 0pt;text-align: left;">getters, using 375</p><p class="s29" style="padding-top: 3pt;padding-left: 11pt;text-indent: 0pt;text-align: left;">mutator functions 366, 367</p><p class="s29" style="padding-top: 3pt;padding-left: 11pt;text-indent: 0pt;text-align: left;">object, mutating 371-375</p><p class="s29" style="padding-top: 3pt;padding-left: 11pt;padding-right: 37pt;text-indent: 0pt;line-height: 134%;text-align: left;"><span>property, getting 375-377<br/>property, setting by path 377-380<br/>setters, using 375</span></p><p class="s188" style="padding-left: 4pt;padding-right: 159pt;text-indent: 0pt;line-height: 134%;text-align: left;"><span>Jest 35<br/>JSBin</span></p><p class="s29" style="padding-left: 11pt;text-indent: 0pt;line-height: 9pt;text-align: left;">reference link 19</p></td><td style="width:174pt"><p class="s188" style="padding-top: 1pt;padding-left: 24pt;text-indent: 0pt;text-align: left;">localeCompare() possibilities</p><p class="s29" style="padding-top: 3pt;padding-left: 32pt;text-indent: 0pt;text-align: left;">reference link 59</p><p class="s188" style="padding-top: 3pt;padding-left: 24pt;text-indent: 0pt;text-align: left;">logging 170, 171</p><p class="s29" style="padding-top: 3pt;padding-left: 32pt;text-indent: 0pt;text-align: left;">exceptions, throwing 174,175</p><p class="s29" style="padding-top: 3pt;padding-left: 32pt;padding-right: 11pt;text-indent: 0pt;line-height: 137%;text-align: left;"><span>functions, testing 175-180<br/>in functional way 171-174</span></p><p class="s188" style="padding-left: 24pt;text-indent: 0pt;line-height: 10pt;text-align: left;">logging wrapper</p><p class="s29" style="padding-top: 3pt;padding-left: 32pt;text-indent: 0pt;text-align: left;">using 276</p><p class="s188" style="padding-top: 3pt;padding-left: 24pt;text-indent: 0pt;text-align: left;">looping</p><p class="s29" style="padding-top: 3pt;padding-left: 32pt;text-indent: 0pt;text-align: left;">general way 135-137</p><p class="s188" style="padding-top: 3pt;padding-left: 24pt;text-indent: 0pt;text-align: left;">low coupling 6</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s351" style="padding-left: 24pt;text-indent: 0pt;text-align: left;">M</p><p class="s188" style="padding-top: 9pt;padding-left: 25pt;text-indent: 0pt;text-align: left;">map() function 120,121</p><p class="s29" style="padding-top: 3pt;padding-left: 32pt;text-indent: 0pt;text-align: left;">advantages 121</p><p class="s29" style="padding-top: 3pt;padding-left: 32pt;padding-right: 11pt;text-indent: 0pt;line-height: 134%;text-align: left;"><span>arrays of arrays, dealing with 127<br/>caveats 121</span></p><p class="s29" style="padding-left: 32pt;text-indent: 0pt;text-align: left;">data, extracting from objects 121, 122</p><p class="s29" style="padding-top: 3pt;padding-left: 32pt;text-indent: 0pt;text-align: left;">emulating, with reduce() 125, 126</p><p class="s29" style="padding-top: 3pt;padding-left: 32pt;text-indent: 0pt;text-align: left;">numbers, parsing 123</p><p class="s29" style="padding-top: 3pt;padding-left: 32pt;text-indent: 0pt;text-align: left;">ranges, working with 124,125</p><p class="s188" style="padding-top: 3pt;padding-left: 25pt;padding-right: 41pt;text-indent: 0pt;line-height: 134%;text-align: left;"><span>mapping 119,325-329<br/>Maybe functor</span></p><p class="s29" style="padding-left: 32pt;text-indent: 0pt;line-height: 9pt;text-align: left;">missing values, dealing with 456-459</p></td></tr></table><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">584  Index</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 38pt;text-indent: 0pt;text-align: left;"><a name="bookmark580">memoization 12, 84,182, 323</a></p><p style="padding-top: 3pt;padding-left: 46pt;text-indent: 0pt;text-align: left;">testing 189-191</p><p class="s10" style="padding-top: 3pt;padding-left: 38pt;text-indent: 0pt;line-height: 137%;text-align: left;"><span>memoized function 182<br/>method calls</span></p><p style="padding-left: 46pt;text-indent: 0pt;line-height: 10pt;text-align: left;">chaining 281-284</p><p class="s10" style="padding-top: 3pt;padding-left: 38pt;text-indent: 0pt;text-align: left;">methods</p><p style="padding-top: 3pt;padding-left: 46pt;text-indent: 0pt;text-align: left;">working with 55, 56</p><p class="s10" style="padding-top: 3pt;padding-left: 38pt;text-indent: 0pt;text-align: left;">modularity 6</p><p class="s10" style="padding-top: 3pt;padding-left: 38pt;text-indent: 0pt;line-height: 137%;text-align: left;"><span>module pattern 12,44<br/>monads</span></p><p style="padding-left: 46pt;text-indent: 0pt;line-height: 10pt;text-align: left;">implementing 467</p><p style="padding-top: 3pt;padding-left: 46pt;text-indent: 0pt;text-align: left;">operations, adding 467-471</p><p class="s10" style="padding-top: 3pt;padding-left: 38pt;text-indent: 0pt;line-height: 137%;text-align: left;"><span>morphism 120<br/>multi-clicks</span></p><p style="padding-left: 87pt;text-indent: 0pt;line-height: 10pt;text-align: center;">detecting 430-432</p><p class="s10" style="padding-top: 3pt;padding-left: 85pt;text-indent: 0pt;text-align: center;">multiple parameters</p><p style="padding-top: 3pt;padding-left: 91pt;text-indent: 0pt;text-align: center;">dealing with 227-230</p><p class="s10" style="padding-top: 3pt;padding-left: 84pt;text-indent: 0pt;text-align: center;">mutator methods 80</p><p class="s10" style="padding-top: 3pt;padding-left: 89pt;text-indent: 0pt;text-align: center;">mutual recursion 341</p><p style="padding-top: 3pt;padding-left: 46pt;text-indent: 0pt;line-height: 135%;text-align: left;"><a name="bookmark581"><span>arithmetic expression 343-347<br/>odds and evens 341-343</span></a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s350" style="padding-left: 38pt;text-indent: 0pt;text-align: left;"><a name="bookmark582">N</a></p><p class="s10" style="padding-top: 9pt;padding-left: 38pt;text-indent: 0pt;text-align: left;">Node.js</p><p style="padding-top: 3pt;padding-left: 46pt;text-indent: 0pt;text-align: left;">reference link 15</p><p class="s10" style="padding-top: 3pt;padding-left: 38pt;text-indent: 0pt;text-align: left;">npm tool 18</p><p class="s10" style="padding-top: 3pt;padding-left: 38pt;text-indent: 0pt;text-align: left;">n queens variation 333</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s350" style="padding-top: 5pt;padding-left: 37pt;text-indent: 0pt;text-align: left;"><a name="bookmark583">o</a><a name="bookmark584">&zwnj;</a></p><p class="s10" style="padding-top: 8pt;padding-left: 30pt;text-indent: 0pt;text-align: center;">object</p><p style="padding-top: 3pt;padding-left: 91pt;text-indent: 0pt;text-align: center;">extracting, from attribute 210,211</p><p class="s10" style="padding-top: 3pt;padding-left: 91pt;text-indent: 0pt;text-align: center;">object-oriented design patterns 412</p><p style="padding-top: 3pt;padding-left: 46pt;text-indent: 0pt;text-align: left;">Adapter pattern 412-415</p><p style="padding-top: 3pt;padding-left: 46pt;text-indent: 0pt;text-align: left;">Command pattern 412, 422</p><p style="padding-top: 3pt;padding-left: 46pt;text-indent: 0pt;text-align: left;">Decorator pattern 412,416-420</p><p style="padding-top: 3pt;padding-left: 46pt;text-indent: 0pt;text-align: left;">Dependency Injection 412,422-425</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 45pt;text-indent: 0pt;text-align: left;">Facade pattern 412-415</p><p style="padding-top: 3pt;padding-left: 46pt;text-indent: 0pt;text-align: left;">Observer 413</p><p style="padding-top: 3pt;padding-left: 45pt;text-indent: 0pt;text-align: left;">Strategy pattern 412, 420</p><p style="padding-top: 3pt;padding-left: 45pt;text-indent: 0pt;text-align: left;">Template pattern 412, 422</p><p class="s10" style="padding-top: 3pt;padding-left: 38pt;text-indent: 0pt;line-height: 135%;text-align: left;"><span>object-oriented programming (OOP) 2<br/>object patterns 411</span></p><p class="s10" style="padding-left: 38pt;text-indent: 0pt;text-align: left;">observables 426 427</p><p style="padding-top: 3pt;padding-left: 45pt;text-indent: 0pt;line-height: 137%;text-align: left;"><span>creating, with operators 427-430<br/>versus promises 427</span></p><p class="s10" style="padding-left: 38pt;text-indent: 0pt;line-height: 10pt;text-align: left;">Observer pattern 425,426</p><p class="s10" style="padding-top: 3pt;padding-left: 38pt;text-indent: 0pt;line-height: 135%;text-align: left;"><span>once() 193<br/>operations</span></p><p style="padding-left: 45pt;text-indent: 0pt;line-height: 137%;text-align: left;"><span>implementing 205-207<br/>turning, into functions 205</span></p><p class="s10" style="padding-left: 38pt;text-indent: 0pt;line-height: 134%;text-align: left;"><span>operators 427<br/>optimum value</span></p><p style="padding-left: 45pt;text-indent: 0pt;text-align: left;">finding 219-221</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s350" style="padding-left: 37pt;text-indent: 0pt;text-align: left;"><a name="bookmark585">P</a><a name="bookmark586">&zwnj;</a></p><p class="s10" style="padding-top: 8pt;padding-left: 38pt;text-indent: 0pt;text-align: left;">parallel functions</p><p style="padding-top: 3pt;padding-left: 45pt;text-indent: 0pt;text-align: left;">backend worker 159,160</p><p style="padding-top: 3pt;padding-left: 45pt;text-indent: 0pt;text-align: left;">frontend worker 156-159</p><p style="padding-top: 3pt;padding-left: 45pt;text-indent: 0pt;line-height: 137%;text-align: left;"><span>long-living pooled workers 162-165<br/>unresponsive pages 153-155</span></p><p style="padding-left: 45pt;text-indent: 0pt;line-height: 10pt;text-align: left;">workers 160, 161</p><p style="padding-top: 3pt;padding-left: 45pt;text-indent: 0pt;text-align: left;">working with 153</p><p class="s10" style="padding-top: 3pt;padding-left: 38pt;text-indent: 0pt;text-align: left;">parameter order 254-256</p><p class="s10" style="padding-top: 3pt;padding-left: 38pt;text-indent: 0pt;text-align: left;">parameters 42</p><p class="s10" style="padding-top: 3pt;padding-left: 38pt;text-indent: 0pt;text-align: left;">partial application 225, 226, 236, 237</p><p style="padding-top: 3pt;padding-left: 45pt;text-indent: 0pt;text-align: left;">with arrow functions 237, 238</p><p class="s10" style="padding-top: 3pt;padding-left: 38pt;text-indent: 0pt;text-align: left;">partial application with closures 238-240</p><p style="padding-top: 3pt;padding-left: 45pt;text-indent: 0pt;line-height: 134%;text-align: left;"><span>partial data types 241-245<br/>partial testing 245</span></p><p class="s10" style="padding-left: 38pt;text-indent: 0pt;text-align: left;">partial currying 225, 226, 247-249</p><p style="padding-top: 3pt;padding-left: 45pt;text-indent: 0pt;text-align: left;">withbindQ 249-251</p><p style="padding-top: 3pt;padding-left: 45pt;text-indent: 0pt;text-align: left;">with closures 252, 253</p><p class="s10" style="padding-top: 3pt;padding-left: 38pt;text-indent: 0pt;text-align: left;">performance.now() 182</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 403pt;text-indent: 0pt;text-align: left;">Index  585</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 29pt;text-indent: 0pt;text-align: left;">persistent data structures 437</p><p style="padding-top: 3pt;padding-left: 37pt;text-indent: 0pt;text-align: left;">caveat 404</p><p style="padding-top: 3pt;padding-left: 37pt;text-indent: 0pt;text-align: left;">creating 396</p><p style="padding-top: 3pt;padding-left: 37pt;text-indent: 0pt;text-align: left;">lists, working with 396, 397</p><p style="padding-top: 3pt;padding-left: 37pt;text-indent: 0pt;text-align: left;">objects, updating 398-404</p><p style="padding-top: 3pt;padding-left: 37pt;text-indent: 0pt;text-align: left;">parameters, ordering 401</p><p class="s10" style="padding-top: 3pt;padding-left: 29pt;text-indent: 0pt;text-align: left;">pipe 427</p><p class="s10" style="padding-top: 3pt;padding-left: 29pt;text-indent: 0pt;text-align: left;">pipelined functions</p><p style="padding-top: 3pt;padding-left: 37pt;text-indent: 0pt;text-align: left;">testing 301, 302</p><p class="s10" style="padding-top: 3pt;padding-left: 29pt;text-indent: 0pt;text-align: left;">pipelines</p><p style="padding-top: 3pt;padding-left: 37pt;text-indent: 0pt;line-height: 137%;text-align: left;"><span>building, by hand 265-267<br/>constructs, using 267-270</span></p><p style="padding-left: 37pt;text-indent: 0pt;line-height: 10pt;text-align: left;">creating 265</p><p style="padding-top: 3pt;padding-left: 37pt;text-indent: 0pt;text-align: left;">debugging 273</p><p class="s10" style="padding-top: 3pt;padding-left: 37pt;text-indent: -7pt;line-height: 136%;text-align: left;"><span>pipelines, debugging 273<br/></span><span class="p">logging wrapper, using 276<br/>tapping, into flow 275</span></p><p style="padding-left: 37pt;text-indent: 0pt;text-align: left;">tee, using 273, 274</p><p class="s10" style="padding-top: 3pt;text-indent: 0pt;text-align: right;">pipelining 261-263</p><p style="padding-top: 3pt;text-indent: 0pt;text-align: right;">example 263-265</p><p class="s10" style="padding-top: 3pt;padding-left: 29pt;text-indent: 0pt;text-align: left;">pipelining functions</p><p style="padding-top: 3pt;padding-left: 37pt;text-indent: 0pt;text-align: left;">typing 270-273</p><p class="s10" style="padding-top: 3pt;padding-left: 29pt;text-indent: 0pt;text-align: left;">piping</p><p style="padding-top: 3pt;padding-left: 37pt;text-indent: 0pt;text-align: left;">in Unix/Linux 262, 263</p><p class="s10" style="padding-top: 3pt;padding-left: 29pt;text-indent: 0pt;line-height: 134%;text-align: left;"><span>pointfree 55<br/>pointfree functions</span></p><p style="padding-left: 37pt;text-indent: 0pt;text-align: left;">defining 276, 277</p><p class="s10" style="padding-top: 3pt;text-indent: 0pt;text-align: right;">pointfree style 261, 276</p><p style="padding-top: 3pt;text-indent: 0pt;text-align: right;">converting to 278, 279</p><p class="s10" style="padding-top: 3pt;padding-left: 29pt;text-indent: 0pt;text-align: left;">polyfills 62</p><p style="padding-top: 3pt;padding-left: 37pt;text-indent: 0pt;text-align: left;">Ajax, detecting 62-64</p><p style="padding-top: 3pt;padding-left: 37pt;text-indent: 0pt;text-align: left;">missing functions, adding 64, 65</p><p class="s10" style="padding-top: 3pt;padding-left: 29pt;text-indent: 0pt;text-align: left;">predicate 137</p><p class="s10" style="padding-top: 3pt;padding-left: 29pt;text-indent: 0pt;text-align: left;">prisms 392</p><p style="padding-top: 3pt;padding-left: 37pt;text-indent: 0pt;text-align: left;">implementing 465, 466</p><p style="padding-top: 3pt;padding-left: 37pt;text-indent: 0pt;text-align: left;">working with 393-395</p><p class="s10" style="padding-top: 3pt;padding-left: 29pt;text-indent: 0pt;text-align: left;">projection 236</p><p class="s10" style="padding-top: 3pt;padding-left: 29pt;text-indent: 0pt;text-align: left;">promiseMemoize() function 193</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 31pt;text-indent: 0pt;text-align: left;">promises 60,476</p><p style="padding-top: 3pt;padding-left: 38pt;text-indent: 0pt;line-height: 135%;text-align: left;"><span>functions, turning into 208-210<br/>memoizing 192, 193</span></p><p style="padding-left: 38pt;text-indent: 0pt;text-align: left;">reference link 60</p><p style="padding-top: 3pt;padding-left: 38pt;text-indent: 0pt;text-align: left;">versus observables 427</p><p class="s10" style="padding-top: 3pt;padding-left: 31pt;text-indent: 0pt;line-height: 137%;text-align: left;"><span>promisifyO function 208<br/>proxy objects</span></p><p style="padding-left: 91pt;text-indent: 0pt;line-height: 10pt;text-align: center;">reference link 281</p><p class="s10" style="padding-top: 3pt;padding-left: 91pt;text-indent: 0pt;text-align: center;">pure functions 73, 74</p><p style="padding-top: 3pt;padding-left: 91pt;text-indent: 0pt;text-align: center;">testing 97-99</p><p class="s10" style="padding-top: 3pt;padding-left: 27pt;text-indent: 0pt;text-align: center;">pure functions, advantages 83</p><p style="padding-top: 3pt;padding-left: 38pt;text-indent: 0pt;line-height: 136%;text-align: left;"><span>memoization 84-88<br/>order of execution 84<br/>self-documentation                 88</span></p><p style="padding-left: 38pt;text-indent: 0pt;line-height: 10pt;text-align: left;">testing 88</p><p class="s10" style="padding-top: 3pt;padding-left: 91pt;text-indent: 0pt;text-align: center;">purified functions</p><p style="padding-top: 3pt;padding-left: 91pt;text-indent: 0pt;text-align: center;">testing 99-103</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s350" style="padding-top: 7pt;padding-left: 29pt;text-indent: 0pt;text-align: left;"><a name="bookmark587">Q</a></p><p class="s10" style="padding-top: 6pt;padding-left: 31pt;text-indent: 0pt;text-align: left;">qualities, functional programming (FP)</p><p style="padding-top: 3pt;padding-left: 38pt;text-indent: 0pt;text-align: left;">extensible 6</p><p style="padding-top: 3pt;padding-left: 38pt;text-indent: 0pt;text-align: left;">modular 5</p><p style="padding-top: 4pt;padding-left: 38pt;text-indent: 0pt;text-align: left;">reusable 6</p><p style="padding-top: 3pt;padding-left: 38pt;text-indent: 0pt;text-align: left;">testable 5</p><p style="padding-top: 3pt;padding-left: 38pt;text-indent: 0pt;text-align: left;"><a name="bookmark588">understandable 5</a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s350" style="padding-left: 30pt;text-indent: 0pt;text-align: left;">R</p><p class="s10" style="padding-top: 8pt;padding-left: 31pt;text-indent: 0pt;text-align: left;">reactive programming 426</p><p class="s10" style="padding-top: 3pt;padding-left: 31pt;text-indent: 0pt;line-height: 134%;text-align: left;"><span>React parlance 420<br/>React-Redux reducer</span></p><p style="padding-left: 38pt;text-indent: 0pt;text-align: left;">working 51-53</p><p class="s10" style="padding-top: 3pt;padding-left: 31pt;text-indent: 0pt;text-align: left;">recursion 11</p><p style="padding-top: 3pt;padding-left: 38pt;text-indent: 0pt;text-align: left;">eliminating 359</p><p style="padding-top: 3pt;padding-left: 38pt;text-indent: 0pt;line-height: 134%;text-align: left;"><span>methods, for solving problems 315<br/>techniques 348</span></p><p style="padding-left: 38pt;text-indent: 0pt;line-height: 135%;text-align: left;"><span>used, for solving issues 314<br/>using 313</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">586  Index</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 38pt;text-indent: 0pt;text-align: left;">recursion techniques 348</p><p style="padding-top: 3pt;padding-left: 46pt;text-indent: 0pt;line-height: 136%;text-align: left;"><span>continuation-passing style 351-356<br/>tail call optimization 348-350<br/>thunks 356</span></p><p style="padding-left: 46pt;text-indent: 0pt;line-height: 10pt;text-align: left;">trampoline 356-359</p><p class="s10" style="padding-top: 3pt;padding-left: 45pt;text-indent: 0pt;text-align: center;">recursive solutions</p><p style="padding-top: 3pt;padding-left: 41pt;text-indent: 0pt;text-align: center;">producing 315</p><p class="s10" style="padding-top: 3pt;padding-left: 6pt;text-indent: 0pt;text-align: center;">reduce()</p><p style="padding-top: 3pt;padding-left: 46pt;text-indent: 0pt;line-height: 137%;text-align: left;"><span>fmd() and findlndexQ, emulating with 142<br/>versus hand-coded loops 113</span></p><p class="s10" style="padding-left: 38pt;text-indent: 0pt;line-height: 10pt;text-align: left;">reduceRight() 118,119</p><p style="padding-top: 3pt;padding-left: 46pt;text-indent: 0pt;text-align: left;">versus hand-coded loops 113</p><p class="s10" style="padding-top: 3pt;padding-left: 38pt;text-indent: 0pt;text-align: left;">reducers</p><p style="padding-top: 3pt;padding-left: 46pt;text-indent: 0pt;text-align: left;">composing 298-300</p><p style="padding-top: 3pt;padding-left: 46pt;text-indent: 0pt;text-align: left;">generalizing 300, 301</p><p class="s10" style="padding-top: 3pt;padding-left: 54pt;text-indent: 0pt;line-height: 136%;text-align: center;"><span>Redux decorator 420<br/>Redux fundamentals<br/></span><span class="p">reference link 51</span></p><p class="s10" style="padding-left: 38pt;text-indent: 0pt;text-align: left;">referential opacity 74</p><p class="s10" style="padding-top: 3pt;padding-left: 38pt;text-indent: 0pt;text-align: left;">referential transparency 74</p><p class="s10" style="padding-top: 3pt;padding-left: 38pt;text-indent: 0pt;text-align: left;">revealing module 415</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s350" style="padding-left: 38pt;text-indent: 0pt;text-align: left;"><a name="bookmark589">s</a></p><p class="s10" style="padding-top: 9pt;padding-left: 39pt;text-indent: 0pt;line-height: 134%;text-align: left;"><span>separation of concerns 6<br/>side effects 76</span></p><p style="padding-left: 46pt;text-indent: 0pt;text-align: left;">argument mutation 80, 81</p><p style="padding-top: 3pt;padding-left: 46pt;text-indent: 0pt;text-align: left;">global state 77, 78</p><p style="padding-top: 3pt;padding-left: 46pt;text-indent: 0pt;text-align: left;">inner state 78, 79</p><p style="padding-top: 3pt;padding-left: 46pt;text-indent: 0pt;line-height: 134%;text-align: left;"><span>troublesome functions 81-83<br/>usual side effects 76</span></p><p class="s10" style="padding-left: 39pt;text-indent: 0pt;line-height: 135%;text-align: left;"><span>simple memoization 183-185<br/>SOLID principle</span></p><p style="padding-left: 46pt;text-indent: 0pt;text-align: left;">reference link 31</p><p class="s10" style="padding-top: 3pt;padding-left: 39pt;text-indent: 0pt;text-align: left;">solutions, to problems</p><p style="padding-top: 3pt;padding-left: 46pt;text-indent: 0pt;text-align: left;">searching 333</p><p class="s10" style="padding-top: 3pt;padding-left: 39pt;text-indent: 0pt;text-align: left;">Sorta Functional Programming (SFP) 2, 412</p><p class="s10" style="padding-top: 3pt;padding-left: 38pt;text-indent: 0pt;text-align: left;">spread operator 14,15</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 34pt;text-indent: 0pt;text-align: left;">standard language specification</p><p style="padding-top: 3pt;padding-left: 42pt;text-indent: 0pt;text-align: left;">reference link 9</p><p class="s10" style="padding-top: 3pt;padding-left: 34pt;text-indent: 0pt;line-height: 137%;text-align: left;"><span>Strategy pattern 420<br/>strings</span></p><p style="padding-left: 42pt;text-indent: 0pt;line-height: 10pt;text-align: left;">reversing 215-218</p><p class="s10" style="padding-top: 3pt;padding-left: 34pt;text-indent: 0pt;line-height: 134%;text-align: left;"><span>structural design patterns 411<br/>stubbing 66, 67</span></p><p class="s10" style="padding-left: 34pt;text-indent: 0pt;text-align: left;">subscription 427</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s350" style="padding-top: 5pt;padding-left: 33pt;text-indent: 0pt;text-align: left;"><a name="bookmark590">T</a></p><p class="s10" style="padding-top: 8pt;padding-left: 34pt;text-indent: 0pt;text-align: left;">tacit style 55</p><p class="s10" style="padding-top: 3pt;padding-left: 34pt;text-indent: 0pt;line-height: 134%;text-align: left;"><span>tail call optimization (TCO) 348-350<br/>tail calls 349</span></p><p class="s10" style="padding-left: 34pt;text-indent: 0pt;text-align: left;">tee Linux command</p><p style="padding-top: 3pt;padding-left: 42pt;text-indent: 0pt;text-align: left;">using 273, 274</p><p class="s10" style="padding-top: 3pt;padding-left: 34pt;text-indent: 0pt;text-align: left;">Template pattern 420,422</p><p class="s10" style="padding-top: 3pt;padding-left: 34pt;text-indent: 0pt;text-align: left;">term 344</p><p class="s10" style="padding-top: 3pt;padding-left: 34pt;text-indent: 0pt;line-height: 137%;text-align: left;"><span>test-driven development (TDD) 22<br/>this value</span></p><p style="padding-left: 42pt;text-indent: 0pt;line-height: 10pt;text-align: left;">handling 46, 47</p><p class="s10" style="padding-top: 3pt;padding-left: 34pt;text-indent: 0pt;text-align: left;">throttling functions 202-204</p><p class="s10" style="padding-top: 3pt;padding-left: 34pt;text-indent: 0pt;text-align: left;">thunk 356</p><p class="s10" style="padding-top: 3pt;padding-left: 34pt;text-indent: 0pt;line-height: 137%;text-align: left;"><span>tokens 345<br/>Tower of Hanoi</span></p><p style="padding-left: 55pt;text-indent: -13pt;line-height: 126%;text-align: left;"><span>divide and conquer methods,<br/>applying to 318-320</span></p><p class="s10" style="padding-top: 1pt;padding-left: 34pt;text-indent: 0pt;line-height: 134%;text-align: left;"><span>trampoline 356-359<br/>transduced functions</span></p><p style="padding-left: 42pt;text-indent: 0pt;text-align: left;">testing 307-309</p><p class="s10" style="padding-top: 3pt;padding-left: 34pt;text-indent: 0pt;text-align: left;">transducing 261, 295-297</p><p class="s10" style="padding-top: 3pt;padding-left: 34pt;text-indent: 0pt;text-align: left;">transformations 112</p><p style="padding-top: 3pt;padding-left: 42pt;text-indent: 0pt;text-align: left;">array, reducing to value 112, 113</p><p style="padding-top: 3pt;padding-left: 42pt;text-indent: 0pt;text-align: left;">array, summing 113-115</p><p style="padding-top: 3pt;padding-left: 42pt;text-indent: 0pt;text-align: left;">average, calculating 115-117</p><p style="padding-top: 3pt;padding-left: 42pt;text-indent: 0pt;text-align: left;">map() function 120,121</p><p style="padding-top: 3pt;padding-left: 42pt;text-indent: 0pt;text-align: left;">reduceRightQ method 118, 119</p><p style="padding-top: 3pt;padding-left: 42pt;text-indent: 0pt;text-align: left;">several values, calculating at once 117, 118</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 403pt;text-indent: 0pt;text-align: left;">Index  587</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-left: 29pt;text-indent: 0pt;text-align: left;">transpilers</p><p style="padding-top: 3pt;text-indent: 0pt;text-align: right;">using 17, 18</p><p class="s10" style="padding-top: 3pt;text-indent: 0pt;text-align: right;">tree structure</p><p style="padding-top: 3pt;padding-left: 37pt;text-indent: 0pt;text-align: left;">traversing 337-341</p><p class="s10" style="padding-top: 3pt;padding-left: 30pt;text-indent: 0pt;text-align: left;">Try monad</p><p style="padding-top: 3pt;padding-left: 37pt;text-indent: 0pt;text-align: left;">function, calling with 474-476</p><p class="s10" style="padding-top: 3pt;text-indent: 0pt;text-align: right;">typeahead searches</p><p style="padding-top: 3pt;text-indent: 0pt;text-align: right;">providing 432-437</p><p class="s10" style="padding-top: 3pt;text-indent: 0pt;text-align: right;">TypeScript 19-21</p><p style="padding-top: 3pt;text-indent: 0pt;text-align: right;"><a name="bookmark591">reference link 19</a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s350" style="padding-left: 29pt;text-indent: 0pt;text-align: left;">u</p><p class="s10" style="padding-top: 8pt;padding-left: 30pt;text-indent: 0pt;text-align: left;">uncurrying</p><p style="padding-top: 3pt;padding-left: 37pt;text-indent: 0pt;text-align: left;">versus currying 228</p><p class="s10" style="padding-top: 3pt;padding-left: 30pt;text-indent: 0pt;text-align: left;">Unix/Linux</p><p style="padding-top: 3pt;padding-left: 37pt;text-indent: 0pt;text-align: left;">piping 262, 263</p><p class="s10" style="padding-top: 3pt;padding-left: 30pt;text-indent: 0pt;text-align: left;">useMemo() 183</p><p class="s10" style="padding-top: 3pt;padding-left: 30pt;text-indent: 0pt;text-align: left;">uses tail call optimization (TCO) 349</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s350" style="padding-left: 28pt;text-indent: 0pt;text-align: left;"><a name="bookmark592">V</a></p><p class="s10" style="padding-top: 9pt;padding-left: 28pt;text-indent: 0pt;text-align: center;">values</p><p style="padding-top: 3pt;padding-left: 17pt;text-indent: 0pt;text-align: center;">returning 45, 46</p><p class="s10" style="padding-top: 3pt;padding-left: 18pt;text-indent: 0pt;text-align: center;">varying API results</p><p style="padding-top: 3pt;padding-left: 28pt;text-indent: 0pt;text-align: center;">dealing with 459-465</p><ol id="l213"><li data-list-text="v-"><p class="s10" style="padding-top: 3pt;padding-left: 7pt;text-indent: -7pt;text-align: center;"><a name="bookmark593">memo 183</a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s350" style="padding-left: 28pt;text-indent: 0pt;text-align: left;">w</p><p class="s10" style="padding-top: 9pt;padding-left: 29pt;text-indent: 0pt;text-align: left;">webpack tool 18</p><p class="s10" style="padding-top: 3pt;padding-left: 29pt;text-indent: 0pt;text-align: left;">Web workers 153</p><p class="s10" style="padding-top: 3pt;padding-left: 29pt;text-indent: 0pt;line-height: 136%;text-align: center;"><span>white-box testing 103<br/>winston logging tool<br/></span><span class="p">reference link 177</span></p><p class="s10" style="padding-left: 29pt;text-indent: 0pt;line-height: 10pt;text-align: left;">worker threads 153</p><p class="s10" style="padding-top: 3pt;padding-left: 29pt;text-indent: 0pt;text-align: left;">wrapped functions 169</p><p class="s10" style="padding-top: 3pt;padding-left: 29pt;text-indent: 0pt;text-align: left;">wrapper object 170</p><p class="s10" style="padding-top: 3pt;padding-left: 29pt;text-indent: 0pt;text-align: left;">Wrapper pattern. <i>See </i>Decorator pattern</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s7" style="padding-top: 12pt;padding-left: 27pt;text-indent: 0pt;text-align: left;">&lt;packt&gt;</p><p style="padding-top: 10pt;padding-left: 28pt;text-indent: 0pt;text-align: left;"><a href="http://www.packtpub.com/" class="s14">www.packtpub.com</a></p><p style="padding-top: 9pt;padding-left: 28pt;text-indent: 0pt;line-height: 124%;text-align: justify;"><span>Subscribe to our online digital library for full access to over 7,000 books and videos, as well as<br/>industry leading tools to help you plan your personal development and advance your career. For more<br/>information, please visit our website.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-left: 28pt;text-indent: 0pt;text-align: justify;"><a name="bookmark594">Why subscribe?</a></p><ul id="l214"><li data-list-text="•"><p class="s33" style="padding-top: 9pt;padding-left: 55pt;text-indent: -12pt;line-height: 115%;text-align: left;">	<span class="p">Spend less time learning and more time coding with practical eBooks and Videos from over<br/>4,000 industry professionals</span></p></li><li data-list-text="•"><p style="padding-top: 5pt;padding-left: 55pt;text-indent: -13pt;text-align: left;">Improve your learning with Skill Plans built especially for you</p></li><li data-list-text="•"><p style="padding-top: 7pt;padding-left: 55pt;text-indent: -13pt;text-align: left;">Get a free eBook or video every month</p></li><li data-list-text="•"><p style="padding-top: 7pt;padding-left: 55pt;text-indent: -13pt;text-align: left;">Fully searchable for easy access to vital information</p></li><li data-list-text="•"><p style="padding-top: 7pt;padding-left: 55pt;text-indent: -13pt;text-align: left;">Copy and paste, print, and bookmark content</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 28pt;text-indent: 0pt;line-height: 114%;text-align: justify;"><span>Did you know that Packt offers eBook versions of every book published, with PDF and ePub files<br/>available? You can upgrade to the eBook version at packtpub. com and as a print book customer, you<br/>are entitled to a discount on the eBook copy. Get in touch with us at </span><span class="s245">customercare@packtpub .</span></p><p class="s17" style="padding-left: 28pt;text-indent: 0pt;line-height: 11pt;text-align: justify;">com <span class="s246">for more details.</span></p><p style="padding-top: 9pt;padding-left: 28pt;text-indent: 0pt;line-height: 125%;text-align: justify;"><a href="http://www/" class="s11" target="_blank">At </a><span>www. packtpub. com, you can also read a collection of free technical articles, sign up for a range<br/>of free newsletters, and receive exclusive discounts and offers on Packt books and eBooks.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-top: 5pt;padding-left: 41pt;text-indent: 0pt;text-align: center;"><a name="bookmark595">Other Books You May Enjoy</a></h2><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 37pt;text-indent: 0pt;text-align: left;">If you enjoyed this book, you may be interested in these other books by Packt:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><h4 style="padding-top: 2pt;padding-left: 1pt;text-indent: 0pt;line-height: 89%;text-align: left;"><span>Clean Code in<br/>JavaScript</span></h4><p style="padding-left: 163pt;text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 153pt;text-indent: 0pt;text-align: left;"><span><img width="217" height="149" alt="image" src="Image_067.png"/></span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-top: 4pt;padding-left: 37pt;text-indent: 0pt;text-align: left;"><a name="bookmark596">Clean Code in JavaScript</a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 37pt;text-indent: 0pt;text-align: left;">James Padolsey</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 37pt;text-indent: 0pt;text-align: left;">ISBN: 978-1-78995-764-8</p><p style="text-indent: 0pt;text-align: left;"><br/></p><ul id="l215"><li data-list-text="•"><p style="padding-left: 64pt;text-indent: -13pt;text-align: left;">Understand the true purpose of code and the problems it solves for your end-users and colleagues</p></li><li data-list-text="•"><p style="padding-top: 7pt;padding-left: 64pt;text-indent: -13pt;line-height: 115%;text-align: left;"><span>Discover the tenets and enemies of clean code considering the effects of cultural and syntactic<br/>conventions</span></p></li><li data-list-text="•"><p style="padding-top: 5pt;padding-left: 64pt;text-indent: -13pt;text-align: left;">Use modern JavaScript syntax and design patterns to craft intuitive abstractions</p></li><li data-list-text="•"><p style="padding-top: 7pt;padding-left: 64pt;text-indent: -13pt;text-align: left;">Maintain code quality within your team via wise adoption of tooling and advocating best practices</p></li><li data-list-text="•"><p class="s33" style="padding-top: 7pt;padding-left: 64pt;text-indent: -13pt;line-height: 115%;text-align: left;">	<span class="p">Learn the modern ecosystem of JavaScript and its challenges like DOM reconciliation and<br/>state management</span></p></li><li data-list-text="•"><p style="padding-top: 5pt;padding-left: 64pt;text-indent: -13pt;text-align: left;">Express the behavior of your code both within tests and via various forms of documentation</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 322pt;text-indent: 0pt;text-align: left;">Other Books You May Enjoy   591</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-bottom: 4pt;padding-left: 216pt;text-indent: 0pt;text-align: center;"><span class="s352" style=" background-color: #000;">&lt;packt&gt; </span></p><p style="padding-left: 154pt;text-indent: 0pt;text-align: left;"><span><img width="94" height="75" alt="image" src="Image_068.jpg"/></span><span><img width="93" height="89" alt="image" src="Image_069.jpg"/></span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s353" style="padding-left: 49pt;text-indent: 0pt;line-height: 20pt;text-align: left;">JavaScript</p><p class="s354" style="padding-top: 2pt;padding-left: 6pt;text-indent: 0pt;line-height: 12pt;text-align: left;">from <b>Frontend </b>+o <b>Backend</b></p><p style="padding-left: 159pt;text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s356" style="padding-top: 1pt;text-indent: 0pt;text-align: right;">Learn full stack JavaScript development using</p><p class="s356" style="padding-top: 1pt;text-indent: 0pt;text-align: right;">the MEVN stack with quick and easy stops</p><p style="padding-left: 198pt;text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 91pt;text-indent: 0pt;text-align: center;"><span class="s357" style=" background-color: #000;"> </span><span class="s358" style=" background-color: #000;">ERIC SARRIOUI  </span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s10" style="padding-top: 4pt;padding-left: 28pt;text-indent: 0pt;text-align: left;"><a name="bookmark597">JavaScript from Frontend to Backend</a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 28pt;text-indent: 0pt;text-align: left;">Eric Sarrion</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 28pt;text-indent: 0pt;text-align: left;">ISBN: 978-1-80107-031-7</p><p style="text-indent: 0pt;text-align: left;"><br/></p></li></ul></li><li data-list-text="•"><p style="padding-left: 55pt;text-indent: -13pt;text-align: left;">Trigger deferred processing with JavaScript</p></li><li data-list-text="•"><p style="padding-top: 7pt;padding-left: 55pt;text-indent: -13pt;text-align: left;">Implement Express and MongoDB with Node.js</p></li><li data-list-text="•"><p style="padding-top: 7pt;padding-left: 55pt;text-indent: -13pt;text-align: left;">Build components with Vue.js</p></li><li data-list-text="•"><p style="padding-top: 7pt;padding-left: 55pt;text-indent: -13pt;text-align: left;">Understand how to create and use modules with Node.js</p></li><li data-list-text="•"><p style="padding-top: 7pt;padding-left: 55pt;text-indent: -13pt;text-align: left;">Familiarize yourself with npm</p></li><li data-list-text="•"><p style="padding-top: 7pt;padding-left: 55pt;text-indent: -13pt;text-align: left;">Build a client-side application entirely with JavaScript</p></li><li data-list-text="•"><p style="padding-top: 7pt;padding-left: 55pt;text-indent: -13pt;text-align: left;">Dive into full stack development with Vue.js, Node.js, and MongoDB</p></li></ul><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s164" style="padding-top: 4pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">592</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-top: 5pt;padding-left: 38pt;text-indent: 0pt;text-align: justify;"><a name="bookmark598">Packt is searching for authors like you</a></p><p style="padding-top: 10pt;padding-left: 37pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>If you’re interested in becoming an author for Packt, please visit authors . packtpub . com and<br/>apply today. We have worked with thousands of developers and tech professionals, just like you, to<br/>help them share their insight with the global tech community. You can make a general application,<br/>apply for a specific hot topic that we are recruiting an author for, or submit your own idea.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-left: 37pt;text-indent: 0pt;text-align: justify;"><a name="bookmark599">Share Your Thoughts</a></p><p style="padding-top: 10pt;padding-left: 37pt;text-indent: 0pt;line-height: 124%;text-align: justify;">Now you’ve finished <i>Mastering JavaScript Functional Programming - Third Edition, </i><span>we’d love to hear<br/>your thoughts! If you purchased the book from Amazon, please click here to go straight to the Amazon<br/>review page for this book and share your feedback or leave a review on the site that you purchased<br/>it from.</span></p><p style="padding-top: 7pt;padding-left: 37pt;text-indent: 0pt;line-height: 123%;text-align: justify;"><span>Your review is important to us and the tech community and will help us make sure were delivering<br/>excellent quality content.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s17" style="text-indent: 0pt;text-align: right;">593</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s6" style="padding-top: 5pt;padding-left: 29pt;text-indent: 0pt;text-align: left;"><a name="bookmark600">Download a free PDF copy of this book</a></p><p style="padding-top: 9pt;padding-left: 28pt;text-indent: 0pt;text-align: left;">Thanks for purchasing this book!</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 28pt;text-indent: 0pt;line-height: 126%;text-align: left;"><span>Do you like to read on the go but are unable to carry your print books everywhere? Is your eBook<br/>purchase not compatible with the device of your choice?</span></p><p style="padding-top: 6pt;padding-left: 28pt;text-indent: 0pt;text-align: left;">Don’t worry, now with every Packt book you get a DRM-free PDF version of that book at no cost.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 28pt;text-indent: 0pt;line-height: 125%;text-align: left;"><span>Read anywhere, any place, on any device. Search, copy, and paste code from your favorite technical<br/>books directly into your application.</span></p><p style="padding-top: 6pt;padding-left: 28pt;text-indent: 0pt;line-height: 123%;text-align: left;"><span>The perks don’t stop there, you can get exclusive access to discounts, newsletters, and great free content<br/>in your inbox daily</span></p><p style="padding-top: 7pt;padding-left: 28pt;text-indent: 0pt;text-align: left;">Follow these simple steps to get the benefits:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><ol id="l216"><li data-list-text="1."><p style="padding-left: 55pt;text-indent: -17pt;text-align: left;">Scan the QR code or visit the link below</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 171pt;text-indent: 0pt;text-align: left;"><span><img width="147" height="147" alt="image" src="Image_070.jpg"/></span></p><p style="padding-top: 7pt;padding-left: 91pt;text-indent: 0pt;text-align: center;"><a href="https://packt.link/free-ebook/9781804610138" class="s14">https://packt.link/free-ebook/9781804610138</a></p><p style="text-indent: 0pt;text-align: left;"><br/></p></li><li data-list-text="2."><p style="padding-left: 54pt;text-indent: -17pt;text-align: left;">Submit your proof of purchase</p></li><li data-list-text="3."><p style="padding-top: 6pt;padding-left: 55pt;text-indent: -17pt;text-align: left;">That’s it! We’ll send your free PDF and other benefits to your email directly</p></li></ol></li></ol></body></html>
